<!DOCTYPE html>
<html>
   <head>
       <meta charset="utf-8">
       <meta id = "viewport" name = "viewport" content = "width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover">

       <script>
            var clickTag='https://apps.apple.com/'
            var iosLink="https://apps.apple.com/";
            var androidLink="https://play.google.com/";

           var userAgent = navigator.userAgent || navigator.vendor;
           var clickTag = /android/i.test(userAgent) ? androidLink : iosLink;

           var link = iosLink;
           var link2 = androidLink;
           var lp_url = clickTag;
           
           ////MOBVISTA FUNCTIONS
           function gameStart()
           {
               if(!window.app || !app.gameStart){
                   setTimeout(gameStart, 250);
                   return;
               }
               app.gameStart();
           }
           
           function gameClose()
           {
               if(!app)return;
               app.gameClose();
           }

           function mobvistaGameReady(){
               window.gameReady && window.gameReady();
           }
           
           function mobvistaGameEnd(){
               window.gameEnd && window.gameEnd();
           }
       </script>
     
     <style>#modal {
	z-index: 9999;
}

* {
	padding: 0;
	margin: 0;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
}

body,
html {
	position: absolute;
	margin: 0;
	padding: 0;
	top: 0;
	right: 0;
	left: 0;
	bottom: 0;
	overflow: hidden;
	background: 0 0;

	touch-action: none;
}

canvas {
	position: fixed;
	top: 0;
	left: 0;
}

.hide {
	visibility: hidden;
	opacity: 0;
	transition: opacity 1s, visiblility 1s;
}

.show {
	visibility: visible;
	opacity: 1;
	transition: opacity 1s, visiblility 1s;
}
</style>
   </head>
   <body>
<script>(function(){
var t,e=Object.defineProperty,n=(t,n,i)=>(((t,n,i)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i})(t,"symbol"!=typeof n?n+"":n,i),i);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const i={font:{}},r={font:{}},s={assets:i,objectMap:r},a=Object.freeze(Object.defineProperty({__proto__:null,assets:i,default:s,objectMap:r},Symbol.toStringTag,{value:"Module"})),o=[],l=Object.freeze(Object.defineProperty({__proto__:null,default:o},Symbol.toStringTag,{value:"Module"})),h=!0,c="1.5.3",u=["1","2","4","8","16","32","64","128","256","512","1024","2048","4096","8192","16384","32768"],d={antialias:!0,alpha:!1,resolution:2,toneMapping:"NoToneMapping",toneMappingExposure:1,shadowMapEnabled:!1,shadowMapType:"VSMShadowMap",logarithmicDepthBuffer:!0,outputColorSpace:"SRGBColorSpace"},p={library:"2D/3D",enableAudio:!1,convertFontsToWoff2:!0,preloader:"default"},f={wRatioMax:150,hRatioMax:150,vSpaceMax:150,hSpaceMax:150},m={physicsType:"none",enableDebug:!1,enableSimulation:!1,enableWorldBounds:!1,worldBounds:{x:0,y:0,width:800,height:800},worldBoundsSides:{top:!1,right:!0,bottom:!0,left:!0},collisionCategories:[{label:"default",value:"1"}],outlinerOpacityThreshold:50,outlinerSimplifyThreshold:50},g={eventNames:[]},v={physicsType:"none",collisionCategories:[{label:"default",value:"1"}],enableDebug:!0},y={bitmapFonts:{}},x={analyzer:!1,hideConsoles:!0,iosLink:"https://apps.apple.com/",androidLink:"https://play.google.com/"},b="C:\\Users\\playable\\gearbox\\studio-template",_="be75e770-4268-4439-97a9-ae9d6051dd88",S={projectType:"3D",isStudioProject:h,studioVersion:c,projectVersion:2,categoryBits:u,rendererSettings3D:d,generalSettings:p,resize2DSettings:f,physics2DSettings:m,eventsSettings:g,physics3DSettings:v,bitmapFontSettings:y,buildSettings:x,path:b,lastEditedScene:_,lastEditedSceneView:"2D"},w=Object.freeze(Object.defineProperty({__proto__:null,bitmapFontSettings:y,buildSettings:x,categoryBits:u,default:S,eventsSettings:g,generalSettings:p,isStudioProject:h,lastEditedScene:_,lastEditedSceneView:"2D",path:b,physics2DSettings:m,physics3DSettings:v,projectType:"3D",projectVersion:2,rendererSettings3D:d,resize2DSettings:f,studioVersion:c},Symbol.toStringTag,{value:"Module"})),T={enableFpsCounter:!1,editableBg:!1,backgroundType:1,backgroundColor:"#ffffff",bgGradientTop:"#01D5FF",bgGradientBottom:"#ffffff",bgSrc:null,bannerEnable:!1,bannerHideOnEndCard:!1,bannerHideOnEndCardIsQuick:!1,bannerWidthRatio:95,bannerHeightRatio:10,bannerOffsetYRatio:5,bannerBorderRadius:50,bannerAlpha:1,bannerTextAlpha:1,bannerBgType:0,bannerBgColor:"#000000",bannerBgGradientColorTop:"#000000",bannerBgGradientColorBottom:"#00a2ff",bannerBgImage:null,bannerText:{text:"Top Banner",color:"#FFFFFF"},bannerTextFont:"Arial",soundEnabled:!0,playSoundAfterFirstTouch:!1,musicSrc:null,musicVolume:.5,videoVolume:1,sfxSrc:null,sfxJson:null,sfxVolume:1,ttsVolume:1,sfxEnabled:!0,entranceVideo:null,entranceVideoDuration:3,gifOn:!1,gifSrc:null,videoSrc:null,postprocessData:{enable:!1,fxaa:!0,bloom:{enable:!0}}},M="165",A={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},E={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},C=0,P=1,R=2,I=100,O=101,D=102,B=200,F=201,L=202,U=203,k=204,N=205,z=206,G=207,H=208,V=209,X=210,W=211,j=212,Y=213,q=214,K="attached",J="detached",Z=300,Q=301,$=302,tt=303,et=304,nt=306,it=1e3,rt=1001,st=1002,at=1003,ot=1004,lt=1005,ht=1006,ct=1007,ut=1008,dt=1009,pt=1012,ft=1013,mt=1014,gt=1015,vt=1016,yt=1017,xt=1018,bt=1020,_t=1023,St=1026,wt=1027,Tt=1028,Mt=1029,At=1031,Et=1033,Ct=33776,Pt=33777,Rt=33778,It=33779,Ot=35840,Dt=35841,Bt=35842,Ft=35843,Lt=36196,Ut=37492,kt=37496,Nt=37808,zt=37809,Gt=37810,Ht=37811,Vt=37812,Xt=37813,Wt=37814,jt=37815,Yt=37816,qt=37817,Kt=37818,Jt=37819,Zt=37820,Qt=37821,$t=36492,te=36494,ee=36495,ne=36284,ie=36285,re=36286,se=2200,ae=2201,oe=2300,le=2301,he=2302,ce=2400,ue=2401,de=2402,pe=2500,fe=2501,me=3200,ge=3201,ve="",ye="srgb",xe="srgb-linear",be="display-p3",_e="display-p3-linear",Se="linear",we="srgb",Te="rec709",Me="p3",Ae=7680,Ee=512,Ce=513,Pe=514,Re=515,Ie=516,Oe=517,De=518,Be=519,Fe=35044,Le=35048,Ue="300 es",ke=2e3,Ne=2001;class ze{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const Ge=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let He=1234567;const Ve=Math.PI/180,Xe=180/Math.PI;function We(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Ge[255&t]+Ge[t>>8&255]+Ge[t>>16&255]+Ge[t>>24&255]+"-"+Ge[255&e]+Ge[e>>8&255]+"-"+Ge[e>>16&15|64]+Ge[e>>24&255]+"-"+Ge[63&n|128]+Ge[n>>8&255]+"-"+Ge[n>>16&255]+Ge[n>>24&255]+Ge[255&i]+Ge[i>>8&255]+Ge[i>>16&255]+Ge[i>>24&255]).toLowerCase()}function je(t,e,n){return Math.max(e,Math.min(n,t))}function Ye(t,e){return(t%e+e)%e}function qe(t,e,n){return(1-n)*t+n*e}function Ke(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Je(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Ze={DEG2RAD:Ve,RAD2DEG:Xe,generateUUID:We,clamp:je,euclideanModulo:Ye,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:qe,damp:function(t,e,n,i){return qe(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(Ye(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(He=t);let e=He+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Ve},radToDeg:function(t){return t*Xe},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),h=s((e+i)/2),c=a((e+i)/2),u=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),f=a((i-e)/2);switch(r){case"XYX":t.set(o*c,l*u,l*d,o*h);break;case"YZY":t.set(l*d,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*d,o*c,o*h);break;case"XZX":t.set(o*c,l*f,l*p,o*h);break;case"YXY":t.set(l*p,o*c,l*f,o*h);break;case"ZYZ":t.set(l*f,l*p,o*c,o*h)}},normalize:Je,denormalize:Ke};let Qe=class t{constructor(e=0,n=0){t.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(je(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},$e=class t{constructor(e,n,i,r,s,a,o,l,h){t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,n,i,r,s,a,o,l,h)}set(t,e,n,i,r,s,a,o,l){const h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=r,h[5]=o,h[6]=n,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],h=n[4],c=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],_=i[5],S=i[8];return r[0]=s*f+a*v+o*b,r[3]=s*m+a*y+o*_,r[6]=s*g+a*x+o*S,r[1]=l*f+h*v+c*b,r[4]=l*m+h*y+c*_,r[7]=l*g+h*x+c*S,r[2]=u*f+d*v+p*b,r[5]=u*m+d*y+p*_,r[8]=u*g+d*x+p*S,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8];return e*s*h-e*a*l-n*r*h+n*a*o+i*r*l-i*s*o}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=h*s-a*l,u=a*o-h*r,d=l*r-s*o,p=e*c+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(i*l-h*n)*f,t[2]=(a*n-i*s)*f,t[3]=u*f,t[4]=(h*e-i*o)*f,t[5]=(i*r-a*e)*f,t[6]=d*f,t[7]=(n*o-l*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+t,-i*l,i*o,-i*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(tn.makeScale(t,e)),this}rotate(t){return this.premultiply(tn.makeRotation(-t)),this}translate(t,e){return this.premultiply(tn.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}};const tn=new $e;function en(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const nn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function rn(t,e){return new nn[t](e)}function sn(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function an(){const t=sn("canvas");return t.style.display="block",t}const on={};function ln(t){t in on||(on[t]=!0)}const hn=(new $e).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),cn=(new $e).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),un={[xe]:{transfer:Se,primaries:Te,toReference:t=>t,fromReference:t=>t},[ye]:{transfer:we,primaries:Te,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[_e]:{transfer:Se,primaries:Me,toReference:t=>t.applyMatrix3(cn),fromReference:t=>t.applyMatrix3(hn)},[be]:{transfer:we,primaries:Me,toReference:t=>t.convertSRGBToLinear().applyMatrix3(cn),fromReference:t=>t.applyMatrix3(hn).convertLinearToSRGB()}},dn=new Set([xe,_e]),pn={enabled:!0,_workingColorSpace:xe,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!dn.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;const i=un[e].toReference;return(0,un[n].fromReference)(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return un[t].primaries},getTransfer:function(t){return t===ve?Se:un[t].transfer}};function fn(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function mn(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let gn;class vn{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===gn&&(gn=sn("canvas")),gn.width=t.width,gn.height=t.height;const n=gn.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=gn}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=sn("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*fn(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*fn(e[t]/255)):e[t]=fn(e[t]);return{data:e,width:t.width,height:t.height}}return t}}let yn=0;class xn{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:yn++}),this.uuid=We(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(bn(i[e].image)):t.push(bn(i[e]))}else t=bn(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function bn(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?vn.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:{}}let _n=0,Sn=class t extends ze{constructor(e=t.DEFAULT_IMAGE,n=t.DEFAULT_MAPPING,i=1001,r=1001,s=1006,a=1008,o=1023,l=1009,h=t.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_n++}),this.uuid=We(),this.name="",this.source=new xn(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Qe(0,0),this.repeat=new Qe(1,1),this.center=new Qe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $e,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Z)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case it:t.x=t.x-Math.floor(t.x);break;case rt:t.x=t.x<0?0:1;break;case st:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case it:t.y=t.y-Math.floor(t.y);break;case rt:t.y=t.y<0?0:1;break;case st:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}};Sn.DEFAULT_IMAGE=null,Sn.DEFAULT_MAPPING=Z,Sn.DEFAULT_ANISOTROPY=1;let wn=class t{constructor(e=0,n=0,i=0,r=1){t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,a=.1,o=t.elements,l=o[0],h=o[4],c=o[8],u=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(h-u)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(h+u)<a&&Math.abs(c+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,v=(g+1)/2,y=(h+u)/4,x=(c+f)/4,b=(p+m)/4;return t>o&&t>v?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=y/n,r=x/n):o>v?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=y/i,r=b/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=x/r,i=b/r),this.set(n,i,r,e),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-h)*(u-h));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(u-h)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Tn=class extends ze{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new wn(0,0,t,e),this.scissorTest=!1,this.viewport=new wn(0,0,t,e);const i={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ht,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new Sn(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let a=0;a<s;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let n=0,i=t.textures.length;n<i;n++)this.textures[n]=t.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new xn(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}};class Mn extends Tn{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class An extends Sn{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=at,this.minFilter=at,this.wrapR=rt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class En extends Sn{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=at,this.minFilter=at,this.wrapR=rt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let Cn=class{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,s,a){let o=n[i+0],l=n[i+1],h=n[i+2],c=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||o!==u||l!==d||h!==p){let t=1-a;const e=o*u+l*d+h*p+c*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],h=n[i+3],c=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-o*c,t[e+3]=h*p-a*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,i=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(n/2),h=a(i/2),c=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=n+a+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>a&&n>c){const t=2*Math.sqrt(1+n-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(a>c){const t=2*Math.sqrt(1+a-n-c);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-n-a);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(je(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=n*h+s*a+i*l-r*o,this._y=i*h+s*o+r*a-n*l,this._z=r*h+s*l+n*o-i*a,this._w=s*h-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=s*c+this._w*u,this._x=n*c+this._x*u,this._y=i*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Pn=class t{constructor(e=0,n=0,i=0){t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(In.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(In.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=2*(s*i-a*n),h=2*(a*e-r*i),c=2*(r*n-s*e);return this.x=e+o*l+s*c-a*h,this.y=n+o*h+a*l-r*c,this.z=i+o*c+r*h-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Rn.copy(this).projectOnVector(t),this.sub(Rn)}reflect(t){return this.sub(Rn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(je(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const Rn=new Pn,In=new Cn;class On{constructor(t=new Pn(1/0,1/0,1/0),e=new Pn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Bn.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Bn.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Bn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,n=i.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,Bn):Bn.fromBufferAttribute(i,e),Bn.applyMatrix4(t.matrixWorld),this.expandByPoint(Bn);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Fn.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Fn.copy(n.boundingBox)),Fn.applyMatrix4(t.matrixWorld),this.union(Fn)}const i=t.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Bn),Bn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Hn),Vn.subVectors(this.max,Hn),Ln.subVectors(t.a,Hn),Un.subVectors(t.b,Hn),kn.subVectors(t.c,Hn),Nn.subVectors(Un,Ln),zn.subVectors(kn,Un),Gn.subVectors(Ln,kn);let e=[0,-Nn.z,Nn.y,0,-zn.z,zn.y,0,-Gn.z,Gn.y,Nn.z,0,-Nn.x,zn.z,0,-zn.x,Gn.z,0,-Gn.x,-Nn.y,Nn.x,0,-zn.y,zn.x,0,-Gn.y,Gn.x,0];return!!jn(e,Ln,Un,kn,Vn)&&(e=[1,0,0,0,1,0,0,0,1],!!jn(e,Ln,Un,kn,Vn)&&(Xn.crossVectors(Nn,zn),e=[Xn.x,Xn.y,Xn.z],jn(e,Ln,Un,kn,Vn)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Bn).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Bn).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Dn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Dn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Dn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Dn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Dn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Dn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Dn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Dn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Dn)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Dn=[new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn,new Pn],Bn=new Pn,Fn=new On,Ln=new Pn,Un=new Pn,kn=new Pn,Nn=new Pn,zn=new Pn,Gn=new Pn,Hn=new Pn,Vn=new Pn,Xn=new Pn,Wn=new Pn;function jn(t,e,n,i,r){for(let s=0,a=t.length-3;s<=a;s+=3){Wn.fromArray(t,s);const a=r.x*Math.abs(Wn.x)+r.y*Math.abs(Wn.y)+r.z*Math.abs(Wn.z),o=e.dot(Wn),l=n.dot(Wn),h=i.dot(Wn);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}const Yn=new On,qn=new Pn,Kn=new Pn;let Jn=class{constructor(t=new Pn,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Yn.setFromPoints(t).getCenter(n);let i=0;for(let r=0,s=t.length;r<s;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;qn.subVectors(t,this.center);const e=qn.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(qn,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Kn.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(qn.copy(t.center).add(Kn)),this.expandByPoint(qn.copy(t.center).sub(Kn))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}};const Zn=new Pn,Qn=new Pn,$n=new Pn,ti=new Pn,ei=new Pn,ni=new Pn,ii=new Pn;class ri{constructor(t=new Pn,e=new Pn(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Zn)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Zn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Zn.copy(this.origin).addScaledVector(this.direction,e),Zn.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){Qn.copy(t).add(e).multiplyScalar(.5),$n.copy(e).sub(t).normalize(),ti.copy(this.origin).sub(Qn);const r=.5*t.distanceTo(e),s=-this.direction.dot($n),a=ti.dot(this.direction),o=-ti.dot($n),l=ti.lengthSq(),h=Math.abs(1-s*s);let c,u,d,p;if(h>0)if(c=s*o-a,u=s*a-o,p=r*h,c>=0)if(u>=-p)if(u<=p){const t=1/h;c*=t,u*=t,d=c*(c+s*u+2*a)+u*(s*c+u+2*o)+l}else u=r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u=-r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u<=-p?(c=Math.max(0,-(-s*r+a)),u=c>0?-r:Math.min(Math.max(-r,-o),r),d=-c*c+u*(u+2*o)+l):u<=p?(c=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(c=Math.max(0,-(s*r+a)),u=c>0?r:Math.min(Math.max(-r,-o),r),d=-c*c+u*(u+2*o)+l);else u=s>0?-r:r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,c),i&&i.copy(Qn).addScaledVector($n,u),d}intersectSphere(t,e){Zn.subVectors(t.center,this.origin);const n=Zn.dot(this.direction),i=Zn.dot(Zn)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,a,o;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,s=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,s=(t.min.y-u.y)*h),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),c>=0?(a=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,Zn)}intersectTriangle(t,e,n,i,r){ei.subVectors(e,t),ni.subVectors(n,t),ii.crossVectors(ei,ni);let s,a=this.direction.dot(ii);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}ti.subVectors(this.origin,t);const o=s*this.direction.dot(ni.crossVectors(ti,ni));if(o<0)return null;const l=s*this.direction.dot(ei.cross(ti));if(l<0)return null;if(o+l>a)return null;const h=-s*ti.dot(ii);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}let si=class t{constructor(e,n,i,r,s,a,o,l,h,c,u,d,p,f,m,g){t.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,n,i,r,s,a,o,l,h,c,u,d,p,f,m,g)}set(t,e,n,i,r,s,a,o,l,h,c,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new t).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/ai.setFromMatrixColumn(t,0).length(),r=1/ai.setFromMatrixColumn(t,1).length(),s=1/ai.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=s*h,n=s*c,i=a*h,r=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*h,n=o*c,i=l*h,r=l*c;e[0]=t+r*a,e[4]=i*a-n,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-a,e[2]=n*a-i,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*h,n=o*c,i=l*h,r=l*c;e[0]=t-r*a,e[4]=-s*c,e[8]=i+n*a,e[1]=n+i*a,e[5]=s*h,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*h,n=s*c,i=a*h,r=a*c;e[0]=o*h,e[4]=i*l-n,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*h,e[4]=r-t*c,e[8]=i*c+n,e[1]=c,e[5]=s*h,e[9]=-a*h,e[2]=-l*h,e[6]=n*c+i,e[10]=t-r*c}else if("XZY"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=n*c-i,e[2]=i*c-n,e[6]=a*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(li,t,hi)}lookAt(t,e,n){const i=this.elements;return di.subVectors(t,e),0===di.lengthSq()&&(di.z=1),di.normalize(),ci.crossVectors(n,di),0===ci.lengthSq()&&(1===Math.abs(n.z)?di.x+=1e-4:di.z+=1e-4,di.normalize(),ci.crossVectors(n,di)),ci.normalize(),ui.crossVectors(di,ci),i[0]=ci.x,i[4]=ui.x,i[8]=di.x,i[1]=ci.y,i[5]=ui.y,i[9]=di.y,i[2]=ci.z,i[6]=ui.z,i[10]=di.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],h=n[1],c=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],_=i[0],S=i[4],w=i[8],T=i[12],M=i[1],A=i[5],E=i[9],C=i[13],P=i[2],R=i[6],I=i[10],O=i[14],D=i[3],B=i[7],F=i[11],L=i[15];return r[0]=s*_+a*M+o*P+l*D,r[4]=s*S+a*A+o*R+l*B,r[8]=s*w+a*E+o*I+l*F,r[12]=s*T+a*C+o*O+l*L,r[1]=h*_+c*M+u*P+d*D,r[5]=h*S+c*A+u*R+d*B,r[9]=h*w+c*E+u*I+d*F,r[13]=h*T+c*C+u*O+d*L,r[2]=p*_+f*M+m*P+g*D,r[6]=p*S+f*A+m*R+g*B,r[10]=p*w+f*E+m*I+g*F,r[14]=p*T+f*C+m*O+g*L,r[3]=v*_+y*M+x*P+b*D,r[7]=v*S+y*A+x*R+b*B,r[11]=v*w+y*E+x*I+b*F,r[15]=v*T+y*C+x*O+b*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-i*l*c-r*a*u+n*l*u+i*a*d-n*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-i*s*d+i*l*h-r*o*h)+t[11]*(+e*l*c-e*a*d-r*s*c+n*s*d+r*a*h-n*l*h)+t[15]*(-i*a*h-e*o*c+e*a*u+i*s*c-n*s*u+n*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=c*m*l-f*u*l+f*o*d-a*m*d-c*o*g+a*u*g,y=p*u*l-h*m*l-p*o*d+s*m*d+h*o*g-s*u*g,x=h*f*l-p*c*l+p*a*d-s*f*d-h*a*g+s*c*g,b=p*c*o-h*f*o-p*a*u+s*f*u+h*a*m-s*c*m,_=e*v+n*y+i*x+r*b;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/_;return t[0]=v*S,t[1]=(f*u*r-c*m*r-f*i*d+n*m*d+c*i*g-n*u*g)*S,t[2]=(a*m*r-f*o*r+f*i*l-n*m*l-a*i*g+n*o*g)*S,t[3]=(c*o*r-a*u*r-c*i*l+n*u*l+a*i*d-n*o*d)*S,t[4]=y*S,t[5]=(h*m*r-p*u*r+p*i*d-e*m*d-h*i*g+e*u*g)*S,t[6]=(p*o*r-s*m*r-p*i*l+e*m*l+s*i*g-e*o*g)*S,t[7]=(s*u*r-h*o*r+h*i*l-e*u*l-s*i*d+e*o*d)*S,t[8]=x*S,t[9]=(p*c*r-h*f*r-p*n*d+e*f*d+h*n*g-e*c*g)*S,t[10]=(s*f*r-p*a*r+p*n*l-e*f*l-s*n*g+e*a*g)*S,t[11]=(h*a*r-s*c*r-h*n*l+e*c*l+s*n*d-e*a*d)*S,t[12]=b*S,t[13]=(h*f*i-p*c*i+p*n*u-e*f*u-h*n*m+e*c*m)*S,t[14]=(p*a*i-s*f*i-p*n*o+e*f*o+s*n*m-e*a*m)*S,t[15]=(s*c*i-h*a*i+h*n*o-e*c*o-s*n*u+e*a*u)*S,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,a=t.y,o=t.z,l=r*s,h=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,h*a+n,h*o-i*s,0,l*o-i*a,h*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,h=s+s,c=a+a,u=r*l,d=r*h,p=r*c,f=s*h,m=s*c,g=a*c,v=o*l,y=o*h,x=o*c,b=n.x,_=n.y,S=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+x)*b,i[2]=(p-y)*b,i[3]=0,i[4]=(d-x)*_,i[5]=(1-(u+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(p+y)*S,i[9]=(m-v)*S,i[10]=(1-(u+f))*S,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=ai.set(i[0],i[1],i[2]).length();const s=ai.set(i[4],i[5],i[6]).length(),a=ai.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],oi.copy(this);const o=1/r,l=1/s,h=1/a;return oi.elements[0]*=o,oi.elements[1]*=o,oi.elements[2]*=o,oi.elements[4]*=l,oi.elements[5]*=l,oi.elements[6]*=l,oi.elements[8]*=h,oi.elements[9]*=h,oi.elements[10]*=h,e.setFromRotationMatrix(oi),n.x=r,n.y=s,n.z=a,this}makePerspective(t,e,n,i,r,s,a=2e3){const o=this.elements,l=2*r/(e-t),h=2*r/(n-i),c=(e+t)/(e-t),u=(n+i)/(n-i);let d,p;if(a===ke)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==Ne)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r)}return o[0]=l,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=h,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s,a=2e3){const o=this.elements,l=1/(e-t),h=1/(n-i),c=1/(s-r),u=(e+t)*l,d=(n+i)*h;let p,f;if(a===ke)p=(s+r)*c,f=-2*c;else{if(a!==Ne)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*c,f=-1*c}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}};const ai=new Pn,oi=new si,li=new Pn(0,0,0),hi=new Pn(1,1,1),ci=new Pn,ui=new Pn,di=new Pn,pi=new si,fi=new Cn;let mi=class t{constructor(e=0,n=0,i=0,r=t.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],h=i[9],c=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(je(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-je(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(je(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-je(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(je(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-je(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,d),this._y=0)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return pi.makeRotationFromQuaternion(t),this.setFromRotationMatrix(pi,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return fi.setFromEuler(this),this.setFromQuaternion(fi,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};mi.DEFAULT_ORDER="XYZ";class gi{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let vi=0;const yi=new Pn,xi=new Cn,bi=new si,_i=new Pn,Si=new Pn,wi=new Pn,Ti=new Cn,Mi=new Pn(1,0,0),Ai=new Pn(0,1,0),Ei=new Pn(0,0,1),Ci={type:"added"},Pi={type:"removed"},Ri={type:"childadded",child:null},Ii={type:"childremoved",child:null};class Oi extends ze{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:vi++}),this.uuid=We(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Oi.DEFAULT_UP.clone();const t=new Pn,e=new mi,n=new Cn,i=new Pn(1,1,1);e._onChange(function(){n.setFromEuler(e,!1)}),n._onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new si},normalMatrix:{value:new $e}}),this.matrix=new si,this.matrixWorld=new si,this.matrixAutoUpdate=Oi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Oi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new gi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return xi.setFromAxisAngle(t,e),this.quaternion.multiply(xi),this}rotateOnWorldAxis(t,e){return xi.setFromAxisAngle(t,e),this.quaternion.premultiply(xi),this}rotateX(t){return this.rotateOnAxis(Mi,t)}rotateY(t){return this.rotateOnAxis(Ai,t)}rotateZ(t){return this.rotateOnAxis(Ei,t)}translateOnAxis(t,e){return yi.copy(t).applyQuaternion(this.quaternion),this.position.add(yi.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Mi,t)}translateY(t){return this.translateOnAxis(Ai,t)}translateZ(t){return this.translateOnAxis(Ei,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(bi.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?_i.copy(t):_i.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Si.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?bi.lookAt(Si,_i,this.up):bi.lookAt(_i,Si,this.up),this.quaternion.setFromRotationMatrix(bi),i&&(bi.extractRotation(i.matrixWorld),xi.setFromRotationMatrix(bi),this.quaternion.premultiply(xi.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this||t&&t.isObject3D&&(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Ci),Ri.child=t,this.dispatchEvent(Ri),Ri.child=null),this}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Pi),Ii.child=t,this.dispatchEvent(Ii),Ii.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),bi.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),bi.multiply(t.parent.matrixWorld)),t.applyMatrix4(bi),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Ci),Ri.child=t,this.dispatchEvent(Ri),Ri.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Si,t,wi),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Si,Ti,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){const i=e[n];!0!==i.matrixWorldAutoUpdate&&!0!==t||i.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),h=s(t.animations),c=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),h.length>0&&(n.animations=h),c.length>0&&(n.nodes=c)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}}Oi.DEFAULT_UP=new Pn(0,1,0),Oi.DEFAULT_MATRIX_AUTO_UPDATE=!0,Oi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Di=new Pn,Bi=new Pn,Fi=new Pn,Li=new Pn,Ui=new Pn,ki=new Pn,Ni=new Pn,zi=new Pn,Gi=new Pn,Hi=new Pn;let Vi=class t{constructor(t=new Pn,e=new Pn,n=new Pn){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Di.subVectors(t,e),i.cross(Di);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){Di.subVectors(i,e),Bi.subVectors(n,e),Fi.subVectors(t,e);const s=Di.dot(Di),a=Di.dot(Bi),o=Di.dot(Fi),l=Bi.dot(Bi),h=Bi.dot(Fi),c=s*l-a*a;if(0===c)return r.set(0,0,0),null;const u=1/c,d=(l*o-a*h)*u,p=(s*h-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return null!==this.getBarycoord(t,e,n,i,Li)&&(Li.x>=0&&Li.y>=0&&Li.x+Li.y<=1)}static getInterpolation(t,e,n,i,r,s,a,o){return null===this.getBarycoord(t,e,n,i,Li)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,Li.x),o.addScaledVector(s,Li.y),o.addScaledVector(a,Li.z),o)}static isFrontFacing(t,e,n,i){return Di.subVectors(n,e),Bi.subVectors(t,e),Di.cross(Bi).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Di.subVectors(this.c,this.b),Bi.subVectors(this.a,this.b),.5*Di.cross(Bi).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return t.getNormal(this.a,this.b,this.c,e)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,i,r,s){return t.getInterpolation(e,this.a,this.b,this.c,n,i,r,s)}containsPoint(e){return t.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return t.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,a;Ui.subVectors(i,n),ki.subVectors(r,n),zi.subVectors(t,n);const o=Ui.dot(zi),l=ki.dot(zi);if(o<=0&&l<=0)return e.copy(n);Gi.subVectors(t,i);const h=Ui.dot(Gi),c=ki.dot(Gi);if(h>=0&&c<=h)return e.copy(i);const u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return s=o/(o-h),e.copy(n).addScaledVector(Ui,s);Hi.subVectors(t,r);const d=Ui.dot(Hi),p=ki.dot(Hi);if(p>=0&&d<=p)return e.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(n).addScaledVector(ki,a);const m=h*p-d*c;if(m<=0&&c-h>=0&&d-p>=0)return Ni.subVectors(r,i),a=(c-h)/(c-h+(d-p)),e.copy(i).addScaledVector(Ni,a);const g=1/(m+f+u);return s=f*g,a=u*g,e.copy(n).addScaledVector(Ui,s).addScaledVector(ki,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}};const Xi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wi={h:0,s:0,l:0},ji={h:0,s:0,l:0};function Yi(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}let qi=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=ye){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,pn.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=pn.workingColorSpace){return this.r=t,this.g=e,this.b=n,pn.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=pn.workingColorSpace){if(t=Ye(t,1),e=je(e,0,1),n=je(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Yi(r,i,t+1/3),this.g=Yi(r,i,t),this.b=Yi(r,i,t-1/3)}return pn.toWorkingColorSpace(this,i),this}setStyle(t,e=ye){function n(t){void 0!==t&&parseFloat(t)}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let t;const r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setRGB(Math.min(255,parseInt(t[1],10))/255,Math.min(255,parseInt(t[2],10))/255,Math.min(255,parseInt(t[3],10))/255,e);if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setRGB(Math.min(100,parseInt(t[1],10))/100,Math.min(100,parseInt(t[2],10))/100,Math.min(100,parseInt(t[3],10))/100,e);break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setHSL(parseFloat(t[1])/360,parseFloat(t[2])/100,parseFloat(t[3])/100,e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],n=t.length;if(3===n)return this.setRGB(parseInt(t.charAt(0),16)/15,parseInt(t.charAt(1),16)/15,parseInt(t.charAt(2),16)/15,e);if(6===n)return this.setHex(parseInt(t,16),e)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=ye){const n=Xi[t.toLowerCase()];return void 0!==n&&this.setHex(n,e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=fn(t.r),this.g=fn(t.g),this.b=fn(t.b),this}copyLinearToSRGB(t){return this.r=mn(t.r),this.g=mn(t.g),this.b=mn(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ye){return pn.fromWorkingColorSpace(Ki.copy(this),t),65536*Math.round(je(255*Ki.r,0,255))+256*Math.round(je(255*Ki.g,0,255))+Math.round(je(255*Ki.b,0,255))}getHexString(t=ye){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=pn.workingColorSpace){pn.fromWorkingColorSpace(Ki.copy(this),e);const n=Ki.r,i=Ki.g,r=Ki.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,l;const h=(a+s)/2;if(a===s)o=0,l=0;else{const t=s-a;switch(l=h<=.5?t/(s+a):t/(2-s-a),s){case n:o=(i-r)/t+(i<r?6:0);break;case i:o=(r-n)/t+2;break;case r:o=(n-i)/t+4}o/=6}return t.h=o,t.s=l,t.l=h,t}getRGB(t,e=pn.workingColorSpace){return pn.fromWorkingColorSpace(Ki.copy(this),e),t.r=Ki.r,t.g=Ki.g,t.b=Ki.b,t}getStyle(t=ye){pn.fromWorkingColorSpace(Ki.copy(this),t);const e=Ki.r,n=Ki.g,i=Ki.b;return t!==ye?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(t,e,n){return this.getHSL(Wi),this.setHSL(Wi.h+t,Wi.s+e,Wi.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Wi),t.getHSL(ji);const n=qe(Wi.h,ji.h,e),i=qe(Wi.s,ji.s,e),r=qe(Wi.l,ji.l,e);return this.setHSL(n,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ki=new qi;qi.NAMES=Xi;let Ji=0;class Zi extends ze{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ji++}),this.uuid=We(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=k,this.blendDst=N,this.blendEquation=I,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new qi(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ae,this.stencilZFail=Ae,this.stencilZPass=Ae,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n)continue;const i=this[e];void 0!==i&&(i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==k&&(n.blendSrc=this.blendSrc),this.blendDst!==N&&(n.blendDst=this.blendDst),this.blendEquation!==I&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ae&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Ae&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Ae&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class Qi extends Zi{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new qi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mi,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const $i=tr();function tr(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const t=l-127;t<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):t<-14?(i[l]=1024>>-t-14,i[256|l]=1024>>-t-14|32768,r[l]=-t-1,r[256|l]=-t-1):t<=15?(i[l]=t+15<<10,i[256|l]=t+15<<10|32768,r[l]=13,r[256|l]=13):t<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let t=l<<13,e=0;for(;!(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,s[l]=t|e}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function er(t){Math.abs(t),t=je(t,-65504,65504),$i.floatView[0]=t;const e=$i.uint32View[0],n=e>>23&511;return $i.baseTable[n]+((8388607&e)>>$i.shiftTable[n])}function nr(t){const e=t>>10;return $i.uint32View[0]=$i.mantissaTable[$i.offsetTable[e]+(1023&t)]+$i.exponentTable[e],$i.floatView[0]}const ir={toHalfFloat:er,fromHalfFloat:nr},rr=new Pn,sr=new Qe;class ar{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=Fe,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=gt,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return ln("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)sr.fromBufferAttribute(this,e),sr.applyMatrix3(t),this.setXY(e,sr.x,sr.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)rr.fromBufferAttribute(this,e),rr.applyMatrix3(t),this.setXYZ(e,rr.x,rr.y,rr.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)rr.fromBufferAttribute(this,e),rr.applyMatrix4(t),this.setXYZ(e,rr.x,rr.y,rr.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)rr.fromBufferAttribute(this,e),rr.applyNormalMatrix(t),this.setXYZ(e,rr.x,rr.y,rr.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)rr.fromBufferAttribute(this,e),rr.transformDirection(t),this.setXYZ(e,rr.x,rr.y,rr.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Ke(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Je(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Ke(e,this.array)),e}setX(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Ke(e,this.array)),e}setY(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Ke(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Ke(e,this.array)),e}setW(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array),i=Je(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array),i=Je(i,this.array),r=Je(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Fe&&(t.usage=this.usage),t}}class or extends ar{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class lr extends ar{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class hr extends ar{constructor(t,e,n){super(new Float32Array(t),e,n)}}let cr=0;const ur=new si,dr=new Oi,pr=new Pn,fr=new On,mr=new On,gr=new Pn;class vr extends ze{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:cr++}),this.uuid=We(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(en(t)?lr:or)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new $e).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return ur.makeRotationFromQuaternion(t),this.applyMatrix4(ur),this}rotateX(t){return ur.makeRotationX(t),this.applyMatrix4(ur),this}rotateY(t){return ur.makeRotationY(t),this.applyMatrix4(ur),this}rotateZ(t){return ur.makeRotationZ(t),this.applyMatrix4(ur),this}translate(t,e,n){return ur.makeTranslation(t,e,n),this.applyMatrix4(ur),this}scale(t,e,n){return ur.makeScale(t,e,n),this.applyMatrix4(ur),this}lookAt(t){return dr.lookAt(t),dr.updateMatrix(),this.applyMatrix4(dr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pr).negate(),this.translate(pr.x,pr.y,pr.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new hr(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new On);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingBox.set(new Pn(-1/0,-1/0,-1/0),new Pn(1/0,1/0,1/0));else{if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];fr.setFromBufferAttribute(n),this.morphTargetsRelative?(gr.addVectors(this.boundingBox.min,fr.min),this.boundingBox.expandByPoint(gr),gr.addVectors(this.boundingBox.max,fr.max),this.boundingBox.expandByPoint(gr)):(this.boundingBox.expandByPoint(fr.min),this.boundingBox.expandByPoint(fr.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Jn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingSphere.set(new Pn,1/0);else if(t){const n=this.boundingSphere.center;if(fr.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const n=e[t];mr.setFromBufferAttribute(n),this.morphTargetsRelative?(gr.addVectors(fr.min,mr.min),fr.expandByPoint(gr),gr.addVectors(fr.max,mr.max),fr.expandByPoint(gr)):(fr.expandByPoint(mr.min),fr.expandByPoint(mr.max))}fr.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)gr.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(gr));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)gr.fromBufferAttribute(s,e),a&&(pr.fromBufferAttribute(t,e),gr.add(pr)),i=Math.max(i,n.distanceToSquared(gr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return;const n=e.position,i=e.normal,r=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ar(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let w=0;w<n.count;w++)a[w]=new Pn,o[w]=new Pn;const l=new Pn,h=new Pn,c=new Pn,u=new Qe,d=new Qe,p=new Qe,f=new Pn,m=new Pn;function g(t,e,i){l.fromBufferAttribute(n,t),h.fromBufferAttribute(n,e),c.fromBufferAttribute(n,i),u.fromBufferAttribute(r,t),d.fromBufferAttribute(r,e),p.fromBufferAttribute(r,i),h.sub(l),c.sub(l),d.sub(u),p.sub(u);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(h).multiplyScalar(p.y).addScaledVector(c,-d.y).multiplyScalar(s),m.copy(c).multiplyScalar(d.x).addScaledVector(h,-p.x).multiplyScalar(s),a[t].add(f),a[e].add(f),a[i].add(f),o[t].add(m),o[e].add(m),o[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(let w=0,T=v.length;w<T;++w){const e=v[w],n=e.start;for(let i=n,r=n+e.count;i<r;i+=3)g(t.getX(i+0),t.getX(i+1),t.getX(i+2))}const y=new Pn,x=new Pn,b=new Pn,_=new Pn;function S(t){b.fromBufferAttribute(i,t),_.copy(b);const e=a[t];y.copy(e),y.sub(b.multiplyScalar(b.dot(e))).normalize(),x.crossVectors(_,e);const n=x.dot(o[t])<0?-1:1;s.setXYZW(t,y.x,y.y,y.z,n)}for(let w=0,T=v.length;w<T;++w){const e=v[w],n=e.start;for(let i=n,r=n+e.count;i<r;i+=3)S(t.getX(i+0)),S(t.getX(i+1)),S(t.getX(i+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new ar(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Pn,r=new Pn,s=new Pn,a=new Pn,o=new Pn,l=new Pn,h=new Pn,c=new Pn;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),h.subVectors(s,r),c.subVectors(i,r),h.cross(c),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(h),o.add(h),l.add(h),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,u=e.count;t<u;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),h.subVectors(s,r),c.subVectors(i,r),h.cross(c),n.setXYZ(t+0,h.x,h.y,h.z),n.setXYZ(t+1,h.x,h.y,h.z),n.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)gr.fromBufferAttribute(t,e),gr.normalize(),t.setXYZ(e,gr.x,gr.y,gr.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let a=0,o=0;for(let l=0,h=e.length;l<h;l++){a=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*i;for(let t=0;t<i;t++)s[o++]=n[a++]}return new ar(s,i,r)}if(null===this.index)return this;const e=new vr,n=this.index.array,i=this.attributes;for(const a in i){const r=t(i[a],n);e.setAttribute(a,r)}const r=this.morphAttributes;for(const a in r){const i=[],s=r[a];for(let e=0,r=s.length;e<r;e++){const r=t(s[e],n);i.push(r)}e.morphAttributes[a]=i}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,o=s.length;a<o;a++){const t=s[a];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const o in n){const e=n[o];t.data.attributes[o]=e.toJSON(t.data)}const i={};let r=!1;for(const o in this.morphAttributes){const e=this.morphAttributes[o],n=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];n.push(r.toJSON(t.data))}n.length>0&&(i[o]=n,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const l in i){const t=i[l];this.setAttribute(l,t.clone(e))}const r=t.morphAttributes;for(const l in r){const t=[],n=r[l];for(let i=0,r=n.length;i<r;i++)t.push(n[i].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let l=0,h=s.length;l<h;l++){const t=s[l];this.addGroup(t.start,t.count,t.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const yr=new si,xr=new ri,br=new Jn,_r=new Pn,Sr=new Pn,wr=new Pn,Tr=new Pn,Mr=new Pn,Ar=new Pn,Er=new Qe,Cr=new Qe,Pr=new Qe,Rr=new Pn,Ir=new Pn,Or=new Pn,Dr=new Pn,Br=new Pn;let Fr=class extends Oi{constructor(t=new vr,e=new Qi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(r&&a){Ar.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(Mr.fromBufferAttribute(o,t),s?Ar.addScaledVector(Mr,i):Ar.addScaledVector(Mr.sub(e),i))}e.add(Ar)}return e}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),br.copy(n.boundingSphere),br.applyMatrix4(r),xr.copy(t.ray).recast(t.near),!1===br.containsPoint(xr.origin)){if(null===xr.intersectSphere(br,_r))return;if(xr.origin.distanceToSquared(_r)>(t.far-t.near)**2)return}yr.copy(r).invert(),xr.copy(t.ray).applyMatrix4(yr),null!==n.boundingBox&&!1===xr.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,xr)}}_computeIntersections(t,e,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,h=r.attributes.uv1,c=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(s))for(let p=0,f=u.length;p<f;p++){const r=u[p],o=s[r.materialIndex];for(let s=Math.max(r.start,d.start),u=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));s<u;s+=3){i=Lr(this,o,t,n,l,h,c,a.getX(s),a.getX(s+1),a.getX(s+2)),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=r.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3){i=Lr(this,s,t,n,l,h,c,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}else if(void 0!==o)if(Array.isArray(s))for(let p=0,f=u.length;p<f;p++){const r=u[p],a=s[r.materialIndex];for(let s=Math.max(r.start,d.start),u=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));s<u;s+=3){i=Lr(this,a,t,n,l,h,c,s,s+1,s+2),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=r.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3){i=Lr(this,s,t,n,l,h,c,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}}};function Lr(t,e,n,i,r,s,a,o,l,h){t.getVertexPosition(o,Sr),t.getVertexPosition(l,wr),t.getVertexPosition(h,Tr);const c=function(t,e,n,i,r,s,a,o){let l;if(l=1===e.side?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,0===e.side,o),null===l)return null;Br.copy(o),Br.applyMatrix4(t.matrixWorld);const h=n.ray.origin.distanceTo(Br);return h<n.near||h>n.far?null:{distance:h,point:Br.clone(),object:t}}(t,e,n,i,Sr,wr,Tr,Dr);if(c){r&&(Er.fromBufferAttribute(r,o),Cr.fromBufferAttribute(r,l),Pr.fromBufferAttribute(r,h),c.uv=Vi.getInterpolation(Dr,Sr,wr,Tr,Er,Cr,Pr,new Qe)),s&&(Er.fromBufferAttribute(s,o),Cr.fromBufferAttribute(s,l),Pr.fromBufferAttribute(s,h),c.uv1=Vi.getInterpolation(Dr,Sr,wr,Tr,Er,Cr,Pr,new Qe)),a&&(Rr.fromBufferAttribute(a,o),Ir.fromBufferAttribute(a,l),Or.fromBufferAttribute(a,h),c.normal=Vi.getInterpolation(Dr,Sr,wr,Tr,Rr,Ir,Or,new Pn),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const t={a:o,b:l,c:h,normal:new Pn,materialIndex:0};Vi.getNormal(Sr,wr,Tr,t.normal),c.face=t}return c}class Ur extends vr{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],h=[],c=[];let u=0,d=0;function p(t,e,n,i,r,s,p,f,m,g,v){const y=s/m,x=p/g,b=s/2,_=p/2,S=f/2,w=m+1,T=g+1;let M=0,A=0;const E=new Pn;for(let a=0;a<T;a++){const s=a*x-_;for(let o=0;o<w;o++){const u=o*y-b;E[t]=u*i,E[e]=s*r,E[n]=S,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[n]=f>0?1:-1,h.push(E.x,E.y,E.z),c.push(o/m),c.push(1-a/g),M+=1}}for(let a=0;a<g;a++)for(let t=0;t<m;t++){const e=u+t+w*a,n=u+t+w*(a+1),i=u+(t+1)+w*(a+1),r=u+(t+1)+w*a;o.push(e,n,r),o.push(n,i,r),A+=6}a.addGroup(d,A,v),d+=A,u+=M}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new hr(l,3)),this.setAttribute("normal",new hr(h,3)),this.setAttribute("uv",new hr(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ur(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function kr(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?e[n][i]=null:e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Nr(t){const e={};for(let n=0;n<t.length;n++){const i=kr(t[n]);for(const t in i)e[t]=i[t]}return e}function zr(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:pn.workingColorSpace}const Gr={clone:kr,merge:Nr};class Hr extends Zi{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=kr(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}let Vr=class extends Oi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new si,this.projectionMatrix=new si,this.projectionMatrixInverse=new si,this.coordinateSystem=ke}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}};const Xr=new Pn,Wr=new Qe,jr=new Qe;let Yr=class extends Vr{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Xe*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Ve*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Xe*Math.atan(Math.tan(.5*Ve*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Xr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Xr.x,Xr.y).multiplyScalar(-t/Xr.z),Xr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Xr.x,Xr.y).multiplyScalar(-t/Xr.z)}getViewSize(t,e){return this.getViewBounds(t,Wr,jr),e.subVectors(jr,Wr)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Ve*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/a,i*=s.width/t,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const qr=-90;class Kr extends Oi{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Yr(qr,1,t,e);i.layers=this.layers,this.add(i);const r=new Yr(qr,1,t,e);r.layers=this.layers,this.add(r);const s=new Yr(qr,1,t,e);s.layers=this.layers,this.add(s);const a=new Yr(qr,1,t,e);a.layers=this.layers,this.add(a);const o=new Yr(qr,1,t,e);o.layers=this.layers,this.add(o);const l=new Yr(qr,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,r,s,a,o]=e;for(const l of e)this.remove(l);if(t===ke)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(t!==Ne)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const l of e)this.add(l),l.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,l,h]=this.children,c=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,r),t.setRenderTarget(n,1,i),t.render(e,s),t.setRenderTarget(n,2,i),t.render(e,a),t.setRenderTarget(n,3,i),t.render(e,o),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,i),t.render(e,h),t.setRenderTarget(c,u,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Jr extends Sn{constructor(t,e,n,i,r,s,a,o,l,h){super(t=void 0!==t?t:[],e=void 0!==e?e:Q,n,i,r,s,a,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Zr extends Mn{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new Jr(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:ht}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Ur(5,5,5),r=new Hr({name:"CubemapFromEquirect",uniforms:kr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const s=new Fr(i,r),a=e.minFilter;e.minFilter===ut&&(e.minFilter=ht);return new Kr(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,n,i);t.setRenderTarget(r)}}const Qr=new Pn,$r=new Pn,ts=new $e;let es=class{constructor(t=new Pn(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=Qr.subVectors(n,e).cross($r.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(Qr),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||ts.getNormalMatrix(t),i=this.coplanarPoint(Qr).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}};const ns=new Jn,is=new Pn;class rs{constructor(t=new es,e=new es,n=new es,i=new es,r=new es,s=new es){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,i=t.elements,r=i[0],s=i[1],a=i[2],o=i[3],l=i[4],h=i[5],c=i[6],u=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],x=i[15];if(n[0].setComponents(o-r,u-l,m-d,x-g).normalize(),n[1].setComponents(o+r,u+l,m+d,x+g).normalize(),n[2].setComponents(o+s,u+h,m+p,x+v).normalize(),n[3].setComponents(o-s,u-h,m-p,x-v).normalize(),n[4].setComponents(o-a,u-c,m-f,x-y).normalize(),e===ke)n[5].setComponents(o+a,u+c,m+f,x+y).normalize();else{if(e!==Ne)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(a,c,f,y).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),ns.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),ns.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(ns)}intersectsSprite(t){return ns.center.set(0,0,0),ns.radius=.7071067811865476,ns.applyMatrix4(t.matrixWorld),this.intersectsSphere(ns)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let r=0;r<6;r++){if(e[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(is.x=i.normal.x>0?t.max.x:t.min.x,is.y=i.normal.y>0?t.max.y:t.min.y,is.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(is)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function ss(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function as(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=e.get(n);i&&(t.deleteBuffer(i.buffer),e.delete(n))},update:function(n,i){if(n.isGLBufferAttribute){const t=e.get(n);return void((!t||t.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}n.isInterleavedBufferAttribute&&(n=n.data);const r=e.get(n);if(void 0===r)e.set(n,function(e,n){const i=e.array,r=e.usage,s=i.byteLength,a=t.createBuffer();let o;if(t.bindBuffer(n,a),t.bufferData(n,i,r),e.onUploadCallback(),i instanceof Float32Array)o=t.FLOAT;else if(i instanceof Uint16Array)o=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=t.SHORT;else if(i instanceof Uint32Array)o=t.UNSIGNED_INT;else if(i instanceof Int32Array)o=t.INT;else if(i instanceof Int8Array)o=t.BYTE;else if(i instanceof Uint8Array)o=t.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=t.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,size:s}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,i){const r=n.array,s=n._updateRange,a=n.updateRanges;if(t.bindBuffer(i,e),-1===s.count&&0===a.length&&t.bufferSubData(i,0,r),0!==a.length){for(let e=0,n=a.length;e<n;e++){const n=a[e];t.bufferSubData(i,n.start*r.BYTES_PER_ELEMENT,r,n.start,n.count)}n.clearUpdateRanges()}-1!==s.count&&(t.bufferSubData(i,s.offset*r.BYTES_PER_ELEMENT,r,s.offset,s.count),s.count=-1),n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}let os=class t extends vr{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,a=Math.floor(n),o=Math.floor(i),l=a+1,h=o+1,c=t/a,u=e/o,d=[],p=[],f=[],m=[];for(let g=0;g<h;g++){const t=g*u-s;for(let e=0;e<l;e++){const n=e*c-r;p.push(n,-t,0),f.push(0,0,1),m.push(e/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let t=0;t<a;t++){const e=t+l*g,n=t+l*(g+1),i=t+1+l*(g+1),r=t+1+l*g;d.push(e,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new hr(p,3)),this.setAttribute("normal",new hr(f,3)),this.setAttribute("uv",new hr(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(e){return new t(e.width,e.height,e.widthSegments,e.heightSegments)}};const ls={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( batchId );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},hs={common:{diffuse:{value:new qi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new $e},alphaMap:{value:null},alphaMapTransform:{value:new $e},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new $e}},envmap:{envMap:{value:null},envMapRotation:{value:new $e},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new $e}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new $e}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new $e},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new $e},normalScale:{value:new Qe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new $e},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new $e}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new $e}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new $e}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new qi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new qi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new $e},alphaTest:{value:0},uvTransform:{value:new $e}},sprite:{diffuse:{value:new qi(16777215)},opacity:{value:1},center:{value:new Qe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new $e},alphaMap:{value:null},alphaMapTransform:{value:new $e},alphaTest:{value:0}}},cs={basic:{uniforms:Nr([hs.common,hs.specularmap,hs.envmap,hs.aomap,hs.lightmap,hs.fog]),vertexShader:ls.meshbasic_vert,fragmentShader:ls.meshbasic_frag},lambert:{uniforms:Nr([hs.common,hs.specularmap,hs.envmap,hs.aomap,hs.lightmap,hs.emissivemap,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.fog,hs.lights,{emissive:{value:new qi(0)}}]),vertexShader:ls.meshlambert_vert,fragmentShader:ls.meshlambert_frag},phong:{uniforms:Nr([hs.common,hs.specularmap,hs.envmap,hs.aomap,hs.lightmap,hs.emissivemap,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.fog,hs.lights,{emissive:{value:new qi(0)},specular:{value:new qi(1118481)},shininess:{value:30}}]),vertexShader:ls.meshphong_vert,fragmentShader:ls.meshphong_frag},standard:{uniforms:Nr([hs.common,hs.envmap,hs.aomap,hs.lightmap,hs.emissivemap,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.roughnessmap,hs.metalnessmap,hs.fog,hs.lights,{emissive:{value:new qi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ls.meshphysical_vert,fragmentShader:ls.meshphysical_frag},toon:{uniforms:Nr([hs.common,hs.aomap,hs.lightmap,hs.emissivemap,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.gradientmap,hs.fog,hs.lights,{emissive:{value:new qi(0)}}]),vertexShader:ls.meshtoon_vert,fragmentShader:ls.meshtoon_frag},matcap:{uniforms:Nr([hs.common,hs.bumpmap,hs.normalmap,hs.displacementmap,hs.fog,{matcap:{value:null}}]),vertexShader:ls.meshmatcap_vert,fragmentShader:ls.meshmatcap_frag},points:{uniforms:Nr([hs.points,hs.fog]),vertexShader:ls.points_vert,fragmentShader:ls.points_frag},dashed:{uniforms:Nr([hs.common,hs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ls.linedashed_vert,fragmentShader:ls.linedashed_frag},depth:{uniforms:Nr([hs.common,hs.displacementmap]),vertexShader:ls.depth_vert,fragmentShader:ls.depth_frag},normal:{uniforms:Nr([hs.common,hs.bumpmap,hs.normalmap,hs.displacementmap,{opacity:{value:1}}]),vertexShader:ls.meshnormal_vert,fragmentShader:ls.meshnormal_frag},sprite:{uniforms:Nr([hs.sprite,hs.fog]),vertexShader:ls.sprite_vert,fragmentShader:ls.sprite_frag},background:{uniforms:{uvTransform:{value:new $e},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ls.background_vert,fragmentShader:ls.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new $e}},vertexShader:ls.backgroundCube_vert,fragmentShader:ls.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ls.cube_vert,fragmentShader:ls.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ls.equirect_vert,fragmentShader:ls.equirect_frag},distanceRGBA:{uniforms:Nr([hs.common,hs.displacementmap,{referencePosition:{value:new Pn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ls.distanceRGBA_vert,fragmentShader:ls.distanceRGBA_frag},shadow:{uniforms:Nr([hs.lights,hs.fog,{color:{value:new qi(0)},opacity:{value:1}}]),vertexShader:ls.shadow_vert,fragmentShader:ls.shadow_frag}};cs.physical={uniforms:Nr([cs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new $e},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new $e},clearcoatNormalScale:{value:new Qe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new $e},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new $e},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new $e},sheen:{value:0},sheenColor:{value:new qi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new $e},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new $e},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new $e},transmissionSamplerSize:{value:new Qe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new $e},attenuationDistance:{value:0},attenuationColor:{value:new qi(0)},specularColor:{value:new qi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new $e},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new $e},anisotropyVector:{value:new Qe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new $e}}]),vertexShader:ls.meshphysical_vert,fragmentShader:ls.meshphysical_frag};const us={r:0,b:0,g:0},ds=new mi,ps=new si;function fs(t,e,n,i,r,s,a){const o=new qi(0);let l,h,c=!0===s?0:1,u=null,d=0,p=null;function f(t){let i=!0===t.isScene?t.background:null;if(i&&i.isTexture){i=(t.backgroundBlurriness>0?n:e).get(i)}return i}function m(e,n){e.getRGB(us,zr(t)),i.buffers.color.setClear(us.r,us.g,us.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),c=e,m(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,m(o,c)},render:function(e){let n=!1;const r=f(e);null===r?m(o,c):r&&r.isColor&&(m(r,1),n=!0);const s=t.xr.getEnvironmentBlendMode();"additive"===s?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===s&&i.buffers.color.setClear(0,0,0,0,a),(t.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))},addToRenderList:function(e,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===nt)?(void 0===h&&(h=new Fr(new Ur(1,1,1),new Hr({name:"BackgroundCubeMaterial",uniforms:kr(cs.backgroundCube.uniforms),vertexShader:cs.backgroundCube.vertexShader,fragmentShader:cs.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(h)),ds.copy(n.backgroundRotation),ds.x*=-1,ds.y*=-1,ds.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(ds.y*=-1,ds.z*=-1),h.material.uniforms.envMap.value=i,h.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,h.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(ps.makeRotationFromEuler(ds)),h.material.toneMapped=pn.getTransfer(i.colorSpace)!==we,u===i&&d===i.version&&p===t.toneMapping||(h.material.needsUpdate=!0,u=i,d=i.version,p=t.toneMapping),h.layers.enableAll(),e.unshift(h,h.geometry,h.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new Fr(new os(2,2),new Hr({name:"BackgroundMaterial",uniforms:kr(cs.background.uniforms),vertexShader:cs.background.vertexShader,fragmentShader:cs.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=pn.getTransfer(i.colorSpace)!==we,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),u===i&&d===i.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=i,d=i.version,p=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null))}}}function ms(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=h(null);let s=r,a=!1;function o(e){return t.bindVertexArray(e)}function l(e){return t.deleteVertexArray(e)}function h(t){const e=[],i=[],r=[];for(let s=0;s<n;s++)e[s]=0,i[s]=0,r[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:r,object:t,attributes:{},index:null}}function c(){const t=s.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function u(t){d(t,0)}function d(e,n){const i=s.newAttributes,r=s.enabledAttributes,a=s.attributeDivisors;i[e]=1,0===r[e]&&(t.enableVertexAttribArray(e),r[e]=1),a[e]!==n&&(t.vertexAttribDivisor(e,n),a[e]=n)}function p(){const e=s.newAttributes,n=s.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function f(e,n,i,r,s,a,o){!0===o?t.vertexAttribIPointer(e,n,i,s,a):t.vertexAttribPointer(e,n,i,r,s,a)}function m(){g(),a=!0,s!==r&&(s=r,o(s.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let v=!1;const y=function(e,n,r){const s=!0===r.wireframe;let a=i[e.id];void 0===a&&(a={},i[e.id]=a);let o=a[n.id];void 0===o&&(o={},a[n.id]=o);let l=o[s];void 0===l&&(l=h(t.createVertexArray()),o[s]=l);return l}(m,l,r);s!==y&&(s=y,o(s.object)),v=function(t,e,n,i){const r=s.attributes,a=e.attributes;let o=0;const l=n.getAttributes();for(const s in l){if(l[s].location>=0){const e=r[s];let n=a[s];if(void 0===n&&("instanceMatrix"===s&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===s&&t.instanceColor&&(n=t.instanceColor)),void 0===e)return!0;if(e.attribute!==n)return!0;if(n&&e.data!==n.data)return!0;o++}}return s.attributesNum!==o||s.index!==i}(n,m,l,g),v&&function(t,e,n,i){const r={},a=e.attributes;let o=0;const l=n.getAttributes();for(const s in l){if(l[s].location>=0){let e=a[s];void 0===e&&("instanceMatrix"===s&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===s&&t.instanceColor&&(e=t.instanceColor));const n={};n.attribute=e,e&&e.data&&(n.data=e.data),r[s]=n,o++}}s.attributes=r,s.attributesNum=o,s.index=i}(n,m,l,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(n,i,r,s){c();const a=s.attributes,o=r.getAttributes(),l=i.defaultAttributeValues;for(const h in o){const i=o[h];if(i.location>=0){let r=a[h];if(void 0===r&&("instanceMatrix"===h&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===h&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const a=r.normalized,o=r.itemSize,l=e.get(r);if(void 0===l)continue;const h=l.buffer,c=l.type,p=l.bytesPerElement,m=c===t.INT||c===t.UNSIGNED_INT||r.gpuType===ft;if(r.isInterleavedBufferAttribute){const e=r.data,l=e.stride,g=r.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)d(i.location+t,e.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<i.locationSize;t++)u(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<i.locationSize;t++)f(i.location+t,o/i.locationSize,c,a,l*p,(g+o/i.locationSize*t)*p,m)}else{if(r.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)d(i.location+t,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let t=0;t<i.locationSize;t++)u(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<i.locationSize;t++)f(i.location+t,o/i.locationSize,c,a,o*p,o/i.locationSize*t*p,m)}}else if(void 0!==l){const e=l[h];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(i.location,e);break;case 3:t.vertexAttrib3fv(i.location,e);break;case 4:t.vertexAttrib4fv(i.location,e);break;default:t.vertexAttrib1fv(i.location,e)}}}}p()}(n,r,l,m),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const t in i){const e=i[t];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete i[t]}},releaseStatesOfGeometry:function(t){if(void 0===i[t.id])return;const e=i[t.id];for(const n in e){const t=e[n];for(const e in t)l(t[e].object),delete t[e];delete e[n]}delete i[t.id]},releaseStatesOfProgram:function(t){for(const e in i){const n=i[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)l(r[t].object),delete r[t];delete n[t.id]}},initAttributes:c,enableAttribute:u,disableUnusedAttributes:p}}function gs(t,e,n){let i;function r(e,r,s){0!==s&&(t.drawArraysInstanced(i,e,r,s),n.update(r,i,s))}this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(t,r,s){if(0===s)return;const a=e.get("WEBGL_multi_draw");if(null===a)for(let e=0;e<s;e++)this.render(t[e],r[e]);else{a.multiDrawArraysWEBGL(i,t,0,r,0,s);let e=0;for(let t=0;t<s;t++)e+=r[t];n.update(e,i,1)}},this.renderMultiDrawInstances=function(t,s,a,o){if(0===a)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<t.length;e++)r(t[e],s[e],o[e]);else{l.multiDrawArraysInstancedWEBGL(i,t,0,s,0,o,0,a);let e=0;for(let t=0;t<a;t++)e+=s[t];for(let t=0;t<o.length;t++)n.update(e,i,o[t])}}}function vs(t,e,n,i){let r;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=void 0!==n.precision?n.precision:"highp";const o=s(a);o!==a&&(a=o);const l=!0===n.logarithmicDepthBuffer,h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,textureFormatReadable:function(e){return e===_t||i.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===vt&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(n!==dt&&i.convert(n)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==gt&&!r)},precision:a,logarithmicDepthBuffer:l,maxTextures:h,maxVertexTextures:c,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:c>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function ys(t){const e=this;let n=null,i=0,r=!1,s=!1;const a=new es,o=new $e,l={value:null,needsUpdate:!1};function h(t,n,i,r){const s=null!==t?t.length:0;let h=null;if(0!==s){if(h=l.value,!0!==r||null===h){const e=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===h||h.length<e)&&(h=new Float32Array(e));for(let n=0,l=i;n!==s;++n,l+=4)a.copy(t[n]).applyMatrix4(r,o),a.normal.toArray(h,l),h[l+3]=a.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==i||r;return r=e,i=t.length,n},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){n=h(t,e,0)},this.setState=function(a,o,c){const u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,f=t.get(a);if(!r||null===u||0===u.length||s&&!p)s?h(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);e.numPlanes=i,e.numIntersection=0}();else{const t=s?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=h(u,o,e,c);for(let i=0;i!==e;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function xs(t){let e=new WeakMap;function n(t,e){return e===tt?t.mapping=Q:e===et&&(t.mapping=$),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===tt||s===et){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new Zr(s.height);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}class bs extends Vr{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,a=i+e,o=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const _s=[.125,.215,.35,.446,.526,.582],Ss=20,ws=new bs,Ts=new qi;let Ms=null,As=0,Es=0,Cs=!1;const Ps=(1+Math.sqrt(5))/2,Rs=1/Ps,Is=[new Pn(-Ps,Rs,0),new Pn(Ps,Rs,0),new Pn(-Rs,0,Ps),new Pn(Rs,0,Ps),new Pn(0,Ps,-Rs),new Pn(0,Ps,Rs),new Pn(-1,1,-1),new Pn(1,1,-1),new Pn(-1,1,1),new Pn(1,1,1)];class Os{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Ms=this._renderer.getRenderTarget(),As=this._renderer.getActiveCubeFace(),Es=this._renderer.getActiveMipmapLevel(),Cs=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Ls(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Fs(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Ms,As,Es),this._renderer.xr.enabled=Cs,t.scissorTest=!1,Bs(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Q||t.mapping===$?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Ms=this._renderer.getRenderTarget(),As=this._renderer.getActiveCubeFace(),Es=this._renderer.getActiveMipmapLevel(),Cs=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:ht,minFilter:ht,generateMipmaps:!1,type:vt,format:_t,colorSpace:xe,depthBuffer:!1},i=Ds(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ds(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const s=t-4+1+_s.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);n.push(s);let o=1/s;a>t-4?o=_s[a-t+4-1]:0===a&&(o=0),i.push(o);const l=1/(s-2),h=-l,c=1+l,u=[h,h,c,h,c,c,h,h,c,c,h,c],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),x=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];v.set(i,f*p*t),y.set(u,m*p*t);const r=[t,t,t,t,t,t];x.set(r,g*p*t)}const b=new vr;b.setAttribute("position",new ar(v,f)),b.setAttribute("uv",new ar(y,m)),b.setAttribute("faceIndex",new ar(x,g)),e.push(b),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(Ss),r=new Pn(0,1,0),s=new Hr({name:"SphericalGaussianBlur",defines:{n:Ss,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Us(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(i,t,e)}return i}_compileMaterial(t){const e=new Fr(this._lodPlanes[0],t);this._renderer.compile(e,ws)}_sceneToCubeUV(t,e,n,i){const r=new Yr(90,1,e,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.toneMapping;o.getClearColor(Ts),o.toneMapping=0,o.autoClear=!1;const c=new Qi({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new Fr(new Ur,c);let d=!1;const p=t.background;p?p.isColor&&(c.color.copy(p),t.background=null,d=!0):(c.color.copy(Ts),d=!0);for(let f=0;f<6;f++){const e=f%3;0===e?(r.up.set(0,s[f],0),r.lookAt(a[f],0,0)):1===e?(r.up.set(0,0,s[f]),r.lookAt(0,a[f],0)):(r.up.set(0,s[f],0),r.lookAt(0,0,a[f]));const n=this._cubeSize;Bs(i,e*n,f>2?n:0,n,n),o.setRenderTarget(i),d&&o.render(u,r),o.render(t,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=h,o.autoClear=l,t.background=p}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===Q||t.mapping===$;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Ls()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Fs());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new Fr(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const a=this._cubeSize;Bs(e,0,0,3*a,2*a),n.setRenderTarget(e),n.render(s,ws)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const e=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=Is[(i-r-1)%Is.length];this._blur(t,r-1,r,e,n)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial,h=new Fr(this._lodPlanes[i],l),c=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):Ss,m=[];let g=0;for(let x=0;x<Ss;++x){const t=x/p,e=Math.exp(-t*t/2);m.push(e),0===x?g+=e:x<f&&(g+=2*e)}for(let x=0;x<m.length;x++)m[x]=m[x]/g;c.envMap.value=t.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===s,a&&(c.poleAxis.value=a);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-n;const y=this._sizeLods[i];Bs(e,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(e),o.render(h,ws)}}function Ds(t,e,n){const i=new Mn(t,e,n);return i.texture.mapping=nt,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Bs(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Fs(){return new Hr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Us(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Ls(){return new Hr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Us(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Us(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function ks(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=s===tt||s===et,o=s===Q||s===$;if(a||o){let s=e.get(r);const l=void 0!==s?s.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new Os(t)),s=a?n.fromEquirectangular(r,s):n.fromCubemap(r,s),s.texture.pmremVersion=r.pmremVersion,e.set(r,s),s.texture;if(void 0!==s)return s.texture;{const l=r.image;return a&&l&&l.height>0||o&&l&&function(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}(l)?(null===n&&(n=new Os(t)),s=a?n.fromEquirectangular(r):n.fromCubemap(r),s.texture.pmremVersion=r.pmremVersion,e.set(r,s),r.addEventListener("dispose",i),s.texture):null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ns(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(t){const e=n(t);return null===e&&ln("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function zs(t,e,n,i){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const n in o.attributes)e.remove(o.attributes[n]);for(const n in o.morphAttributes){const t=o.morphAttributes[n];for(let n=0,i=t.length;n<i;n++)e.remove(t[n])}o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(t){const n=[],i=t.index,r=t.attributes.position;let a=0;if(null!==i){const t=i.array;a=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const t=r.array;a=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}}const o=new(en(n)?lr:or)(n,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,n.memory.geometries++),e},update:function(n){const i=n.attributes;for(const s in i)e.update(i[s],t.ARRAY_BUFFER);const r=n.morphAttributes;for(const s in r){const n=r[s];for(let i=0,r=n.length;i<r;i++)e.update(n[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&o(t)}else o(t);return s.get(t)}}}function Gs(t,e,n){let i,r,s;function a(e,a,o){0!==o&&(t.drawElementsInstanced(i,a,r,e*s,o),n.update(a,i,o))}this.setMode=function(t){i=t},this.setIndex=function(t){r=t.type,s=t.bytesPerElement},this.render=function(e,a){t.drawElements(i,a,r,e*s),n.update(a,i,1)},this.renderInstances=a,this.renderMultiDraw=function(t,a,o){if(0===o)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<o;e++)this.render(t[e]/s,a[e]);else{l.multiDrawElementsWEBGL(i,a,0,r,t,0,o);let e=0;for(let t=0;t<o;t++)e+=a[t];n.update(e,i,1)}},this.renderMultiDrawInstances=function(t,o,l,h){if(0===l)return;const c=e.get("WEBGL_multi_draw");if(null===c)for(let e=0;e<t.length;e++)a(t[e]/s,o[e],h[e]);else{c.multiDrawElementsInstancedWEBGL(i,o,0,r,t,0,h,0,l);let e=0;for(let t=0;t<l;t++)e+=o[t];for(let t=0;t<h.length;t++)n.update(e,i,h[t])}}}function Hs(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,i,r){switch(e.calls++,i){case t.TRIANGLES:e.triangles+=r*(n/3);break;case t.LINES:e.lines+=r*(n/2);break;case t.LINE_STRIP:e.lines+=r*(n-1);break;case t.LINE_LOOP:e.lines+=r*n;break;case t.POINTS:e.points+=r*n}}}}function Vs(t,e,n){const i=new WeakMap,r=new wn;return{update:function(s,a,o){const l=s.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,c=void 0!==h?h.length:0;let u=i.get(a);if(void 0===u||u.count!==c){let t=function(){v.dispose(),i.delete(a),a.removeEventListener("dispose",t)};void 0!==u&&u.texture.dispose();const n=void 0!==a.morphAttributes.position,s=void 0!==a.morphAttributes.normal,o=void 0!==a.morphAttributes.color,l=a.morphAttributes.position||[],h=a.morphAttributes.normal||[],d=a.morphAttributes.color||[];let p=0;!0===n&&(p=1),!0===s&&(p=2),!0===o&&(p=3);let f=a.attributes.position.count*p,m=1;f>e.maxTextureSize&&(m=Math.ceil(f/e.maxTextureSize),f=e.maxTextureSize);const g=new Float32Array(f*m*4*c),v=new An(g,f,m,c);v.type=gt,v.needsUpdate=!0;const y=4*p;for(let e=0;e<c;e++){const t=l[e],i=h[e],a=d[e],c=f*m*4*e;for(let e=0;e<t.count;e++){const l=e*y;!0===n&&(r.fromBufferAttribute(t,e),g[c+l+0]=r.x,g[c+l+1]=r.y,g[c+l+2]=r.z,g[c+l+3]=0),!0===s&&(r.fromBufferAttribute(i,e),g[c+l+4]=r.x,g[c+l+5]=r.y,g[c+l+6]=r.z,g[c+l+7]=0),!0===o&&(r.fromBufferAttribute(a,e),g[c+l+8]=r.x,g[c+l+9]=r.y,g[c+l+10]=r.z,g[c+l+11]=4===a.itemSize?r.w:1)}}u={count:c,texture:v,size:new Qe(f,m)},i.set(a,u),a.addEventListener("dispose",t)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(t,"morphTexture",s.morphTexture,n);else{let e=0;for(let t=0;t<l.length;t++)e+=l[t];const n=a.morphTargetsRelative?1:1-e;o.getUniforms().setValue(t,"morphTargetBaseInfluence",n),o.getUniforms().setValue(t,"morphTargetInfluences",l)}o.getUniforms().setValue(t,"morphTargetsTexture",u.texture,n),o.getUniforms().setValue(t,"morphTargetsTextureSize",u.size)}}}function Xs(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(a){const o=i.render.frame,l=a.geometry,h=e.get(a,l);if(r.get(h)!==o&&(e.update(h),r.set(h,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,t.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const t=a.skeleton;r.get(t)!==o&&(t.update(),r.set(t,o))}return h},dispose:function(){r=new WeakMap}}}class Ws extends Sn{constructor(t,e,n,i,r,s,a,o,l,h=1026){if(h!==St&&h!==wt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&h===St&&(n=mt),void 0===n&&h===wt&&(n=bt),super(null,i,r,s,a,o,h,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:at,this.minFilter=void 0!==o?o:at,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const js=new Sn,Ys=new Ws(1,1);Ys.compareFunction=515;const qs=new An,Ks=new En,Js=new Jr,Zs=[],Qs=[],$s=new Float32Array(16),ta=new Float32Array(9),ea=new Float32Array(4);function na(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=Zs[r];if(void 0===s&&(s=new Float32Array(r),Zs[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function ia(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function ra(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function sa(t,e){let n=Qs[e];void 0===n&&(n=new Int32Array(e),Qs[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function aa(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function oa(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ia(n,e))return;t.uniform2fv(this.addr,e),ra(n,e)}}function la(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ia(n,e))return;t.uniform3fv(this.addr,e),ra(n,e)}}function ha(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ia(n,e))return;t.uniform4fv(this.addr,e),ra(n,e)}}function ca(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ia(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),ra(n,e)}else{if(ia(n,i))return;ea.set(i),t.uniformMatrix2fv(this.addr,!1,ea),ra(n,i)}}function ua(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ia(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),ra(n,e)}else{if(ia(n,i))return;ta.set(i),t.uniformMatrix3fv(this.addr,!1,ta),ra(n,i)}}function da(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(ia(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),ra(n,e)}else{if(ia(n,i))return;$s.set(i),t.uniformMatrix4fv(this.addr,!1,$s),ra(n,i)}}function pa(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function fa(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ia(n,e))return;t.uniform2iv(this.addr,e),ra(n,e)}}function ma(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(ia(n,e))return;t.uniform3iv(this.addr,e),ra(n,e)}}function ga(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ia(n,e))return;t.uniform4iv(this.addr,e),ra(n,e)}}function va(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function ya(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ia(n,e))return;t.uniform2uiv(this.addr,e),ra(n,e)}}function xa(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(ia(n,e))return;t.uniform3uiv(this.addr,e),ra(n,e)}}function ba(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ia(n,e))return;t.uniform4uiv(this.addr,e),ra(n,e)}}function _a(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r);const s=this.type===t.SAMPLER_2D_SHADOW?Ys:js;n.setTexture2D(e||s,r)}function Sa(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Ks,r)}function wa(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||Js,r)}function Ta(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||qs,r)}function Ma(t,e){t.uniform1fv(this.addr,e)}function Aa(t,e){const n=na(e,this.size,2);t.uniform2fv(this.addr,n)}function Ea(t,e){const n=na(e,this.size,3);t.uniform3fv(this.addr,n)}function Ca(t,e){const n=na(e,this.size,4);t.uniform4fv(this.addr,n)}function Pa(t,e){const n=na(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Ra(t,e){const n=na(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Ia(t,e){const n=na(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Oa(t,e){t.uniform1iv(this.addr,e)}function Da(t,e){t.uniform2iv(this.addr,e)}function Ba(t,e){t.uniform3iv(this.addr,e)}function Fa(t,e){t.uniform4iv(this.addr,e)}function La(t,e){t.uniform1uiv(this.addr,e)}function Ua(t,e){t.uniform2uiv(this.addr,e)}function ka(t,e){t.uniform3uiv(this.addr,e)}function Na(t,e){t.uniform4uiv(this.addr,e)}function za(t,e,n){const i=this.cache,r=e.length,s=sa(n,r);ia(i,s)||(t.uniform1iv(this.addr,s),ra(i,s));for(let a=0;a!==r;++a)n.setTexture2D(e[a]||js,s[a])}function Ga(t,e,n){const i=this.cache,r=e.length,s=sa(n,r);ia(i,s)||(t.uniform1iv(this.addr,s),ra(i,s));for(let a=0;a!==r;++a)n.setTexture3D(e[a]||Ks,s[a])}function Ha(t,e,n){const i=this.cache,r=e.length,s=sa(n,r);ia(i,s)||(t.uniform1iv(this.addr,s),ra(i,s));for(let a=0;a!==r;++a)n.setTextureCube(e[a]||Js,s[a])}function Va(t,e,n){const i=this.cache,r=e.length,s=sa(n,r);ia(i,s)||(t.uniform1iv(this.addr,s),ra(i,s));for(let a=0;a!==r;++a)n.setTexture2DArray(e[a]||qs,s[a])}class Xa{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return aa;case 35664:return oa;case 35665:return la;case 35666:return ha;case 35674:return ca;case 35675:return ua;case 35676:return da;case 5124:case 35670:return pa;case 35667:case 35671:return fa;case 35668:case 35672:return ma;case 35669:case 35673:return ga;case 5125:return va;case 36294:return ya;case 36295:return xa;case 36296:return ba;case 35678:case 36198:case 36298:case 36306:case 35682:return _a;case 35679:case 36299:case 36307:return Sa;case 35680:case 36300:case 36308:case 36293:return wa;case 36289:case 36303:case 36311:case 36292:return Ta}}(e.type)}}class Wa{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ma;case 35664:return Aa;case 35665:return Ea;case 35666:return Ca;case 35674:return Pa;case 35675:return Ra;case 35676:return Ia;case 5124:case 35670:return Oa;case 35667:case 35671:return Da;case 35668:case 35672:return Ba;case 35669:case 35673:return Fa;case 5125:return La;case 36294:return Ua;case 36295:return ka;case 36296:return Na;case 35678:case 36198:case 36298:case 36306:case 35682:return za;case 35679:case 36299:case 36307:return Ga;case 35680:case 36300:case 36308:case 36293:return Ha;case 36289:case 36303:case 36311:case 36292:return Va}}(e.type)}}class ja{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}}}const Ya=/(\w+)(\])?(\[|\.)?/g;function qa(t,e){t.seq.push(e),t.map[e.id]=e}function Ka(t,e,n){const i=t.name,r=i.length;for(Ya.lastIndex=0;;){const s=Ya.exec(i),a=Ya.lastIndex;let o=s[1];const l="]"===s[2],h=s[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===r){qa(n,void 0===h?new Xa(o,t,e):new Wa(o,t,e));break}{let t=n.map[o];void 0===t&&(t=new ja(o),qa(n,t)),n=t}}}class Ja{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);Ka(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function Za(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}let Qa=0;function $a(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let a=r;a<s;a++){const t=a+1;i.push(`${t===e?">":" "} ${t}: ${n[a]}`)}return i.join("\n")}(t.getShaderSource(e),i)}return r}function to(t,e){const n=function(t){const e=pn.getPrimaries(pn.workingColorSpace),n=pn.getPrimaries(t);let i;switch(e===n?i="":e===Me&&n===Te?i="LinearDisplayP3ToLinearSRGB":e===Te&&n===Me&&(i="LinearSRGBToLinearDisplayP3"),t){case xe:case _e:return[i,"LinearTransferOETF"];case ye:case be:return[i,"sRGBTransferOETF"];default:return[i,"LinearTransferOETF"]}}(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function eo(t,e){let n;switch(e){case 1:default:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function no(t){return""!==t}function io(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ro(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const so=/^[ \t]*#include +<([\w\d./]+)>/gm;function ao(t){return t.replace(so,lo)}const oo=new Map;function lo(t,e){let n=ls[e];if(void 0===n){const t=oo.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=ls[t]}return ao(n)}const ho=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function co(t){return t.replace(ho,uo)}function uo(t,e,n,i){let r="";for(let s=parseInt(e);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function po(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function fo(t,e,n,i){const r=t.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),h=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Q:case $:e="ENVMAP_TYPE_CUBE";break;case nt:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),c=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===$&&(e="ENVMAP_MODE_REFRACTION");return e}(n),u=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(no).join("\n")}(n),f=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(no).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(no).join("\n"),v.length>0&&(v+="\n")):(g=[po(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(no).join("\n"),v=[po(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?ls.tonemapping_pars_fragment:"",0!==n.toneMapping?eo("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ls.colorspace_pars_fragment,to("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(no).join("\n")),a=ao(a),a=io(a,n),a=ro(a,n),o=ao(o),o=io(o,n),o=ro(o,n),a=co(a),o=co(o),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===Ue?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Ue?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const x=y+g+a,b=y+v+o,_=Za(r,r.VERTEX_SHADER,x),S=Za(r,r.FRAGMENT_SHADER,b);function w(e){if(t.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(_).trim(),s=r.getShaderInfoLog(S).trim();let a=!0,o=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(a=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(r,m,_,S);else{$a(r,_,"vertex"),$a(r,S,"fragment")}else""!==n||""!==i&&""!==s||(o=!1);o&&(e.diagnostics={runnable:a,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:s,prefix:v}})}r.deleteShader(_),r.deleteShader(S),T=new Ja(r,m),M=function(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let a=1;i.type===t.FLOAT_MAT2&&(a=2),i.type===t.FLOAT_MAT3&&(a=3),i.type===t.FLOAT_MAT4&&(a=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:a}}return n}(r,m)}let T,M;r.attachShader(m,_),r.attachShader(m,S),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===T&&w(this),T},this.getAttributes=function(){return void 0===M&&w(this),M};let A=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===A&&(A=r.getProgramParameter(m,37297)),A},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Qa++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=S,this}let mo=0;class go{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new vo(t),e.set(t,n)),n}}class vo{constructor(t){this.id=mo++,this.code=t,this.usedTimes=0}}function yo(t,e,n,i,r,s,a){const o=new gi,l=new go,h=new Set,c=[],u=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return h.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(s,o,c,g,v){const y=g.fog,x=v.geometry,b=s.isMeshStandardMaterial?g.environment:null,_=(s.isMeshStandardMaterial?n:e).get(s.envMap||b),S=_&&_.mapping===nt?_.image.height:null,w=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),s.precision);const T=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,M=void 0!==T?T.length:0;let A,E,C,P,R=0;if(void 0!==x.morphAttributes.position&&(R=1),void 0!==x.morphAttributes.normal&&(R=2),void 0!==x.morphAttributes.color&&(R=3),w){const t=cs[w];A=t.vertexShader,E=t.fragmentShader}else A=s.vertexShader,E=s.fragmentShader,l.update(s),C=l.getVertexShaderID(s),P=l.getFragmentShaderID(s);const I=t.getRenderTarget(),O=!0===v.isInstancedMesh,D=!0===v.isBatchedMesh,B=!!s.map,F=!!s.matcap,L=!!_,U=!!s.aoMap,k=!!s.lightMap,N=!!s.bumpMap,z=!!s.normalMap,G=!!s.displacementMap,H=!!s.emissiveMap,V=!!s.metalnessMap,X=!!s.roughnessMap,W=s.anisotropy>0,j=s.clearcoat>0,Y=s.dispersion>0,q=s.iridescence>0,K=s.sheen>0,J=s.transmission>0,Z=W&&!!s.anisotropyMap,Q=j&&!!s.clearcoatMap,$=j&&!!s.clearcoatNormalMap,tt=j&&!!s.clearcoatRoughnessMap,et=q&&!!s.iridescenceMap,it=q&&!!s.iridescenceThicknessMap,rt=K&&!!s.sheenColorMap,st=K&&!!s.sheenRoughnessMap,at=!!s.specularMap,ot=!!s.specularColorMap,lt=!!s.specularIntensityMap,ht=J&&!!s.transmissionMap,ct=J&&!!s.thicknessMap,ut=!!s.gradientMap,dt=!!s.alphaMap,pt=s.alphaTest>0,ft=!!s.alphaHash,mt=!!s.extensions;let gt=0;s.toneMapped&&(null!==I&&!0!==I.isXRRenderTarget||(gt=t.toneMapping));const vt={shaderID:w,shaderType:s.type,shaderName:s.name,vertexShader:A,fragmentShader:E,defines:s.defines,customVertexShaderID:C,customFragmentShaderID:P,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:D,batchingColor:D&&null!==v._colorsTexture,instancing:O,instancingColor:O&&null!==v.instanceColor,instancingMorph:O&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===I?t.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:xe,alphaToCoverage:!!s.alphaToCoverage,map:B,matcap:F,envMap:L,envMapMode:L&&_.mapping,envMapCubeUVHeight:S,aoMap:U,lightMap:k,bumpMap:N,normalMap:z,displacementMap:d&&G,emissiveMap:H,normalMapObjectSpace:z&&1===s.normalMapType,normalMapTangentSpace:z&&0===s.normalMapType,metalnessMap:V,roughnessMap:X,anisotropy:W,anisotropyMap:Z,clearcoat:j,clearcoatMap:Q,clearcoatNormalMap:$,clearcoatRoughnessMap:tt,dispersion:Y,iridescence:q,iridescenceMap:et,iridescenceThicknessMap:it,sheen:K,sheenColorMap:rt,sheenRoughnessMap:st,specularMap:at,specularColorMap:ot,specularIntensityMap:lt,transmission:J,transmissionMap:ht,thicknessMap:ct,gradientMap:ut,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:dt,alphaTest:pt,alphaHash:ft,combine:s.combine,mapUv:B&&m(s.map.channel),aoMapUv:U&&m(s.aoMap.channel),lightMapUv:k&&m(s.lightMap.channel),bumpMapUv:N&&m(s.bumpMap.channel),normalMapUv:z&&m(s.normalMap.channel),displacementMapUv:G&&m(s.displacementMap.channel),emissiveMapUv:H&&m(s.emissiveMap.channel),metalnessMapUv:V&&m(s.metalnessMap.channel),roughnessMapUv:X&&m(s.roughnessMap.channel),anisotropyMapUv:Z&&m(s.anisotropyMap.channel),clearcoatMapUv:Q&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:$&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:tt&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:et&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:it&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:rt&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:st&&m(s.sheenRoughnessMap.channel),specularMapUv:at&&m(s.specularMap.channel),specularColorMapUv:ot&&m(s.specularColorMap.channel),specularIntensityMapUv:lt&&m(s.specularIntensityMap.channel),transmissionMapUv:ht&&m(s.transmissionMap.channel),thicknessMapUv:ct&&m(s.thicknessMap.channel),alphaMapUv:dt&&m(s.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(z||W),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!x.attributes.uv&&(B||dt),fog:!!y,useFog:!0===s.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:M,morphTextureStride:R,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:gt,decodeVideoTexture:B&&!0===s.map.isVideoTexture&&pn.getTransfer(s.map.colorSpace)===we,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:mt&&!0===s.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:mt&&!0===s.extensions.multiDraw&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return vt.vertexUv1s=h.has(1),vt.vertexUv2s=h.has(2),vt.vertexUv3s=h.has(3),h.clear(),vt},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){o.disableAll(),e.supportsVertexTextures&&o.enable(0);e.instancing&&o.enable(1);e.instancingColor&&o.enable(2);e.instancingMorph&&o.enable(3);e.matcap&&o.enable(4);e.envMap&&o.enable(5);e.normalMapObjectSpace&&o.enable(6);e.normalMapTangentSpace&&o.enable(7);e.clearcoat&&o.enable(8);e.iridescence&&o.enable(9);e.alphaTest&&o.enable(10);e.vertexColors&&o.enable(11);e.vertexAlphas&&o.enable(12);e.vertexUv1s&&o.enable(13);e.vertexUv2s&&o.enable(14);e.vertexUv3s&&o.enable(15);e.vertexTangents&&o.enable(16);e.anisotropy&&o.enable(17);e.alphaHash&&o.enable(18);e.batching&&o.enable(19);e.dispersion&&o.enable(20);e.batchingColor&&o.enable(21);t.push(o.mask),o.disableAll(),e.fog&&o.enable(0);e.useFog&&o.enable(1);e.flatShading&&o.enable(2);e.logarithmicDepthBuffer&&o.enable(3);e.skinning&&o.enable(4);e.morphTargets&&o.enable(5);e.morphNormals&&o.enable(6);e.morphColors&&o.enable(7);e.premultipliedAlpha&&o.enable(8);e.shadowMapEnabled&&o.enable(9);e.doubleSided&&o.enable(10);e.flipSided&&o.enable(11);e.useDepthPacking&&o.enable(12);e.dithering&&o.enable(13);e.transmission&&o.enable(14);e.sheen&&o.enable(15);e.opaque&&o.enable(16);e.pointsUvs&&o.enable(17);e.decodeVideoTexture&&o.enable(18);e.alphaToCoverage&&o.enable(19);t.push(o.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=cs[e];n=Gr.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,r=c.length;t<r;t++){const e=c[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new fo(t,n,e,s),c.push(i)),i},releaseProgram:function(t){if(0===--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:c,dispose:function(){l.dispose()}}}function xo(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function bo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function _o(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function So(){const t=[];let e=0;const n=[],i=[],r=[];function s(n,i,r,s,a,o){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,a,o,l,h){const c=s(t,e,a,o,l,h);a.transmission>0?i.push(c):!0===a.transparent?r.push(c):n.push(c)},unshift:function(t,e,a,o,l,h){const c=s(t,e,a,o,l,h);a.transmission>0?i.unshift(c):!0===a.transparent?r.unshift(c):n.unshift(c)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||bo),i.length>1&&i.sort(e||_o),r.length>1&&r.sort(e||_o)}}}function wo(){let t=new WeakMap;return{get:function(e,n){const i=t.get(e);let r;return void 0===i?(r=new So,t.set(e,[r])):n>=i.length?(r=new So,i.push(r)):r=i[n],r},dispose:function(){t=new WeakMap}}}function To(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Pn,color:new qi};break;case"SpotLight":n={position:new Pn,direction:new Pn,color:new qi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Pn,color:new qi,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Pn,skyColor:new qi,groundColor:new qi};break;case"RectAreaLight":n={color:new qi,position:new Pn,halfWidth:new Pn,halfHeight:new Pn}}return t[e.id]=n,n}}}let Mo=0;function Ao(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Eo(t){const e=new To,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qe};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qe,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)i.probe.push(new Pn);const r=new Pn,s=new si,a=new si;return{setup:function(r){let s=0,a=0,o=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let l=0,h=0,c=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0;r.sort(Ao);for(let t=0,b=r.length;t<b;t++){const x=r[t],b=x.color,_=x.intensity,S=x.distance,w=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)s+=b.r*_,a+=b.g*_,o+=b.b*_;else if(x.isLightProbe){for(let t=0;t<9;t++)i.probe[t].addScaledVector(x.sh.coefficients[t],_);y++}else if(x.isDirectionalLight){const t=e.get(x);if(t.color.copy(x.color).multiplyScalar(x.intensity),x.castShadow){const t=x.shadow,e=n.get(x);e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,i.directionalShadow[l]=e,i.directionalShadowMap[l]=w,i.directionalShadowMatrix[l]=x.shadow.matrix,p++}i.directional[l]=t,l++}else if(x.isSpotLight){const t=e.get(x);t.position.setFromMatrixPosition(x.matrixWorld),t.color.copy(b).multiplyScalar(_),t.distance=S,t.coneCos=Math.cos(x.angle),t.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),t.decay=x.decay,i.spot[c]=t;const r=x.shadow;if(x.map&&(i.spotLightMap[g]=x.map,g++,r.updateMatrices(x),x.castShadow&&v++),i.spotLightMatrix[c]=r.matrix,x.castShadow){const t=n.get(x);t.shadowBias=r.bias,t.shadowNormalBias=r.normalBias,t.shadowRadius=r.radius,t.shadowMapSize=r.mapSize,i.spotShadow[c]=t,i.spotShadowMap[c]=w,m++}c++}else if(x.isRectAreaLight){const t=e.get(x);t.color.copy(b).multiplyScalar(_),t.halfWidth.set(.5*x.width,0,0),t.halfHeight.set(0,.5*x.height,0),i.rectArea[u]=t,u++}else if(x.isPointLight){const t=e.get(x);if(t.color.copy(x.color).multiplyScalar(x.intensity),t.distance=x.distance,t.decay=x.decay,x.castShadow){const t=x.shadow,e=n.get(x);e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,i.pointShadow[h]=e,i.pointShadowMap[h]=w,i.pointShadowMatrix[h]=x.shadow.matrix,f++}i.point[h]=t,h++}else if(x.isHemisphereLight){const t=e.get(x);t.skyColor.copy(x.color).multiplyScalar(_),t.groundColor.copy(x.groundColor).multiplyScalar(_),i.hemi[d]=t,d++}}u>0&&(!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=hs.LTC_FLOAT_1,i.rectAreaLTC2=hs.LTC_FLOAT_2):(i.rectAreaLTC1=hs.LTC_HALF_1,i.rectAreaLTC2=hs.LTC_HALF_2)),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=o;const x=i.hash;x.directionalLength===l&&x.pointLength===h&&x.spotLength===c&&x.rectAreaLength===u&&x.hemiLength===d&&x.numDirectionalShadows===p&&x.numPointShadows===f&&x.numSpotShadows===m&&x.numSpotMaps===g&&x.numLightProbes===y||(i.directional.length=l,i.spot.length=c,i.rectArea.length=u,i.point.length=h,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-v,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=y,x.directionalLength=l,x.pointLength=h,x.spotLength=c,x.rectAreaLength=u,x.hemiLength=d,x.numDirectionalShadows=p,x.numPointShadows=f,x.numSpotShadows=m,x.numSpotMaps=g,x.numLightProbes=y,i.version=Mo++)},setupView:function(t,e){let n=0,o=0,l=0,h=0,c=0;const u=e.matrixWorldInverse;for(let d=0,p=t.length;d<p;d++){const e=t[d];if(e.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(e.matrixWorld),r.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),n++}else if(e.isSpotLight){const t=i.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(e.matrixWorld),r.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),l++}else if(e.isRectAreaLight){const t=i.rectArea[h];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),a.identity(),s.copy(e.matrixWorld),s.premultiply(u),a.extractRotation(s),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),h++}else if(e.isPointLight){const t=i.point[o];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(u),o++}else if(e.isHemisphereLight){const t=i.hemi[c];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(u),c++}}},state:i}}function Co(t){const e=new Eo(t),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){r.camera=t,n.length=0,i.length=0},state:r,setupLights:function(){e.setup(n)},setupLightsView:function(t){e.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){i.push(t)}}}function Po(t){let e=new WeakMap;return{get:function(n,i=0){const r=e.get(n);let s;return void 0===r?(s=new Co(t),e.set(n,[s])):i>=r.length?(s=new Co(t),r.push(s)):s=r[i],s},dispose:function(){e=new WeakMap}}}class Ro extends Zi{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=me,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Io extends Zi{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Oo(t,e,n){let i=new rs;const r=new Qe,s=new Qe,a=new wn,o=new Ro({depthPacking:ge}),l=new Io,h={},c=n.maxTextureSize,u={[C]:1,[P]:0,[R]:2},d=new Hr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Qe},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new vr;f.setAttribute("position",new ar(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Fr(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function y(n,i){const s=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Mn(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,s,p,m,null)}function x(e,n,i,r){let s=null;const a=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===i.isPointLight?l:o,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=s.uuid,e=n.uuid;let i=h[t];void 0===i&&(i={},h[t]=i);let r=i[e];void 0===r&&(r=s.clone(),i[e]=r,n.addEventListener("dispose",_)),s=r}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial){t.properties.get(s).light=i}return s}function b(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),l=n.material;if(Array.isArray(l)){const e=i.groups;for(let h=0,c=e.length;h<c;h++){const c=e[h],u=l[c.materialIndex];if(u&&u.visible){const e=x(n,u,a,o);n.onBeforeShadow(t,n,r,s,i,e,c),t.renderBufferDirect(s,null,i,e,n,c),n.onAfterShadow(t,n,r,s,i,e,c)}}}else if(l.visible){const e=x(n,l,a,o);n.onBeforeShadow(t,n,r,s,i,e,null),t.renderBufferDirect(s,null,i,e,n,null),n.onAfterShadow(t,n,r,s,i,e,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)b(l[t],r,s,a,o)}function _(t){t.target.removeEventListener("dispose",_);for(const e in h){const n=h[e],i=t.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(e,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=3!==v&&3===this.type,f=3===v&&3!==this.type;for(let m=0,g=e.length;m<g;m++){const l=e[m],h=l.shadow;if(void 0===h)continue;if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const u=h.getFrameExtents();if(r.multiply(u),s.copy(h.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/u.x),r.x=s.x*u.x,h.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/u.y),r.y=s.y*u.y,h.mapSize.y=s.y)),null===h.map||!0===p||!0===f){const t=3!==this.type?{minFilter:at,magFilter:at}:{};null!==h.map&&h.map.dispose(),h.map=new Mn(r.x,r.y,t),h.map.texture.name=l.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const g=h.getViewportCount();for(let t=0;t<g;t++){const e=h.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(a),h.updateMatrices(l,t),i=h.getFrustum(),b(n,o,h.camera,l,this.type)}!0!==h.isPointLightShadow&&3===this.type&&y(h,o),h.needsUpdate=!1}v=this.type,g.needsUpdate=!1,t.setRenderTarget(l,h,u)}}function Do(t){const e=new function(){let e=!1;const n=new wn;let i=null;const r=new wn(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,a,o){!0===o&&(e*=a,i*=a,s*=a),n.set(e,i,s,a),!1===r.equals(n)&&(t.clearColor(e,i,s,a),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},n=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(e){e?it(t.DEPTH_TEST):rt(t.DEPTH_TEST)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},i=new function(){let e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,h=null;return{setTest:function(n){e||(n?it(t.STENCIL_TEST):rt(t.STENCIL_TEST))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,a){i===e&&r===n&&s===a||(t.stencilFunc(e,n,a),i=e,r=n,s=a)},setOp:function(e,n,i){a===e&&o===n&&l===i||(t.stencilOp(e,n,i),a=e,o=n,l=i)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,h=null}}},r=new WeakMap,s=new WeakMap;let a={},o={},l=new WeakMap,h=[],c=null,u=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=new qi(0,0,0),b=0,_=!1,S=null,w=null,T=null,M=null,A=null;const E=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let C=!1,P=0;const R=t.getParameter(t.VERSION);-1!==R.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(R)[1]),C=P>=1):-1!==R.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),C=P>=2);let K=null,J={};const Z=t.getParameter(t.SCISSOR_BOX),Q=t.getParameter(t.VIEWPORT),$=(new wn).fromArray(Z),tt=(new wn).fromArray(Q);function et(e,n,i,r){const s=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let o=0;o<i;o++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(n,0,t.RGBA,1,1,r,0,t.RGBA,t.UNSIGNED_BYTE,s):t.texImage2D(n+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,s);return a}const nt={};function it(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function rt(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}nt[t.TEXTURE_2D]=et(t.TEXTURE_2D,t.TEXTURE_2D,1),nt[t.TEXTURE_CUBE_MAP]=et(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),nt[t.TEXTURE_2D_ARRAY]=et(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),nt[t.TEXTURE_3D]=et(t.TEXTURE_3D,t.TEXTURE_3D,1,1),e.setClear(0,0,0,1),n.setClear(1),i.setClear(0),it(t.DEPTH_TEST),n.setFunc(3),lt(!1),ht(1),it(t.CULL_FACE),ot(0);const st={[I]:t.FUNC_ADD,[O]:t.FUNC_SUBTRACT,[D]:t.FUNC_REVERSE_SUBTRACT};st[103]=t.MIN,st[104]=t.MAX;const at={[B]:t.ZERO,[F]:t.ONE,[L]:t.SRC_COLOR,[k]:t.SRC_ALPHA,[X]:t.SRC_ALPHA_SATURATE,[H]:t.DST_COLOR,[z]:t.DST_ALPHA,[U]:t.ONE_MINUS_SRC_COLOR,[N]:t.ONE_MINUS_SRC_ALPHA,[V]:t.ONE_MINUS_DST_COLOR,[G]:t.ONE_MINUS_DST_ALPHA,[W]:t.CONSTANT_COLOR,[j]:t.ONE_MINUS_CONSTANT_COLOR,[Y]:t.CONSTANT_ALPHA,[q]:t.ONE_MINUS_CONSTANT_ALPHA};function ot(e,n,i,r,s,a,o,l,h,c){if(0!==e){if(!1===u&&(it(t.BLEND),u=!0),5===e)s=s||n,a=a||i,o=o||r,n===p&&s===g||(t.blendEquationSeparate(st[n],st[s]),p=n,g=s),i===f&&r===m&&a===v&&o===y||(t.blendFuncSeparate(at[i],at[r],at[a],at[o]),f=i,m=r,v=a,y=o),!1!==l.equals(x)&&h===b||(t.blendColor(l.r,l.g,l.b,h),x.copy(l),b=h),d=e,_=!1;else if(e!==d||c!==_){if(p===I&&g===I||(t.blendEquation(t.FUNC_ADD),p=I,g=I),c)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR)}f=null,m=null,v=null,y=null,x.set(0,0,0),b=0,d=e,_=c}}else!0===u&&(rt(t.BLEND),u=!1)}function lt(e){S!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),S=e)}function ht(e){0!==e?(it(t.CULL_FACE),e!==w&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):rt(t.CULL_FACE),w=e}function ct(e,n,i){e?(it(t.POLYGON_OFFSET_FILL),M===n&&A===i||(t.polygonOffset(n,i),M=n,A=i)):rt(t.POLYGON_OFFSET_FILL)}return{buffers:{color:e,depth:n,stencil:i},enable:it,disable:rt,bindFramebuffer:function(e,n){return o[e]!==n&&(t.bindFramebuffer(e,n),o[e]=n,e===t.DRAW_FRAMEBUFFER&&(o[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(o[t.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(e,n){let i=h,r=!1;if(e){i=l.get(n),void 0===i&&(i=[],l.set(n,i));const s=e.textures;if(i.length!==s.length||i[0]!==t.COLOR_ATTACHMENT0){for(let e=0,n=s.length;e<n;e++)i[e]=t.COLOR_ATTACHMENT0+e;i.length=s.length,r=!0}}else i[0]!==t.BACK&&(i[0]=t.BACK,r=!0);r&&t.drawBuffers(i)},useProgram:function(e){return c!==e&&(t.useProgram(e),c=e,!0)},setBlending:ot,setMaterial:function(r,s){2===r.side?rt(t.CULL_FACE):it(t.CULL_FACE);let a=1===r.side;s&&(a=!a),lt(a),1===r.blending&&!1===r.transparent?ot(0):ot(r.blending,r.blendEquation,r.blendSrc,r.blendDst,r.blendEquationAlpha,r.blendSrcAlpha,r.blendDstAlpha,r.blendColor,r.blendAlpha,r.premultipliedAlpha),n.setFunc(r.depthFunc),n.setTest(r.depthTest),n.setMask(r.depthWrite),e.setMask(r.colorWrite);const o=r.stencilWrite;i.setTest(o),o&&(i.setMask(r.stencilWriteMask),i.setFunc(r.stencilFunc,r.stencilRef,r.stencilFuncMask),i.setOp(r.stencilFail,r.stencilZFail,r.stencilZPass)),ct(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),!0===r.alphaToCoverage?it(t.SAMPLE_ALPHA_TO_COVERAGE):rt(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:lt,setCullFace:ht,setLineWidth:function(e){e!==T&&(C&&t.lineWidth(e),T=e)},setPolygonOffset:ct,setScissorTest:function(e){e?it(t.SCISSOR_TEST):rt(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+E-1),K!==e&&(t.activeTexture(e),K=e)},bindTexture:function(e,n,i){void 0===i&&(i=null===K?t.TEXTURE0+E-1:K);let r=J[i];void 0===r&&(r={type:void 0,texture:void 0},J[i]=r),r.type===e&&r.texture===n||(K!==i&&(t.activeTexture(i),K=i),t.bindTexture(e,n||nt[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=J[K];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(e){}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(e){}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(e){}},updateUBOMapping:function(e,n){let i=s.get(n);void 0===i&&(i=new WeakMap,s.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))},uniformBlockBinding:function(e,n){const i=s.get(n).get(e);r.get(n)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),r.set(n,i))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(e){}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(e){}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(e){}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(e){}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(e){}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(e){}},scissor:function(e){!1===$.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),$.copy(e))},viewport:function(e){!1===tt.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),tt.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},K=null,J={},o={},l=new WeakMap,h=[],c=null,u=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=new qi(0,0,0),b=0,_=!1,S=null,w=null,T=null,M=null,A=null,$.set(0,0,t.canvas.width,t.canvas.height),tt.set(0,0,t.canvas.width,t.canvas.height),e.reset(),n.reset(),i.reset()}}}function Bo(t,e,n,i,r,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),h=new Qe,c=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(G){}function f(t,e){return p?new OffscreenCanvas(t,e):sn("canvas")}function m(t,e,n){let i=1;const r=z(t);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const n=Math.floor(i*r.width),s=Math.floor(i*r.height);void 0===u&&(u=f(n,s));const a=e?f(n,s):u;a.width=n,a.height=s;return a.getContext("2d").drawImage(t,0,0,n,s),a}return t}return t}function g(t){return t.generateMipmaps&&t.minFilter!==at&&t.minFilter!==ht}function v(e){t.generateMipmap(e)}function y(n,i,r,s,a=!1){if(null!==n&&void 0!==t[n])return t[n];let o=i;if(i===t.RED&&(r===t.FLOAT&&(o=t.R32F),r===t.HALF_FLOAT&&(o=t.R16F),r===t.UNSIGNED_BYTE&&(o=t.R8)),i===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(o=t.R8UI),r===t.UNSIGNED_SHORT&&(o=t.R16UI),r===t.UNSIGNED_INT&&(o=t.R32UI),r===t.BYTE&&(o=t.R8I),r===t.SHORT&&(o=t.R16I),r===t.INT&&(o=t.R32I)),i===t.RG&&(r===t.FLOAT&&(o=t.RG32F),r===t.HALF_FLOAT&&(o=t.RG16F),r===t.UNSIGNED_BYTE&&(o=t.RG8)),i===t.RG_INTEGER&&(r===t.UNSIGNED_BYTE&&(o=t.RG8UI),r===t.UNSIGNED_SHORT&&(o=t.RG16UI),r===t.UNSIGNED_INT&&(o=t.RG32UI),r===t.BYTE&&(o=t.RG8I),r===t.SHORT&&(o=t.RG16I),r===t.INT&&(o=t.RG32I)),i===t.RGB&&r===t.UNSIGNED_INT_5_9_9_9_REV&&(o=t.RGB9_E5),i===t.RGBA){const e=a?Se:pn.getTransfer(s);r===t.FLOAT&&(o=t.RGBA32F),r===t.HALF_FLOAT&&(o=t.RGBA16F),r===t.UNSIGNED_BYTE&&(o=e===we?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(o=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(o=t.RGB5_A1)}return o!==t.R16F&&o!==t.R32F&&o!==t.RG16F&&o!==t.RG32F&&o!==t.RGBA16F&&o!==t.RGBA32F||e.get("EXT_color_buffer_float"),o}function x(e,n){let i;return e?null===n||n===mt||n===bt?i=t.DEPTH24_STENCIL8:n===gt?i=t.DEPTH32F_STENCIL8:n===pt&&(i=t.DEPTH24_STENCIL8):null===n||n===mt||n===bt?i=t.DEPTH_COMPONENT24:n===gt?i=t.DEPTH_COMPONENT32F:n===pt&&(i=t.DEPTH_COMPONENT16),i}function b(t,e){return!0===g(t)||t.isFramebufferTexture&&t.minFilter!==at&&t.minFilter!==ht?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function _(t){const e=t.target;e.removeEventListener("dispose",_),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=d.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&w(t),0===Object.keys(r).length&&d.delete(n)}i.remove(t)}(e),e.isVideoTexture&&c.delete(e)}function S(e){const n=e.target;n.removeEventListener("dispose",S),function(e){const n=i.get(e);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let e=0;e<n.__webglFramebuffer[i].length;e++)t.deleteFramebuffer(n.__webglFramebuffer[i][e]);else t.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=e.textures;for(let s=0,o=r.length;s<o;s++){const e=i.get(r[s]);e.__webglTexture&&(t.deleteTexture(e.__webglTexture),a.memory.textures--),i.remove(r[s])}i.remove(e)}(n)}function w(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete d.get(r)[n.__cacheKey],a.memory.textures--}let T=0;function M(e,r){const s=i.get(e);if(e.isVideoTexture&&function(t){const e=a.render.frame;c.get(t)!==e&&(c.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t);else if(!1!==t.complete)return void I(s,e,r)}n.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+r)}const A={[it]:t.REPEAT,[rt]:t.CLAMP_TO_EDGE,[st]:t.MIRRORED_REPEAT},E={[at]:t.NEAREST,[ot]:t.NEAREST_MIPMAP_NEAREST,[lt]:t.NEAREST_MIPMAP_LINEAR,[ht]:t.LINEAR,[ct]:t.LINEAR_MIPMAP_NEAREST,[ut]:t.LINEAR_MIPMAP_LINEAR},C={[Ee]:t.NEVER,[Be]:t.ALWAYS,[Ce]:t.LESS,[Re]:t.LEQUAL,[Pe]:t.EQUAL,[De]:t.GEQUAL,[Ie]:t.GREATER,[Oe]:t.NOTEQUAL};function P(n,s){if(s.type===gt&&!1===e.has("OES_texture_float_linear")&&(s.magFilter===ht||s.magFilter===ct||s.magFilter===lt||s.magFilter===ut||s.minFilter===ht||s.minFilter===ct||s.minFilter===lt||s.minFilter),t.texParameteri(n,t.TEXTURE_WRAP_S,A[s.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,A[s.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,A[s.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,E[s.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,E[s.minFilter]),s.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,C[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(s.magFilter===at)return;if(s.minFilter!==lt&&s.minFilter!==ut)return;if(s.type===gt&&!1===e.has("OES_texture_float_linear"))return;if(s.anisotropy>1||i.get(s).__currentAnisotropy){const a=e.get("EXT_texture_filter_anisotropic");t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy}}}function R(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",_));const r=n.source;let s=d.get(r);void 0===s&&(s={},d.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&w(n)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return i}function I(e,a,o){let l=t.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),a.isData3DTexture&&(l=t.TEXTURE_3D);const h=R(e,a),c=a.source;n.bindTexture(l,e.__webglTexture,t.TEXTURE0+o);const u=i.get(c);if(c.version!==u.__version||!0===h){n.activeTexture(t.TEXTURE0+o);const e=pn.getPrimaries(pn.workingColorSpace),i=a.colorSpace===ve?null:pn.getPrimaries(a.colorSpace),d=a.colorSpace===ve||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(a.image,!1,r.maxTextureSize);p=N(a,p);const f=s.convert(a.format,a.colorSpace),_=s.convert(a.type);let S,w=y(a.internalFormat,f,_,a.colorSpace,a.isVideoTexture);P(l,a);const T=a.mipmaps,M=!0!==a.isVideoTexture,A=void 0===u.__version||!0===h,E=c.dataReady,C=b(a,p);if(a.isDepthTexture)w=x(a.format===wt,a.type),A&&(M?n.texStorage2D(t.TEXTURE_2D,1,w,p.width,p.height):n.texImage2D(t.TEXTURE_2D,0,w,p.width,p.height,0,f,_,null));else if(a.isDataTexture)if(T.length>0){M&&A&&n.texStorage2D(t.TEXTURE_2D,C,w,T[0].width,T[0].height);for(let e=0,i=T.length;e<i;e++)S=T[e],M?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,S.width,S.height,f,_,S.data):n.texImage2D(t.TEXTURE_2D,e,w,S.width,S.height,0,f,_,S.data);a.generateMipmaps=!1}else M?(A&&n.texStorage2D(t.TEXTURE_2D,C,w,p.width,p.height),E&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,p.width,p.height,f,_,p.data)):n.texImage2D(t.TEXTURE_2D,0,w,p.width,p.height,0,f,_,p.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){M&&A&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,w,T[0].width,T[0].height,p.depth);for(let e=0,i=T.length;e<i;e++)if(S=T[e],a.format!==_t){if(null!==f)if(M){if(E)if(a.layerUpdates.size>0){for(const i of a.layerUpdates){const r=S.width*S.height;n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,i,S.width,S.height,1,f,S.data.slice(r*i,r*(i+1)),0,0)}a.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,S.width,S.height,p.depth,f,S.data,0,0)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,w,S.width,S.height,p.depth,0,S.data,0,0)}else M?E&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,S.width,S.height,p.depth,f,_,S.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,w,S.width,S.height,p.depth,0,f,_,S.data)}else{M&&A&&n.texStorage2D(t.TEXTURE_2D,C,w,T[0].width,T[0].height);for(let e=0,i=T.length;e<i;e++)S=T[e],a.format!==_t?null!==f&&(M?E&&n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,S.width,S.height,f,S.data):n.compressedTexImage2D(t.TEXTURE_2D,e,w,S.width,S.height,0,S.data)):M?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,S.width,S.height,f,_,S.data):n.texImage2D(t.TEXTURE_2D,e,w,S.width,S.height,0,f,_,S.data)}else if(a.isDataArrayTexture)if(M){if(A&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,w,p.width,p.height,p.depth),E)if(a.layerUpdates.size>0){let e;switch(_){case t.UNSIGNED_BYTE:switch(f){case t.ALPHA:case t.LUMINANCE:e=1;break;case t.LUMINANCE_ALPHA:e=2;break;case t.RGB:e=3;break;case t.RGBA:e=4;break;default:throw new Error(`Unknown texel size for format ${f}.`)}break;case t.UNSIGNED_SHORT_4_4_4_4:case t.UNSIGNED_SHORT_5_5_5_1:case t.UNSIGNED_SHORT_5_6_5:e=1;break;default:throw new Error(`Unknown texel size for type ${_}.`)}const i=p.width*p.height*e;for(const r of a.layerUpdates)n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,r,p.width,p.height,1,f,_,p.data.slice(i*r,i*(r+1)));a.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,w,p.width,p.height,p.depth,0,f,_,p.data);else if(a.isData3DTexture)M?(A&&n.texStorage3D(t.TEXTURE_3D,C,w,p.width,p.height,p.depth),E&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)):n.texImage3D(t.TEXTURE_3D,0,w,p.width,p.height,p.depth,0,f,_,p.data);else if(a.isFramebufferTexture){if(A)if(M)n.texStorage2D(t.TEXTURE_2D,C,w,p.width,p.height);else{let e=p.width,i=p.height;for(let r=0;r<C;r++)n.texImage2D(t.TEXTURE_2D,r,w,e,i,0,f,_,null),e>>=1,i>>=1}}else if(T.length>0){if(M&&A){const e=z(T[0]);n.texStorage2D(t.TEXTURE_2D,C,w,e.width,e.height)}for(let e=0,i=T.length;e<i;e++)S=T[e],M?E&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,f,_,S):n.texImage2D(t.TEXTURE_2D,e,w,f,_,S);a.generateMipmaps=!1}else if(M){if(A){const e=z(p);n.texStorage2D(t.TEXTURE_2D,C,w,e.width,e.height)}E&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,f,_,p)}else n.texImage2D(t.TEXTURE_2D,0,w,f,_,p);g(a)&&v(l),u.__version=c.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}function O(e,r,a,l,h,c){const u=s.convert(a.format,a.colorSpace),d=s.convert(a.type),p=y(a.internalFormat,u,d,a.colorSpace);if(!i.get(r).__hasExternalTextures){const e=Math.max(1,r.width>>c),i=Math.max(1,r.height>>c);h===t.TEXTURE_3D||h===t.TEXTURE_2D_ARRAY?n.texImage3D(h,c,p,e,i,r.depth,0,u,d,null):n.texImage2D(h,c,p,e,i,0,u,d,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),k(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,l,h,i.get(a).__webglTexture,0,U(r)):(h===t.TEXTURE_2D||h>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&h<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,l,h,i.get(a).__webglTexture,c),n.bindFramebuffer(t.FRAMEBUFFER,null)}function D(e,n,i){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer){const r=n.depthTexture,s=r&&r.isDepthTexture?r.type:null,a=x(n.stencilBuffer,s),l=n.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,h=U(n);k(n)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,h,a,n.width,n.height):i?t.renderbufferStorageMultisample(t.RENDERBUFFER,h,a,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,a,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,l,t.RENDERBUFFER,e)}else{const e=n.textures;for(let r=0;r<e.length;r++){const a=e[r],l=s.convert(a.format,a.colorSpace),h=s.convert(a.type),c=y(a.internalFormat,l,h,a.colorSpace),u=U(n);i&&!1===k(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,c,n.width,n.height):k(n)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,c,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,c,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function B(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),M(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,a=U(r);if(r.depthTexture.format===St)k(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==wt)throw new Error("Unknown depthTexture format");k(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),D(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),D(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}const F=[],L=[];function U(t){return Math.min(r.maxSamples,t.samples)}function k(t){const n=i.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function N(t,e){const n=t.colorSpace;t.format,t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||n!==xe&&n!==ve&&pn.getTransfer(n),e}function z(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(h.width=t.naturalWidth||t.width,h.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(h.width=t.displayWidth,h.height=t.displayHeight):(h.width=t.width,h.height=t.height),h}this.allocateTextureUnit=function(){const t=T;return r.maxTextures,T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=M,this.setTexture2DArray=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?I(s,e,r):n.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+r)},this.setTexture3D=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?I(s,e,r):n.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+r)},this.setTextureCube=function(e,a){const o=i.get(e);e.version>0&&o.__version!==e.version?function(e,a,o){if(6!==a.image.length)return;const l=R(e,a),h=a.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+o);const c=i.get(h);if(h.version!==c.__version||!0===l){n.activeTexture(t.TEXTURE0+o);const e=pn.getPrimaries(pn.workingColorSpace),i=a.colorSpace===ve?null:pn.getPrimaries(a.colorSpace),u=a.colorSpace===ve||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);const d=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?a.image[t].image:a.image[t]:m(a.image[t],!0,r.maxCubemapSize),f[t]=N(a,f[t]);const x=f[0],_=s.convert(a.format,a.colorSpace),S=s.convert(a.type),w=y(a.internalFormat,_,S,a.colorSpace),T=!0!==a.isVideoTexture,M=void 0===c.__version||!0===l,A=h.dataReady;let E,C=b(a,x);if(P(t.TEXTURE_CUBE_MAP,a),d){T&&M&&n.texStorage2D(t.TEXTURE_CUBE_MAP,C,w,x.width,x.height);for(let e=0;e<6;e++){E=f[e].mipmaps;for(let i=0;i<E.length;i++){const r=E[i];a.format!==_t?null!==_&&(T?A&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,_,r.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,w,r.width,r.height,0,r.data)):T?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,_,S,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,w,r.width,r.height,0,_,S,r.data)}}}else{if(E=a.mipmaps,T&&M){E.length>0&&C++;const e=z(f[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,C,w,e.width,e.height)}for(let e=0;e<6;e++)if(p){T?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,_,S,f[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,w,f[e].width,f[e].height,0,_,S,f[e].data);for(let i=0;i<E.length;i++){const r=E[i].image[e].image;T?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,r.width,r.height,_,S,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,w,r.width,r.height,0,_,S,r.data)}}else{T?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,_,S,f[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,w,_,S,f[e]);for(let i=0;i<E.length;i++){const r=E[i];T?A&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,_,S,r.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,w,_,S,r.image[e])}}}g(a)&&v(t.TEXTURE_CUBE_MAP),c.__version=h.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}(o,e,a):n.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture,t.TEXTURE0+a)},this.rebindTextures=function(e,n,r){const s=i.get(e);void 0!==n&&O(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&B(e)},this.setupRenderTarget=function(e){const r=e.texture,o=i.get(e),l=i.get(r);e.addEventListener("dispose",S);const h=e.textures,c=!0===e.isWebGLCubeRenderTarget,u=h.length>1;if(u||(void 0===l.__webglTexture&&(l.__webglTexture=t.createTexture()),l.__version=r.version,a.memory.textures++),c){o.__webglFramebuffer=[];for(let e=0;e<6;e++)if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer[e]=[];for(let n=0;n<r.mipmaps.length;n++)o.__webglFramebuffer[e][n]=t.createFramebuffer()}else o.__webglFramebuffer[e]=t.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer=[];for(let e=0;e<r.mipmaps.length;e++)o.__webglFramebuffer[e]=t.createFramebuffer()}else o.__webglFramebuffer=t.createFramebuffer();if(u)for(let e=0,n=h.length;e<n;e++){const n=i.get(h[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),a.memory.textures++)}if(e.samples>0&&!1===k(e)){o.__webglMultisampledFramebuffer=t.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<h.length;n++){const i=h[n];o.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const r=s.convert(i.format,i.colorSpace),a=s.convert(i.type),l=y(i.internalFormat,r,a,i.colorSpace,!0===e.isXRRenderTarget),c=U(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,c,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,o.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(o.__webglDepthRenderbuffer=t.createRenderbuffer(),D(o.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(c){n.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture),P(t.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)O(o.__webglFramebuffer[n][i],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else O(o.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&v(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(u){for(let r=0,s=h.length;r<s;r++){const s=h[r],a=i.get(s);n.bindTexture(t.TEXTURE_2D,a.__webglTexture),P(t.TEXTURE_2D,s),O(o.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0+r,t.TEXTURE_2D,0),g(s)&&v(t.TEXTURE_2D)}n.unbindTexture()}else{let i=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(i=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),P(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)O(o.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,i,n);else O(o.__webglFramebuffer,e,r,t.COLOR_ATTACHMENT0,i,0);g(r)&&v(i),n.unbindTexture()}e.depthBuffer&&B(e)},this.updateRenderTargetMipmap=function(e){const r=e.textures;for(let s=0,a=r.length;s<a;s++){const a=r[s];if(g(a)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=i.get(a).__webglTexture;n.bindTexture(r,s),v(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===k(e)){const r=e.textures,s=e.width,a=e.height;let o=t.COLOR_BUFFER_BIT;const h=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,c=i.get(e),u=r.length>1;if(u)for(let e=0;e<r.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,c.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let n=0;n<r.length;n++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(o|=t.STENCIL_BUFFER_BIT)),u){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,a,0,0,s,a,o,t.NEAREST),!0===l&&(F.length=0,L.length=0,F.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&!1===e.resolveDepthBuffer&&(F.push(h),L.push(h),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,L)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,F))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),u)for(let e=0;e<r.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,c.__webglColorRenderbuffer[e]);const s=i.get(r[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,c.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&l){const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=B,this.setupFrameBufferTexture=O,this.useMultisampledRTT=k}function Fo(t,e){return{convert:function(n,i=""){let r;const s=pn.getTransfer(i);if(n===dt)return t.UNSIGNED_BYTE;if(n===yt)return t.UNSIGNED_SHORT_4_4_4_4;if(n===xt)return t.UNSIGNED_SHORT_5_5_5_1;if(35902===n)return t.UNSIGNED_INT_5_9_9_9_REV;if(1010===n)return t.BYTE;if(1011===n)return t.SHORT;if(n===pt)return t.UNSIGNED_SHORT;if(n===ft)return t.INT;if(n===mt)return t.UNSIGNED_INT;if(n===gt)return t.FLOAT;if(n===vt)return t.HALF_FLOAT;if(1021===n)return t.ALPHA;if(1022===n)return t.RGB;if(n===_t)return t.RGBA;if(1024===n)return t.LUMINANCE;if(1025===n)return t.LUMINANCE_ALPHA;if(n===St)return t.DEPTH_COMPONENT;if(n===wt)return t.DEPTH_STENCIL;if(n===Tt)return t.RED;if(n===Mt)return t.RED_INTEGER;if(1030===n)return t.RG;if(n===At)return t.RG_INTEGER;if(n===Et)return t.RGBA_INTEGER;if(n===Ct||n===Pt||n===Rt||n===It)if(s===we){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===Ct)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Pt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Rt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===It)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===Ct)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Pt)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Rt)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===It)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Ot||n===Dt||n===Bt||n===Ft){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===Ot)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Dt)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Bt)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Ft)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Lt||n===Ut||n===kt){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===Lt||n===Ut)return s===we?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===kt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===Nt||n===zt||n===Gt||n===Ht||n===Vt||n===Xt||n===Wt||n===jt||n===Yt||n===qt||n===Kt||n===Jt||n===Zt||n===Qt){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===Nt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===zt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Gt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ht)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Vt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Xt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Wt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===jt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Yt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===qt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Kt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Jt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Zt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Qt)return s===we?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===$t||n===te||n===ee){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(n===$t)return s===we?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===te)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===ee)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===ne||n===ie||n===re){if(r=e.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===$t)return r.COMPRESSED_RED_RGTC1_EXT;if(n===ne)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===ie)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===re)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===bt?t.UNSIGNED_INT_24_8:void 0!==t[n]?t[n]:null}}}class Lo extends Yr{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Uo extends Oi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ko={type:"move"};class No{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Uo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Uo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Pn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Pn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Uo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Pn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Pn),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const s of t.hand.values()){const t=e.getJointPose(s,n),i=this._getHandJoint(l,s);null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=t.radius),i.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,h=.005;l.inputState.pinching&&a>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ko)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new Uo;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class zo{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,n){if(null===this.texture){const i=new Sn;t.properties.get(i).__webglTexture=e.texture,e.depthNear==n.depthNear&&e.depthFar==n.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(t){if(null!==this.texture&&null===this.mesh){const e=t.cameras[0].viewport,n=new Hr({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new Fr(new os(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}}class Go extends ze{constructor(t,e){super();const n=this;let i=null,r=1,s=null,a="local-floor",o=1,l=null,h=null,c=null,u=null,d=null,p=null;const f=new zo,m=e.getContextAttributes();let g=null,v=null;const y=[],x=[],b=new Qe;let _=null;const S=new Yr;S.layers.enable(1),S.viewport=new wn;const w=new Yr;w.layers.enable(2),w.viewport=new wn;const T=[S,w],M=new Lo;M.layers.enable(1),M.layers.enable(2);let A=null,E=null;function C(t){const e=x.indexOf(t.inputSource);if(-1===e)return;const n=y[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||s),n.dispatchEvent({type:t.type,data:t.inputSource}))}function P(){i.removeEventListener("select",C),i.removeEventListener("selectstart",C),i.removeEventListener("selectend",C),i.removeEventListener("squeeze",C),i.removeEventListener("squeezestart",C),i.removeEventListener("squeezeend",C),i.removeEventListener("end",P),i.removeEventListener("inputsourceschange",R);for(let t=0;t<y.length;t++){const e=x[t];null!==e&&(x[t]=null,y[t].disconnect(e))}A=null,E=null,f.reset(),t.setRenderTarget(g),d=null,u=null,c=null,i=null,v=null,F.stop(),n.isPresenting=!1,t.setPixelRatio(_),t.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}function R(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=x.indexOf(n);i>=0&&(x[i]=null,y[i].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=x.indexOf(n);if(-1===i){for(let t=0;t<y.length;t++){if(t>=x.length){x.push(n),i=t;break}if(null===x[t]){x[t]=n,i=t;break}}if(-1===i)break}const r=y[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=y[t];return void 0===e&&(e=new No,y[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=y[t];return void 0===e&&(e=new No,y[t]=e),e.getGripSpace()},this.getHand=function(t){let e=y[t];return void 0===e&&(e=new No,y[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,n.isPresenting},this.setReferenceSpaceType=function(t){a=t,n.isPresenting},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(h){if(i=h,null!==i){if(g=t.getRenderTarget(),i.addEventListener("select",C),i.addEventListener("selectstart",C),i.addEventListener("selectend",C),i.addEventListener("squeeze",C),i.addEventListener("squeezestart",C),i.addEventListener("squeezeend",C),i.addEventListener("end",P),i.addEventListener("inputsourceschange",R),!0!==m.xrCompatible&&await e.makeXRCompatible(),_=t.getPixelRatio(),t.getSize(b),void 0===i.renderState.layers){const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new Mn(d.framebufferWidth,d.framebufferHeight,{format:_t,type:dt,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,s=null,a=null;m.depth&&(a=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=m.stencil?wt:St,s=m.stencil?bt:mt);const o={colorFormat:e.RGBA8,depthFormat:a,scaleFactor:r};c=new XRWebGLBinding(i,e),u=c.createProjectionLayer(o),i.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),v=new Mn(u.textureWidth,u.textureHeight,{format:_t,type:dt,depthTexture:new Ws(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===u.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),F.setContext(i),F.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const I=new Pn,O=new Pn;function D(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;null!==f.texture&&(t.near=f.depthNear,t.far=f.depthFar),M.near=w.near=S.near=t.near,M.far=w.far=S.far=t.far,A===M.near&&E===M.far||(i.updateRenderState({depthNear:M.near,depthFar:M.far}),A=M.near,E=M.far,S.near=A,S.far=E,w.near=A,w.far=E,S.updateProjectionMatrix(),w.updateProjectionMatrix(),t.updateProjectionMatrix());const e=t.parent,n=M.cameras;D(M,e);for(let i=0;i<n.length;i++)D(n[i],e);2===n.length?function(t,e,n){I.setFromMatrixPosition(e.matrixWorld),O.setFromMatrixPosition(n.matrixWorld);const i=I.distanceTo(O),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*c,p=a*u,f=i/(-c+u),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+f,v=o+f,y=d-m,x=p+(i-m),b=l*o/v*g,_=h*o/v*g;t.projectionMatrix.makePerspective(y,x,b,_,g,v),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(M,S,w):M.projectionMatrix.copy(S.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Xe*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,M,e)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(t){o=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(M)};let B=null;const F=new ss;F.setAnimationLoop(function(e,r){if(h=r.getViewerPose(l||s),p=r,null!==h){const e=h.views;null!==d&&(t.setRenderTargetFramebuffer(v,d.framebuffer),t.setRenderTarget(v));let n=!1;e.length!==M.cameras.length&&(M.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==d)s=d.getViewport(r);else{const e=c.getViewSubImage(u,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(v,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(v))}let a=T[i];void 0===a&&(a=new Yr,a.layers.enable(i),a.viewport=new wn,T[i]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&(M.matrix.copy(a.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===n&&M.cameras.push(a)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")){const n=c.getDepthInformation(e[0]);n&&n.isValid&&n.texture&&f.init(t,n,i.renderState)}}for(let t=0;t<y.length;t++){const e=x[t],n=y[t];null!==e&&void 0!==n&&n.update(e,r,l||s)}B&&B(e,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null}),this.setAnimationLoop=function(t){B=t},this.dispose=function(){}}}const Ho=new mi,Vo=new si;function Xo(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function i(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map,n(i.map,t.mapTransform)),i.alphaMap&&(t.alphaMap.value=i.alphaMap,n(i.alphaMap,t.alphaMapTransform)),i.bumpMap&&(t.bumpMap.value=i.bumpMap,n(i.bumpMap,t.bumpMapTransform),t.bumpScale.value=i.bumpScale,1===i.side&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,n(i.normalMap,t.normalMapTransform),t.normalScale.value.copy(i.normalScale),1===i.side&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,n(i.displacementMap,t.displacementMapTransform),t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,t.emissiveMapTransform)),i.specularMap&&(t.specularMap.value=i.specularMap,n(i.specularMap,t.specularMapTransform)),i.alphaTest>0&&(t.alphaTest.value=i.alphaTest);const r=e.get(i),s=r.envMap,a=r.envMapRotation;s&&(t.envMap.value=s,Ho.copy(a),Ho.x*=-1,Ho.y*=-1,Ho.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(Ho.y*=-1,Ho.z*=-1),t.envMapRotation.value.setFromMatrix4(Vo.makeRotationFromEuler(Ho)),t.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,t.reflectivity.value=i.reflectivity,t.ior.value=i.ior,t.refractionRatio.value=i.refractionRatio),i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,t.lightMapTransform)),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,t.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,zr(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,r,s,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(t,r):r.isMeshToonMaterial?(i(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(i(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(i(t,r),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,n(e.metalnessMap,t.metalnessMapTransform));t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,n(e.roughnessMap,t.roughnessMapTransform));e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),1===e.side&&t.clearcoatNormalScale.value.negate()));e.dispersion>0&&(t.dispersion.value=e.dispersion);e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,r,o)):r.isMeshMatcapMaterial?(i(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?i(t,r):r.isMeshDistanceMaterial?(i(t,r),function(t,n){const i=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far}(t,r)):r.isMeshNormalMaterial?i(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,i,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*r,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r,s,a):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Wo(t,e,n,i){let r={},s={},a=[];const o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(t,e,n,i){const r=t.value,s=e+"_"+n;if(void 0===i[s])return i[s]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const t=i[s];if("number"==typeof r||"boolean"==typeof r){if(t!==r)return i[s]=r,!0}else if(!1===t.equals(r))return t.copy(r),!0}return!1}function h(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture,e}function c(e){const n=e.target;n.removeEventListener("dispose",c);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(t,e){const n=e.program;i.uniformBlockBinding(t,n)},update:function(n,u){let d=r[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const i=16;for(let s=0,a=e.length;s<a;s++){const t=Array.isArray(e[s])?e[s]:[e[s]];for(let e=0,r=t.length;e<r;e++){const r=t[e],s=Array.isArray(r.value)?r.value:[r.value];for(let t=0,e=s.length;t<e;t++){const e=h(s[t]),a=n%i;0!==a&&i-a<e.boundary&&(n+=i-a),r.__data=new Float32Array(e.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=e.storage}}}const r=n%i;r>0&&(n+=i-r);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<o;t++)if(-1===a.indexOf(t))return a.push(t),t;return 0}();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,r,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",c));const p=u.program;i.updateUBOMapping(n,p);const f=e.render.frame;s[n.id]!==f&&(!function(e){const n=r[e.id],i=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let r=0,a=i.length;r<a;r++){const e=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=e.length;n<i;n++){const i=e[n];if(!0===l(i,r,n,s)){const e=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let s=0;s<n.length;s++){const a=n[s],o=h(a);"number"==typeof a||"boolean"==typeof a?(i.__data[0]=a,t.bufferSubData(t.UNIFORM_BUFFER,e+r,i.__data)):a.isMatrix3?(i.__data[0]=a.elements[0],i.__data[1]=a.elements[1],i.__data[2]=a.elements[2],i.__data[3]=0,i.__data[4]=a.elements[3],i.__data[5]=a.elements[4],i.__data[6]=a.elements[5],i.__data[7]=0,i.__data[8]=a.elements[6],i.__data[9]=a.elements[7],i.__data[10]=a.elements[8],i.__data[11]=0):(a.toArray(i.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,i.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);a=[],r={},s={}}}}let jo=class{constructor(t={}){const{canvas:e=an(),context:n=null,depth:i=!0,stencil:r=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:c=!1}=t;let u;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");u=n.getContextAttributes().alpha}else u=s;const d=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ye,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let x=!1,b=0,_=0,S=null,w=-1,T=null;const A=new wn,E=new wn;let C=null;const P=new qi(0);let R=0,I=e.width,O=e.height,D=1,B=null,F=null;const L=new wn(0,0,I,O),U=new wn(0,0,I,O);let k=!1;const N=new rs;let z=!1,G=!1;const H=new si,V=new Pn,X={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let W=!1;function j(){return null===S?D:1}let Y,q,K,J,Z,Q,$,tt,et,nt,it,rt,st,at,ot,lt,ht,ct,ft,gt,_t,St,wt,Tt,Ct=n;function Pt(t,n){return e.getContext(t,n)}try{const t={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${M}`),e.addEventListener("webglcontextlost",Ot,!1),e.addEventListener("webglcontextrestored",Dt,!1),e.addEventListener("webglcontextcreationerror",Bt,!1),null===Ct){const e="webgl2";if(Ct=Pt(e,t),null===Ct)throw Pt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Kt){throw Kt}function Rt(){Y=new Ns(Ct),Y.init(),St=new Fo(Ct,Y),q=new vs(Ct,Y,t,St),K=new Do(Ct),J=new Hs(Ct),Z=new xo,Q=new Bo(Ct,Y,K,Z,q,St,J),$=new xs(y),tt=new ks(y),et=new as(Ct),wt=new ms(Ct,et),nt=new zs(Ct,et,J,wt),it=new Xs(Ct,nt,et,J),ft=new Vs(Ct,q,Q),lt=new ys(Z),rt=new yo(y,$,tt,Y,q,wt,lt),st=new Xo(y,Z),at=new wo,ot=new Po(Y),ct=new fs(y,$,tt,K,it,u,o),ht=new Oo(y,it,q),Tt=new Wo(Ct,J,q,K),gt=new gs(Ct,Y,J),_t=new Gs(Ct,Y,J),J.programs=rt.programs,y.capabilities=q,y.extensions=Y,y.properties=Z,y.renderLists=at,y.shadowMap=ht,y.state=K,y.info=J}Rt();const It=new Go(y,Ct);function Ot(t){t.preventDefault(),x=!0}function Dt(){x=!1;const t=J.autoReset,e=ht.enabled,n=ht.autoUpdate,i=ht.needsUpdate,r=ht.type;Rt(),J.autoReset=t,ht.enabled=e,ht.autoUpdate=n,ht.needsUpdate=i,ht.type=r}function Bt(t){}function Ft(t){const e=t.target;e.removeEventListener("dispose",Ft),function(t){(function(t){const e=Z.get(t).programs;void 0!==e&&(e.forEach(function(t){rt.releaseProgram(t)}),t.isShaderMaterial&&rt.releaseShaderCache(t))})(t),Z.remove(t)}(e)}function Lt(t,e,n){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=1,t.needsUpdate=!0,jt(t,e,n),t.side=0,t.needsUpdate=!0,jt(t,e,n),t.side=2):jt(t,e,n)}this.xr=It,this.getContext=function(){return Ct},this.getContextAttributes=function(){return Ct.getContextAttributes()},this.forceContextLoss=function(){const t=Y.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Y.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(t){void 0!==t&&(D=t,this.setSize(I,O,!1))},this.getSize=function(t){return t.set(I,O)},this.setSize=function(t,n,i=!0){It.isPresenting||(I=t,O=n,e.width=Math.floor(t*D),e.height=Math.floor(n*D),!0===i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(I*D,O*D).floor()},this.setDrawingBufferSize=function(t,n,i){I=t,O=n,D=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(A)},this.getViewport=function(t){return t.copy(L)},this.setViewport=function(t,e,n,i){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,n,i),K.viewport(A.copy(L).multiplyScalar(D).round())},this.getScissor=function(t){return t.copy(U)},this.setScissor=function(t,e,n,i){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,n,i),K.scissor(E.copy(U).multiplyScalar(D).round())},this.getScissorTest=function(){return k},this.setScissorTest=function(t){K.setScissorTest(k=t)},this.setOpaqueSort=function(t){B=t},this.setTransparentSort=function(t){F=t},this.getClearColor=function(t){return t.copy(ct.getClearColor())},this.setClearColor=function(){ct.setClearColor.apply(ct,arguments)},this.getClearAlpha=function(){return ct.getClearAlpha()},this.setClearAlpha=function(){ct.setClearAlpha.apply(ct,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;if(t){let t=!1;if(null!==S){const e=S.texture.format;t=e===Et||e===At||e===Mt}if(t){const t=S.texture.type,e=t===dt||t===mt||t===pt||t===bt||t===yt||t===xt,n=ct.getClearColor(),i=ct.getClearAlpha(),r=n.r,s=n.g,a=n.b;e?(d[0]=r,d[1]=s,d[2]=a,d[3]=i,Ct.clearBufferuiv(Ct.COLOR,0,d)):(p[0]=r,p[1]=s,p[2]=a,p[3]=i,Ct.clearBufferiv(Ct.COLOR,0,p))}else i|=Ct.COLOR_BUFFER_BIT}e&&(i|=Ct.DEPTH_BUFFER_BIT),n&&(i|=Ct.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ct.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ot,!1),e.removeEventListener("webglcontextrestored",Dt,!1),e.removeEventListener("webglcontextcreationerror",Bt,!1),at.dispose(),ot.dispose(),Z.dispose(),$.dispose(),tt.dispose(),it.dispose(),wt.dispose(),Tt.dispose(),rt.dispose(),It.dispose(),It.removeEventListener("sessionstart",kt),It.removeEventListener("sessionend",Nt),zt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=X);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,n,i,r){!0!==e.isScene&&(e=X);Q.resetTextureUnits();const s=e.fog,a=i.isMeshStandardMaterial?e.environment:null,o=null===S?y.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:xe,l=(i.isMeshStandardMaterial?tt:$).get(i.envMap||a),h=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;i.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(f=y.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,x=Z.get(i),b=m.state.lights;if(!0===z&&(!0===G||t!==T)){const e=t===T&&i.id===w;lt.setState(i,t,e)}let _=!1;i.version===x.__version?x.needsLights&&x.lightsStateVersion!==b.state.version||x.outputColorSpace!==o||r.isBatchedMesh&&!1===x.batching?_=!0:r.isBatchedMesh||!0!==x.batching?r.isBatchedMesh&&!0===x.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===x.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===x.instancing?_=!0:r.isInstancedMesh||!0!==x.instancing?r.isSkinnedMesh&&!1===x.skinning?_=!0:r.isSkinnedMesh||!0!==x.skinning?r.isInstancedMesh&&!0===x.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===x.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===x.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===x.instancingMorph&&null!==r.morphTexture||x.envMap!==l||!0===i.fog&&x.fog!==s?_=!0:void 0===x.numClippingPlanes||x.numClippingPlanes===lt.numPlanes&&x.numIntersection===lt.numIntersection?(x.vertexAlphas!==h||x.vertexTangents!==c||x.morphTargets!==u||x.morphNormals!==d||x.morphColors!==p||x.toneMapping!==f||x.morphTargetsCount!==v)&&(_=!0):_=!0:_=!0:_=!0:_=!0:(_=!0,x.__version=i.version);let M=x.currentProgram;!0===_&&(M=jt(i,e,r));let A=!1,E=!1,C=!1;const P=M.getUniforms(),R=x.uniforms;K.useProgram(M.program)&&(A=!0,E=!0,C=!0);i.id!==w&&(w=i.id,E=!0);if(A||T!==t){P.setValue(Ct,"projectionMatrix",t.projectionMatrix),P.setValue(Ct,"viewMatrix",t.matrixWorldInverse);const e=P.map.cameraPosition;void 0!==e&&e.setValue(Ct,V.setFromMatrixPosition(t.matrixWorld)),q.logarithmicDepthBuffer&&P.setValue(Ct,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(Ct,"isOrthographic",!0===t.isOrthographicCamera),T!==t&&(T=t,E=!0,C=!0)}if(r.isSkinnedMesh){P.setOptional(Ct,r,"bindMatrix"),P.setOptional(Ct,r,"bindMatrixInverse");const t=r.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(Ct,"boneTexture",t.boneTexture,Q))}r.isBatchedMesh&&(P.setOptional(Ct,r,"batchingTexture"),P.setValue(Ct,"batchingTexture",r._matricesTexture,Q),P.setOptional(Ct,r,"batchingColorTexture"),null!==r._colorsTexture&&P.setValue(Ct,"batchingColorTexture",r._colorsTexture,Q));const I=n.morphAttributes;void 0===I.position&&void 0===I.normal&&void 0===I.color||ft.update(r,n,M);(E||x.receiveShadow!==r.receiveShadow)&&(x.receiveShadow=r.receiveShadow,P.setValue(Ct,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==e.environment&&(R.envMapIntensity.value=e.environmentIntensity);E&&(P.setValue(Ct,"toneMappingExposure",y.toneMappingExposure),x.needsLights&&(F=C,(B=R).ambientLightColor.needsUpdate=F,B.lightProbe.needsUpdate=F,B.directionalLights.needsUpdate=F,B.directionalLightShadows.needsUpdate=F,B.pointLights.needsUpdate=F,B.pointLightShadows.needsUpdate=F,B.spotLights.needsUpdate=F,B.spotLightShadows.needsUpdate=F,B.rectAreaLights.needsUpdate=F,B.hemisphereLights.needsUpdate=F),s&&!0===i.fog&&st.refreshFogUniforms(R,s),st.refreshMaterialUniforms(R,i,D,O,m.state.transmissionRenderTarget[t.id]),Ja.upload(Ct,Yt(x),R,Q));var B,F;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Ja.upload(Ct,Yt(x),R,Q),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&P.setValue(Ct,"center",r.center);if(P.setValue(Ct,"modelViewMatrix",r.modelViewMatrix),P.setValue(Ct,"normalMatrix",r.normalMatrix),P.setValue(Ct,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++){const n=t[e];Tt.update(n,M),Tt.bind(n,M)}}return M}(t,e,n,i,r);K.setMaterial(i,a);let l=n.index,h=1;if(!0===i.wireframe){if(l=nt.getWireframeAttribute(n),void 0===l)return;h=2}const c=n.drawRange,u=n.attributes.position;let d=c.start*h,p=(c.start+c.count)*h;null!==s&&(d=Math.max(d,s.start*h),p=Math.min(p,(s.start+s.count)*h)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const f=p-d;if(f<0||f===1/0)return;let g;wt.setup(r,i,o,n,l);let v=gt;if(null!==l&&(g=et.get(l),v=_t,v.setIndex(g)),r.isMesh)!0===i.wireframe?(K.setLineWidth(i.wireframeLinewidth*j()),v.setMode(Ct.LINES)):v.setMode(Ct.TRIANGLES);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),K.setLineWidth(t*j()),r.isLineSegments?v.setMode(Ct.LINES):r.isLineLoop?v.setMode(Ct.LINE_LOOP):v.setMode(Ct.LINE_STRIP)}else r.isPoints?v.setMode(Ct.POINTS):r.isSprite&&v.setMode(Ct.TRIANGLES);if(r.isBatchedMesh)null!==r._multiDrawInstances?v.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances):v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else if(r.isInstancedMesh)v.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);v.renderInstances(d,f,e)}else v.render(d,f)},this.compile=function(t,e,n=null){null===n&&(n=t),m=ot.get(n),m.init(e),v.push(m),n.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(m.pushLight(t),t.castShadow&&m.pushShadow(t))}),t!==n&&t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(m.pushLight(t),t.castShadow&&m.pushShadow(t))}),m.setupLights();const i=new Set;return t.traverse(function(t){const e=t.material;if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++){const s=e[r];Lt(s,n,t),i.add(s)}else Lt(e,n,t),i.add(e)}),v.pop(),m=null,i},this.compileAsync=function(t,e,n=null){const i=this.compile(t,e,n);return new Promise(e=>{function n(){i.forEach(function(t){Z.get(t).currentProgram.isReady()&&i.delete(t)}),0!==i.size?setTimeout(n,10):e(t)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ut=null;function kt(){zt.stop()}function Nt(){zt.start()}const zt=new ss;function Gt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)m.pushLight(t),t.castShadow&&m.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||N.intersectsSprite(t)){i&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(H);const e=it.update(t),r=t.material;r.visible&&f.push(t,e,r,n,V.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||N.intersectsObject(t))){const e=it.update(t),r=t.material;if(i&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),V.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),V.copy(e.boundingSphere.center)),V.applyMatrix4(t.matrixWorld).applyMatrix4(H)),Array.isArray(r)){const i=e.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&f.push(t,e,o,n,V.z,a)}}else r.visible&&f.push(t,e,r,n,V.z,null)}const r=t.children;for(let s=0,a=r.length;s<a;s++)Gt(r[s],e,n,i)}function Ht(t,e,n,i){const r=t.opaque,s=t.transmissive,a=t.transparent;m.setupLightsView(n),!0===z&&lt.setGlobalState(y.clippingPlanes,n),i&&K.viewport(A.copy(i)),r.length>0&&Xt(r,e,n),s.length>0&&Xt(s,e,n),a.length>0&&Xt(a,e,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Vt(t,e,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[i.id]&&(m.state.transmissionRenderTarget[i.id]=new Mn(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?vt:dt,minFilter:ut,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:pn.workingColorSpace}));const s=m.state.transmissionRenderTarget[i.id],a=i.viewport||A;s.setSize(a.z,a.w);const o=y.getRenderTarget();y.setRenderTarget(s),y.getClearColor(P),R=y.getClearAlpha(),R<1&&y.setClearColor(16777215,.5),W?ct.render(n):y.clear();const l=y.toneMapping;y.toneMapping=0;const h=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),m.setupLightsView(i),!0===z&&lt.setGlobalState(y.clippingPlanes,i),Xt(t,n,i),Q.updateMultisampleRenderTarget(s),Q.updateRenderTargetMipmap(s),!1===Y.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=s.object,o=s.geometry,l=s.material,h=s.group;if(2===l.side&&a.layers.test(i.layers)){const e=l.side;l.side=1,l.needsUpdate=!0,Wt(a,n,i,o,l,h),l.side=e,l.needsUpdate=!0,t=!0}}!0===t&&(Q.updateMultisampleRenderTarget(s),Q.updateRenderTargetMipmap(s))}y.setRenderTarget(o),y.setClearColor(P,R),void 0!==h&&(i.viewport=h),y.toneMapping=l}function Xt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===i?s.material:i,h=s.group;a.layers.test(n.layers)&&Wt(a,e,n,o,l,h)}}function Wt(t,e,n,i,r,s){t.onBeforeRender(y,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(y,e,n,i,t,s),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,e,i,r,t,s),r.side=0,r.needsUpdate=!0,y.renderBufferDirect(n,e,i,r,t,s),r.side=2):y.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(y,e,n,i,r,s)}function jt(t,e,n){!0!==e.isScene&&(e=X);const i=Z.get(t),r=m.state.lights,s=m.state.shadowsArray,a=r.state.version,o=rt.getParameters(t,r.state,s,e,n),l=rt.getProgramCacheKey(o);let h=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?tt:$).get(t.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===h&&(t.addEventListener("dispose",Ft),h=new Map,i.programs=h);let c=h.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===a)return qt(t,o),c}else o.uniforms=rt.getUniforms(t),t.onBuild(n,o,y),t.onBeforeCompile(o,y),c=rt.acquireProgram(o,l),h.set(l,c),i.uniforms=o.uniforms;const u=i.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=lt.uniform),qt(t,o),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=c,i.uniformsList=null,c}function Yt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=Ja.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function qt(t,e){const n=Z.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.batchingColor=e.batchingColor,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.instancingMorph=e.instancingMorph,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}zt.setAnimationLoop(function(t){Ut&&Ut(t)}),"undefined"!=typeof self&&zt.setContext(self),this.setAnimationLoop=function(t){Ut=t,It.setAnimationLoop(t),null===t?zt.stop():zt.start()},It.addEventListener("sessionstart",kt),It.addEventListener("sessionend",Nt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return;if(!0===x)return;if(!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===It.enabled&&!0===It.isPresenting&&(!0===It.cameraAutoUpdate&&It.updateCamera(e),e=It.getCamera()),!0===t.isScene&&t.onBeforeRender(y,t,e,S),m=ot.get(t,v.length),m.init(e),v.push(m),H.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),N.setFromProjectionMatrix(H),G=this.localClippingEnabled,z=lt.init(this.clippingPlanes,G),f=at.get(t,g.length),f.init(),g.push(f),!0===It.enabled&&!0===It.isPresenting){const t=y.xr.getDepthSensingMesh();null!==t&&Gt(t,e,-1/0,y.sortObjects)}Gt(t,e,0,y.sortObjects),f.finish(),!0===y.sortObjects&&f.sort(B,F),W=!1===It.enabled||!1===It.isPresenting||!1===It.hasDepthSensing(),W&&ct.addToRenderList(f,t),this.info.render.frame++,!0===z&&lt.beginShadows();const n=m.state.shadowsArray;ht.render(n,t,e),!0===z&&lt.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=f.opaque,r=f.transmissive;if(m.setupLights(),e.isArrayCamera){const n=e.cameras;if(r.length>0)for(let e=0,s=n.length;e<s;e++){Vt(i,r,t,n[e])}W&&ct.render(t);for(let e=0,i=n.length;e<i;e++){const i=n[e];Ht(f,t,i,i.viewport)}}else r.length>0&&Vt(i,r,t,e),W&&ct.render(t),Ht(f,t,e);null!==S&&(Q.updateMultisampleRenderTarget(S),Q.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(y,t,e),wt.resetDefaultState(),w=-1,T=null,v.pop(),v.length>0?(m=v[v.length-1],!0===z&&lt.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(t,e,n){Z.get(t.texture).__webglTexture=e,Z.get(t.depthTexture).__webglTexture=n;const i=Z.get(t);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(t,e){const n=Z.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){S=t,b=e,_=n;let i=!0,r=null,s=!1,a=!1;if(t){const o=Z.get(t);void 0!==o.__useDefaultFramebuffer?(K.bindFramebuffer(Ct.FRAMEBUFFER,null),i=!1):void 0===o.__webglFramebuffer?Q.setupRenderTarget(t):o.__hasExternalTextures&&Q.rebindTextures(t,Z.get(t.texture).__webglTexture,Z.get(t.depthTexture).__webglTexture);const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const h=Z.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(h[e])?h[e][n]:h[e],s=!0):r=t.samples>0&&!1===Q.useMultisampledRTT(t)?Z.get(t).__webglMultisampledFramebuffer:Array.isArray(h)?h[n]:h,A.copy(t.viewport),E.copy(t.scissor),C=t.scissorTest}else A.copy(L).multiplyScalar(D).floor(),E.copy(U).multiplyScalar(D).floor(),C=k;if(K.bindFramebuffer(Ct.FRAMEBUFFER,r)&&i&&K.drawBuffers(t,r),K.viewport(A),K.scissor(E),K.setScissorTest(C),s){const i=Z.get(t.texture);Ct.framebufferTexture2D(Ct.FRAMEBUFFER,Ct.COLOR_ATTACHMENT0,Ct.TEXTURE_CUBE_MAP_POSITIVE_X+e,i.__webglTexture,n)}else if(a){const i=Z.get(t.texture),r=e||0;Ct.framebufferTextureLayer(Ct.FRAMEBUFFER,Ct.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}w=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,a){if(!t||!t.isWebGLRenderTarget)return;let o=Z.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){K.bindFramebuffer(Ct.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,l=a.type;if(!q.textureFormatReadable(o))return;if(!q.textureTypeReadable(l))return;e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&Ct.readPixels(e,n,i,r,St.convert(o),St.convert(l),s)}finally{const t=null!==S?Z.get(S).__webglFramebuffer:null;K.bindFramebuffer(Ct.FRAMEBUFFER,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,n,i,r,s,a){if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=Z.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){K.bindFramebuffer(Ct.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,l=a.type;if(!q.textureFormatReadable(o))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!q.textureTypeReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r){const t=Ct.createBuffer();Ct.bindBuffer(Ct.PIXEL_PACK_BUFFER,t),Ct.bufferData(Ct.PIXEL_PACK_BUFFER,s.byteLength,Ct.STREAM_READ),Ct.readPixels(e,n,i,r,St.convert(o),St.convert(l),0),Ct.flush();const a=Ct.fenceSync(Ct.SYNC_GPU_COMMANDS_COMPLETE,0);await function(t,e,n){return new Promise(function(i,r){setTimeout(function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:i()}},n)})}(Ct,a,4);try{Ct.bindBuffer(Ct.PIXEL_PACK_BUFFER,t),Ct.getBufferSubData(Ct.PIXEL_PACK_BUFFER,0,s)}finally{Ct.deleteBuffer(t),Ct.deleteSync(a)}return s}}finally{const t=null!==S?Z.get(S).__webglFramebuffer:null;K.bindFramebuffer(Ct.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e=null,n=0){!0!==t.isTexture&&(e=arguments[0]||null,t=arguments[1]);const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i),a=null!==e?e.x:0,o=null!==e?e.y:0;Q.setTexture2D(t,0),Ct.copyTexSubImage2D(Ct.TEXTURE_2D,n,0,0,a,o,r,s),K.unbindTexture()},this.copyTextureToTexture=function(t,e,n=null,i=null,r=0){let s,a,o,l,h,c;!0!==t.isTexture&&(i=arguments[0]||null,t=arguments[1],e=arguments[2],r=arguments[3]||0,n=null),null!==n?(s=n.max.x-n.min.x,a=n.max.y-n.min.y,o=n.min.x,l=n.min.y):(s=t.image.width,a=t.image.height,o=0,l=0),null!==i?(h=i.x,c=i.y):(h=0,c=0);const u=St.convert(e.format),d=St.convert(e.type);Q.setTexture2D(e,0),Ct.pixelStorei(Ct.UNPACK_FLIP_Y_WEBGL,e.flipY),Ct.pixelStorei(Ct.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Ct.pixelStorei(Ct.UNPACK_ALIGNMENT,e.unpackAlignment);const p=Ct.getParameter(Ct.UNPACK_ROW_LENGTH),f=Ct.getParameter(Ct.UNPACK_IMAGE_HEIGHT),m=Ct.getParameter(Ct.UNPACK_SKIP_PIXELS),g=Ct.getParameter(Ct.UNPACK_SKIP_ROWS),v=Ct.getParameter(Ct.UNPACK_SKIP_IMAGES),y=t.isCompressedTexture?t.mipmaps[r]:t.image;Ct.pixelStorei(Ct.UNPACK_ROW_LENGTH,y.width),Ct.pixelStorei(Ct.UNPACK_IMAGE_HEIGHT,y.height),Ct.pixelStorei(Ct.UNPACK_SKIP_PIXELS,o),Ct.pixelStorei(Ct.UNPACK_SKIP_ROWS,l),t.isDataTexture?Ct.texSubImage2D(Ct.TEXTURE_2D,r,h,c,s,a,u,d,y.data):t.isCompressedTexture?Ct.compressedTexSubImage2D(Ct.TEXTURE_2D,r,h,c,y.width,y.height,u,y.data):Ct.texSubImage2D(Ct.TEXTURE_2D,r,h,c,u,d,y),Ct.pixelStorei(Ct.UNPACK_ROW_LENGTH,p),Ct.pixelStorei(Ct.UNPACK_IMAGE_HEIGHT,f),Ct.pixelStorei(Ct.UNPACK_SKIP_PIXELS,m),Ct.pixelStorei(Ct.UNPACK_SKIP_ROWS,g),Ct.pixelStorei(Ct.UNPACK_SKIP_IMAGES,v),0===r&&e.generateMipmaps&&Ct.generateMipmap(Ct.TEXTURE_2D),K.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n=null,i=null,r=0){let s,a,o,l,h,c,u,d,p;!0!==t.isTexture&&(n=arguments[0]||null,i=arguments[1]||null,t=arguments[2],e=arguments[3],r=arguments[4]||0);const f=t.isCompressedTexture?t.mipmaps[r]:t.image;null!==n?(s=n.max.x-n.min.x,a=n.max.y-n.min.y,o=n.max.z-n.min.z,l=n.min.x,h=n.min.y,c=n.min.z):(s=f.width,a=f.height,o=f.depth,l=0,h=0,c=0),null!==i?(u=i.x,d=i.y,p=i.z):(u=0,d=0,p=0);const m=St.convert(e.format),g=St.convert(e.type);let v;if(e.isData3DTexture)Q.setTexture3D(e,0),v=Ct.TEXTURE_3D;else{if(!e.isDataArrayTexture&&!e.isCompressedArrayTexture)return;Q.setTexture2DArray(e,0),v=Ct.TEXTURE_2D_ARRAY}Ct.pixelStorei(Ct.UNPACK_FLIP_Y_WEBGL,e.flipY),Ct.pixelStorei(Ct.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Ct.pixelStorei(Ct.UNPACK_ALIGNMENT,e.unpackAlignment);const y=Ct.getParameter(Ct.UNPACK_ROW_LENGTH),x=Ct.getParameter(Ct.UNPACK_IMAGE_HEIGHT),b=Ct.getParameter(Ct.UNPACK_SKIP_PIXELS),_=Ct.getParameter(Ct.UNPACK_SKIP_ROWS),S=Ct.getParameter(Ct.UNPACK_SKIP_IMAGES);Ct.pixelStorei(Ct.UNPACK_ROW_LENGTH,f.width),Ct.pixelStorei(Ct.UNPACK_IMAGE_HEIGHT,f.height),Ct.pixelStorei(Ct.UNPACK_SKIP_PIXELS,l),Ct.pixelStorei(Ct.UNPACK_SKIP_ROWS,h),Ct.pixelStorei(Ct.UNPACK_SKIP_IMAGES,c),t.isDataTexture||t.isData3DTexture?Ct.texSubImage3D(v,r,u,d,p,s,a,o,m,g,f.data):e.isCompressedArrayTexture?Ct.compressedTexSubImage3D(v,r,u,d,p,s,a,o,m,f.data):Ct.texSubImage3D(v,r,u,d,p,s,a,o,m,g,f),Ct.pixelStorei(Ct.UNPACK_ROW_LENGTH,y),Ct.pixelStorei(Ct.UNPACK_IMAGE_HEIGHT,x),Ct.pixelStorei(Ct.UNPACK_SKIP_PIXELS,b),Ct.pixelStorei(Ct.UNPACK_SKIP_ROWS,_),Ct.pixelStorei(Ct.UNPACK_SKIP_IMAGES,S),0===r&&e.generateMipmaps&&Ct.generateMipmap(v),K.unbindTexture()},this.initRenderTarget=function(t){void 0===Z.get(t).__webglFramebuffer&&Q.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?Q.setTextureCube(t,0):t.isData3DTexture?Q.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?Q.setTexture2DArray(t,0):Q.setTexture2D(t,0),K.unbindTexture()},this.resetState=function(){b=0,_=0,S=null,K.reset(),wt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ke}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===be?"display-p3":"srgb",e.unpackColorSpace=pn.workingColorSpace===_e?"display-p3":"srgb"}};class Yo{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new qi(t),this.density=e}clone(){return new Yo(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class qo{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new qi(t),this.near=e,this.far=n}clone(){return new qo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Ko extends Oi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new mi,this.environmentIntensity=1,this.environmentRotation=new mi,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class Jo{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Fe,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=We()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return ln("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=We()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=We()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Zo=new Pn;class Qo{constructor(t,e,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Zo.fromBufferAttribute(this,e),Zo.applyMatrix4(t),this.setXYZ(e,Zo.x,Zo.y,Zo.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Zo.fromBufferAttribute(this,e),Zo.applyNormalMatrix(t),this.setXYZ(e,Zo.x,Zo.y,Zo.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Zo.fromBufferAttribute(this,e),Zo.transformDirection(t),this.setXYZ(e,Zo.x,Zo.y,Zo.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=Ke(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Je(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=Je(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Je(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Je(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Je(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Ke(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Ke(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Ke(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Ke(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array),i=Je(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array),i=Je(i,this.array),r=Je(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new ar(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Qo(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class $o extends Zi{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new qi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let tl;const el=new Pn,nl=new Pn,il=new Pn,rl=new Qe,sl=new Qe,al=new si,ol=new Pn,ll=new Pn,hl=new Pn,cl=new Qe,ul=new Qe,dl=new Qe;let pl=class extends Oi{constructor(t=new $o){if(super(),this.isSprite=!0,this.type="Sprite",void 0===tl){tl=new vr;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new Jo(t,5);tl.setIndex([0,1,2,0,2,3]),tl.setAttribute("position",new Qo(e,3,0,!1)),tl.setAttribute("uv",new Qo(e,2,3,!1))}this.geometry=tl,this.material=t,this.center=new Qe(.5,.5)}raycast(t,e){t.camera,nl.setFromMatrixScale(this.matrixWorld),al.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),il.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&nl.multiplyScalar(-il.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;fl(ol.set(-.5,-.5,0),il,s,nl,i,r),fl(ll.set(.5,-.5,0),il,s,nl,i,r),fl(hl.set(.5,.5,0),il,s,nl,i,r),cl.set(0,0),ul.set(1,0),dl.set(1,1);let a=t.ray.intersectTriangle(ol,ll,hl,!1,el);if(null===a&&(fl(ll.set(-.5,.5,0),il,s,nl,i,r),ul.set(0,1),a=t.ray.intersectTriangle(ol,hl,ll,!1,el),null===a))return;const o=t.ray.origin.distanceTo(el);o<t.near||o>t.far||e.push({distance:o,point:el.clone(),uv:Vi.getInterpolation(el,ol,ll,hl,cl,ul,dl,new Qe),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}};function fl(t,e,n,i,r,s){rl.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(sl.x=s*rl.x-r*rl.y,sl.y=r*rl.x+s*rl.y):sl.copy(rl),t.copy(e),t.x+=sl.x,t.y+=sl.y,t.applyMatrix4(al)}const ml=new Pn,gl=new Pn;class vl extends Oi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let n=0,i=e.length;n<i;n++){const t=e[n];this.addLevel(t.object.clone(),t.distance,t.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,n=0){e=Math.abs(e);const i=this.levels;let r;for(r=0;r<i.length&&!(e<i[r].distance);r++);return i.splice(r,0,{distance:e,hysteresis:n,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i;n++){let i=e[n].distance;if(e[n].object.visible&&(i-=i*e[n].hysteresis),t<i)break}return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){ml.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(ml);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){ml.setFromMatrixPosition(t.matrixWorld),gl.setFromMatrixPosition(this.matrixWorld);const n=ml.distanceTo(gl)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r;i++){let t=e[i].distance;if(e[i].object.visible&&(t-=t*e[i].hysteresis),!(n>=t))break;e[i-1].object.visible=!1,e[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const t=n[i];e.object.levels.push({object:t.object.uuid,distance:t.distance,hysteresis:t.hysteresis})}return e}}const yl=new Pn,xl=new wn,bl=new wn,_l=new Pn,Sl=new si,wl=new Pn,Tl=new Jn,Ml=new si,Al=new ri;let El=class extends Fr{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=K,this.bindMatrix=new si,this.bindMatrixInverse=new si,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new On),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,wl),this.boundingBox.expandByPoint(wl)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Jn),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,wl),this.boundingSphere.expandByPoint(wl)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Tl.copy(this.boundingSphere),Tl.applyMatrix4(i),!1!==t.ray.intersectsSphere(Tl)&&(Ml.copy(i).invert(),Al.copy(t.ray).applyMatrix4(Ml),null!==this.boundingBox&&!1===Al.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,Al)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new wn,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===K?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===J&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}applyBoneTransform(t,e){const n=this.skeleton,i=this.geometry;xl.fromBufferAttribute(i.attributes.skinIndex,t),bl.fromBufferAttribute(i.attributes.skinWeight,t),yl.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const t=bl.getComponent(r);if(0!==t){const i=xl.getComponent(r);Sl.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(_l.copy(yl).applyMatrix4(Sl),t)}}return e.applyMatrix4(this.bindMatrixInverse)}},Cl=class extends Oi{constructor(){super(),this.isBone=!0,this.type="Bone"}};class Pl extends Sn{constructor(t=null,e=1,n=1,i,r,s,a,o,l=1003,h=1003,c,u){super(null,s,a,o,l,h,i,r,c,u),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Rl=new si,Il=new si;let Ol=class t{constructor(t=[],e=[]){this.uuid=We(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new si)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new si;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=t.length;r<s;r++){const i=t[r]?t[r].matrixWorld:Il;Rl.multiplyMatrices(i,e[r]),Rl.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new t(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new Pl(e,t,t,_t,gt);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){let i=e[t.bones[n]];void 0===i&&(i=new Cl),this.bones.push(i),this.boneInverses.push((new si).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}};class Dl extends ar{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Bl=new si,Fl=new si,Ll=[],Ul=new On,kl=new si,Nl=new Fr,zl=new Jn;class Gl extends Fr{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Dl(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,kl)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new On),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Bl),Ul.copy(t.boundingBox).applyMatrix4(Bl),this.boundingBox.union(Ul)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Jn),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Bl),zl.copy(t.boundingSphere).applyMatrix4(Bl),this.boundingSphere.union(zl)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const n=e.morphTargetInfluences,i=this.morphTexture.source.data.data,r=t*(n.length+1)+1;for(let s=0;s<n.length;s++)n[s]=i[r+s]}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Nl.geometry=this.geometry,Nl.material=this.material,void 0!==Nl.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),zl.copy(this.boundingSphere),zl.applyMatrix4(n),!1!==t.ray.intersectsSphere(zl)))for(let r=0;r<i;r++){this.getMatrixAt(r,Bl),Fl.multiplyMatrices(n,Bl),Nl.matrixWorld=Fl,Nl.raycast(t,Ll);for(let t=0,n=Ll.length;t<n;t++){const n=Ll[t];n.instanceId=r,n.object=this,e.push(n)}Ll.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Dl(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const n=e.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new Pl(new Float32Array(i*this.count),i,this.count,Tt,gt));const r=this.morphTexture.source.data.data;let s=0;for(let l=0;l<n.length;l++)s+=n[l];const a=this.geometry.morphTargetsRelative?1:1-s,o=i*t;r[o]=a,r.set(n,o+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function Hl(t,e){return t.z-e.z}function Vl(t,e){return e.z-t.z}class Xl{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e){const n=this.pool,i=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const r=n[this.index];i.push(r),this.index++,r.start=t.start,r.count=t.count,r.z=e}reset(){this.list.length=0,this.index=0}}const Wl="batchId",jl=new si,Yl=new si,ql=new si,Kl=new qi(1,1,1),Jl=new si,Zl=new rs,Ql=new On,$l=new Jn,th=new Pn,eh=new Pn,nh=new Pn,ih=new Xl,rh=new Fr,sh=[];function ah(t,e,n=0){const i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const r=t.count;for(let s=0;s<r;s++)for(let r=0;r<i;r++)e.setComponent(s+n,r,t.getComponent(s,r))}else e.array.set(t.array,n*i);e.needsUpdate=!0}class oh extends Fr{get maxGeometryCount(){return this._maxGeometryCount}constructor(t,e,n=2*e,i){super(new vr,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=t,this._maxVertexCount=e,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture(),this._colorsTexture=null}_initMatricesTexture(){let t=Math.sqrt(4*this._maxGeometryCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),n=new Pl(e,t,t,_t,gt);this._matricesTexture=n}_initColorsTexture(){let t=Math.sqrt(this._maxGeometryCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),n=new Pl(e,t,t,_t,gt);n.colorSpace=pn.workingColorSpace,this._colorsTexture=n}_initializeGeometry(t){const e=this.geometry,n=this._maxVertexCount,i=this._maxGeometryCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in t.attributes){const r=t.getAttribute(i),{array:s,itemSize:a,normalized:o}=r,l=new s.constructor(n*a),h=new ar(l,a,o);e.setAttribute(i,h)}if(null!==t.getIndex()){const t=n>65536?new Uint32Array(r):new Uint16Array(r);e.setIndex(new ar(t,1))}const s=i>65536?new Uint32Array(n):new Uint16Array(n);e.setAttribute(Wl,new ar(s,1)),this._geometryInitialized=!0}}_validateGeometry(t){if(t.getAttribute(Wl))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Wl}"`);const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in e.attributes){if(n===Wl)continue;if(!t.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=t.getAttribute(n),r=e.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new On);const t=this._geometryCount,e=this.boundingBox,n=this._active;e.makeEmpty();for(let i=0;i<t;i++)!1!==n[i]&&(this.getMatrixAt(i,jl),this.getBoundingBoxAt(i,Ql).applyMatrix4(jl),e.union(Ql))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Jn);const t=this._geometryCount,e=this.boundingSphere,n=this._active;e.makeEmpty();for(let i=0;i<t;i++)!1!==n[i]&&(this.getMatrixAt(i,jl),this.getBoundingSphereAt(i,$l).applyMatrix4(jl),e.union($l))}addGeometry(t,e=-1,n=-1){if(this._initializeGeometry(t),this._validateGeometry(t),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const s=this._reservedRanges,a=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(r=s[s.length-1]),i.vertexCount=-1===e?t.getAttribute("position").count:e,i.vertexStart=null===r?0:r.vertexStart+r.vertexCount;const l=t.getIndex(),h=null!==l;if(h&&(i.indexCount=-1===n?l.count:n,i.indexStart=null===r?0:r.indexStart+r.indexCount),-1!==i.indexStart&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const c=this._visibility,u=this._active,d=this._matricesTexture,p=this._matricesTexture.image.data,f=this._colorsTexture;c.push(!0),u.push(!0);const m=this._geometryCount;this._geometryCount++,ql.toArray(p,16*m),d.needsUpdate=!0,null!==f&&(Kl.toArray(f.image.data,4*m),f.needsUpdate=!0),s.push(i),a.push({start:h?i.indexStart:i.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new On,sphereInitialized:!1,sphere:new Jn});const g=this.geometry.getAttribute(Wl);for(let v=0;v<i.vertexCount;v++)g.setX(i.vertexStart+v,m);return g.needsUpdate=!0,this.setGeometryAt(m,t),m}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),s=e.getIndex(),a=this._reservedRanges[t];if(i&&s.count>a.indexCount||e.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const o=a.vertexStart,l=a.vertexCount;for(const d in n.attributes){if(d===Wl)continue;const t=e.getAttribute(d),i=n.getAttribute(d);ah(t,i,o);const r=t.itemSize;for(let e=t.count,n=l;e<n;e++){const t=o+e;for(let e=0;e<r;e++)i.setComponent(t,e,0)}i.needsUpdate=!0,i.addUpdateRange(o*r,l*r)}if(i){const t=a.indexStart;for(let e=0;e<s.count;e++)r.setX(t+e,o+s.getX(e));for(let e=s.count,n=a.indexCount;e<n;e++)r.setX(t+e,o);r.needsUpdate=!0,r.addUpdateRange(t,a.indexCount)}const h=this._bounds[t];null!==e.boundingBox?(h.box.copy(e.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,null!==e.boundingSphere?(h.sphere.copy(e.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;const c=this._drawRanges[t],u=e.getAttribute("position");return c.count=i?s.count:u.count,this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._active;return t>=e.length||!1===e[t]||(e[t]=!1,this._visibilityChanged=!0),this}getInstanceCountAt(t){return null===this._multiDrawInstances?null:this._multiDrawInstances[t]}setInstanceCountAt(t,e){return null===this._multiDrawInstances&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[t]=e,t}getBoundingBoxAt(t,e){if(!1===this._active[t])return null;const n=this._bounds[t],i=n.box,r=this.geometry;if(!1===n.boxInitialized){i.makeEmpty();const e=r.index,s=r.attributes.position,a=this._drawRanges[t];for(let t=a.start,n=a.start+a.count;t<n;t++){let n=t;e&&(n=e.getX(n)),i.expandByPoint(th.fromBufferAttribute(s,n))}n.boxInitialized=!0}return e.copy(i),e}getBoundingSphereAt(t,e){if(!1===this._active[t])return null;const n=this._bounds[t],i=n.sphere,r=this.geometry;if(!1===n.sphereInitialized){i.makeEmpty(),this.getBoundingBoxAt(t,Ql),Ql.getCenter(i.center);const e=r.index,s=r.attributes.position,a=this._drawRanges[t];let o=0;for(let t=a.start,n=a.start+a.count;t<n;t++){let n=t;e&&(n=e.getX(n)),th.fromBufferAttribute(s,n),o=Math.max(o,i.center.distanceToSquared(th))}i.radius=Math.sqrt(o),n.sphereInitialized=!0}return e.copy(i),e}setMatrixAt(t,e){const n=this._active,i=this._matricesTexture,r=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]||(e.toArray(r,16*t),i.needsUpdate=!0),this}getMatrixAt(t,e){const n=this._active,i=this._matricesTexture.image.data;return t>=this._geometryCount||!1===n[t]?null:e.fromArray(i,16*t)}setColorAt(t,e){null===this._colorsTexture&&this._initColorsTexture();const n=this._active,i=this._colorsTexture,r=this._colorsTexture.image.data;return t>=this._geometryCount||!1===n[t]||(e.toArray(r,4*t),i.needsUpdate=!0),this}getColorAt(t,e){const n=this._active,i=this._colorsTexture.image.data;return t>=this._geometryCount||!1===n[t]?null:e.fromArray(i,4*t)}setVisibleAt(t,e){const n=this._visibility,i=this._active;return t>=this._geometryCount||!1===i[t]||n[t]===e||(n[t]=e,this._visibilityChanged=!0),this}getVisibleAt(t){const e=this._visibility,n=this._active;return!(t>=this._geometryCount||!1===n[t])&&e[t]}raycast(t,e){const n=this._visibility,i=this._active,r=this._drawRanges,s=this._geometryCount,a=this.matrixWorld,o=this.geometry;rh.material=this.material,rh.geometry.index=o.index,rh.geometry.attributes=o.attributes,null===rh.geometry.boundingBox&&(rh.geometry.boundingBox=new On),null===rh.geometry.boundingSphere&&(rh.geometry.boundingSphere=new Jn);for(let l=0;l<s;l++){if(!n[l]||!i[l])continue;const s=r[l];rh.geometry.setDrawRange(s.start,s.count),this.getMatrixAt(l,rh.matrixWorld).premultiply(a),this.getBoundingBoxAt(l,rh.geometry.boundingBox),this.getBoundingSphereAt(l,rh.geometry.boundingSphere),rh.raycast(t,sh);for(let t=0,n=sh.length;t<n;t++){const n=sh[t];n.object=this,n.batchId=l,e.push(n)}sh.length=0}rh.material=null,rh.geometry.index=null,rh.geometry.attributes={},rh.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map(t=>({...t})),this._reservedRanges=t._reservedRanges.map(t=>({...t})),this._visibility=t._visibility.slice(),this._active=t._active.slice(),this._bounds=t._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=t._maxGeometryCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),null!==this._colorsTexture&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(t,e,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=i.getIndex(),a=null===s?1:s.array.BYTES_PER_ELEMENT,o=this._active,l=this._visibility,h=this._multiDrawStarts,c=this._multiDrawCounts,u=this._drawRanges,d=this.perObjectFrustumCulled;d&&(Jl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),Zl.setFromProjectionMatrix(Jl,t.coordinateSystem));let p=0;if(this.sortObjects){Yl.copy(this.matrixWorld).invert(),th.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Yl),eh.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Yl);for(let n=0,i=l.length;n<i;n++)if(l[n]&&o[n]){this.getMatrixAt(n,jl),this.getBoundingSphereAt(n,$l).applyMatrix4(jl);let t=!1;if(d&&(t=!Zl.intersectsSphere($l)),!t){const t=nh.subVectors($l.center,th).dot(eh);ih.push(u[n],t)}}const t=ih.list,e=this.customSort;null===e?t.sort(r.transparent?Vl:Hl):e.call(this,t,n);for(let n=0,i=t.length;n<i;n++){const e=t[n];h[p]=e.start*a,c[p]=e.count,p++}ih.reset()}else for(let f=0,m=l.length;f<m;f++)if(l[f]&&o[f]){let t=!1;if(d&&(this.getMatrixAt(f,jl),this.getBoundingSphereAt(f,$l).applyMatrix4(jl),t=!Zl.intersectsSphere($l)),!t){const t=u[f];h[p]=t.start*a,c[p]=t.count,p++}}this._multiDrawCount=p,this._visibilityChanged=!1}onBeforeShadow(t,e,n,i,r,s){this.onBeforeRender(t,null,i,r,s)}}class lh extends Zi{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new qi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const hh=new Pn,ch=new Pn,uh=new si,dh=new ri,ph=new Jn,fh=new Pn,mh=new Pn;class gh extends Oi{constructor(t=new vr,e=new lh){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)hh.fromBufferAttribute(e,t-1),ch.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=hh.distanceTo(ch);t.setAttribute("lineDistance",new hr(n,1))}return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ph.copy(n.boundingSphere),ph.applyMatrix4(i),ph.radius+=r,!1===t.ray.intersectsSphere(ph))return;uh.copy(i).invert(),dh.copy(t.ray).applyMatrix4(uh);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,h=n.index,c=n.attributes.position;if(null!==h){const n=Math.max(0,s.start),i=Math.min(h.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=h.getX(r),i=h.getX(r+1),s=vh(this,t,dh,o,n,i);s&&e.push(s)}if(this.isLineLoop){const r=h.getX(i-1),s=h.getX(n),a=vh(this,t,dh,o,r,s);a&&e.push(a)}}else{const n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=vh(this,t,dh,o,r,r+1);n&&e.push(n)}if(this.isLineLoop){const r=vh(this,t,dh,o,i-1,n);r&&e.push(r)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function vh(t,e,n,i,r,s){const a=t.geometry.attributes.position;hh.fromBufferAttribute(a,r),ch.fromBufferAttribute(a,s);if(n.distanceSqToSegment(hh,ch,fh,mh)>i)return;fh.applyMatrix4(t.matrixWorld);const o=e.ray.origin.distanceTo(fh);return o<e.near||o>e.far?void 0:{distance:o,point:mh.clone().applyMatrix4(t.matrixWorld),index:r,face:null,faceIndex:null,object:t}}const yh=new Pn,xh=new Pn;class bh extends gh{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)yh.fromBufferAttribute(e,t),xh.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+yh.distanceTo(xh);t.setAttribute("lineDistance",new hr(n,1))}return this}}class _h extends gh{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Sh extends Zi{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new qi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const wh=new si,Th=new ri,Mh=new Jn,Ah=new Pn;class Eh extends Oi{constructor(t=new vr,e=new Sh){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Mh.copy(n.boundingSphere),Mh.applyMatrix4(i),Mh.radius+=r,!1===t.ray.intersectsSphere(Mh))return;wh.copy(i).invert(),Th.copy(t.ray).applyMatrix4(wh);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,h=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);Ah.fromBufferAttribute(h,r),Ch(Ah,r,o,i,t,e,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(h.count,s.start+s.count);n<r;n++)Ah.fromBufferAttribute(h,n),Ch(Ah,n,o,i,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Ch(t,e,n,i,r,s,a){const o=Th.distanceSqToPoint(t);if(o<n){const n=new Pn;Th.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:e,face:null,object:a})}}class Ph extends Sn{constructor(t,e,n,i,r,s,a,o,l,h,c,u){super(null,s,a,o,l,h,i,r,c,u),this.isCompressedTexture=!0,this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class Rh extends Sn{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Ih{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const h=n[i];return(i+(s-h)/(n[i+1]-h))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=e||(s.isVector2?new Qe:new Pn);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new Pn,i=[],r=[],s=[],a=new Pn,o=new si;for(let d=0;d<=t;d++){const e=d/t;i[d]=this.getTangentAt(e,new Pn)}r[0]=new Pn,s[0]=new Pn;let l=Number.MAX_VALUE;const h=Math.abs(i[0].x),c=Math.abs(i[0].y),u=Math.abs(i[0].z);h<=l&&(l=h,n.set(1,0,0)),c<=l&&(l=c,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let d=1;d<=t;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(i[d-1],i[d]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(je(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(o.makeRotationAxis(a,t))}s[d].crossVectors(i[d],r[d])}if(!0===e){let e=Math.acos(je(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Oh extends Ih{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e=new Qe){const n=e,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class Dh extends Oh{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function Bh(){let t=0,e=0,n=0,i=0;function r(r,s,a,o){t=r,e=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,a,o){let l=(e-t)/s-(n-t)/(s+a)+(n-e)/a,h=(n-e)/a-(i-e)/(a+o)+(i-n)/o;l*=a,h*=a,r(e,n,l,h)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}const Fh=new Pn,Lh=new Bh,Uh=new Bh,kh=new Bh;class Nh extends Ih{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new Pn){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?a=i[(l-1)%r]:(Fh.subVectors(i[0],i[1]).add(i[0]),a=Fh);const c=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(Fh.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=Fh),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),n=Math.pow(c.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(o),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),Lh.initNonuniformCatmullRom(a.x,c.x,u.x,o.x,e,n,i),Uh.initNonuniformCatmullRom(a.y,c.y,u.y,o.y,e,n,i),kh.initNonuniformCatmullRom(a.z,c.z,u.z,o.z,e,n,i)}else"catmullrom"===this.curveType&&(Lh.initCatmullRom(a.x,c.x,u.x,o.x,this.tension),Uh.initCatmullRom(a.y,c.y,u.y,o.y,this.tension),kh.initCatmullRom(a.z,c.z,u.z,o.z,this.tension));return n.set(Lh.calc(h),Uh.calc(h),kh.calc(h)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Pn).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function zh(t,e,n,i,r){const s=.5*(i-e),a=.5*(r-n),o=t*t;return(2*n-2*i+s+a)*(t*o)+(-3*n+3*i-2*s-a)*o+s*t+n}function Gh(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function Hh(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}class Vh extends Ih{constructor(t=new Qe,e=new Qe,n=new Qe,i=new Qe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Qe){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Hh(t,i.x,r.x,s.x,a.x),Hh(t,i.y,r.y,s.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Xh extends Ih{constructor(t=new Pn,e=new Pn,n=new Pn,i=new Pn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Pn){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(Hh(t,i.x,r.x,s.x,a.x),Hh(t,i.y,r.y,s.y,a.y),Hh(t,i.z,r.z,s.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Wh extends Ih{constructor(t=new Qe,e=new Qe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Qe){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Qe){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class jh extends Ih{constructor(t=new Pn,e=new Pn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new Pn){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Pn){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Yh extends Ih{constructor(t=new Qe,e=new Qe,n=new Qe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Qe){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Gh(t,i.x,r.x,s.x),Gh(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class qh extends Ih{constructor(t=new Pn,e=new Pn,n=new Pn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Pn){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Gh(t,i.x,r.x,s.x),Gh(t,i.y,r.y,s.y),Gh(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Kh extends Ih{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Qe){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],h=i[s>i.length-2?i.length-1:s+1],c=i[s>i.length-3?i.length-1:s+2];return n.set(zh(a,o.x,l.x,h.x,c.x),zh(a,o.y,l.y,h.y,c.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Qe).fromArray(n))}return this}}var Jh=Object.freeze({__proto__:null,ArcCurve:Dh,CatmullRomCurve3:Nh,CubicBezierCurve:Vh,CubicBezierCurve3:Xh,EllipseCurve:Oh,LineCurve:Wh,LineCurve3:jh,QuadraticBezierCurve:Yh,QuadraticBezierCurve3:qh,SplineCurve:Kh});class Zh extends Ih{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Jh[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const i=o[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Jh[n.type]).fromJSON(n))}return this}}class Qh extends Zh{constructor(t){super(),this.type="Path",this.currentPoint=new Qe,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new Wh(this.currentPoint.clone(),new Qe(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new Yh(this.currentPoint.clone(),new Qe(t,e),new Qe(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const a=new Vh(this.currentPoint.clone(),new Qe(t,e),new Qe(n,i),new Qe(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new Kh(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,a,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,n,i,r,s,a,o),this}absellipse(t,e,n,i,r,s,a,o){const l=new Oh(t,e,n,i,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class $h extends vr{constructor(t=[new Qe(0,-.5),new Qe(.5,0),new Qe(0,.5)],e=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=je(i,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],h=1/e,c=new Pn,u=new Qe,d=new Pn,p=new Pn,f=new Pn;let m=0,g=0;for(let v=0;v<=t.length-1;v++)switch(v){case 0:m=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(f.x,f.y,f.z);break;default:m=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=e;v++){const r=n+v*h*i,d=Math.sin(r),p=Math.cos(r);for(let n=0;n<=t.length-1;n++){c.x=t[n].x*d,c.y=t[n].y,c.z=t[n].x*p,s.push(c.x,c.y,c.z),u.x=v/e,u.y=n/(t.length-1),a.push(u.x,u.y);const i=o[3*n+0]*d,r=o[3*n+1],h=o[3*n+0]*p;l.push(i,r,h)}}for(let v=0;v<e;v++)for(let e=0;e<t.length-1;e++){const n=e+v*t.length,i=n,s=n+t.length,a=n+t.length+1,o=n+1;r.push(i,s,o),r.push(a,o,s)}this.setIndex(r),this.setAttribute("position",new hr(s,3)),this.setAttribute("uv",new hr(a,2)),this.setAttribute("normal",new hr(l,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new $h(t.points,t.segments,t.phiStart,t.phiLength)}}class tc extends $h{constructor(t=1,e=1,n=4,i=8){const r=new Qh;r.absarc(0,-e/2,t,1.5*Math.PI,0),r.absarc(0,e/2,t,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:n,radialSegments:i}}static fromJSON(t){return new tc(t.radius,t.length,t.capSegments,t.radialSegments)}}class ec extends vr{constructor(t=1,e=32,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],s=[],a=[],o=[],l=new Pn,h=new Qe;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let c=0,u=3;c<=e;c++,u+=3){const r=n+c/e*i;l.x=t*Math.cos(r),l.y=t*Math.sin(r),s.push(l.x,l.y,l.z),a.push(0,0,1),h.x=(s[u]/t+1)/2,h.y=(s[u+1]/t+1)/2,o.push(h.x,h.y)}for(let c=1;c<=e;c++)r.push(c,c+1,0);this.setIndex(r),this.setAttribute("position",new hr(s,3)),this.setAttribute("normal",new hr(a,3)),this.setAttribute("uv",new hr(o,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ec(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class nc extends vr{constructor(t=1,e=1,n=1,i=32,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),r=Math.floor(r);const h=[],c=[],u=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,s=new Qe,f=new Pn;let v=0;const y=!0===n?t:e,x=!0===n?1:-1;for(let t=1;t<=i;t++)c.push(0,m*x,0),u.push(0,x,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=i;t++){const e=t/i*o+a,n=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*x,f.z=y*n,c.push(f.x,f.y,f.z),u.push(0,x,0),s.x=.5*n+.5,s.y=.5*r*x+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=b+t;!0===n?h.push(i,i+1,e):h.push(i+1,i,e),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new Pn,v=new Pn;let y=0;const x=(e-t)/n;for(let l=0;l<=r;l++){const h=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*o+a,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,c.push(v.x,v.y,v.z),s.set(l,x,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),h.push(p++)}f.push(h)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];h.push(n,i,s),h.push(i,r,s),y+=6}l.addGroup(g,y,0),g+=y}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new hr(c,3)),this.setAttribute("normal",new hr(u,3)),this.setAttribute("uv",new hr(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new nc(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ic extends nc{constructor(t=1,e=1,n=32,i=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new ic(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class rc extends vr{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function a(t,e,n,i){const r=i+1,s=[];for(let a=0;a<=r;a++){s[a]=[];const i=t.clone().lerp(n,a/r),o=e.clone().lerp(n,a/r),l=r-a;for(let t=0;t<=l;t++)s[a][t]=0===t&&a===r?i:i.clone().lerp(o,t/l)}for(let a=0;a<r;a++)for(let t=0;t<2*(r-a)-1;t++){const e=Math.floor(t/2);t%2==0?(o(s[a][e+1]),o(s[a+1][e]),o(s[a][e])):(o(s[a][e+1]),o(s[a+1][e+1]),o(s[a+1][e]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function h(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}function u(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){const n=new Pn,i=new Pn,r=new Pn;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],i),l(e[s+2],r),a(n,i,r,t)}(i),function(t){const e=new Pn;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new Pn;for(let e=0;e<r.length;e+=3){t.x=r[e+0],t.y=r[e+1],t.z=r[e+2];const n=c(t)/2/Math.PI+.5,i=u(t)/Math.PI+.5;s.push(n,1-i)}(function(){const t=new Pn,e=new Pn,n=new Pn,i=new Pn,a=new Qe,o=new Qe,l=new Qe;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=c(i);h(a,d+0,t,p),h(o,d+2,e,p),h(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),a=Math.min(e,n,i);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new hr(r,3)),this.setAttribute("normal",new hr(r.slice(),3)),this.setAttribute("uv",new hr(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new rc(t.vertices,t.indices,t.radius,t.details)}}class sc extends rc{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new sc(t.radius,t.detail)}}const ac=new Pn,oc=new Pn,lc=new Pn,hc=new Vi;class cc extends vr{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,i=Math.pow(10,n),r=Math.cos(Ve*e),s=t.getIndex(),a=t.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],h=["a","b","c"],c=new Array(3),u={},d=[];for(let t=0;t<o;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:n,c:o}=hc;if(e.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),hc.getNormal(lc),c[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,c[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,c[2]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=c[t],i=c[e],s=hc[h[t]],a=hc[h[e]],o=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(lc.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[t],index1:l[e],normal:lc.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:n}=u[t];ac.fromBufferAttribute(a,e),oc.fromBufferAttribute(a,n),d.push(ac.x,ac.y,ac.z),d.push(oc.x,oc.y,oc.z)}this.setAttribute("position",new hr(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class uc extends Qh{constructor(t){super(t),this.uuid=We(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new Qh).fromJSON(n))}return this}}const dc=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=pc(t,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,h,c,u,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,a,o,l,h;for(s=0,a=e.length;s<a;s++)o=e[s]*i,l=s<a-1?e[s+1]*i:t.length,h=pc(t,o,l,i,!1),h===h.next&&(h.steiner=!0),r.push(Tc(h));for(r.sort(bc),s=0;s<r.length;s++)n=_c(r[s],n);return n}(t,e,s,n)),t.length>80*n){o=h=t[0],l=c=t[1];for(let e=n;e<r;e+=n)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-o,c-l),p=0!==p?32767/p:0}return mc(s,a,n,o,l,p,0),a};function pc(t,e,n,i,r){let s,a;if(r===function(t,e,n,i){let r=0;for(let s=e,a=n-i;s<n;s+=i)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)a=Bc(s,t[s],t[s+1],a);else for(s=n-i;s>=e;s-=i)a=Bc(s,t[s],t[s+1],a);return a&&Cc(a,a.next)&&(Fc(a),a=a.next),a}function fc(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!Cc(i,i.next)&&0!==Ec(i.prev,i,i.next))i=i.next;else{if(Fc(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function mc(t,e,n,i,r,s,a){if(!t)return;!a&&s&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=wc(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,a,o,l,h=1;do{for(n=t,t=null,s=null,a=0;n;){for(a++,i=n,o=0,e=0;e<h&&(o++,i=i.nextZ,i);e++);for(l=h;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,h*=2}while(a>1)}(r)}(t,i,r,s);let o,l,h=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?vc(t,i,r,s):gc(t))e.push(o.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),Fc(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?mc(t=yc(fc(t),e,n),e,n,i,r,s,2):2===a&&xc(t,e,n,i,r,s):mc(fc(t),e,n,i,r,s,1);break}}function gc(t){const e=t.prev,n=t,i=t.next;if(Ec(e,n,i)>=0)return!1;const r=e.x,s=n.x,a=i.x,o=e.y,l=n.y,h=i.y,c=r<s?r<a?r:a:s<a?s:a,u=o<l?o<h?o:h:l<h?l:h,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>h?o:h:l>h?l:h;let f=i.next;for(;f!==e;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&Mc(r,o,s,l,a,h,f.x,f.y)&&Ec(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function vc(t,e,n,i){const r=t.prev,s=t,a=t.next;if(Ec(r,s,a)>=0)return!1;const o=r.x,l=s.x,h=a.x,c=r.y,u=s.y,d=a.y,p=o<l?o<h?o:h:l<h?l:h,f=c<u?c<d?c:d:u<d?u:d,m=o>l?o>h?o:h:l>h?l:h,g=c>u?c>d?c:d:u>d?u:d,v=wc(p,f,e,n,i),y=wc(m,g,e,n,i);let x=t.prevZ,b=t.nextZ;for(;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Mc(o,c,l,u,h,d,x.x,x.y)&&Ec(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Mc(o,c,l,u,h,d,b.x,b.y)&&Ec(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Mc(o,c,l,u,h,d,x.x,x.y)&&Ec(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Mc(o,c,l,u,h,d,b.x,b.y)&&Ec(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function yc(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Cc(r,s)&&Pc(r,i,i.next,s)&&Oc(r,s)&&Oc(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),Fc(i),Fc(i.next),i=t=s),i=i.next}while(i!==t);return fc(i)}function xc(t,e,n,i,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Ac(a,t)){let o=Dc(a,t);return a=fc(a,a.next),o=fc(o,o.next),mc(a,e,n,i,r,s,0),void mc(o,e,n,i,r,s,0)}t=t.next}a=a.next}while(a!==t)}function bc(t,e){return t.x-e.x}function _c(t,e){const n=function(t,e){let n,i=e,r=-1/0;const s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const t=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>r&&(r=t,n=i.x<i.next.x?i:i.next,t===s))return n}i=i.next}while(i!==e);if(!n)return null;const o=n,l=n.x,h=n.y;let c,u=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&Mc(a<h?s:r,a,l,h,a<h?r:s,a,i.x,i.y)&&(c=Math.abs(a-i.y)/(s-i.x),Oc(i,t)&&(c<u||c===u&&(i.x>n.x||i.x===n.x&&Sc(n,i)))&&(n=i,u=c)),i=i.next}while(i!==o);return n}(t,e);if(!n)return e;const i=Dc(n,t);return fc(i,i.next),fc(n,n.next)}function Sc(t,e){return Ec(t.prev,t,e.prev)<0&&Ec(e.next,t,t.next)<0}function wc(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tc(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Mc(t,e,n,i,r,s,a,o){return(r-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(i-o)>=(n-a)*(e-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Ac(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Pc(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Oc(t,e)&&Oc(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Ec(t.prev,t,e.prev)||Ec(t,e.prev,e))||Cc(t,e)&&Ec(t.prev,t,t.next)>0&&Ec(e.prev,e,e.next)>0)}function Ec(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Cc(t,e){return t.x===e.x&&t.y===e.y}function Pc(t,e,n,i){const r=Ic(Ec(t,e,n)),s=Ic(Ec(t,e,i)),a=Ic(Ec(n,i,t)),o=Ic(Ec(n,i,e));return r!==s&&a!==o||(!(0!==r||!Rc(t,n,e))||(!(0!==s||!Rc(t,i,e))||(!(0!==a||!Rc(n,t,i))||!(0!==o||!Rc(n,e,i)))))}function Rc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ic(t){return t>0?1:t<0?-1:0}function Oc(t,e){return Ec(t.prev,t,t.next)<0?Ec(t,e,t.next)>=0&&Ec(t,t.prev,e)>=0:Ec(t,e,t.prev)<0||Ec(t,t.next,e)<0}function Dc(t,e){const n=new Lc(t.i,t.x,t.y),i=new Lc(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Bc(t,e,n,i){const r=new Lc(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Fc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lc(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Uc{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return Uc.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];kc(t),Nc(n,t);let s=t.length;e.forEach(kc);for(let o=0;o<e.length;o++)i.push(s),s+=e[o].length,Nc(n,e[o]);const a=dc(n,i);for(let o=0;o<a.length;o+=3)r.push(a.slice(o,o+3));return r}}function kc(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Nc(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class zc extends vr{constructor(t=new uc([new Qe(.5,.5),new Qe(-.5,.5),new Qe(-.5,-.5),new Qe(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let a=0,o=t.length;a<o;a++){s(t[a])}function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:c-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Gc;let g,v,y,x,b,_=!1;f&&(g=f.getSpacedPoints(o),_=!0,h=!1,v=f.computeFrenetFrames(o,!1),y=new Pn,x=new Pn,b=new Pn),h||(p=0,c=0,u=0,d=0);const S=t.extractPoints(a);let w=S.shape;const T=S.holes;if(!Uc.isClockWise(w)){w=w.reverse();for(let t=0,e=T.length;t<e;t++){const e=T[t];Uc.isClockWise(e)&&(T[t]=e.reverse())}}const M=Uc.triangulateShape(w,T),A=w;for(let e=0,n=T.length;e<n;e++){const t=T[e];w=w.concat(t)}function E(t,e,n){return t.clone().addScaledVector(e,n)}const C=w.length,P=M.length;function R(t,e,n){let i,r,s;const a=t.x-e.x,o=t.y-e.y,l=n.x-t.x,h=n.y-t.y,c=a*a+o*o,u=a*h-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=e.x-o/u,f=e.y+a/u,m=((n.x-h/d-p)*h-(n.y+l/d-f)*l)/(a*h-o*l);i=p+a*m-t.x,r=f+o*m-t.y;const g=i*i+r*r;if(g<=2)return new Qe(i,r);s=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(h)&&(t=!0),t?(i=-o,r=a,s=Math.sqrt(c)):(i=a,r=o,s=Math.sqrt(c/2))}return new Qe(i/s,r/s)}const I=[];for(let e=0,n=A.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),I[e]=R(A[e],A[i],A[r]);const O=[];let D,B=I.concat();for(let e=0,n=T.length;e<n;e++){const t=T[e];D=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),D[e]=R(t[e],t[i],t[r]);O.push(D),B=B.concat(D)}for(let e=0;e<p;e++){const t=e/p,n=c*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,r=A.length;e<r;e++){const t=E(A[e],I[e],i);U(t.x,t.y,-n)}for(let e=0,r=T.length;e<r;e++){const t=T[e];D=O[e];for(let e=0,r=t.length;e<r;e++){const r=E(t[e],D[e],i);U(r.x,r.y,-n)}}}const F=u+d;for(let e=0;e<C;e++){const t=h?E(w[e],B[e],F):w[e];_?(x.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(x).add(y),U(b.x,b.y,b.z)):U(t.x,t.y,0)}for(let e=1;e<=o;e++)for(let t=0;t<C;t++){const n=h?E(w[t],B[t],F):w[t];_?(x.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(x).add(y),U(b.x,b.y,b.z)):U(n.x,n.y,l/o*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=c*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,r=A.length;e<r;e++){const t=E(A[e],I[e],i);U(t.x,t.y,l+n)}for(let e=0,r=T.length;e<r;e++){const t=T[e];D=O[e];for(let e=0,r=t.length;e<r;e++){const r=E(t[e],D[e],i);_?U(r.x,r.y+g[o-1].y,g[o-1].x+n):U(r.x,r.y,l+n)}}}function L(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=o+2*p;t<n;t++){const n=C*t,s=C*(t+1);N(e+i+n,e+r+n,e+r+s,e+i+s)}}}function U(t,e,n){s.push(t),s.push(e),s.push(n)}function k(t,e,r){z(t),z(e),z(r);const s=i.length/3,a=m.generateTopUV(n,i,s-3,s-2,s-1);G(a[0]),G(a[1]),G(a[2])}function N(t,e,r,s){z(t),z(e),z(s),z(e),z(r),z(s);const a=i.length/3,o=m.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[3]),G(o[1]),G(o[2]),G(o[3])}function z(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function G(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(h){let t=0,e=C*t;for(let n=0;n<P;n++){const t=M[n];k(t[2]+e,t[1]+e,t[0]+e)}t=o+2*p,e=C*t;for(let n=0;n<P;n++){const t=M[n];k(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<P;t++){const e=M[t];k(e[2],e[1],e[0])}for(let t=0;t<P;t++){const e=M[t];k(e[0]+C*o,e[1]+C*o,e[2]+C*o)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;L(A,e),e+=A.length;for(let n=0,i=T.length;n<i;n++){const t=T[n];L(t,e),e+=t.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new hr(i,3)),this.setAttribute("uv",new hr(r,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const e=t[i];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let r=0,s=t.shapes.length;r<s;r++){const i=e[t.shapes[r]];n.push(i)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Jh[i.type]).fromJSON(i)),new zc(n,t.options)}}const Gc={generateTopUV:function(t,e,n,i,r){const s=e[3*n],a=e[3*n+1],o=e[3*i],l=e[3*i+1],h=e[3*r],c=e[3*r+1];return[new Qe(s,a),new Qe(o,l),new Qe(h,c)]},generateSideWallUV:function(t,e,n,i,r,s){const a=e[3*n],o=e[3*n+1],l=e[3*n+2],h=e[3*i],c=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(o-c)<Math.abs(a-h)?[new Qe(a,1-l),new Qe(h,1-u),new Qe(d,1-f),new Qe(m,1-v)]:[new Qe(o,1-l),new Qe(c,1-u),new Qe(p,1-f),new Qe(g,1-v)]}};class Hc extends rc{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Hc(t.radius,t.detail)}}class Vc extends rc{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Vc(t.radius,t.detail)}}class Xc extends vr{constructor(t=.5,e=1,n=32,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],h=[];let c=t;const u=(e-t)/(i=Math.max(1,i)),d=new Pn,p=new Qe;for(let f=0;f<=i;f++){for(let t=0;t<=n;t++){const i=r+t/n*s;d.x=c*Math.cos(i),d.y=c*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,h.push(p.x,p.y)}c+=u}for(let f=0;f<i;f++){const t=f*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,s=i+n+1,o=i+n+2,l=i+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new hr(o,3)),this.setAttribute("normal",new hr(l,3)),this.setAttribute("uv",new hr(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Xc(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Wc extends vr{constructor(t=new uc([new Qe(0,.5),new Qe(-.5,-.5),new Qe(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let h=0;h<t.length;h++)l(t[h]),this.addGroup(a,o,h),a+=o,o=0;function l(t){const a=i.length/3,l=t.extractPoints(e);let h=l.shape;const c=l.holes;!1===Uc.isClockWise(h)&&(h=h.reverse());for(let e=0,n=c.length;e<n;e++){const t=c[e];!0===Uc.isClockWise(t)&&(c[e]=t.reverse())}const u=Uc.triangulateShape(h,c);for(let e=0,n=c.length;e<n;e++){const t=c[e];h=h.concat(t)}for(let e=0,n=h.length;e<n;e++){const t=h[e];i.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,i=u.length;e<i;e++){const t=u[e],i=t[0]+a,r=t[1]+a,s=t[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new hr(i,3)),this.setAttribute("normal",new hr(r,3)),this.setAttribute("uv",new hr(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new Wc(n,t.curveSegments)}}class jc extends vr{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const h=[],c=new Pn,u=new Pn,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let y=0;0===g&&0===s?y=.5/e:g===n&&o===Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const o=n/e;c.x=-t*Math.cos(i+o*r)*Math.sin(s+v*a),c.y=t*Math.cos(s+v*a),c.z=t*Math.sin(i+o*r)*Math.sin(s+v*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-v),d.push(l++)}h.push(d)}for(let g=0;g<n;g++)for(let t=0;t<e;t++){const e=h[g][t+1],i=h[g][t],r=h[g+1][t],a=h[g+1][t+1];(0!==g||s>0)&&d.push(e,i,a),(g!==n-1||o<Math.PI)&&d.push(i,r,a)}this.setIndex(d),this.setAttribute("position",new hr(p,3)),this.setAttribute("normal",new hr(f,3)),this.setAttribute("uv",new hr(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new jc(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Yc extends rc{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Yc(t.radius,t.detail)}}class qc extends vr{constructor(t=1,e=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],h=new Pn,c=new Pn,u=new Pn;for(let d=0;d<=n;d++)for(let s=0;s<=i;s++){const p=s/i*r,f=d/n*Math.PI*2;c.x=(t+e*Math.cos(f))*Math.cos(p),c.y=(t+e*Math.cos(f))*Math.sin(p),c.z=e*Math.sin(f),a.push(c.x,c.y,c.z),h.x=t*Math.cos(p),h.y=t*Math.sin(p),u.subVectors(c,h).normalize(),o.push(u.x,u.y,u.z),l.push(s/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let t=1;t<=i;t++){const e=(i+1)*d+t-1,n=(i+1)*(d-1)+t-1,r=(i+1)*(d-1)+t,a=(i+1)*d+t;s.push(e,n,a),s.push(n,r,a)}this.setIndex(s),this.setAttribute("position",new hr(a,3)),this.setAttribute("normal",new hr(o,3)),this.setAttribute("uv",new hr(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new qc(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Kc extends vr{constructor(t=1,e=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],h=[],c=new Pn,u=new Pn,d=new Pn,p=new Pn,f=new Pn,m=new Pn,g=new Pn;for(let y=0;y<=n;++y){const a=y/n*r*Math.PI*2;v(a,r,s,t,d),v(a+.01,r,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,s=-e*Math.cos(r),a=e*Math.sin(r);c.x=d.x+(s*g.x+a*f.x),c.y=d.y+(s*g.y+a*f.y),c.z=d.z+(s*g.z+a*f.z),o.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(y/n),h.push(t/i)}}for(let y=1;y<=n;y++)for(let t=1;t<=i;t++){const e=(i+1)*(y-1)+(t-1),n=(i+1)*y+(t-1),r=(i+1)*y+t,s=(i+1)*(y-1)+t;a.push(e,n,s),a.push(n,r,s)}function v(t,e,n,i,r){const s=Math.cos(t),a=Math.sin(t),o=n/e*t,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new hr(o,3)),this.setAttribute("normal",new hr(l,3)),this.setAttribute("uv",new hr(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Kc(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Jc extends vr{constructor(t=new qh(new Pn(-1,-1,0),new Pn(-1,1,0),new Pn(1,1,0)),e=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new Pn,o=new Pn,l=new Qe;let h=new Pn;const c=[],u=[],d=[],p=[];function f(r){h=t.getPointAt(r/e,h);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=h.x+n*o.x,a.y=h.y+n*o.y,a.z=h.z+n*o.z,c.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)l.x=t/e,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,a=(i+1)*(t-1)+e;p.push(n,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new hr(c,3)),this.setAttribute("normal",new hr(u,3)),this.setAttribute("uv",new hr(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Jc((new Jh[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Zc extends vr{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],n=new Set,i=new Pn,r=new Pn;if(null!==t.index){const s=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],h=l.start;for(let t=h,o=h+l.count;t<o;t+=3)for(let l=0;l<3;l++){const o=a.getX(t+l),h=a.getX(t+(l+1)%3);i.fromBufferAttribute(s,o),r.fromBufferAttribute(s,h),!0===Qc(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,a=s.count/3;t<a;t++)for(let o=0;o<3;o++){const a=3*t+o,l=3*t+(o+1)%3;i.fromBufferAttribute(s,a),r.fromBufferAttribute(s,l),!0===Qc(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new hr(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function Qc(t,e,n){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var $c=Object.freeze({__proto__:null,BoxGeometry:Ur,CapsuleGeometry:tc,CircleGeometry:ec,ConeGeometry:ic,CylinderGeometry:nc,DodecahedronGeometry:sc,EdgesGeometry:cc,ExtrudeGeometry:zc,IcosahedronGeometry:Hc,LatheGeometry:$h,OctahedronGeometry:Vc,PlaneGeometry:os,PolyhedronGeometry:rc,RingGeometry:Xc,ShapeGeometry:Wc,SphereGeometry:jc,TetrahedronGeometry:Yc,TorusGeometry:qc,TorusKnotGeometry:Kc,TubeGeometry:Jc,WireframeGeometry:Zc});class tu extends Zi{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new qi(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class eu extends Hr{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class nu extends Zi{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new qi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class iu extends nu{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Qe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return je(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new qi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new qi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new qi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class ru extends Zi{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new qi(16777215),this.specular=new qi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mi,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class su extends Zi{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new qi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class au extends Zi{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class ou extends Zi{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new qi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mi,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class lu extends Zi{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new qi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class hu extends lh{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function cu(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function uu(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function du(t){const e=t.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort(function(e,n){return t[e]-t[n]}),n}function pu(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[a++]=t[i+n]}return r}function fu(t,e,n,i){let r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(e.push(s.time),n.push.apply(n,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(e.push(s.time),a.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(e.push(s.time),n.push(a)),s=t[r++]}while(void 0!==s)}const mu={convertArray:cu,isTypedArray:uu,getKeyframeOrder:du,sortedArray:pu,flattenJSON:fu,subclip:function(t,e,n,i,r=30){const s=t.clone();s.name=e;const a=[];for(let l=0;l<s.tracks.length;++l){const t=s.tracks[l],e=t.getValueSize(),o=[],h=[];for(let s=0;s<t.times.length;++s){const a=t.times[s]*r;if(!(a<n||a>=i)){o.push(t.times[s]);for(let n=0;n<e;++n)h.push(t.values[s*e+n])}}0!==o.length&&(t.times=cu(o,t.times.constructor),t.values=cu(h,t.values.constructor),a.push(t))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,s=e/i;for(let a=0;a<r;++a){const e=n.tracks[a],i=e.ValueTypeName;if("bool"===i||"string"===i)continue;const r=t.tracks.find(function(t){return t.name===e.name&&t.ValueTypeName===i});if(void 0===r)continue;let o=0;const l=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let h=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=c/3);const u=e.times.length-1;let d;if(s<=e.times[0]){const t=o,n=l-o;d=e.values.slice(t,n)}else if(s>=e.times[u]){const t=u*l+o,n=t+l-o;d=e.values.slice(t,n)}else{const t=e.createInterpolant(),n=o,i=l-o;t.evaluate(s),d=t.resultBuffer.slice(n,i)}if("quaternion"===i){(new Cn).fromArray(d).normalize().conjugate().toArray(d)}const p=r.times.length;for(let t=0;t<p;++t){const e=t*c+h;if("quaternion"===i)Cn.multiplyQuaternionsFlat(r.values,e,d,0,r.values,e);else{const t=c-2*h;for(let n=0;n<t;++n)r.values[e+n]-=d[n]}}}return t.blendMode=fe,t}};class gu{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(!(t>=r)){const a=e[1];t<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0;break n}break t}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let s=0;s!==i;++s)e[s]=n[r+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class vu extends gu{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ce,endingEnd:ce}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case ue:r=t,a=2*e-n;break;case de:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case ue:s=t,o=2*n-e;break;case de:s=1,o=n+i[1]-i[0];break;default:s=t-1,o=e}const l=.5*(n-e),h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-n),this._offsetPrev=r*h,this._offsetNext=s*h}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let b=0;b!==a;++b)r[b]=g*s[h+b]+v*s[l+b]+y*s[o+b]+x*s[c+b];return r}}class yu extends gu{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=(n-e)/(i-e),c=1-h;for(let u=0;u!==a;++u)r[u]=s[l+u]*c+s[o+u]*h;return r}}class xu extends gu{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class bu{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=cu(e,this.TimeBufferType),this.values=cu(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:cu(t.times,Array),values:cu(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new xu(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new yu(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new vu(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case oe:e=this.InterpolantFactoryMethodDiscrete;break;case le:e=this.InterpolantFactoryMethodLinear;break;case he:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return oe;case this.InterpolantFactoryMethodLinear:return le;case this.InterpolantFactoryMethodSmooth:return he}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(t=!1);let s=null;for(let a=0;a!==r;a++){const e=n[a];if("number"==typeof e&&isNaN(e)){t=!1;break}if(null!==s&&s>e){t=!1;break}s=e}if(void 0!==i&&uu(i))for(let a=0,o=i.length;a!==o;++a){const e=i[a];if(isNaN(e)){t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===he,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(i)r=!0;else{const t=a*n,i=t-n,s=t+n;for(let a=0;a!==n;++a){const n=e[t+a];if(n!==e[i+a]||n!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const i=a*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,a=0;a!==n;++a)e[i+a]=e[t+a];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}bu.prototype.TimeBufferType=Float32Array,bu.prototype.ValueBufferType=Float32Array,bu.prototype.DefaultInterpolation=le;class _u extends bu{constructor(t,e,n){super(t,e,n)}}_u.prototype.ValueTypeName="bool",_u.prototype.ValueBufferType=Array,_u.prototype.DefaultInterpolation=oe,_u.prototype.InterpolantFactoryMethodLinear=void 0,_u.prototype.InterpolantFactoryMethodSmooth=void 0;class Su extends bu{}Su.prototype.ValueTypeName="color";class wu extends bu{}wu.prototype.ValueTypeName="number";class Tu extends gu{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-e)/(i-e);let l=t*a;for(let h=l+a;l!==h;l+=4)Cn.slerpFlat(r,0,s,l-a,s,l,o);return r}}class Mu extends bu{InterpolantFactoryMethodLinear(t){return new Tu(this.times,this.values,this.getValueSize(),t)}}Mu.prototype.ValueTypeName="quaternion",Mu.prototype.InterpolantFactoryMethodSmooth=void 0;class Au extends bu{constructor(t,e,n){super(t,e,n)}}Au.prototype.ValueTypeName="string",Au.prototype.ValueBufferType=Array,Au.prototype.DefaultInterpolation=oe,Au.prototype.InterpolantFactoryMethodLinear=void 0,Au.prototype.InterpolantFactoryMethodSmooth=void 0;class Eu extends bu{}Eu.prototype.ValueTypeName="vector";class Cu{constructor(t="",e=-1,n=[],i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=We(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let s=0,a=n.length;s!==a;++s)e.push(Pu(n[s]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,s=n.length;r!==s;++r)e.push(bu.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let a=0;a<r;a++){let t=[],o=[];t.push((a+r-1)%r,a,(a+1)%r),o.push(0,1,0);const l=du(t);t=pu(t,1,l),o=pu(o,1,l),i||0!==t[0]||(t.push(r),o.push(o[0])),s.push(new wu(".morphTargetInfluences["+e[a].name+"]",t,o).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=t.length;a<o;a++){const e=t[a],n=e.name.match(r);if(n&&n.length>1){const t=n[1];let r=i[t];r||(i[t]=r=[]),r.push(e)}}const s=[];for(const a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],e,n));return s}static parseAnimation(t,e){if(!t)return null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],a=[];fu(n,s,a,i),0!==s.length&&r.push(new t(e,s,a))}},i=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let h=0;h<l.length;h++){const t=l[h].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let n;for(n=0;n<t.length;n++)if(t[n].morphTargets)for(let i=0;i<t[n].morphTargets.length;i++)e[t[n].morphTargets[i]]=-1;for(const r in e){const e=[],s=[];for(let i=0;i!==t[n].morphTargets.length;++i){const i=t[n];e.push(i.time),s.push(i.morphTarget===r?1:0)}i.push(new wu(".morphTargetInfluence["+r+"]",e,s))}o=e.length*s}else{const r=".bones["+e[h].name+"]";n(Eu,r+".position",t,"pos",i),n(Mu,r+".quaternion",t,"rot",i),n(Eu,r+".scale",t,"scl",i)}}if(0===i.length)return null;return new this(r,o,i,a)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Pu(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wu;case"vector":case"vector2":case"vector3":case"vector4":return Eu;case"color":return Su;case"quaternion":return Mu;case"bool":case"boolean":return _u;case"string":return Au}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];fu(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Ru={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Iu{constructor(t,e,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===s&&void 0!==i.onStart&&i.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const Ou=new Iu;let Du=class{constructor(t){this.manager=void 0!==t?t:Ou,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(i,r){n.load(t,i,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}};Du.DEFAULT_MATERIAL_NAME="__DEFAULT";const Bu={};class Fu extends Error{constructor(t,e){super(t),this.response=e}}class Lu extends Du{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Ru.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(void 0!==Bu[t])return void Bu[t].push({onLoad:e,onProgress:n,onError:i});Bu[t]=[],Bu[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(e=>{if(200===e.status||0===e.status){if(e.status,"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=Bu[t],i=e.body.getReader(),r=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(t){!function e(){i.read().then(({done:i,value:r})=>{if(i)t.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}},e=>{t.error(e)})}()}});return new Response(l)}throw new Fu(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)}).then(t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(t=>(new DOMParser).parseFromString(t,a));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then(t=>i.decode(t))}}}).then(e=>{Ru.add(t,e);const n=Bu[t];delete Bu[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}}).catch(e=>{const n=Bu[t];if(void 0===n)throw this.manager.itemError(t),e;delete Bu[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Uu extends Du{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ru.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;const a=sn("img");function o(){h(),Ru.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){h(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class ku extends Du{constructor(t){super(t)}load(t,e,n,i){const r=new Jr;r.colorSpace=ye;const s=new Uu(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(t[n],function(t){r.images[n]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r))},void 0,i)}for(let l=0;l<t.length;++l)o(l);return r}}class Nu extends Du{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Pl,a=new Lu(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,function(t){let n;try{n=r.parse(t)}catch(a){if(void 0===i)return;i(a)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:rt,s.wrapT=void 0!==n.wrapT?n.wrapT:rt,s.magFilter=void 0!==n.magFilter?n.magFilter:ht,s.minFilter=void 0!==n.minFilter?n.minFilter:ht,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(s.colorSpace=n.colorSpace),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=ut),1===n.mipmapCount&&(s.minFilter=ht),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n)},n,i),s}}class zu extends Du{constructor(t){super(t)}load(t,e,n,i){const r=new Sn,s=new Uu(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)},n,i),r}}class Gu extends Oi{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new qi(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}let Hu=class extends Gu{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Oi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new qi(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}};const Vu=new si,Xu=new Pn,Wu=new Pn;class ju{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Qe(512,512),this.map=null,this.mapPass=null,this.matrix=new si,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new rs,this._frameExtents=new Qe(1,1),this._viewportCount=1,this._viewports=[new wn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;Xu.setFromMatrixPosition(t.matrixWorld),e.position.copy(Xu),Wu.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Wu),e.updateMatrixWorld(),Vu.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Vu),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Vu)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Yu extends ju{constructor(){super(new Yr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*Xe*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}let qu=class extends Gu{constructor(t,e,n=0,i=Math.PI/3,r=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Oi.DEFAULT_UP),this.updateMatrix(),this.target=new Oi,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new Yu}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}};const Ku=new si,Ju=new Pn,Zu=new Pn;class Qu extends ju{constructor(){super(new Yr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Qe(4,2),this._viewportCount=6,this._viewports=[new wn(2,1,1,1),new wn(0,1,1,1),new wn(3,1,1,1),new wn(1,1,1,1),new wn(3,0,1,1),new wn(1,0,1,1)],this._cubeDirections=[new Pn(1,0,0),new Pn(-1,0,0),new Pn(0,0,1),new Pn(0,0,-1),new Pn(0,1,0),new Pn(0,-1,0)],this._cubeUps=[new Pn(0,1,0),new Pn(0,1,0),new Pn(0,1,0),new Pn(0,1,0),new Pn(0,0,1),new Pn(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Ju.setFromMatrixPosition(t.matrixWorld),n.position.copy(Ju),Zu.copy(n.position),Zu.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Zu),n.updateMatrixWorld(),i.makeTranslation(-Ju.x,-Ju.y,-Ju.z),Ku.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ku)}}let $u=class extends Gu{constructor(t,e,n=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Qu}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}};class td extends ju{constructor(){super(new bs(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}let ed=class extends Gu{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Oi.DEFAULT_UP),this.updateMatrix(),this.target=new Oi,this.shadow=new td}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},nd=class extends Gu{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}};class id extends Gu{constructor(t,e,n=10,i=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class rd{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Pn)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],n*r*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*n*r),e.addScaledVector(s[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}class sd extends Gu{constructor(t=new rd,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class ad extends Du{constructor(t){super(t),this.textures={}}load(t,e,n,i){const r=this,s=new Lu(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(s){i&&i(s),r.manager.itemError(t)}},n,i)}parse(t){const e=this.textures;function n(t){return e[t],e[t]}const i=ad.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new qi).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.dispersion&&(i.dispersion=t.dispersion),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(i.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(i.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(i.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(i.depthFunc=t.depthFunc),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(i.blendSrc=t.blendSrc),void 0!==t.blendDst&&(i.blendDst=t.blendDst),void 0!==t.blendEquation&&(i.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(i.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(i.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(i.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(i.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),void 0!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(i.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const r in t.uniforms){const e=t.uniforms[r];switch(i.uniforms[r]={},e.type){case"t":i.uniforms[r].value=n(e.value);break;case"c":i.uniforms[r].value=(new qi).setHex(e.value);break;case"v2":i.uniforms[r].value=(new Qe).fromArray(e.value);break;case"v3":i.uniforms[r].value=(new Pn).fromArray(e.value);break;case"v4":i.uniforms[r].value=(new wn).fromArray(e.value);break;case"m3":i.uniforms[r].value=(new $e).fromArray(e.value);break;case"m4":i.uniforms[r].value=(new si).fromArray(e.value);break;default:i.uniforms[r].value=e.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(const r in t.extensions)i.extensions[r]=t.extensions[r];if(void 0!==t.lights&&(i.lights=t.lights),void 0!==t.clipping&&(i.clipping=t.clipping),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Qe).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapRotation&&i.envMapRotation.fromArray(t.envMapRotation),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Qe).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=n(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=n(t.thicknessMap)),void 0!==t.anisotropyMap&&(i.anisotropyMap=n(t.anisotropyMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){return new{ShadowMaterial:tu,SpriteMaterial:$o,RawShaderMaterial:eu,ShaderMaterial:Hr,PointsMaterial:Sh,MeshPhysicalMaterial:iu,MeshStandardMaterial:nu,MeshPhongMaterial:ru,MeshToonMaterial:su,MeshNormalMaterial:au,MeshLambertMaterial:ou,MeshDepthMaterial:Ro,MeshDistanceMaterial:Io,MeshBasicMaterial:Qi,MeshMatcapMaterial:lu,LineDashedMaterial:hu,LineBasicMaterial:lh,Material:Zi}[t]}}class od{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(n){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class ld extends vr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class hd extends Du{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Lu(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(s){i&&i(s),r.manager.itemError(t)}},n,i)}parse(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],s=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers,r=i[e],s=new Uint32Array(r).buffer;return n[e]=s,s}(t,r.buffer),a=rn(r.type,s),o=new Jo(a,r.stride);return o.uuid=r.uuid,e[i]=o,o}const r=t.isInstancedBufferGeometry?new ld:new vr,s=t.data.index;if(void 0!==s){const t=rn(s.type,s.array);r.setIndex(new ar(t,1))}const a=t.data.attributes;for(const c in a){const e=a[c];let n;if(e.isInterleavedBufferAttribute){const r=i(t.data,e.data);n=new Qo(r,e.itemSize,e.offset,e.normalized)}else{const t=rn(e.type,e.array);n=new(e.isInstancedBufferAttribute?Dl:ar)(t,e.itemSize,e.normalized)}void 0!==e.name&&(n.name=e.name),void 0!==e.usage&&n.setUsage(e.usage),r.setAttribute(c,n)}const o=t.data.morphAttributes;if(o)for(const c in o){const e=o[c],n=[];for(let r=0,s=e.length;r<s;r++){const s=e[r];let a;if(s.isInterleavedBufferAttribute){const e=i(t.data,s.data);a=new Qo(e,s.itemSize,s.offset,s.normalized)}else{const t=rn(s.type,s.array);a=new ar(t,s.itemSize,s.normalized)}void 0!==s.name&&(a.name=s.name),n.push(a)}r.morphAttributes[c]=n}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let c=0,u=l.length;c!==u;++c){const t=l[c];r.addGroup(t.start,t.count,t.materialIndex)}const h=t.data.boundingSphere;if(void 0!==h){const t=new Pn;void 0!==h.center&&t.fromArray(h.center),r.boundingSphere=new Jn(t,h.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}class cd extends Du{constructor(t){super(t)}load(t,e,n,i){const r=this,s=""===this.path?od.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const a=new Lu(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(n){let s=null;try{s=JSON.parse(n)}catch(o){return void(void 0!==i&&i(o))}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(s,e):void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+t))},n,i)}async loadAsync(t,e){const n=""===this.path?od.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const i=new Lu(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(t,e),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),s=this.parseImages(t.images,function(){void 0!==e&&e(l)}),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,n),h=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,h),void 0!==e){let t=!1;for(const e in s)if(s[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,n),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,s),o=this.parseObject(t.object,i,a,s,e),l=this.parseSkeletons(t.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new uc).fromJSON(t[n]);e[i.uuid]=i}return e}parseSkeletons(t,e){const n={},i={};if(e.traverse(function(t){t.isBone&&(i[t.uuid]=t)}),void 0!==t)for(let r=0,s=t.length;r<s;r++){const e=(new Ol).fromJSON(t[r],i);n[e.uuid]=e}return n}parseGeometries(t,e){const n={};if(void 0!==t){const i=new hd;for(let r=0,s=t.length;r<s;r++){let s;const a=t[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(a);break;default:a.type in $c&&(s=$c[a.type].fromJSON(a,e))}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(t,e){const n={},i={};if(void 0!==t){const r=new ad;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const i=t[n],r=Cu.parse(i);e[r.uuid]=r}return e}parseImages(t,e){const n=this,i={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),r.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:rn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new Iu(e);r=new Uu(n),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const n=t[e],r=n.url;if(Array.isArray(r)){const t=[];for(let e=0,n=r.length;e<n;e++){const n=s(r[e]);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new Pl(n.data,n.width,n.height)))}i[n.uuid]=new xn(t)}else{const t=s(n.url);i[n.uuid]=new xn(t)}}}return i}async parseImagesAsync(t){const e=this,n={};let i;async function r(t){if("string"==typeof t){const n=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return await i.loadAsync(r)}return t.data?{data:rn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){i=new Uu(this.manager),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.url;if(Array.isArray(s)){const t=[];for(let e=0,n=s.length;e<n;e++){const n=s[e],i=await r(n);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new Pl(i.data,i.width,i.height)))}n[i.uuid]=new xn(t)}else{const t=await r(i.url);n[i.uuid]=new xn(t)}}}return n}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:e[t]}const i={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];s.image,e[s.image];const a=e[s.image],o=a.data;let l;Array.isArray(o)?(l=new Jr,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new Pl:new Sn,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,ud)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],dd),l.wrapT=n(s.wrap[1],dd)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace&&(l.colorSpace=s.colorSpace),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,pd)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,pd)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),i[s.uuid]=l}return i}parseObject(t,e,n,i,r){let s,a,o;function l(t){return e[t],e[t]}function h(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n[r],e.push(n[r])}return e}return n[t],n[t]}}function c(t){return i[t],i[t]}switch(t.type){case"Scene":s=new Ko,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new qi(t.background):s.background=c(t.background)),void 0!==t.environment&&(s.environment=c(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new qo(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new Yo(t.fog.color,t.fog.density)),""!==t.fog.name&&(s.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(s.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(s.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&s.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(s.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&s.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":s=new Yr(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new bs(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new nd(t.color,t.intensity);break;case"DirectionalLight":s=new ed(t.color,t.intensity);break;case"PointLight":s=new $u(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new id(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new qu(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new Hu(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new sd).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=h(t.material),s=new El(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=h(t.material),s=new Fr(a,o);break;case"InstancedMesh":a=l(t.geometry),o=h(t.material);const e=t.count,n=t.instanceMatrix,i=t.instanceColor;s=new Gl(a,o,e),s.instanceMatrix=new Dl(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new Dl(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":a=l(t.geometry),o=h(t.material),s=new oh(t.maxGeometryCount,t.maxVertexCount,t.maxIndexCount,o),s.geometry=a,s.perObjectFrustumCulled=t.perObjectFrustumCulled,s.sortObjects=t.sortObjects,s._drawRanges=t.drawRanges,s._reservedRanges=t.reservedRanges,s._visibility=t.visibility,s._active=t.active,s._bounds=t.bounds.map(t=>{const e=new On;e.min.fromArray(t.boxMin),e.max.fromArray(t.boxMax);const n=new Jn;return n.radius=t.sphereRadius,n.center.fromArray(t.sphereCenter),{boxInitialized:t.boxInitialized,box:e,sphereInitialized:t.sphereInitialized,sphere:n}}),s._maxGeometryCount=t.maxGeometryCount,s._maxVertexCount=t.maxVertexCount,s._maxIndexCount=t.maxIndexCount,s._geometryInitialized=t.geometryInitialized,s._geometryCount=t.geometryCount,s._matricesTexture=c(t.matricesTexture.uuid),void 0!==t.colorsTexture&&(s._colorsTexture=c(t.colorsTexture.uuid));break;case"LOD":s=new vl;break;case"Line":s=new gh(l(t.geometry),h(t.material));break;case"LineLoop":s=new _h(l(t.geometry),h(t.material));break;case"LineSegments":s=new bh(l(t.geometry),h(t.material));break;case"PointCloud":case"Points":s=new Eh(l(t.geometry),h(t.material));break;case"Sprite":s=new pl(h(t.material));break;case"Group":s=new Uo;break;case"Bone":s=new Cl;break;default:s=new Oi}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.up&&s.up.fromArray(t.up),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)s.add(this.parseObject(a[t],e,n,i,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];s.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance,n.hysteresis)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse(function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n||t.bind(n,t.bindMatrix)}})}}const ud={UVMapping:Z,CubeReflectionMapping:Q,CubeRefractionMapping:$,EquirectangularReflectionMapping:tt,EquirectangularRefractionMapping:et,CubeUVReflectionMapping:nt},dd={RepeatWrapping:it,ClampToEdgeWrapping:rt,MirroredRepeatWrapping:st},pd={NearestFilter:at,NearestMipmapNearestFilter:ot,NearestMipmapLinearFilter:lt,LinearFilter:ht,LinearMipmapNearestFilter:ct,LinearMipmapLinearFilter:ut};class fd extends Du{constructor(t){super(t),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ru.get(t);if(void 0!==s)return r.manager.itemStart(t),s.then?void s.then(n=>{e&&e(n),r.manager.itemEnd(t)}).catch(t=>{i&&i(t)}):(setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;const o=fetch(t,a).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(n){return Ru.add(t,n),e&&e(n),r.manager.itemEnd(t),n}).catch(function(e){i&&i(e),Ru.remove(t),r.manager.itemError(t),r.manager.itemEnd(t)});Ru.add(t,o),r.manager.itemStart(t)}}let md,gd=class{static getContext(){return void 0===md&&(md=new(window.AudioContext||window.webkitAudioContext)),md}static setContext(t){md=t}};const vd=new si,yd=new si,xd=new si;class bd{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=_d(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=_d();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function _d(){return("undefined"==typeof performance?Date:performance).now()}const Sd=new Pn,wd=new Cn,Td=new Pn,Md=new Pn;let Ad=class extends Oi{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return;if(!1===this.hasPlaybackControl)return;this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1!==this.hasPlaybackControl&&this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}};const Ed=new Pn,Cd=new Cn,Pd=new Pn,Rd=new Pn;class Id{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let o=e,l=e+e;o!==l;++o)if(n[o]!==n[o+e]){a.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let r=n,s=i;r!==s;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)t[e+s]=t[n+s]}_slerp(t,e,n,i){Cn.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;Cn.multiplyQuaternionsFlat(t,s,t,e,t,n),Cn.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[n+a]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const Od="\\[\\]\\.:\\/",Dd=new RegExp("["+Od+"]","g"),Bd="[^"+Od+"]",Fd="[^"+Od.replace("\\.","")+"]",Ld=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Bd)+/(WCOD+)?/.source.replace("WCOD",Fd)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Bd)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Bd)+"$"),Ud=["material","materials","bones","map"];class kd{constructor(t,e,n){this.path=e,this.parsedPath=n||kd.parseTrackName(e),this.node=kd.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new kd.Composite(t,e,n):new kd(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Dd,"")}static parseTrackName(t){const e=Ld.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==Ud.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=kd.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return;if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return;if(!t.material.materials)return;t=t.material.materials;break;case"bones":if(!t.skeleton)return;t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return;if(!t.material.map)return;t=t.material.map;break;default:if(void 0===t[n])return;t=t[n]}if(void 0!==i){if(void 0===t[i])return;t=t[i]}}const s=t[i];if(void 0===s){e.nodeName;return}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return;if(!t.geometry.morphAttributes)return;void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}kd.Composite=class{constructor(t,e,n){const i=n||kd.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},kd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},kd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},kd.prototype.GetterByBindingType=[kd.prototype._getValue_direct,kd.prototype._getValue_array,kd.prototype._getValue_arrayElement,kd.prototype._getValue_toArray],kd.prototype.SetterByBindingTypeAndVersioning=[[kd.prototype._setValue_direct,kd.prototype._setValue_direct_setNeedsUpdate,kd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[kd.prototype._setValue_array,kd.prototype._setValue_array_setNeedsUpdate,kd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[kd.prototype._setValue_arrayElement,kd.prototype._setValue_arrayElement_setNeedsUpdate,kd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[kd.prototype._setValue_fromArray,kd.prototype._setValue_fromArray_setNeedsUpdate,kd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Nd{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:ce,endingEnd:ce};for(let l=0;l!==s;++l){const t=r[l].createInterpolant(null);a[l]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ae,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;i<0||0===n?e=0:(this._startTime=null,e=n*i)}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===fe)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(a);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=2202===n;if(0===t)return-1===r||!s||1&~r?i:e-i;if(n===se){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&!(1&~r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=ue,i.endingEnd=ue):(i.endingStart=t?this.zeroSlopeAtStart?ue:ce:de,i.endingEnd=e?this.zeroSlopeAtEnd?ue:ce:de)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=n,this}}const zd=new Float32Array(1);class Gd extends ze{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,a=t._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let h=l[o];void 0===h&&(h={},l[o]=h);for(let c=0;c!==r;++c){const t=i[c],r=t.name;let l=h[r];if(void 0!==l)++l.referenceCount,s[c]=l;else{if(l=s[c],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}const i=e&&e._propertyBindings[c].binding.parsedPath;l=new Id(kd.create(n,r,i),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),s[c]=l}a[c].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const t=e[n];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new yu(new Float32Array(2),new Float32Array(2),1,zd),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"==typeof t?Cu.findByName(i,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:pe),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const h=new Nd(this,s,e,n);return this._bindAction(h,l),this._addInactiveAction(h,a,r),h}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?Cu.findByName(n,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==n;++l){e[l]._update(i,t,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const r in n){const t=n[r].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const r in i){const t=i[r];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Hd{constructor(t){this.value=t}clone(){return new Hd(void 0===this.value.clone?this.value:this.value.clone())}}let Vd=0;const Xd=new si;function Wd(t,e){return t.distance-e.distance}function jd(t,e,n,i){let r=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,n)&&(r=!1)}if(!0===r&&!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)jd(i[t],e,n,!0)}}class Yd{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(je(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const qd=new Qe;const Kd=new Pn,Jd=new Pn;class Zd{constructor(t=new Pn,e=new Pn){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Kd.subVectors(t,this.start),Jd.subVectors(this.end,this.start);const n=Jd.dot(Jd);let i=Jd.dot(Kd)/n;return e&&(i=je(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Qd=new Pn;class $d extends Oi{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new vr,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){const t=s/o*Math.PI*2,e=a/o*Math.PI*2;i.push(Math.cos(t),Math.sin(t),1,Math.cos(e),Math.sin(e),1)}n.setAttribute("position",new hr(i,3));const r=new lh({fog:!1,toneMapped:!1});this.cone=new bh(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Qd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Qd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const tp=new Pn,ep=new si,np=new si;function ip(t){const e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,ip(t.children[n]));return e}class rp extends Fr{constructor(t,e,n){super(new jc(e,4,2),new Qi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const sp=new Pn,ap=new qi,op=new qi;class lp extends Oi{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new Vc(e);i.rotateY(.5*Math.PI),this.material=new Qi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new ar(s,3)),this.add(new Fr(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");ap.copy(this.light.color),op.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?ap:op;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(sp.setFromMatrixPosition(this.light.matrixWorld).negate())}}const hp=new Pn,cp=new Pn,up=new Pn;class dp extends Oi{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===e&&(e=1);let i=new vr;i.setAttribute("position",new hr([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new lh({fog:!1,toneMapped:!1});this.lightPlane=new gh(i,r),this.add(this.lightPlane),i=new vr,i.setAttribute("position",new hr([0,0,0,0,0,1],3)),this.targetLine=new gh(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),hp.setFromMatrixPosition(this.light.matrixWorld),cp.setFromMatrixPosition(this.light.target.matrixWorld),up.subVectors(cp,hp),this.lightPlane.lookAt(cp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(cp),this.targetLine.scale.z=up.length()}}const pp=new Pn,fp=new Vr;class mp extends bh{constructor(t){const e=new vr,n=new lh({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(t,e){o(t),o(e)}function o(t){i.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new hr(i,3)),e.setAttribute("color",new hr(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new qi(16755200),h=new qi(16711680),c=new qi(43775),u=new qi(16777215),d=new qi(3355443);this.setColors(l,h,c,u,d)}setColors(t,e,n,i,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;fp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),gp("c",e,t,fp,0,0,-1),gp("t",e,t,fp,0,0,1),gp("n1",e,t,fp,-1,-1,-1),gp("n2",e,t,fp,1,-1,-1),gp("n3",e,t,fp,-1,1,-1),gp("n4",e,t,fp,1,1,-1),gp("f1",e,t,fp,-1,-1,1),gp("f2",e,t,fp,1,-1,1),gp("f3",e,t,fp,-1,1,1),gp("f4",e,t,fp,1,1,1),gp("u1",e,t,fp,.7,1.1,-1),gp("u2",e,t,fp,-.7,1.1,-1),gp("u3",e,t,fp,0,2,-1),gp("cf1",e,t,fp,-1,0,1),gp("cf2",e,t,fp,1,0,1),gp("cf3",e,t,fp,0,-1,1),gp("cf4",e,t,fp,0,1,1),gp("cn1",e,t,fp,-1,0,-1),gp("cn2",e,t,fp,1,0,-1),gp("cn3",e,t,fp,0,-1,-1),gp("cn4",e,t,fp,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function gp(t,e,n,i,r,s,a){pp.set(r,s,a).unproject(i);const o=e[t];if(void 0!==o){const t=n.getAttribute("position");for(let e=0,n=o.length;e<n;e++)t.setXYZ(o[e],pp.x,pp.y,pp.z)}}const vp=new On;const yp=new Pn;let xp,bp;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:M}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=M));const _p=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:4,AddEquation:I,AddOperation:2,AdditiveAnimationBlendMode:fe,AdditiveBlending:2,AgXToneMapping:6,AlphaFormat:1021,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:nd,AnimationAction:Nd,AnimationClip:Cu,AnimationLoader:class extends Du{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Lu(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(s){i&&i(s),r.manager.itemError(t)}},n,i)}parse(t){const e=[];for(let n=0;n<t.length;n++){const i=Cu.parse(t[n]);e.push(i)}return e}},AnimationMixer:Gd,AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=We(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let a,o=t.length,l=this.nCachedObjects_;for(let h=0,c=arguments.length;h!==c;++h){const c=arguments[h],u=c.uuid;let d=e[u];if(void 0===d){d=o++,e[u]=d,t.push(c);for(let t=0,e=s;t!==e;++t)r[t].push(new kd(c,n[t],i[t]))}else if(d<l){a=t[d];const o=--l,h=t[o];e[h.uuid]=d,t[d]=h,e[u]=o,t[o]=c;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[o];let a=e[d];e[d]=s,void 0===a&&(a=new kd(c,n[t],i[t])),e[o]=a}}else t[d]}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=e[o];if(void 0!==l&&l>=r){const s=r++,h=t[s];e[h.uuid]=l,t[l]=h,e[o]=s,t[s]=a;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[s],r=e[l];e[l]=i,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<r){const a=--r,o=t[a],h=--s,c=t[h];e[o.uuid]=l,t[l]=o,e[c.uuid]=a,t[a]=c,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[a],r=e[h];e[l]=i,e[a]=r,e.pop()}}else{const r=--s,a=t[r];r>0&&(e[a.uuid]=l),t[l]=a,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);i=r.length,n[t]=i,s.push(t),a.push(e),r.push(c);for(let u=h,d=o.length;u!==d;++u){const n=o[u];c[u]=new kd(n,t,e)}return c}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];e[t[a]]=n,s[n]=o,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}},AnimationUtils:mu,ArcCurve:Dh,ArrayCamera:Lo,ArrowHelper:class extends Oi{constructor(t=new Pn(0,0,1),e=new Pn(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===xp&&(xp=new vr,xp.setAttribute("position",new hr([0,0,0,0,1,0],3)),bp=new nc(0,.5,1,5,1),bp.translate(0,-.5,0)),this.position.copy(e),this.line=new gh(xp,new lh({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Fr(bp,new Qi({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{yp.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(yp,e)}}setLength(t,e=.2*t,n=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:K,Audio:Ad,AudioAnalyser:class{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}},AudioContext:gd,AudioListener:class extends Oi{constructor(){super(),this.type="AudioListener",this.context=gd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new bd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Sd,wd,Td),Md.set(0,0,-1).applyQuaternion(wd),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Sd.x,t),e.positionY.linearRampToValueAtTime(Sd.y,t),e.positionZ.linearRampToValueAtTime(Sd.z,t),e.forwardX.linearRampToValueAtTime(Md.x,t),e.forwardY.linearRampToValueAtTime(Md.y,t),e.forwardZ.linearRampToValueAtTime(Md.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(Sd.x,Sd.y,Sd.z),e.setOrientation(Md.x,Md.y,Md.z,n.x,n.y,n.z)}},AudioLoader:class extends Du{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Lu(this.manager);function a(e){i&&i(e),r.manager.itemError(t)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(t){try{const n=t.slice(0);gd.getContext().decodeAudioData(n,function(t){e(t)}).catch(a)}catch(n){a(n)}},n,i)}},AxesHelper:class extends bh{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new vr;n.setAttribute("position",new hr(e,3)),n.setAttribute("color",new hr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new lh({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new qi,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BackSide:1,BasicDepthPacking:me,BasicShadowMap:0,BatchedMesh:oh,Bone:Cl,BooleanKeyframeTrack:_u,Box2:class{constructor(t=new Qe(1/0,1/0),e=new Qe(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=qd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,qd).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},Box3:On,Box3Helper:class extends bh{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new vr;i.setIndex(new ar(n,1)),i.setAttribute("position",new hr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new lh({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}},BoxGeometry:Ur,BoxHelper:class extends bh{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new vr;r.setIndex(new ar(n,1)),r.setAttribute("position",new ar(i,3)),super(r,new lh({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==this.object&&vp.setFromObject(this.object),vp.isEmpty())return;const e=vp.min,n=vp.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferAttribute:ar,BufferGeometry:vr,BufferGeometryLoader:hd,ByteType:1010,Cache:Ru,Camera:Vr,CameraHelper:mp,CanvasTexture:Rh,CapsuleGeometry:tc,CatmullRomCurve3:Nh,CineonToneMapping:3,CircleGeometry:ec,ClampToEdgeWrapping:rt,Clock:bd,Color:qi,ColorKeyframeTrack:Su,ColorManagement:pn,CompressedArrayTexture:class extends Ph{constructor(t,e,n,i,r,s){super(t,e,n,r,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=rt,this.layerUpdates=new Set}addLayerUpdates(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}},CompressedCubeTexture:class extends Ph{constructor(t,e,n){super(void 0,t[0].width,t[0].height,e,n,Q),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}},CompressedTexture:Ph,CompressedTextureLoader:class extends Du{constructor(t){super(t)}load(t,e,n,i){const r=this,s=[],a=new Ph,o=new Lu(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function h(h){o.load(t[h],function(t){const n=r.parse(t,!0);s[h]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=ht),a.image=s,a.format=n.format,a.needsUpdate=!0,e&&e(a))},n,i)}if(Array.isArray(t))for(let c=0,u=t.length;c<u;++c)h(c);else o.load(t,function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)s[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),s[e].format=n.format,s[e].width=n.width,s[e].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=ht),a.format=n.format,a.needsUpdate=!0,e&&e(a)},n,i);return a}},ConeGeometry:ic,ConstantAlphaFactor:213,ConstantColorFactor:211,CubeCamera:Kr,CubeReflectionMapping:Q,CubeRefractionMapping:$,CubeTexture:Jr,CubeTextureLoader:ku,CubeUVReflectionMapping:nt,CubicBezierCurve:Vh,CubicBezierCurve3:Xh,CubicInterpolant:vu,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:Ih,CurvePath:Zh,CustomBlending:5,CustomToneMapping:5,CylinderGeometry:nc,Cylindrical:class{constructor(t=1,e=0,n=0){return this.radius=t,this.theta=e,this.y=n,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}},Data3DTexture:En,DataArrayTexture:An,DataTexture:Pl,DataTextureLoader:Nu,DataUtils:ir,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:Ou,DepthFormat:St,DepthStencilFormat:wt,DepthTexture:Ws,DetachedBindMode:J,DirectionalLight:ed,DirectionalLightHelper:dp,DiscreteInterpolant:xu,DisplayP3ColorSpace:be,DodecahedronGeometry:sc,DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicCopyUsage:35050,DynamicDrawUsage:Le,DynamicReadUsage:35049,EdgesGeometry:cc,EllipseCurve:Oh,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:tt,EquirectangularRefractionMapping:et,Euler:mi,EventDispatcher:ze,ExtrudeGeometry:zc,FileLoader:Lu,Float16BufferAttribute:class extends ar{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=nr(this.array[t*this.itemSize]);return this.normalized&&(e=Ke(e,this.array)),e}setX(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize]=er(e),this}getY(t){let e=nr(this.array[t*this.itemSize+1]);return this.normalized&&(e=Ke(e,this.array)),e}setY(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+1]=er(e),this}getZ(t){let e=nr(this.array[t*this.itemSize+2]);return this.normalized&&(e=Ke(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+2]=er(e),this}getW(t){let e=nr(this.array[t*this.itemSize+3]);return this.normalized&&(e=Ke(e,this.array)),e}setW(t,e){return this.normalized&&(e=Je(e,this.array)),this.array[t*this.itemSize+3]=er(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array)),this.array[t+0]=er(e),this.array[t+1]=er(n),this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array),i=Je(i,this.array)),this.array[t+0]=er(e),this.array[t+1]=er(n),this.array[t+2]=er(i),this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Je(e,this.array),n=Je(n,this.array),i=Je(i,this.array),r=Je(r,this.array)),this.array[t+0]=er(e),this.array[t+1]=er(n),this.array[t+2]=er(i),this.array[t+3]=er(r),this}},Float32BufferAttribute:hr,FloatType:gt,Fog:qo,FogExp2:Yo,FramebufferTexture:class extends Sn{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=at,this.minFilter=at,this.generateMipmaps=!1,this.needsUpdate=!0}},FrontSide:0,Frustum:rs,GLBufferAttribute:class{constructor(t,e,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}},GLSL1:"100",GLSL3:Ue,GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:class extends bh{constructor(t=10,e=10,n=4473924,i=8947848){n=new qi(n),i=new qi(i);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let c=0,u=0,d=-a;c<=e;c++,d+=s){o.push(-a,0,d,a,0,d),o.push(d,0,-a,d,0,a);const t=c===r?n:i;t.toArray(l,u),u+=3,t.toArray(l,u),u+=3,t.toArray(l,u),u+=3,t.toArray(l,u),u+=3}const h=new vr;h.setAttribute("position",new hr(o,3)),h.setAttribute("color",new hr(l,3));super(h,new lh({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},Group:Uo,HalfFloatType:vt,HemisphereLight:Hu,HemisphereLightHelper:lp,IcosahedronGeometry:Hc,ImageBitmapLoader:fd,ImageLoader:Uu,ImageUtils:vn,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Dl,InstancedBufferGeometry:ld,InstancedInterleavedBuffer:class extends Jo{constructor(t,e,n=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}},InstancedMesh:Gl,Int16BufferAttribute:class extends ar{constructor(t,e,n){super(new Int16Array(t),e,n)}},Int32BufferAttribute:class extends ar{constructor(t,e,n){super(new Int32Array(t),e,n)}},Int8BufferAttribute:class extends ar{constructor(t,e,n){super(new Int8Array(t),e,n)}},IntType:ft,InterleavedBuffer:Jo,InterleavedBufferAttribute:Qo,Interpolant:gu,InterpolateDiscrete:oe,InterpolateLinear:le,InterpolateSmooth:he,InvertStencilOp:5386,KeepStencilOp:Ae,KeyframeTrack:bu,LOD:vl,LatheGeometry:$h,Layers:gi,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:Gu,LightProbe:sd,Line:gh,Line3:Zd,LineBasicMaterial:lh,LineCurve:Wh,LineCurve3:jh,LineDashedMaterial:hu,LineLoop:_h,LineSegments:bh,LinearDisplayP3ColorSpace:_e,LinearFilter:ht,LinearInterpolant:yu,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:ut,LinearMipmapNearestFilter:ct,LinearSRGBColorSpace:xe,LinearToneMapping:1,LinearTransfer:Se,Loader:Du,LoaderUtils:od,LoadingManager:Iu,LoopOnce:se,LoopPingPong:2202,LoopRepeat:ae,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:A,Material:Zi,MaterialLoader:ad,MathUtils:Ze,Matrix3:$e,Matrix4:si,MaxEquation:104,Mesh:Fr,MeshBasicMaterial:Qi,MeshDepthMaterial:Ro,MeshDistanceMaterial:Io,MeshLambertMaterial:ou,MeshMatcapMaterial:lu,MeshNormalMaterial:au,MeshPhongMaterial:ru,MeshPhysicalMaterial:iu,MeshStandardMaterial:nu,MeshToonMaterial:su,MinEquation:103,MirroredRepeatWrapping:st,MixOperation:1,MultiplyBlending:4,MultiplyOperation:0,NearestFilter:at,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:lt,NearestMipmapNearestFilter:ot,NeutralToneMapping:7,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:ve,NoToneMapping:0,NormalAnimationBlendMode:pe,NormalBlending:1,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:wu,Object3D:Oi,ObjectLoader:cd,ObjectSpaceNormalMap:1,OctahedronGeometry:Vc,OneFactor:201,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:N,OneMinusSrcColorFactor:203,OrthographicCamera:bs,P3Primaries:Me,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:Os,Path:Qh,PerspectiveCamera:Yr,Plane:es,PlaneGeometry:os,PlaneHelper:class extends gh{constructor(t,e=1,n=16776960){const i=n,r=new vr;r.setAttribute("position",new hr([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new lh({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new vr;s.setAttribute("position",new hr([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Fr(s,new Qi({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},PointLight:$u,PointLightHelper:rp,Points:Eh,PointsMaterial:Sh,PolarGridHelper:class extends bh{constructor(t=10,e=16,n=8,i=64,r=4473924,s=8947848){r=new qi(r),s=new qi(s);const a=[],o=[];if(e>1)for(let h=0;h<e;h++){const n=h/e*(2*Math.PI),i=Math.sin(n)*t,l=Math.cos(n)*t;a.push(0,0,0),a.push(i,0,l);const c=1&h?r:s;o.push(c.r,c.g,c.b),o.push(c.r,c.g,c.b)}for(let h=0;h<n;h++){const e=1&h?r:s,l=t-t/n*h;for(let t=0;t<i;t++){let n=t/i*(2*Math.PI),r=Math.sin(n)*l,s=Math.cos(n)*l;a.push(r,0,s),o.push(e.r,e.g,e.b),n=(t+1)/i*(2*Math.PI),r=Math.sin(n)*l,s=Math.cos(n)*l,a.push(r,0,s),o.push(e.r,e.g,e.b)}}const l=new vr;l.setAttribute("position",new hr(a,3)),l.setAttribute("color",new hr(o,3));super(l,new lh({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:rc,PositionalAudio:class extends Ad{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Ed,Cd,Pd),Rd.set(0,0,1).applyQuaternion(Cd);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Ed.x,t),e.positionY.linearRampToValueAtTime(Ed.y,t),e.positionZ.linearRampToValueAtTime(Ed.z,t),e.orientationX.linearRampToValueAtTime(Rd.x,t),e.orientationY.linearRampToValueAtTime(Rd.y,t),e.orientationZ.linearRampToValueAtTime(Rd.z,t)}else e.setPosition(Ed.x,Ed.y,Ed.z),e.setOrientation(Rd.x,Rd.y,Rd.z)}},PropertyBinding:kd,PropertyMixer:Id,QuadraticBezierCurve:Yh,QuadraticBezierCurve3:qh,Quaternion:Cn,QuaternionKeyframeTrack:Mu,QuaternionLinearInterpolant:Tu,RED_GREEN_RGTC2_Format:ie,RED_RGTC1_Format:36283,REVISION:M,RGBADepthPacking:ge,RGBAFormat:_t,RGBAIntegerFormat:Et,RGBA_ASTC_10x10_Format:Jt,RGBA_ASTC_10x5_Format:Yt,RGBA_ASTC_10x6_Format:qt,RGBA_ASTC_10x8_Format:Kt,RGBA_ASTC_12x10_Format:Zt,RGBA_ASTC_12x12_Format:Qt,RGBA_ASTC_4x4_Format:Nt,RGBA_ASTC_5x4_Format:zt,RGBA_ASTC_5x5_Format:Gt,RGBA_ASTC_6x5_Format:Ht,RGBA_ASTC_6x6_Format:Vt,RGBA_ASTC_8x5_Format:Xt,RGBA_ASTC_8x6_Format:Wt,RGBA_ASTC_8x8_Format:jt,RGBA_BPTC_Format:$t,RGBA_ETC2_EAC_Format:kt,RGBA_PVRTC_2BPPV1_Format:Ft,RGBA_PVRTC_4BPPV1_Format:Bt,RGBA_S3TC_DXT1_Format:Pt,RGBA_S3TC_DXT3_Format:Rt,RGBA_S3TC_DXT5_Format:It,RGBFormat:1022,RGB_BPTC_SIGNED_Format:te,RGB_BPTC_UNSIGNED_Format:ee,RGB_ETC1_Format:Lt,RGB_ETC2_Format:Ut,RGB_PVRTC_2BPPV1_Format:Dt,RGB_PVRTC_4BPPV1_Format:Ot,RGB_S3TC_DXT1_Format:Ct,RGFormat:1030,RGIntegerFormat:At,RawShaderMaterial:eu,Ray:ri,Raycaster:class{constructor(t,e,n=0,i=1/0){this.ray=new ri(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new gi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera&&(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e)}setFromXRController(t){return Xd.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Xd),this}intersectObject(t,e=!0,n=[]){return jd(t,this,n,e),n.sort(Wd),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)jd(t[i],this,n,e);return n.sort(Wd),n}},Rec709Primaries:Te,RectAreaLight:id,RedFormat:Tt,RedIntegerFormat:Mt,ReinhardToneMapping:2,RenderTarget:Tn,RepeatWrapping:it,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingGeometry:Xc,SIGNED_RED_GREEN_RGTC2_Format:re,SIGNED_RED_RGTC1_Format:ne,SRGBColorSpace:ye,SRGBTransfer:we,Scene:Ko,ShaderChunk:ls,ShaderLib:cs,ShaderMaterial:Hr,ShadowMaterial:tu,Shape:uc,ShapeGeometry:Wc,ShapePath:class{constructor(){this.type="ShapePath",this.color=new qi,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Qh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const n=e.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=e[r],a=e[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],o=-o,a=e[r],l=-l),t.y<n.y||t.y>a.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-o*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(a.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=a.x)return!0}}return i}const n=Uc.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,a;const o=[];if(1===i.length)return s=i[0],a=new uc,a.curves=s.curves,o.push(a),o;let l=!n(i[0].getPoints());l=t?!l:l;const h=[],c=[];let u,d,p=[],f=0;c[f]=void 0,p[f]=[];for(let m=0,g=i.length;m<g;m++)s=i[m],u=s.getPoints(),r=n(u),r=t?!r:r,r?(!l&&c[f]&&f++,c[f]={s:new uc,p:u},c[f].s.curves=s.curves,l&&f++,p[f]=[]):p[f].push({h:s,p:u[0]});if(!c[0])return function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new uc;r.curves=i.curves,e.push(r)}return e}(i);if(c.length>1){let t=!1,n=0;for(let e=0,i=c.length;e<i;e++)h[e]=[];for(let i=0,r=c.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<c.length;r++)e(a.p,c[r].p)&&(i!==r&&n++,o?(o=!1,h[r].push(a)):t=!0);o&&h[i].push(a)}}n>0&&!1===t&&(p=h)}for(let m=0,g=c.length;m<g;m++){a=c[m].s,o.push(a),d=p[m];for(let t=0,e=d.length;t<e;t++)a.holes.push(d[t].h)}return o}},ShapeUtils:Uc,ShortType:1011,Skeleton:Ol,SkeletonHelper:class extends bh{constructor(t){const e=ip(t),n=new vr,i=[],r=[],s=new qi(0,0,1),a=new qi(0,1,0);for(let o=0;o<e.length;o++){const t=e[o];t.parent&&t.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new hr(i,3)),n.setAttribute("color",new hr(r,3));super(n,new lh({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");np.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<e.length;r++){const t=e[r];t.parent&&t.parent.isBone&&(ep.multiplyMatrices(np,t.matrixWorld),tp.setFromMatrixPosition(ep),i.setXYZ(s,tp.x,tp.y,tp.z),ep.multiplyMatrices(np,t.parent.matrixWorld),tp.setFromMatrixPosition(ep),i.setXYZ(s+1,tp.x,tp.y,tp.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}},SkinnedMesh:El,Source:xn,Sphere:Jn,SphereGeometry:jc,Spherical:Yd,SphericalHarmonics3:rd,SplineCurve:Kh,SpotLight:qu,SpotLightHelper:$d,Sprite:pl,SpriteMaterial:$o,SrcAlphaFactor:k,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:Fe,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Yr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Yr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,xd.copy(t.projectionMatrix);const n=e.eyeSep/2,i=n*e.near/e.focus,r=e.near*Math.tan(Ve*e.fov*.5)/e.zoom;let s,a;yd.elements[12]=-n,vd.elements[12]=n,s=-r*e.aspect+i,a=r*e.aspect+i,xd.elements[0]=2*e.near/(a-s),xd.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(xd),s=-r*e.aspect-i,a=r*e.aspect-i,xd.elements[0]=2*e.near/(a-s),xd.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(xd)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(yd),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(vd)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:Au,SubtractEquation:101,SubtractiveBlending:3,TOUCH:E,TangentSpaceNormalMap:0,TetrahedronGeometry:Yc,Texture:Sn,TextureLoader:zu,TorusGeometry:qc,TorusKnotGeometry:Kc,Triangle:Vi,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:Jc,UVMapping:Z,Uint16BufferAttribute:or,Uint32BufferAttribute:lr,Uint8BufferAttribute:class extends ar{constructor(t,e,n){super(new Uint8Array(t),e,n)}},Uint8ClampedBufferAttribute:class extends ar{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}},Uniform:Hd,UniformsGroup:class extends ze{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Vd++}),this.name="",this.usage=Fe,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let n=0,i=e.length;n<i;n++){const t=Array.isArray(e[n])?e[n]:[e[n]];for(let e=0;e<t.length;e++)this.uniforms.push(t[e].clone())}return this}clone(){return(new this.constructor).copy(this)}},UniformsLib:hs,UniformsUtils:Gr,UnsignedByteType:dt,UnsignedInt248Type:bt,UnsignedInt5999Type:35902,UnsignedIntType:mt,UnsignedShort4444Type:yt,UnsignedShort5551Type:xt,UnsignedShortType:pt,VSMShadowMap:3,Vector2:Qe,Vector3:Pn,Vector4:wn,VectorKeyframeTrack:Eu,VideoTexture:class extends Sn{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:ht,this.magFilter=void 0!==r?r:ht,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)})}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},WebGL3DRenderTarget:class extends Mn{constructor(t=1,e=1,n=1,i={}){super(t,e,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new En(null,t,e,n),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends Mn{constructor(t=1,e=1,n=1,i={}){super(t,e,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new An(null,t,e,n),this.texture.isRenderTargetTexture=!0}},WebGLCoordinateSystem:ke,WebGLCubeRenderTarget:Zr,WebGLMultipleRenderTargets:class extends Mn{constructor(t=1,e=1,n=1,i={}){super(t,e,{...i,count:n}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}},WebGLRenderTarget:Mn,WebGLRenderer:jo,WebGLUtils:Fo,WebGPUCoordinateSystem:Ne,WireframeGeometry:Zc,WrapAroundEnding:de,ZeroCurvatureEnding:ce,ZeroFactor:200,ZeroSlopeEnding:ue,ZeroStencilOp:0,createCanvasElement:an},Symbol.toStringTag,{value:"Module"}));function Sp(t,e){if(0===e)return t;if(2===e||1===e){let n=t.getIndex();if(null===n){const e=[],i=t.getAttribute("position");if(void 0===i)return t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const i=n.count-2,r=[];if(2===e)for(let t=1;t<=i;t++)r.push(n.getX(0)),r.push(n.getX(t)),r.push(n.getX(t+1));else for(let t=0;t<i;t++)t%2==0?(r.push(n.getX(t)),r.push(n.getX(t+1)),r.push(n.getX(t+2))):(r.push(n.getX(t+2)),r.push(n.getX(t+1)),r.push(n.getX(t)));r.length;const s=t.clone();return s.setIndex(r),s.clearGroups(),s}return t}function wp(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Tp={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Mp{constructor(t){this.parser=t,this.name=Tp.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const r=e.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let a;const o=new qi(16777215);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],xe);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new ed(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new $u(o),a.distance=l;break;case"spot":a=new qu(o),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,pf(a,s),void 0!==s.intensity&&(a.intensity=s.intensity),a.name=e.createUniqueName(s.name||"light_"+t),i=Promise.resolve(a),e.cache.add(n,i),i}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){const e=this,n=this.parser,i=n.json.nodes[t],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(t){return n._getNodeRef(e.cache,r,t)})}}class Ap{constructor(){this.name=Tp.KHR_MATERIALS_UNLIT}getMaterialType(){return Qi}extendParams(t,e,n){const i=[];t.color=new qi(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;t.color.setRGB(e[0],e[1],e[2],xe),t.opacity=e[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(t,"map",r.baseColorTexture,ye))}return Promise.all(i)}}class Ep{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(e.emissiveIntensity=i),Promise.resolve()}}class Cp{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Qe(t,t)}return Promise.all(r)}}class Pp{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_DISPERSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return e.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class Rp{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(e.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(n.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(e.iridescenceIOR=s.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(n.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class Ip{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new qi(0,0,0),e.sheenRoughness=0,e.sheen=1;const s=i.extensions[this.name];if(void 0!==s.sheenColorFactor){const t=s.sheenColorFactor;e.sheenColor.setRGB(t[0],t[1],t[2],xe)}return void 0!==s.sheenRoughnessFactor&&(e.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture,ye)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class Op{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class Dp{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return e.attenuationColor=(new qi).setRGB(a[0],a[1],a[2],xe),Promise.all(r)}}class Bp{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return e.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Fp{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return e.specularColor=(new qi).setRGB(a[0],a[1],a[2],xe),void 0!==s.specularColorTexture&&r.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture,ye)),Promise.all(r)}}class Lp{constructor(t){this.parser=t,this.name=Tp.EXT_MATERIALS_BUMP}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return e.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&r.push(n.assignTexture(e,"bumpMap",s.bumpTexture)),Promise.all(r)}}class Up{constructor(t){this.parser=t,this.name=Tp.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?iu:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.anisotropyStrength&&(e.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(e.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&r.push(n.assignTexture(e,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}}class kp{constructor(t){this.parser=t,this.name=Tp.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,s)}}class Np{constructor(t){this.parser=t,this.name=Tp.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const t=n.options.manager.getHandler(a.uri);null!==t&&(o=t)}return this.detectSupport().then(function(r){if(r)return n.loadTextureImage(t,s.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}})),this.isSupported}}class zp{constructor(t){this.parser=t,this.name=Tp.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],a=i.images[s.source];let o=n.textureLoader;if(a.uri){const t=n.options.manager.getHandler(a.uri);null!==t&&(o=t)}return this.detectSupport().then(function(r){if(r)return n.loadTextureImage(t,s.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(1===e.height)}})),this.isSupported}}class Gp{constructor(t){this.name=Tp.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const t=n.extensions[this.name],i=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(e){const n=t.byteOffset||0,i=t.byteLength||0,s=t.count,a=t.byteStride,o=new Uint8Array(e,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,a,o,t.mode,t.filter).then(function(t){return t.buffer}):r.ready.then(function(){const e=new ArrayBuffer(s*a);return r.decodeGltfBuffer(new Uint8Array(e),s,a,o,t.mode,t.filter),e})})}return null}}class Hp{constructor(t){this.name=Tp.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,n=e.nodes[t];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=e.meshes[n.mesh];for(const o of i.primitives)if(o.mode!==$p.TRIANGLES&&o.mode!==$p.TRIANGLE_STRIP&&o.mode!==$p.TRIANGLE_FAN&&void 0!==o.mode)return null;const r=n.extensions[this.name].attributes,s=[],a={};for(const o in r)s.push(this.parser.getDependency("accessor",r[o]).then(t=>(a[o]=t,a[o])));return s.length<1?null:(s.push(this.parser.createNodeMesh(t)),Promise.all(s).then(t=>{const e=t.pop(),n=e.isGroup?e.children:[e],i=t[0].count,r=[];for(const s of n){const t=new si,e=new Pn,n=new Cn,o=new Pn(1,1,1),l=new Gl(s.geometry,s.material,i);for(let r=0;r<i;r++)a.TRANSLATION&&e.fromBufferAttribute(a.TRANSLATION,r),a.ROTATION&&n.fromBufferAttribute(a.ROTATION,r),a.SCALE&&o.fromBufferAttribute(a.SCALE,r),l.setMatrixAt(r,t.compose(e,n,o));for(const i in a)if("_COLOR_0"===i){const t=a[i];l.instanceColor=new Dl(t.array,t.itemSize,t.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&s.geometry.setAttribute(i,a[i]);Oi.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),r.push(l)}return e.isGroup?(e.clear(),e.add(...r),e):r[0]}))}}const Vp="glTF",Xp=1313821514,Wp=5130562;class jp{constructor(t){this.name=Tp.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Vp)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(t,12);let s=0;for(;s<i;){const e=r.getUint32(s,!0);s+=4;const i=r.getUint32(s,!0);if(s+=4,i===Xp){const i=new Uint8Array(t,12+s,e);this.content=n.decode(i)}else if(i===Wp){const n=12+s;this.body=t.slice(n,n+e)}s+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Yp{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Tp.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,a={},o={},l={};for(const h in s){const t=sf[h]||h.toLowerCase();a[t]=s[h]}for(const h in t.attributes){const e=sf[h]||h.toLowerCase();if(void 0!==s[h]){const i=n.accessors[t.attributes[h]],r=tf[i.componentType];l[e]=r.name,o[e]=!0===i.normalized}}return e.getDependency("bufferView",r).then(function(t){return new Promise(function(e,n){i.decodeDracoFile(t,function(t){for(const e in t.attributes){const n=t.attributes[e],i=o[e];void 0!==i&&(n.normalized=i)}e(t)},a,l,xe,n)})})}}class qp{constructor(){this.name=Tp.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&e.texCoord!==t.channel||void 0!==e.offset||void 0!==e.rotation||void 0!==e.scale?(t=t.clone(),void 0!==e.texCoord&&(t.channel=e.texCoord),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t):t}}class Kp{constructor(){this.name=Tp.KHR_MESH_QUANTIZATION}}class Jp extends gu{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let s=0;s!==i;s++)e[s]=n[r+s];return e}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,h=i-e,c=(n-e)/h,u=c*c,d=u*c,p=t*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+c;for(let x=0;x!==a;x++){const t=s[f+x+a],e=s[f+x+o]*h,n=s[p+x+a],i=s[p+x]*h;r[x]=v*t+y*e+m*n+g*i}return r}}const Zp=new Cn;class Qp extends Jp{interpolate_(t,e,n,i){const r=super.interpolate_(t,e,n,i);return Zp.fromArray(r).normalize().toArray(r),r}}const $p={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},tf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ef={9728:at,9729:ht,9984:ot,9985:ct,9986:lt,9987:ut},nf={33071:rt,33648:st,10497:it},rf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sf={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},af={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},of={CUBICSPLINE:void 0,LINEAR:le,STEP:oe},lf="OPAQUE",hf="MASK",cf="BLEND";function uf(t){return void 0===t.DefaultMaterial&&(t.DefaultMaterial=new nu({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),t.DefaultMaterial}function df(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function pf(t,e){void 0!==e.extras&&"object"==typeof e.extras&&Object.assign(t.userData,e.extras)}function ff(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++)t.morphTargetDictionary[n[e]]=e}}}function mf(t){let e;const n=t.extensions&&t.extensions[Tp.KHR_DRACO_MESH_COMPRESSION];if(e=n?"draco:"+n.bufferView+":"+n.indices+":"+gf(n.attributes):t.indices+":"+gf(t.attributes)+":"+t.mode,void 0!==t.targets)for(let i=0,r=t.targets.length;i<r;i++)e+=":"+gf(t.targets[i]);return e}function gf(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function vf(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const yf=new si;class xf{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new wp,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,r=-1;"undefined"!=typeof navigator&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||i&&r<98?this.textureLoader=new zu(this.options.manager):this.textureLoader=new fd(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Lu(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(t){return t._markDefs&&t._markDefs()}),Promise.all(this._invokeAll(function(t){return t.beforeRoot&&t.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(e){const s={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};return df(r,s,i),pf(s,i),Promise.all(n._invokeAll(function(t){return t.afterRoot&&t.afterRoot(s)})).then(function(){for(const t of s.scenes)t.updateMatrixWorld();t(s)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=e.length;i<r;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let i=0,r=t.length;i<r;i++){const e=t[i];void 0!==e.mesh&&(this._addNodeRef(this.meshCache,e.mesh),void 0!==e.skin&&(n[e.mesh].isSkinnedMesh=!0)),void 0!==e.camera&&this._addNodeRef(this.cameraCache,e.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone(),r=(t,e)=>{const n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(const[i,s]of t.children.entries())r(s,e.children[i])};return r(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const r=t(e[i]);r&&n.push(r)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this._invokeOne(function(t){return t.loadNode&&t.loadNode(e)});break;case"mesh":i=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this._invokeOne(function(t){return t.loadAnimation&&t.loadAnimation(e)});break;case"camera":i=this.loadCamera(e);break;default:if(i=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(t,e)}),!i)throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map(function(e,i){return n.getDependency(t,i)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[Tp.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(t,r){n.load(od.resolveURL(e.uri,i.path),t,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(t){const n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)})}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse){const t=rf[i.type],e=tf[i.componentType],n=!0===i.normalized,r=new e(i.count*t);return Promise.resolve(new ar(r,t,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(t){const r=t[0],s=rf[i.type],a=tf[i.componentType],o=a.BYTES_PER_ELEMENT,l=o*s,h=i.byteOffset||0,c=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;let d,p;if(c&&c!==l){const t=Math.floor(h/c),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+t+":"+i.count;let l=e.cache.get(n);l||(d=new a(r,t*c,i.count*c/o),l=new Jo(d,c/o),e.cache.add(n,l)),p=new Qo(l,s,h%c/o,u)}else d=null===r?new a(i.count*s):new a(r,h,i.count*s),p=new ar(d,s,u);if(void 0!==i.sparse){const e=rf.SCALAR,n=tf[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,h=new n(t[1],o,i.sparse.count*e),c=new a(t[2],l,i.sparse.count*s);null!==r&&(p=new ar(p.array.slice(),p.itemSize,p.normalized));for(let t=0,i=h.length;t<i;t++){const e=h[t];if(p.setX(e,c[t*s]),s>=2&&p.setY(e,c[t*s+1]),s>=3&&p.setZ(e,c[t*s+2]),s>=4&&p.setW(e,c[t*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})}loadTexture(t){const e=this.json,n=this.options,i=e.textures[t].source,r=e.images[i];let s=this.textureLoader;if(r.uri){const t=n.manager.getHandler(r.uri);null!==t&&(s=t)}return this.loadTextureImage(t,i,s)}loadTextureImage(t,e,n){const i=this,r=this.json,s=r.textures[t],a=r.images[e],o=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(e,n).then(function(e){e.flipY=!1,e.name=s.name||a.name||"",""===e.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(e.name=a.uri);const n=(r.samplers||{})[s.sampler]||{};return e.magFilter=ef[n.magFilter]||ht,e.minFilter=ef[n.minFilter]||ut,e.wrapS=nf[n.wrapS]||it,e.wrapT=nf[n.wrapT]||it,i.associations.set(e,{textures:t}),e}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(t,e){const n=this,i=this.json,r=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then(t=>t.clone());const s=i.images[t],a=self.URL||self.webkitURL;let o=s.uri||"",l=!1;if(void 0!==s.bufferView)o=n.getDependency("bufferView",s.bufferView).then(function(t){l=!0;const e=new Blob([t],{type:s.mimeType});return o=a.createObjectURL(e),o});else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(o).then(function(t){return new Promise(function(n,i){let s=n;!0===e.isImageBitmapLoader&&(s=function(t){const e=new Sn(t);e.needsUpdate=!0,n(e)}),e.load(od.resolveURL(t,r.path),s,void 0,i)})}).then(function(t){var e;return!0===l&&a.revokeObjectURL(o),pf(t,s),t.userData.mimeType=s.mimeType||((e=s.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t}).catch(function(t){throw t});return this.sourceCache[t]=h,h}assignTexture(t,e,n,i){const r=this;return this.getDependency("texture",n.index).then(function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),r.extensions[Tp.KHR_TEXTURE_TRANSFORM]){const t=void 0!==n.extensions?n.extensions[Tp.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=r.associations.get(s);s=r.extensions[Tp.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),r.associations.set(s,e)}}return void 0!==i&&(s.colorSpace=i),t[e]=s,s})}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=void 0===e.attributes.tangent,r=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new Sh,Zi.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new lh,Zi.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,this.cache.add(t,e)),n=e}if(i||r||s){let t="ClonedMaterial:"+n.uuid+":";i&&(t+="derivative-tangents:"),r&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),r&&(e.vertexColors=!0),s&&(e.flatShading=!0),i&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}t.material=n}getMaterialType(){return nu}loadMaterial(t){const e=this,n=this.json,i=this.extensions,r=n.materials[t];let s;const a={},o=[];if((r.extensions||{})[Tp.KHR_MATERIALS_UNLIT]){const t=i[Tp.KHR_MATERIALS_UNLIT];s=t.getMaterialType(),o.push(t.extendParams(a,r,e))}else{const n=r.pbrMetallicRoughness||{};if(a.color=new qi(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;a.color.setRGB(t[0],t[1],t[2],xe),a.opacity=t[3]}void 0!==n.baseColorTexture&&o.push(e.assignTexture(a,"map",n.baseColorTexture,ye)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(o.push(e.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),o.push(e.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),o.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)})))}!0===r.doubleSided&&(a.side=2);const l=r.alphaMode||lf;if(l===cf?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===hf&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==Qi&&(o.push(e.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Qe(1,1),void 0!==r.normalTexture.scale)){const t=r.normalTexture.scale;a.normalScale.set(t,t)}if(void 0!==r.occlusionTexture&&s!==Qi&&(o.push(e.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==Qi){const t=r.emissiveFactor;a.emissive=(new qi).setRGB(t[0],t[1],t[2],xe)}return void 0!==r.emissiveTexture&&s!==Qi&&o.push(e.assignTexture(a,"emissiveMap",r.emissiveTexture,ye)),Promise.all(o).then(function(){const n=new s(a);return r.name&&(n.name=r.name),pf(n,r),e.associations.set(n,{materials:t}),r.extensions&&df(i,n,r),n})}createUniqueName(t){const e=kd.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,n=this.extensions,i=this.primitiveCache;function r(t){return n[Tp.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then(function(n){return bf(n,t,e)})}const s=[];for(let a=0,o=t.length;a<o;a++){const n=t[a],o=mf(n),l=i[o];if(l)s.push(l.promise);else{let t;t=n.extensions&&n.extensions[Tp.KHR_DRACO_MESH_COMPRESSION]?r(n):bf(new vr,n,e),i[o]={primitive:n,promise:t},s.push(t)}}return Promise.all(s)}loadMesh(t){const e=this,n=this.json,i=this.extensions,r=n.meshes[t],s=r.primitives,a=[];for(let o=0,l=s.length;o<l;o++){const t=void 0===s[o].material?uf(this.cache):this.getDependency("material",s[o].material);a.push(t)}return a.push(e.loadGeometries(s)),Promise.all(a).then(function(n){const a=n.slice(0,n.length-1),o=n[n.length-1],l=[];for(let c=0,u=o.length;c<u;c++){const n=o[c],h=s[c];let u;const d=a[c];if(h.mode===$p.TRIANGLES||h.mode===$p.TRIANGLE_STRIP||h.mode===$p.TRIANGLE_FAN||void 0===h.mode)u=!0===r.isSkinnedMesh?new El(n,d):new Fr(n,d),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),h.mode===$p.TRIANGLE_STRIP?u.geometry=Sp(u.geometry,1):h.mode===$p.TRIANGLE_FAN&&(u.geometry=Sp(u.geometry,2));else if(h.mode===$p.LINES)u=new bh(n,d);else if(h.mode===$p.LINE_STRIP)u=new gh(n,d);else if(h.mode===$p.LINE_LOOP)u=new _h(n,d);else{if(h.mode!==$p.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new Eh(n,d)}Object.keys(u.geometry.morphAttributes).length>0&&ff(u,r),u.name=e.createUniqueName(r.name||"mesh_"+t),pf(u,r),h.extensions&&df(i,u,h),e.assignFinalMaterial(u),l.push(u)}for(let i=0,r=l.length;i<r;i++)e.associations.set(l[i],{meshes:t,primitives:i});if(1===l.length)return r.extensions&&df(i,l[0],r),l[0];const h=new Uo;r.extensions&&df(i,h,r),e.associations.set(h,{meshes:t});for(let t=0,e=l.length;t<e;t++)h.add(l[t]);return h})}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new Yr(Ze.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new bs(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),pf(e,n),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],n=[];for(let i=0,r=e.joints.length;i<r;i++)n.push(this._loadNodeShallow(e.joints[i]));return void 0!==e.inverseBindMatrices?n.push(this.getDependency("accessor",e.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(t){const e=t.pop(),n=t,i=[],r=[];for(let s=0,a=n.length;s<a;s++){const t=n[s];if(t){i.push(t);const n=new si;null!==e&&n.fromArray(e.array,16*s),r.push(n)}}return new Ol(i,r)})}loadAnimation(t){const e=this.json,n=this,i=e.animations[t],r=i.name?i.name:"animation_"+t,s=[],a=[],o=[],l=[],h=[];for(let c=0,u=i.channels.length;c<u;c++){const t=i.channels[c],e=i.samplers[t.sampler],n=t.target,r=n.node,u=void 0!==i.parameters?i.parameters[e.input]:e.input,d=void 0!==i.parameters?i.parameters[e.output]:e.output;void 0!==n.node&&(s.push(this.getDependency("node",r)),a.push(this.getDependency("accessor",u)),o.push(this.getDependency("accessor",d)),l.push(e),h.push(n))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(h)]).then(function(t){const e=t[0],i=t[1],s=t[2],a=t[3],o=t[4],l=[];for(let r=0,h=e.length;r<h;r++){const t=e[r],h=i[r],c=s[r],u=a[r],d=o[r];if(void 0===t)continue;t.updateMatrix&&t.updateMatrix();const p=n._createAnimationTracks(t,h,c,u,d);if(p)for(let e=0;e<p.length;e++)l.push(p[e])}return new Cu(r,void 0,l)})}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then(function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse(function(t){if(t.isMesh)for(let e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]}),e})}loadNode(t){const e=this,n=this.json.nodes[t],i=e._loadNodeShallow(t),r=[],s=n.children||[];for(let o=0,l=s.length;o<l;o++)r.push(e.getDependency("node",s[o]));const a=void 0===n.skin?Promise.resolve(null):e.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),a]).then(function(t){const e=t[0],n=t[1],i=t[2];null!==i&&e.traverse(function(t){t.isSkinnedMesh&&t.bind(i,yf)});for(let r=0,s=n.length;r<s;r++)e.add(n[r]);return e})}_loadNodeShallow(t){const e=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];const r=e.nodes[t],s=r.name?i.createUniqueName(r.name):"",a=[],o=i._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(t)});return o&&a.push(o),void 0!==r.camera&&a.push(i.getDependency("camera",r.camera).then(function(t){return i._getNodeRef(i.cameraCache,r.camera,t)})),i._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)}).forEach(function(t){a.push(t)}),this.nodeCache[t]=Promise.all(a).then(function(e){let a;if(a=!0===r.isBone?new Cl:e.length>1?new Uo:1===e.length?e[0]:new Oi,a!==e[0])for(let t=0,n=e.length;t<n;t++)a.add(e[t]);if(r.name&&(a.userData.name=r.name,a.name=s),pf(a,r),r.extensions&&df(n,a,r),void 0!==r.matrix){const t=new si;t.fromArray(r.matrix),a.applyMatrix4(t)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=t,a}),this.nodeCache[t]}loadScene(t){const e=this.extensions,n=this.json.scenes[t],i=this,r=new Uo;n.name&&(r.name=i.createUniqueName(n.name)),pf(r,n),n.extensions&&df(e,r,n);const s=n.nodes||[],a=[];for(let o=0,l=s.length;o<l;o++)a.push(i.getDependency("node",s[o]));return Promise.all(a).then(function(t){for(let e=0,n=t.length;e<n;e++)r.add(t[e]);return i.associations=(t=>{const e=new Map;for(const[n,r]of i.associations)(n instanceof Zi||n instanceof Sn)&&e.set(n,r);return t.traverse(t=>{const n=i.associations.get(t);null!=n&&e.set(t,n)}),e})(r),r})}_createAnimationTracks(t,e,n,i,r){const s=[],a=t.name?t.name:t.uuid,o=[];let l;switch(af[r.path]===af.weights?t.traverse(function(t){t.morphTargetInfluences&&o.push(t.name?t.name:t.uuid)}):o.push(a),af[r.path]){case af.weights:l=wu;break;case af.rotation:l=Mu;break;case af.position:case af.scale:l=Eu;break;default:if(1===n.itemSize)l=wu;else l=Eu}const h=void 0!==i.interpolation?of[i.interpolation]:le,c=this._getArrayFromAccessor(n);for(let u=0,d=o.length;u<d;u++){const t=new l(o[u]+"."+af[r.path],e.array,c,h);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(t),s.push(t)}return s}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const t=vf(e.constructor),n=new Float32Array(e.length);for(let i=0,r=e.length;i<r;i++)n[i]=e[i]*t;e=n}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof Mu?Qp:Jp)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function bf(t,e,n){const i=e.attributes,r=[];function s(e,i){return n.getDependency("accessor",e).then(function(e){t.setAttribute(i,e)})}for(const a in i){const e=sf[a]||a.toLowerCase();e in t.attributes||r.push(s(i[a],e))}if(void 0!==e.indices&&!t.index){const i=n.getDependency("accessor",e.indices).then(function(e){t.setIndex(e)});r.push(i)}return pn.workingColorSpace,pf(t,e),function(t,e,n){const i=e.attributes,r=new On;if(void 0===i.POSITION)return;{const t=n.json.accessors[i.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return;if(r.set(new Pn(e[0],e[1],e[2]),new Pn(s[0],s[1],s[2])),t.normalized){const e=vf(tf[t.componentType]);r.min.multiplyScalar(e),r.max.multiplyScalar(e)}}const s=e.targets;if(void 0!==s){const t=new Pn,e=new Pn;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,a=i.max;if(void 0!==s&&void 0!==a){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),i.normalized){const t=vf(tf[i.componentType]);e.multiplyScalar(t)}t.max(e)}}}r.expandByVector(t)}t.boundingBox=r;const a=new Jn;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=a}(t,e,n),Promise.all(r).then(function(){return void 0!==e.targets?function(t,e,n){let i=!1,r=!1,s=!1;for(let h=0,c=e.length;h<c;h++){const t=e[h];if(void 0!==t.POSITION&&(i=!0),void 0!==t.NORMAL&&(r=!0),void 0!==t.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(t);const a=[],o=[],l=[];for(let h=0,c=e.length;h<c;h++){const c=e[h];if(i){const e=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):t.attributes.position;a.push(e)}if(r){const e=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):t.attributes.normal;o.push(e)}if(s){const e=void 0!==c.COLOR_0?n.getDependency("accessor",c.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(e){const n=e[0],a=e[1],o=e[2];return i&&(t.morphAttributes.position=n),r&&(t.morphAttributes.normal=a),s&&(t.morphAttributes.color=o),t.morphTargetsRelative=!0,t})}(t,e.targets,n):t})}var _f=function(){var t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),e=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var n,i=WebAssembly.validate(t)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",r=WebAssembly.instantiate(s(i),{}).then(function(t){(n=t.instance).exports.__wasm_call_ctors()});function s(t){for(var n=new Uint8Array(t.length),i=0;i<t.length;++i){var r=t.charCodeAt(i);n[i]=r>96?r-97:r>64?r-39:r+4}var s=0;for(i=0;i<t.length;++i)n[s++]=n[i]<60?e[n[i]]:64*(n[i]-60)+n[++i];return n.buffer.slice(0,s)}function a(t,e,i,r,s,a){var o=n.exports.sbrk,l=i+3&-4,h=o(l*r),c=o(s.length),u=new Uint8Array(n.exports.memory.buffer);u.set(s,c);var d=t(h,i,r,c,s.length);if(0==d&&a&&a(h,l,r),e.set(u.subarray(h,h+i*r)),o(h-o(0)),0!=d)throw new Error("Malformed buffer data: "+d)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},h=[],c=0;function u(t){var e={object:new Worker(t),pending:0,requests:{}};return e.object.onmessage=function(t){var n=t.data;e.pending-=n.count,e.requests[n.id][n.action](n.value),delete e.requests[n.id]},e}function d(t){for(var e="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(s(i))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+a.toString()+p.toString(),n=new Blob([e],{type:"text/javascript"}),r=URL.createObjectURL(n),o=0;o<t;++o)h[o]=u(r);URL.revokeObjectURL(r)}function p(t){r.then(function(){var e=t.data;try{var i=new Uint8Array(e.count*e.size);a(n.exports[e.mode],i,e.count,e.size,e.source,n.exports[e.filter]),self.postMessage({id:e.id,count:e.count,action:"resolve",value:i},[i.buffer])}catch(r){self.postMessage({id:e.id,count:e.count,action:"reject",value:r})}})}return{ready:r,supported:!0,useWorkers:function(t){d(t)},decodeVertexBuffer:function(t,e,i,r,s){a(n.exports.meshopt_decodeVertexBuffer,t,e,i,r,n.exports[o[s]])},decodeIndexBuffer:function(t,e,i,r){a(n.exports.meshopt_decodeIndexBuffer,t,e,i,r)},decodeIndexSequence:function(t,e,i,r){a(n.exports.meshopt_decodeIndexSequence,t,e,i,r)},decodeGltfBuffer:function(t,e,i,r,s,h){a(n.exports[l[s]],t,e,i,r,n.exports[o[h]])},decodeGltfBufferAsync:function(t,e,i,s,u){return h.length>0?function(t,e,n,i,r){for(var s=h[0],a=1;a<h.length;++a)h[a].pending<s.pending&&(s=h[a]);return new Promise(function(a,o){var l=new Uint8Array(n),h=c++;s.pending+=t,s.requests[h]={resolve:a,reject:o},s.object.postMessage({id:h,count:t,size:e,source:l,mode:i,filter:r},[l.buffer])})}(t,e,i,l[s],o[u]):r.then(function(){var r=new Uint8Array(t*e);return a(n.exports[l[s]],r,t,e,i,n.exports[o[u]]),r})}}}();const Sf=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let wf=1234567;const Tf=Math.PI/180,Mf=180/Math.PI;function Af(t,e,n){return Math.max(e,Math.min(n,t))}function Ef(t,e){return(t%e+e)%e}function Cf(t,e,n){return(1-n)*t+n*e}const Pf={DEG2RAD:Tf,RAD2DEG:Mf,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Sf[255&t]+Sf[t>>8&255]+Sf[t>>16&255]+Sf[t>>24&255]+"-"+Sf[255&e]+Sf[e>>8&255]+"-"+Sf[e>>16&15|64]+Sf[e>>24&255]+"-"+Sf[63&n|128]+Sf[n>>8&255]+"-"+Sf[n>>16&255]+Sf[n>>24&255]+Sf[255&i]+Sf[i>>8&255]+Sf[i>>16&255]+Sf[i>>24&255]).toLowerCase()},clamp:Af,euclideanModulo:Ef,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Cf,damp:function(t,e,n,i){return Cf(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(Ef(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(wf=t);let e=wf+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Tf},radToDeg:function(t){return t*Mf},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),h=s((e+i)/2),c=a((e+i)/2),u=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),f=a((i-e)/2);switch(r){case"XYX":t.set(o*c,l*u,l*d,o*h);break;case"YZY":t.set(l*d,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*d,o*c,o*h);break;case"XZX":t.set(o*c,l*f,l*p,o*h);break;case"YXY":t.set(l*p,o*c,l*f,o*h);break;case"ZYZ":t.set(l*f,l*p,o*c,o*h)}},normalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}},denormalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}};class Rf{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,s,a){let o=n[i+0],l=n[i+1],h=n[i+2],c=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||o!==u||l!==d||h!==p){let t=1-a;const e=o*u+l*d+h*p+c*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],h=n[i+3],c=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-o*c,t[e+3]=h*p-a*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new Rf(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,i=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(n/2),h=a(i/2),c=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=n+a+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>a&&n>c){const t=2*Math.sqrt(1+n-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(a>c){const t=2*Math.sqrt(1+a-n-c);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-n-a);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Af(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=n*h+s*a+i*l-r*o,this._y=i*h+s*o+r*a-n*l,this._z=r*h+s*l+n*o-i*a,this._w=s*h-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=s*c+this._w*u,this._x=n*c+this._x*u,this._y=i*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class If{constructor(t=0,e=0,n=0){this.isVector3=!0,If.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new If(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Df.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Df.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=2*(s*i-a*n),h=2*(a*e-r*i),c=2*(r*n-s*e);return this.x=e+o*l+s*c-a*h,this.y=n+o*h+a*l-r*c,this.z=i+o*c+r*h-s*l,this}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Of.copy(this).projectOnVector(t),this.sub(Of)}reflect(t){return this.sub(Of.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Af(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Of=new If,Df=new Rf,Bf=2e3;class Ff{constructor(t,e,n,i,r,s,a,o,l,h,c,u,d,p,f,m){this.isMatrix4=!0,Ff.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,l,h,c,u,d,p,f,m)}extractPosition(t){return this.copyPosition(t)}multiplyToArray(t,e,n){return this}setRotationFromQuaternion(t){return this.makeRotationFromQuaternion(t)}set(t,e,n,i,r,s,a,o,l,h,c,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ff).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Lf.setFromMatrixColumn(t,0).length(),r=1/Lf.setFromMatrixColumn(t,1).length(),s=1/Lf.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=s*h,n=s*c,i=a*h,r=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*h,n=o*c,i=l*h,r=l*c;e[0]=t+r*a,e[4]=i*a-n,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-a,e[2]=n*a-i,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*h,n=o*c,i=l*h,r=l*c;e[0]=t-r*a,e[4]=-s*c,e[8]=i+n*a,e[1]=n+i*a,e[5]=s*h,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*h,n=s*c,i=a*h,r=a*c;e[0]=o*h,e[4]=i*l-n,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*h,e[4]=r-t*c,e[8]=i*c+n,e[1]=c,e[5]=s*h,e[9]=-a*h,e[2]=-l*h,e[6]=n*c+i,e[10]=t-r*c}else if("XZY"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=n*c-i,e[2]=i*c-n,e[6]=a*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(kf,t,Nf)}lookAt(t,e,n){const i=this.elements;return Hf.subVectors(t,e),0===Hf.lengthSq()&&(Hf.z=1),Hf.normalize(),zf.crossVectors(n,Hf),0===zf.lengthSq()&&(1===Math.abs(n.z)?Hf.x+=1e-4:Hf.z+=1e-4,Hf.normalize(),zf.crossVectors(n,Hf)),zf.normalize(),Gf.crossVectors(Hf,zf),i[0]=zf.x,i[4]=Gf.x,i[8]=Hf.x,i[1]=zf.y,i[5]=Gf.y,i[9]=Hf.y,i[2]=zf.z,i[6]=Gf.z,i[10]=Hf.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],h=n[1],c=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],_=i[0],S=i[4],w=i[8],T=i[12],M=i[1],A=i[5],E=i[9],C=i[13],P=i[2],R=i[6],I=i[10],O=i[14],D=i[3],B=i[7],F=i[11],L=i[15];return r[0]=s*_+a*M+o*P+l*D,r[4]=s*S+a*A+o*R+l*B,r[8]=s*w+a*E+o*I+l*F,r[12]=s*T+a*C+o*O+l*L,r[1]=h*_+c*M+u*P+d*D,r[5]=h*S+c*A+u*R+d*B,r[9]=h*w+c*E+u*I+d*F,r[13]=h*T+c*C+u*O+d*L,r[2]=p*_+f*M+m*P+g*D,r[6]=p*S+f*A+m*R+g*B,r[10]=p*w+f*E+m*I+g*F,r[14]=p*T+f*C+m*O+g*L,r[3]=v*_+y*M+x*P+b*D,r[7]=v*S+y*A+x*R+b*B,r[11]=v*w+y*E+x*I+b*F,r[15]=v*T+y*C+x*O+b*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-i*l*c-r*a*u+n*l*u+i*a*d-n*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-i*s*d+i*l*h-r*o*h)+t[11]*(+e*l*c-e*a*d-r*s*c+n*s*d+r*a*h-n*l*h)+t[15]*(-i*a*h-e*o*c+e*a*u+i*s*c-n*s*u+n*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=c*m*l-f*u*l+f*o*d-a*m*d-c*o*g+a*u*g,y=p*u*l-h*m*l-p*o*d+s*m*d+h*o*g-s*u*g,x=h*f*l-p*c*l+p*a*d-s*f*d-h*a*g+s*c*g,b=p*c*o-h*f*o-p*a*u+s*f*u+h*a*m-s*c*m,_=e*v+n*y+i*x+r*b;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/_;return t[0]=v*S,t[1]=(f*u*r-c*m*r-f*i*d+n*m*d+c*i*g-n*u*g)*S,t[2]=(a*m*r-f*o*r+f*i*l-n*m*l-a*i*g+n*o*g)*S,t[3]=(c*o*r-a*u*r-c*i*l+n*u*l+a*i*d-n*o*d)*S,t[4]=y*S,t[5]=(h*m*r-p*u*r+p*i*d-e*m*d-h*i*g+e*u*g)*S,t[6]=(p*o*r-s*m*r-p*i*l+e*m*l+s*i*g-e*o*g)*S,t[7]=(s*u*r-h*o*r+h*i*l-e*u*l-s*i*d+e*o*d)*S,t[8]=x*S,t[9]=(p*c*r-h*f*r-p*n*d+e*f*d+h*n*g-e*c*g)*S,t[10]=(s*f*r-p*a*r+p*n*l-e*f*l-s*n*g+e*a*g)*S,t[11]=(h*a*r-s*c*r-h*n*l+e*c*l+s*n*d-e*a*d)*S,t[12]=b*S,t[13]=(h*f*i-p*c*i+p*n*u-e*f*u-h*n*m+e*c*m)*S,t[14]=(p*a*i-s*f*i-p*n*o+e*f*o+s*n*m-e*a*m)*S,t[15]=(s*c*i-h*a*i+h*n*o-e*c*o-s*n*u+e*a*u)*S,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,a=t.y,o=t.z,l=r*s,h=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,h*a+n,h*o-i*s,0,l*o-i*a,h*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,h=s+s,c=a+a,u=r*l,d=r*h,p=r*c,f=s*h,m=s*c,g=a*c,v=o*l,y=o*h,x=o*c,b=n.x,_=n.y,S=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+x)*b,i[2]=(p-y)*b,i[3]=0,i[4]=(d-x)*_,i[5]=(1-(u+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(p+y)*S,i[9]=(m-v)*S,i[10]=(1-(u+f))*S,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Lf.set(i[0],i[1],i[2]).length();const s=Lf.set(i[4],i[5],i[6]).length(),a=Lf.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Uf.copy(this);const o=1/r,l=1/s,h=1/a;return Uf.elements[0]*=o,Uf.elements[1]*=o,Uf.elements[2]*=o,Uf.elements[4]*=l,Uf.elements[5]*=l,Uf.elements[6]*=l,Uf.elements[8]*=h,Uf.elements[9]*=h,Uf.elements[10]*=h,e.setFromRotationMatrix(Uf),n.x=r,n.y=s,n.z=a,this}makePerspective(t,e,n,i,r,s,a=2e3){const o=this.elements,l=2*r/(e-t),h=2*r/(n-i),c=(e+t)/(e-t),u=(n+i)/(n-i);let d,p;if(a===Bf)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(2001!==a)throw new Error("Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r)}return o[0]=l,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=h,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s,a=2e3){const o=this.elements,l=1/(e-t),h=1/(n-i),c=1/(s-r),u=(e+t)*l,d=(n+i)*h;let p,f;if(a===Bf)p=(s+r)*c,f=-2*c;else{if(2001!==a)throw new Error("../math.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*c,f=-1*c}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Lf=new If,Uf=new Ff,kf=new If(0,0,0),Nf=new If(1,1,1),zf=new If,Gf=new If,Hf=new If,Vf=new Ff,Xf=new Rf;class Wf{constructor(t=0,e=0,n=0,i=Wf.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new Wf(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],h=i[9],c=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(Af(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Af(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(Af(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Af(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Af(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Af(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,d),this._y=0)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Vf.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Vf,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Xf.setFromEuler(this),this.setFromQuaternion(Xf,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(t){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Wf.DEFAULT_ORDER="XYZ";let jf=class t{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new t(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Af(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};jf.isVector2=!0;class Yf{constructor(t=0,e=0,n=0,i=1){Yf.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new Yf(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,a=.1,o=t.elements,l=o[0],h=o[4],c=o[8],u=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(h-u)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(h+u)<a&&Math.abs(c+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,v=(g+1)/2,y=(h+u)/4,x=(c+f)/4,b=(p+m)/4;return t>o&&t>v?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=y/n,r=x/n):o>v?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=y/i,r=b/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=x/r,i=b/r),this.set(n,i,r,e),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-h)*(u-h));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(u-h)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class qf{constructor(t,e,n,i,r,s,a,o,l){qf.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,l)}set(t,e,n,i,r,s,a,o,l){const h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=r,h[5]=o,h[6]=n,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],h=n[4],c=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],_=i[5],S=i[8];return r[0]=s*f+a*v+o*b,r[3]=s*m+a*y+o*_,r[6]=s*g+a*x+o*S,r[1]=l*f+h*v+c*b,r[4]=l*m+h*y+c*_,r[7]=l*g+h*x+c*S,r[2]=u*f+d*v+p*b,r[5]=u*m+d*y+p*_,r[8]=u*g+d*x+p*S,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8];return e*s*h-e*a*l-n*r*h+n*a*o+i*r*l-i*s*o}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=h*s-a*l,u=a*o-h*r,d=l*r-s*o,p=e*c+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(i*l-h*n)*f,t[2]=(a*n-i*s)*f,t[3]=u*f,t[4]=(h*e-i*o)*f,t[5]=(i*r-a*e)*f,t[6]=d*f,t[7]=(n*o-l*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+t,-i*l,i*o,-i*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Kf.makeScale(t,e)),this}rotate(t){return this.premultiply(Kf.makeRotation(-t)),this}translate(t,e){return this.premultiply(Kf.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new qf).fromArray(this.elements)}}const Kf=new qf;var Jf,Zf;function Qf(t,e,n,i){let r;switch(Jf.Random===t?e=Math.random():Jf.Burst===t&&i.isBursting&&(e=i.burstParticleIndex/i.burstParticleCount),r=n>0?Math.floor(e/n)*n:e,t){case Jf.Loop:r%=1;break;case Jf.PingPong:r=Math.abs(r%2-1)}return r}(Zf=Jf||(Jf={}))[Zf.Random=0]="Random",Zf[Zf.Loop=1]="Loop",Zf[Zf.PingPong=2]="PingPong",Zf[Zf.Burst=3]="Burst";class $f{constructor(t,e,n,i){this.p=[t,e,n,i]}genValue(t){const e=t*t,n=t*t*t,i=1-t,r=i*i,s=r*i;return this.p[0]*s+this.p[1]*r*t*3+this.p[2]*i*e*3+this.p[3]*n}derivativeCoefficients(t){const e=[];for(let n=t,i=n.length-1;i>0;i--){const t=[];for(let e=0;e<i;e++){const r=i*(n[e+1]-n[e]);t.push(r)}e.push(t),n=t}return e}getSlope(t){const e=this.derivativeCoefficients(this.p)[0],n=1-t,i=n*t*2,r=t*t;return n*n*e[0]+i*e[1]+r*e[2]}controlCurve(t,e){this.p[1]=t/3+this.p[0],this.p[2]=this.p[3]-e/3}hull(t){let e,n=this.p,i=[],r=0,s=0,a=0;const o=[];for(o[r++]=n[0],o[r++]=n[1],o[r++]=n[2],o[r++]=n[3];n.length>1;){for(i=[],s=0,a=n.length-1;s<a;s++)e=t*n[s]+(1-t)*n[s+1],o[r++]=e,i.push(e);n=i}return o}split(t){const e=this.hull(t);return{left:new $f(e[0],e[4],e[7],e[9]),right:new $f(e[9],e[8],e[6],e[3]),span:e}}clone(){return new $f(this.p[0],this.p[1],this.p[2],this.p[3])}toJSON(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}static fromJSON(t){return new $f(t.p0,t.p1,t.p2,t.p3)}}const tm=t=>({r:t.x,g:t.y,b:t.z,a:t.w}),em=t=>new Yf(t.r,t.g,t.b,t.a),nm=(t,e)=>{switch(e){case"Vector3":return new If(t.x,t.y,t.z);case"Vector4":return new Yf(t.x,t.y,t.z,t.w);case"Color":return new If(t.r,t.g,t.b);default:return t}},im=(t,e)=>{switch(e){case"Vector3":return{x:t.x,y:t.y,z:t.z};case"Vector4":return{x:t.x,y:t.y,z:t.z,w:t.w};case"Color":return{r:t.x,g:t.y,b:t.z};default:return t}};class rm{constructor(t,e){this.a=t,this.b=e,this.type="value"}startGen(t){}genColor(t,e){const n=Math.random();return e.copy(this.a).lerp(this.b,n)}toJSON(){return{type:"RandomColor",a:tm(this.a),b:tm(this.b)}}static fromJSON(t){return new rm(em(t.a),em(t.b))}clone(){return new rm(this.a.clone(),this.b.clone())}}class sm{constructor(t,e){this.a=t,this.b=e,this.indexCount=-1,this.type="value"}startGen(t){this.indexCount=t.length,t.push(Math.random())}genColor(t,e){return-1===this.indexCount&&this.startGen(t),e.copy(this.a).lerp(this.b,t[this.indexCount])}toJSON(){return{type:"ColorRange",a:tm(this.a),b:tm(this.b)}}static fromJSON(t){return new sm(em(t.a),em(t.b))}clone(){return new sm(this.a.clone(),this.b.clone())}}class am{constructor(t,e){this.subType=e,this.type="function",this.keys=t}findKey(t){let e=0,n=0,i=this.keys.length-1;for(;n+1<i;)if(e=Math.floor((n+i)/2),t<this.getStartX(e))i=e-1;else{if(!(t>this.getEndX(e)))return e;n=e+1}for(let r=n;r<=i;r++)if(t>=this.getStartX(r)&&t<=this.getEndX(r))return r;return-1}getStartX(t){return this.keys[t][1]}getEndX(t){return t+1<this.keys.length?this.keys[t+1][1]:1}genValue(t,e){const n=this.findKey(e);return"Number"===this.subType?-1===n?this.keys[0][0]:n+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[n+1][0]-this.keys[n][0])*((e-this.getStartX(n))/(this.getEndX(n)-this.getStartX(n)))+this.keys[n][0]:-1===n?t.copy(this.keys[0][0]):n+1>=this.keys.length?t.copy(this.keys[this.keys.length-1][0]):t.copy(this.keys[n][0]).lerp(this.keys[n+1][0],(e-this.getStartX(n))/(this.getEndX(n)-this.getStartX(n)))}toJSON(){return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(([t,e])=>({value:im(t,this.subType),pos:e}))}}static fromJSON(t){return new am(t.keys.map(e=>[nm(e.value,t.subType),e.pos]),t.subType)}clone(){return"Number"===this.subType?new am(this.keys.map(([t,e])=>[t,e]),this.subType):new am(this.keys.map(([t,e])=>[t.clone(),e]),this.subType)}}const om=new If;class lm{constructor(t=[[new If(0,0,0),0],[new If(1,1,1),0]],e=[[1,0],[1,1]]){this.type="function",this.color=new am(t,"Color"),this.alpha=new am(e,"Number")}genColor(t,e,n){return this.color.genValue(om,n),e.set(om.x,om.y,om.z,this.alpha.genValue(1,n))}toJSON(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}static fromJSON(t){if(t.functions){const e=t.functions.map(t=>[sm.fromJSON(t.function).a,t.start]);return t.functions.length>0&&e.push([sm.fromJSON(t.functions[t.functions.length-1].function).b,1]),new lm(e.map(t=>[new If(t[0].x,t[0].y,t[0].z),t[1]]),e.map(t=>[t[0].w,t[1]]))}{const e=new lm;return e.alpha=am.fromJSON(t.alpha),e.color=am.fromJSON(t.color),e}}clone(){const t=new lm;return t.alpha=this.alpha.clone(),t.color=this.color.clone(),t}startGen(t){}}const hm=new Yf;class cm{constructor(t,e){this.indexCount=0,this.type="function",this.gradient1=t,this.gradient2=e}startGen(t){this.indexCount=t.length,t.push(Math.random())}genColor(t,e,n){return this.gradient1.genColor(t,e,n),this.gradient2.genColor(t,hm,n),t&&void 0!==t[this.indexCount]?e.lerp(hm,t[this.indexCount]):e.lerp(hm,Math.random()),e}toJSON(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}static fromJSON(t){return new cm(lm.fromJSON(t.gradient1),lm.fromJSON(t.gradient2))}clone(){return new cm(this.gradient1.clone(),this.gradient2.clone())}}class um{constructor(t){this.color=t,this.type="value"}startGen(t){}genColor(t,e){return e.copy(this.color)}toJSON(){return{type:"ConstantColor",color:tm(this.color)}}static fromJSON(t){return new um(em(t.color))}clone(){return new um(this.color.clone())}}function dm(t){switch(t.type){case"ConstantColor":return um.fromJSON(t);case"ColorRange":return sm.fromJSON(t);case"RandomColor":return rm.fromJSON(t);case"Gradient":return lm.fromJSON(t);case"RandomColorBetweenGradient":return cm.fromJSON(t);default:return new um(new Yf(1,1,1,1))}}class pm{constructor(t){this.value=t,this.type="value"}startGen(t){}genValue(t){return this.value}toJSON(){return{type:"ConstantValue",value:this.value}}static fromJSON(t){return new pm(t.value)}clone(){return new pm(this.value)}}class fm{constructor(t,e){this.a=t,this.b=e,this.indexCount=-1,this.type="value"}startGen(t){this.indexCount=t.length,t.push(Math.random())}genValue(t){return-1===this.indexCount&&this.startGen(t),Pf.lerp(this.a,this.b,t[this.indexCount])}toJSON(){return{type:"IntervalValue",a:this.a,b:this.b}}static fromJSON(t){return new fm(t.a,t.b)}clone(){return new fm(this.a,this.b)}}class mm{constructor(){this.functions=new Array}findFunction(t){let e=0,n=0,i=this.functions.length-1;for(;n+1<i;)if(e=Math.floor((n+i)/2),t<this.getStartX(e))i=e-1;else{if(!(t>this.getEndX(e)))return e;n=e+1}for(let r=n;r<=i;r++)if(t>=this.functions[r][1]&&t<=this.getEndX(r))return r;return-1}getStartX(t){return this.functions[t][1]}setStartX(t,e){t>0&&(this.functions[t][1]=e)}getEndX(t){return t+1<this.functions.length?this.functions[t+1][1]:1}setEndX(t,e){t+1<this.functions.length&&(this.functions[t+1][1]=e)}insertFunction(t,e){const n=this.findFunction(t);this.functions.splice(n+1,0,[e,t])}removeFunction(t){return this.functions.splice(t,1)[0][0]}getFunction(t){return this.functions[t][0]}setFunction(t,e){this.functions[t][0]=e}get numOfFunctions(){return this.functions.length}}class gm extends mm{constructor(t=[[new $f(0,1/3,1/3*2,1),0]]){super(),this.type="function",this.functions=t}genValue(t,e=0){const n=this.findFunction(e);return-1===n?0:this.functions[n][0].genValue((e-this.getStartX(n))/(this.getEndX(n)-this.getStartX(n)))}toSVG(t,e){if(e<1)return"";let n=["M",0,this.functions[0][0].p[0]].join(" ");for(let i=1/e;i<=1;i+=1/e)n=[n,"L",i*t,this.genValue(void 0,i)].join(" ");return n}toJSON(){return{type:"PiecewiseBezier",functions:this.functions.map(([t,e])=>({function:t.toJSON(),start:e}))}}static fromJSON(t){return new gm(t.functions.map(t=>[$f.fromJSON(t.function),t.start]))}clone(){return new gm(this.functions.map(([t,e])=>[t.clone(),e]))}startGen(t){}}function vm(t){switch(t.type){case"ConstantValue":return pm.fromJSON(t);case"IntervalValue":return fm.fromJSON(t);case"PiecewiseBezier":return gm.fromJSON(t);default:return new pm(0)}}class ym{constructor(){this.indexCount=0,this.type="rotation"}startGen(t){let e,n,i,r,s,a;this.indexCount=t.length,t.push(new Rf);do{e=2*Math.random()-1,n=2*Math.random()-1,i=e*e+n*n}while(i>1);do{r=2*Math.random()-1,s=2*Math.random()-1,a=r*r+s*s}while(a>1);const o=Math.sqrt((1-i)/a);t[this.indexCount].set(e,n,o*r,o*s)}genValue(t,e,n,i){return-1===this.indexCount&&this.startGen(t),e.copy(t[this.indexCount]),e}toJSON(){return{type:"RandomQuat"}}static fromJSON(t){return new ym}clone(){return new ym}}class xm{constructor(t,e){this.axis=t,this.angle=e,this.type="rotation"}startGen(t){this.angle.startGen(t)}genValue(t,e,n,i){return e.setFromAxisAngle(this.axis,this.angle.genValue(t,i)*n)}toJSON(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}static fromJSON(t){return new xm(new If(t.axis.x,t.axis.y,t.axis.z),vm(t.angle))}clone(){return new xm(this.axis.clone(),this.angle.clone())}}class bm{constructor(t,e,n,i){this.angleX=t,this.angleY=e,this.angleZ=n,this.type="rotation",this.eular=new Wf(0,0,0,i)}startGen(t){this.angleX.startGen(t),this.angleY.startGen(t),this.angleZ.startGen(t)}genValue(t,e,n,i){return this.eular.set(this.angleX.genValue(t,i)*n,this.angleY.genValue(t,i)*n,this.angleZ.genValue(t,i)*n),e.setFromEuler(this.eular)}toJSON(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON(),eulerOrder:this.eular.order}}static fromJSON(t){return new bm(vm(t.angleX),vm(t.angleY),vm(t.angleZ),t.eulerOrder)}clone(){return new bm(this.angleX,this.angleY,this.angleZ,this.eular.order)}}function _m(t){switch(t.type){case"AxisAngle":return xm.fromJSON(t);case"Euler":return bm.fromJSON(t);case"RandomQuat":return ym.fromJSON(t);default:return new ym}}class Sm{constructor(t,e,n){this.x=t,this.y=e,this.z=n,this.type="vec3function"}startGen(t){this.x.startGen(t),this.y.startGen(t),this.z.startGen(t)}genValue(t,e,n){return e.set(this.x.genValue(t,n),this.y.genValue(t,n),this.z.genValue(t,n))}toJSON(){return{type:"Vector3Function",x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(t){return new Sm(vm(t.x),vm(t.y),vm(t.z))}clone(){return new Sm(this.x,this.y,this.z)}}function wm(t){switch(t.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return vm(t);case"AxisAngle":case"RandomQuat":case"Euler":return _m(t);case"Vector3Function":return function(t){return"Vector3Function"===t.type?Sm.fromJSON(t):new Sm(new pm(0),new pm(0),new pm(0))}(t);default:return new pm(0)}}class Tm{constructor(t={}){this.type="cone",this.currentValue=0,this.radius=t.radius??10,this.arc=t.arc??2*Math.PI,this.thickness=t.thickness??1,this.angle=t.angle??Math.PI/6,this.mode=t.mode??Jf.Random,this.spread=t.spread??0,this.speed=t.speed??new pm(1),this.memory=[]}update(t,e){Jf.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,t.emissionState.time/t.duration)*e)}initialize(t,e){const n=Qf(this.mode,this.currentValue,this.spread,e),i=Pf.lerp(1-this.thickness,1,Math.random()),r=n*this.arc,s=Math.sqrt(i),a=Math.sin(r),o=Math.cos(r);t.position.x=s*o,t.position.y=s*a,t.position.z=0;const l=this.angle*s;t.velocity.set(0,0,Math.cos(l)).addScaledVector(t.position,Math.sin(l)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}toJSON(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(t){return new Tm({radius:t.radius,arc:t.arc,thickness:t.thickness,angle:t.angle,mode:t.mode,speed:t.speed?vm(t.speed):void 0,spread:t.spread})}clone(){return new Tm({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class Mm{constructor(t={}){this.type="circle",this.currentValue=0,this.radius=t.radius??10,this.arc=t.arc??2*Math.PI,this.thickness=t.thickness??1,this.mode=t.mode??Jf.Random,this.spread=t.spread??0,this.speed=t.speed??new pm(1),this.memory=[]}update(t,e){this.currentValue+=this.speed.genValue(this.memory,t.emissionState.time/t.duration)*e}initialize(t,e){const n=Qf(this.mode,this.currentValue,this.spread,e),i=Pf.lerp(1-this.thickness,1,Math.random()),r=n*this.arc;t.position.x=Math.cos(r),t.position.y=Math.sin(r),t.position.z=0,t.velocity.copy(t.position).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius*i)}toJSON(){return{type:"circle",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(t){return new Mm({radius:t.radius,arc:t.arc,thickness:t.thickness,mode:t.mode,speed:t.speed?vm(t.speed):void 0,spread:t.spread})}clone(){return new Mm({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}function Am(t,e){return Math.floor(Math.random()*(e-t))+t}const Em=new If(0,1,0),Cm=new If(0,0,0),Pm=new If(1,1,1),Rm=new If(0,0,1);class Im{constructor(t={}){this.type="donut",this.currentValue=0,this.radius=t.radius??10,this.arc=t.arc??2*Math.PI,this.thickness=t.thickness??1,this.donutRadius=t.donutRadius??.2*this.radius,this.mode=t.mode??Jf.Random,this.spread=t.spread??0,this.speed=t.speed??new pm(1),this.memory=[],this._m1=new Ff}update(t,e){Jf.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,t.emissionState.time/t.duration)*e)}initialize(t,e){const n=Qf(this.mode,this.currentValue,this.spread,e),i=Math.random(),r=Pf.lerp(1-this.thickness,1,Math.random()),s=n*this.arc,a=i*Math.PI*2,o=Math.sin(s),l=Math.cos(s);t.position.x=this.radius*l,t.position.y=this.radius*o,t.position.z=0,t.velocity.z=this.donutRadius*r*Math.sin(a),t.velocity.x=this.donutRadius*r*Math.cos(a)*l,t.velocity.y=this.donutRadius*r*Math.cos(a)*o,t.position.add(t.velocity),t.velocity.normalize().multiplyScalar(t.startSpeed),t.rotation instanceof Rf&&(this._m1.lookAt(Cm,t.velocity,Em),t.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(t){return new Im({radius:t.radius,arc:t.arc,thickness:t.thickness,donutRadius:t.donutRadius,mode:t.mode,speed:t.speed?vm(t.speed):void 0,spread:t.spread})}clone(){return new Im({radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class Om{constructor(){this.type="point",this._m1=new Ff}update(t,e){}initialize(t){const e=Math.random(),n=Math.random(),i=e*Math.PI*2,r=Math.acos(2*n-1),s=Math.cbrt(Math.random()),a=Math.sin(i),o=Math.cos(i),l=Math.sin(r),h=Math.cos(r);t.velocity.x=s*l*o,t.velocity.y=s*l*a,t.velocity.z=s*h,t.velocity.multiplyScalar(t.startSpeed),t.position.setScalar(0),t.rotation instanceof Rf&&(this._m1.lookAt(Cm,t.position,Em),t.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"point"}}static fromJSON(t){return new Om}clone(){return new Om}}class Dm{constructor(t={}){this.type="sphere",this.currentValue=0,this.radius=t.radius??10,this.arc=t.arc??2*Math.PI,this.thickness=t.thickness??1,this.mode=t.mode??Jf.Random,this.spread=t.spread??0,this.speed=t.speed??new pm(1),this.memory=[],this._m1=new Ff}update(t,e){Jf.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,t.emissionState.time/t.duration)*e)}initialize(t,e){const n=Qf(this.mode,this.currentValue,this.spread,e),i=Math.random(),r=Pf.lerp(1-this.thickness,1,Math.random()),s=n*this.arc,a=Math.acos(2*i-1),o=Math.sin(s),l=Math.cos(s),h=Math.sin(a),c=Math.cos(a);t.position.x=h*l,t.position.y=h*o,t.position.z=c,t.velocity.copy(t.position).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius*r),t.rotation instanceof Rf&&(this._m1.lookAt(Cm,t.position,Em),t.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(t){return new Dm({radius:t.radius,arc:t.arc,thickness:t.thickness,mode:t.mode,speed:t.speed?vm(t.speed):void 0,spread:t.spread})}clone(){return new Dm({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class Bm{constructor(t={}){this.type="hemisphere",this.currentValue=0,this.radius=t.radius??10,this.arc=t.arc??2*Math.PI,this.thickness=t.thickness??1,this.mode=t.mode??Jf.Random,this.spread=t.spread??0,this.speed=t.speed??new pm(1),this.memory=[],this._m1=new Ff}update(t,e){Jf.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,t.emissionState.time/t.duration)*e)}initialize(t,e){const n=Qf(this.mode,this.currentValue,this.spread,e),i=Math.random(),r=Pf.lerp(1-this.thickness,1,Math.random()),s=n*this.arc,a=Math.acos(i),o=Math.sin(s),l=Math.cos(s),h=Math.sin(a),c=Math.cos(a);t.position.x=h*l,t.position.y=h*o,t.position.z=c,t.velocity.copy(t.position).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius*r),t.rotation instanceof Rf&&(this._m1.lookAt(Cm,t.position,Em),t.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"hemisphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(t){return new Bm({radius:t.radius,arc:t.arc,thickness:t.thickness,mode:t.mode,speed:t.speed?vm(t.speed):void 0,spread:t.spread})}clone(){return new Bm({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class Fm{constructor(t={}){this.type="grid",this.width=t.width??1,this.height=t.height??1,this.column=t.column??10,this.row=t.row??10}initialize(t){const e=Math.floor(Math.random()*this.row),n=Math.floor(Math.random()*this.column);t.position.x=n*this.width/this.column-this.width/2,t.position.y=e*this.height/this.row-this.height/2,t.position.z=0,t.velocity.set(0,0,t.startSpeed)}toJSON(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}static fromJSON(t){return new Fm(t)}clone(){return new Fm({width:this.width,height:this.height,column:this.column,row:this.row})}update(t,e){}}class Lm{constructor(t={}){this.type="rectangle",this.currentValue=0,this.width=t.width??10,this.height=t.height??10,this.thickness=t.thickness??1,this.mode=t.mode??Jf.Random,this.spread=t.spread??0,this.speed=t.speed??new pm(1),this.memory=[],this._m1=new Ff}update(t,e){this.currentValue+=this.speed.genValue(this.memory,t.emissionState.time/t.duration)*e}initialize(t,e){const n=Qf(this.mode,this.currentValue,this.spread,e)*(2*(this.width+this.height));let i,r;n<this.width?(i=n-this.width/2,r=-this.height/2):n<this.width+this.height?(i=this.width/2,r=n-this.width-this.height/2):n<2*this.width+this.height?(i=this.width/2-(n-this.width-this.height),r=this.height/2):(i=-this.width/2,r=this.height/2-(n-2*this.width-this.height));const s=Math.random(),a=1-this.thickness*s;t.position.x=i*a,t.position.y=r*a,t.position.z=0,t.velocity.x=i,t.velocity.y=r,t.velocity.z=0,t.velocity.normalize().multiplyScalar(t.startSpeed),t.rotation instanceof Rf&&(this._m1.lookAt(Cm,t.velocity,Em),t.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"rectangle",width:this.width,height:this.height,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(t){return new Lm({width:t.width,height:t.height,thickness:t.thickness,mode:t.mode,speed:t.speed?vm(t.speed):void 0,spread:t.spread})}clone(){return new Lm({width:this.width,height:this.height,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}const Um={circle:{type:"circle",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc","value"]]],constructor:Mm,loadJSON:Mm.fromJSON},cone:{type:"cone",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc","value"]]],constructor:Tm,loadJSON:Tm.fromJSON},donut:{type:"donut",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["donutRadius",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc","value"]]],constructor:Im,loadJSON:Im.fromJSON},point:{type:"point",params:[],constructor:Om,loadJSON:Om.fromJSON},sphere:{type:"sphere",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc","value"]]],constructor:Dm,loadJSON:Dm.fromJSON},hemisphere:{type:"hemisphere",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc","value"]]],constructor:Bm,loadJSON:Bm.fromJSON},grid:{type:"grid",params:[["width",["number"]],["height",["number"]],["rows",["number"]],["column",["number"]]],constructor:Fm,loadJSON:Fm.fromJSON},rectangle:{type:"rectangle",params:[["width",["number"]],["height",["number"]],["thickness",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc","value"]]],constructor:Lm,loadJSON:Lm.fromJSON}};class km{constructor(t){this.color=t,this.type="ColorOverLife"}initialize(t){this.color.startGen(t.memory)}update(t,e){this.color.genColor(t.memory,t.color,t.age/t.life),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}frameUpdate(t){}toJSON(){return{type:this.type,color:this.color.toJSON()}}static fromJSON(t){return new km(dm(t.color))}clone(){return new km(this.color.clone())}reset(){}}class Nm{constructor(t){this.angularVelocity=t,this.type="RotationOverLife"}initialize(t){"number"==typeof t.rotation&&this.angularVelocity.startGen(t.memory)}update(t,e){"number"==typeof t.rotation&&(t.rotation+=e*this.angularVelocity.genValue(t.memory,t.age/t.life))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(t){return new Nm(vm(t.angularVelocity))}frameUpdate(t){}clone(){return new Nm(this.angularVelocity.clone())}reset(){}}class zm{constructor(t){this.angularVelocity=t,this.type="Rotation3DOverLife",this.tempQuat=new Rf,this.tempQuat2=new Rf}initialize(t){t.rotation instanceof Rf&&(t.angularVelocity=new Rf,this.angularVelocity.startGen(t.memory))}update(t,e){t.rotation instanceof Rf&&(this.angularVelocity.genValue(t.memory,this.tempQuat,e,t.age/t.life),t.rotation.multiply(this.tempQuat))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(t){return new zm(_m(t.angularVelocity))}frameUpdate(t){}clone(){return new zm(this.angularVelocity.clone())}reset(){}}class Gm{initialize(t,e){this.ps=e,this.x.startGen(t.memory),this.y.startGen(t.memory),this.z.startGen(t.memory)}constructor(t,e,n){this.x=t,this.y=e,this.z=n,this.type="ForceOverLife",this._temp=new If,this._tempScale=new If,this._tempQ=new Rf}update(t,e){this._temp.set(this.x.genValue(t.memory,t.age/t.life),this.y.genValue(t.memory,t.age/t.life),this.z.genValue(t.memory,t.age/t.life)),this.ps.worldSpace||this._temp.multiply(this._tempScale).applyQuaternion(this._tempQ),t.velocity.addScaledVector(this._temp,e)}toJSON(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(t){return new Gm(vm(t.x),vm(t.y),vm(t.z))}frameUpdate(t){if(this.ps&&!this.ps.worldSpace){const t=this._temp,e=this._tempQ,n=this._tempScale;this.ps.emitter.matrixWorld.decompose(t,e,n),e.invert(),n.set(1/n.x,1/n.y,1/n.z)}}clone(){return new Gm(this.x.clone(),this.y.clone(),this.z.clone())}reset(){}}class Hm{initialize(t){this.size.startGen(t.memory)}constructor(t){this.size=t,this.type="SizeOverLife"}update(t){this.size instanceof Sm?this.size.genValue(t.memory,t.size,t.age/t.life).multiply(t.startSize):t.size.copy(t.startSize).multiplyScalar(this.size.genValue(t.memory,t.age/t.life))}toJSON(){return{type:this.type,size:this.size.toJSON()}}static fromJSON(t){return new Hm(wm(t.size))}frameUpdate(t){}clone(){return new Hm(this.size.clone())}reset(){}}class Vm{initialize(t){this.speed.startGen(t.memory)}constructor(t){this.speed=t,this.type="SpeedOverLife"}update(t){t.speedModifier=this.speed.genValue(t.memory,t.age/t.life)}toJSON(){return{type:this.type,speed:this.speed.toJSON()}}static fromJSON(t){return new Vm(vm(t.speed))}frameUpdate(t){}clone(){return new Vm(this.speed.clone())}reset(){}}class Xm{constructor(t){this.frame=t,this.type="FrameOverLife"}initialize(t){this.frame.startGen(t.memory)}update(t,e){this.frame instanceof gm&&(t.uvTile=this.frame.genValue(t.memory,t.age/t.life))}frameUpdate(t){}toJSON(){return{type:this.type,frame:this.frame.toJSON()}}static fromJSON(t){return new Xm(vm(t.frame))}clone(){return new Xm(this.frame.clone())}reset(){}}class Wm{constructor(t,e=new If(0,1,0)){this.orbitSpeed=t,this.axis=e,this.type="OrbitOverLife",this.temp=new If,this.rotation=new Rf}initialize(t){this.orbitSpeed.startGen(t.memory)}update(t,e){this.temp.copy(t.position).projectOnVector(this.axis),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(t.memory,t.age/t.life)*e),t.position.sub(this.temp),t.position.applyQuaternion(this.rotation),t.position.add(this.temp)}frameUpdate(t){}toJSON(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}static fromJSON(t){return new Wm(vm(t.orbitSpeed),t.axis?new If(t.axis[0],t.axis[1],t.axis[2]):void 0)}clone(){return new Wm(this.orbitSpeed.clone())}reset(){}}class jm{constructor(t){this.data=t,this.next=null,this.prev=null}hasPrev(){return null!==this.prev}hasNext(){return null!==this.next}}class Ym{constructor(){this.length=0,this.head=this.tail=null}isEmpty(){return null===this.head}clear(){this.length=0,this.head=this.tail=null}front(){return null===this.head?null:this.head.data}back(){return null===this.tail?null:this.tail.data}dequeue(){if(this.head){const t=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}}pop(){if(this.tail){const t=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}}queue(t){const e=new jm(t);this.tail||(this.tail=e),this.head&&(this.head.prev=e,e.next=this.head),this.head=e,this.length++}push(t){const e=new jm(t);this.head||(this.head=e),this.tail&&(this.tail.next=e,e.prev=this.tail),this.tail=e,this.length++}insertBefore(t,e){const n=new jm(e);n.next=t,n.prev=t.prev,null!==n.prev&&(n.prev.next=n),n.next.prev=n,t==this.head&&(this.head=n),this.length++}remove(t){if(null===this.head||null===this.tail)return;let e=this.head;for(t===this.head.data&&(this.head=this.head.next),t===this.tail.data&&(this.tail=this.tail.prev);null!==e.next&&e.data!==t;)e=e.next;e.data===t&&(null!==e.prev&&(e.prev.next=e.next),null!==e.next&&(e.next.prev=e.prev),this.length--)}*values(){let t=this.head;for(;null!==t;)yield t.data,t=t.next}}class qm{constructor(){this.startSpeed=0,this.startColor=new Yf,this.startSize=new If(1,1,1),this.position=new If,this.velocity=new If,this.age=0,this.life=1,this.size=new If(1,1,1),this.speedModifier=1,this.rotation=0,this.color=new Yf,this.uvTile=0,this.memory=[]}get died(){return this.age>=this.life}reset(){this.memory.length=0}}class Km{constructor(t,e,n){this.position=t,this.size=e,this.color=n}}class Jm{constructor(){this.startSpeed=0,this.startColor=new Yf,this.startSize=new If(1,1,1),this.position=new If,this.velocity=new If,this.age=0,this.life=1,this.size=new If(1,1,1),this.length=100,this.speedModifier=1,this.color=new Yf,this.previous=new Ym,this.uvTile=0,this.memory=[]}update(){for(this.age<=this.life?this.previous.push(new Km(this.position.clone(),this.size.x,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}get died(){return this.age>=this.life}reset(){this.memory.length=0,this.previous.clear()}}class Zm{initialize(t){this.width.startGen(t.memory)}constructor(t){this.width=t,this.type="WidthOverLength"}update(t){if(t instanceof Jm){const e=t.previous.values();for(let n=0;n<t.previous.length;n++){e.next().value.size=this.width.genValue(t.memory,(t.previous.length-n)/t.length)}}}frameUpdate(t){}toJSON(){return{type:this.type,width:this.width.toJSON()}}static fromJSON(t){return new Zm(vm(t.width))}clone(){return new Zm(this.width.clone())}reset(){}}class Qm{constructor(t,e){this.direction=t,this.magnitude=e,this.type="ApplyForce",this.memory={data:[],dataCount:0},this.magnitudeValue=this.magnitude.genValue(this.memory)}initialize(t){}update(t,e){t.velocity.addScaledVector(this.direction,this.magnitudeValue*e)}frameUpdate(t){this.magnitudeValue=this.magnitude.genValue(this.memory)}toJSON(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}static fromJSON(t){return new Qm(new If(t.direction[0],t.direction[1],t.direction[2]),vm(t.magnitude??t.force))}clone(){return new Qm(this.direction.clone(),this.magnitude.clone())}reset(){}}class $m{constructor(t,e){this.center=t,this.magnitude=e,this.type="GravityForce",this.temp=new If}initialize(t){}update(t,e){this.temp.copy(this.center).sub(t.position).normalize(),t.velocity.addScaledVector(this.temp,this.magnitude/t.position.distanceToSquared(this.center)*e)}frameUpdate(t){}toJSON(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}static fromJSON(t){return new $m(new If(t.center[0],t.center[1],t.center[2]),t.magnitude)}clone(){return new $m(this.center.clone(),this.magnitude)}reset(){}}class tg{constructor(t){this.angle=t,this.type="ChangeEmitDirection",this._temp=new If,this._q=new Rf,this.memory={data:[],dataCount:0}}initialize(t){const e=t.velocity.length();0!=e&&(t.velocity.normalize(),0===t.velocity.x&&0===t.velocity.y?this._temp.set(0,t.velocity.z,0):this._temp.set(-t.velocity.y,t.velocity.x,0),this.angle.startGen(this.memory),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue(this.memory)),this._temp.copy(t.velocity),t.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),t.velocity.applyQuaternion(this._q),t.velocity.setLength(e))}update(t,e){}frameUpdate(t){}toJSON(){return{type:this.type,angle:this.angle.toJSON()}}static fromJSON(t){return new tg(vm(t.angle))}clone(){return new tg(this.angle)}reset(){}}var eg,ng;(ng=eg||(eg={}))[ng.Death=0]="Death",ng[ng.Birth=1]="Birth",ng[ng.Frame=2]="Frame";class ig{constructor(t,e,n,i=eg.Frame,r=1){this.particleSystem=t,this.useVelocityAsBasis=e,this.subParticleSystem=n,this.mode=i,this.emitProbability=r,this.type="EmitSubParticleSystem",this.q_=new Rf,this.v_=new If,this.v2_=new If,this.subEmissions=new Array,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}initialize(t){}update(t,e){(this.mode===eg.Frame||this.mode===eg.Birth&&0===t.age||this.mode===eg.Death&&t.age+e>=t.life)&&this.emit(t,e)}emit(t,e){if(!this.subParticleSystem)return;if(Math.random()>this.emitProbability)return;const n=new Ff;this.setMatrixFromParticle(n,t),this.subEmissions.push({burstParticleCount:0,burstParticleIndex:0,isBursting:!1,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:n,travelDistance:0,particle:t})}frameUpdate(t){if(this.subParticleSystem)for(let e=0;e<this.subEmissions.length;e++)if(this.subEmissions[e].time>=this.subParticleSystem.system.duration)this.subEmissions[e]=this.subEmissions[this.subEmissions.length-1],this.subEmissions.length=this.subEmissions.length-1,e--;else{const n=this.subEmissions[e];n.particle&&n.particle.age<n.particle.life?this.setMatrixFromParticle(n.matrix,n.particle):n.particle=void 0,this.subParticleSystem.system.emit(t,n,n.matrix)}}toJSON(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis,mode:this.mode,emitProbability:this.emitProbability}}static fromJSON(t,e){return new ig(e,t.useVelocityAsBasis,t.subParticleSystem,t.mode,t.emitProbability)}clone(){return new ig(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem,this.mode,this.emitProbability)}reset(){}setMatrixFromParticle(t,e){let n;if(void 0===e.rotation||this.useVelocityAsBasis)if(0!==e.velocity.x||0!==e.velocity.y||1!==e.velocity.z&&0!==e.velocity.z){this.v_.copy(Rm).cross(e.velocity),this.v2_.copy(e.velocity).cross(this.v_);const n=this.v_.length(),i=this.v2_.length();t.set(this.v_.x/n,this.v2_.x/i,e.velocity.x,e.position.x,this.v_.y/n,this.v2_.y/i,e.velocity.y,e.position.y,this.v_.z/n,this.v2_.z/i,e.velocity.z,e.position.z,0,0,0,1)}else t.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1);else e.rotation instanceof Rf?n=e.rotation:(this.q_.setFromAxisAngle(Rm,e.rotation),n=this.q_),t.compose(e.position,n,Pm);this.particleSystem.worldSpace||t.multiplyMatrices(this.particleSystem.emitter.matrixWorld,t)}}const rg=.5*(Math.sqrt(3)-1),sg=(3-Math.sqrt(3))/6,ag=1/3,og=1/6,lg=(Math.sqrt(5)-1)/4,hg=(5-Math.sqrt(5))/20,cg=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),ug=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class dg{constructor(t=Math.random){const e="function"==typeof t?t:function(t){let e=0,n=0,i=0,r=1;const s=function(){let t=4022871197;return function(e){e=e.toString();for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let i=.02519603282416938*t;t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=4294967296*i}return 2.3283064365386963e-10*(t>>>0)}}();e=s(" "),n=s(" "),i=s(" "),e-=s(t),e<0&&(e+=1);n-=s(t),n<0&&(n+=1);i-=s(t),i<0&&(i+=1);return function(){const t=2091639*e+2.3283064365386963e-10*r;return e=n,n=i,i=t-(r=0|t)}}(t);this.p=function(t){const e=new Uint8Array(256);for(let n=0;n<256;n++)e[n]=n;for(let n=0;n<255;n++){const i=n+~~(t()*(256-n)),r=e[n];e[n]=e[i],e[i]=r}return e}(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}noise2D(t,e){const n=this.permMod12,i=this.perm;let r=0,s=0,a=0;const o=(t+e)*rg,l=Math.floor(t+o),h=Math.floor(e+o),c=(l+h)*sg,u=t-(l-c),d=e-(h-c);let p,f;u>d?(p=1,f=0):(p=0,f=1);const m=u-p+sg,g=d-f+sg,v=u-1+2*sg,y=d-1+2*sg,x=255&l,b=255&h;let _=.5-u*u-d*d;if(_>=0){const t=3*n[x+i[b]];_*=_,r=_*_*(cg[t]*u+cg[t+1]*d)}let S=.5-m*m-g*g;if(S>=0){const t=3*n[x+p+i[b+f]];S*=S,s=S*S*(cg[t]*m+cg[t+1]*g)}let w=.5-v*v-y*y;if(w>=0){const t=3*n[x+1+i[b+1]];w*=w,a=w*w*(cg[t]*v+cg[t+1]*y)}return 70*(r+s+a)}noise3D(t,e,n){const i=this.permMod12,r=this.perm;let s,a,o,l;const h=(t+e+n)*ag,c=Math.floor(t+h),u=Math.floor(e+h),d=Math.floor(n+h),p=(c+u+d)*og,f=t-(c-p),m=e-(u-p),g=n-(d-p);let v,y,x,b,_,S;f>=m?m>=g?(v=1,y=0,x=0,b=1,_=1,S=0):f>=g?(v=1,y=0,x=0,b=1,_=0,S=1):(v=0,y=0,x=1,b=1,_=0,S=1):m<g?(v=0,y=0,x=1,b=0,_=1,S=1):f<g?(v=0,y=1,x=0,b=0,_=1,S=1):(v=0,y=1,x=0,b=1,_=1,S=0);const w=f-v+og,T=m-y+og,M=g-x+og,A=f-b+2*og,E=m-_+2*og,C=g-S+2*og,P=f-1+.5,R=m-1+.5,I=g-1+.5,O=255&c,D=255&u,B=255&d;let F=.6-f*f-m*m-g*g;if(F<0)s=0;else{const t=3*i[O+r[D+r[B]]];F*=F,s=F*F*(cg[t]*f+cg[t+1]*m+cg[t+2]*g)}let L=.6-w*w-T*T-M*M;if(L<0)a=0;else{const t=3*i[O+v+r[D+y+r[B+x]]];L*=L,a=L*L*(cg[t]*w+cg[t+1]*T+cg[t+2]*M)}let U=.6-A*A-E*E-C*C;if(U<0)o=0;else{const t=3*i[O+b+r[D+_+r[B+S]]];U*=U,o=U*U*(cg[t]*A+cg[t+1]*E+cg[t+2]*C)}let k=.6-P*P-R*R-I*I;if(k<0)l=0;else{const t=3*i[O+1+r[D+1+r[B+1]]];k*=k,l=k*k*(cg[t]*P+cg[t+1]*R+cg[t+2]*I)}return 32*(s+a+o+l)}noise4D(t,e,n,i){const r=this.perm;let s,a,o,l,h;const c=(t+e+n+i)*lg,u=Math.floor(t+c),d=Math.floor(e+c),p=Math.floor(n+c),f=Math.floor(i+c),m=(u+d+p+f)*hg,g=t-(u-m),v=e-(d-m),y=n-(p-m),x=i-(f-m);let b=0,_=0,S=0,w=0;g>v?b++:_++,g>y?b++:S++,g>x?b++:w++,v>y?_++:S++,v>x?_++:w++,y>x?S++:w++;const T=b>=3?1:0,M=_>=3?1:0,A=S>=3?1:0,E=w>=3?1:0,C=b>=2?1:0,P=_>=2?1:0,R=S>=2?1:0,I=w>=2?1:0,O=b>=1?1:0,D=_>=1?1:0,B=S>=1?1:0,F=w>=1?1:0,L=g-T+hg,U=v-M+hg,k=y-A+hg,N=x-E+hg,z=g-C+2*hg,G=v-P+2*hg,H=y-R+2*hg,V=x-I+2*hg,X=g-O+3*hg,W=v-D+3*hg,j=y-B+3*hg,Y=x-F+3*hg,q=g-1+4*hg,K=v-1+4*hg,J=y-1+4*hg,Z=x-1+4*hg,Q=255&u,$=255&d,tt=255&p,et=255&f;let nt=.6-g*g-v*v-y*y-x*x;if(nt<0)s=0;else{const t=r[Q+r[$+r[tt+r[et]]]]%32*4;nt*=nt,s=nt*nt*(ug[t]*g+ug[t+1]*v+ug[t+2]*y+ug[t+3]*x)}let it=.6-L*L-U*U-k*k-N*N;if(it<0)a=0;else{const t=r[Q+T+r[$+M+r[tt+A+r[et+E]]]]%32*4;it*=it,a=it*it*(ug[t]*L+ug[t+1]*U+ug[t+2]*k+ug[t+3]*N)}let rt=.6-z*z-G*G-H*H-V*V;if(rt<0)o=0;else{const t=r[Q+C+r[$+P+r[tt+R+r[et+I]]]]%32*4;rt*=rt,o=rt*rt*(ug[t]*z+ug[t+1]*G+ug[t+2]*H+ug[t+3]*V)}let st=.6-X*X-W*W-j*j-Y*Y;if(st<0)l=0;else{const t=r[Q+O+r[$+D+r[tt+B+r[et+F]]]]%32*4;st*=st,l=st*st*(ug[t]*X+ug[t+1]*W+ug[t+2]*j+ug[t+3]*Y)}let at=.6-q*q-K*K-J*J-Z*Z;if(at<0)h=0;else{const t=r[Q+1+r[$+1+r[tt+1+r[et+1]]]]%32*4;at*=at,h=at*at*(ug[t]*q+ug[t+1]*K+ug[t+2]*J+ug[t+3]*Z)}return 27*(s+a+o+l+h)}}class pg{constructor(t,e,n,i){this.scale=t,this.octaves=e,this.velocityMultiplier=n,this.timeScale=i,this.type="TurbulenceField",this.generator=new dg,this.timeOffset=new If,this.temp=new If,this.temp2=new If,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}initialize(t){}update(t,e){const n=t.position.x/this.scale.x,i=t.position.y/this.scale.y,r=t.position.z/this.scale.z;this.temp.set(0,0,0);let s=1;for(let a=0;a<this.octaves;a++)this.temp2.set(this.generator.noise4D(n*s,i*s,r*s,this.timeOffset.x*s)/s,this.generator.noise4D(n*s,i*s,r*s,this.timeOffset.y*s)/s,this.generator.noise4D(n*s,i*s,r*s,this.timeOffset.z*s)/s),this.temp.add(this.temp2),s*=2;this.temp.multiply(this.velocityMultiplier),t.velocity.addScaledVector(this.temp,e)}toJSON(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}frameUpdate(t){this.timeOffset.x+=t*this.timeScale.x,this.timeOffset.y+=t*this.timeScale.y,this.timeOffset.z+=t*this.timeScale.z}static fromJSON(t){return new pg(new If(t.scale[0],t.scale[1],t.scale[2]),t.octaves,new If(t.velocityMultiplier[0],t.velocityMultiplier[1],t.velocityMultiplier[2]),new If(t.timeScale[0],t.timeScale[1],t.timeScale[2]))}clone(){return new pg(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}reset(){}}const fg=[],mg=new If,gg=new Rf;class vg{constructor(t,e,n=new pm(1),i=new pm(0)){if(this.frequency=t,this.power=e,this.positionAmount=n,this.rotationAmount=i,this.type="Noise",this.duration=0,0===fg.length)for(let r=0;r<100;r++)fg.push(new dg)}initialize(t){t.lastPosNoise=new If,"number"==typeof t.rotation?t.lastRotNoise=0:t.lastRotNoise=new Rf,t.generatorIndex=[Am(0,100),Am(0,100),Am(0,100),Am(0,100)],this.positionAmount.startGen(t.memory),this.rotationAmount.startGen(t.memory),this.frequency.startGen(t.memory),this.power.startGen(t.memory)}update(t,e){let n=this.frequency.genValue(t.memory,t.age/t.life),i=this.power.genValue(t.memory,t.age/t.life),r=this.positionAmount.genValue(t.memory,t.age/t.life),s=this.rotationAmount.genValue(t.memory,t.age/t.life);r>0&&void 0!==t.lastPosNoise&&(t.position.sub(t.lastPosNoise),mg.set(fg[t.generatorIndex[0]].noise2D(0,t.age*n)*i*r,fg[t.generatorIndex[1]].noise2D(0,t.age*n)*i*r,fg[t.generatorIndex[2]].noise2D(0,t.age*n)*i*r),t.position.add(mg),t.lastPosNoise.copy(mg)),s>0&&void 0!==t.lastRotNoise&&("number"==typeof t.rotation?(t.rotation-=t.lastRotNoise,t.rotation+=fg[t.generatorIndex[3]].noise2D(0,t.age*n)*Math.PI*i*s):(t.lastRotNoise.invert(),t.rotation.multiply(t.lastRotNoise),gg.set(fg[t.generatorIndex[0]].noise2D(0,t.age*n)*i*s,fg[t.generatorIndex[1]].noise2D(0,t.age*n)*i*s,fg[t.generatorIndex[2]].noise2D(0,t.age*n)*i*s,fg[t.generatorIndex[3]].noise2D(0,t.age*n)*i*s).normalize(),t.rotation.multiply(gg),t.lastRotNoise.copy(gg)))}toJSON(){return{type:this.type,frequency:this.frequency.toJSON(),power:this.power.toJSON(),positionAmount:this.positionAmount.toJSON(),rotationAmount:this.rotationAmount.toJSON()}}frameUpdate(t){this.duration+=t}static fromJSON(t){return new vg(vm(t.frequency),vm(t.power),vm(t.positionAmount),vm(t.rotationAmount))}clone(){return new vg(this.frequency.clone(),this.power.clone(),this.positionAmount.clone(),this.rotationAmount.clone())}reset(){}}class yg{constructor(t,e){this.color=t,this.speedRange=e,this.type="ColorBySpeed"}initialize(t){this.color.startGen(t.memory)}update(t,e){const n=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.genColor(t.memory,t.color,n),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}frameUpdate(t){}toJSON(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(t){return new yg(dm(t.color),fm.fromJSON(t.speedRange))}clone(){return new yg(this.color.clone(),this.speedRange.clone())}reset(){}}class xg{initialize(t){this.size.startGen(t.memory)}constructor(t,e){this.size=t,this.speedRange=e,this.type="SizeBySpeed"}update(t){const e=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.size instanceof Sm?this.size.genValue(t.memory,t.size,e).multiply(t.startSize):t.size.copy(t.startSize).multiplyScalar(this.size.genValue(t.memory,e))}toJSON(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(t){return new xg(wm(t.size),fm.fromJSON(t.speedRange))}frameUpdate(t){}clone(){return new xg(this.size.clone(),this.speedRange.clone())}reset(){}}class bg{constructor(t,e){this.angularVelocity=t,this.speedRange=e,this.type="RotationBySpeed",this.tempQuat=new Rf}initialize(t){"number"==typeof t.rotation&&this.angularVelocity.startGen(t.memory)}update(t,e){if("number"==typeof t.rotation){const n=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.rotation+=e*this.angularVelocity.genValue(t.memory,n)}}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(t){return new bg(vm(t.angularVelocity),fm.fromJSON(t.speedRange))}frameUpdate(t){}clone(){return new bg(this.angularVelocity.clone(),this.speedRange.clone())}reset(){}}class _g{initialize(t){this.speed.startGen(t.memory)}constructor(t,e){this.speed=t,this.dampen=e,this.type="LimitSpeedOverLife"}update(t,e){let n=t.velocity.length(),i=this.speed.genValue(t.memory,t.age/t.life);if(n>i){const r=(n-i)/n;t.velocity.multiplyScalar(1-r*this.dampen*e*20)}}toJSON(){return{type:this.type,speed:this.speed.toJSON(),dampen:this.dampen}}static fromJSON(t){return new _g(vm(t.speed),t.dampen)}frameUpdate(t){}clone(){return new _g(this.speed.clone(),this.dampen)}reset(){}}const Sg={ApplyForce:{type:"ApplyForce",constructor:Qm,params:[["direction",["vec3"]],["magnitude",["value"]]],loadJSON:Qm.fromJSON},Noise:{type:"Noise",constructor:vg,params:[["frequency",["value"]],["power",["value"]],["positionAmount",["value"]],["rotationAmount",["value"]]],loadJSON:vg.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:pg,params:[["scale",["vec3"]],["octaves",["number"]],["velocityMultiplier",["vec3"]],["timeScale",["vec3"]]],loadJSON:pg.fromJSON},GravityForce:{type:"GravityForce",constructor:$m,params:[["center",["vec3"]],["magnitude",["number"]]],loadJSON:$m.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:km,params:[["color",["colorFunc"]]],loadJSON:km.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:Nm,params:[["angularVelocity",["value","valueFunc"]]],loadJSON:Nm.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:zm,params:[["angularVelocity",["rotationFunc"]]],loadJSON:zm.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:Hm,params:[["size",["value","valueFunc","vec3Func"]]],loadJSON:Hm.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:yg,params:[["color",["colorFunc"]],["speedRange",["range"]]],loadJSON:yg.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:bg,params:[["angularVelocity",["value","valueFunc"]],["speedRange",["range"]]],loadJSON:bg.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:xg,params:[["size",["value","valueFunc","vec3Func"]],["speedRange",["range"]]],loadJSON:xg.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:Vm,params:[["speed",["value","valueFunc"]]],loadJSON:Vm.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:Xm,params:[["frame",["value","valueFunc"]]],loadJSON:Xm.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:Gm,params:[["x",["value","valueFunc"]],["y",["value","valueFunc"]],["z",["value","valueFunc"]]],loadJSON:Gm.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:Wm,params:[["orbitSpeed",["value","valueFunc"]],["axis",["vec3"]]],loadJSON:Wm.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:Zm,params:[["width",["value","valueFunc"]]],loadJSON:Zm.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:tg,params:[["angle",["value"]]],loadJSON:tg.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:ig,params:[["particleSystem",["self"]],["useVelocityAsBasis",["boolean"]],["subParticleSystem",["particleSystem"]],["mode",["number"]],["emitProbability",["number"]]],loadJSON:ig.fromJSON},LimitSpeedOverLife:{type:"LimitSpeedOverLife",constructor:_g,params:[["speed",["value","valueFunc"]],["dampen",["number"]]],loadJSON:_g.fromJSON}};const wg=[];class Tg{get geometry(){return this._geometry}set geometry(t){if(this._geometry=t,void 0===t)return;if("string"==typeof t)return;const e=new Vi;this._triangleIndexToArea.length=0;let n=0;if(!t.getIndex())return;const i=t.getIndex().array,r=i.length/3;this._triangleIndexToArea.push(0);for(let s=0;s<r;s++)e.setFromAttributeAndIndices(t.getAttribute("position"),i[3*s],i[3*s+1],i[3*s+2]),n+=e.getArea(),this._triangleIndexToArea.push(n);t.userData.triangleIndexToArea=this._triangleIndexToArea}constructor(t){this.type="mesh_surface",this._triangleIndexToArea=[],this._tempA=new Pn,this._tempB=new Pn,this._tempC=new Pn,t&&(this.geometry=t)}initialize(t){const e=this._geometry;if(!e||null===e.getIndex())return t.position.set(0,0,0),void t.velocity.set(0,0,1).multiplyScalar(t.startSpeed);const n=this._triangleIndexToArea.length-1;let i=0,r=n;const s=Math.random()*this._triangleIndexToArea[n];for(;i+1<r;){const t=Math.floor((i+r)/2);s<this._triangleIndexToArea[t]?r=t:i=t}let a=Math.random(),o=Math.random();a+o>1&&(a=1-a,o=1-o);const l=e.getIndex().array[3*i],h=e.getIndex().array[3*i+1],c=e.getIndex().array[3*i+2],u=e.getAttribute("position");this._tempA.fromBufferAttribute(u,l),this._tempB.fromBufferAttribute(u,h),this._tempC.fromBufferAttribute(u,c),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,a).addScaledVector(this._tempC,o),t.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),t.velocity.copy(this._tempA).normalize().multiplyScalar(t.startSpeed)}toJSON(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}static fromJSON(t,e){return new Tg(e.geometries[t.geometry])}clone(){return new Tg(this._geometry)}update(t,e){}}const Mg={id:"three.quarks",initialize:()=>{},emitterShapes:[{type:"mesh_surface",params:[["geometry",["geometry"]]],constructor:Tg,loadJSON:Tg.fromJSON}],behaviors:[]};const Ag=ls;let Eg=class extends Oi{constructor(t){super(),this.type="ParticleEmitter",this.system=t}clone(){const t=this.system.clone();return t.emitter.copy(this,!0),t.emitter}dispose(){}extractFromCache(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}toJSON(t,e={}){const n=this.children;this.children=this.children.filter(t=>"ParticleSystemPreview"!==t.type);const i=super.toJSON(t);return this.children=n,null!==this.system&&(i.object.ps=this.system.toJSON(t,e)),i}};var Cg,Pg;(Pg=Cg||(Cg={}))[Pg.BillBoard=0]="BillBoard",Pg[Pg.StretchedBillBoard=1]="StretchedBillBoard",Pg[Pg.Mesh=2]="Mesh",Pg[Pg.Trail=3]="Trail",Pg[Pg.HorizontalBillBoard=4]="HorizontalBillBoard",Pg[Pg.VerticalBillBoard=5]="VerticalBillBoard";class Rg extends Fr{constructor(t){super(),this.type="VFXBatch",this.maxParticles=1e3,this.systems=new Set;const e=new gi;e.mask=t.layers.mask;const n=t.material.clone();n.defines={},Object.assign(n.defines,t.material.defines),this.settings={instancingGeometry:t.instancingGeometry,renderMode:t.renderMode,renderOrder:t.renderOrder,material:n,uTileCount:t.uTileCount,vTileCount:t.vTileCount,blendTiles:t.blendTiles,softParticles:t.softParticles,softNearFade:t.softNearFade,softFarFade:t.softFarFade,layers:e},this.frustumCulled=!1,this.renderOrder=this.settings.renderOrder}addSystem(t){this.systems.add(t)}removeSystem(t){this.systems.delete(t)}applyDepthTexture(t){const e=this.material.uniforms.depthTexture;e&&e.value!==t&&(e.value=t,this.material.needsUpdate=!0)}getVisibleSystems(){return Array.from(this.systems).filter(t=>t.emitter.visible)}}const Ig=new If(0,0,1),Og=new Rf,Dg=new If,Bg=new If;new If;const Fg=new os(1,1,1,1);class Lg{set time(t){this.emissionState.time=t}get time(){return this.emissionState.time}get layers(){return this.rendererSettings.layers}get texture(){return this.rendererSettings.material.map}set texture(t){this.rendererSettings.material.map=t,this.neededToUpdateRender=!0}get material(){return this.rendererSettings.material}set material(t){this.rendererSettings.material=t,this.neededToUpdateRender=!0}get uTileCount(){return this.rendererSettings.uTileCount}set uTileCount(t){this.rendererSettings.uTileCount=t,this.neededToUpdateRender=!0}get vTileCount(){return this.rendererSettings.vTileCount}set vTileCount(t){this.rendererSettings.vTileCount=t,this.neededToUpdateRender=!0}get blendTiles(){return this.rendererSettings.blendTiles}set blendTiles(t){this.rendererSettings.blendTiles=t,this.neededToUpdateRender=!0}get softParticles(){return this.rendererSettings.softParticles}set softParticles(t){this.rendererSettings.softParticles=t,this.neededToUpdateRender=!0}get softNearFade(){return this.rendererSettings.softNearFade}set softNearFade(t){this.rendererSettings.softNearFade=t,this.neededToUpdateRender=!0}get softFarFade(){return this.rendererSettings.softFarFade}set softFarFade(t){this.rendererSettings.softFarFade=t,this.neededToUpdateRender=!0}get instancingGeometry(){return this.rendererSettings.instancingGeometry}set instancingGeometry(t){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=t,this.neededToUpdateRender=!0}get renderMode(){return this.rendererSettings.renderMode}set renderMode(t){if(this.rendererSettings.renderMode!==t){let e=!1;switch(this.rendererSettings.renderMode===Cg.Trail&&(e=!0),this.rendererSettings.renderMode===Cg.Mesh&&(this.startRotation=new pm(0)),t){case Cg.Trail:this.rendererEmitterSettings={startLength:new pm(30),followLocalOrigin:!1},e=!0;break;case Cg.Mesh:this.rendererEmitterSettings={geometry:Fg},this.startRotation=new xm(new If(0,1,0),new pm(0));break;case Cg.StretchedBillBoard:this.rendererEmitterSettings={speedFactor:0,lengthFactor:2},this.rendererSettings.instancingGeometry=Fg;break;case Cg.BillBoard:case Cg.VerticalBillBoard:case Cg.HorizontalBillBoard:this.rendererEmitterSettings={},this.rendererSettings.instancingGeometry=Fg}this.rendererSettings.renderMode=t,e&&(this.restart(),this.particles.length=0),this.neededToUpdateRender=!0}}get renderOrder(){return this.rendererSettings.renderOrder}set renderOrder(t){this.rendererSettings.renderOrder=t,this.neededToUpdateRender=!0}get blending(){return this.rendererSettings.material.blending}set blending(t){this.rendererSettings.material.blending=t,this.neededToUpdateRender=!0}constructor(t){if(this.temp=new If,this.travelDistance=0,this.normalMatrix=new qf,this.memory=[],this.listeners={},this.firstTimeUpdate=!0,this.autoDestroy=void 0!==t.autoDestroy&&t.autoDestroy,this.duration=t.duration??1,this.looping=void 0===t.looping||t.looping,this.prewarm=void 0!==t.prewarm&&t.prewarm,this.startLife=t.startLife??new pm(5),this.startSpeed=t.startSpeed??new pm(0),this.startRotation=t.startRotation??new pm(0),this.startSize=t.startSize??new pm(1),this.startColor=t.startColor??new um(new Yf(1,1,1,1)),this.emissionOverTime=t.emissionOverTime??new pm(10),this.emissionOverDistance=t.emissionOverDistance??new pm(0),this.emissionBursts=t.emissionBursts??[],this.onlyUsedByOther=t.onlyUsedByOther??!1,this.emitterShape=t.shape??new Dm,this.behaviors=t.behaviors??new Array,this.worldSpace=t.worldSpace??!1,this.rendererEmitterSettings=t.rendererEmitterSettings??{},t.renderMode===Cg.StretchedBillBoard){const e=this.rendererEmitterSettings;void 0!==t.speedFactor&&(e.speedFactor=t.speedFactor),e.speedFactor=e.speedFactor??0,e.lengthFactor=e.lengthFactor??0}this.rendererSettings={instancingGeometry:t.instancingGeometry??Fg,renderMode:t.renderMode??Cg.BillBoard,renderOrder:t.renderOrder??0,material:t.material,uTileCount:t.uTileCount??1,vTileCount:t.vTileCount??1,blendTiles:t.blendTiles??!1,softParticles:t.softParticles??!1,softNearFade:t.softNearFade??0,softFarFade:t.softFarFade??0,layers:t.layers??new gi},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=t.startTileIndex||new pm(0),this.emitter=new Eg(this),this.paused=!1,this.particleNum=0,this.emissionState={isBursting:!1,burstParticleIndex:0,burstParticleCount:0,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,travelDistance:0},this.emissionBursts.forEach(t=>t.count.startGen(this.memory)),this.emissionOverDistance.startGen(this.memory),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}pause(){this.paused=!0}play(){this.paused=!1}stop(){this.restart(),this.pause()}spawn(t,e,n){Og.setFromRotationMatrix(n);const i=Dg,r=Og,s=Bg;n.decompose(i,r,s);for(let a=0;a<t;a++){for(e.burstParticleIndex=a,this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===Cg.Trail?this.particles.push(new Jm):this.particles.push(new qm);const t=this.particles[this.particleNum-1];if(t.reset(),t.speedModifier=1,this.startColor.startGen(t.memory),this.startColor.genColor(t.memory,t.startColor,this.emissionState.time),t.color.copy(t.startColor),this.startSpeed.startGen(t.memory),t.startSpeed=this.startSpeed.genValue(t.memory,e.time/this.duration),this.startLife.startGen(t.memory),t.life=this.startLife.genValue(t.memory,e.time/this.duration),t.age=0,this.startSize.startGen(t.memory),"vec3function"===this.startSize.type)this.startSize.genValue(t.memory,t.startSize,e.time/this.duration);else{const n=this.startSize.genValue(t.memory,e.time/this.duration);t.startSize.set(n,n,n)}if(this.startTileIndex.startGen(t.memory),t.uvTile=this.startTileIndex.genValue(t.memory),t.size.copy(t.startSize),this.rendererSettings.renderMode===Cg.Mesh||this.rendererSettings.renderMode===Cg.BillBoard||this.rendererSettings.renderMode===Cg.VerticalBillBoard||this.rendererSettings.renderMode===Cg.HorizontalBillBoard||this.rendererSettings.renderMode===Cg.StretchedBillBoard){const n=t;this.startRotation.startGen(t.memory),this.rendererSettings.renderMode===Cg.Mesh?(n.rotation instanceof Rf||(n.rotation=new Rf),"rotation"===this.startRotation.type?this.startRotation.genValue(t.memory,n.rotation,1,e.time/this.duration):n.rotation.setFromAxisAngle(Ig,this.startRotation.genValue(n.memory,e.time/this.duration))):"rotation"===this.startRotation.type?n.rotation=0:n.rotation=this.startRotation.genValue(n.memory,e.time/this.duration)}else if(this.rendererSettings.renderMode===Cg.Trail){const n=t;this.rendererEmitterSettings.startLength.startGen(n.memory),n.length=this.rendererEmitterSettings.startLength.genValue(n.memory,e.time/this.duration)}if(this.emitterShape.initialize(t,e),this.rendererSettings.renderMode===Cg.Trail&&this.rendererEmitterSettings.followLocalOrigin){const e=t;e.localPosition=(new If).copy(e.position)}this.worldSpace?(t.position.applyMatrix4(n),t.startSize.multiply(s).abs(),t.size.copy(t.startSize),t.velocity.multiply(s).applyMatrix3(this.normalMatrix),t.rotation&&t.rotation instanceof Rf&&t.rotation.multiplyQuaternions(Og,t.rotation)):this.onlyUsedByOther&&(t.parentMatrix=n);for(let e=0;e<this.behaviors.length;e++)this.behaviors[e].initialize(t,this)}}endEmit(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0),this.fire({type:"emitEnd",particleSystem:this})}dispose(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter),this.fire({type:"destroy",particleSystem:this})}restart(){this.memory.length=0,this.paused=!1,this.particleNum=0,this.emissionState.isBursting=!1,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(t=>{t.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1,this.emissionBursts.forEach(t=>t.count.startGen(this.memory)),this.emissionOverDistance.startGen(this.memory)}update(t){if(this.paused)return;let e=this.emitter;for(;e.parent;)e=e.parent;if("Scene"===e.type)if(this.firstTimeUpdate&&(this.firstTimeUpdate=!1,this.emitter.updateWorldMatrix(!0,!1)),this.emitEnded&&0===this.particleNum)this.markForDestroy&&this.emitter.parent&&this.dispose();else{if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(let t=0;t<60*this.duration;t++)this.update(1/60)}t>.1&&(t=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(t,this.emissionState,this.emitter.matrixWorld),this.emitterShape.update(this,t);for(let e=0;e<this.behaviors.length;e++){this.behaviors[e].frameUpdate(t);for(let n=0;n<this.particleNum;n++)this.particles[n].died||this.behaviors[e].update(this.particles[n],t)}for(let e=0;e<this.particleNum;e++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[e].localPosition?(this.particles[e].position.copy(this.particles[e].localPosition),this.particles[e].parentMatrix?this.particles[e].position.applyMatrix4(this.particles[e].parentMatrix):this.particles[e].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[e].position.addScaledVector(this.particles[e].velocity,t*this.particles[e].speedModifier),this.particles[e].age+=t;if(this.rendererSettings.renderMode===Cg.Trail)for(let t=0;t<this.particleNum;t++){this.particles[t].update()}for(let t=0;t<this.particleNum;t++){const e=this.particles[t];!e.died||e instanceof Jm&&0!==e.previous.length||(this.particles[t]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=e,this.particleNum--,t--,this.fire({type:"particleDied",particleSystem:this,particle:e}))}}else this.dispose()}emit(t,e,n){e.time>this.duration&&(this.looping?(e.time-=this.duration,e.burstIndex=0,this.behaviors.forEach(t=>{t.reset()})):this.emitEnded||this.onlyUsedByOther||this.endEmit()),this.normalMatrix.getNormalMatrix(n);const i=Math.ceil(e.waitEmiting);for(this.spawn(i,e,n),e.waitEmiting-=i;e.burstIndex<this.emissionBursts.length&&this.emissionBursts[e.burstIndex].time<=e.time;){if(Math.random()<this.emissionBursts[e.burstIndex].probability){const t=this.emissionBursts[e.burstIndex].count.genValue(this.memory,this.time);e.isBursting=!0,e.burstParticleCount=t,this.spawn(t,e,n),e.isBursting=!1}e.burstIndex++}if(!this.emitEnded&&(e.waitEmiting+=t*this.emissionOverTime.genValue(this.memory,e.time/this.duration),null!=e.previousWorldPos)){this.temp.set(n.elements[12],n.elements[13],n.elements[14]),e.travelDistance+=e.previousWorldPos.distanceTo(this.temp);const t=this.emissionOverDistance.genValue(this.memory,e.time/this.duration);if(e.travelDistance*t>0){const n=Math.floor(e.travelDistance*t);e.travelDistance-=n/t,e.waitEmiting+=n}}void 0===e.previousWorldPos&&(e.previousWorldPos=new If),e.previousWorldPos.set(n.elements[12],n.elements[13],n.elements[14]),e.time+=t}toJSON(t,e={}){var n;if((void 0===t||"string"==typeof t)&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),t.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(t),e.useUrlForImage&&void 0!==(null==(n=this.texture)?void 0:n.source)){const e=this.texture.source;t.images[e.uuid]={uuid:e.uuid,url:this.texture.image.url}}let i;i=this.renderMode===Cg.Trail?{startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===Cg.Mesh?{}:this.renderMode===Cg.StretchedBillBoard?{speedFactor:this.rendererEmitterSettings.speedFactor,lengthFactor:this.rendererEmitterSettings.lengthFactor}:{};const r=this.rendererSettings.instancingGeometry;return t.geometries&&!t.geometries[r.uuid]&&(t.geometries[r.uuid]=r.toJSON()),{version:"3.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts.map(t=>({time:t.time,count:t.count.toJSON(),probability:t.probability,interval:t.interval,cycle:t.cycle})),onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:i,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.rendererSettings.softParticles,softFarFade:this.rendererSettings.softFarFade,softNearFade:this.rendererSettings.softNearFade,behaviors:this.behaviors.map(t=>t.toJSON()),worldSpace:this.worldSpace}}static fromJSON(t,e,n){var i;const r=function(t,e){return Um[t.type].loadJSON(t,e)}(t.shape,e);let s;if(t.renderMode===Cg.Trail){const e=t.rendererEmitterSettings;s={startLength:null!=e.startLength?vm(e.startLength):new pm(30),followLocalOrigin:e.followLocalOrigin}}else t.renderMode===Cg.Mesh?s={}:t.renderMode===Cg.StretchedBillBoard?(s=t.rendererEmitterSettings,null!=t.speedFactor&&(s.speedFactor=t.speedFactor)):s={};const a=new gi;t.layers&&(a.mask=t.layers);const o=new Lg({autoDestroy:t.autoDestroy,looping:t.looping,prewarm:t.prewarm,duration:t.duration,shape:r,startLife:vm(t.startLife),startSpeed:vm(t.startSpeed),startRotation:wm(t.startRotation),startSize:wm(t.startSize),startColor:dm(t.startColor),emissionOverTime:vm(t.emissionOverTime),emissionOverDistance:vm(t.emissionOverDistance),emissionBursts:null==(i=t.emissionBursts)?void 0:i.map(t=>({time:t.time,count:"number"==typeof t.count?new pm(t.count):vm(t.count),probability:t.probability??1,interval:t.interval??.1,cycle:t.cycle??1})),onlyUsedByOther:t.onlyUsedByOther,instancingGeometry:e.geometries[t.instancingGeometry],renderMode:t.renderMode,rendererEmitterSettings:s,renderOrder:t.renderOrder,layers:a,material:t.material?e.materials[t.material]:t.texture?new Qi({map:e.textures[t.texture],transparent:t.transparent??!0,blending:t.blending,side:2}):new Qi({color:16777215,transparent:!0,blending:2,side:2}),startTileIndex:"number"==typeof t.startTileIndex?new pm(t.startTileIndex):vm(t.startTileIndex),uTileCount:t.uTileCount,vTileCount:t.vTileCount,blendTiles:t.blendTiles,softParticles:t.softParticles,softFarFade:t.softFarFade,softNearFade:t.softNearFade,behaviors:[],worldSpace:t.worldSpace});return o.behaviors=t.behaviors.map(t=>{const e=function(t,e){return Sg[t.type]?Sg[t.type].loadJSON(t,e):null}(t,o);return e&&"EmitSubParticleSystem"===e.type&&(n[t.subParticleSystem]=e),e}).filter(t=>null!==t),o}addBehavior(t){this.behaviors.push(t)}getRendererSettings(){return this.rendererSettings}addEventListener(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}removeAllEventListeners(t){this.listeners[t]&&(this.listeners[t]=[])}removeEventListener(t,e){if(this.listeners[t]){const n=this.listeners[t].indexOf(e);-1!==n&&this.listeners[t].splice(n,1)}}fire(t){this.listeners[t.type]&&this.listeners[t.type].forEach(e=>e(t))}clone(){const t=[];for(const r of this.emissionBursts){const e={};Object.assign(e,r),t.push(e)}const e=[];for(const r of this.behaviors)e.push(r.clone());let n;n=this.renderMode===Cg.Trail?{startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===Cg.StretchedBillBoard?{lengthFactor:this.rendererEmitterSettings.lengthFactor,speedFactor:this.rendererEmitterSettings.speedFactor}:{};const i=new gi;return i.mask=this.layers.mask,new Lg({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:t,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:n,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.softParticles,softFarFade:this.softFarFade,softNearFade:this.softNearFade,behaviors:e,worldSpace:this.worldSpace,layers:i})}}var Ug="\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <alphatest_pars_fragment>\n\n#include <tile_pars_fragment>\n#include <soft_pars_fragment>\n\nvoid main() {\n\n    #include <clipping_planes_fragment>\n    \n    vec3 outgoingLight = vec3( 0.0 );\n    vec4 diffuseColor = vColor;\n    \n    #include <logdepthbuf_fragment>\n    \n    #include <tile_fragment>\n    #include <alphatest_fragment>\n\n    outgoingLight = diffuseColor.rgb;\n    \n    #ifdef USE_COLOR_AS_ALPHA\n    gl_FragColor = vec4( outgoingLight, diffuseColor.r );\n    #else\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    #endif\n    \n    #include <soft_fragment>\n    #include <tonemapping_fragment>\n}\n",kg="\n#define STANDARD\n\n#ifdef PHYSICAL\n#define IOR\n#define USE_SPECULAR\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef IOR\nuniform float ior;\n#endif\n\n#ifdef USE_SPECULAR\nuniform float specularIntensity;\nuniform vec3 specularColor;\n\n#ifdef USE_SPECULAR_COLORMAP\nuniform sampler2D specularColorMap;\n#endif\n\n#ifdef USE_SPECULAR_INTENSITYMAP\nuniform sampler2D specularIntensityMap;\n#endif\n#endif\n\n#ifdef USE_CLEARCOAT\nuniform float clearcoat;\nuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_DISPERSION\nuniform float dispersion;\n#endif\n\n#ifdef USE_IRIDESCENCE\nuniform float iridescence;\nuniform float iridescenceIOR;\nuniform float iridescenceThicknessMinimum;\nuniform float iridescenceThicknessMaximum;\n#endif\n\n#ifdef USE_SHEEN\nuniform vec3 sheenColor;\nuniform float sheenRoughness;\n\n#ifdef USE_SHEEN_COLORMAP\nuniform sampler2D sheenColorMap;\n#endif\n\n#ifdef USE_SHEEN_ROUGHNESSMAP\nuniform sampler2D sheenRoughnessMap;\n#endif\n#endif\n\n#ifdef USE_ANISOTROPY\nuniform vec2 anisotropyVector;\n\n#ifdef USE_ANISOTROPYMAP\nuniform sampler2D anisotropyMap;\n#endif\n#endif\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\nvec4 diffuseColor = vec4( diffuse, opacity );\n#include <clipping_planes_fragment>\n\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveRadiance = emissive;\n\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <alphahash_fragment>\n#include <roughnessmap_fragment>\n#include <metalnessmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <clearcoat_normal_fragment_begin>\n#include <clearcoat_normal_fragment_maps>\n#include <emissivemap_fragment>\n\n// accumulation\n#include <lights_physical_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n\n// modulation\n#include <aomap_fragment>\n\nvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\nvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\n#include <transmission_fragment>\n\nvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\n#ifdef USE_SHEEN\n\n// Sheen energy compensation approximation calculation can be found at the end of\n// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\nfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\noutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\n#endif\n\n#ifdef USE_CLEARCOAT\n\nfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\nvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\noutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\n#endif\n\n#include <opaque_fragment>\n#include <tonemapping_fragment>\n#include <colorspace_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n}",Ng="\n#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n\nattribute vec3 offset;\nattribute vec4 rotation;\nattribute vec3 size;\n#include <tile_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    #include <tile_vertex>\n    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;\n    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;\n    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;\n    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;\n    float sx = size.x, sy = size.y, sz = size.z;\n\n    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column\n                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column\n                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column\n                      offset.x, offset.y, offset.z, 1.0);\n\n#include <color_vertex>\n#include <morphinstance_vertex>\n#include <morphcolor_vertex>\n#include <batching_vertex>\n\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n\n\t// replace defaultnormal_vertex\n\tvec3 transformedNormal = objectNormal;\n    mat3 m = mat3( particleMatrix );\n    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n    transformedNormal = m * transformedNormal;\n    transformedNormal = normalMatrix * transformedNormal;\n    #ifdef FLIP_SIDED\n        transformedNormal = - transformedNormal;\n    #endif\n    #ifdef USE_TANGENT\n        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n        #ifdef FLIP_SIDED\n        transformedTangent = - transformedTangent;\n        #endif\n    #endif\n\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\n\t// replace include <project_vertex>\n  vec4 mvPosition = vec4( transformed, 1.0 );\n  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t\n\tvViewPosition = - mvPosition.xyz;\n\t\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n    vWorldPosition = worldPosition.xyz;\n#endif\n}\n";function zg(t){return 0===t?"uv":`uv${t}`}class Gg extends nu{constructor(t){super(t)}onBeforeCompile(t,e){super.onBeforeCompile(t,e),t.vertexShader=Ng,t.fragmentShader=kg}}class Hg extends iu{constructor(t){super(t)}onBeforeCompile(t,e){super.onBeforeCompile(t,e),t.vertexShader=Ng,t.fragmentShader=kg}}class Vg extends Rg{constructor(t){super(t),this.vector_=new If,this.vector2_=new If,this.vector3_=new If,this.quaternion_=new Rf,this.quaternion2_=new Rf,this.quaternion3_=new Rf,this.rotationMat_=new qf,this.rotationMat2_=new qf,this.maxParticles=1e3,this.setupBuffers(),this.rebuildMaterial()}buildExpandableBuffers(){this.offsetBuffer=new Dl(new Float32Array(3*this.maxParticles),3),this.offsetBuffer.setUsage(Le),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new Dl(new Float32Array(4*this.maxParticles),4),this.colorBuffer.setUsage(Le),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===Cg.Mesh?(this.rotationBuffer=new Dl(new Float32Array(4*this.maxParticles),4),this.rotationBuffer.setUsage(Le),this.geometry.setAttribute("rotation",this.rotationBuffer)):this.settings.renderMode!==Cg.BillBoard&&this.settings.renderMode!==Cg.HorizontalBillBoard&&this.settings.renderMode!==Cg.VerticalBillBoard&&this.settings.renderMode!==Cg.StretchedBillBoard||(this.rotationBuffer=new Dl(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Le),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new Dl(new Float32Array(3*this.maxParticles),3),this.sizeBuffer.setUsage(Le),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new Dl(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Le),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===Cg.StretchedBillBoard&&(this.velocityBuffer=new Dl(new Float32Array(4*this.maxParticles),4),this.velocityBuffer.setUsage(Le),this.geometry.setAttribute("velocity",this.velocityBuffer))}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new ld,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.settings.instancingGeometry.hasAttribute("uv")&&this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}expandBuffers(t){for(;t>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const t={},e={};"MeshStandardMaterial"!==this.settings.material.type&&"MeshPhysicalMaterial"!==this.settings.material.type&&(t.map=new Hd(this.settings.material.map)),this.settings.material.alphaTest&&(e.USE_ALPHATEST="",t.alphaTest=new Hd(this.settings.material.alphaTest)),e.USE_UV="";const n=this.settings.uTileCount,i=this.settings.vTileCount;let r;if((n>1||i>1)&&(e.UV_TILE="",t.tileCount=new Hd(new jf(n,i))),this.settings.material.defines&&void 0!==this.settings.material.defines.USE_COLOR_AS_ALPHA&&(e.USE_COLOR_AS_ALPHA=""),this.settings.material.normalMap&&(e.USE_NORMALMAP="",e.NORMALMAP_UV=zg(this.settings.material.normalMap.channel),t.normalMapTransform=new Hd((new qf).copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(e.USE_MAP="",this.settings.blendTiles&&(e.TILE_BLEND=""),e.MAP_UV=zg(this.settings.material.map.channel),t.mapTransform=new Hd((new qf).copy(this.settings.material.map.matrix))),e.USE_COLOR_ALPHA="",this.settings.softParticles){e.SOFT_PARTICLES="";const n=this.settings.softNearFade,i=1/(this.settings.softFarFade-this.settings.softNearFade);t.softParams=new Hd(new jf(n,i)),t.depthTexture=new Hd(null);const s=t.projParams=new Hd(new Yf);r=(t,e,n)=>{s.value.set(n.near,n.far,0,0)}}let s=!1;if(this.settings.renderMode===Cg.BillBoard||this.settings.renderMode===Cg.VerticalBillBoard||this.settings.renderMode===Cg.HorizontalBillBoard||this.settings.renderMode===Cg.Mesh){let n,i;this.settings.renderMode===Cg.Mesh?"MeshStandardMaterial"===this.settings.material.type||"MeshPhysicalMaterial"===this.settings.material.type?(e.USE_COLOR="",n=Ng,i=kg,s=!0):(n="\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <tile_pars_vertex>\n#include <soft_pars_vertex>\n\nattribute vec3 offset;\nattribute vec4 rotation;\nattribute vec3 size;\n// attribute vec4 color;\n\nvoid main() {\n\n    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;\n    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;\n    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;\n    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;\n    float sx = size.x, sy = size.y, sz = size.z;\n    \n    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column\n                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column\n                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column\n                      offset.x, offset.y, offset.z, 1.0);\n    \n    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));\n\n\tvColor = color;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n    #include <tile_vertex>\n    #include <soft_vertex>\n}\n",i=Ug):(n="\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#include <tile_pars_vertex>\n#include <soft_pars_vertex>\n\nattribute vec3 offset;\nattribute float rotation;\nattribute vec3 size;\n\nvoid main() {\n\t\n    vec2 alignedPosition = position.xy * size.xy;\n    \n    vec2 rotatedPosition;\n    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n#ifdef HORIZONTAL\n    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );\n    mvPosition.x += rotatedPosition.x;\n    mvPosition.z -= rotatedPosition.y;\n    mvPosition = viewMatrix * mvPosition;\n#elif defined(VERTICAL)\n    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );\n    mvPosition.y += rotatedPosition.y;\n    mvPosition = viewMatrix * mvPosition;\n    mvPosition.x += rotatedPosition.x;\n#else\n    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );\n    mvPosition.xy += rotatedPosition;\n#endif\n\n\tvColor = color;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\n\t#include <clipping_planes_vertex>\n\n\t#include <tile_vertex>\n\t#include <soft_vertex>\n}\n",i=Ug),this.settings.renderMode===Cg.VerticalBillBoard?e.VERTICAL="":this.settings.renderMode===Cg.HorizontalBillBoard&&(e.HORIZONTAL="");let r=!1;this.settings.renderMode===Cg.Mesh&&("MeshStandardMaterial"===this.settings.material.type?(this.material=new Gg({}),this.material.copy(this.settings.material),this.material.uniforms=t,this.material.defines=e,r=!0):"MeshPhysicalMaterial"===this.settings.material.type&&(this.material=new Hg({}),this.material.copy(this.settings.material),this.material.uniforms=t,this.material.defines=e,r=!0)),r||(this.material=new Hr({uniforms:t,defines:e,vertexShader:n,fragmentShader:i,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,depthTest:this.settings.material.depthTest,lights:s}))}else{if(this.settings.renderMode!==Cg.StretchedBillBoard)throw new Error("render mode unavailable");t.speedFactor=new Hd(1),this.material=new Hr({uniforms:t,defines:e,vertexShader:"\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#include <tile_pars_vertex>\n#include <soft_pars_vertex>\n\nattribute vec3 offset;\nattribute float rotation;\nattribute vec3 size;\nattribute vec4 velocity;\n\nuniform float speedFactor;\n\nvoid main() {\n    float lengthFactor = velocity.w;\n    float avgSize = (size.x + size.y) * 0.5;\n#ifdef USE_SKEW\n    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );\n    vec3 viewVelocity = normalMatrix * velocity.xyz;\n\n    vec3 scaledPos = vec3(position.xy * size.xy, position.z);\n    float vlength = length(viewVelocity);\n    vec3 projVelocity =  dot(scaledPos, viewVelocity) * viewVelocity / vlength;\n    mvPosition.xyz += scaledPos + projVelocity * (speedFactor / avgSize + lengthFactor / vlength);\n#else\n    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );\n    vec3 viewVelocity = normalMatrix * velocity.xyz;\n    float vlength = length(viewVelocity); \n    mvPosition.xyz += position.y * normalize(cross(mvPosition.xyz, viewVelocity)) * avgSize; // switch the cross to  match unity implementation\n    mvPosition.xyz -= (position.x + 0.5) * viewVelocity * (1.0 + lengthFactor / vlength) * avgSize; // minus position.x to match unity implementation\n#endif\n\tvColor = color;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <tile_vertex>\n\t#include <soft_vertex>\n}\n",fragmentShader:Ug,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,depthTest:this.settings.material.depthTest})}this.material&&r&&(this.material.onBeforeRender=r)}update(){let t=0,e=0;const n=this.getVisibleSystems();for(const i of n)e+=i.particleNum;e>this.maxParticles&&this.expandBuffers(e);for(const i of n){i.emitter.updateMatrixWorld&&(i.emitter.updateWorldMatrix(!0,!1),i.emitter.updateMatrixWorld(!0));const e=i.particles,n=i.particleNum,r=this.quaternion2_,s=this.vector2_,a=this.vector3_;i.emitter.matrixWorld.decompose(s,r,a),this.rotationMat_.setFromMatrix4(i.emitter.matrixWorld);for(let o=0;o<n;o++,t++){const n=e[o];if(this.settings.renderMode===Cg.Mesh){let e;if(i.worldSpace)e=n.rotation;else{let t;t=n.parentMatrix?this.quaternion3_.setFromRotationMatrix(n.parentMatrix):r,e=this.quaternion_,e.copy(t).multiply(n.rotation)}this.rotationBuffer.setXYZW(t,e.x,e.y,e.z,e.w)}else this.settings.renderMode!==Cg.StretchedBillBoard&&this.settings.renderMode!==Cg.VerticalBillBoard&&this.settings.renderMode!==Cg.HorizontalBillBoard&&this.settings.renderMode!==Cg.BillBoard||this.rotationBuffer.setX(t,n.rotation);let s;if(i.worldSpace?s=n.position:(s=this.vector_,n.parentMatrix?s.copy(n.position).applyMatrix4(n.parentMatrix):s.copy(n.position).applyMatrix4(i.emitter.matrixWorld)),this.offsetBuffer.setXYZ(t,s.x,s.y,s.z),this.colorBuffer.setXYZW(t,n.color.x,n.color.y,n.color.z,n.color.w),i.worldSpace||n.parentMatrix?this.sizeBuffer.setXYZ(t,n.size.x,n.size.y,n.size.z):this.sizeBuffer.setXYZ(t,n.size.x*Math.abs(a.x),n.size.y*Math.abs(a.y),n.size.z*Math.abs(a.z)),this.uvTileBuffer.setX(t,n.uvTile),this.settings.renderMode===Cg.StretchedBillBoard&&this.velocityBuffer){let e=i.rendererEmitterSettings.speedFactor;0===e&&(e=.001);const r=i.rendererEmitterSettings.lengthFactor;let s;i.worldSpace?s=n.velocity:(s=this.vector_,n.parentMatrix?(this.rotationMat2_.setFromMatrix4(n.parentMatrix),s.copy(n.velocity).applyMatrix3(this.rotationMat2_)):s.copy(n.velocity).applyMatrix3(this.rotationMat_)),this.velocityBuffer.setXYZW(t,s.x*e,s.y*e,s.z*e,r)}}}this.geometry.instanceCount=t,t>0&&(this.offsetBuffer.clearUpdateRanges(),this.offsetBuffer.addUpdateRange(0,3*t),this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.clearUpdateRanges(),this.sizeBuffer.addUpdateRange(0,3*t),this.sizeBuffer.needsUpdate=!0,this.colorBuffer.clearUpdateRanges(),this.colorBuffer.addUpdateRange(0,4*t),this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.clearUpdateRanges(),this.uvTileBuffer.addUpdateRange(0,t),this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===Cg.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.clearUpdateRanges(),this.velocityBuffer.addUpdateRange(0,4*t),this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===Cg.Mesh?(this.rotationBuffer.clearUpdateRanges(),this.rotationBuffer.addUpdateRange(0,4*t),this.rotationBuffer.needsUpdate=!0):this.settings.renderMode!==Cg.StretchedBillBoard&&this.settings.renderMode!==Cg.HorizontalBillBoard&&this.settings.renderMode!==Cg.VerticalBillBoard&&this.settings.renderMode!==Cg.BillBoard||(this.rotationBuffer.clearUpdateRanges(),this.rotationBuffer.addUpdateRange(0,t),this.rotationBuffer.needsUpdate=!0))}dispose(){this.geometry.dispose()}}class Xg extends Rg{constructor(t){super(t),this.vector_=new If,this.vector2_=new If,this.vector3_=new If,this.quaternion_=new Rf,this.maxParticles=1e4,this.setupBuffers(),this.rebuildMaterial()}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new vr,this.indexBuffer=new ar(new Uint32Array(6*this.maxParticles),1),this.indexBuffer.setUsage(Le),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new ar(new Float32Array(6*this.maxParticles),3),this.positionBuffer.setUsage(Le),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new ar(new Float32Array(6*this.maxParticles),3),this.previousBuffer.setUsage(Le),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new ar(new Float32Array(6*this.maxParticles),3),this.nextBuffer.setUsage(Le),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new ar(new Float32Array(2*this.maxParticles),1),this.widthBuffer.setUsage(Le),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new ar(new Float32Array(2*this.maxParticles),1),this.sideBuffer.setUsage(Le),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new ar(new Float32Array(4*this.maxParticles),2),this.uvBuffer.setUsage(Le),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new ar(new Float32Array(8*this.maxParticles),4),this.colorBuffer.setUsage(Le),this.geometry.setAttribute("color",this.colorBuffer)}expandBuffers(t){for(;t>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const t={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new jf(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0}},e={USE_UV:"",USE_COLOR_ALPHA:""};if(this.settings.material.map&&(e.USE_MAP="",e.MAP_UV=zg(this.settings.material.map.channel),t.map=new Hd(this.settings.material.map),t.mapTransform=new Hd((new qf).copy(this.settings.material.map.matrix))),this.settings.material.defines&&void 0!==this.settings.material.defines.USE_COLOR_AS_ALPHA&&(e.USE_COLOR_AS_ALPHA=""),this.settings.renderMode!==Cg.Trail)throw new Error("render mode unavailable");this.material=new Hr({uniforms:t,defines:e,vertexShader:"\n#include <common>\n#include <tile_pars_vertex>\n#include <color_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\n\nattribute vec3 previous;\nattribute vec3 next;\nattribute float side;\nattribute float width;\n\nuniform vec2 resolution;\nuniform float lineWidth;\nuniform float sizeAttenuation;\n    \nvec2 fix(vec4 i, float aspect) {\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n    return res;\n}\n    \nvoid main() {\n\n    #include <tile_vertex>\n    \n    float aspect = resolution.x / resolution.y;\n\n    vColor = color;\n\n    mat4 m = projectionMatrix * modelViewMatrix;\n    vec4 finalPosition = m * vec4( position, 1.0 );\n    vec4 prevPos = m * vec4( previous, 1.0 );\n    vec4 nextPos = m * vec4( next, 1.0 );\n\n    vec2 currentP = fix( finalPosition, aspect );\n    vec2 prevP = fix( prevPos, aspect );\n    vec2 nextP = fix( nextPos, aspect );\n\n    float w = lineWidth * width;\n\n    vec2 dir;\n    if( nextP == currentP ) dir = normalize( currentP - prevP );\n    else if( prevP == currentP ) dir = normalize( nextP - currentP );\n    else {\n        vec2 dir1 = normalize( currentP - prevP );\n        vec2 dir2 = normalize( nextP - currentP );\n        dir = normalize( dir1 + dir2 );\n\n        vec2 perp = vec2( -dir1.y, dir1.x );\n        vec2 miter = vec2( -dir.y, dir.x );\n        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );\n\n    }\n\n    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;\n    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );\n    normal.xy *= .5 * w;\n    normal *= projectionMatrix;\n    if( sizeAttenuation == 0. ) {\n        normal.xy *= finalPosition.w;\n        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;\n    }\n\n    finalPosition.xy += normal.xy * side;\n\n    gl_Position = finalPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    \n\t#include <fog_vertex>\n}",fragmentShader:"\n\n#include <common>\n#include <tile_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform sampler2D alphaMap;\nuniform float useAlphaMap;\nuniform float visibility;\nuniform float alphaTest;\n\nvarying vec4 vColor;\n    \nvoid main() {\n    #include <clipping_planes_fragment>\n    #include <logdepthbuf_fragment>\n\n    vec4 diffuseColor = vColor;\n    \n    #ifdef USE_MAP\n    #include <tile_fragment>\n    #ifndef USE_COLOR_AS_ALPHA\n    #endif\n    #endif\n    if( useAlphaMap == 1. ) diffuseColor.a *= texture2D( alphaMap, vUv).a;\n    if( diffuseColor.a < alphaTest ) discard;\n    gl_FragColor = diffuseColor;\n\n    #include <fog_fragment>\n    #include <tonemapping_fragment>\n}",transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||2,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha})}update(){let t=0,e=0,n=0;const i=this.getVisibleSystems();for(const r of i)for(let t=0;t<r.particleNum;t++)n+=2*r.particles[t].previous.length;n>this.maxParticles&&this.expandBuffers(n);for(const r of i){r.emitter.updateMatrixWorld&&(r.emitter.updateWorldMatrix(!0,!1),r.emitter.updateMatrixWorld(!0));const n=this.quaternion_,i=this.vector2_,s=this.vector3_;r.emitter.matrixWorld.decompose(i,n,s);const a=r.particles,o=r.particleNum,l=this.settings.uTileCount,h=this.settings.vTileCount,c=1/l,u=1/h;for(let d=0;d<o;d++){const n=a[d],i=n.uvTile%h,o=Math.floor(n.uvTile/h+.001),l=n.previous.values();let p,f=l.next(),m=f.value,g=m;f.done||(f=l.next()),p=void 0!==f.value?f.value:g;for(let a=0;a<n.previous.length;a++,t+=2){if(this.positionBuffer.setXYZ(t,g.position.x,g.position.y,g.position.z),this.positionBuffer.setXYZ(t+1,g.position.x,g.position.y,g.position.z),r.worldSpace?(this.positionBuffer.setXYZ(t,g.position.x,g.position.y,g.position.z),this.positionBuffer.setXYZ(t+1,g.position.x,g.position.y,g.position.z)):(n.parentMatrix?this.vector_.copy(g.position).applyMatrix4(n.parentMatrix):this.vector_.copy(g.position).applyMatrix4(r.emitter.matrixWorld),this.positionBuffer.setXYZ(t,this.vector_.x,this.vector_.y,this.vector_.z),this.positionBuffer.setXYZ(t+1,this.vector_.x,this.vector_.y,this.vector_.z)),r.worldSpace?(this.previousBuffer.setXYZ(t,m.position.x,m.position.y,m.position.z),this.previousBuffer.setXYZ(t+1,m.position.x,m.position.y,m.position.z)):(n.parentMatrix?this.vector_.copy(m.position).applyMatrix4(n.parentMatrix):this.vector_.copy(m.position).applyMatrix4(r.emitter.matrixWorld),this.previousBuffer.setXYZ(t,this.vector_.x,this.vector_.y,this.vector_.z),this.previousBuffer.setXYZ(t+1,this.vector_.x,this.vector_.y,this.vector_.z)),r.worldSpace?(this.nextBuffer.setXYZ(t,p.position.x,p.position.y,p.position.z),this.nextBuffer.setXYZ(t+1,p.position.x,p.position.y,p.position.z)):(n.parentMatrix?this.vector_.copy(p.position).applyMatrix4(n.parentMatrix):this.vector_.copy(p.position).applyMatrix4(r.emitter.matrixWorld),this.nextBuffer.setXYZ(t,this.vector_.x,this.vector_.y,this.vector_.z),this.nextBuffer.setXYZ(t+1,this.vector_.x,this.vector_.y,this.vector_.z)),this.sideBuffer.setX(t,1),this.sideBuffer.setX(t+1,-1),r.worldSpace)this.widthBuffer.setX(t,g.size),this.widthBuffer.setX(t+1,g.size);else if(n.parentMatrix)this.widthBuffer.setX(t,g.size),this.widthBuffer.setX(t+1,g.size);else{const e=(Math.abs(s.x)+Math.abs(s.y)+Math.abs(s.z))/3;this.widthBuffer.setX(t,g.size*e),this.widthBuffer.setX(t+1,g.size*e)}this.uvBuffer.setXY(t,(a/n.previous.length+i)*c,(h-o-1)*u),this.uvBuffer.setXY(t+1,(a/n.previous.length+i)*c,(h-o)*u),this.colorBuffer.setXYZW(t,g.color.x,g.color.y,g.color.z,g.color.w),this.colorBuffer.setXYZW(t+1,g.color.x,g.color.y,g.color.z,g.color.w),a+1<n.previous.length&&(this.indexBuffer.setX(3*e,t),this.indexBuffer.setX(3*e+1,t+1),this.indexBuffer.setX(3*e+2,t+2),e++,this.indexBuffer.setX(3*e,t+2),this.indexBuffer.setX(3*e+1,t+1),this.indexBuffer.setX(3*e+2,t+3),e++),m=g,g=p,f.done||(f=l.next(),void 0!==f.value&&(p=f.value))}}}this.positionBuffer.clearUpdateRanges(),this.positionBuffer.addUpdateRange(0,3*t),this.positionBuffer.needsUpdate=!0,this.previousBuffer.clearUpdateRanges(),this.previousBuffer.addUpdateRange(0,3*t),this.previousBuffer.needsUpdate=!0,this.nextBuffer.clearUpdateRanges(),this.nextBuffer.addUpdateRange(0,3*t),this.nextBuffer.needsUpdate=!0,this.sideBuffer.clearUpdateRanges(),this.sideBuffer.addUpdateRange(0,t),this.sideBuffer.needsUpdate=!0,this.widthBuffer.clearUpdateRanges(),this.widthBuffer.addUpdateRange(0,t),this.widthBuffer.needsUpdate=!0,this.uvBuffer.clearUpdateRanges(),this.uvBuffer.addUpdateRange(0,2*t),this.uvBuffer.needsUpdate=!0,this.colorBuffer.clearUpdateRanges(),this.colorBuffer.addUpdateRange(0,4*t),this.colorBuffer.needsUpdate=!0,this.indexBuffer.clearUpdateRanges(),this.indexBuffer.addUpdateRange(0,3*e),this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,3*e)}dispose(){this.geometry.dispose()}}class Wg extends Oi{constructor(){super(),this.batches=[],this.systemToBatchIndex=new Map,this.type="BatchedRenderer",this.depthTexture=null}static equals(t,e){return t.material.side===e.material.side&&t.material.blending===e.material.blending&&t.material.blendSrc===e.material.blendSrc&&t.material.blendDst===e.material.blendDst&&t.material.blendEquation===e.material.blendEquation&&t.material.premultipliedAlpha===e.material.premultipliedAlpha&&t.material.transparent===e.material.transparent&&t.material.depthTest===e.material.depthTest&&t.material.type===e.material.type&&t.material.alphaTest===e.material.alphaTest&&t.material.map===e.material.map&&t.renderMode===e.renderMode&&t.blendTiles===e.blendTiles&&t.softParticles===e.softParticles&&t.softFarFade===e.softFarFade&&t.softNearFade===e.softNearFade&&t.uTileCount===e.uTileCount&&t.vTileCount===e.vTileCount&&t.instancingGeometry===e.instancingGeometry&&t.renderOrder===e.renderOrder&&t.layers.mask===e.layers.mask}addSystem(t){t._renderer=this;const e=t.getRendererSettings();for(let i=0;i<this.batches.length;i++)if(Wg.equals(this.batches[i].settings,e))return this.batches[i].addSystem(t),void this.systemToBatchIndex.set(t,i);let n;switch(e.renderMode){case Cg.Trail:n=new Xg(e);break;case Cg.Mesh:case Cg.BillBoard:case Cg.VerticalBillBoard:case Cg.HorizontalBillBoard:case Cg.StretchedBillBoard:n=new Vg(e)}this.depthTexture&&n.applyDepthTexture(this.depthTexture),n.addSystem(t),this.batches.push(n),this.systemToBatchIndex.set(t,this.batches.length-1),this.add(n)}deleteSystem(t){const e=this.systemToBatchIndex.get(t);null!=e&&(this.batches[e].removeSystem(t),this.systemToBatchIndex.delete(t))}setDepthTexture(t){this.depthTexture=t;for(const e of this.batches)e.applyDepthTexture(t)}updateSystem(t){this.deleteSystem(t),this.addSystem(t)}update(t){this.systemToBatchIndex.forEach((e,n)=>{n.update(t)});for(let e=0;e<this.batches.length;e++)this.batches[e].update()}}class jg extends Uo{constructor(){super(),this.type="QuarksPrefab",this.animationData=[],this.isPlaying=!1,this.currentTime=-1e-5,this.timeScale=1,this.duration=0,this._mixers=new Map,this._tempAnimationJSON=[],this._clock=new bd(!0)}registerBatchedRenderer(t){this._batchedRenderer=t}getOrCreateMixer(t){if(!this._mixers.has(t)){const e=new Gd(t);this._mixers.set(t,e)}return this._mixers.get(t)}addThreeAnimation(t,e,n=0,i=e.duration,r=!1){const s=this.getOrCreateMixer(t),a=s.clipAction(e);r||(a.setLoop(se,1),a.clampWhenFinished=!0);const o={startTime:n,duration:i,type:"three",loop:r,target:t,clip:e,mixer:s,action:a};return this.animationData.push(o),this.updateDuration(),o}addParticleSystemAnimation(t,e=0,n=0,i=!1){n<=0&&(n=t.system.duration);const r={startTime:e,duration:n,type:"ps",loop:i,target:t};return this.animationData.push(r),this.pause(),this.updateDuration(),r}removeAnimation(t){this.animationData.splice(t,1),this.updateDuration()}play(){this.isPlaying||(this.isPlaying=!0)}pause(){this.isPlaying&&(this.isPlaying=!1,this.animationData.forEach(t=>{t.target&&("ps"!==t.type||t.target.system.paused?"three"===t.type&&t.action&&t.action.isRunning()&&(t.action.paused=!0):t.target.system.pause())}))}stop(){this.pause(),this.currentTime=-1e-5,this.animationData.forEach(t=>{"ps"===t.type&&t.target?t.target.system.stop():"three"===t.type&&t.mixer&&t.action&&t.action.reset()})}update(t){if(!this.isPlaying)return;const e=void 0!==t?t:this._clock.getDelta();this.currentTime+=e*this.timeScale,this.currentTime>this.duration&&this.stop();const n=new Set;this.animationData.forEach(t=>{const{startTime:i,duration:r,type:s,loop:a,target:o,action:l,mixer:h}=t,c=i+r,u=this.currentTime>=i,d=this.currentTime>c,p=Math.abs(this.currentTime-i)<e;"three"===s&&l&&h?u&&!d?(p?(l.reset(),l.play()):l.paused&&(l.paused=!1,l.play()),this.currentTime,n.add(h)):d&&(l.paused=!0):"ps"===s&&o&&(u&&!d?p&&t.target.system.restart():d&&t.target.system.endEmit())}),n.forEach(t=>{t.update(e)})}setTime(t){const e=this.currentTime;this.currentTime=t,this.animationData.forEach(n=>{const{startTime:i,duration:r,type:s,target:a,action:o,mixer:l}=n;if("three"===s&&o&&l){if(o.reset(),t>=i&&t<i+r){const e=t-i;o.time=e,o.play(),l.update(0),o.paused=!this.isPlaying}}else"ps"===s&&a&&(t>=i&&t<i+r?(e<i||e>=i+r)&&a.system.restart():a.system.endEmit())})}getDuration(){return this.duration}updateDuration(){let t=0;this.animationData.forEach(e=>{const n=e.startTime+e.duration;n>t&&(t=n)}),this.duration=t}resolveReferences(t){this._tempAnimationJSON.forEach(e=>{let n;if(t.traverse(t=>{t.uuid===e.targetUUID&&(n=t)}),n)if("three"===e.type&&e.clipUUID){let t;n.animations&&(t=n.animations.find(t=>t.uuid===e.clipUUID)),t&&this.addThreeAnimation(n,t,e.startTime,e.duration,e.loop)}else"ps"===e.type&&this.addParticleSystemAnimation(n,e.startTime,e.duration,e.loop)}),this.updateDuration(),this._tempAnimationJSON=[]}toJSON(){const t=super.toJSON();return t.object.animationData=this.animationData.map(t=>{var e;return{startTime:t.startTime,duration:t.duration,type:t.type,targetUUID:t.target.uuid,clipUUID:null==(e=t.clip)?void 0:e.uuid,loop:t.loop}}),t}static fromJSON(t){const e=new jg;return t.animationData&&(e._tempAnimationJSON=t.animationData),e}}Ag.tile_pars_vertex="\n#ifdef UV_TILE\n    attribute float uvTile;\n    uniform vec2 tileCount;\n    \n    mat3 makeTileTransform(float uvTile) {\n        float col = mod(uvTile, tileCount.x);\n        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);\n        \n        return mat3(\n          1.0 / tileCount.x, 0.0, 0.0,\n          0.0, 1.0 / tileCount.y, 0.0, \n          col / tileCount.x, row / tileCount.y, 1.0);\n    }\n#else\n    mat3 makeTileTransform(float uvTile) {\n        return mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvarying vec2 vUv;\n#ifdef TILE_BLEND\n    varying vec2 vUvNext;\n    varying float vUvBlend;\n#endif\n\n#endif\n#ifdef USE_MAP\n\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#ifdef TILE_BLEND\n    varying vec2 vMapUvNext;\n#endif\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",Ag.tile_vertex="\n#ifdef UV_TILE\n    mat3 tileTransform = makeTileTransform(floor(uvTile));\n    #ifdef TILE_BLEND\n        mat3 nextTileTransform = makeTileTransform(ceil(uvTile));\n        vUvBlend = fract(uvTile);\n    #endif\n#else\n    mat3 tileTransform = makeTileTransform(0.0);\n#endif\n\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\nvUv = (tileTransform *vec3( uv, 1 )).xy;\n#if defined( TILE_BLEND ) && defined( UV_TILE )\n    vUvNext = (nextTileTransform *vec3( uv, 1 )).xy;\n#endif\n\n#endif\n#ifdef USE_MAP\n\nvMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;\n#if defined( TILE_BLEND ) && defined( UV_TILE )\n    vMapUvNext = (nextTileTransform * (mapTransform * vec3( MAP_UV, 1 ))).xy;\n#endif\n\n#endif\n#ifdef USE_ALPHAMAP\n\nvAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;\n    \n#endif\n#ifdef USE_LIGHTMAP\n\nvLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_AOMAP\n\nvAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_BUMPMAP\n\nvBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_NORMALMAP\n\nvNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\nvDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\nvEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_METALNESSMAP\n\nvMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\nvRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\nvAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\nvClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\nvClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\nvClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\nvIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\nvIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\nvSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\nvSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SPECULARMAP\n\nvSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\nvSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\nvSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\nvTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\nvThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;\n\n#endif\n\n",Ag.tile_pars_fragment="\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvarying vec2 vUv;\n#ifdef TILE_BLEND\n    varying vec2 vUvNext;\n    varying float vUvBlend;\n#endif\n\n#endif\n#ifdef USE_MAP\n\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#ifdef TILE_BLEND\n    varying vec2 vMapUvNext;\n#endif\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",Ag.tile_fragment="\n#ifdef USE_MAP\n    vec4 texelColor = texture2D( map, vUv);\n    #ifdef TILE_BLEND\n        texelColor = mix( texelColor, texture2D( map, vUvNext ), vUvBlend );\n    #endif\n    diffuseColor *= texelColor;\n#endif\n",Ag.soft_pars_vertex="\n#ifdef SOFT_PARTICLES\n    varying vec4 projPosition;\n    varying float linearDepth;\n#endif\n",Ag.soft_vertex="\n#ifdef SOFT_PARTICLES\n    projPosition = gl_Position;\n    linearDepth = -mvPosition.z;\n#endif\n",Ag.soft_pars_fragment="\n#ifdef SOFT_PARTICLES\n\n    uniform sampler2D depthTexture;\n    uniform vec4 projParams;\n    uniform vec2 softParams;\n\n    varying vec4 projPosition;\n    varying float linearDepth;\n\n    #define SOFT_NEAR_FADE softParams.x\n    #define SOFT_INV_FADE_DISTANCE softParams.y\n\n    #define zNear projParams.x\n    #define zFar projParams.y\n\n    float linearize_depth(float d)\n    {\n        return (zFar * zNear) / (zFar - d * (zFar - zNear));\n    }\n\n#endif\n",Ag.soft_fragment="\n#ifdef SOFT_PARTICLES\n\n    /* #ifdef LOGDEPTH\n    float distSample = linearize_depth_log(sampleDepth, near, far);\n    #else\n    float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);\n    #endif */\n\n    vec2 p2 = projPosition.xy / projPosition.w;\n    \n    p2 = 0.5 * p2 + 0.5;\n\n    float readDepth = texture2D(depthTexture, p2.xy).r;\n    float viewDepth = linearize_depth(readDepth);\n\n    float softParticlesFade = saturate(SOFT_INV_FADE_DISTANCE * ((viewDepth - SOFT_NEAR_FADE) - linearDepth));\n    \n    gl_FragColor *= softParticlesFade;\n\n    //gl_FragColor = vec4(softParticlesFade , 0, 0, 1);\n#endif\n",function(t){if(!wg.find(e=>e.id===t.id)){for(const e of t.emitterShapes)Um[e.type]||(Um[e.type]=e);for(const e of t.behaviors)Sg[e.type]||(Sg[e.type]=e)}}(Mg);const Yg=class t{static async loadQuarks(e){return t.loader.setCrossOrigin(""),new Promise(n=>{const i=t=>{const e=[];t.traverse(t=>{t instanceof Eg&&e.push(t)}),t instanceof Eg&&e.push(t),n({particle:t,emitterList:e})};e&&("string"==typeof e?t.loader.load(e,t=>i(t)):t.loader.parse(e,t=>i(t)))}).catch(t=>{})}static loadQuarksSync(e){t.loader.setCrossOrigin("");return(t=>{const e=[];return t.traverse(t=>{t instanceof Eg&&e.push(t)}),t instanceof Eg&&e.push(t),{particle:t,emitterList:e}})(t.loader.parse(e))}};n(Yg,"loader",new class extends cd{constructor(t){super(t)}linkReference(t){const e={};t.traverse(function(t){e[t.uuid]=t}),t.traverse(function(t){if("ParticleEmitter"===t.type){const n=t.system;n.emitterShape;for(let t=0;t<n.behaviors.length;t++)n.behaviors[t]instanceof ig&&(n.behaviors[t].subParticleSystem=e[n.behaviors[t].subParticleSystem])}})}parse(t,e){const n=super.parse(t,e);return this.linkReference(n),n}parseObject(t,e,n,i,r){let s,a,o;function l(t){return e[t],e[t]}function h(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n[r],e.push(n[r])}return e}return n[t],n[t]}}function c(t){return i[t],i[t]}const u={textures:i,geometries:e,materials:n},d={};switch(t.type){case"QuarksPrefab":s=jg.fromJSON(t);break;case"ParticleEmitter":s=Lg.fromJSON(t.ps,u,d).emitter;break;case"Scene":s=new Ko,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new qi(t.background):s.background=c(t.background)),void 0!==t.environment&&(s.environment=c(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new qo(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new Yo(t.fog.color,t.fog.density)),""!==t.fog.name&&(s.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(s.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(s.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&s.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(s.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&s.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":s=new Yr(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new bs(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new nd(t.color,t.intensity);break;case"DirectionalLight":s=new ed(t.color,t.intensity);break;case"PointLight":s=new $u(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new id(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new qu(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new Hu(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new sd).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=h(t.material),s=new El(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=h(t.material),s=new Fr(a,o);break;case"InstancedMesh":{a=l(t.geometry),o=h(t.material);const e=t.count,n=t.instanceMatrix,i=t.instanceColor;s=new Gl(a,o,e),s.instanceMatrix=new Dl(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new Dl(new Float32Array(i.array),i.itemSize));break}case"BatchedMesh":a=l(t.geometry),o=h(t.material),s=new oh(t.maxGeometryCount,t.maxVertexCount,t.maxIndexCount,o),s.geometry=a,s.perObjectFrustumCulled=t.perObjectFrustumCulled,s.sortObjects=t.sortObjects,s._drawRanges=t.drawRanges,s._reservedRanges=t.reservedRanges,s._visibility=t.visibility,s._active=t.active,s._bounds=t.bounds.map(t=>{const e=new On;e.min.fromArray(t.boxMin),e.max.fromArray(t.boxMax);const n=new Jn;return n.radius=t.sphereRadius,n.center.fromArray(t.sphereCenter),{boxInitialized:t.boxInitialized,box:e,sphereInitialized:t.sphereInitialized,sphere:n}}),s._maxGeometryCount=t.maxGeometryCount,s._maxVertexCount=t.maxVertexCount,s._maxIndexCount=t.maxIndexCount,s._geometryInitialized=t.geometryInitialized,s._geometryCount=t.geometryCount,s._matricesTexture=c(t.matricesTexture.uuid);break;case"LOD":s=new vl;break;case"Line":s=new gh(l(t.geometry),h(t.material));break;case"LineLoop":s=new _h(l(t.geometry),h(t.material));break;case"LineSegments":s=new bh(l(t.geometry),h(t.material));break;case"PointCloud":case"Points":s=new Eh(l(t.geometry),h(t.material));break;case"Sprite":s=new pl(h(t.material));break;case"Group":s=new Uo;break;case"Bone":s=new Cl;break;default:s=new Oi}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&(s.matrix.decompose(s.position,s.quaternion,s.scale),isNaN(s.quaternion.x)&&s.quaternion.set(0,0,0,1))):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.up&&s.up.fromArray(t.up),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)s.add(this.parseObject(a[t],e,n,i,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];s.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance)}}else"QuarksPrefab"===t.type&&s.resolveReferences(s);return s}}),n(Yg,"currentQuarksScene",null);let qg=Yg;const Kg={texture:{},gltf:{},glb:{},cssImage:{},hdr:{},cubemap:{},quarks:{},vertexShader:{},fragmentShader:{},optionals:{texture:{},gltf:{},glb:{}}},Jg=[{name:"Main Scene",id:"c7d5b961-2233-4867-820d-e70e9692d2fc",type:"3D",root:{id:"ROOT",name:"ROOT",children:[{name:"Directional Light",type:"directionalLight",id:"d6d5fba0-26ce-424f-ab72-2c456958f538",components:{node3D:{type:"node3D",label:"Directional Light",visible:!0,position:{x:1.1449022724294329,y:5.2628627603894405,z:2.7614390182904605,linked:!1},scale:{x:1,y:1,z:1,linked:!0},rotation:{x:0,y:0,z:0,linked:!1},renderOrder:0},light:{type:"light",color:"#ffffff",intensity:1},directionalLight:{type:"directionalLight",color:"#ffffff",intensity:1,target:{x:0,y:0,z:0,linked:!1},debug:!1,castShadow:!0,bias:-25e-5,shadowMapSize:1024,shadowAreaSize:10}},children:[]},{name:"Ambient Light",type:"ambientLight",id:"dff5788b-8468-44d0-accd-2837951421f3",components:{node3D:{type:"node3D",label:"Ambient Light",visible:!0,position:{x:0,y:5.612532772623638,z:0,linked:!1},scale:{x:1,y:1,z:1,linked:!0},rotation:{x:0,y:0,z:0,linked:!1},renderOrder:0},light:{type:"light",color:"#ffffff",intensity:1}},children:[]},{name:"Camera",type:"perspectiveCamera",id:"2f48e7d3-266b-4e36-b13b-109cb2df87fe",components:{node3D:{type:"node3D",label:"Camera",visible:!0,position:{x:-1.0084608913112392,y:1.5009794993870056,z:4.038908041464481,linked:!1},scale:{x:1,y:1,z:1,linked:!0},rotation:{x:0,y:-.32884915909943296,z:0,linked:!1},renderOrder:0},perspectiveCamera:{type:"perspectiveCamera",fov:75,aspect:2,near:.1,far:1e3,debug:!1}},children:[],hidden:!1},{name:"New Box",type:"box",id:"70d95eba-b9a2-4a57-b5c7-21dcab1ccff8",components:{node3D:{type:"node3D",label:"New Box",visible:!0,position:{x:0,y:0,z:0,linked:!1},scale:{x:1,y:1,z:1,linked:!0},rotation:{x:0,y:0,z:0,linked:!1},renderOrder:0},mesh:{type:"mesh",geometry:"default",material:"default",castShadow:!1,receiveShadow:!1}},children:[],hidden:!1}],type:"root",components:{}},settings:{type:"scene",backgroundType:"solid",backgroundColor1:"#5e5e5e",backgroundColor2:"#3b2eab",backgroundImage:"022785de-f1b3-4829-a5da-d2b0eb1ff9c0",fog:!1,fogType:"linear",fogColor:"#707070",fogNear:1,fogFar:50,fogDensity:.08999999999999997,environment:null,environmentIntensity:1,hdrFile:"dd2f56f9-4038-424a-852f-741c8144e74b",cubemap:""}}],Zg={antialias:!0,alpha:!1,resolution:2,toneMapping:"NoToneMapping",toneMappingExposure:1,shadowMapEnabled:!1,shadowMapType:"VSMShadowMap",logarithmicDepthBuffer:!0,outputColorSpace:"SRGBColorSpace"},Qg={texture:{},model:{},material:{},quarks:{}},$g={gltf:[]},tv=[],ev=[],nv={assets:Kg,scenes:Jg,rendererConfig:Zg,objectMap:Qg,stuffs:$g,prefabs:tv,materials:ev},iv=Object.freeze(Object.defineProperty({__proto__:null,assets:Kg,default:nv,materials:ev,objectMap:Qg,prefabs:tv,rendererConfig:Zg,scenes:Jg,stuffs:$g},Symbol.toStringTag,{value:"Module"})),rv=[],sv=Object.freeze(Object.defineProperty({__proto__:null,default:rv},Symbol.toStringTag,{value:"Module"})),av=[],ov=Object.freeze(Object.defineProperty({__proto__:null,default:av},Symbol.toStringTag,{value:"Module"})),lv={},hv=Object.freeze(Object.defineProperty({__proto__:null,default:lv},Symbol.toStringTag,{value:"Module"})),cv=S||w,uv=nv||iv,dv=[];let pv=rv||sv;pv=pv.default||pv;let fv=av||ov;fv=fv.default||fv;let mv=lv||hv;mv=mv.default||mv,fv.forEach(t=>{var e,n;"gltf"===t.type?(null==(n=null==(e=t.gltf)?void 0:e.images)||n.forEach(t=>{void 0!==t.uri&&(t.uri=pv[t.uri])}),dv.push({type:"gltf",key:t.uuid,src:JSON.stringify(t.gltf)})):"glb"===t.type?dv.push({type:"glb",key:t.uuid,src:t.src}):"brotliGltf"===t.type?dv.push({type:"brotliGltf",key:t.uuid,src:{gltf:t.src.gltf,bin:t.src.bin,textures:t.src.textures.map(t=>t.uri?t:{name:t.name,uri:pv[t.no]})}}):"hdr"===t.type?dv.push({type:"hdr",key:t.uuid,src:t.hdrData}):"cubemap"===t.type?dv.push({type:"cubemap",key:t.uuid,list:t.list.map(t=>pv[t])}):"texture"===t.type&&dv.push({type:"texture",key:t.uuid,src:pv[t.src]})});for(let w6 in mv){const t=mv[w6];t.src.images.forEach(t=>{t.url=pv[t.url]}),dv.push({type:"quarks",key:w6,src:t})}class gv{static addStuffsAssets(){if(window.app&&window.app.data.stuffsLoadList){const{texture:t,gltf:e,glb:n,brotliGltf:i}=window.app.data.stuffsLoadList;!function(t,e,n,i,r,s,a={},o={},l={}){for(let h in t){if(!t.hasOwnProperty(h))continue;if(!t[h])continue;const e=t[h];dv.push({type:"texture",key:h,src:e})}for(let h in e){if(!e.hasOwnProperty(h))continue;if(!e[h])continue;let t;t="string"==typeof e[h]?e[h]:e[h].gltfPath,dv.push({type:"gltf",key:h,src:t})}for(let h in n)n.hasOwnProperty(h)&&n[h]&&dv.push({type:"glb",key:h,src:n[h]});for(let h in i){if(!i.hasOwnProperty(h))continue;if(!i[h])continue;const t=i[h];dv.push({type:"brotliGltf",key:h,src:t})}for(let h in r){if(!r.hasOwnProperty(h))continue;if(!r[h])continue;const t=r[h];dv.push({type:"quarks",key:h,src:t})}for(let h in s){if(!s.hasOwnProperty(h))continue;if(!s[h])continue;const t=s[h];dv.push({type:"hdr",key:h,src:t})}for(let h in a){if(!a.hasOwnProperty(h))continue;if(!a[h])continue;const t=a[h];dv.push({type:"cubemap",key:h,list:t})}for(let h in o){if(!o.hasOwnProperty(h))continue;if(!o[h])continue;const t=o[h];dv.push({type:"vertexShader",key:h,src:t})}for(let h in l){if(!l.hasOwnProperty(h))continue;if(!l[h])continue;const t=l[h];dv.push({type:"fragmentShader",key:h,src:t})}}(t,e,n,i,{},{})}}static addOptionalAssets(){if(window.app&&window.app.data.__optionalAssets){const{model:t}=window.app.data.__optionalAssets;for(let e in t){if(!t[e])continue;const n=t[e];"brotliGltf"===n.type&&dv.push({type:"brotliGltf",key:e,src:n.src})}}}static getAssetsToLoad(){return dv}static getMappedAsset(t,e){var n;return uv.objectMap[t][e]||(null==(n=app.data.__stuffsExportMap)?void 0:n[e])}static getScenes(){return uv.scenes}static getSceneDataById(t){return uv.scenes.find(e=>e.id===t)}static getSceneDataByIndex(t){return uv.scenes[t]}static getSceneDataByName(t){return uv.scenes.find(e=>e.name===t)}static setLoadedAssets(t){this.assets=t}static getAssetById(t){return this.assets[t]}static getRendererConfig(){return cv.rendererSettings3D}static getMaterials(){return uv.materials}static getPrefab(t){let e=uv.prefabs.find(e=>e.id===t);return e||(e=uv.prefabs.find(e=>e.exportId===t)),e||(e=uv.prefabs.find(e=>e.name===t)),e}}function vv(t){const e=new Map,n=new Map,i=t.clone();return yv(t,i,function(t,i){e.set(i,t),n.set(t,i)}),i.traverse(function(t){if(!t.isSkinnedMesh)return;const i=t,r=e.get(t),s=r.skeleton.bones;i.skeleton=r.skeleton.clone(),i.bindMatrix.copy(r.bindMatrix),i.skeleton.bones=s.map(function(t){return n.get(t)}),i.bind(i.skeleton,i.bindMatrix)}),i}function yv(t,e,n){n(t,e);for(let i=0;i<t.children.length;i++)yv(t.children[i],e.children[i],n)}n(gv,"assets");var xv={exports:{}},bv=xv.exports;!function(t){if("object"==typeof bv&&void 0!==xv)xv.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).unbrotli=t()}}(function(){return function(){return function t(e,n,i){function r(a,o){if(!n[a]){if(!e[a]){var l="function"==typeof require2&&require2;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){return r(e[a][1][t]||t)},c,c.exports,t,e,n,i)}return n[a].exports}for(var s="function"==typeof require2&&require2,a=0;a<i.length;a++)r(i[a]);return r}}()({1:[function(t,e,n){var i=4096,r=new Uint32Array([0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215]);function s(t){this.buf_=new Uint8Array(8224),this.input_=t,this.reset()}s.READ_SIZE=i,s.IBUF_MASK=8191,s.prototype.reset=function(){this.buf_ptr_=0,this.val_=0,this.pos_=0,this.bit_pos_=0,this.bit_end_pos_=0,this.eos_=0,this.readMoreInput();for(var t=0;t<4;t++)this.val_|=this.buf_[this.pos_]<<8*t,++this.pos_;return this.bit_end_pos_>0},s.prototype.readMoreInput=function(){if(!(this.bit_end_pos_>256))if(this.eos_){if(this.bit_pos_>this.bit_end_pos_)throw new Error("Unexpected end of input "+this.bit_pos_+" "+this.bit_end_pos_)}else{var t=this.buf_ptr_,e=this.input_.read(this.buf_,t,i);if(e<0)throw new Error("Unexpected end of input");if(e<i){this.eos_=1;for(var n=0;n<32;n++)this.buf_[t+e+n]=0}if(0===t){for(n=0;n<32;n++)this.buf_[8192+n]=this.buf_[n];this.buf_ptr_=i}else this.buf_ptr_=0;this.bit_end_pos_+=e<<3}},s.prototype.fillBitWindow=function(){for(;this.bit_pos_>=8;)this.val_>>>=8,this.val_|=this.buf_[8191&this.pos_]<<24,++this.pos_,this.bit_pos_=this.bit_pos_-8>>>0,this.bit_end_pos_=this.bit_end_pos_-8>>>0},s.prototype.readBits=function(t){32-this.bit_pos_<t&&this.fillBitWindow();var e=this.val_>>>this.bit_pos_&r[t];return this.bit_pos_+=t,e},e.exports=s},{}],2:[function(t,e,n){n.lookup=new Uint8Array([0,0,0,0,0,0,0,0,0,4,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,12,16,12,12,20,12,16,24,28,12,12,32,12,36,12,44,44,44,44,44,44,44,44,44,44,32,32,24,40,28,12,12,48,52,52,52,48,52,52,52,48,52,52,52,52,52,48,52,52,52,52,52,48,52,52,52,52,52,24,12,28,12,12,12,56,60,60,60,56,60,60,60,56,60,60,60,60,60,56,60,60,60,60,60,56,60,60,60,60,60,24,12,28,12,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,56,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,22,22,22,22,23,23,23,23,24,24,24,24,25,25,25,25,26,26,26,26,27,27,27,27,28,28,28,28,29,29,29,29,30,30,30,30,31,31,31,31,32,32,32,32,33,33,33,33,34,34,34,34,35,35,35,35,36,36,36,36,37,37,37,37,38,38,38,38,39,39,39,39,40,40,40,40,41,41,41,41,42,42,42,42,43,43,43,43,44,44,44,44,45,45,45,45,46,46,46,46,47,47,47,47,48,48,48,48,49,49,49,49,50,50,50,50,51,51,51,51,52,52,52,52,53,53,53,53,54,54,54,54,55,55,55,55,56,56,56,56,57,57,57,57,58,58,58,58,59,59,59,59,60,60,60,60,61,61,61,61,62,62,62,62,63,63,63,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n.lookupOffsets=new Uint16Array([1024,1536,1280,1536,0,256,768,512])},{}],3:[function(t,e,n){var i=t("./streams").BrotliInput,r=t("./streams").BrotliOutput,s=t("./bit_reader"),a=t("./dictionary"),o=t("./huffman").HuffmanCode,l=t("./huffman").BrotliBuildHuffmanTable,h=t("./context"),c=t("./prefix"),u=t("./transform"),d=1080,p=new Uint8Array([1,2,3,4,0,5,17,6,16,7,8,9,10,11,12,13,14,15]),f=new Uint8Array([3,2,1,0,3,3,3,3,3,3,2,2,2,2,2,2]),m=new Int8Array([0,0,0,0,-1,1,-2,2,-3,3,-1,1,-2,2,-3,3]),g=new Uint16Array([256,402,436,468,500,534,566,598,630,662,694,726,758,790,822,854,886,920,952,984,1016,1048,1080]);function v(t){var e;return 0===t.readBits(1)?16:(e=t.readBits(3))>0?17+e:(e=t.readBits(3))>0?8+e:17}function y(t){if(t.readBits(1)){var e=t.readBits(3);return 0===e?1:t.readBits(e)+(1<<e)}return 0}function x(){this.meta_block_length=0,this.input_end=0,this.is_uncompressed=0,this.is_metadata=!1}function b(t){var e,n,i,r=new x;if(r.input_end=t.readBits(1),r.input_end&&t.readBits(1))return r;if(7===(e=t.readBits(2)+4)){if(r.is_metadata=!0,0!==t.readBits(1))throw new Error("Invalid reserved bit");if(0===(n=t.readBits(2)))return r;for(i=0;i<n;i++){var s=t.readBits(8);if(i+1===n&&n>1&&0===s)throw new Error("Invalid size byte");r.meta_block_length|=s<<8*i}}else for(i=0;i<e;++i){var a=t.readBits(4);if(i+1===e&&e>4&&0===a)throw new Error("Invalid size nibble");r.meta_block_length|=a<<4*i}return++r.meta_block_length,r.input_end||r.is_metadata||(r.is_uncompressed=t.readBits(1)),r}function _(t,e,n){var i;return n.fillBitWindow(),(i=t[e+=n.val_>>>n.bit_pos_&255].bits-8)>0&&(n.bit_pos_+=8,e+=t[e].value,e+=n.val_>>>n.bit_pos_&(1<<i)-1),n.bit_pos_+=t[e].bits,t[e].value}function S(t,e,n,i){var r,s,a=new Uint8Array(t);if(i.readMoreInput(),1===(s=i.readBits(2))){for(var h=t-1,c=0,u=new Int32Array(4),d=i.readBits(2)+1;h;)h>>=1,++c;for(f=0;f<d;++f)u[f]=i.readBits(c)%t,a[u[f]]=2;switch(a[u[0]]=1,d){case 1:break;case 3:if(u[0]===u[1]||u[0]===u[2]||u[1]===u[2])throw new Error("[ReadHuffmanCode] invalid symbols");break;case 2:if(u[0]===u[1])throw new Error("[ReadHuffmanCode] invalid symbols");a[u[1]]=1;break;case 4:if(u[0]===u[1]||u[0]===u[2]||u[0]===u[3]||u[1]===u[2]||u[1]===u[3]||u[2]===u[3])throw new Error("[ReadHuffmanCode] invalid symbols");i.readBits(1)?(a[u[2]]=3,a[u[3]]=3):a[u[0]]=2}}else{var f,m=new Uint8Array(18),g=32,v=0,y=[new o(2,0),new o(2,4),new o(2,3),new o(3,2),new o(2,0),new o(2,4),new o(2,3),new o(4,1),new o(2,0),new o(2,4),new o(2,3),new o(3,2),new o(2,0),new o(2,4),new o(2,3),new o(4,5)];for(f=s;f<18&&g>0;++f){var x,b=p[f],_=0;i.fillBitWindow(),_+=i.val_>>>i.bit_pos_&15,i.bit_pos_+=y[_].bits,x=y[_].value,m[b]=x,0!==x&&(g-=32>>x,++v)}if(1!==v&&0!==g)throw new Error("[ReadHuffmanCode] invalid num_codes or space");!function(t,e,n,i){for(var r=0,s=8,a=0,h=0,c=32768,u=[],d=0;d<32;d++)u.push(new o(0,0));for(l(u,0,5,t,18);r<e&&c>0;){var p,f=0;if(i.readMoreInput(),i.fillBitWindow(),f+=i.val_>>>i.bit_pos_&31,i.bit_pos_+=u[f].bits,(p=255&u[f].value)<16)a=0,n[r++]=p,0!==p&&(s=p,c-=32768>>p);else{var m,g,v=p-14,y=0;if(16===p&&(y=s),h!==y&&(a=0,h=y),m=a,a>0&&(a-=2,a<<=v),r+(g=(a+=i.readBits(v)+3)-m)>e)throw new Error("[ReadHuffmanCodeLengths] symbol + repeat_delta > num_symbols");for(var x=0;x<g;x++)n[r+x]=h;r+=g,0!==h&&(c-=g<<15-h)}}if(0!==c)throw new Error("[ReadHuffmanCodeLengths] space = "+c);for(;r<e;r++)n[r]=0}(m,t,a,i)}if(0===(r=l(e,n,8,a,t)))throw new Error("[ReadHuffmanCode] BuildHuffmanTable failed: ");return r}function w(t,e,n){var i,r;return i=_(t,e,n),r=c.kBlockLengthPrefixCode[i].nbits,c.kBlockLengthPrefixCode[i].offset+n.readBits(r)}function T(t,e,n){var i;return t<16?(n+=f[t],i=e[n&=3]+m[t]):i=t-16+1,i}function M(t,e){for(var n=t[e],i=e;i;--i)t[i]=t[i-1];t[0]=n}function A(t,e){this.alphabet_size=t,this.num_htrees=e,this.codes=new Array(e+e*g[t+31>>>5]),this.htrees=new Uint32Array(e)}function E(t,e){var n,i,r={num_htrees:null,context_map:null},s=0;e.readMoreInput();var a=r.num_htrees=y(e)+1,l=r.context_map=new Uint8Array(t);if(a<=1)return r;for(e.readBits(1)&&(s=e.readBits(4)+1),n=[],i=0;i<d;i++)n[i]=new o(0,0);for(S(a+s,n,0,e),i=0;i<t;){var h;if(e.readMoreInput(),0===(h=_(n,0,e)))l[i]=0,++i;else if(h<=s)for(var c=1+(1<<h)+e.readBits(h);--c;){if(i>=t)throw new Error("[DecodeContextMap] i >= context_map_size");l[i]=0,++i}else l[i]=h-s,++i}return e.readBits(1)&&function(t,e){var n,i=new Uint8Array(256);for(n=0;n<256;++n)i[n]=n;for(n=0;n<e;++n){var r=t[n];t[n]=i[r],r&&M(i,r)}}(l,t),r}function C(t,e,n,i,r,s,a){var o,l=2*n,h=n,c=_(e,n*d,a);(o=0===c?r[l+(1&s[h])]:1===c?r[l+(s[h]-1&1)]+1:c-2)>=t&&(o-=t),i[n]=o,r[l+(1&s[h])]=o,++s[h]}function P(t,e,n,i,r,a){var o,l=r+1,h=n&r,c=a.pos_&s.IBUF_MASK;if(e<8||a.bit_pos_+(e<<3)<a.bit_end_pos_)for(;e-- >0;)a.readMoreInput(),i[h++]=a.readBits(8),h===l&&(t.write(i,l),h=0);else{if(a.bit_end_pos_<32)throw new Error("[CopyUncompressedBlockToOutput] br.bit_end_pos_ < 32");for(;a.bit_pos_<32;)i[h]=a.val_>>>a.bit_pos_,a.bit_pos_+=8,++h,--e;if(c+(o=a.bit_end_pos_-a.bit_pos_>>3)>s.IBUF_MASK){for(var u=s.IBUF_MASK+1-c,d=0;d<u;d++)i[h+d]=a.buf_[c+d];o-=u,h+=u,e-=u,c=0}for(d=0;d<o;d++)i[h+d]=a.buf_[c+d];if(e-=o,(h+=o)>=l){t.write(i,l),h-=l;for(d=0;d<h;d++)i[d]=i[l+d]}for(;h+e>=l;){if(o=l-h,a.input_.read(i,h,o)<o)throw new Error("[CopyUncompressedBlockToOutput] not enough bytes");t.write(i,l),e-=o,h=0}if(a.input_.read(i,h,e)<e)throw new Error("[CopyUncompressedBlockToOutput] not enough bytes");a.reset()}}function R(t){var e=t.bit_pos_+7&-8;return 0==t.readBits(e-t.bit_pos_)}function I(t){var e=new i(t),n=new s(e);return v(n),b(n).meta_block_length}function O(t,e){var n,i,r,l,p,f,m,g,x,M,I=0,O=0,D=0,B=[16,15,11,4],F=0,L=0,U=0,k=[new A(0,0),new A(0,0),new A(0,0)],N=128+s.READ_SIZE;r=(1<<(i=v(M=new s(t))))-16,p=(l=1<<i)-1,f=new Uint8Array(l+N+a.maxDictionaryWordLength),m=l,g=[],x=[];for(var z=0;z<3240;z++)g[z]=new o(0,0),x[z]=new o(0,0);for(;!O;){var G,H,V,X,W,j,Y,q,K,J,Z,Q=0,$=[1<<28,1<<28,1<<28],tt=[0],et=[1,1,1],nt=[0,1,0,1,0,1],it=[0],rt=null,st=null,at=0,ot=null,lt=0,ht=0,ct=0;for(n=0;n<3;++n)k[n].codes=null,k[n].htrees=null;M.readMoreInput();var ut=b(M);if(I+(Q=ut.meta_block_length)>e.buffer.length){var dt=new Uint8Array(I+Q);dt.set(e.buffer),e.buffer=dt}if(O=ut.input_end,G=ut.is_uncompressed,ut.is_metadata)for(R(M);Q>0;--Q)M.readMoreInput(),M.readBits(8);else if(0!==Q)if(G)M.bit_pos_=M.bit_pos_+7&-8,P(e,Q,I,f,p,M),I+=Q;else{for(n=0;n<3;++n)et[n]=y(M)+1,et[n]>=2&&(S(et[n]+2,g,n*d,M),S(26,x,n*d,M),$[n]=w(x,n*d,M),it[n]=1);for(M.readMoreInput(),X=(1<<(H=M.readBits(2)))-1,W=(V=16+(M.readBits(4)<<H))+(48<<H),rt=new Uint8Array(et[0]),n=0;n<et[0];++n)M.readMoreInput(),rt[n]=M.readBits(2)<<1;var pt=E(et[0]<<6,M);Y=pt.num_htrees,j=pt.context_map;var ft=E(et[2]<<2,M);for(K=ft.num_htrees,q=ft.context_map,k[0]=new A(256,Y),k[1]=new A(704,et[1]),k[2]=new A(W,K),n=0;n<3;++n)k[n].decode(M);for(st=0,ot=0,J=rt[tt[0]],ht=h.lookupOffsets[J],ct=h.lookupOffsets[J+1],Z=k[1].htrees[0];Q>0;){var mt,gt,vt,yt,xt,bt,_t,St,wt,Tt,Mt,At;for(M.readMoreInput(),0===$[1]&&(C(et[1],g,1,tt,nt,it,M),$[1]=w(x,d,M),Z=k[1].htrees[tt[1]]),--$[1],(gt=(mt=_(k[1].codes,Z,M))>>6)>=2?(gt-=2,_t=-1):_t=0,vt=c.kInsertRangeLut[gt]+(mt>>3&7),yt=c.kCopyRangeLut[gt]+(7&mt),xt=c.kInsertLengthPrefixCode[vt].offset+M.readBits(c.kInsertLengthPrefixCode[vt].nbits),bt=c.kCopyLengthPrefixCode[yt].offset+M.readBits(c.kCopyLengthPrefixCode[yt].nbits),L=f[I-1&p],U=f[I-2&p],wt=0;wt<xt;++wt)M.readMoreInput(),0===$[0]&&(C(et[0],g,0,tt,nt,it,M),$[0]=w(x,0,M),st=tt[0]<<6,J=rt[tt[0]],ht=h.lookupOffsets[J],ct=h.lookupOffsets[J+1]),at=j[st+(h.lookup[ht+L]|h.lookup[ct+U])],--$[0],U=L,L=_(k[0].codes,k[0].htrees[at],M),f[I&p]=L,(I&p)===p&&e.write(f,l),++I;if((Q-=xt)<=0)break;if(_t<0)if(M.readMoreInput(),0===$[2]&&(C(et[2],g,2,tt,nt,it,M),$[2]=w(x,2160,M),ot=tt[2]<<2),--$[2],lt=q[ot+(255&(bt>4?3:bt-2))],(_t=_(k[2].codes,k[2].htrees[lt],M))>=V)At=(_t-=V)&X,_t=V+((Et=(2+(1&(_t>>=H))<<(Mt=1+(_t>>1)))-4)+M.readBits(Mt)<<H)+At;if((St=T(_t,B,F))<0)throw new Error("[BrotliDecompress] invalid distance");if(Tt=I&p,St>(D=I<r&&D!==r?I:r)){if(!(bt>=a.minDictionaryWordLength&&bt<=a.maxDictionaryWordLength))throw new Error("Invalid backward reference. pos: "+I+" distance: "+St+" len: "+bt+" bytes left: "+Q);var Et=a.offsetsByLength[bt],Ct=St-D-1,Pt=a.sizeBitsByLength[bt],Rt=Ct>>Pt;if(Et+=(Ct&(1<<Pt)-1)*bt,!(Rt<u.kNumTransforms))throw new Error("Invalid backward reference. pos: "+I+" distance: "+St+" len: "+bt+" bytes left: "+Q);var It=u.transformDictionaryWord(f,Tt,Et,bt,Rt);if(I+=It,Q-=It,(Tt+=It)>=m){e.write(f,l);for(var Ot=0;Ot<Tt-m;Ot++)f[Ot]=f[m+Ot]}}else{if(_t>0&&(B[3&F]=St,++F),bt>Q)throw new Error("Invalid backward reference. pos: "+I+" distance: "+St+" len: "+bt+" bytes left: "+Q);for(wt=0;wt<bt;++wt)f[I&p]=f[I-St&p],(I&p)===p&&e.write(f,l),++I,--Q}L=f[I-1&p],U=f[I-2&p]}I&=1073741823}}e.write(f,I&p)}A.prototype.decode=function(t){var e,n=0;for(e=0;e<this.num_htrees;++e)this.htrees[e]=n,n+=S(this.alphabet_size,this.codes,n,t)},n.BrotliDecompressedSize=I,n.BrotliDecompressBuffer=function(t,e){var n=new i(t);null==e&&(e=I(t));var s=new Uint8Array(e),a=new r(s);return O(n,a),a.pos<a.buffer.length&&(a.buffer=a.buffer.subarray(0,a.pos)),a.buffer},n.BrotliDecompress=O,a.init()},{"./bit_reader":1,"./context":2,"./dictionary":6,"./huffman":7,"./prefix":9,"./streams":10,"./transform":11}],4:[function(t,e,n){var i=t("base64-js");n.init=function(){return(0,t("./decode").BrotliDecompressBuffer)(i.toByteArray(t("./dictionary.bin.js")))}},{"./decode":3,"./dictionary.bin.js":5,"base64-js":8}],5:[function(t,e,n){e.exports="W5/fcQLn5gKf2XUbAiQ1XULX+TZz6ADToDsgqk6qVfeC0e4m6OO2wcQ1J76ZBVRV1fRkEsdu//62zQsFEZWSTCnMhcsQKlS2qOhuVYYMGCkV0fXWEoMFbESXrKEZ9wdUEsyw9g4bJlEt1Y6oVMxMRTEVbCIwZzJzboK5j8m4YH02qgXYhv1V+PM435sLVxyHJihaJREEhZGqL03txGFQLm76caGO/ovxKvzCby/3vMTtX/459f0igi7WutnKiMQ6wODSoRh/8Lx1V3Q99MvKtwB6bHdERYRY0hStJoMjNeTsNX7bn+Y7e4EQ3bf8xBc7L0BsyfFPK43dGSXpL6clYC/I328h54/VYrQ5i0648FgbGtl837svJ35L3Mot/+nPlNpWgKx1gGXQYqX6n+bbZ7wuyCHKcUok12Xjqub7NXZGzqBx0SD+uziNf87t7ve42jxSKQoW3nyxVrWIGlFShhCKxjpZZ5MeGna0+lBkk+kaN8F9qFBAFgEogyMBdcX/T1W/WnMOi/7ycWUQloEBKGeC48MkiwqJkJO+12eQiOFHMmck6q/IjWW3RZlany23TBm+cNr/84/oi5GGmGBZWrZ6j+zykVozz5fT/QH/Da6WTbZYYPynVNO7kxzuNN2kxKKWche5WveitPKAecB8YcAHz/+zXLjcLzkdDSktNIDwZE9J9X+tto43oJy65wApM3mDzYtCwX9lM+N5VR3kXYo0Z3t0TtXfgBFg7gU8oN0Dgl7fZlUbhNll+0uuohRVKjrEd8egrSndy5/Tgd2gqjA4CAVuC7ESUmL3DZoGnfhQV8uwnpi8EGvAVVsowNRxPudck7+oqAUDkwZopWqFnW1riss0t1z6iCISVKreYGNvQcXv+1L9+jbP8cd/dPUiqBso2q+7ZyFBvENCkkVr44iyPbtOoOoCecWsiuqMSML5lv+vN5MzUr+Dnh73G7Q1YnRYJVYXHRJaNAOByiaK6CusgFdBPE40r0rvqXV7tksKO2DrHYXBTv8P5ysqxEx8VDXUDDqkPH6NNOV/a2WH8zlkXRELSa8P+heNyJBBP7PgsG1EtWtNef6/i+lcayzQwQCsduidpbKfhWUDgAEmyhGu/zVTacI6RS0zTABrOYueemnVa19u9fT23N/Ta6RvTpof5DWygqreCqrDAgM4LID1+1T/taU6yTFVLqXOv+/MuQOFnaF8vLMKD7tKWDoBdALgxF33zQccCcdHx8fKIVdW69O7qHtXpeGr9jbbpFA+qRMWr5hp0s67FPc7HAiLV0g0/peZlW7hJPYEhZyhpSwahnf93/tZgfqZWXFdmdXBzqxGHLrQKxoAY6fRoBhgCRPmmGueYZ5JexTVDKUIXzkG/fqp/0U3hAgQdJ9zumutK6nqWbaqvm1pgu03IYR+G+8s0jDBBz8cApZFSBeuWasyqo2OMDKAZCozS+GWSvL/HsE9rHxooe17U3s/lTE+VZAk4j3dp6uIGaC0JMiqR5CUsabPyM0dOYDR7Ea7ip4USZlya38YfPtvrX/tBlhHilj55nZ1nfN24AOAi9BVtz/Mbn8AEDJCqJgsVUa6nQnSxv2Fs7l/NlCzpfYEjmPrNyib/+t0ei2eEMjvNhLkHCZlci4WhBe7ePZTmzYqlY9+1pxtS4GB+5lM1BHT9tS270EWUDYFq1I0yY/fNiAk4bk9yBgmef/f2k6AlYQZHsNFnW8wBQxCd68iWv7/35bXfz3JZmfGligWAKRjIs3IpzxQ27vAglHSiOzCYzJ9L9A1CdiyFvyR66ucA4jKifu5ehwER26yV7HjKqn5Mfozo7Coxxt8LWWPT47BeMxX8p0Pjb7hZn+6bw7z3Lw+7653j5sI8CLu5kThpMlj1m4c2ch3jGcP1FsT13vuK3qjecKTZk2kHcOZY40UX+qdaxstZqsqQqgXz+QGF99ZJLqr3VYu4aecl1Ab5GmqS8k/GV5b95zxQ5d4EfXUJ6kTS/CXF/aiqKDOT1T7Jz5z0PwDUcwr9clLN1OJGCiKfqvah+h3XzrBOiLOW8wvn8gW6qE8vPxi+Efv+UH55T7PQFVMh6cZ1pZQlzJpKZ7P7uWvwPGJ6DTlR6wbyj3Iv2HyefnRo/dv7dNx+qaa0N38iBsR++Uil7Wd4afwDNsrzDAK4fXZwvEY/jdKuIKXlfrQd2C39dW7ntnRbIp9OtGy9pPBn/V2ASoi/2UJZfS+xuGLH8bnLuPlzdTNS6zdyk8Dt/h6sfOW5myxh1f+zf3zZ3MX/mO9cQPp5pOx967ZA6/pqHvclNfnUFF+rq+Vd7alKr6KWPcIDhpn6v2K6NlUu6LrKo8b/pYpU/Gazfvtwhn7tEOUuXht5rUJdSf6sLjYf0VTYDgwJ81yaqKTUYej/tbHckSRb/HZicwGJqh1mAHB/IuNs9dc9yuvF3D5Xocm3elWFdq5oEy70dYFit79yaLiNjPj5UUcVmZUVhQEhW5V2Z6Cm4HVH/R8qlamRYwBileuh07CbEce3TXa2JmXWBf+ozt319psboobeZhVnwhMZzOeQJzhpTDbP71Tv8HuZxxUI/+ma3XW6DFDDs4+qmpERwHGBd2edxwUKlODRdUWZ/g0GOezrbzOZauFMai4QU6GVHV6aPNBiBndHSsV4IzpvUiiYyg6OyyrL4Dj5q/Lw3N5kAwftEVl9rNd7Jk5PDij2hTH6wIXnsyXkKePxbmHYgC8A6an5Fob/KH5GtC0l4eFso+VpxedtJHdHpNm+Bvy4C79yVOkrZsLrQ3OHCeB0Ra+kBIRldUGlDCEmq2RwXnfyh6Dz+alk6eftI2n6sastRrGwbwszBeDRS/Fa/KwRJkCzTsLr/JCs5hOPE/MPLYdZ1F1fv7D+VmysX6NpOC8aU9F4Qs6HvDyUy9PvFGDKZ/P5101TYHFl8pjj6wm/qyS75etZhhfg0UEL4OYmHk6m6dO192AzoIyPSV9QedDA4Ml23rRbqxMPMxf7FJnDc5FTElVS/PyqgePzmwVZ26NWhRDQ+oaT7ly7ell4s3DypS1s0g+tOr7XHrrkZj9+x/mJBttrLx98lFIaRZzHz4aC7r52/JQ4VjHahY2/YVXZn/QC2ztQb/sY3uRlyc5vQS8nLPGT/n27495i8HPA152z7Fh5aFpyn1GPJKHuPL8Iw94DuW3KjkURAWZXn4EQy89xiKEHN1mk/tkM4gYDBxwNoYvRfE6LFqsxWJtPrDGbsnLMap3Ka3MUoytW0cvieozOmdERmhcqzG+3HmZv2yZeiIeQTKGdRT4HHNxekm1tY+/n06rGmFleqLscSERzctTKM6G9P0Pc1RmVvrascIxaO1CQCiYPE15bD7c3xSeW7gXxYjgxcrUlcbIvO0r+Yplhx0kTt3qafDOmFyMjgGxXu73rddMHpV1wMubyAGcf/v5dLr5P72Ta9lBF+fzMJrMycwv+9vnU3ANIl1cH9tfW7af8u0/HG0vV47jNFXzFTtaha1xvze/s8KMtCYucXc1nzfd/MQydUXn/b72RBt5wO/3jRcMH9BdhC/yctKBIveRYPrNpDWqBsO8VMmP+WvRaOcA4zRMR1PvSoO92rS7pYEv+fZfEfTMzEdM+6X5tLlyxExhqLRkms5EuLovLfx66de5fL2/yX02H52FPVwahrPqmN/E0oVXnsCKhbi/yRxX83nRbUKWhzYceXOntfuXn51NszJ6MO73pQf5Pl4in3ec4JU8hF7ppV34+mm9r1LY0ee/i1O1wpd8+zfLztE0cqBxggiBi5Bu95v9l3r9r/U5hweLn+TbfxowrWDqdJauKd8+q/dH8sbPkc9ttuyO94f7/XK/nHX46MPFLEb5qQlNPvhJ50/59t9ft3LXu7uVaWaO2bDrDCnRSzZyWvFKxO1+vT8MwwunR3bX0CkfPjqb4K9O19tn5X50PvmYpEwHtiW9WtzuV/s76B1zvLLNkViNd8ySxIl/3orfqP90TyTGaf7/rx8jQzeHJXdmh/N6YDvbvmTBwCdxfEQ1NcL6wNMdSIXNq7b1EUzRy1/Axsyk5p22GMG1b+GxFgbHErZh92wuvco0AuOLXct9hvw2nw/LqIcDRRmJmmZzcgUa7JpM/WV/S9IUfbF56TL2orzqwebdRD8nIYNJ41D/hz37Fo11p2Y21wzPcn713qVGhqtevStYfGH4n69OEJtPvbbLYWvscDqc3Hgnu166+tAyLnxrX0Y5zoYjV++1sI7t5kMr02KT/+uwtkc+rZLOf/qn/s3nYCf13Dg8/sB2diJgjGqjQ+TLhxbzyue2Ob7X6/9lUwW7a+lbznHzOYy8LKW1C/uRPbQY3KW/0gO9LXunHLvPL97afba9bFtc9hmz7GAttjVYlCvQAiOwAk/gC5+hkLEs6tr3AZKxLJtOEwk2dLxTYWsIB/j/ToWtIWzo906FrSG8iaqqqqqqiIiIiAgzMzMzNz+AyK+01/zi8n8S+Y1MjoRaQ80WU/G8MBlO+53VPXANrWm4wzGUVZUjjBJZVdhpcfkjsmcWaO+UEldXi1e+zq+HOsCpknYshuh8pOLISJun7TN0EIGW2xTnlOImeecnoGW4raxe2G1T3HEvfYUYMhG+gAFOAwh5nK8mZhwJMmN7r224QVsNFvZ87Z0qatvknklyPDK3Hy45PgVKXji52Wen4d4PlFVVYGnNap+fSpFbK90rYnhUc6n91Q3AY9E0tJOFrcfZtm/491XbcG/jsViUPPX76qmeuiz+qY1Hk7/1VPM405zWVuoheLUimpWYdVzCmUdKHebMdzgrYrb8mL2eeLSnRWHdonfZa8RsOU9F37w+591l5FLYHiOqWeHtE/lWrBHcRKp3uhtr8yXm8LU/5ms+NM6ZKsqu90cFZ4o58+k4rdrtB97NADFbwmEG7lXqvirhOTOqU14xuUF2myIjURcPHrPOQ4lmM3PeMg7bUuk0nnZi67bXsU6H8lhqIo8TaOrEafCO1ARK9PjC0QOoq2BxmMdgYB9G/lIb9++fqNJ2s7BHGFyBNmZAR8J3KCo012ikaSP8BCrf6VI0X5xdnbhHIO+B5rbOyB54zXkzfObyJ4ecwxfqBJMLFc7m59rNcw7hoHnFZ0b00zee+gTqvjm61Pb4xn0kcDX4jvHM0rBXZypG3DCKnD/Waa/ZtHmtFPgO5eETx+k7RrVg3aSwm2YoNXnCs3XPQDhNn+Fia6IlOOuIG6VJH7TP6ava26ehKHQa2T4N0tcZ9dPCGo3ZdnNltsHQbeYt5vPnJezV/cAeNypdml1vCHI8M81nSRP5Qi2+mI8v/sxiZru9187nRtp3f/42NemcONa+4eVC3PCZzc88aZh851CqSsshe70uPxeN/dmYwlwb3trwMrN1Gq8jbnApcVDx/yDPeYs5/7r62tsQ6lLg+DiFXTEhzR9dHqv0iT4tgj825W+H3XiRUNUZT2kR9Ri0+lp+UM3iQtS8uOE23Ly4KYtvqH13jghUntJRAewuzNLDXp8RxdcaA3cMY6TO2IeSFRXezeWIjCqyhsUdMYuCgYTZSKpBype1zRfq8FshvfBPc6BAQWl7/QxIDp3VGo1J3vn42OEs3qznws+YLRXbymyB19a9XBx6n/owcyxlEYyFWCi+kG9F+EyD/4yn80+agaZ9P7ay2Dny99aK2o91FkfEOY8hBwyfi5uwx2y5SaHmG+oq/zl1FX/8irOf8Y3vAcX/6uLP6A6nvMO24edSGPjQc827Rw2atX+z2bKq0CmW9mOtYnr5/AfDa1ZfPaXnKtlWborup7QYx+Or2uWb+N3N//2+yDcXMqIJdf55xl7/vsj4WoPPlxLxtVrkJ4w/tTe3mLdATOOYwxcq52w5Wxz5MbPdVs5O8/lhfE7dPj0bIiPQ3QV0iqm4m3YX8hRfc6jQ3fWepevMqUDJd86Z4vwM40CWHnn+WphsGHfieF02D3tmZvpWD+kBpNCFcLnZhcmmrhpGzzbdA+sQ1ar18OJD87IOKOFoRNznaHPNHUfUNhvY1iU+uhvEvpKHaUn3qK3exVVyX4joipp3um7FmYJWmA+WbIDshRpbVRx5/nqstCgy87FGbfVB8yDGCqS+2qCsnRwnSAN6zgzxfdB2nBT/vZ4/6uxb6oH8b4VBRxiIB93wLa47hG3w2SL/2Z27yOXJFwZpSJaBYyvajA7vRRYNKqljXKpt/CFD/tSMr18DKKbwB0xggBePatl1nki0yvqW5zchlyZmJ0OTxJ3D+fsYJs/mxYN5+Le5oagtcl+YsVvy8kSjI2YGvGjvmpkRS9W2dtXqWnVuxUhURm1lKtou/hdEq19VBp9OjGvHEQSmrpuf2R24mXGheil8KeiANY8fW1VERUfBImb64j12caBZmRViZHbeVMjCrPDg9A90IXrtnsYCuZtRQ0PyrKDjBNOsPfKsg1pA02gHlVr0OXiFhtp6nJqXVzcbfM0KnzC3ggOENPE9VBdmHKN6LYaijb4wXxJn5A0FSDF5j+h1ooZx885Jt3ZKzO5n7Z5WfNEOtyyPqQEnn7WLv5Fis3PdgMshjF1FRydbNyeBbyKI1oN1TRVrVK7kgsb/zjX4NDPIRMctVeaxVB38Vh1x5KbeJbU138AM5KzmZu3uny0ErygxiJF7GVXUrPzFxrlx1uFdAaZFDN9cvIb74qD9tzBMo7L7WIEYK+sla1DVMHpF0F7b3+Y6S+zjvLeDMCpapmJo1weBWuxKF3rOocih1gun4BoJh1kWnV/Jmiq6uOhK3VfKxEHEkafjLgK3oujaPzY6SXg8phhL4TNR1xvJd1Wa0aYFfPUMLrNBDCh4AuGRTbtKMc6Z1Udj8evY/ZpCuMAUefdo69DZUngoqE1P9A3PJfOf7WixCEj+Y6t7fYeHbbxUAoFV3M89cCKfma3fc1+jKRe7MFWEbQqEfyzO2x/wrO2VYH7iYdQ9BkPyI8/3kXBpLaCpU7eC0Yv/am/tEDu7HZpqg0EvHo0nf/R/gRzUWy33/HXMJQeu1GylKmOkXzlCfGFruAcPPhaGqZOtu19zsJ1SO2Jz4Ztth5cBX6mRQwWmDwryG9FUMlZzNckMdK+IoMJv1rOWnBamS2w2KHiaPMPLC15hCZm4KTpoZyj4E2TqC/P6r7/EhnDMhKicZZ1ZwxuC7DPzDGs53q8gXaI9kFTK+2LTq7bhwsTbrMV8Rsfua5lMS0FwbTitUVnVa1yTb5IX51mmYnUcP9wPr8Ji1tiYJeJV9GZTrQhF7vvdU2OTU42ogJ9FDwhmycI2LIg++03C6scYhUyUuMV5tkw6kGUoL+mjNC38+wMdWNljn6tGPpRES7veqrSn5TRuv+dh6JVL/iDHU1db4c9WK3++OrH3PqziF916UMUKn8G67nN60GfWiHrXYhUG3yVWmyYak59NHj8t1smG4UDiWz2rPHNrKnN4Zo1LBbr2/eF9YZ0n0blx2nG4X+EKFxvS3W28JESD+FWk61VCD3z/URGHiJl++7TdBwkCj6tGOH3qDb0QqcOF9Kzpj0HUb/KyFW3Yhj2VMKJqGZleFBH7vqvf7WqLC3XMuHV8q8a4sTFuxUtkD/6JIBvKaVjv96ndgruKZ1k/BHzqf2K9fLk7HGXANyLDd1vxkK/i055pnzl+zw6zLnwXlVYVtfmacJgEpRP1hbGgrYPVN6v2lG+idQNGmwcKXu/8xEj/P6qe/sB2WmwNp6pp8jaISMkwdleFXYK55NHWLTTbutSUqjBfDGWo/Yg918qQ+8BRZSAHZbfuNZz2O0sov1Ue4CWlVg3rFhM3Kljj9ksGd/NUhk4nH+a5UN2+1i8+NM3vRNp7uQ6sqexSCukEVlVZriHNqFi5rLm9TMWa4qm3idJqppQACol2l4VSuvWLfta4JcXy3bROPNbXOgdOhG47LC0CwW/dMlSx4Jf17aEU3yA1x9p+Yc0jupXgcMuYNku64iYOkGToVDuJvlbEKlJqsmiHbvNrIVZEH+yFdF8DbleZ6iNiWwMqvtMp/mSpwx5KxRrT9p3MAPTHGtMbfvdFhyj9vhaKcn3At8Lc16Ai+vBcSp1ztXi7rCJZx/ql7TXcclq6Q76UeKWDy9boS0WHIjUuWhPG8LBmW5y2rhuTpM5vsLt+HOLh1Yf0DqXa9tsfC+kaKt2htA0ai/L2i7RKoNjEwztkmRU0GfgW1TxUvPFhg0V7DdfWJk5gfrccpYv+MA9M0dkGTLECeYwUixRzjRFdmjG7zdZIl3XKB9YliNKI31lfa7i2JG5C8Ss+rHe0D7Z696/V3DEAOWHnQ9yNahMUl5kENWS6pHKKp2D1BaSrrHdE1w2qNxIztpXgUIrF0bm15YML4b6V1k+GpNysTahKMVrrS85lTVo9OGJ96I47eAy5rYWpRf/mIzeoYU1DKaQCTUVwrhHeyNoDqHel+lLxr9WKzhSYw7vrR6+V5q0pfi2k3L1zqkubY6rrd9ZLvSuWNf0uqnkY+FpTvFzSW9Fp0b9l8JA7THV9eCi/PY/SCZIUYx3BU2alj7Cm3VV6eYpios4b6WuNOJdYXUK3zTqj5CVG2FqYM4Z7CuIU0qO05XR0d71FHM0YhZmJmTRfLlXEumN82BGtzdX0S19t1e+bUieK8zRmqpa4Qc5TSjifmaQsY2ETLjhI36gMR1+7qpjdXXHiceUekfBaucHShAOiFXmv3sNmGQyU5iVgnoocuonQXEPTFwslHtS8R+A47StI9wj0iSrtbi5rMysczFiImsQ+bdFClnFjjpXXwMy6O7qfjOr8Fb0a7ODItisjnn3EQO16+ypd1cwyaAW5Yzxz5QknfMO7643fXW/I9y3U2xH27Oapqr56Z/tEzglj6IbT6HEHjopiXqeRbe5mQQvxtcbDOVverN0ZgMdzqRYRjaXtMRd56Q4cZSmdPvZJdSrhJ1D9zNXPqAEqPIavPdfubt5oke2kmv0dztIszSv2VYuoyf1UuopbsYb+uX9h6WpwjpgtZ6fNNawNJ4q8O3CFoSbioAaOSZMx2GYaPYB+rEb6qjQiNRFQ76TvwNFVKD+BhH9VhcKGsXzmMI7BptU/CNWolM7YzROvpFAntsiWJp6eR2d3GarcYShVYSUqhmYOWj5E96NK2WvmYNTeY7Zs4RUEdv9h9QT4EseKt6LzLrqEOs3hxAY1MaNWpSa6zZx8F3YOVeCYMS88W+CYHDuWe4yoc6YK+djDuEOrBR5lvh0r+Q9uM88lrjx9x9AtgpQVNE8r+3O6Gvw59D+kBF/UMXyhliYUtPjmvXGY6Dk3x+kEOW+GtdMVC4EZTqoS/jmR0P0LS75DOc/w2vnri97M4SdbZ8qeU7gg8DVbERkU5geaMQO3mYrSYyAngeUQqrN0C0/vsFmcgWNXNeidsTAj7/4MncJR0caaBUpbLK1yBCBNRjEv6KvuVSdpPnEMJdsRRtqJ+U8tN1gXA4ePHc6ZT0eviI73UOJF0fEZ8YaneAQqQdGphNvwM4nIqPnXxV0xA0fnCT+oAhJuyw/q8jO0y8CjSteZExwBpIN6SvNp6A5G/abi6egeND/1GTguhuNjaUbbnSbGd4L8937Ezm34Eyi6n1maeOBxh3PI0jzJDf5mh/BsLD7F2GOKvlA/5gtvxI3/eV4sLfKW5Wy+oio+es/u6T8UU+nsofy57Icb/JlZHPFtCgd/x+bwt3ZT+xXTtTtTrGAb4QehC6X9G+8YT+ozcLxDsdCjsuOqwPFnrdLYaFc92Ui0m4fr39lYmlCaqTit7G6O/3kWDkgtXjNH4BiEm/+jegQnihOtfffn33WxsFjhfMd48HT+f6o6X65j7XR8WLSHMFkxbvOYsrRsF1bowDuSQ18Mkxk4qz2zoGPL5fu9h2Hqmt1asl3Q3Yu3szOc+spiCmX4AETBM3pLoTYSp3sVxahyhL8eC4mPN9k2x3o0xkiixIzM3CZFzf5oR4mecQ5+ax2wCah3/crmnHoqR0+KMaOPxRif1oEFRFOO/kTPPmtww+NfMXxEK6gn6iU32U6fFruIz8Q4WgljtnaCVTBgWx7diUdshC9ZEa5yKpRBBeW12r/iNc/+EgNqmhswNB8SBoihHXeDF7rrWDLcmt3V8GYYN7pXRy4DZjj4DJuUBL5iC3DQAaoo4vkftqVTYRGLS3mHZ7gdmdTTqbgNN/PTdTCOTgXolc88MhXAEUMdX0iy1JMuk5wLsgeu0QUYlz2S4skTWwJz6pOm/8ihrmgGfFgri+ZWUK2gAPHgbWa8jaocdSuM4FJYoKicYX/ZSENkg9Q1ZzJfwScfVnR2DegOGwCvmogaWJCLQepv9WNlU6QgsmOwICquU28Mlk3d9W5E81lU/5Ez0LcX6lwKMWDNluNKfBDUy/phJgBcMnfkh9iRxrdOzgs08JdPB85Lwo+GUSb4t3nC+0byqMZtO2fQJ4U2zGIr49t/28qmmGv2RanDD7a3FEcdtutkW8twwwlUSpb8QalodddbBfNHKDQ828BdE7OBgFdiKYohLawFYqpybQoxATZrheLhdI7+0Zlu9Q1myRcd15r9UIm8K2LGJxqTegntqNVMKnf1a8zQiyUR1rxoqjiFxeHxqFcYUTHfDu7rhbWng6qOxOsI+5A1p9mRyEPdVkTlE24vY54W7bWc6jMgZvNXdfC9/9q7408KDsbdL7Utz7QFSDetz2picArzrdpL8OaCHC9V26RroemtDZ5yNM/KGkWMyTmfnInEvwtSD23UcFcjhaE3VKzkoaEMKGBft4XbIO6forTY1lmGQwVmKicBCiArDzE+1oIxE08fWeviIOD5TznqH+OoHadvoOP20drMPe5Irg3XBQziW2XDuHYzjqQQ4wySssjXUs5H+t3FWYMHppUnBHMx/nYIT5d7OmjDbgD9F6na3m4l7KdkeSO3kTEPXafiWinogag7b52taiZhL1TSvBFmEZafFq2H8khQaZXuitCewT5FBgVtPK0j4xUHPfUz3Q28eac1Z139DAP23dgki94EC8vbDPTQC97HPPSWjUNG5tWKMsaxAEMKC0665Xvo1Ntd07wCLNf8Q56mrEPVpCxlIMVlQlWRxM3oAfpgIc+8KC3rEXUog5g06vt7zgXY8grH7hhwVSaeuvC06YYRAwpbyk/Unzj9hLEZNs2oxPQB9yc+GnL6zTgq7rI++KDJwX2SP8Sd6YzTuw5lV/kU6eQxRD12omfQAW6caTR4LikYkBB1CMOrvgRr/VY75+NSB40Cni6bADAtaK+vyxVWpf9NeKJxN2KYQ8Q2xPB3K1s7fuhvWbr2XpgW044VD6DRs0qXoqKf1NFsaGvKJc47leUV3pppP/5VTKFhaGuol4Esfjf5zyCyUHmHthChcYh4hYLQF+AFWsuq4t0wJyWgdwQVOZiV0efRHPoK5+E1vjz9wTJmVkITC9oEstAsyZSgE/dbicwKr89YUxKZI+owD205Tm5lnnmDRuP/JnzxX3gMtlrcX0UesZdxyQqYQuEW4R51vmQ5xOZteUd8SJruMlTUzhtVw/Nq7eUBcqN2/HVotgfngif60yKEtoUx3WYOZlVJuJOh8u59fzSDPFYtQgqDUAGyGhQOAvKroXMcOYY0qjnStJR/G3aP+Jt1sLVlGV8POwr/6OGsqetnyF3TmTqZjENfnXh51oxe9qVUw2M78EzAJ+IM8lZ1MBPQ9ZWSVc4J3mWSrLKrMHReA5qdGoz0ODRsaA+vwxXA2cAM4qlfzBJA6581m4hzxItQw5dxrrBL3Y6kCbUcFxo1S8jyV44q//+7ASNNudZ6xeaNOSIUffqMn4A9lIjFctYn2gpEPAb3f7p3iIBN8H14FUGQ9ct2hPsL+cEsTgUrR47uJVN4n4wt/wgfwwHuOnLd4yobkofy8JvxSQTA7rMpDIc608SlZFJfZYcmbT0tAHpPE8MrtQ42siTUNWxqvWZOmvu9f0JPoQmg+6l7sZWwyfi6PXkxJnwBraUG0MYG4zYHQz3igy/XsFkx5tNQxw43qvI9dU3f0DdhOUlHKjmi1VAr2Kiy0HZwD8VeEbhh0OiDdMYspolQsYdSwjCcjeowIXNZVUPmL2wwIkYhmXKhGozdCJ4lRKbsf4NBh/XnQoS92NJEWOVOFs2YhN8c5QZFeK0pRdAG40hqvLbmoSA8xQmzOOEc7wLcme9JOsjPCEgpCwUs9E2DohMHRhUeyGIN6TFvrbny8nDuilsDpzrH5mS76APoIEJmItS67sQJ+nfwddzmjPxcBEBBCw0kWDwd0EZCkNeOD7NNQhtBm7KHL9mRxj6U1yWU2puzlIDtpYxdH4ZPeXBJkTGAJfUr/oTCz/iypY6uXaR2V1doPxJYlrw2ghH0D5gbrhFcIxzYwi4a/4hqVdf2DdxBp6vGYDjavxMAAoy+1+3aiO6S3W/QAKNVXagDtvsNtx7Ks+HKgo6U21B+QSZgIogV5Bt+BnXisdVfy9VyXV+2P5fMuvdpAjM1o/K9Z+XnE4EOCrue+kcdYHqAQ0/Y/OmNlQ6OI33jH/uD1RalPaHpJAm2av0/xtpqdXVKNDrc9F2izo23Wu7firgbURFDNX9eGGeYBhiypyXZft2j3hTvzE6PMWKsod//rEILDkzBXfi7xh0eFkfb3/1zzPK/PI5Nk3FbZyTl4mq5BfBoVoqiPHO4Q4QKZAlrQ3MdNfi3oxIjvsM3kAFv3fdufurqYR3PSwX/mpGy/GFI/B2MNPiNdOppWVbs/gjF3YH+QA9jMhlAbhvasAHstB0IJew09iAkmXHl1/TEj+jvHOpOGrPRQXbPADM+Ig2/OEcUcpgPTItMtW4DdqgfYVI/+4hAFWYjUGpOP/UwNuB7+BbKOcALbjobdgzeBQfjgNSp2GOpxzGLj70Vvq5cw2AoYENwKLUtJUX8sGRox4dVa/TN4xKwaKcl9XawQR/uNus700Hf17pyNnezrUgaY9e4MADhEDBpsJT6y1gDJs1q6wlwGhuUzGR7C8kgpjPyHWwsvrf3yn1zJEIRa5eSxoLAZOCR9xbuztxFRJW9ZmMYfCFJ0evm9F2fVnuje92Rc4Pl6A8bluN8MZyyJGZ0+sNSb//DvAFxC2BqlEsFwccWeAl6CyBcQV1bx4mQMBP1Jxqk1EUADNLeieS2dUFbQ/c/kvwItbZ7tx0st16viqd53WsRmPTKv2AD8CUnhtPWg5aUegNpsYgasaw2+EVooeNKmrW3MFtj76bYHJm5K9gpAXZXsE5U8DM8XmVOSJ1F1WnLy6nQup+jx52bAb+rCq6y9WXl2B2oZDhfDkW7H3oYfT/4xx5VncBuxMXP2lNfhUVQjSSzSRbuZFE4vFawlzveXxaYKVs8LpvAb8IRYF3ZHiRnm0ADeNPWocwxSzNseG7NrSEVZoHdKWqaGEBz1N8Pt7kFbqh3LYmAbm9i1IChIpLpM5AS6mr6OAPHMwwznVy61YpBYX8xZDN/a+lt7n+x5j4bNOVteZ8lj3hpAHSx1VR8vZHec4AHO9XFCdjZ9eRkSV65ljMmZVzaej2qFn/qt1lvWzNZEfHxK3qOJrHL6crr0CRzMox5f2e8ALBB4UGFZKA3tN6F6IXd32GTJXGQ7DTi9j/dNcLF9jCbDcWGKxoKTYblIwbLDReL00LRcDPMcQuXLMh5YzgtfjkFK1DP1iDzzYYVZz5M/kWYRlRpig1htVRjVCknm+h1M5LiEDXOyHREhvzCGpFZjHS0RsK27o2avgdilrJkalWqPW3D9gmwV37HKmfM3F8YZj2ar+vHFvf3B8CRoH4kDHIK9mrAg+owiEwNjjd9V+FsQKYR8czJrUkf7Qoi2YaW6EVDZp5zYlqiYtuXOTHk4fAcZ7qBbdLDiJq0WNV1l2+Hntk1mMWvxrYmc8kIx8G3rW36J6Ra4lLrTOCgiOihmow+YnzUT19jbV2B3RWqSHyxkhmgsBqMYWvOcUom1jDQ436+fcbu3xf2bbeqU/ca+C4DOKE+e3qvmeMqW3AxejfzBRFVcwVYPq4L0APSWWoJu+5UYX4qg5U6YTioqQGPG9XrnuZ/BkxuYpe6Li87+18EskyQW/uA+uk2rpHpr6hut2TlVbKgWkFpx+AZffweiw2+VittkEyf/ifinS/0ItRL2Jq3tQOcxPaWO2xrG68GdFoUpZgFXaP2wYVtRc6xYCfI1CaBqyWpg4bx8OHBQwsV4XWMibZZ0LYjWEy2IxQ1mZrf1/UNbYCJplWu3nZ4WpodIGVA05d+RWSS+ET9tH3RfGGmNI1cIY7evZZq7o+a0bjjygpmR3mVfalkT/SZGT27Q8QGalwGlDOS9VHCyFAIL0a1Q7JiW3saz9gqY8lqKynFrPCzxkU4SIfLc9VfCI5edgRhDXs0edO992nhTKHriREP1NJC6SROMgQ0xO5kNNZOhMOIT99AUElbxqeZF8A3xrfDJsWtDnUenAHdYWSwAbYjFqQZ+D5gi3hNK8CSxU9i6f6ClL9IGlj1OPMQAsr84YG6ijsJpCaGWj75c3yOZKBB9mNpQNPUKkK0D6wgLH8MGoyRxTX6Y05Q4AnYNXMZwXM4eij/9WpsM/9CoRnFQXGR6MEaY+FXvXEO3RO0JaStk6OXuHVATHJE+1W+TU3bSZ2ksMtqjO0zfSJCdBv7y2d8DMx6TfVme3q0ZpTKMMu4YL/t7ciTNtdDkwPogh3Cnjx7qk08SHwf+dksZ7M2vCOlfsF0hQ6J4ehPCaHTNrM/zBSOqD83dBEBCW/F/LEmeh0nOHd7oVl3/Qo/9GUDkkbj7yz+9cvvu+dDAtx8NzCDTP4iKdZvk9MWiizvtILLepysflSvTLFBZ37RLwiriqyRxYv/zrgFd/9XVHh/OmzBvDX4mitMR/lUavs2Vx6cR94lzAkplm3IRNy4TFfu47tuYs9EQPIPVta4P64tV+sZ7n3ued3cgEx2YK+QL5+xms6osk8qQbTyuKVGdaX9FQqk6qfDnT5ykxk0VK7KZ62b6DNDUfQlqGHxSMKv1P0XN5BqMeKG1P4Wp5QfZDUCEldppoX0U6ss2jIko2XpURKCIhfaOqLPfShdtS37ZrT+jFRSH2xYVV1rmT/MBtRQhxiO4MQ3iAGlaZi+9PWBEIXOVnu9jN1f921lWLZky9bqbM3J2MAAI9jmuAx3gyoEUa6P2ivs0EeNv/OR+AX6q5SW6l5HaoFuS6jr6yg9limu+P0KYKzfMXWcQSfTXzpOzKEKpwI3YGXZpSSy2LTlMgfmFA3CF6R5c9xWEtRuCg2ZPUQ2Nb6dRFTNd4TfGHrnEWSKHPuRyiJSDAZ+KX0VxmSHjGPbQTLVpqixia2uyhQ394gBMt7C3ZAmxn/DJS+l1fBsAo2Eir/C0jG9csd4+/tp12pPc/BVJGaK9mfvr7M/CeztrmCO5qY06Edi4xAGtiEhnWAbzLy2VEyazE1J5nPmgU4RpW4Sa0TnOT6w5lgt3/tMpROigHHmexBGAMY0mdcDbDxWIz41NgdD6oxgHsJRgr5RnT6wZAkTOcStU4NMOQNemSO7gxGahdEsC+NRVGxMUhQmmM0llWRbbmFGHzEqLM4Iw0H7577Kyo+Zf+2cUFIOw93gEY171vQaM0HLwpjpdRR6Jz7V0ckE7XzYJ0TmY9znLdzkva0vNrAGGT5SUZ5uaHDkcGvI0ySpwkasEgZPMseYcu85w8HPdSNi+4T6A83iAwDbxgeFcB1ZM2iGXzFcEOUlYVrEckaOyodfvaYSQ7GuB4ISE0nYJc15X/1ciDTPbPCgYJK55VkEor4LvzL9S2WDy4xj+6FOqVyTAC2ZNowheeeSI5hA/02l8UYkv4nk9iaVn+kCVEUstgk5Hyq+gJm6R9vG3rhuM904he/hFmNQaUIATB1y3vw+OmxP4X5Yi6A5I5jJufHCjF9+AGNwnEllZjUco6XhsO5T5+R3yxz5yLVOnAn0zuS+6zdj0nTJbEZCbXJdtpfYZfCeCOqJHoE2vPPFS6eRLjIJlG69X93nfR0mxSFXzp1Zc0lt/VafDaImhUMtbnqWVb9M4nGNQLN68BHP7AR8Il9dkcxzmBv8PCZlw9guY0lurbBsmNYlwJZsA/B15/HfkbjbwPddaVecls/elmDHNW2r4crAx43feNkfRwsaNq/yyJ0d/p5hZ6AZajz7DBfUok0ZU62gCzz7x8eVfJTKA8IWn45vINLSM1q+HF9CV9qF3zP6Ml21kPPL3CXzkuYUlnSqT+Ij4tI/od5KwIs+tDajDs64owN7tOAd6eucGz+KfO26iNcBFpbWA5732bBNWO4kHNpr9D955L61bvHCF/mwSrz6eQaDjfDEANqGMkFc+NGxpKZzCD2sj/JrHd+zlPQ8Iz7Q+2JVIiVCuCKoK/hlAEHzvk/Piq3mRL1rT/fEh9hoT5GJmeYswg1otiKydizJ/fS2SeKHVu6Z3JEHjiW8NaTQgP5xdBli8nC57XiN9hrquBu99hn9zqwo92+PM2JXtpeVZS0PdqR5mDyDreMMtEws+CpwaRyyzoYtfcvt9PJIW0fJVNNi/FFyRsea7peLvJrL+5b4GOXJ8tAr+ATk9f8KmiIsRhqRy0vFzwRV3Z5dZ3QqIU8JQ/uQpkJbjMUMFj2F9sCFeaBjI4+fL/oN3+LQgjI4zuAfQ+3IPIPFQBccf0clJpsfpnBxD84atwtupkGqKvrH7cGNl/QcWcSi6wcVDML6ljOgYbo+2BOAWNNjlUBPiyitUAwbnhFvLbnqw42kR3Yp2kv2dMeDdcGOX5kT4S6M44KHEB/SpCfl7xgsUvs+JNY9G3O2X/6FEt9FyAn57lrbiu+tl83sCymSvq9eZbe9mchL7MTf/Ta78e80zSf0hYY5eUU7+ff14jv7Xy8qjzfzzzvaJnrIdvFb5BLWKcWGy5/w7+vV2cvIfwHqdTB+RuJK5oj9mbt0Hy94AmjMjjwYNZlNS6uiyxNnwNyt3gdreLb64p/3+08nXkb92LTkkRgFOwk1oGEVllcOj5lv1hfAZywDows0944U8vUFw+A/nuVq/UCygsrmWIBnHyU01d0XJPwriEOvx/ISK6Pk4y2w0gmojZs7lU8TtakBAdne4v/aNxmMpK4VcGMp7si0yqsiolXRuOi1Z1P7SqD3Zmp0CWcyK4Ubmp2SXiXuI5nGLCieFHKHNRIlcY3Pys2dwMTYCaqlyWSITwr2oGXvyU3h1Pf8eQ3w1bnD7ilocVjYDkcXR3Oo1BXgMLTUjNw2xMVwjtp99NhSVc5aIWrDQT5DHPKtCtheBP4zHcw4dz2eRdTMamhlHhtfgqJJHI7NGDUw1XL8vsSeSHyKqDtqoAmrQqsYwvwi7HW3ojWyhIa5oz5xJTaq14NAzFLjVLR12rRNUQ6xohDnrWFb5bG9yf8aCD8d5phoackcNJp+Dw3Due3RM+5Rid7EuIgsnwgpX0rUWh/nqPtByMhMZZ69NpgvRTKZ62ViZ+Q7Dp5r4K0d7EfJuiy06KuIYauRh5Ecrhdt2QpTS1k1AscEHvapNbU3HL1F2TFyR33Wxb5MvH5iZsrn3SDcsxlnnshO8PLwmdGN+paWnQuORtZGX37uhFT64SeuPsx8UOokY6ON85WdQ1dki5zErsJGazcBOddWJEKqNPiJpsMD1GrVLrVY+AOdPWQneTyyP1hRX/lMM4ZogGGOhYuAdr7F/DOiAoc++cn5vlf0zkMUJ40Z1rlgv9BelPqVOpxKeOpzKdF8maK+1Vv23MO9k/8+qpLoxrIGH2EDQlnGmH8CD31G8QqlyQIcpmR5bwmSVw9/Ns6IHgulCRehvZ/+VrM60Cu/r3AontFfrljew74skYe2uyn7JKQtFQBQRJ9ryGic/zQOsbS4scUBctA8cPToQ3x6ZBQu6DPu5m1bnCtP8TllLYA0UTQNVqza5nfew3Mopy1GPUwG5jsl0OVXniPmAcmLqO5HG8Hv3nSLecE9oOjPDXcsTxoCBxYyzBdj4wmnyEV4kvFDunipS8SSkvdaMnTBN9brHUR8xdmmEAp/Pdqk9uextp1t+JrtXwpN/MG2w/qhRMpSNxQ1uhg/kKO30eQ/FyHUDkWHT8V6gGRU4DhDMxZu7xXij9Ui6jlpWmQCqJg3FkOTq3WKneCRYZxBXMNAVLQgHXSCGSqNdjebY94oyIpVjMYehAiFx/tqzBXFHZaL5PeeD74rW5OysFoUXY8sebUZleFTUa/+zBKVTFDopTReXNuZq47QjkWnxjirCommO4L/GrFtVV21EpMyw8wyThL5Y59d88xtlx1g1ttSICDwnof6lt/6zliPzgVUL8jWBjC0o2D6Kg+jNuThkAlaDJsq/AG2aKA//A76avw2KNqtv223P+Wq3StRDDNKFFgtsFukYt1GFDWooFVXitaNhb3RCyJi4cMeNjROiPEDb4k+G3+hD8tsg+5hhmSc/8t2JTSwYoCzAI75doq8QTHe+E/Tw0RQSUDlU+6uBeNN3h6jJGX/mH8oj0i3caCNsjvTnoh73BtyZpsflHLq6AfwJNCDX4S98h4+pCOhGKDhV3rtkKHMa3EG4J9y8zFWI4UsfNzC/Rl5midNn7gwoN9j23HGCQQ+OAZpTTPMdiVow740gIyuEtd0qVxMyNXhHcnuXRKdw5wDUSL358ktjMXmAkvIB73BLa1vfF9BAUZInPYJiwxqFWQQBVk7gQH4ojfUQ/KEjn+A/WR6EEe4CtbpoLe1mzHkajgTIoE0SLDHVauKhrq12zrAXBGbPPWKCt4DGedq3JyGRbmPFW32bE7T20+73BatV/qQhhBWfWBFHfhYWXjALts38FemnoT+9bn1jDBMcUMmYgSc0e7GQjv2MUBwLU8ionCpgV+Qrhg7iUIfUY6JFxR0Y+ZTCPM+rVuq0GNLyJXX6nrUTt8HzFBRY1E/FIm2EeVA9NcXrj7S6YYIChVQCWr/m2fYUjC4j0XLkzZ8GCSLfmkW3PB/xq+nlXsKVBOj7vTvqKCOMq7Ztqr3cQ+N8gBnPaAps+oGwWOkbuxnRYj/x/WjiDclVrs22xMK4qArE1Ztk1456kiJriw6abkNeRHogaPRBgbgF9Z8i/tbzWELN4CvbqtrqV9TtGSnmPS2F9kqOIBaazHYaJ9bi3AoDBvlZasMluxt0BDXfhp02Jn411aVt6S4TUB8ZgFDkI6TP6gwPY85w+oUQSsjIeXVminrwIdK2ZAawb8Se6XOJbOaliQxHSrnAeONDLuCnFejIbp4YDtBcQCwMsYiRZfHefuEJqJcwKTTJ8sx5hjHmJI1sPFHOr6W9AhZ2NAod38mnLQk1gOz2LCAohoQbgMbUK9RMEA3LkiF7Sr9tLZp6lkciIGhE2V546w3Mam53VtVkGbB9w0Yk2XiRnCmbpxmHr2k4eSC0RuNbjNsUfDIfc8DZvRvgUDe1IlKdZTzcT4ZGEb53dp8VtsoZlyXzLHOdAbsp1LPTVaHvLA0GYDFMbAW/WUBfUAdHwqLFAV+3uHvYWrCfhUOR2i89qvCBoOb48usAGdcF2M4aKn79k/43WzBZ+xR1L0uZfia70XP9soQReeuhZiUnXFDG1T8/OXNmssTSnYO+3kVLAgeiY719uDwL9FQycgLPessNihMZbAKG7qwPZyG11G1+ZA3jAX2yddpYfmaKBlmfcK/V0mwIRUDC0nJSOPUl2KB8h13F4dlVZiRhdGY5farwN+f9hEb1cRi41ZcGDn6Xe9MMSTOY81ULJyXIHSWFIQHstVYLiJEiUjktlHiGjntN5/btB8Fu+vp28zl2fZXN+dJDyN6EXhS+0yzqpl/LSJNEUVxmu7BsNdjAY0jVsAhkNuuY0E1G48ej25mSt+00yPbQ4SRCVkIwb6ISvYtmJRPz9Zt5dk76blf+lJwAPH5KDF+vHAmACLoCdG2Adii6dOHnNJnTmZtoOGO8Q1jy1veMw6gbLFToQmfJa7nT7Al89mRbRkZZQxJTKgK5Kc9INzmTJFp0tpAPzNmyL/F08bX3nhCumM/cR/2RPn9emZ3VljokttZD1zVWXlUIqEU7SLk5I0lFRU0AcENXBYazNaVzsVHA/sD3o9hm42wbHIRb/BBQTKzAi8s3+bMtpOOZgLdQzCYPfX3UUxKd1WYVkGH7lh/RBBgMZZwXzU9+GYxdBqlGs0LP+DZ5g2BWNh6FAcR944B+K/JTWI3t9YyVyRhlP4CCoUk/mmF7+r2pilVBjxXBHFaBfBtr9hbVn2zDuI0kEOG3kBx8CGdPOjX1ph1POOZJUO1JEGG0jzUy2tK4X0CgVNYhmkqqQysRNtKuPdCJqK3WW57kaV17vXgiyPrl4KEEWgiGF1euI4QkSFHFf0TDroQiLNKJiLbdhH0YBhriRNCHPxSqJmNNoketaioohqMglh6wLtEGWSM1EZbQg72h0UJAIPVFCAJOThpQGGdKfFovcwEeiBuZHN2Ob4uVM7+gwZLz1D9E7ta4RmMZ24OBBAg7Eh6dLXGofZ4U2TFOCQMKjwhVckjrydRS+YaqCw1kYt6UexuzbNEDyYLTZnrY1PzsHZJT4U+awO2xlqTSYu6n/U29O2wPXgGOEKDMSq+zTUtyc8+6iLp0ivav4FKx+xxVy4FxhIF/pucVDqpsVe2jFOfdZhTzLz2QjtzvsTCvDPU7bzDH2eXVKUV9TZ+qFtaSSxnYgYdXKwVreIgvWhT9eGDB2OvnWyPLfIIIfNnfIxU8nW7MbcH05nhlsYtaW9EZRsxWcKdEqInq1DiZPKCz7iGmAU9/ccnnQud2pNgIGFYOTAWjhIrd63aPDgfj8/sdlD4l+UTlcxTI9jbaMqqN0gQxSHs60IAcW3cH4p3V1aSciTKB29L1tz2eUQhRiTgTvmqc+sGtBNh4ky0mQJGsdycBREP+fAaSs1EREDVo5gvgi5+aCN7NECw30owbCc1mSpjiahyNVwJd1jiGgzSwfTpzf2c5XJvG/g1n0fH88KHNnf+u7ZiRMlXueSIsloJBUtW9ezvsx9grfsX/FNxnbxU1Lvg0hLxixypHKGFAaPu0xCD8oDTeFSyfRT6s8109GMUZL8m2xXp8X2dpPCWWdX84iga4BrTlOfqox4shqEgh/Ht4qRst52cA1xOIUuOxgfUivp6v5f8IVyaryEdpVk72ERAwdT4aoY1usBgmP+0m06Q216H/nubtNYxHaOIYjcach3A8Ez/zc0KcShhel0HCYjFsA0FjYqyJ5ZUH1aZw3+zWC0hLpM6GDfcAdn9fq2orPmZbW6XXrf+Krc9RtvII5jeD3dFoT1KwZJwxfUMvc5KLfn8rROW23Jw89sJ2a5dpB3qWDUBWF2iX8OCuKprHosJ2mflBR+Wqs86VvgI/XMnsqb97+VlKdPVysczPj8Jhzf+WCvGBHijAqYlavbF60soMWlHbvKT+ScvhprgeTln51xX0sF+Eadc/l2s2a5BgkVbHYyz0E85p0LstqH+gEGiR84nBRRFIn8hLSZrGwqjZ3E29cuGi+5Z5bp7EM8MWFa9ssS/vy4VrDfECSv7DSU84DaP0sXI3Ap4lWznQ65nQoTKRWU30gd7Nn8ZowUvGIx4aqyXGwmA/PB4qN8msJUODezUHEl0VP9uo+cZ8vPFodSIB4C7lQYjEFj8yu49C2KIV3qxMFYTevG8KqAr0TPlkbzHHnTpDpvpzziAiNFh8xiT7C/TiyH0EguUw4vxAgpnE27WIypV+uFN2zW7xniF/n75trs9IJ5amB1zXXZ1LFkJ6GbS/dFokzl4cc2mamVwhL4XU0Av5gDWAl+aEWhAP7t2VIwU+EpvfOPDcLASX7H7lZpXA2XQfbSlD4qU18NffNPoAKMNSccBfO9YVVgmlW4RydBqfHAV7+hrZ84WJGho6bNT0YMhxxLdOx/dwGj0oyak9aAkNJ8lRJzUuA8sR+fPyiyTgUHio5+Pp+YaKlHrhR41jY5NESPS3x+zTMe0S2HnLOKCOQPpdxKyviBvdHrCDRqO+l96HhhNBLXWv4yEMuEUYo8kXnYJM8oIgVM4XJ+xXOev4YbWeqsvgq0lmw4/PiYr9sYLt+W5EAuYSFnJEan8CwJwbtASBfLBBpJZiRPor/aCJBZsM+MhvS7ZepyHvU8m5WSmaZnxuLts8ojl6KkS8oSAHkq5GWlCB/NgJ5W3rO2Cj1MK7ahxsCrbTT3a0V/QQH+sErxV4XUWDHx0kkFy25bPmBMBQ6BU3HoHhhYcJB9JhP6NXUWKxnE0raXHB6U9KHpWdQCQI72qevp5fMzcm+AvC85rsynVQhruDA9fp9COe7N56cg1UKGSas89vrN+WlGLYTwi5W+0xYdKEGtGCeNJwXKDU0XqU5uQYnWsMwTENLGtbQMvoGjIFIEMzCRal4rnBAg7D/CSn8MsCvS+FDJJAzoiioJEhZJgAp9n2+1Yznr7H+6eT4YkJ9Mpj60ImcW4i4iHDLn9RydB8dx3QYm3rsX6n4VRrZDsYK6DCGwkwd5n3/INFEpk16fYpP6JtMQpqEMzcOfQGAHXBTEGzuLJ03GYQL9bmV2/7ExDlRf+Uvf1sM2frRtCWmal12pMgtonvSCtR4n1CLUZRdTHDHP1Otwqd+rcdlavnKjUB/OYXQHUJzpNyFoKpQK+2OgrEKpGyIgIBgn2y9QHnTJihZOpEvOKIoHAMGAXHmj21Lym39Mbiow4IF+77xNuewziNVBxr6KD5e+9HzZSBIlUa/AmsDFJFXeyrQakR3FwowTGcADJHcEfhGkXYNGSYo4dh4bxwLM+28xjiqkdn0/3R4UEkvcBrBfn/SzBc1XhKM2VPlJgKSorjDac96V2UnQYXl1/yZPT4DVelgO+soMjexXwYO58VLl5xInQUZI8jc3H2CPnCNb9X05nOxIy4MlecasTqGK6s2az4RjpF2cQP2G28R+7wDPsZDZC/kWtjdoHC7SpdPmqQrUAhMwKVuxCmYTiD9q/O7GHtZvPSN0CAUQN/rymXZNniYLlJDE70bsk6Xxsh4kDOdxe7A2wo7P9F5YvqqRDI6brf79yPCSp4I0jVoO4YnLYtX5nzspR5WB4AKOYtR1ujXbOQpPyYDvfRE3FN5zw0i7reehdi7yV0YDRKRllGCGRk5Yz+Uv1fYl2ZwrnGsqsjgAVo0xEUba8ohjaNMJNwTwZA/wBDWFSCpg1eUH8MYL2zdioxRTqgGQrDZxQyNzyBJPXZF0+oxITJAbj7oNC5JwgDMUJaM5GqlGCWc//KCIrI+aclEe4IA0uzv7cuj6GCdaJONpi13O544vbtIHBF+A+JeDFUQNy61Gki3rtyQ4aUywn6ru314/dkGiP8Iwjo0J/2Txs49ZkwEl4mx+iYUUO55I6pJzU4P+7RRs+DXZkyKUYZqVWrPF4I94m4Wx1tXeE74o9GuX977yvJ/jkdak8+AmoHVjI15V+WwBdARFV2IPirJgVMdsg1Pez2VNHqa7EHWdTkl3XTcyjG9BiueWFvQfXI8aWSkuuRmqi/HUuzqyvLJfNfs0txMqldYYflWB1BS31WkuPJGGwXUCpjiQSktkuBMWwHjSkQxeehqw1Kgz0Trzm7QbtgxiEPDVmWCNCAeCfROTphd1ZNOhzLy6XfJyG6Xgd5MCAZw4xie0Sj5AnY1/akDgNS9YFl3Y06vd6FAsg2gVQJtzG7LVq1OH2frbXNHWH/NY89NNZ4QUSJqL2yEcGADbT38X0bGdukqYlSoliKOcsSTuqhcaemUeYLLoI8+MZor2RxXTRThF1LrHfqf/5LcLAjdl4EERgUysYS2geE+yFdasU91UgUDsc2cSQ1ZoT9+uLOwdgAmifwQqF028INc2IQEDfTmUw3eZxvz7Ud1z3xc1PQfeCvfKsB9jOhRj7rFyb9XcDWLcYj0bByosychMezMLVkFiYcdBBQtvI6K0KRuOZQH2kBsYHJaXTkup8F0eIhO1/GcIwWKpr2mouB7g5TUDJNvORXPXa/mU8bh27TAZYBe2sKx4NSv5OjnHIWD2RuysCzBlUfeNXhDd2jxnHoUlheJ3jBApzURy0fwm2FwwsSU0caQGl0Kv8hopRQE211NnvtLRsmCNrhhpEDoNiZEzD2QdJWKbRRWnaFedXHAELSN0t0bfsCsMf0ktfBoXBoNA+nZN9+pSlmuzspFevmsqqcMllzzvkyXrzoA+Ryo1ePXpdGOoJvhyru+EBRsmOp7MXZ0vNUMUqHLUoKglg1p73sWeZmPc+KAw0pE2zIsFFE5H4192KwDvDxdxEYoDBDNZjbg2bmADTeUKK57IPD4fTYF4c6EnXx/teYMORBDtIhPJneiZny7Nv/zG+YmekIKCoxr6kauE2bZtBLufetNG0BtBY7f+/ImUypMBvdWu/Q7vTMRzw5aQGZWuc1V0HEsItFYMIBnoKGZ0xcarba/TYZq50kCaflFysYjA4EDKHqGdpYWdKYmm+a7TADmW35yfnOYpZYrkpVEtiqF0EujI00aeplNs2k+qyFZNeE3CDPL9P6b4PQ/kataHkVpLSEVGK7EX6rAa7IVNrvZtFvOA6okKvBgMtFDAGZOx88MeBcJ8AR3AgUUeIznAN6tjCUipGDZONm1FjWJp4A3QIzSaIOmZ7DvF/ysYYbM/fFDOV0jntAjRdapxJxL0eThpEhKOjCDDq2ks+3GrwxqIFKLe1WdOzII8XIOPGnwy6LKXVfpSDOTEfaRsGujhpS4hBIsMOqHbl16PJxc4EkaVu9wpEYlF/84NSv5Zum4drMfp9yXbzzAOJqqS4YkI4cBrFrC7bMPiCfgI3nNZAqkk3QOZqR+yyqx+nDQKBBBZ7QKrfGMCL+XpqFaBJU0wpkBdAhbR4hJsmT5aynlvkouoxm/NjD5oe6BzVIO9uktM+/5dEC5P7vZvarmuO/lKXz4sBabVPIATuKTrwbJP8XUkdM6uEctHKXICUJGjaZIWRbZp8czquQYfY6ynBUCfIU+gG6wqSIBmYIm9pZpXdaL121V7q0VjDjmQnXvMe7ysoEZnZL15B0SpxS1jjd83uNIOKZwu5MPzg2NhOx3xMOPYwEn2CUzbSrwAs5OAtrz3GAaUkJOU74XwjaYUmGJdZBS1NJVkGYrToINLKDjxcuIlyfVsKQSG/G4DyiO2SlQvJ0d0Ot1uOG5IFSAkq+PRVMgVMDvOIJMdqjeCFKUGRWBW9wigYvcbU7CQL/7meF2KZAaWl+4y9uhowAX7elogAvItAAxo2+SFxGRsHGEW9BnhlTuWigYxRcnVUBRQHV41LV+Fr5CJYV7sHfeywswx4XMtUx6EkBhR+q8AXXUA8uPJ73Pb49i9KG9fOljvXeyFj9ixgbo6CcbAJ7WHWqKHy/h+YjBwp6VcN7M89FGzQ04qbrQtgrOFybg3gQRTYG5xn73ArkfQWjCJROwy3J38Dx/D7jOa6BBNsitEw1wGq780EEioOeD+ZGp2J66ADiVGMayiHYucMk8nTK2zzT9CnEraAk95kQjy4k0GRElLL5YAKLQErJ5rp1eay9O4Fb6yJGm9U4FaMwPGxtKD6odIIHKoWnhKo1U8KIpFC+MVn59ZXmc7ZTBZfsg6FQ8W10YfTr4u0nYrpHZbZ1jXiLmooF0cOm0+mPnJBXQtepc7n0BqOipNCqI6yyloTeRShNKH04FIo0gcMk0H/xThyN4pPAWjDDkEp3lNNPRNVfpMI44CWRlRgViP64eK0JSRp0WUvCWYumlW/c58Vcz/yMwVcW5oYb9+26TEhwvbxiNg48hl1VI1UXTU//Eta+BMKnGUivctfL5wINDD0giQL1ipt6U7C9cd4+lgqY2lMUZ02Uv6Prs+ZEZer7ZfWBXVghlfOOrClwsoOFKzWEfz6RZu1eCs+K8fLvkts5+BX0gyrFYve0C3qHrn5U/Oh6D/CihmWIrY7HUZRhJaxde+tldu6adYJ+LeXupQw0XExC36RETdNFxcq9glMu4cNQSX9cqR/GQYp+IxUkIcNGWVU7ZtGa6P3XAyodRt0XeS3Tp01AnCh0ZbUh4VrSZeV9RWfSoWyxnY3hzcZ30G/InDq4wxRrEejreBxnhIQbkxenxkaxl+k7eLUQkUR6vKJ2iDFNGX3WmVA1yaOH+mvhBd+sE6vacQzFobwY5BqEAFmejwW5ne7HtVNolOUgJc8CsUxmc/LBi8N5mu9VsIA5HyErnS6zeCz7VLI9+n/hbT6hTokMXTVyXJRKSG2hd2labXTbtmK4fNH3IZBPreSA4FMeVouVN3zG5x9CiGpLw/3pceo4qGqp+rVp+z+7yQ98oEf+nyH4F3+J9IheDBa94Wi63zJbLBCIZm7P0asHGpIJt3PzE3m0S4YIWyXBCVXGikj8MudDPB/6Nm2v4IxJ5gU0ii0guy5SUHqGUYzTP0jIJU5E82RHUXtX4lDdrihBLdP1YaG1AGUC12rQKuIaGvCpMjZC9bWSCYnjDlvpWbkdXMTNeBHLKiuoozMGIvkczmP0aRJSJ8PYnLCVNhKHXBNckH79e8Z8Kc2wUej4sQZoH8qDRGkg86maW/ZQWGNnLcXmq3FlXM6ssR/3P6E/bHMvm6HLrv1yRixit25JsH3/IOr2UV4BWJhxXW5BJ6Xdr07n9kF3ZNAk6/Xpc5MSFmYJ2R7bdL8Kk7q1OU9Elg/tCxJ8giT27wSTySF0GOxg4PbYJdi/Nyia9Nn89CGDulfJemm1aiEr/eleGSN+5MRrVJ4K6lgyTTIW3i9cQ0dAi6FHt0YMbH3wDSAtGLSAccezzxHitt1QdhW36CQgPcA8vIIBh3/JNjf/Obmc2yzpk8edSlS4lVdwgW5vzbYEyFoF4GCBBby1keVNueHAH+evi+H7oOVfS3XuPQSNTXOONAbzJeSb5stwdQHl1ZjrGoE49I8+A9j3t+ahhQj74FCSWpZrj7wRSFJJnnwi1T9HL5qrCFW/JZq6P62XkMWTb+u4lGpKfmmwiJWx178GOG7KbrZGqyWwmuyKWPkNswkZ1q8uptUlviIi+AXh2bOOTOLsrtNkfqbQJeh24reebkINLkjut5r4d9GR/r8CBa9SU0UQhsnZp5cP+RqWCixRm7i4YRFbtZ4EAkhtNa6jHb6gPYQv7MKqkPLRmX3dFsK8XsRLVZ6IEVrCbmNDc8o5mqsogjAQfoC9Bc7R6gfw03m+lQpv6kTfhxscDIX6s0w+fBxtkhjXAXr10UouWCx3C/p/FYwJRS/AXRKkjOb5CLmK4XRe0+xeDDwVkJPZau52bzLEDHCqV0f44pPgKOkYKgTZJ33fmk3Tu8SdxJ02SHM8Fem5SMsWqRyi2F1ynfRJszcFKykdWlNqgDA/L9lKYBmc7Zu/q9ii1FPF47VJkqhirUob53zoiJtVVRVwMR34gV9iqcBaHbRu9kkvqk3yMpfRFG49pKKjIiq7h/VpRwPGTHoY4cg05X5028iHsLvUW/uz+kjPyIEhhcKUwCkJAwbR9pIEGOn8z6svAO8i89sJ3dL5qDWFYbS+HGPRMxYwJItFQN86YESeJQhn2urGiLRffQeLptDl8dAgb+Tp47UQPxWOw17OeChLN1WnzlkPL1T5O+O3Menpn4C3IY5LEepHpnPeZHbvuWfeVtPlkH4LZjPbBrkJT3NoRJzBt86CO0Xq59oQ+8dsm0ymRcmQyn8w71mhmcuEI5byuF+C88VPYly2sEzjlzAQ3vdn/1+Hzguw6qFNNbqenhZGbdiG6RwZaTG7jTA2X9RdXjDN9yj1uQpyO4Lx8KRAcZcbZMafp4wPOd5MdXoFY52V1A8M9hi3sso93+uprE0qYNMjkE22CvK4HuUxqN7oIz5pWuETq1lQAjqlSlqdD2Rnr/ggp/TVkQYjn9lMfYelk2sH5HPdopYo7MHwlV1or9Bxf+QCyLzm92vzG2wjiIjC/ZHEJzeroJl6bdFPTpZho5MV2U86fLQqxNlGIMqCGy+9WYhJ8ob1r0+Whxde9L2PdysETv97O+xVw+VNN1TZSQN5I6l9m5Ip6pLIqLm4a1B1ffH6gHyqT9p82NOjntRWGIofO3bJz5GhkvSWbsXueTAMaJDou99kGLqDlhwBZNEQ4mKPuDvVwSK4WmLluHyhA97pZiVe8g+JxmnJF8IkV/tCs4Jq/HgOoAEGR9tCDsDbDmi3OviUQpG5D8XmKcSAUaFLRXb2lmJTNYdhtYyfjBYZQmN5qT5CNuaD3BVnlkCk7bsMW3AtXkNMMTuW4HjUERSJnVQ0vsBGa1wo3Qh7115XGeTF3NTz8w0440AgU7c3bSXO/KMINaIWXd0oLpoq/0/QJxCQSJ9XnYy1W7TYLBJpHsVWD1ahsA7FjNvRd6mxCiHsm8g6Z0pnzqIpF1dHUtP2ITU5Z1hZHbu+L3BEEStBbL9XYvGfEakv1bmf+bOZGnoiuHEdlBnaChxYKNzB23b8sw8YyT7Ajxfk49eJIAvdbVkdFCe2J0gMefhQ0bIZxhx3fzMIysQNiN8PgOUKxOMur10LduigREDRMZyP4oGWrP1GFY4t6groASsZ421os48wAdnrbovNhLt7ScNULkwZ5AIZJTrbaKYTLjA1oJ3sIuN/aYocm/9uoQHEIlacF1s/TM1fLcPTL38O9fOsjMEIwoPKfvt7opuI9G2Hf/PR4aCLDQ7wNmIdEuXJ/QNL72k5q4NejAldPfe3UVVqzkys8YZ/jYOGOp6c+YzRCrCuq0M11y7TiN6qk7YXRMn/gukxrEimbMQjr3jwRM6dKVZ4RUfWQr8noPXLJq6yh5R3EH1IVOHESst/LItbG2D2vRsZRkAObzvQAAD3mb3/G4NzopI0FAiHfbpq0X72adg6SRj+8OHMShtFxxLZlf/nLgRLbClwl5WmaYSs+yEjkq48tY7Z2bE0N91mJwt+ua0NlRJIDh0HikF4UvSVorFj2YVu9YeS5tfvlVjPSoNu/Zu6dEUfBOT555hahBdN3Sa5Xuj2Rvau1lQNIaC944y0RWj9UiNDskAK1WoL+EfXcC6IbBXFRyVfX/WKXxPAwUyIAGW8ggZ08hcijKTt1YKnUO6QPvcrmDVAb0FCLIXn5id4fD/Jx4tw/gbXs7WF9b2RgXtPhLBG9vF5FEkdHAKrQHZAJC/HWvk7nvzzDzIXZlfFTJoC3JpGgLPBY7SQTjGlUvG577yNutZ1hTfs9/1nkSXK9zzKLRZ3VODeKUovJe0WCq1zVMYxCJMenmNzPIU2S8TA4E7wWmbNkxq9rI2dd6v0VpcAPVMxnDsvWTWFayyqvKZO7Z08a62i/oH2/jxf8rpmfO64in3FLiL1GX8IGtVE9M23yGsIqJbxDTy+LtaMWDaPqkymb5VrQdzOvqldeU0SUi6IirG8UZ3jcpRbwHa1C0Dww9G/SFX3gPvTJQE+kyz+g1BeMILKKO+olcHzctOWgzxYHnOD7dpCRtuZEXACjgqesZMasoPgnuDC4nUviAAxDc5pngjoAITIkvhKwg5d608pdrZcA+qn5TMT6Uo/QzBaOxBCLTJX3Mgk85rMfsnWx86oLxf7p2PX5ONqieTa/qM3tPw4ZXvlAp83NSD8F7+ZgctK1TpoYwtiU2h02HCGioH5tkVCqNVTMH5p00sRy2JU1qyDBP2CII/Dg4WDsIl+zgeX7589srx6YORRQMBfKbodbB743Tl4WLKOEnwWUVBsm94SOlCracU72MSyj068wdpYjyz1FwC2bjQnxnB6Mp/pZ+yyZXtguEaYB+kqhjQ6UUmwSFazOb+rhYjLaoiM+aN9/8KKn0zaCTFpN9eKwWy7/u4EHzO46TdFSNjMfn2iPSJwDPCFHc0I1+vjdAZw5ZjqR/uzi9Zn20oAa5JnLEk/EA3VRWE7J/XrupfFJPtCUuqHPpnlL7ISJtRpSVcB8qsZCm2QEkWoROtCKKxUh3yEcMbWYJwk6DlEBG0bZP6eg06FL3v6RPb7odGuwm7FN8fG4woqtB8e7M5klPpo97GoObNwt+ludTAmxyC5hmcFx+dIvEZKI6igFKHqLH01iY1o7903VzG9QGetyVx5RNmBYUU+zIuSva/yIcECUi4pRmE3VkF2avqulQEUY4yZ/wmNboBzPmAPey3+dSYtBZUjeWWT0pPwCz4Vozxp9xeClIU60qvEFMQCaPvPaA70WlOP9f/ey39macvpGCVa+zfa8gO44wbxpJUlC8GN/pRMTQtzY8Z8/hiNrU+Zq64ZfFGIkdj7m7abcK1EBtws1X4J/hnqvasPvvDSDYWN+QcQVGMqXalkDtTad5rYY0TIR1Eqox3czwPMjKPvF5sFv17Thujr1IZ1Ytl4VX1J0vjXKmLY4lmXipRAro0qVGEcXxEVMMEl54jQMd4J7RjgomU0j1ptjyxY+cLiSyXPfiEcIS2lWDK3ISAy6UZ3Hb5vnPncA94411jcy75ay6B6DSTzK6UTCZR9uDANtPBrvIDgjsfarMiwoax2OlLxaSoYn4iRgkpEGqEkwox5tyI8aKkLlfZ12lO11TxsqRMY89j5JaO55XfPJPDL1LGSnC88Re9Ai+Nu5bZjtwRrvFITUFHPR4ZmxGslQMecgbZO7nHk32qHxYkdvWpup07ojcMCaVrpFAyFZJJbNvBpZfdf39Hdo2kPtT7v0/f8R/B5Nz4f1t9/3zNM/7n6SUHfcWk5dfQFJvcJMgPolGCpOFb/WC0FGWU2asuQyT+rm88ZKZ78Cei/CAh939CH0JYbpZIPtxc2ufXqjS3pHH9lnWK4iJ7OjR/EESpCo2R3MYKyE7rHfhTvWho4cL1QdN4jFTyR6syMwFm124TVDDRXMNveI1Dp/ntwdz8k8kxw7iFSx6+Yx6O+1LzMVrN0BBzziZi9kneZSzgollBnVwBh6oSOPHXrglrOj+QmR/AESrhDpKrWT+8/AiMDxS/5wwRNuGQPLlJ9ovomhJWn8sMLVItQ8N/7IXvtD8kdOoHaw+vBSbFImQsv/OCAIui99E+YSIOMlMvBXkAt+NAZK8wB9Jf8CPtB+TOUOR+z71d/AFXpPBT6+A5FLjxMjLIEoJzrQfquvxEIi+WoUzGR1IzQFNvbYOnxb2PyQ0kGdyXKzW2axQL8lNAXPk6NEjqrRD1oZtKLlFoofrXw0dCNWASHzy+7PSzOUJ3XtaPZsxLDjr+o41fKuKWNmjiZtfkOzItvlV2MDGSheGF0ma04qE3TUEfqJMrXFm7DpK+27DSvCUVf7rbNoljPhha5W7KBqVq0ShUSTbRmuqPtQreVWH4JET5yMhuqMoSd4r/N8sDmeQiQQvi1tcZv7Moc7dT5X5AtCD6kNEGZOzVcNYlpX4AbTsLgSYYliiPyVoniuYYySxsBy5cgb3pD+EK0Gpb0wJg031dPgaL8JZt6sIvzNPEHfVPOjXmaXj4bd4voXzpZ5GApMhILgMbCEWZ2zwgdeQgjNHLbPIt+KqxRwWPLTN6HwZ0Ouijj4UF+Sg0Au8XuIKW0WxlexdrFrDcZJ8Shauat3X0XmHygqgL1nAu2hrJFb4wZXkcS+i36KMyU1yFvYv23bQUJi/3yQpqr/naUOoiEWOxckyq/gq43dFou1DVDaYMZK9tho7+IXXokBCs5GRfOcBK7g3A+jXQ39K4YA8PBRW4m5+yR0ZAxWJncjRVbITvIAPHYRt1EJ3YLiUbqIvoKHtzHKtUy1ddRUQ0AUO41vonZDUOW+mrszw+SW/6Q/IUgNpcXFjkM7F4CSSQ2ExZg85otsMs7kqsQD4OxYeBNDcSpifjMoLb7GEbGWTwasVObmB/bfPcUlq0wYhXCYEDWRW02TP5bBrYsKTGWjnWDDJ1F7zWai0zW/2XsCuvBQjPFcTYaQX3tSXRSm8hsAoDdjArK/OFp6vcWYOE7lizP0Yc+8p16i7/NiXIiiQTp7c7Xus925VEtlKAjUdFhyaiLT7VxDagprMFwix4wZ05u0qj7cDWFd0W9OYHIu3JbJKMXRJ1aYNovugg+QqRN7fNHSi26VSgBpn+JfMuPo3aeqPWik/wI5Rz3BWarPQX4i5+dM0npwVOsX+KsOhC7vDg+OJsz4Q5zlnIeflUWL6QYMbf9WDfLmosLF4Qev3mJiOuHjoor/dMeBpA9iKDkMjYBNbRo414HCxjsHrB4EXNbHzNMDHCLuNBG6Sf+J4MZ/ElVsDSLxjIiGsTPhw8BPjxbfQtskj+dyNMKOOcUYIRBEIqbazz3lmjlRQhplxq673VklMMY6597vu+d89ec/zq7Mi4gQvh87ehYbpOuZEXj5g/Q7S7BFDAAB9DzG35SC853xtWVcnZQoH54jeOqYLR9NDuwxsVthTV7V99n/B7HSbAytbEyVTz/5NhJ8gGIjG0E5j3griULUd5Rg7tQR+90hJgNQKQH2btbSfPcaTOfIexc1db1BxUOhM1vWCpLaYuKr3FdNTt/T3PWCpEUWDKEtzYrjpzlL/wri3MITKsFvtF8QVV/NhVo97aKIBgdliNc10dWdXVDpVtsNn+2UIolrgqdWA4EY8so0YvB4a+aLzMXiMAuOHQrXY0tr+CL10JbvZzgjJJuB1cRkdT7DUqTvnswVUp5kkUSFVtIIFYK05+tQxT6992HHNWVhWxUsD1PkceIrlXuUVRogwmfdhyrf6zzaL8+c0L7GXMZOteAhAVQVwdJh+7nrX7x4LaIIfz2F2v7Dg/uDfz2Fa+4gFm2zHAor8UqimJG3VTJtZEoFXhnDYXvxMJFc6ku2bhbCxzij2z5UNuK0jmp1mnvkVNUfR+SEmj1Lr94Lym75PO7Fs0MIr3GdsWXRXSfgLTVY0FLqba97u1In8NAcY7IC6TjWLigwKEIm43NxTdaVTv9mcKkzuzBkKd8x/xt1p/9BbP7Wyb4bpo1K1gnOpbLvKz58pWl3B55RJ/Z5mRDLPtNQg14jdOEs9+h/V5UVpwrAI8kGbX8KPVPDIMfIqKDjJD9UyDOPhjZ3vFAyecwyq4akUE9mDOtJEK1hpDyi6Ae87sWAClXGTiwPwN7PXWwjxaR79ArHRIPeYKTunVW24sPr/3HPz2IwH8oKH4OlWEmt4BLM6W5g4kMcYbLwj2usodD1088stZA7VOsUSpEVl4w7NMb1EUHMRxAxLF0CIV+0L3iZb+ekB1vSDSFjAZ3hfLJf7gFaXrOKn+mhR+rWw/eTXIcAgl4HvFuBg1LOmOAwJH3eoVEjjwheKA4icbrQCmvAtpQ0mXG0agYp5mj4Rb6mdQ+RV4QBPbxMqh9C7o8nP0Wko2ocnCHeRGhN1XVyT2b9ACsL+6ylUy+yC3QEnaKRIJK91YtaoSrcWZMMwxuM0E9J68Z+YyjA0g8p1PfHAAIROy6Sa04VXOuT6A351FOWhKfTGsFJ3RTJGWYPoLk5FVK4OaYR9hkJvezwF9vQN1126r6isMGXWTqFW+3HL3I/jurlIdDWIVvYY+s6yq7lrFSPAGRdnU7PVwY/SvWbZGpXzy3BQ2LmAJlrONUsZs4oGkly0V267xbD5KMY8woNNsmWG1VVgLCra8aQBBcI4DP2BlNwxhiCtHlaz6OWFoCW0vMR3ErrG7JyMjTSCnvRcsEHgmPnwA6iNpJ2DrFb4gLlhKJyZGaWkA97H6FFdwEcLT6DRQQL++fOkVC4cYGW1TG/3iK5dShRSuiBulmihqgjR45Vi03o2RbQbP3sxt90VxQ6vzdlGfkXmmKmjOi080JSHkLntjvsBJnv7gKscOaTOkEaRQqAnCA4HWtB4XnMtOhpRmH2FH8tTXrIjAGNWEmudQLCkcVlGTQ965Kh0H6ixXbgImQP6b42B49sO5C8pc7iRlgyvSYvcnH9FgQ3azLbQG2cUW96SDojTQStxkOJyOuDGTHAnnWkz29aEwN9FT8EJ4yhXOg+jLTrCPKeEoJ9a7lDXOjEr8AgX4BmnMQ668oW0zYPyQiVMPxKRHtpfnEEyaKhdzNVThlxxDQNdrHeZiUFb6NoY2KwvSb7BnRcpJy+/g/zAYx3fYSN5QEaVD2Y1VsNWxB0BSO12MRsRY8JLfAezRMz5lURuLUnG1ToKk6Q30FughqWN6gBNcFxP/nY/iv+iaUQOa+2Nuym46wtI/DvSfzSp1jEi4SdYBE7YhTiVV5cX9gwboVDMVgZp5YBQlHOQvaDNfcCoCJuYhf5kz5kwiIKPjzgpcRJHPbOhJajeoeRL53cuMahhV8Z7IRr6M4hW0JzT7mzaMUzQpm866zwM7Cs07fJYXuWvjAMkbe5O6V4bu71sOG6JQ4oL8zIeXHheFVavzxmlIyBkgc9IZlEDplMPr8xlcyss4pVUdwK1e7CK2kTsSdq7g5SHRAl3pYUB9Ko4fsh4qleOyJv1z3KFSTSvwEcRO/Ew8ozEDYZSqpfoVW9uhJfYrNAXR0Z3VmeoAD+rVWtwP/13sE/3ICX3HhDG3CMc476dEEC0K3umSAD4j+ZQLVdFOsWL2C1TH5+4KiSWH+lMibo+B55hR3Gq40G1n25sGcN0mEcoU2wN9FCVyQLBhYOu9aHVLWjEKx2JIUZi5ySoHUAI9b8hGzaLMxCZDMLhv8MkcpTqEwz9KFDpCpqQhVmsGQN8m24wyB82FAKNmjgfKRsXRmsSESovAwXjBIoMKSG51p6Um8b3i7GISs7kjTq/PZoioCfJzfKdJTN0Q45kQEQuh9H88M3yEs3DbtRTKALraM0YC8laiMiOOe6ADmTcCiREeAWZelBaEXRaSuj2lx0xHaRYqF65O0Lo5OCFU18A8cMDE4MLYm9w2QSr9NgQAIcRxZsNpA7UJR0e71JL+VU+ISWFk5I97lra8uGg7GlQYhGd4Gc6rxsLFRiIeGO4abP4S4ekQ1fiqDCy87GZHd52fn5aaDGuvOmIofrzpVwMvtbreZ/855OaXTRcNiNE0wzGZSxbjg26v8ko8L537v/XCCWP2MFaArJpvnkep0pA+O86MWjRAZPQRfznZiSIaTppy6m3p6HrNSsY7fDtz7Cl4V/DJAjQDoyiL2uwf1UHVd2AIrzBUSlJaTj4k6NL97a/GqhWKU9RUmjnYKpm2r+JYUcrkCuZKvcYvrg8pDoUKQywY9GDWg03DUFSirlUXBS5SWn/KAntnf0IdHGL/7mwXqDG+LZYjbEdQmqUqq4y54TNmWUP7IgcAw5816YBzwiNIJiE9M4lPCzeI/FGBeYy3p6IAmH4AjXXmvQ4Iy0Y82NTobcAggT2Cdqz6Mx4TdGoq9fn2etrWKUNFyatAHydQTVUQ2S5OWVUlugcNvoUrlA8cJJz9MqOa/W3iVno4zDHfE7zhoY5f5lRTVZDhrQbR8LS4eRLz8iPMyBL6o4PiLlp89FjdokQLaSBmKHUwWp0na5fE3v9zny2YcDXG/jfI9sctulHRbdkI5a4GOPJx4oAJQzVZ/yYAado8KNZUdEFs9ZPiBsausotXMNebEgr0dyopuqfScFJ3ODNPHgclACPdccwv0YJGQdsN2lhoV4HVGBxcEUeUX/alr4nqpcc1CCR3vR7g40zteQg/JvWmFlUE4mAiTpHlYGrB7w+U2KdSwQz2QJKBe/5eiixWipmfP15AFWrK8Sh1GBBYLgzki1wTMhGQmagXqJ2+FuqJ8f0XzXCVJFHQdMAw8xco11HhM347alrAu+wmX3pDFABOvkC+WPX0Uhg1Z5MVHKNROxaR84YV3s12UcM+70cJ460SzEaKLyh472vOMD3XnaK7zxZcXlWqenEvcjmgGNR2OKbI1s8U+iwiW+HotHalp3e1MGDy6BMVIvajnAzkFHbeVsgjmJUkrP9OAwnEHYXVBqYx3q7LvXjoVR0mY8h+ZaOnh053pdsGkmbqhyryN01eVHySr+CkDYkSMeZ1xjPNVM+gVLTDKu2VGsMUJqWO4TwPDP0VOg2/8ITbAUaMGb4LjL7L+Pi11lEVMXTYIlAZ/QHmTENjyx3kDkBdfcvvQt6tKk6jYFM4EG5UXDTaF5+1ZjRz6W7MdJPC+wTkbDUim4p5QQH3b9kGk2Bkilyeur8Bc20wm5uJSBO95GfYDI1EZipoRaH7uVveneqz43tlTZGRQ4a7CNmMHgXyOQQOL6WQkgMUTQDT8vh21aSdz7ERiZT1jK9F+v6wgFvuEmGngSvIUR2CJkc5tx1QygfZnAruONobB1idCLB1FCfO7N1ZdRocT8/Wye+EnDiO9pzqIpnLDl4bkaRKW+ekBVwHn46Shw1X0tclt/0ROijuUB4kIInrVJU4buWf4YITJtjOJ6iKdr1u+flgQeFH70GxKjhdgt/MrwfB4K/sXczQ+9zYcrD4dhY6qZhZ010rrxggWA8JaZyg2pYij8ieYEg1aZJkZK9O1Re7sB0iouf60rK0Gd+AYlp7soqCBCDGwfKeUQhCBn0E0o0GS6PdmjLi0TtCYZeqazqwN+yNINIA8Lk3iPDnWUiIPLGNcHmZDxfeK0iAdxm/T7LnN+gemRL61hHIc0NCAZaiYJR+OHnLWSe8sLrK905B5eEJHNlWq4RmEXIaFTmo49f8w61+NwfEUyuJAwVqZCLFcyHBKAcIVj3sNzfEOXzVKIndxHw+AR93owhbCxUZf6Gs8cz6/1VdrFEPrv330+9s6BtMVPJ3zl/Uf9rUi0Z/opexfdL3ykF76e999GPfVv8fJv/Y/+/5hEMon1tqNFyVRevV9y9/uIvsG3dbB8GRRrgaEXfhx+2xeOFt+cEn3RZanNxdEe2+B6MHpNbrRE53PlDifPvFcp4kO78ILR0T4xyW/WGPyBsqGdoA7zJJCu1TKbGfhnqgnRbxbB2B3UZoeQ2bz2sTVnUwokTcTU21RxN1PYPS3Sar7T0eRIsyCNowr9amwoMU/od9s2APtiKNL6ENOlyKADstAEWKA+sdKDhrJ6BOhRJmZ+QJbAaZ3/5Fq0/lumCgEzGEbu3yi0Y4I4EgVAjqxh4HbuQn0GrRhOWyAfsglQJAVL1y/6yezS2k8RE2MstJLh92NOB3GCYgFXznF4d25qiP4ZCyI4RYGesut6FXK6GwPpKK8WHEkhYui0AyEmr5Ml3uBFtPFdnioI8RiCooa7Z1G1WuyIi3nSNglutc+xY8BkeW3JJXPK6jd2VIMpaSxpVtFq+R+ySK9J6WG5Qvt+C+QH1hyYUOVK7857nFmyDBYgZ/o+AnibzNVqyYCJQvyDXDTK+iXdkA71bY7TL3bvuLxLBQ8kbTvTEY9aqkQ3+MiLWbEgjLzOH+lXgco1ERgzd80rDCymlpaRQbOYnKG/ODoFl46lzT0cjM5FYVvv0qLUbD5lyJtMUaC1pFlTkNONx6lliaX9o0i/1vws5bNKn5OuENQEKmLlcP4o2ZmJjD4zzd3Fk32uQ4uRWkPSUqb4LBe3EXHdORNB2BWsws5daRnMfNVX7isPSb1hMQdAJi1/qmDMfRUlCU74pmnzjbXfL8PVG8NsW6IQM2Ne23iCPIpryJjYbVnm5hCvKpMa7HLViNiNc+xTfDIaKm3jctViD8A1M9YPJNk003VVr4Zo2MuGW8vil8SLaGpPXqG7I4DLdtl8a4Rbx1Lt4w5Huqaa1XzZBtj208EJVGcmKYEuaeN27zT9EE6a09JerXdEbpaNgNqYJdhP1NdqiPKsbDRUi86XvvNC7rME5mrSQtrzAZVndtSjCMqd8BmaeGR4l4YFULGRBeXIV9Y4yxLFdyoUNpiy2IhePSWzBofYPP0eIa2q5JP4j9G8at/AqoSsLAUuRXtvgsqX/zYwsE+of6oSDbUOo4RMJw+DOUTJq+hnqwKim9Yy/napyZNTc2rCq6V9jHtJbxGPDwlzWj/Sk3zF/BHOlT/fSjSq7FqlPI1q6J+ru8Aku008SFINXZfOfnZNOvGPMtEmn2gLPt+H4QLA+/SYe4j398auzhKIp2Pok3mPC5q1IN1HgR+mnEfc4NeeHYwd2/kpszR3cBn7ni9NbIqhtSWFW8xbUJuUPVOeeXu3j0IGZmFNiwaNZ6rH4/zQ2ODz6tFxRLsUYZu1bfd1uIvfQDt4YD/efKYv8VF8bHGDgK22w2Wqwpi43vNCOXFJZCGMqWiPbL8mil6tsmOTXAWCyMCw73e2rADZj2IK6rqksM3EXF2cbLb4vjB14wa/yXK5vwU+05MzERJ5nXsXsW21o7M+gO0js2OyKciP5uF2iXyb2DiptwQeHeqygkrNsqVCSlldxBMpwHi1vfc8RKpP/4L3Lmpq6DZcvhDDfxTCE3splacTcOtXdK2g303dIWBVe2wD/Gvja1cClFQ67gw0t1ZUttsUgQ1Veky8oOpS6ksYEc4bqseCbZy766SvL3FodmnahlWJRgVCNjPxhL/fk2wyvlKhITH/VQCipOI0dNcRa5B1M5HmOBjTLeZQJy237e2mobwmDyJNHePhdDmiknvLKaDbShL+Is1XTCJuLQd2wmdJL7+mKvs294whXQD+vtd88KKk0DXP8B1Xu9J+xo69VOuFgexgTrcvI6SyltuLix9OPuE6/iRJYoBMEXxU4shQMf4Fjqwf1PtnJ/wWSZd29rhZjRmTGgiGTAUQqRz+nCdjeMfYhsBD5Lv60KILWEvNEHfmsDs2L0A252351eUoYxAysVaCJVLdH9QFWAmqJDCODUcdoo12+gd6bW2boY0pBVHWL6LQDK5bYWh1V8vFvi0cRpfwv7cJiMX3AZNJuTddHehTIdU0YQ/sQ1dLoF2xQPcCuHKiuCWOY30DHe1OwcClLAhqAKyqlnIbH/8u9ScJpcS4kgp6HKDUdiOgRaRGSiUCRBjzI5gSksMZKqy7Sd51aeg0tgJ+x0TH9YH2Mgsap9N7ENZdEB0bey2DMTrBA1hn56SErNHf3tKtqyL9b6yXEP97/rc+jgD2N1LNUH6RM9AzP3kSipr06RkKOolR7HO768jjWiH1X92jA7dkg7gcNcjqsZCgfqWw0tPXdLg20cF6vnQypg7gLtkazrHAodyYfENPQZsdfnjMZiNu4nJO97D1/sQE+3vNFzrSDOKw+keLECYf7RJwVHeP/j79833oZ0egonYB2FlFE5qj02B/LVOMJQlsB8uNg3Leg4qtZwntsOSNidR0abbZmAK4sCzvt8Yiuz2yrNCJoH5O8XvX/vLeR/BBYTWj0sOPYM/jyxRd5+/JziKAABaPcw/34UA3aj/gLZxZgRCWN6m4m3demanNgsx0P237/Q+Ew5VYnJPkyCY0cIVHoFn2Ay/e7U4P19APbPFXEHX94N6KhEMPG7iwB3+I+O1jd5n6VSgHegxgaSawO6iQCYFgDsPSMsNOcUj4q3sF6KzGaH/0u5PQoAj/8zq6Uc9MoNrGqhYeb2jQo0WlGlXjxtanZLS24/OIN5Gx/2g684BPDQpwlqnkFcxpmP/osnOXrFuu4PqifouQH0eF5qCkvITQbJw/Zvy5mAHWC9oU+cTiYhJmSfKsCyt1cGVxisKu+NymEQIAyaCgud/V09qT3nk/9s/SWsYtha7yNpzBIMM40rCSGaJ9u6lEkl00vXBiEt7p9P5IBCiavynEOv7FgLqPdeqxRiCwuFVMolSIUBcoyfUC2e2FJSAUgYdVGFf0b0Kn2EZlK97yyxrT2MVgvtRikfdaAW8RwEEfN+B7/eK8bBdp7URpbqn1xcrC6d2UjdsKbzCjBFqkKkoZt7Mrhg6YagE7spkqj0jOrWM+UGQ0MUlG2evP1uE1p2xSv4dMK0dna6ENcNUF+xkaJ7B764NdxLCpuvhblltVRAf7vK5qPttJ/9RYFUUSGcLdibnz6mf7WkPO3MkUUhR2mAOuGv8IWw5XG1ZvoVMnjSAZe6T7WYA99GENxoHkMiKxHlCuK5Gd0INrISImHQrQmv6F4mqU/TTQ8nHMDzCRivKySQ8dqkpQgnUMnwIkaAuc6/FGq1hw3b2Sba398BhUwUZSAIO8XZvnuLdY2n6hOXws+gq9BHUKcKFA6kz6FDnpxLPICa3qGhnc97bo1FT/XJk48LrkHJ2CAtBv0RtN97N21plfpXHvZ8gMJb7Zc4cfI6MbPwsW7AilCSXMFIEUEmir8XLEklA0ztYbGpTTGqttp5hpFTTIqUyaAIqvMT9A/x+Ji5ejA4Bhxb/cl1pUdOD6epd3yilIdO6j297xInoiBPuEDW2/UfslDyhGkQs7Wy253bVnlT+SWg89zYIK/9KXFl5fe+jow2rd5FXv8zDPrmfMXiUPt9QBO/iK4QGbX5j/7Rx1c1vzsY8ONbP3lVIaPrhL4+1QrECTN3nyKavGG0gBBtHvTKhGoBHgMXHStFowN+HKrPriYu+OZ05Frn8okQrPaaxoKP1ULCS/cmKFN3gcH7HQlVjraCeQmtjg1pSQxeuqXiSKgLpxc/1OiZsU4+n4lz4hpahGyWBURLi4642n1gn9qz9bIsaCeEPJ0uJmenMWp2tJmIwLQ6VSgDYErOeBCfSj9P4G/vI7oIF+l/n5fp956QgxGvur77ynawAu3G9MdFbJbu49NZnWnnFcQHjxRuhUYvg1U/e84N4JTecciDAKb/KYIFXzloyuE1eYXf54MmhjTq7B/yBToDzzpx3tJCTo3HCmVPYfmtBRe3mPYEE/6RlTIxbf4fSOcaKFGk4gbaUWe44hVk9SZzhW80yfW5QWBHxmtUzvMhfVQli4gZTktIOZd9mjJ5hsbmzttaHQB29Am3dZkmx3g/qvYocyhZ2PXAWsNQiIaf+Q8W/MWPIK7/TjvCx5q2XRp4lVWydMc2wIQkhadDB0xsnw/kSEyGjLKjI4coVIwtubTF3E7MJ6LS6UOsJKj82XVAVPJJcepfewbzE91ivXZvOvYfsmMevwtPpfMzGmC7WJlyW2j0jh7AF1JLmwEJSKYwIvu6DHc3YnyLH9ZdIBnQ+nOVDRiP+REpqv++typYHIvoJyICGA40d8bR7HR2k7do6UQTHF4oriYeIQbxKe4Th6+/l1BjUtS9hqORh3MbgvYrStXTfSwaBOmAVQZzpYNqsAmQyjY56MUqty3c/xH6GuhNvNaG9vGbG6cPtBM8UA3e8r51D0AR9kozKuGGSMgLz3nAHxDNnc7GTwpLj7/6HeWp1iksDeTjwCLpxejuMtpMnGJgsiku1sOACwQ9ukzESiDRN77YNESxR5LphOlcASXA5uIts1LnBIcn1J7BLWs49DMALSnuz95gdOrTZr0u1SeYHinno/pE58xYoXbVO/S+FEMMs5qyWkMnp8Q3ClyTlZP52Y9nq7b8fITPuVXUk9ohG5EFHw4gAEcjFxfKb3xuAsEjx2z1wxNbSZMcgS9GKyW3R6KwJONgtA64LTyxWm8Bvudp0M1FdJPEGopM4Fvg7G/hsptkhCfHFegv4ENwxPeXmYhxwZy7js+BeM27t9ODBMynVCLJ7RWcBMteZJtvjOYHb5lOnCLYWNEMKC59BA7covu1cANa2PXL05iGdufOzkgFqqHBOrgQVUmLEc+Mkz4Rq8O6WkNr7atNkH4M8d+SD1t/tSzt3oFql+neVs+AwEI5JaBJaxARtY2Z4mKoUqxds4UpZ0sv3zIbNoo0J4fihldQTX3XNcuNcZmcrB5LTWMdzeRuAtBk3cZHYQF6gTi3PNuDJ0nmR+4LPLoHvxQIxRgJ9iNNXqf2SYJhcvCtJiVWo85TsyFOuq7EyBPJrAdhEgE0cTq16FQXhYPJFqSfiVn0IQnPOy0LbU4BeG94QjdYNB0CiQ3QaxQqD2ebSMiNjaVaw8WaM4Z5WnzcVDsr4eGweSLa2DE3BWViaxhZFIcSTjgxNCAfelg+hznVOYoe5VqTYs1g7WtfTm3e4/WduC6p+qqAM8H4ZyrJCGpewThTDPe6H7CzX/zQ8Tm+r65HeZn+MsmxUciEWPlAVaK/VBaQBWfoG/aRL/jSZIQfep/89GjasWmbaWzeEZ2R1FOjvyJT37O9B8046SRSKVEnXWlBqbkb5XCS3qFeuE9xb9+frEknxWB5h1D/hruz2iVDEAS7+qkEz5Ot5agHJc7WCdY94Ws61sURcX5nG8UELGBAHZ3i+3VulAyT0nKNNz4K2LBHBWJcTBX1wzf+//u/j/9+//v87+9/l9Lbh/L/uyNYiTsWV2LwsjaA6MxTuzFMqmxW8Jw/+IppdX8t/Clgi1rI1SN0UC/r6tX/4lUc2VV1OQReSeCsjUpKZchw4XUcjHfw6ryCV3R8s6VXm67vp4n+lcPV9gJwmbKQEsmrJi9c2vkwrm8HFbVYNTaRGq8D91t9n5+U+aD/hNtN3HjC/nC/vUoGFSCkXP+NlRcmLUqLbiUBl4LYf1U/CCvwtd3ryCH8gUmGITAxiH1O5rnGTz7y1LuFjmnFGQ1UWuM7HwfXtWl2fPFKklYwNUpF2IL/TmaRETjQiM5SJacI+3Gv5MBU8lP5Io6gWkawpyzNEVGqOdx4YlO1dCvjbWFZWbCmeiFKPSlMKtKcMFLs/KQxtgAHi7NZNCQ32bBAW2mbHflVZ8wXKi1JKVHkW20bnYnl3dKWJeWJOiX3oKPBD6Zbi0ZvSIuWktUHB8qDR8DMMh1ZfkBL9FS9x5r0hBGLJ8pUCJv3NYH+Ae8p40mZWd5m5fhobFjQeQvqTT4VKWIYfRL0tfaXKiVl75hHReuTJEcqVlug+eOIIc4bdIydtn2K0iNZPsYWQvQio2qbO3OqAlPHDDOB7DfjGEfVF51FqqNacd6QmgFKJpMfLp5DHTv4wXlONKVXF9zTJpDV4m1sYZqJPhotcsliZM8yksKkCkzpiXt+EcRQvSQqmBS9WdWkxMTJXPSw94jqI3varCjQxTazjlMH8jTS8ilaW8014/vwA/LNa+YiFoyyx3s/KswP3O8QW1jtq45yTM/DX9a8M4voTVaO2ebvw1EooDw/yg6Y1faY+WwrdVs5Yt0hQ5EwRfYXSFxray1YvSM+kYmlpLG2/9mm1MfmbKHXr44Ih8nVKb1M537ZANUkCtdsPZ80JVKVKabVHCadaLXg+IV8i5GSwpZti0h6diTaKs9sdpUKEpd7jDUpYmHtiX33SKiO3tuydkaxA7pEc9XIQEOfWJlszj5YpL5bKeQyT7aZSBOamvSHl8xsWvgo26IP/bqk+0EJUz+gkkcvlUlyPp2kdKFtt7y5aCdks9ZJJcFp5ZWeaWKgtnXMN3ORwGLBE0PtkEIek5FY2aVssUZHtsWIvnljMVJtuVIjpZup/5VL1yPOHWWHkOMc6YySWMckczD5jUj2mlLVquFaMU8leGVaqeXis+aRRL8zm4WuBk6cyWfGMxgtr8useQEx7k/PvRoZyd9nde1GUCV84gMX8Ogu/BWezYPSR27llzQnA97oo0pYyxobYUJfsj+ysTm9zJ+S4pk0TGo9VTG0KjqYhTmALfoDZVKla2b5yhv241PxFaLJs3i05K0AAIdcGxCJZmT3ZdT7CliR7q+kur7WdQjygYtOWRL9B8E4s4LI8KpAj7bE0dg7DLOaX+MGeAi0hMMSSWZEz+RudXbZCsGYS0QqiXjH9XQbd8sCB+nIVTq7/T/FDS+zWY9q7Z2fdq1tdLb6v3hKKVDAw5gjj6o9r1wHFROdHc18MJp4SJ2Ucvu+iQ9EgkekW8VCM+psM6y+/2SBy8tNN4a3L1MzP+OLsyvESo5gS7IQOnIqMmviJBVc6zbVG1n8eXiA3j46kmvvtJlewwNDrxk4SbJOtP/TV/lIVK9ueShNbbMHfwnLTLLhbZuO79ec5XvfgRwLFK+w1r5ZWW15rVFZrE+wKqNRv5KqsLNfpGgnoUU6Y71NxEmN7MyqwqAQqoIULOw/LbuUB2+uE75gJt+kq1qY4LoxV+qR/zalupea3D5+WMeaRIn0sAI6DDWDh158fqUb4YhAxhREbUN0qyyJYkBU4V2KARXDT65gW3gRsiv7xSPYEKLwzgriWcWgPr0sbZnv7m1XHNFW6xPdGNZUdxFiUYlmXNjDVWuu7LCkX/nVkrXaJhiYktBISC2xgBXQnNEP+cptWl1eG62a7CPXrnrkTQ5BQASbEqUZWMDiZUisKyHDeLFOaJILUo5f6iDt4ZO8MlqaKLto0AmTHVVbkGuyPa1R/ywZsWRoRDoRdNMMHwYTsklMVnlAd2S0282bgMI8fiJpDh69OSL6K3qbo20KfpNMurnYGQSr/stFqZ7hYsxKlLnKAKhsmB8AIpEQ4bd/NrTLTXefsE6ChRmKWjXKVgpGoPs8GAicgKVw4K0qgDgy1A6hFq1WRat3fHF+FkU+b6H4NWpOU3KXTxrIb2qSHAb+qhm8hiSROi/9ofapjxhyKxxntPpge6KL5Z4+WBMYkAcE6+0Hd3Yh2zBsK2MV3iW0Y6cvOCroXlRb2MMJtdWx+3dkFzGh2Pe3DZ9QpSqpaR/rE1ImOrHqYYyccpiLC22amJIjRWVAherTfpQLmo6/K2pna85GrDuQPlH1Tsar8isAJbXLafSwOof4gg9RkAGm/oYpBQQiPUoyDk2BCQ1k+KILq48ErFo4WSRhHLq/y7mgw3+L85PpP6xWr6cgp9sOjYjKagOrxF148uhuaWtjet953fh1IQiEzgC+d2IgBCcUZqgTAICm2bR8oCjDLBsmg+ThyhfD+zBalsKBY1Ce54Y/t9cwfbLu9SFwEgphfopNA3yNxgyDafUM3mYTovZNgPGdd4ZFFOj1vtfFW3u7N+iHEN1HkeesDMXKPyoCDCGVMo4GCCD6PBhQ3dRZIHy0Y/3MaE5zU9mTCrwwnZojtE+qNpMSkJSpmGe0EzLyFelMJqhfFQ7a50uXxZ8pCc2wxtAKWgHoeamR2O7R+bq7IbPYItO0esdRgoTaY38hZLJ5y02oIVwoPokGIzxAMDuanQ1vn2WDQ00Rh6o5QOaCRu99fwDbQcN0XAuqkFpxT/cfz3slGRVokrNU0iqiMAJFEbKScZdmSkTUznC0U+MfwFOGdLgsewRyPKwBZYSmy6U325iUhBQNxbAC3FLKDV9VSOuQpOOukJ/GAmu/tyEbX9DgEp6dv1zoU0IqzpG6gssSjIYRVPGgU1QAQYRgIT8gEV0EXr1sqeh2I6rXjtmoCYyEDCe/PkFEi/Q48FuT29p557iN+LCwk5CK/CZ2WdAdfQZh2Z9QGrzPLSNRj5igUWzl9Vi0rCqH8G1Kp4QMLkuwMCAypdviDXyOIk0AHTM8HBYKh3b0/F+DxoNj4ZdoZfCpQVdnZarqoMaHWnMLNVcyevytGsrXQEoIbubqWYNo7NRHzdc0zvT21fWVirj7g36iy6pxogfvgHp1xH1Turbz8QyyHnXeBJicpYUctbzApwzZ1HT+FPEXMAgUZetgeGMwt4G+DHiDT2Lu+PT21fjJCAfV16a/Wu1PqOkUHSTKYhWW6PhhHUlNtWzFnA7MbY+r64vkwdpfNB2JfWgWXAvkzd42K4lN9x7Wrg4kIKgXCb4mcW595MCPJ/cTfPAMQMFWwnqwde4w8HZYJFpQwcSMhjVz4B8p6ncSCN1X4klxoIH4BN2J6taBMj6lHkAOs8JJAmXq5xsQtrPIPIIp/HG6i21xMGcFgqDXSRF0xQg14d2uy6HgKE13LSvQe52oShF5Jx1R6avyL4thhXQZHfC94oZzuPUBKFYf1VvDaxIrtV6dNGSx7DO0i1p6CzBkuAmEqyWceQY7F9+U0ObYDzoa1iKao/cOD/v6Q9gHrrr1uCeOk8fST9MG23Ul0KmM3r+Wn6Hi6WAcL7gEeaykicvgjzkjSwFsAXIR81Zx4QJ6oosVyJkCcT+4xAldCcihqvTf94HHUPXYp3REIaR4dhpQF6+FK1H0i9i7Pvh8owu3lO4PT1iuqu+DkL2Bj9+kdfGAg2TXw03iNHyobxofLE2ibjsYDPgeEQlRMR7afXbSGQcnPjI2D+sdtmuQ771dbASUsDndU7t58jrrNGRzISvwioAlHs5FA+cBE5Ccznkd8NMV6BR6ksnKLPZnMUawRDU1MZ/ib3xCdkTblHKu4blNiylH5n213yM0zubEie0o4JhzcfAy3H5qh2l17uLooBNLaO+gzonTH2uF8PQu9EyH+pjGsACTMy4cHzsPdymUSXYJOMP3yTkXqvO/lpvt0cX5ekDEu9PUfBeZODkFuAjXCaGdi6ew4qxJ8PmFfwmPpkgQjQlWqomFY6UkjmcnAtJG75EVR+NpzGpP1Ef5qUUbfowrC3zcSLX3BxgWEgEx/v9cP8H8u1Mvt9/rMDYf6sjwU1xSOPBgzFEeJLMRVFtKo5QHsUYT8ZRLCah27599EuqoC9PYjYO6aoAMHB8X1OHwEAYouHfHB3nyb2B+SnZxM/vw/bCtORjLMSy5aZoEpvgdGvlJfNPFUu/p7Z4VVK1hiI0/UTuB3ZPq4ohEbm7Mntgc1evEtknaosgZSwnDC2BdMmibpeg48X8Ixl+/8+xXdbshQXUPPvx8jT3fkELivHSmqbhblfNFShWAyQnJ3WBU6SMYSIpTDmHjdLVAdlADdz9gCplZw6mTiHqDwIsxbm9ErGusiVpg2w8Q3khKV/R9Oj8PFeF43hmW/nSd99nZzhyjCX3QOZkkB6BsH4H866WGyv9E0hVAzPYah2tkRfQZMmP2rinfOeQalge0ovhduBjJs9a1GBwReerceify49ctOh5/65ATYuMsAkVltmvTLBk4oHpdl6i+p8DoNj4Fb2vhdFYer2JSEilEwPd5n5zNoGBXEjreg/wh2NFnNRaIUHSOXa4eJRwygZoX6vnWnqVdCRT1ARxeFrNBJ+tsdooMwqnYhE7zIxnD8pZH+P0Nu1wWxCPTADfNWmqx626IBJJq6NeapcGeOmbtXvl0TeWG0Y7OGGV4+EHTtNBIT5Wd0Bujl7inXgZgfXTM5efD3qDTJ54O9v3Bkv+tdIRlq1kXcVD0BEMirmFxglNPt5pedb1AnxuCYMChUykwsTIWqT23XDpvTiKEru1cTcEMeniB+HQDehxPXNmkotFdwUPnilB/u4Nx5Xc6l8J9jH1EgKZUUt8t8cyoZleDBEt8oibDmJRAoMKJ5Oe9CSWS5ZMEJvacsGVdXDWjp/Ype5x0p9PXB2PAwt2LRD3d+ftNgpuyvxlP8pB84oB1i73vAVpwyrmXW72hfW6Dzn9Jkj4++0VQ4d0KSx1AsDA4OtXXDo63/w+GD+zC7w5SJaxsmnlYRQ4dgdjA7tTl2KNLnpJ+mvkoDxtt1a4oPaX3EVqj96o9sRKBQqU7ZOiupeAIyLMD+Y3YwHx30XWHB5CQiw7q3mj1EDlP2eBsZbz79ayUMbyHQ7s8gu4Lgip1LiGJj7NQj905/+rgUYKAA5qdrlHKIknWmqfuR+PB8RdBkDg/NgnlT89G72h2NvySnj7UyBwD+mi/IWs1xWbxuVwUIVXun5cMqBtFbrccI+DILjsVQg6eeq0itiRfedn89CvyFtpkxaauEvSANuZmB1p8FGPbU94J9medwsZ9HkUYjmI7OH5HuxendLbxTaYrPuIfE2ffXFKhoNBUp33HsFAXmCV/Vxpq5AYgFoRr5Ay93ZLRlgaIPjhZjXZZChT+aE5iWAXMX0oSFQEtwjiuhQQItTQX5IYrKfKB+queTNplR1Hoflo5/I6aPPmACwQCE2jTOYo5Dz1cs7Sod0KTG/3kEDGk3kUaUCON19xSJCab3kNpWZhSWkO8l+SpW70Wn3g0ciOIJO5JXma6dbos6jyisuxXwUUhj2+1uGhcvuliKtWwsUTw4gi1c/diEEpZHoKoxTBeMDmhPhKTx7TXWRakV8imJR355DcIHkR9IREHxohP4TbyR5LtFU24umRPRmEYHbpe1LghyxPx7YgUHjNbbQFRQhh4KeU1EabXx8FS3JAxp2rwRDoeWkJgWRUSKw6gGP5U2PuO9V4ZuiKXGGzFQuRuf+tkSSsbBtRJKhCi3ENuLlXhPbjTKD4djXVnfXFds6Zb+1XiUrRfyayGxJq1+SYBEfbKlgjiSmk0orgTqzSS+DZ5rTqsJbttiNtp+KMqGE2AHGFw6jQqM5vD6vMptmXV9OAjq49Uf/Lx9Opam+Hn5O9p8qoBBAQixzQZ4eNVkO9sPzJAMyR1y4/RCQQ1s0pV5KAU5sKLw3tkcFbI/JqrjCsK4Mw+W8aod4lioYuawUiCyVWBE/qPaFi5bnkgpfu/ae47174rI1fqQoTbW0HrU6FAejq7ByM0V4zkZTg02/YJK2N7hUQRCeZ4BIgSEqgD8XsjzG6LIsSbuHoIdz/LhFzbNn1clci1NHWJ0/6/O8HJMdIpEZbqi1RrrFfoo/rI/7ufm2MPG5lUI0IYJ4MAiHRTSOFJ2oTverFHYXThkYFIoyFx6rMYFgaOKM4xNWdlOnIcKb/suptptgTOTdVIf4YgdaAjJnIAm4qNNHNQqqAzvi53GkyRCEoseUBrHohZsjUbkR8gfKtc/+Oa72lwxJ8Mq6HDfDATbfbJhzeIuFQJSiw1uZprHlzUf90WgqG76zO0eCB1WdPv1IT6sNxxh91GEL2YpgC97ikFHyoaH92ndwduqZ6IYjkg20DX33MWdoZk7QkcKUCgisIYslOaaLyvIIqRKWQj16jE1DlQWJJaPopWTJjXfixEjRJJo8g4++wuQjbq+WVYjsqCuNIQW3YjnxKe2M5ZKEqq+cX7ZVgnkbsU3RWIyXA1rxv4kGersYJjD//auldXGmcEbcfTeF16Y1708FB1HIfmWv6dSFi6oD4E+RIjCsEZ+kY7dKnwReJJw3xCjKvi3kGN42rvyhUlIz0Bp+fNSV5xwFiuBzG296e5s/oHoFtUyUplmPulIPl+e1CQIQVtjlzLzzzbV+D/OVQtYzo5ixtMi5BmHuG4N/uKfJk5UIREp7+12oZlKtPBomXSzAY0KgtbPzzZoHQxujnREUgBU+O/jKKhgxVhRPtbqyHiUaRwRpHv7pgRPyUrnE7fYkVblGmfTY28tFCvlILC04Tz3ivkNWVazA+OsYrxvRM/hiNn8Fc4bQBeUZABGx5S/xFf9Lbbmk298X7iFg2yeimvsQqqJ+hYbt6uq+Zf9jC+Jcwiccd61NKQtFvGWrgJiHB5lwi6fR8KzYS7EaEHf/ka9EC7H8D+WEa3TEACHBkNSj/cXxFeq4RllC+fUFm2xtstYLL2nos1DfzsC9vqDDdRVcPA3Ho95aEQHvExVThXPqym65llkKlfRXbPTRiDepdylHjmV9YTWAEjlD9DdQnCem7Aj/ml58On366392214B5zrmQz/9ySG2mFqEwjq5sFl5tYJPw5hNz8lyZPUTsr5E0F2C9VMPnZckWP7+mbwp/BiN7f4kf7vtGnZF2JGvjK/sDX1RtcFY5oPQnE4lIAYV49U3C9SP0LCY/9i/WIFK9ORjzM9kG/KGrAuwFmgdEpdLaiqQNpCTGZVuAO65afkY1h33hrqyLjZy92JK3/twdj9pafFcwfXONmPQWldPlMe7jlP24Js0v9m8bIJ9TgS2IuRvE9ZVRaCwSJYOtAfL5H/YS4FfzKWKbek+GFulheyKtDNlBtrdmr+KU+ibHTdalzFUmMfxw3f36x+3cQbJLItSilW9cuvZEMjKw987jykZRlsH/UI+HlKfo2tLwemBEeBFtmxF2xmItA/dAIfQ+rXnm88dqvXa+GapOYVt/2waFimXFx3TC2MUiOi5/Ml+3rj/YU6Ihx2hXgiDXFsUeQkRAD6wF3SCPi2flk7XwKAA4zboqynuELD312EJ88lmDEVOMa1W/K/a8tGylZRMrMoILyoMQzzbDJHNZrhH77L9qSC42HVmKiZ5S0016UTp83gOhCwz9XItK9fgXfK3F5d7nZCBUekoLxrutQaPHa16Rjsa0gTrzyjqTnmcIcrxg6X6dkKiucudc0DD5W4pJPf0vuDW8r5/uw24YfMuxFRpD2ovT2mFX79xH6Jf+MVdv2TYqR6/955QgVPe3JCD/WjAYcLA9tpXgFiEjge2J5ljeI/iUzg91KQuHkII4mmHZxC3XQORLAC6G7uFn5LOmlnXkjFdoO976moNTxElS8HdxWoPAkjjocDR136m2l+f5t6xaaNgdodOvTu0rievnhNAB79WNrVs6EsPgkgfahF9gSFzzAd+rJSraw5Mllit7vUP5YxA843lUpu6/5jAR0RvH4rRXkSg3nE+O5GFyfe+L0s5r3k05FyghSFnKo4TTgs07qj4nTLqOYj6qaW9knJTDkF5OFMYbmCP+8H16Ty482OjvERV6OFyw043L9w3hoJi408sR+SGo1WviXUu8d7qS+ehKjpKwxeCthsm2LBFSFeetx0x4AaKPxtp3CxdWqCsLrB1s/j5TAhc1jNZsXWl6tjo/WDoewxzg8T8NnhZ1niUwL/nhfygLanCnRwaFGDyLw+sfZhyZ1UtYTp8TYB6dE7R3VsKKH95CUxJ8u8N+9u2/9HUNKHW3x3w5GQrfOPafk2w5qZq8MaHT0ebeY3wIsp3rN9lrpIsW9c1ws3VNV+JwNz0Lo9+V7zZr6GD56We6gWVIvtmam5GPPkVAbr74r6SwhuL+TRXtW/0pgyX16VNl4/EAD50TnUPuwrW6OcUO2VlWXS0inq872kk7GUlW6o/ozFKq+Sip6LcTtSDfDrPTcCHhx75H8BeRon+KG2wRwzfDgWhALmiWOMO6h3pm1UCZEPEjScyk7tdLx6WrdA2N1QTPENvNnhCQjW6kl057/qv7IwRryHrZBCwVSbLLnFRiHdTwk8mlYixFt1slEcPD7FVht13HyqVeyD55HOXrh2ElAxJyinGeoFzwKA91zfrdLvDxJSjzmImfvTisreI25EDcVfGsmxLVbfU8PGe/7NmWWKjXcdTJ11jAlVIY/Bv/mcxg/Q10vCHwKG1GW/XbJq5nxDhyLqiorn7Wd7VEVL8UgVzpHMjQ+Z8DUgSukiVwWAKkeTlVVeZ7t1DGnCgJVIdBPZAEK5f8CDyDNo7tK4/5DBjdD5MPV86TaEhGsLVFPQSI68KlBYy84FievdU9gWh6XZrugvtCZmi9vfd6db6V7FmoEcRHnG36VZH8N4aZaldq9zZawt1uBFgxYYx+Gs/qW1jwANeFy+LCoymyM6zgG7j8bGzUyLhvrbJkTYAEdICEb4kMKusKT9V3eIwMLsjdUdgijMc+7iKrr+TxrVWG0U+W95SGrxnxGrE4eaJFfgvAjUM4SAy8UaRwE9j6ZQH5qYAWGtXByvDiLSDfOD0yFA3UCMKSyQ30fyy1mIRg4ZcgZHLNHWl+c9SeijOvbOJxoQy7lTN2r3Y8p6ovxvUY74aOYbuVezryqXA6U+fcp6wSV9X5/OZKP18tB56Ua0gMyxJI7XyNT7IrqN8GsB9rL/kP5KMrjXxgqKLDa+V5OCH6a5hmOWemMUsea9vQl9t5Oce76PrTyTv50ExOqngE3PHPfSL//AItPdB7kGnyTRhVUUFNdJJ2z7RtktZwgmQzhBG/G7QsjZmJfCE7k75EmdIKH7xlnmDrNM/XbTT6FzldcH/rcRGxlPrv4qDScqE7JSmQABJWqRT/TUcJSwoQM+1jvDigvrjjH8oeK2in1S+/yO1j8xAws/T5u0VnIvAPqaE1atNuN0cuRliLcH2j0nTL4JpcR7w9Qya0JoaHgsOiALLCCzRkl1UUESz+ze/gIXHGtDwgYrK6pCFKJ1webSDog4zTlPkgXZqxlQDiYMjhDpwTtBW2WxthWbov9dt2X9XFLFmcF+eEc1UaQ74gqZiZsdj63pH1qcv3Vy8JYciogIVKsJ8Yy3J9w/GhjWVSQAmrS0BPOWK+RKV+0lWqXgYMnIFwpcZVD7zPSp547i9HlflB8gVnSTGmmq1ClO081OW/UH11pEQMfkEdDFzjLC1Cdo/BdL3s7cXb8J++Hzz1rhOUVZFIPehRiZ8VYu6+7Er7j5PSZu9g/GBdmNzJmyCD9wiswj9BZw+T3iBrg81re36ihMLjoVLoWc+62a1U/7qVX5CpvTVF7rocSAKwv4cBVqZm7lLDS/qoXs4fMs/VQi6BtVbNA3uSzKpQfjH1o3x4LrvkOn40zhm6hjduDglzJUwA0POabgdXIndp9fzhOo23Pe+Rk9GSLX0d71Poqry8NQDTzNlsa+JTNG9+UrEf+ngxCjGEsDCc0bz+udVRyHQI1jmEO3S+IOQycEq7XwB6z3wfMfa73m8PVRp+iOgtZfeSBl01xn03vMaQJkyj7vnhGCklsCWVRUl4y+5oNUzQ63B2dbjDF3vikd/3RUMifPYnX5Glfuk2FsV/7RqjI9yKTbE8wJY+74p7qXO8+dIYgjtLD/N8TJtRh04N9tXJA4H59IkMmLElgvr0Q5OCeVfdAt+5hkh4pQgfRMHpL74XatLQpPiOyHRs/OdmHtBf8nOZcxVKzdGclIN16lE7kJ+pVMjspOI+5+TqLRO6m0ZpNXJoZRv9MPDRcAfJUtNZHyig/s2wwReakFgPPJwCQmu1I30/tcBbji+Na53i1W1N+BqoY7Zxo+U/M9XyJ4Ok2SSkBtoOrwuhAY3a03Eu6l8wFdIG1cN+e8hopTkiKF093KuH/BcB39rMiGDLn6XVhGKEaaT/vqb/lufuAdpGExevF1+J9itkFhCfymWr9vGb3BTK4j598zRH7+e+MU9maruZqb0pkGxRDRE1CD4Z8LV4vhgPidk5w2Bq816g3nHw1//j3JStz7NR9HIWELO8TMn3QrP/zZp//+Dv9p429/ogv+GATR+n/UdF+ns9xNkXZQJXY4t9jMkJNUFygAtzndXwjss+yWH9HAnLQQfhAskdZS2l01HLWv7L7us5uTH409pqitvfSOQg/c+Zt7k879P3K9+WV68n7+3cZfuRd/dDPP/03rn+d+/nBvWfgDlt8+LzjqJ/vx3CnNOwiXhho778C96iD+1TBvRZYeP+EH81LE0vVwOOrmCLB3iKzI1x+vJEsrPH4uF0UB4TJ4X3uDfOCo3PYpYe0MF4bouh0DQ/l43fxUF7Y+dpWuvTSffB0yO2UQUETI/LwCZE3BvnevJ7c9zUlY3H58xzke6DNFDQG8n0WtDN4LAYN4nogKav1ezOfK/z+t6tsCTp+dhx4ymjWuCJk1dEUifDP+HyS4iP/Vg9B2jTo9L4NbiBuDS4nuuHW6H+JDQn2JtqRKGkEQPEYE7uzazXIkcxIAqUq1esasZBETlEZY7y7Jo+RoV/IsjY9eIMkUvr42Hc0xqtsavZvhz1OLwSxMOTuqzlhb0WbdOwBH9EYiyBjatz40bUxTHbiWxqJ0uma19qhPruvcWJlbiSSH48OLDDpaHPszvyct41ZfTu10+vjox6kOqK6v0K/gEPphEvMl/vwSv+A4Hhm36JSP9IXTyCZDm4kKsqD5ay8b1Sad/vaiyO5N/sDfEV6Z4q95E+yfjxpqBoBETW2C7xl4pIO2bDODDFurUPwE7EWC2Uplq+AHmBHvir2PSgkR12/Ry65O0aZtQPeXi9mTlF/Wj5GQ+vFkYyhXsLTjrBSP9hwk4GPqDP5rBn5/l8b0mLRAvRSzXHc293bs3s8EsdE3m2exxidWVB4joHR+S+dz5/W+v00K3TqN14CDBth8eWcsTbiwXPsygHdGid0PEdy6HHm2v/IUuV5RVapYmzGsX90mpnIdNGcOOq64Dbc5GUbYpD9M7S+6cLY//QmjxFLP5cuTFRm3vA5rkFZroFnO3bjHF35uU3s8mvL7Tp9nyTc4mymTJ5sLIp7umSnGkO23faehtz3mmTS7fbVx5rP7x3HXIjRNeq/A3xCs9JNB08c9S9BF2O3bOur0ItslFxXgRPdaapBIi4dRpKGxVz7ir69t/bc9qTxjvtOyGOfiLGDhR4fYywHv1WdOplxIV87TpLBy3Wc0QP0P9s4G7FBNOdITS/tep3o3h1TEa5XDDii7fWtqRzUEReP2fbxz7bHWWJdbIOxOUJZtItNZpTFRfj6vm9sYjRxQVO+WTdiOhdPeTJ+8YirPvoeL88l5iLYOHd3b/Imkq+1ZN1El3UikhftuteEYxf1Wujof8Pr4ICTu5ezZyZ4tHQMxlzUHLYO2VMOoNMGL/20S5i2o2obfk+8qqdR7xzbRDbgU0lnuIgz4LelQ5XS7xbLuSQtNS95v3ZUOdaUx/Qd8qxCt6xf2E62yb/HukLO6RyorV8KgYl5YNc75y+KvefrxY+lc/64y9kvWP0a0bDz/rojq+RWjO06WeruWqNFU7r3HPIcLWRql8ICZsz2Ls/qOm/CLn6++X+Qf7mGspYCrZod/lpl6Rw4xN/yuq8gqV4B6aHk1hVE1SfILxWu5gvXqbfARYQpspcxKp1F/c8XOPzkZvmoSw+vEqBLdrq1fr3wAPv5NnM9i8F+jdAuxkP5Z71c6uhK3enlnGymr7UsWZKC12qgUiG8XXGQ9mxnqz4GSIlybF9eXmbqj2sHX+a1jf0gRoONHRdRSrIq03Ty89eQ1GbV/Bk+du4+V15zls+vvERvZ4E7ZbnxWTVjDjb4o/k8jlw44pTIrUGxxuJvBeO+heuhOjpFsO6lVJ/aXnJDa/bM0Ql1cLbXE/Pbv3EZ3vj3iVrB5irjupZTzlnv677NrI9UNYNqbPgp/HZXS+lJmk87wec+7YOxTDo2aw2l3NfDr34VNlvqWJBknuK7oSlZ6/T10zuOoPZOeoIk81N+sL843WJ2Q4Z0fZ3scsqC/JV2fuhWi1jGURSKZV637lf53Xnnx16/vKEXY89aVJ0fv91jGdfG+G4+sniwHes4hS+udOr4RfhFhG/F5gUG35QaU+McuLmclb5ZWmR+sG5V6nf+PxYzlrnFGxpZaK8eqqVo0NfmAWoGfXDiT/FnUbWvzGDOTr8aktOZWg4BYvz5YH12ZbfCcGtNk+dDAZNGWvHov+PIOnY9Prjg8h/wLRrT69suaMVZ5bNuK00lSVpnqSX1NON/81FoP92rYndionwgOiA8WMf4vc8l15KqEEG4yAm2+WAN5Brfu1sq9suWYqgoajgOYt/JCk1gC8wPkK+XKCtRX6TAtgvrnuBgNRmn6I8lVDipOVB9kX6Oxkp4ZKyd1M6Gj8/v2U7k+YQBL95Kb9PQENucJb0JlW3b5tObN7m/Z1j1ev388d7o15zgXsI9CikAGAViR6lkJv7nb4Ak40M2G8TJ447kN+pvfHiOFjSUSP6PM+QfbAywKJCBaxSVxpizHseZUyUBhq59vFwrkyGoRiHbo0apweEZeSLuNiQ+HAekOnarFg00dZNXaPeoHPTRR0FmEyqYExOVaaaO8c0uFUh7U4e/UxdBmthlBDgg257Q33j1hA7HTxSeTTSuVnPZbgW1nodwmG16aKBDKxEetv7D9OjO0JhrbJTnoe+kcGoDJazFSO8/fUN9Jy/g4XK5PUkw2dgPDGpJqBfhe7GA+cjzfE/EGsMM+FV9nj9IAhrSfT/J3QE5TEIYyk5UjsI6ZZcCPr6A8FZUF4g9nnpVmjX90MLSQysIPD0nFzqwCcSJmIb5mYv2Cmk+C1MDFkZQyCBq4c/Yai9LJ6xYkGS/x2s5/frIW2vmG2Wrv0APpCdgCA9snFvfpe8uc0OwdRs4G9973PGEBnQB5qKrCQ6m6X/H7NInZ7y/1674/ZXOVp7OeuCRk8JFS516VHrnH1HkIUIlTIljjHaQtEtkJtosYul77cVwjk3gW1Ajaa6zWeyHGLlpk3VHE2VFzT2yI/EvlGUSz2H9zYE1s4nsKMtMqNyKNtL/59CpFJki5Fou6VXGm8vWATEPwrUVOLvoA8jLuwOzVBCgHB2Cr5V6OwEWtJEKokJkfc87h+sNHTvMb0KVTp5284QTPupoWvQVUwUeogZR3kBMESYo0mfukewRVPKh5+rzLQb7HKjFFIgWhj1w3yN/qCNoPI8XFiUgBNT1hCHBsAz8L7Oyt8wQWUFj92ONn/APyJFg8hzueqoJdNj57ROrFbffuS/XxrSXLTRgj5uxZjpgQYceeMc2wJrahReSKpm3QjHfqExTLAB2ipVumE8pqcZv8LYXQiPHHsgb5BMW8zM5pvQit+mQx8XGaVDcfVbLyMTlY8xcfmm/RSAT/H09UQol5gIz7rESDmnrQ4bURIB4iRXMDQwxgex1GgtDxKp2HayIkR+E/aDmCttNm2C6lytWdfOVzD6X2SpDWjQDlMRvAp1symWv4my1bPCD+E1EmGnMGWhNwmycJnDV2WrQNxO45ukEb08AAffizYKVULp15I4vbNK5DzWwCSUADfmKhfGSUqii1L2UsE8rB7mLuHuUJZOx4+WiizHBJ/hwboaBzhpNOVvgFTf5cJsHef7L1HCI9dOUUbb+YxUJWn6dYOLz+THi91kzY5dtO5c+grX7v0jEbsuoOGnoIreDIg/sFMyG+TyCLIcAWd1IZ1UNFxE8Uie13ucm40U2fcxC0u3WLvLOxwu+F7MWUsHsdtFQZ7W+nlfCASiAKyh8rnP3EyDByvtJb6Kax6/HkLzT9SyEyTMVM1zPtM0MJY14DmsWh4MgD15Ea9Hd00AdkTZ0EiG5NAGuIBzQJJ0JR0na+OB7lQA6UKxMfihIQ7GCCnVz694QvykWXTxpS2soDu+smru1UdIxSvAszBFD1c8c6ZOobA8bJiJIvuycgIXBQIXWwhyTgZDQxJTRXgEwRNAawGSXO0a1DKjdihLVNp/taE/xYhsgwe+VpKEEB4LlraQyE84gEihxCnbfoyOuJIEXy2FIYw+JjRusybKlU2g/vhTSGTydvCvXhYBdtAXtS2v7LkHtmXh/8fly1do8FI/D0f8UbzVb5h+KRhMGSAmR2mhi0YG/uj7wgxcfzCrMvdjitUIpXDX8ae2JcF/36qUWIMwN6JsjaRGNj+jEteGDcFyTUb8X/NHSucKMJp7pduxtD6KuxVlyxxwaeiC1FbGBESO84lbyrAugYxdl+2N8/6AgWpo/IeoAOcsG35IA/b3AuSyoa55L7llBLlaWlEWvuCFd8f8NfcTUgzJv6CbB+6ohWwodlk9nGWFpBAOaz5uEW5xBvmjnHFeDsb0mXwayj3mdYq5gxxNf3H3/tnCgHwjSrpSgVxLmiTtuszdRUFIsn6LiMPjL808vL1uQhDbM7aA43mISXReqjSskynIRcHCJ9qeFopJfx9tqyUoGbSwJex/0aDE3plBPGtNBYgWbdLom3+Q/bjdizR2/AS/c/dH/d3G7pyl1qDXgtOFtEqidwLqxPYtrNEveasWq3vPUUtqTeu8gpov4bdOQRI2kneFvRNMrShyVeEupK1PoLDPMSfWMIJcs267mGB8X9CehQCF0gIyhpP10mbyM7lwW1e6TGvHBV1sg/UyTghHPGRqMyaebC6pbB1WKNCQtlai1GGvmq9zUKaUzLaXsXEBYtHxmFbEZ2kJhR164LhWW2Tlp1dhsGE7ZgIWRBOx3Zcu2DxgH+G83WTPceKG0TgQKKiiNNOlWgvqNEbnrk6fVD+AqRam2OguZb0YWSTX88N+i/ELSxbaUUpPx4vJUzYg/WonSeA8xUK6u7DPHgpqWpEe6D4cXg5uK9FIYVba47V/nb+wyOtk+zG8RrS4EA0ouwa04iByRLSvoJA2FzaobbZtXnq8GdbfqEp5I2dpfpj59TCVif6+E75p665faiX8gS213RqBxTZqfHP46nF6NSenOneuT+vgbLUbdTH2/t0REFXZJOEB6DHvx6N6g9956CYrY/AYcm9gELJXYkrSi+0F0geKDZgOCIYkLU/+GOW5aGj8mvLFgtFH5+XC8hvAE3CvHRfl4ofM/Qwk4x2A+R+nyc9gNu/9Tem7XW4XRnyRymf52z09cTOdr+PG6+P/Vb4QiXlwauc5WB1z3o+IJjlbxI8MyWtSzT+k4sKVbhF3xa+vDts3NxXa87iiu+xRH9cAprnOL2h6vV54iQRXuOAj1s8nLFK8gZ70ThIQcWdF19/2xaJmT0efrkNDkWbpAQPdo92Z8+Hn/aLjbOzB9AI/k12fPs9HhUNDJ1u6ax2VxD3R6PywN7BrLJ26z6s3QoMp76qzzwetrDABKSGkfW5PwS1GvYNUbK6uRqxfyVGNyFB0E+OugMM8kKwmJmupuRWO8XkXXXQECyRVw9UyIrtCtcc4oNqXqr7AURBmKn6Khz3eBN96LwIJrAGP9mr/59uTOSx631suyT+QujDd4beUFpZ0kJEEnjlP+X/Kr2kCKhnENTg4BsMTOmMqlj2WMFLRUlVG0fzdCBgUta9odrJfpVdFomTi6ak0tFjXTcdqqvWBAzjY6hVrH9sbt3Z9gn+AVDpTcQImefbB4edirjzrsNievve4ZT4EUZWV3TxEsIW+9MT/RJoKfZZYSRGfC1CwPG/9rdMOM8qR/LUYvw5f/emUSoD7YSFuOoqchdUg2UePd1eCtFSKgxLSZ764oy4lvRCIH6bowPxZWwxNFctksLeil47pfevcBipkkBIc4ngZG+kxGZ71a72KQ7VaZ6MZOZkQJZXM6kb/Ac0/XkJx8dvyfJcWbI3zONEaEPIW8GbkYjsZcwy+eMoKrYjDmvEEixHzkCSCRPRzhOfJZuLdcbx19EL23MA8rnjTZZ787FGMnkqnpuzB5/90w1gtUSRaWcb0eta8198VEeZMUSfIhyuc4/nywFQ9uqn7jdqXh+5wwv+RK9XouNPbYdoEelNGo34KyySwigsrfCe0v/PlWPvQvQg8R0KgHO18mTVThhQrlbEQ0Kp/JxPdjHyR7E1QPw/ut0r+HDDG7BwZFm9IqEUZRpv2WpzlMkOemeLcAt5CsrzskLGaVOAxyySzZV/D2EY7ydNZMf8e8VhHcKGHAWNszf1EOq8fNstijMY4JXyATwTdncFFqcNDfDo+mWFvxJJpc4sEZtjXyBdoFcxbUmniCoKq5jydUHNjYJxMqN1KzYV62MugcELVhS3Bnd+TLLOh7dws/zSXWzxEb4Nj4aFun5x4kDWLK5TUF/yCXB/cZYvI9kPgVsG2jShtXkxfgT+xzjJofXqPEnIXIQ1lnIdmVzBOM90EXvJUW6a0nZ/7XjJGl8ToO3H/fdxnxmTNKBZxnkpXLVgLXCZywGT3YyS75w/PAH5I/jMuRspej8xZObU9kREbRA+kqjmKRFaKGWAmFQspC+QLbKPf0RaK3OXvBSWqo46p70ws/eZpu6jCtZUgQy6r4tHMPUdAgWGGUYNbuv/1a6K+MVFsd3T183+T8capSo6m0+Sh57fEeG/95dykGJBQMj09DSW2bY0mUonDy9a8trLnnL5B5LW3Nl8rJZNysO8Zb+80zXxqUGFpud3Qzwb7bf+8mq6x0TAnJU9pDQR9YQmZhlna2xuxJt0aCO/f1SU8gblOrbIyMsxTlVUW69VJPzYU2HlRXcqE2lLLxnObZuz2tT9CivfTAUYfmzJlt/lOPgsR6VN64/xQd4Jlk/RV7UKVv2Gx/AWsmTAuCWKhdwC+4HmKEKYZh2Xis4KsUR1BeObs1c13wqFRnocdmuheaTV30gvVXZcouzHKK5zwrN52jXJEuX6dGx3BCpV/++4f3hyaW/cQJLFKqasjsMuO3B3WlMq2gyYfdK1e7L2pO/tRye2mwzwZPfdUMrl5wdLqdd2Kv/wVtnpyWYhd49L6rsOV+8HXPrWH2Kup89l2tz6bf80iYSd+V4LROSOHeamvexR524q4r43rTmtFzQvArpvWfLYFZrbFspBsXNUqqenjxNNsFXatZvlIhk7teUPfK+YL32F8McTnjv0BZNppb+vshoCrtLXjIWq3EJXpVXIlG6ZNL0dh6qEm2WMwDjD3LfOfkGh1/czYc/0qhiD2ozNnH4882MVVt3JbVFkbwowNCO3KL5IoYW5wlVeGCViOuv1svZx7FbzxKzA4zGqBlRRaRWCobXaVq4yYCWbZf8eiJwt3OY+MFiSJengcFP2t0JMfzOiJ7cECvpx7neg1Rc5x+7myPJOXt2FohVRyXtD+/rDoTOyGYInJelZMjolecVHUhUNqvdZWg2J2t0jPmiLFeRD/8fOT4o+NGILb+TufCo9ceBBm3JLVn+MO2675n7qiEX/6W+188cYg3Zn5NSTjgOKfWFSAANa6raCxSoVU851oJLY11WIoYK0du0ec5E4tCnAPoKh71riTsjVIp3gKvBbEYQiNYrmH22oLQWA2AdwMnID6PX9b58dR2QKo4qag1D1Z+L/FwEKTR7osOZPWECPJIHQqPUsM5i/CH5YupVPfFA5pHUBcsesh8eO5YhyWnaVRPZn/BmdXVumZWPxMP5e28zm2uqHgFoT9CymHYNNrzrrjlXZM06HnzDxYNlI5b/QosxLmmrqDFqmogQdqk0WLkUceoAvQxHgkIyvWU69BPFr24VB6+lx75Rna6dGtrmOxDnvBojvi1/4dHjVeg8owofPe1cOnxU1ioh016s/Vudv9mhV9f35At+Sh28h1bpp8xhr09+vf47Elx3Ms6hyp6QvB3t0vnLbOhwo660cp7K0vvepabK7YJfxEWWfrC2YzJfYOjygPwfwd/1amTqa0hZ5ueebhWYVMubRTwIjj+0Oq0ohU3zfRfuL8gt59XsHdwKtxTQQ4Y2qz6gisxnm2UdlmpEkgOsZz7iEk6QOt8BuPwr+NR01LTqXmJo1C76o1N274twJvl+I069TiLpenK/miRxhyY8jvYV6W1WuSwhH9q7kuwnJMtm7IWcqs7HsnyHSqWXLSpYtZGaR1V3t0gauninFPZGtWskF65rtti48UV9uV9KM8kfDYs0pgB00S+TlzTXV6P8mxq15b9En8sz3jWSszcifZa/NuufPNnNTb031pptt0+sRSH/7UG8pzbsgtt3OG3ut7B9JzDMt2mTZuyRNIV8D54TuTrpNcHtgmMlYJeiY9XS83NYJicjRjtJSf9BZLsQv629QdDsKQhTK5CnXhpk7vMNkHzPhm0ExW/VCGApHfPyBagtZQTQmPHx7g5IXXsrQDPzIVhv2LB6Ih138iSDww1JNHrDvzUxvp73MsQBVhW8EbrReaVUcLB1R3PUXyaYG4HpJUcLVxMgDxcPkVRQpL7VTAGabDzbKcvg12t5P8TSGQkrj/gOrpnbiDHwluA73xbXts/L7u468cRWSWRtgTwlQnA47EKg0OiZDgFxAKQQUcsbGomITgeXUAAyKe03eA7Mp4gnyKQmm0LXJtEk6ddksMJCuxDmmHzmVhO+XaN2A54MIh3niw5CF7PwiXFZrnA8wOdeHLvvhdoqIDG9PDI7UnWWHq526T8y6ixJPhkuVKZnoUruOpUgOOp3iIKBjk+yi1vHo5cItHXb1PIKzGaZlRS0g5d3MV2pD8FQdGYLZ73aae/eEIUePMc4NFz8pIUfLCrrF4jVWH5gQneN3S8vANBmUXrEcKGn6hIUN95y1vpsvLwbGpzV9L0ZKTan6TDXM05236uLJcIEMKVAxKNT0K8WljuwNny3BNQRfzovA85beI9zr1AGNYnYCVkR1aGngWURUrgqR+gRrQhxW81l3CHevjvGEPzPMTxdsIfB9dfGRbZU0cg/1mcubtECX4tvaedmNAvTxCJtc2QaoUalGfENCGK7IS/O8CRpdOVca8EWCRwv2sSWE8CJPW5PCugjCXPd3h6U60cPD+bdhtXZuYB6stcoveE7Sm5MM2yvfUHXFSW7KzLmi7/EeEWL0wqcOH9MOSKjhCHHmw+JGLcYE/7SBZQCRggox0ZZTAxrlzNNXYXL5fNIjkdT4YMqVUz6p8YDt049v4OXGdg3qTrtLBUXOZf7ahPlZAY/O+7Sp0bvGSHdyQ8B1LOsplqMb9Se8VAE7gIdSZvxbRSrfl+Lk5Qaqi5QJceqjitdErcHXg/3MryljPSIAMaaloFm1cVwBJ8DNmkDqoGROSHFetrgjQ5CahuKkdH5pRPigMrgTtlFI8ufJPJSUlGgTjbBSvpRc0zypiUn6U5KZqcRoyrtzhmJ7/caeZkmVRwJQeLOG8LY6vP5ChpKhc8Js0El+n6FXqbx9ItdtLtYP92kKfaTLtCi8StLZdENJa9Ex1nOoz1kQ7qxoiZFKRyLf4O4CHRT0T/0W9F8epNKVoeyxUXhy3sQMMsJjQJEyMOjmOhMFgOmmlscV4eFi1CldU92yjwleirEKPW3bPAuEhRZV7JsKV3Lr5cETAiFuX5Nw5UlF7d2HZ96Bh0sgFIL5KGaKSoVYVlvdKpZJVP5+NZ7xDEkQhmDgsDKciazJCXJ6ZN2B3FY2f6VZyGl/t4aunGIAk/BHaS+i+SpdRfnB/OktOvyjinWNfM9Ksr6WwtCa1hCmeRI6icpFM4o8quCLsikU0tMoZI/9EqXRMpKGaWzofl4nQuVQm17d5fU5qXCQeCDqVaL9XJ9qJ08n3G3EFZS28SHEb3cdRBdtO0YcTzil3QknNKEe/smQ1fTb0XbpyNB5xAeuIlf+5KWlEY0DqJbsnzJlQxJPOVyHiKMx5Xu9FcEv1Fbg6Fhm4t+Jyy5JC1W3YO8dYLsO0PXPbxodBgttTbH3rt9Cp1lJIk2r3O1Zqu94eRbnIz2f50lWolYzuKsj4PMok4abHLO8NAC884hiXx5Fy5pWKO0bWL7uEGXaJCtznhP67SlQ4xjWIfgq6EpZ28QMtuZK7JC0RGbl9nA4XtFLug/NLMoH1pGt9IonAJqcEDLyH6TDROcbsmGPaGIxMo41IUAnQVPMPGByp4mOmh9ZQMkBAcksUK55LsZj7E5z5XuZoyWCKu6nHmDq22xI/9Z8YdxJy4kWpD16jLVrpwGLWfyOD0Wd+cBzFBxVaGv7S5k9qwh/5t/LQEXsRqI3Q9Rm3QIoaZW9GlsDaKOUyykyWuhNOprSEi0s1G4rgoiX1V743EELti+pJu5og6X0g6oTynUqlhH9k6ezyRi05NGZHz0nvp3HOJr7ebrAUFrDjbkFBObEvdQWkkUbL0pEvMU46X58vF9j9F3j6kpyetNUBItrEubW9ZvMPM4qNqLlsSBJqOH3XbNwv/cXDXNxN8iFLzUhteisYY+RlHYOuP29/Cb+L+xv+35Rv7xudnZ6ohK4cMPfCG8KI7dNmjNk/H4e84pOxn/sZHK9psfvj8ncA8qJz7O8xqbxESDivGJOZzF7o5PJLQ7g34qAWoyuA+x3btU98LT6ZyGyceIXjrqob2CAVql4VOTQPUQYvHV/g4zAuCZGvYQBtf0wmd5lilrvuEn1BXLny01B4h4SMDlYsnNpm9d7m9h578ufpef9Z4WplqWQvqo52fyUA7J24eZD5av6SyGIV9kpmHNqyvdfzcpEMw97BvknV2fq+MFHun9BT3Lsf8pbzvisWiIQvYkng+8Vxk1V+dli1u56kY50LRjaPdotvT5BwqtwyF+emo/z9J3yVUVGfKrxQtJMOAQWoQii/4dp9wgybSa5mkucmRLtEQZ/pz0tL/NVcgWAd95nEQ3Tg6tNbuyn3Iepz65L3huMUUBntllWuu4DbtOFSMSbpILV4fy6wlM0SOvi6CpLh81c1LreIvKd61uEWBcDw1lUBUW1I0Z+m/PaRlX+PQ/oxg0Ye6KUiIiTF4ADNk59Ydpt5/rkxmq9tV5Kcp/eQLUVVmBzQNVuytQCP6Ezd0G8eLxWyHpmZWJ3bAzkWTtg4lZlw42SQezEmiUPaJUuR/qklVA/87S4ArFCpALdY3QRdUw3G3XbWUp6aq9z0zUizcPa7351p9JXOZyfdZBFnqt90VzQndXB/mwf8LC9STj5kenVpNuqOQQP3mIRJj7eV21FxG8VAxKrEn3c+XfmZ800EPb9/5lIlijscUbB6da0RQaMook0zug1G0tKi/JBC4rw7/D3m4ARzAkzMcVrDcT2SyFtUdWAsFlsPDFqV3N+EjyXaoEePwroaZCiLqEzb8MW+PNE9TmTC01EzWli51PzZvUqkmyuROU+V6ik+Le/9qT6nwzUzf9tP68tYei0YaDGx6kAd7jn1cKqOCuYbiELH9zYqcc4MnRJjkeGiqaGwLImhyeKs+xKJMBlOJ05ow9gGCKZ1VpnMKoSCTbMS+X+23y042zOb5MtcY/6oBeAo1Vy89OTyhpavFP78jXCcFH0t7Gx24hMEOm2gsEfGabVpQgvFqbQKMsknFRRmuPHcZu0Su/WMFphZvB2r/EGbG72rpGGho3h+Msz0uGzJ7hNK2uqQiE1qmn0zgacKYYZBCqsxV+sjbpoVdSilW/b94n2xNb648VmNIoizqEWhBnsen+d0kbCPmRItfWqSBeOd9Wne3c6bcd6uvXOJ6WdiSsuXq0ndhqrQ4QoWUjCjYtZ0EAhnSOP1m44xkf0O7jXghrzSJWxP4a/t72jU29Vu2rvu4n7HfHkkmQOMGSS+NPeLGO5I73mC2B7+lMiBQQZRM9/9liLIfowupUFAbPBbR+lxDM6M8Ptgh1paJq5Rvs7yEuLQv/7d1oU2woFSb3FMPWQOKMuCuJ7pDDjpIclus5TeEoMBy2YdVB4fxmesaCeMNsEgTHKS5WDSGyNUOoEpcC2OFWtIRf0w27ck34/DjxRTVIcc9+kqZE6iMSiVDsiKdP/Xz5XfEhm/sBhO50p1rvJDlkyyxuJ9SPgs7YeUJBjXdeAkE+P9OQJm6SZnn1svcduI78dYmbkE2mtziPrcjVisXG78spLvbZaSFx/Rks9zP4LKn0Cdz/3JsetkT06A8f/yCgMO6Mb1Hme0JJ7b2wZz1qleqTuKBGokhPVUZ0dVu+tnQYNEY1fmkZSz6+EGZ5EzL7657mreZGR3jUfaEk458PDniBzsSmBKhDRzfXameryJv9/D5m6HIqZ0R+ouCE54Dzp4IJuuD1e4Dc5i+PpSORJfG23uVgqixAMDvchMR0nZdH5brclYwRoJRWv/rlxGRI5ffD5NPGmIDt7vDE1434pYdVZIFh89Bs94HGGJbTwrN8T6lh1HZFTOB4lWzWj6EVqxSMvC0/ljWBQ3F2kc/mO2b6tWonT2JEqEwFts8rz2h+oWNds9ceR2cb7zZvJTDppHaEhK5avWqsseWa2Dt5BBhabdWSktS80oMQrL4TvAM9b5HMmyDnO+OkkbMXfUJG7eXqTIG6lqSOEbqVR+qYdP7uWb57WEJqzyh411GAVsDinPs7KvUeXItlcMdOUWzXBH6zscymV1LLVCtc8IePojzXHF9m5b5zGwBRdzcyUJkiu938ApmAayRdJrX1PmVguWUvt2ThQ62czItTyWJMW2An/hdDfMK7SiFQlGIdAbltHz3ycoh7j9V7GxNWBpbtcSdqm4XxRwTawc3cbZ+xfSv9qQfEkDKfZTwCkqWGI/ur250ItXlMlh6vUNWEYIg9A3GzbgmbqvTN8js2YMo87CU5y6nZ4dbJLDQJj9fc7yM7tZzJDZFtqOcU8+mZjYlq4VmifI23iHb1ZoT9E+kT2dolnP1AfiOkt7PQCSykBiXy5mv637IegWSKj9IKrYZf4Lu9+I7ub+mkRdlvYzehh/jaJ9n7HUH5b2IbgeNdkY7wx1yVzxS7pbvky6+nmVUtRllEFfweUQ0/nG017WoUYSxs+j2B4FV/F62EtHlMWZXYrjGHpthnNb1x66LKZ0Qe92INWHdfR/vqp02wMS8r1G4dJqHok8KmQ7947G13a4YXbsGgHcBvRuVu1eAi4/A5+ZixmdSXM73LupB/LH7O9yxLTVXJTyBbI1S49TIROrfVCOb/czZ9pM4JsZx8kUz8dQGv7gUWKxXvTH7QM/3J2OuXXgciUhqY+cgtaOliQQVOYthBLV3xpESZT3rmfEYNZxmpBbb24CRao86prn+i9TNOh8VxRJGXJfXHATJHs1T5txgc/opYrY8XjlGQQbRcoxIBcnVsMjmU1ymmIUL4dviJXndMAJ0Yet+c7O52/p98ytlmAsGBaTAmMhimAnvp1TWNGM9BpuitGj+t810CU2UhorrjPKGtThVC8WaXw04WFnT5fTjqmPyrQ0tN3CkLsctVy2xr0ZWgiWVZ1OrlFjjxJYsOiZv2cAoOvE+7sY0I/TwWcZqMoyIKNOftwP7w++Rfg67ljfovKYa50if3fzE/8aPYVey/Nq35+nH2sLPh/fP5TsylSKGOZ4k69d2PnH43+kq++sRXHQqGArWdwhx+hpwQC6JgT2uxehYU4Zbw7oNb6/HLikPyJROGK2ouyr+vzseESp9G50T4AyFrSqOQ0rroCYP4sMDFBrHn342EyZTMlSyk47rHSq89Y9/nI3zG5lX16Z5lxphguLOcZUndL8wNcrkyjH82jqg8Bo8OYkynrxZvbFno5lUS3OPr8Ko3mX9NoRPdYOKKjD07bvgFgpZ/RF+YzkWvJ/Hs/tUbfeGzGWLxNAjfDzHHMVSDwB5SabQLsIZHiBp43FjGkaienYoDd18hu2BGwOK7U3o70K/WY/kuuKdmdrykIBUdG2mvE91L1JtTbh20mOLbk1vCAamu7utlXeGU2ooVikbU/actcgmsC1FKk2qmj3GWeIWbj4tGIxE7BLcBWUvvcnd/lYxsMV4F917fWeFB/XbINN3qGvIyTpCalz1lVewdIGqeAS/gB8Mi+sA+BqDiX3VGD2eUunTRbSY+AuDy4E3Qx3hAhwnSXX+B0zuj3eQ1miS8Vux2z/l6/BkWtjKGU72aJkOCWhGcSf3+kFkkB15vGOsQrSdFr6qTj0gBYiOlnBO41170gOWHSUoBVRU2JjwppYdhIFDfu7tIRHccSNM5KZOFDPz0TGMAjzzEpeLwTWp+kn201kU6NjbiMQJx83+LX1e1tZ10kuChJZ/XBUQ1dwaBHjTDJDqOympEk8X2M3VtVw21JksChA8w1tTefO3RJ1FMbqZ01bHHkudDB/OhLfe7P5GOHaI28ZXKTMuqo0hLWQ4HabBsGG7NbP1RiXtETz074er6w/OerJWEqjmkq2y51q1BVI+JUudnVa3ogBpzdhFE7fC7kybrAt2Z6RqDjATAUEYeYK45WMupBKQRtQlU+uNsjnzj6ZmGrezA+ASrWxQ6LMkHRXqXwNq7ftv28dUx/ZSJciDXP2SWJsWaN0FjPX9Yko6LobZ7aYW/IdUktI9apTLyHS8DyWPyuoZyxN1TK/vtfxk3HwWh6JczZC8Ftn0bIJay2g+n5wd7lm9rEsKO+svqVmi+c1j88hSCxbzrg4+HEP0Nt1/B6YW1XVm09T1CpAKjc9n18hjqsaFGdfyva1ZG0Xu3ip6N6JGpyTSqY5h4BOlpLPaOnyw45PdXTN+DtAKg7DLrLFTnWusoSBHk3s0d7YouJHq85/R09Tfc37ENXZF48eAYLnq9GLioNcwDZrC6FW6godB8JnqYUPvn0pWLfQz0lM0Yy8Mybgn84Ds3Q9bDP10bLyOV+qzxa4Rd9Dhu7cju8mMaONXK3UqmBQ9qIg7etIwEqM/kECk/Dzja4Bs1xR+Q/tCbc8IKrSGsTdJJ0vge7IG20W687uVmK6icWQ6cD3lwFzgNMGtFvO5qyJeKflGLAAcQZOrkxVwy3cWvqlGpvjmf9Qe6Ap20MPbV92DPV0OhFM4kz8Yr0ffC2zLWSQ1kqY6QdQrttR3kh1YLtQd1kCEv5hVoPIRWl5ERcUTttBIrWp6Xs5Ehh5OUUwI5aEBvuiDmUoENmnVw1FohCrbRp1A1E+XSlWVOTi7ADW+5Ohb9z1vK4qx5R5lPdGCPBJZ00mC+Ssp8VUbgpGAvXWMuWQQRbCqI6Rr2jtxZxtfP7W/8onz+yz0Gs76LaT5HX9ecyiZCB/ZR/gFtMxPsDwohoeCRtiuLxE1GM1vUEUgBv86+eehL58/P56QFGQ/MqOe/vC76L63jzmeax4exd/OKTUvkXg+fOJUHych9xt/9goJMrapSgvXrj8+8vk/N80f22Sewj6cyGqt1B6mztoeklVHHraouhvHJaG/OuBz6DHKMpFmQULU1bRWlyYE0RPXYYkUycIemN7TLtgNCJX6BqdyxDKkegO7nJK5xQ7OVYDZTMf9bVHidtk6DQX9Et+V9M7esgbsYBdEeUpsB0Xvw2kd9+rI7V+m47u+O/tq7mw7262HU1WlS9uFzsV6JxIHNmUCy0QS9e077JGRFbG65z3/dOKB/Zk+yDdKpUmdXjn/aS3N5nv4fK7bMHHmPlHd4E2+iTbV5rpzScRnxk6KARuDTJ8Q1LpK2mP8gj1EbuJ9RIyY+EWK4hCiIDBAS1Tm2IEXAFfgKPgdL9O6mAa06wjCcUAL6EsxPQWO9VNegBPm/0GgkZbDxCynxujX/92vmGcjZRMAY45puak2sFLCLSwXpEsyy5fnF0jGJBhm+fNSHKKUUfy+276A7/feLOFxxUuHRNJI2Osenxyvf8DAGObT60pfTTlhEg9u/KKkhJqm5U1/+BEcSkpFDA5XeCqxwXmPac1jcuZ3JWQ+p0NdWzb/5v1ZvF8GtMTFFEdQjpLO0bwPb0BHNWnip3liDXI2fXf05jjvfJ0NpjLCUgfTh9CMFYVFKEd4Z/OG/2C+N435mnK+9t1gvCiVcaaH7rK4+PjCvpVNiz+t2QyqH1O8x3JKZVl6Q+Lp/XK8wMjVMslOq9FdSw5FtUs/CptXH9PW+wbWHgrV17R5jTVOtGtKFu3nb80T+E0tv9QkzW3J2dbaw/8ddAKZ0pxIaEqLjlPrji3VgJ3GvdFvlqD8075woxh4fVt0JZE0KVFsAvqhe0dqN9b35jtSpnYMXkU+vZq+IAHad3IHc2s/LYrnD1anfG46IFiMIr9oNbZDWvwthqYNqOigaKd/XlLU4XHfk/PXIjPsLy/9/kAtQ+/wKH+hI/IROWj5FPvTZAT9f7j4ZXQyG4M0TujMAFXYkKvEHv1xhySekgXGGqNxWeWKlf8dDAlLuB1cb/qOD+rk7cmwt+1yKpk9cudqBanTi6zTbXRtV8qylNtjyOVKy1HTz0GW9rjt6sSjAZcT5R+KdtyYb0zyqG9pSLuCw5WBwAn7fjBjKLLoxLXMI+52L9cLwIR2B6OllJZLHJ8vDxmWdtF+QJnmt1rsHPIWY20lftk8fYePkAIg6Hgn532QoIpegMxiWgAOfe5/U44APR8Ac0NeZrVh3gEhs12W+tVSiWiUQekf/YBECUy5fdYbA08dd7VzPAP9aiVcIB9k6tY7WdJ1wNV+bHeydNtmC6G5ICtFC1ZwmJU/j8hf0I8TRVKSiz5oYIa93EpUI78X8GYIAZabx47/n8LDAAJ0nNtP1rpROprqKMBRecShca6qXuTSI3jZBLOB3Vp381B5rCGhjSvh/NSVkYp2qIdP/Bg="},{}],6:[function(t,e,n){var i=t("./dictionary-browser");n.init=function(){n.dictionary=i.init()},n.offsetsByLength=new Uint32Array([0,0,0,0,0,4096,9216,21504,35840,44032,53248,63488,74752,87040,93696,100864,104704,106752,108928,113536,115968,118528,119872,121280,122016]),n.sizeBitsByLength=new Uint8Array([0,0,0,0,10,10,11,11,10,10,10,10,10,9,9,8,7,7,8,7,7,6,6,5,5]),n.minDictionaryWordLength=4,n.maxDictionaryWordLength=24},{"./dictionary-browser":4}],7:[function(t,e,n){function i(t,e){this.bits=t,this.value=e}n.HuffmanCode=i;var r=15;function s(t,e){for(var n=1<<e-1;t&n;)n>>=1;return(t&n-1)+n}function a(t,e,n,r,s){do{t[e+(r-=n)]=new i(s.bits,s.value)}while(r>0)}function o(t,e,n){for(var i=1<<e-n;e<r&&!((i-=t[e])<=0);)++e,i<<=1;return e-n}n.BrotliBuildHuffmanTable=function(t,e,n,l,h){var c,u,d,p,f,m,g,v,y,x,b=e,_=new Int32Array(16),S=new Int32Array(16);for(x=new Int32Array(h),u=0;u<h;u++)_[l[u]]++;for(S[1]=0,c=1;c<r;c++)S[c+1]=S[c]+_[c];for(u=0;u<h;u++)0!==l[u]&&(x[S[l[u]]++]=u);if(y=v=1<<(g=n),1===S[15]){for(d=0;d<y;++d)t[e+d]=new i(0,65535&x[0]);return y}for(d=0,u=0,c=1,p=2;c<=n;++c,p<<=1)for(;_[c]>0;--_[c])a(t,e+d,p,v,new i(255&c,65535&x[u++])),d=s(d,c);for(m=y-1,f=-1,c=n+1,p=2;c<=r;++c,p<<=1)for(;_[c]>0;--_[c])(d&m)!==f&&(e+=v,y+=v=1<<(g=o(_,c,n)),t[b+(f=d&m)]=new i(g+n&255,e-b-f&65535)),a(t,e+(d>>n),p,v,new i(c-n&255,65535&x[u++])),d=s(d,c);return y}},{}],8:[function(t,e,n){n.byteLength=function(t){var e=l(t),n=e[0],i=e[1];return 3*(n+i)/4-i},n.toByteArray=function(t){for(var e,n=l(t),i=n[0],a=n[1],o=new s(function(t,e,n){return 3*(e+n)/4-n}(0,i,a)),h=0,c=a>0?i-4:i,u=0;u<c;u+=4)e=r[t.charCodeAt(u)]<<18|r[t.charCodeAt(u+1)]<<12|r[t.charCodeAt(u+2)]<<6|r[t.charCodeAt(u+3)],o[h++]=e>>16&255,o[h++]=e>>8&255,o[h++]=255&e;2===a&&(e=r[t.charCodeAt(u)]<<2|r[t.charCodeAt(u+1)]>>4,o[h++]=255&e);1===a&&(e=r[t.charCodeAt(u)]<<10|r[t.charCodeAt(u+1)]<<4|r[t.charCodeAt(u+2)]>>2,o[h++]=e>>8&255,o[h++]=255&e);return o},n.fromByteArray=function(t){for(var e,n=t.length,r=n%3,s=[],a=16383,o=0,l=n-r;o<l;o+=a)s.push(c(t,o,o+a>l?l:o+a));1===r?(e=t[n-1],s.push(i[e>>2]+i[e<<4&63]+"==")):2===r&&(e=(t[n-2]<<8)+t[n-1],s.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"="));return s.join("")};for(var i=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)i[o]=a[o],r[a.charCodeAt(o)]=o;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function h(t){return i[t>>18&63]+i[t>>12&63]+i[t>>6&63]+i[63&t]}function c(t,e,n){for(var i,r=[],s=e;s<n;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),r.push(h(i));return r.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},{}],9:[function(t,e,n){function i(t,e){this.offset=t,this.nbits=e}n.kBlockLengthPrefixCode=[new i(1,2),new i(5,2),new i(9,2),new i(13,2),new i(17,3),new i(25,3),new i(33,3),new i(41,3),new i(49,4),new i(65,4),new i(81,4),new i(97,4),new i(113,5),new i(145,5),new i(177,5),new i(209,5),new i(241,6),new i(305,6),new i(369,7),new i(497,8),new i(753,9),new i(1265,10),new i(2289,11),new i(4337,12),new i(8433,13),new i(16625,24)],n.kInsertLengthPrefixCode=[new i(0,0),new i(1,0),new i(2,0),new i(3,0),new i(4,0),new i(5,0),new i(6,1),new i(8,1),new i(10,2),new i(14,2),new i(18,3),new i(26,3),new i(34,4),new i(50,4),new i(66,5),new i(98,5),new i(130,6),new i(194,7),new i(322,8),new i(578,9),new i(1090,10),new i(2114,12),new i(6210,14),new i(22594,24)],n.kCopyLengthPrefixCode=[new i(2,0),new i(3,0),new i(4,0),new i(5,0),new i(6,0),new i(7,0),new i(8,0),new i(9,0),new i(10,1),new i(12,1),new i(14,2),new i(18,2),new i(22,3),new i(30,3),new i(38,4),new i(54,4),new i(70,5),new i(102,5),new i(134,6),new i(198,7),new i(326,8),new i(582,9),new i(1094,10),new i(2118,24)],n.kInsertRangeLut=[0,0,8,8,0,16,8,16,16],n.kCopyRangeLut=[0,8,0,8,16,0,16,8,16]},{}],10:[function(t,e,n){function i(t){this.buffer=t,this.pos=0}function r(t){this.buffer=t,this.pos=0}i.prototype.read=function(t,e,n){this.pos+n>this.buffer.length&&(n=this.buffer.length-this.pos);for(var i=0;i<n;i++)t[e+i]=this.buffer[this.pos+i];return this.pos+=n,n},n.BrotliInput=i,r.prototype.write=function(t,e){if(this.pos+e>this.buffer.length)throw new Error("Output buffer is not large enough");return this.buffer.set(t.subarray(0,e),this.pos),this.pos+=e,e},n.BrotliOutput=r},{}],11:[function(t,e,n){var i=t("./dictionary"),r=10,s=11;function a(t,e,n){this.prefix=new Uint8Array(t.length),this.transform=e,this.suffix=new Uint8Array(n.length);for(var i=0;i<t.length;i++)this.prefix[i]=t.charCodeAt(i);for(i=0;i<n.length;i++)this.suffix[i]=n.charCodeAt(i)}var o=[new a("",0,""),new a("",0," "),new a(" ",0," "),new a("",12,""),new a("",r," "),new a("",0," the "),new a(" ",0,""),new a("s ",0," "),new a("",0," of "),new a("",r,""),new a("",0," and "),new a("",13,""),new a("",1,""),new a(", ",0," "),new a("",0,", "),new a(" ",r," "),new a("",0," in "),new a("",0," to "),new a("e ",0," "),new a("",0,'"'),new a("",0,"."),new a("",0,'">'),new a("",0,"\n"),new a("",3,""),new a("",0,"]"),new a("",0," for "),new a("",14,""),new a("",2,""),new a("",0," a "),new a("",0," that "),new a(" ",r,""),new a("",0,". "),new a(".",0,""),new a(" ",0,", "),new a("",15,""),new a("",0," with "),new a("",0,"'"),new a("",0," from "),new a("",0," by "),new a("",16,""),new a("",17,""),new a(" the ",0,""),new a("",4,""),new a("",0,". The "),new a("",s,""),new a("",0," on "),new a("",0," as "),new a("",0," is "),new a("",7,""),new a("",1,"ing "),new a("",0,"\n\t"),new a("",0,":"),new a(" ",0,". "),new a("",0,"ed "),new a("",20,""),new a("",18,""),new a("",6,""),new a("",0,"("),new a("",r,", "),new a("",8,""),new a("",0," at "),new a("",0,"ly "),new a(" the ",0," of "),new a("",5,""),new a("",9,""),new a(" ",r,", "),new a("",r,'"'),new a(".",0,"("),new a("",s," "),new a("",r,'">'),new a("",0,'="'),new a(" ",0,"."),new a(".com/",0,""),new a(" the ",0," of the "),new a("",r,"'"),new a("",0,". This "),new a("",0,","),new a(".",0," "),new a("",r,"("),new a("",r,"."),new a("",0," not "),new a(" ",0,'="'),new a("",0,"er "),new a(" ",s," "),new a("",0,"al "),new a(" ",s,""),new a("",0,"='"),new a("",s,'"'),new a("",r,". "),new a(" ",0,"("),new a("",0,"ful "),new a(" ",r,". "),new a("",0,"ive "),new a("",0,"less "),new a("",s,"'"),new a("",0,"est "),new a(" ",r,"."),new a("",s,'">'),new a(" ",0,"='"),new a("",r,","),new a("",0,"ize "),new a("",s,"."),new a("Â ",0,""),new a(" ",0,","),new a("",r,'="'),new a("",s,'="'),new a("",0,"ous "),new a("",s,", "),new a("",r,"='"),new a(" ",r,","),new a(" ",s,'="'),new a(" ",s,", "),new a("",s,","),new a("",s,"("),new a("",s,". "),new a(" ",s,"."),new a("",s,"='"),new a(" ",s,". "),new a(" ",r,'="'),new a(" ",s,"='"),new a(" ",r,"='")];function l(t,e){return t[e]<192?(t[e]>=97&&t[e]<=122&&(t[e]^=32),1):t[e]<224?(t[e+1]^=32,2):(t[e+2]^=5,3)}n.kTransforms=o,n.kNumTransforms=o.length,n.transformDictionaryWord=function(t,e,n,a,h){var c,u=o[h].prefix,d=o[h].suffix,p=o[h].transform,f=p<12?0:p-11,m=0,g=e;f>a&&(f=a);for(var v=0;v<u.length;)t[e++]=u[v++];for(n+=f,a-=f,p<=9&&(a-=p),m=0;m<a;m++)t[e++]=i.dictionary[n+m];if(c=e-a,p===r)l(t,c);else if(p===s)for(;a>0;){var y=l(t,c);c+=y,a-=y}for(var x=0;x<d.length;)t[e++]=d[x++];return e-g}},{"./dictionary":6}],12:[function(t,e,n){e.exports=t("./dec/decode").BrotliDecompressBuffer},{"./dec/decode":3}]},{},[12])(12)});const _v=(null==xv.exports?{}:xv.exports).default||xv.exports,Sv=(null==xv.exports?{}:xv.exports).lookup,wv=(null==xv.exports?{}:xv.exports).lookupOffsets,Tv=(null==xv.exports?{}:xv.exports).BrotliDecompressedSize,Mv=(null==xv.exports?{}:xv.exports).BrotliDecompressBuffer,Av=(null==xv.exports?{}:xv.exports).BrotliDecompress,Ev=(null==xv.exports?{}:xv.exports).init,Cv=(null==xv.exports?{}:xv.exports).dictionary,Pv=(null==xv.exports?{}:xv.exports).offsetsByLength,Rv=(null==xv.exports?{}:xv.exports).sizeBitsByLength,Iv=(null==xv.exports?{}:xv.exports).minDictionaryWordLength,Ov=(null==xv.exports?{}:xv.exports).maxDictionaryWordLength,Dv=(null==xv.exports?{}:xv.exports).HuffmanCode,Bv=(null==xv.exports?{}:xv.exports).BrotliBuildHuffmanTable,Fv=(null==xv.exports?{}:xv.exports).byteLength,Lv=(null==xv.exports?{}:xv.exports).toByteArray,Uv=(null==xv.exports?{}:xv.exports).fromByteArray,kv=(null==xv.exports?{}:xv.exports).kBlockLengthPrefixCode,Nv=(null==xv.exports?{}:xv.exports).kInsertLengthPrefixCode,zv=(null==xv.exports?{}:xv.exports).kCopyLengthPrefixCode,Gv=(null==xv.exports?{}:xv.exports).kInsertRangeLut,Hv=(null==xv.exports?{}:xv.exports).kCopyRangeLut,Vv=(null==xv.exports?{}:xv.exports).BrotliInput,Xv=(null==xv.exports?{}:xv.exports).BrotliOutput,Wv=(null==xv.exports?{}:xv.exports).kTransforms,jv=(null==xv.exports?{}:xv.exports).kNumTransforms,Yv=(null==xv.exports?{}:xv.exports).transformDictionaryWord,qv=Object.freeze(Object.defineProperty({__proto__:null,BrotliBuildHuffmanTable:Bv,BrotliDecompress:Av,BrotliDecompressBuffer:Mv,BrotliDecompressedSize:Tv,BrotliInput:Vv,BrotliOutput:Xv,HuffmanCode:Dv,byteLength:Fv,default:_v,dictionary:Cv,fromByteArray:Uv,init:Ev,kBlockLengthPrefixCode:kv,kCopyLengthPrefixCode:zv,kCopyRangeLut:Hv,kInsertLengthPrefixCode:Nv,kInsertRangeLut:Gv,kNumTransforms:jv,kTransforms:Wv,lookup:Sv,lookupOffsets:wv,maxDictionaryWordLength:Ov,minDictionaryWordLength:Iv,offsetsByLength:Pv,sizeBitsByLength:Rv,toByteArray:Lv,transformDictionaryWord:Yv},Symbol.toStringTag,{value:"Module"}));let Kv=_v||qv;function Jv(t,e){return Kv(function(t){let e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i}(t))}function Zv(t,e,n){let i,r,s=t.gltf,a=t.bin,o=t.textures;var l,h;function c(){void 0!==r&&void 0!==i&&("none"!==r&&(i=i.replace("scene.bin",r)),o.forEach(t=>{let e=new RegExp(t.name,"g");i=i.replace(e,t.uri)}),e.parse(i,"",t=>{n(t)}))}s=s.slice(13),a&&(a=a.slice(13)),(l=s,new Promise(function(t,e){t(new TextDecoder("utf-8").decode(Jv(l)))})).then(function(t){i=t,c()}),a?(h=a,new Promise(function(t,e){t(Jv(h).buffer)})).then(function(t){r="data:application/octet-stream;base64,"+function(t){let e="",n=new Uint8Array(t),i=n.byteLength;for(let r=0;r<i;r++)e+=String.fromCharCode(n[r]);return window.btoa(e)}(t),c()}):(r="none",c())}function Qv(t,e=1,n="object"){const i=t.replace(/^#/,"");let r,s,a,o=255;if(6===i.length)r=parseInt(i.substring(0,2),16),s=parseInt(i.substring(2,4),16),a=parseInt(i.substring(4,6),16);else{if(8!==i.length)throw new Error("Invalid hex color format");r=parseInt(i.substring(0,2),16),s=parseInt(i.substring(2,4),16),a=parseInt(i.substring(4,6),16),o=parseInt(i.substring(6,8),16)}const l=t=>Math.round(t/255*e);return"array"===n?[l(r),l(s),l(a),l(o)]:{r:l(r),g:l(s),b:l(a),a:l(o)}}Kv=Kv.default||Kv;class $v{static init(){this.list={},this.iconList={},this.initDefaults(),this.snapshotList={}}static add(t,e){this.list[t]=e}static remove(t){delete this.list[t]}static get(t,e=!1){let n=this.list[t];return!n&&e&&(n=this.create(t,"basic")),n}static addCommonUniforms(t){let e=t;return["uniform float time","uniform float deltaTime","uniform vec2 resolution"].forEach(n=>{t.includes(n)||(e=`${n};\n${e}`)}),e}static async updateShader(t,e){const n=this.get(t);if(n&&e){n.fragmentShaderReady=!1,n.vertexShaderReady=!1;let t="void main() {\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }";e.vertexShader&&(t=cy.getItem(e.vertexShader)||t);let i="void main() {\n                gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n            }";e.fragmentShader&&(i=cy.getItem(e.fragmentShader)||i),i=this.addCommonUniforms(i),t=this.addCommonUniforms(t),n.fragmentShader=i,n.vertexShader=t,n.needsUpdate=!0,n.fragmentShaderReady=!0,n.vertexShaderReady=!0;for(const r in e.uniforms)if(Object.prototype.hasOwnProperty.call(e.uniforms,r)){const t=e.uniforms[r];if(void 0!==t.value)if("sampler2D"===t.type){const e=cy.getTexture(t.value);e instanceof Promise?e.then(t=>(n.uniforms[r]={value:t},t)).catch(()=>{n.uniforms[r]={value:null}}):n.uniforms[r]={value:e}}else if("color"===t.type){const e=Qv(t.value,1,"array");n.uniforms[r]={value:e}}else n.uniforms[r]={value:t.value}}return n.uniforms.time||(n.uniforms.time={value:0}),n.uniforms.deltaTime||(n.uniforms.deltaTime={value:0}),n.uniforms.resolution||(n.uniforms.resolution={value:{x:window.innerWidth,y:window.innerHeight}}),n}}static update(t,e){var n,i;const r=this.get(t),s=new Set(["color","id","name","type","userData","transparent","opacity","side","visible","depthWrite","depthTest","depthFunc","blending","alphaTest","isDirty","specularColor","envMapColor","envMapRotation","emissive"]);if(r&&e){const a=JSON.parse(JSON.stringify(e));r.originalData=a;const{maps:o,...l}=e;if(r.userData.maps=[],r.userData={...r.userData,...l},"shader"===e.type)return this.updateShader(t,e);r.color.set(e.color||16777215),r.transparent=e.transparent||!1,r.opacity=e.opacity||1,r.side=e.side||0,r.visible=e.visible||!0,r.depthWrite=e.depthWrite||!1,r.depthTest=e.depthTest||!1,r.depthFunc=e.depthFunc||0,r.blending=Number(e.blending||0),r.alphaTest=e.alphaTest||0,null==(n=r.specularColor)||n.set(e.specularColor||16777215),null==(i=r.envMapColor)||i.set(e.envMapColor||16777215),e.envMapRotation&&(r.envMapRotation=new Wf(r.envMapRotation.x,r.envMapRotation.y,r.envMapRotation.z,r.envMapRotation.order)),Array.isArray(r.normalScale)&&(r.normalScale={x:r.normalScale[0],y:r.normalScale[1]}),r.isDirty=e.isDirty||!1;const h=Object.fromEntries(Object.entries(e).filter(([t])=>!s.has(t)&&!t.endsWith("Map")&&"map"!==t));Object.assign(r,h);for(const t in e)if(t.endsWith("Map")||"map"===t){r.userData.maps.push(t);let n=e[t];if(n){const i=cy.getTexture(n);if(i instanceof Promise)i.then(n=>{const i=e[t+"_data"];return i&&(n.repeat={...i.repeat},n.wrapS=i.wrapS,n.wrapT=i.wrapT,n.flipY=i.flipY,n.colorSpace=i.colorSpace,n.needsUpdate=!0),r[t]=n,n}).catch(()=>{r[t]=null});else{const n=e[t+"_data"];n&&(i.repeat={...n.repeat},i.wrapS=n.wrapS,i.wrapT=n.wrapT,i.flipY=n.flipY,i.colorSpace=n.colorSpace,i.needsUpdate=!0),r[t]=i}}else r[t]=null}}return r}static create(t,e,n){let i;switch(e){case"basic":i=new Qi,i.type="MeshBasicMaterial";break;case"lambert":i=new ou,i.type="MeshLambertMaterial";break;case"phong":i=new ru,i.type="MeshPhongMaterial";break;case"standard":i=new nu,i.type="MeshStandardMaterial";break;case"sprite":i=new $o,i.type="SpriteMaterial";break;case"matcap":i=new lu,i.type="MeshMatcapMaterial";break;case"toon":i=new su,i.type="MeshToonMaterial";break;case"shader":i=new Hr,i.type="ShaderMaterial";break;case"physical":i=new iu,i.type="MeshPhysicalMaterial";break;default:i=new Zi}return this.add(t,i),this.update(t,n),i}static addToShapsotList(t,e){this.snapshotList[t]||(this.snapshotList[t]=e)}static initDefaults(){this.create("default_mat_basic","basic"),this.create("default_mat_phong","phong"),this.create("default_mat_standard","standard"),this.create("default_mat_lambert","lambert")}static initFromTemplate(t){t.forEach(t=>{this.create(t.uuid,t.type,t.params)})}}n($v,"list"),n($v,"iconList"),n($v,"snapshotList"),$v.init();class ty{static multiplyParticleScale(t,e,n=!1){const i=[];for(let r=0;r<t.length;r++){const s=t[r],{startSize:a,startSpeed:o}=s.system;let l;const h=[];for(let t=0;t<s.system.behaviors.length;t++){const e=s.system.behaviors[t];"ApplyForce"===e.type&&(l=e.magnitude);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(!n)continue;if(n.x&&!n.w)h.push(n);else for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const e=n[t];if(!e)continue;e.x&&!n.w&&h.push(e)}}}if(n)for(let t=0;t<h.length;t++){const t=h[r];t.orgVek||(t.orgVek=t.clone()),t.copy(t.orgVek),t.multiplyScalar(e)}i.push(a,o,l),s.orgPos||(s.orgPos=s.position.clone()),s.orgScale||(s.orgScale=s.scale.clone()),s.position.copy(s.orgPos),s.position.multiplyScalar(e);const c=s.system.emitterShape;Number.isFinite(c.radius)&&(c.orgRadius||(c.orgRadius=c.radius),c.radius=c.orgRadius,c.radius*=e);for(const t of i)this.changeProperty(t,e)}}static changeProperty(t,e,n=!0){if(t instanceof pm)n&&(t.orgVal||(t.orgVal=t.value),t.value=t.orgVal),t.value*=e;else if(t instanceof fm)n&&(t.orgVal||(t.orgVal={a:t.a,b:t.b}),t.a=t.orgVal.a,t.b=t.orgVal.b),t.a*=e,t.b*=e;else if(t instanceof gm){const n=t.functions[0][0].p;t.orgVals||(t.orgVals=[...n]);for(let i=0;i<n.length;i++)n[i]=t.orgVals[i]*e}}}class ey extends Oi{constructor(t,e){super(),this.add(t),this.emitterList=e,this.stop(!0)}addToScene(t){t.add(this),t.quarksScene&&(t.quarksScene.add(this),this.quarksScene=t.quarksScene)}destroy(){this.stop()}restart(){for(let t=0;t<this.emitterList.length;t++){this.emitterList[t].system.restart()}}trigger(t=1){for(let e=0;e<this.emitterList.length;e++){let n=this.emitterList[e];n.system.looping=!1,n.system.spawn(t)}}emit(){for(let t=0;t<this.emitterList.length;t++){this.emitterList[t].system.play()}}stop(t){for(let e=0;e<this.emitterList.length;e++){let n=this.emitterList[e];t?(n.system.restart(),n.system.pause(),n.system.endEmit()):n.system.endEmit()}}setPos(t){for(let e=0;e<this.emitterList.length;e++){this.emitterList[e].position.copy(t)}}changeLife(t){for(let e=0;e<this.emitterList.length;e++){this.emitterList[e].system.startLife.value=t}}changeForce(t,e){let n;for(let i=0;i<this.emitterList.length;i++){let r=this.emitterList[i];r.system.startSpeed;for(let t=0;t<r.system.behaviors.length;t++){let e=r.system.behaviors[t];if("ApplyForce"===e.type){n=e;break}}n&&(n.magnitude.value=t,e&&n.direction.copy(e))}}changeColor(t){let e=new THREE.Color(t);for(let n=0;n<this.emitterList.length;n++){let t=this.emitterList[n].system.startColor;t.color.x=e.r,t.color.y=e.g,t.color.z=e.b}}multiplyParticleScale(t,e=!1){ty.multiplyParticleScale(this.emitterList,t,e)}}function ny(t){return function(t){const e=new Map,n=new Map,i=new Map,r=t.clone();return iy(t,r,function(t,e){n.set(e,t),i.set(t,e)}),r.traverse(function(t){if(!t.isSkinnedMesh)return;const r=t,s=n.get(t),a=s.skeleton.bones,o=function(t){const e=Array.isArray(t)?t:t.bones,n=t.boneInverses;function i(t){return{name:t.name,children:t.children.filter(t=>e.includes(t)).map(i)}}const r=new Set(e),s=e.filter(t=>!t.parent||!r.has(t.parent));return JSON.stringify({hierarchy:s.map(i),inverses:null==n?void 0:n.map(t=>t.elements).flat().slice(0,10)})}(s.skeleton),l=e.get(o);l?(r.bindMatrix.copy(s.bindMatrix),r.bind(l,r.bindMatrix)):(r.skeleton=s.skeleton.clone(),r.bindMatrix.copy(s.bindMatrix),r.skeleton.bones=a.map(function(t){return i.get(t)}),e.set(o,r.skeleton),r.bind(r.skeleton,r.bindMatrix))}),r}(t)}function iy(t,e,n){n(t,e);for(let i=0;i<t.children.length;i++)iy(t.children[i],e.children[i],n)}const ry=new class extends Du{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Cp(t)}),this.register(function(t){return new Pp(t)}),this.register(function(t){return new kp(t)}),this.register(function(t){return new Np(t)}),this.register(function(t){return new zp(t)}),this.register(function(t){return new Ip(t)}),this.register(function(t){return new Op(t)}),this.register(function(t){return new Dp(t)}),this.register(function(t){return new Bp(t)}),this.register(function(t){return new Ep(t)}),this.register(function(t){return new Fp(t)}),this.register(function(t){return new Rp(t)}),this.register(function(t){return new Up(t)}),this.register(function(t){return new Lp(t)}),this.register(function(t){return new Mp(t)}),this.register(function(t){return new Gp(t)}),this.register(function(t){return new Hp(t)})}load(t,e,n,i){const r=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const e=od.extractUrlBase(t);s=od.resolveURL(e,this.path)}else s=od.extractUrlBase(t);this.manager.itemStart(t);const a=function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)},o=new Lu(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(n){try{r.parse(n,s,function(n){e(n),r.manager.itemEnd(t)},a)}catch(i){a(i)}},n,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let r;const s={},a={},o=new TextDecoder;if("string"==typeof t)r=JSON.parse(t);else if(t instanceof ArrayBuffer){if(o.decode(new Uint8Array(t,0,4))===Vp){try{s[Tp.KHR_BINARY_GLTF]=new jp(t)}catch(h){return void(i&&i(h))}r=JSON.parse(s[Tp.KHR_BINARY_GLTF].content)}else r=JSON.parse(o.decode(t))}else r=t;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new xf(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const t=this.pluginCallbacks[c](l);t.name,a[t.name]=t,s[t.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const t=r.extensionsUsed[c],e=r.extensionsRequired||[];switch(t){case Tp.KHR_MATERIALS_UNLIT:s[t]=new Ap;break;case Tp.KHR_DRACO_MESH_COMPRESSION:s[t]=new Yp(r,this.dracoLoader);break;case Tp.KHR_TEXTURE_TRANSFORM:s[t]=new qp;break;case Tp.KHR_MESH_QUANTIZATION:s[t]=new Kp;break;default:e.indexOf(t)>=0&&a[t]}}l.setExtensions(s),l.setPlugins(a),l.parse(n,i)}parseAsync(t,e){const n=this;return new Promise(function(i,r){n.parse(t,e,i,r)})}};ry.setMeshoptDecoder(_f);const sy=new class extends Nu{constructor(t){super(t),this.type=vt}parse(t){const e=function(t,e){switch(t){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(e||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(e||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(e||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(e||""))}},n=function(t,e,n){e=e||1024;let i=t.pos,r=-1,s=0,a="",o=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));for(;0>(r=o.indexOf("\n"))&&s<e&&i<t.byteLength;)a+=o,s+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));return-1<r&&(t.pos+=s+r+1,a+o.slice(0,r))},i=function(t,e,n,i){const r=t[e+3],s=Math.pow(2,r-128)/255;n[i+0]=t[e+0]*s,n[i+1]=t[e+1]*s,n[i+2]=t[e+2]*s,n[i+3]=1},r=function(t,e,n,i){const r=t[e+3],s=Math.pow(2,r-128)/255;n[i+0]=ir.toHalfFloat(Math.min(t[e+0]*s,65504)),n[i+1]=ir.toHalfFloat(Math.min(t[e+1]*s,65504)),n[i+2]=ir.toHalfFloat(Math.min(t[e+2]*s,65504)),n[i+3]=ir.toHalfFloat(1)},s=new Uint8Array(t);s.pos=0;const a=function(t){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,h;for((t.pos>=t.byteLength||!(l=n(t)))&&e(1,"no header found"),(h=l.match(/^#\?(\S+)/))||e(3,"bad initial token"),o.valid|=1,o.programtype=h[1],o.string+=l+"\n";l=n(t),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((h=l.match(i))&&(o.gamma=parseFloat(h[1])),(h=l.match(r))&&(o.exposure=parseFloat(h[1])),(h=l.match(s))&&(o.valid|=2,o.format=h[1]),(h=l.match(a))&&(o.valid|=4,o.height=parseInt(h[1],10),o.width=parseInt(h[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid||e(3,"missing format specifier"),4&o.valid||e(3,"missing image size specifier"),o}(s),o=a.width,l=a.height,h=function(t,n,i){const r=n;if(r<8||r>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);r!==(t[2]<<8|t[3])&&e(3,"wrong scanline width");const s=new Uint8Array(4*n*i);s.length||e(4,"unable to allocate buffer space");let a=0,o=0;const l=4*r,h=new Uint8Array(4),c=new Uint8Array(l);let u=i;for(;u>0&&o<t.byteLength;){o+4>t.byteLength&&e(1),h[0]=t[o++],h[1]=t[o++],h[2]=t[o++],h[3]=t[o++],2==h[0]&&2==h[1]&&(h[2]<<8|h[3])==r||e(3,"bad rgbe scanline format");let n,i=0;for(;i<l&&o<t.byteLength;){n=t[o++];const r=n>128;if(r&&(n-=128),(0===n||i+n>l)&&e(3,"bad scanline data"),r){const e=t[o++];for(let t=0;t<n;t++)c[i++]=e}else c.set(t.subarray(o,o+n),i),i+=n,o+=n}const d=r;for(let t=0;t<d;t++){let e=0;s[a]=c[t+e],e+=r,s[a+1]=c[t+e],e+=r,s[a+2]=c[t+e],e+=r,s[a+3]=c[t+e],a+=4}u--}return s}(s.subarray(s.pos),o,l);let c,u,d;switch(this.type){case gt:d=h.length/4;const t=new Float32Array(4*d);for(let n=0;n<d;n++)i(h,4*n,t,4*n);c=t,u=gt;break;case vt:d=h.length/4;const e=new Uint16Array(4*d);for(let n=0;n<d;n++)r(h,4*n,e,4*n);c=e,u=vt;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:o,height:l,data:c,header:a.string,gamma:a.gamma,exposure:a.exposure,type:u}}setDataType(t){return this.type=t,this}load(t,e,n,i){return super.load(t,function(t,n){switch(t.type){case gt:case vt:t.colorSpace=xe,t.minFilter=ht,t.magFilter=ht,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,n)},n,i)}},ay=new ku,oy=new zu,ly={};class hy{static get(t){return ly[t]}static getModel(t,e){let n=ly[t];if(!n){const e=gv.getMappedAsset("model",t);e&&(n={...ly[e]})}return n&&(n={...n},n.scene=ny(n.scene)),n}static getQuarks(t,e){let n=ly[t];if(!n){const e=gv.getMappedAsset("quarks",t);e&&(n=ly[e])}if(n){let t=n.index,e=n.pool[t];return t=(t+1)%n.maxLen,n.index=t,{particle:e,emitterList:e.emitterList,key:n.key}}}static getModelPathFromUUID(t){var e;return null==(e=ly[t])?void 0:e.modelPath}static getModelUUIDFromPath(t){var e;return null==(e=ly[t])?void 0:e.modelPath}static getModelFromStuffs(t,e){const n=ly[t];if(!n)return null;const i={...n};return i&&(i.scene=vv(i.scene)),i}static getTexture(t,e){let n=ly[t];if(!n){const e=gv.getMappedAsset("texture",t);e&&(n=ly[e])}return n}static getMaterial(t){const e=gv.getMappedAsset("material",t);return $v.get(e)||$v.get(t)}static getItem(t){return ly[t]}static syncTextureSettings(t){var e,n;const i=[],r=Object.keys(t);for(const s of r){const a=t[s];if(!a.scene||!(null==(e=a.parser)?void 0:e.textureCache))continue;const o=Object.entries(a.parser.textureCache);for(const[e,s]of o){const a=null==(n=e.split(":")[0].split("/").pop())?void 0:n.split(".")[0];a&&i.push(s.then(e=>{var n,i,s;for(const o of r){const r=t[o],l=null==(i=null==(n=null==r?void 0:r.source)?void 0:n.data)?void 0:i.src;if(!l)continue;const h=null==(s=l.split("/").pop())?void 0:s.split(".")[0];a===h&&Object.assign(r,{colorSpace:e.colorSpace,flipY:e.flipY,repeat:{...e.repeat},wrapS:e.wrapS,wrapT:e.wrapT,needsUpdate:!0})}}))}}Promise.all(i).catch(console.error)}static load(t){return new Promise((e,n)=>{const i=t.length;let r=0;const s={};0===i&&e(s);const a=(t,n)=>{r++,s[t]=n,ly[t]=n,r===i&&(o(),e(s))},o=()=>{hy.syncTextureSettings(s)};t.forEach(t=>{switch(t.type){case"texture":this.loadTexture(t.key,t.src).then(e=>{a(t.key,e)});break;case"gltf":this.loadGLTF(t.key,t.src).then(e=>{a(t.key,e)});break;case"brotliGltf":this.loadBrotliGLTF(t.key,t.src).then(e=>{a(t.key,e)});break;case"glb":this.loadGlb(t.key,t.src).then(e=>{a(t.key,e)});break;case"quarks":this.loadQuarks(t.key,t.src).then(e=>{a(t.key,e)});break;case"hdr":this.loadHDR(t.key,t.src).then(e=>{a(t.key,e)});break;case"cubemap":this.loadCubeMap(t.key,t.list).then(e=>{a(t.key,e)});break;case"vertexShader":this.loadVertexShader(t.key,t.src).then(e=>{a(t.key,e)});break;case"fragmentShader":this.loadFragmentShader(t.key,t.src).then(e=>{a(t.key,e)})}})})}static async loadTexture(t,e){return oy.load(e)}static async loadGLTF(t,e){return e.startsWith("assets")?new Promise((n,i)=>{ry.load(e,e=>{e.modelUUID=t,n(e)})}):new Promise((t,n)=>{ry.parse(e,"",e=>{t(e)})})}static async loadBrotliGLTF(t,e){return new Promise((n,i)=>{Zv(e,ry,e=>{e.modelUUID=t,n(e)})})}static async loadGlb(t,e){return new Promise((t,n)=>{ry.load(e,e=>{t(e)})})}static getModelAnimations(t){if(ly[t])return ly[t].animations}static async loadQuarks(t,e){const n=[],i=[];for(let r=0;r<e.amount;r++)n.push(qg.loadQuarks(e.src));await Promise.all(n).then(t=>{t.forEach(t=>{let e=new ey(t.particle,t.emitterList);i.push(e)})});return{index:0,maxLen:e.amount,pool:i,key:t}}static async loadHDR(t,e){return new Promise(t=>{sy.load(e,e=>{e.mapping=tt,t(e)})})}static async loadVertexShader(t,e){if(e.startsWith("assets"))return new Promise(t=>{fetch(e).then(t=>t.text()).then(e=>{t(e)})})}static async loadFragmentShader(t,e){if(e.startsWith("assets"))return new Promise(t=>{fetch(e).then(t=>t.text()).then(e=>{t(e)})})}static loadEnvironmentMap(t){}static loadCubeMap(t,e){return new Promise(t=>{ay.load(e,e=>{e.mapping=Q,t(e)})})}}const cy=hy;class uy extends nd{constructor(t=16777215,e=.5){super(t,e),this.initComponentSystem()}}const dy={},py=function(t,e,n){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),n=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));i=Promise.all(e.map(t=>{if((t=function(t){return"/"+t}(t))in dy)return;dy[t]=!0;const e=t.endsWith(".css"),i=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${i}`))return;const r=document.createElement("link");return r.rel=e?"stylesheet":"modulepreload",e||(r.as="script",r.crossOrigin=""),r.href=t,n&&r.setAttribute("nonce",n),document.head.appendChild(r),e?new Promise((e,n)=>{r.addEventListener("load",e),r.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}return i.then(()=>t()).catch(t=>{const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t})};var fy=(t=>(t.Application="application",t.WebGLPipes="webgl-pipes",t.WebGLPipesAdaptor="webgl-pipes-adaptor",t.WebGLSystem="webgl-system",t.WebGPUPipes="webgpu-pipes",t.WebGPUPipesAdaptor="webgpu-pipes-adaptor",t.WebGPUSystem="webgpu-system",t.CanvasSystem="canvas-system",t.CanvasPipesAdaptor="canvas-pipes-adaptor",t.CanvasPipes="canvas-pipes",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t.MaskEffect="mask-effect",t.BlendMode="blend-mode",t.TextureSource="texture-source",t.Environment="environment",t.ShapeBuilder="shape-builder",t.Batcher="batcher",t))(fy||{});const my=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},gy=(t,e)=>my(t).priority??e,vy={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(my).forEach(t=>{t.type.forEach(e=>{var n,i;return null==(i=(n=this._removeHandlers)[e])?void 0:i.call(n,t)})}),this},add(...t){return t.map(my).forEach(t=>{t.type.forEach(e=>{var n,i;const r=this._addHandlers,s=this._queue;r[e]?null==(i=r[e])||i.call(r,t):(s[e]=s[e]||[],null==(n=s[e])||n.push(t))})}),this},handle(t,e,n){var i;const r=this._addHandlers,s=this._removeHandlers;if(r[t]||s[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,s[t]=n;const a=this._queue;return a[t]&&(null==(i=a[t])||i.forEach(t=>e(t)),delete a[t]),this},handleByMap(t,e){return this.handle(t,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByNamedList(t,e,n=-1){return this.handle(t,t=>{e.findIndex(e=>e.name===t.name)>=0||(e.push({name:t.name,value:t.ref}),e.sort((t,e)=>gy(e.value,n)-gy(t.value,n)))},t=>{const n=e.findIndex(e=>e.name===t.name);-1!==n&&e.splice(n,1)})},handleByList(t,e,n=-1){return this.handle(t,t=>{e.includes(t.ref)||(e.push(t.ref),e.sort((t,e)=>gy(e,n)-gy(t,n)))},t=>{const n=e.indexOf(t.ref);-1!==n&&e.splice(n,1)})},mixin(t,...e){for(const n of e)Object.defineProperties(t.prototype,Object.getOwnPropertyDescriptors(n))}},yy={extension:{type:fy.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await py(()=>Promise.resolve().then(()=>b6),void 0)}},xy={extension:{type:fy.Environment,name:"webworker",priority:0},test:()=>"undefined"!=typeof self&&void 0!==self.WorkerGlobalScope,load:async()=>{await py(()=>Promise.resolve().then(()=>_6),void 0)}};class by{constructor(t,e,n){this._x=e||0,this._y=n||0,this._observer=t}clone(t){return new by(t??this._observer,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}var _y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Sy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wy={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,i,s,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new r(i,s||t,a),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function a(t,e){0===--t._eventsCount?t._events=new i:delete t._events[e]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),o.prototype.eventNames=function(){var t,i,r=[];if(0===this._eventsCount)return r;for(i in t=this._events)e.call(t,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},o.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,s=i.length,a=new Array(s);r<s;r++)a[r]=i[r].fn;return a},o.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},o.prototype.emit=function(t,e,i,r,s,a){var o=n?n+t:t;if(!this._events[o])return!1;var l,h,c=this._events[o],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,r),!0;case 5:return c.fn.call(c.context,e,i,r,s),!0;case 6:return c.fn.call(c.context,e,i,r,s,a),!0}for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var d,p=c.length;for(h=0;h<p;h++)switch(c[h].once&&this.removeListener(t,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,e);break;case 3:c[h].fn.call(c[h].context,e,i);break;case 4:c[h].fn.call(c[h].context,e,i,r);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];c[h].fn.apply(c[h].context,l)}}return!0},o.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},o.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},o.prototype.removeListener=function(t,e,i,r){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||r&&!o.once||i&&o.context!==i||a(this,s);else{for(var l=0,h=[],c=o.length;l<c;l++)(o[l].fn!==e||r&&!o[l].once||i&&o[l].context!==i)&&h.push(o[l]);h.length?this._events[s]=1===h.length?h[0]:h:a(this,s)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o}(wy);const Ty=Sy(wy.exports),My=2*Math.PI,Ay=180/Math.PI,Ey=Math.PI/180;class Cy{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Cy(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Py.x=0,Py.y=0,Py}}const Py=new Cy;class Ry{constructor(t=1,e=0,n=0,i=1,r=0,s=0){this.array=null,this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=s}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,n,i,r,s){return this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=s,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,e){e=e||new Cy;const n=t.x,i=t.y;return e.x=this.a*n+this.c*i+this.tx,e.y=this.b*n+this.d*i+this.ty,e}applyInverse(t,e){e=e||new Cy;const n=this.a,i=this.b,r=this.c,s=this.d,a=this.tx,o=this.ty,l=1/(n*s+r*-i),h=t.x,c=t.y;return e.x=s*l*h+-r*l*c+(o*r-a*s)*l,e.y=n*l*c+-i*l*h+(-o*n+a*i)*l,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.a,r=this.c,s=this.tx;return this.a=i*e-this.b*n,this.b=i*n+this.b*e,this.c=r*e-this.d*n,this.d=r*n+this.d*e,this.tx=s*e-this.ty*n,this.ty=s*n+this.ty*e,this}append(t){const e=this.a,n=this.b,i=this.c,r=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*n+t.b*r,this.c=t.c*e+t.d*i,this.d=t.c*n+t.d*r,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*n+t.ty*r+this.ty,this}appendFrom(t,e){const n=t.a,i=t.b,r=t.c,s=t.d,a=t.tx,o=t.ty,l=e.a,h=e.b,c=e.c,u=e.d;return this.a=n*l+i*c,this.b=n*h+i*u,this.c=r*l+s*c,this.d=r*h+s*u,this.tx=a*l+o*c+e.tx,this.ty=a*h+o*u+e.ty,this}setTransform(t,e,n,i,r,s,a,o,l){return this.a=Math.cos(a+l)*r,this.b=Math.sin(a+l)*r,this.c=-Math.sin(a-o)*s,this.d=Math.cos(a-o)*s,this.tx=t-(n*this.a+i*this.c),this.ty=e-(n*this.b+i*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,n=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,n=this.b,i=this.c,r=this.d,s=t.pivot,a=-Math.atan2(-i,r),o=Math.atan2(n,e),l=Math.abs(a+o);return l<1e-5||Math.abs(My-l)<1e-5?(t.rotation=o,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=o),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(i*i+r*r),t.position.x=this.tx+(s.x*e+s.y*i),t.position.y=this.ty+(s.x*n+s.y*r),t}invert(){const t=this.a,e=this.b,n=this.c,i=this.d,r=this.tx,s=t*i-e*n;return this.a=i/s,this.b=-e/s,this.c=-n/s,this.d=t/s,this.tx=(n*this.ty-i*r)/s,this.ty=-(t*this.ty-e*r)/s,this}isIdentity(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Ry;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return Oy.identity()}static get shared(){return Iy.identity()}}const Iy=new Ry,Oy=new Ry,Dy=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],By=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Fy=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ly=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Uy=[],ky=[],Ny=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];Uy.push(e);for(let n=0;n<16;n++){const i=Ny(Dy[t]*Dy[n]+Fy[t]*By[n]),r=Ny(By[t]*Dy[n]+Ly[t]*By[n]),s=Ny(Dy[t]*Fy[n]+Fy[t]*Ly[n]),a=Ny(By[t]*Fy[n]+Ly[t]*Ly[n]);for(let t=0;t<16;t++)if(Dy[t]===i&&By[t]===r&&Fy[t]===s&&Ly[t]===a){e.push(t);break}}}for(let t=0;t<16;t++){const e=new Ry;e.set(Dy[t],By[t],Fy[t],Ly[t],0,0),ky.push(e)}}();const zy={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>Dy[t],uY:t=>By[t],vX:t=>Fy[t],vY:t=>Ly[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>Uy[t][e],sub:(t,e)=>Uy[t][zy.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?zy.S:zy.N:2*Math.abs(e)<=Math.abs(t)?t>0?zy.E:zy.W:e>0?t>0?zy.SE:zy.SW:t>0?zy.NE:zy.NW,matrixAppendRotationInv:(t,e,n=0,i=0)=>{const r=ky[zy.inv(e)];r.tx=n,r.ty=i,t.append(r)}},Gy=[new Cy,new Cy,new Cy,new Cy];class Hy{constructor(t=0,e=0,n=0,i=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(i)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Hy(0,0,0,0)}clone(){return new Hy(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}strokeContains(t,e,n,i=.5){const{width:r,height:s}=this;if(r<=0||s<=0)return!1;const a=this.x,o=this.y,l=n*(1-i),h=n-l;return t>=a-l&&t<=a+r+l&&e>=o-l&&e<=o+s+l&&!(t>a+h&&t<a+r-h&&e>o+h&&e<o+s-h)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const n=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>n}const n=this.left,i=this.right,r=this.top,s=this.bottom;if(i<=n||s<=r)return!1;const a=Gy[0].set(t.left,t.top),o=Gy[1].set(t.left,t.bottom),l=Gy[2].set(t.right,t.top),h=Gy[3].set(t.right,t.bottom);if(l.x<=a.x||o.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c)return!1;if(e.apply(a,a),e.apply(o,o),e.apply(l,l),e.apply(h,h),Math.max(a.x,o.x,l.x,h.x)<=n||Math.min(a.x,o.x,l.x,h.x)>=i||Math.max(a.y,o.y,l.y,h.y)<=r||Math.min(a.y,o.y,l.y,h.y)>=s)return!1;const u=c*(o.y-a.y),d=c*(a.x-o.x),p=u*n+d*r,f=u*i+d*r,m=u*n+d*s,g=u*i+d*s;if(Math.max(p,f,m,g)<=u*a.x+d*a.y||Math.min(p,f,m,g)>=u*h.x+d*h.y)return!1;const v=c*(a.y-l.y),y=c*(l.x-a.x),x=v*n+y*r,b=v*i+y*r,_=v*n+y*s,S=v*i+y*s;return!(Math.max(x,b,_,S)<=v*a.x+y*a.y||Math.min(x,b,_,S)>=v*h.x+y*h.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=i,this.height=Math.max(r-i,0),this}ceil(t=1,e=.001){const n=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=i-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=i,this.height=r-i,this}getBounds(t){return t||(t=new Hy),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,n=t.y,i=t.x+t.width,r=t.y+t.height;return e>=this.x&&e<this.x+this.width&&n>=this.y&&n<this.y+this.height&&i>=this.x&&i<this.x+this.width&&r>=this.y&&r<this.y+this.height}set(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Vy={default:-1};function Xy(t="default"){return void 0===Vy[t]&&(Vy[t]=-1),++Vy[t]}const Wy={},jy="8.0.0",Yy="8.3.4";function qy(t,e,n=3){if(Wy[e])return;let i=(new Error).stack;void 0===i||(i=i.split("\n").splice(n).join("\n"),console.groupCollapsed),Wy[e]=!0}const Ky=()=>{};function Jy(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Zy(t){return!(t&t-1||!t)}function Qy(t){const e={};for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}const $y=Object.create(null);const tx=class t extends Ty{constructor(e={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,e={...t.defaultOptions,...e},this.addressMode=e.addressMode,this.addressModeU=e.addressModeU??this.addressModeU,this.addressModeV=e.addressModeV??this.addressModeV,this.addressModeW=e.addressModeW??this.addressModeW,this.scaleMode=e.scaleMode,this.magFilter=e.magFilter??this.magFilter,this.minFilter=e.minFilter??this.minFilter,this.mipmapFilter=e.mipmapFilter??this.mipmapFilter,this.lodMinClamp=e.lodMinClamp,this.lodMaxClamp=e.lodMaxClamp,this.compare=e.compare,this.maxAnisotropy=e.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){qy(0,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=function(t){const e=$y[t];return void 0===e&&($y[t]=Xy("resource")),e}(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};tx.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let ex=tx;const nx=class t extends Ty{constructor(e={}){super(),this.options=e,this.uid=Xy("textureSource"),this._resourceType="textureSource",this._resourceId=Xy("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,e={...t.defaultOptions,...e},this.label=e.label??"",this.resource=e.resource,this.autoGarbageCollect=e.autoGarbageCollect,this._resolution=e.resolution,e.width?this.pixelWidth=e.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,e.height?this.pixelHeight=e.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=e.format,this.dimension=e.dimensions,this.mipLevelCount=e.mipLevelCount,this.autoGenerateMipmaps=e.autoGenerateMipmaps,this.sampleCount=e.sampleCount,this.antialias=e.antialias,this.alphaMode=e.alphaMode,this.style=new ex(Qy(e)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){var e,n;this.style!==t&&(null==(e=this._style)||e.off("change",this._onStyleChange,this),this._style=t,null==(n=this._style)||n.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=Xy("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,n){n||(n=this._resolution),t||(t=this.width),e||(e=this.height);const i=Math.round(t*n),r=Math.round(e*n);return this.width=i/n,this.height=r/n,this._resolution=n,(this.pixelWidth!==i||this.pixelHeight!==r)&&(this._refreshPOT(),this.pixelWidth=i,this.pixelHeight=r,this.emit("resize",this),this._resourceId=Xy("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=Zy(this.pixelWidth)&&Zy(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};nx.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let ix=nx;class rx extends ix{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let n=t.format;n||(n=e instanceof Float32Array?"rgba32float":e instanceof Int32Array||e instanceof Uint32Array?"rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?"rgba16uint":(Int8Array,"bgra8unorm")),super({...t,resource:e,format:n}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}rx.extension=fy.TextureSource;const sx=new Ry;class ax{constructor(t,e){this.mapCoord=new Ry,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?t.width<10?0:.5:e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var e;this.texture!==t&&(null==(e=this._texture)||e.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){void 0===e&&(e=t);const n=this.mapCoord;for(let i=0;i<t.length;i+=2){const r=t[i],s=t[i+1];e[i]=r*n.a+s*n.c+n.tx,e[i+1]=r*n.b+s*n.d+n.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const n=t.orig,i=t.trim;i&&(sx.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(sx));const r=t.source,s=this.uClampFrame,a=this.clampMargin/r._resolution,o=this.clampOffset/r._resolution;return s[0]=(t.frame.x+a+o)/r.width,s[1]=(t.frame.y+a+o)/r.height,s[2]=(t.frame.x+t.frame.width-a+o)/r.width,s[3]=(t.frame.y+t.frame.height-a+o)/r.height,this.uClampOffset[0]=this.clampOffset/r.pixelWidth,this.uClampOffset[1]=this.clampOffset/r.pixelHeight,this.isSimple=t.frame.width===r.width&&t.frame.height===r.height&&0===t.rotate,!0}}let ox=class extends Ty{constructor({source:t,label:e,frame:n,orig:i,trim:r,defaultAnchor:s,defaultBorders:a,rotate:o,dynamic:l}={}){if(super(),this.uid=Xy("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Hy,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=(null==t?void 0:t.source)??new ix,this.noFrame=!n,n)this.frame.copyFrom(n);else{const{width:t,height:e}=this._source;this.frame.width=t,this.frame.height=e}this.orig=i||this.frame,this.trim=r,this.rotate=o??0,this.defaultAnchor=s,this.defaultBorders=a,this.destroyed=!1,this.dynamic=l||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new ax(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:n,height:i}=this._source,r=e.x/n,s=e.y/i,a=e.width/n,o=e.height/i;let l=this.rotate;if(l){const e=a/2,n=o/2,i=r+e,h=s+n;l=zy.add(l,zy.NW),t.x0=i+e*zy.uX(l),t.y0=h+n*zy.uY(l),l=zy.add(l,2),t.x1=i+e*zy.uX(l),t.y1=h+n*zy.uY(l),l=zy.add(l,2),t.x2=i+e*zy.uX(l),t.y2=h+n*zy.uY(l),l=zy.add(l,2),t.x3=i+e*zy.uX(l),t.y3=h+n*zy.uY(l)}else t.x0=r,t.y0=s,t.x1=r+a,t.y1=s,t.x2=r+a,t.y2=s+o,t.x3=r,t.y3=s+o}destroy(t=!1){this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return qy(0,"Texture.baseTexture is now Texture.source"),this._source}};function lx(t,e,n){const{width:i,height:r}=n.orig,s=n.trim;if(s){const n=s.width,a=s.height;t.minX=s.x-e._x*i,t.maxX=t.minX+n,t.minY=s.y-e._y*r,t.maxY=t.minY+a}else t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*r,t.maxY=t.minY+r}ox.EMPTY=new ox({label:"EMPTY",source:new ix({label:"EMPTY"})}),ox.EMPTY.destroy=Ky,ox.WHITE=new ox({source:new rx({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"}),ox.WHITE.destroy=Ky;const hx=new Ry;class cx{constructor(t=1/0,e=1/0,n=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=hx,this.minX=t,this.minY=e,this.maxX=n,this.maxY=i}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Hy);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=hx,this}set(t,e,n,i){this.minX=t,this.minY=e,this.maxX=n,this.maxY=i}addFrame(t,e,n,i,r){r||(r=this.matrix);const s=r.a,a=r.b,o=r.c,l=r.d,h=r.tx,c=r.ty;let u=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=s*t+o*e+h,g=a*t+l*e+c;m<u&&(u=m),g<d&&(d=g),m>p&&(p=m),g>f&&(f=g),m=s*n+o*e+h,g=a*n+l*e+c,m<u&&(u=m),g<d&&(d=g),m>p&&(p=m),g>f&&(f=g),m=s*t+o*i+h,g=a*t+l*i+c,m<u&&(u=m),g<d&&(d=g),m>p&&(p=m),g>f&&(f=g),m=s*n+o*i+h,g=a*n+l*i+c,m<u&&(u=m),g<d&&(d=g),m>p&&(p=m),g>f&&(f=g),this.minX=u,this.minY=d,this.maxX=p,this.maxY=f}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,n=this.minY,i=this.maxX,r=this.maxY,{a:s,b:a,c:o,d:l,tx:h,ty:c}=t;let u=s*e+o*n+h,d=a*e+l*n+c;this.minX=u,this.minY=d,this.maxX=u,this.maxY=d,u=s*i+o*n+h,d=a*i+l*n+c,this.minX=u<this.minX?u:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=d>this.maxY?d:this.maxY,u=s*e+o*r+h,d=a*e+l*r+c,this.minX=u<this.minX?u:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=d>this.maxY?d:this.maxY,u=s*i+o*r+h,d=a*i+l*r+c,this.minX=u<this.minX?u:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=d>this.maxY?d:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,n,i){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<n&&(this.minY=n),this.maxY>i&&(this.maxY=i),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new cx(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,n,i){let r=this.minX,s=this.minY,a=this.maxX,o=this.maxY;i||(i=this.matrix);const l=i.a,h=i.b,c=i.c,u=i.d,d=i.tx,p=i.ty;for(let f=e;f<n;f+=2){const e=t[f],n=t[f+1],i=l*e+c*n+d,m=h*e+u*n+p;r=i<r?i:r,s=m<s?m:s,a=i>a?i:a,o=m>o?m:o}this.minX=r,this.minY=s,this.maxX=a,this.maxY=o}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var ux,dx={grad:.9,turn:360,rad:360/(2*Math.PI)},px=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},fx=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=Math.pow(10,e)),Math.round(n*t)/n+0},mx=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=1),t>n?n:t>e?t:e},gx=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},vx=function(t){return{r:mx(t.r,0,255),g:mx(t.g,0,255),b:mx(t.b,0,255),a:mx(t.a)}},yx=function(t){return{r:fx(t.r),g:fx(t.g),b:fx(t.b),a:fx(t.a,3)}},xx=/^#([0-9a-f]{3,8})$/i,bx=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},_x=function(t){var e=t.r,n=t.g,i=t.b,r=t.a,s=Math.max(e,n,i),a=s-Math.min(e,n,i),o=a?s===e?(n-i)/a:s===n?2+(i-e)/a:4+(e-n)/a:0;return{h:60*(o<0?o+6:o),s:s?a/s*100:0,v:s/255*100,a:r}},Sx=function(t){var e=t.h,n=t.s,i=t.v,r=t.a;e=e/360*6,n/=100,i/=100;var s=Math.floor(e),a=i*(1-n),o=i*(1-(e-s)*n),l=i*(1-(1-e+s)*n),h=s%6;return{r:255*[i,o,a,a,l,i][h],g:255*[l,i,i,o,a,a][h],b:255*[a,a,l,i,i,o][h],a:r}},wx=function(t){return{h:gx(t.h),s:mx(t.s,0,100),l:mx(t.l,0,100),a:mx(t.a)}},Tx=function(t){return{h:fx(t.h),s:fx(t.s),l:fx(t.l),a:fx(t.a,3)}},Mx=function(t){return Sx((n=(e=t).s,{h:e.h,s:(n*=((i=e.l)<50?i:100-i)/100)>0?2*n/(i+n)*100:0,v:i+n,a:e.a}));var e,n,i},Ax=function(t){return{h:(e=_x(t)).h,s:(r=(200-(n=e.s))*(i=e.v)/100)>0&&r<200?n*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:e.a};var e,n,i,r},Ex=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Cx=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Px=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Rx=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ix={string:[[function(t){var e=xx.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?fx(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?fx(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Px.exec(t)||Rx.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:vx({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=Ex.exec(t)||Cx.exec(t);if(!e)return null;var n,i,r=wx({h:(n=e[1],i=e[2],void 0===i&&(i="deg"),Number(n)*(dx[i]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return Mx(r)},"hsl"]],object:[[function(t){var e=t.r,n=t.g,i=t.b,r=t.a,s=void 0===r?1:r;return px(e)&&px(n)&&px(i)?vx({r:Number(e),g:Number(n),b:Number(i),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,n=t.s,i=t.l,r=t.a,s=void 0===r?1:r;if(!px(e)||!px(n)||!px(i))return null;var a=wx({h:Number(e),s:Number(n),l:Number(i),a:Number(s)});return Mx(a)},"hsl"],[function(t){var e=t.h,n=t.s,i=t.v,r=t.a,s=void 0===r?1:r;if(!px(e)||!px(n)||!px(i))return null;var a,o=(a={h:Number(e),s:Number(n),v:Number(i),a:Number(s)},{h:gx(a.h),s:mx(a.s,0,100),v:mx(a.v,0,100),a:mx(a.a)});return Sx(o)},"hsv"]]},Ox=function(t,e){for(var n=0;n<e.length;n++){var i=e[n][0](t);if(i)return[i,e[n][1]]}return[null,void 0]},Dx=function(t,e){var n=Ax(t);return{h:n.h,s:mx(n.s+100*e,0,100),l:n.l,a:n.a}},Bx=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Fx=function(t,e){var n=Ax(t);return{h:n.h,s:n.s,l:mx(n.l+100*e,0,100),a:n.a}},Lx=function(){function t(t){this.parsed=function(t){return"string"==typeof t?Ox(t.trim(),Ix.string):"object"==typeof t&&null!==t?Ox(t,Ix.object):[null,void 0]}(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return fx(Bx(this.rgba),2)},t.prototype.isDark=function(){return Bx(this.rgba)<.5},t.prototype.isLight=function(){return Bx(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=yx(this.rgba)).r,n=t.g,i=t.b,s=(r=t.a)<1?bx(fx(255*r)):"","#"+bx(e)+bx(n)+bx(i)+s;var t,e,n,i,r,s},t.prototype.toRgb=function(){return yx(this.rgba)},t.prototype.toRgbString=function(){return e=(t=yx(this.rgba)).r,n=t.g,i=t.b,(r=t.a)<1?"rgba("+e+", "+n+", "+i+", "+r+")":"rgb("+e+", "+n+", "+i+")";var t,e,n,i,r},t.prototype.toHsl=function(){return Tx(Ax(this.rgba))},t.prototype.toHslString=function(){return e=(t=Tx(Ax(this.rgba))).h,n=t.s,i=t.l,(r=t.a)<1?"hsla("+e+", "+n+"%, "+i+"%, "+r+")":"hsl("+e+", "+n+"%, "+i+"%)";var t,e,n,i,r},t.prototype.toHsv=function(){return t=_x(this.rgba),{h:fx(t.h),s:fx(t.s),v:fx(t.v),a:fx(t.a,3)};var t},t.prototype.invert=function(){return Ux({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Ux(Dx(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Ux(Dx(this.rgba,-t))},t.prototype.grayscale=function(){return Ux(Dx(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Ux(Fx(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Ux(Fx(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Ux({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):fx(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=Ax(this.rgba);return"number"==typeof t?Ux({h:t,s:e.s,l:e.l,a:e.a}):fx(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Ux(t).toHex()},t}(),Ux=function(t){return t instanceof Lx?t:new Lx(t)},kx=[];ux=[function(t,e){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in n)i[n[r]]=r;var s={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,a,o=i[this.toHex()];if(o)return o;if(null==e?void 0:e.closest){var l=this.toRgb(),h=1/0,c="black";if(!s.length)for(var u in n)s[u]=new t(n[u]).toRgb();for(var d in n){var p=(r=l,a=s[d],Math.pow(r.r-a.r,2)+Math.pow(r.g-a.g,2)+Math.pow(r.b-a.b,2));p<h&&(h=p,c=d)}return c}},e.string.push([function(e){var i=e.toLowerCase(),r="transparent"===i?"#0000":n[i];return r?new t(r).toRgb():null},"name"])}],ux.forEach(function(t){kx.indexOf(t)<0&&(t(Lx,Ix),kx.push(t))});const Nx=class t{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(e){if(e instanceof t)this._value=this._cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(null===e)throw new Error("Cannot set Color#value to null");null!==this._value&&this._isSourceEqual(this._value,e)||(this._value=this._cloneSource(e),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}_isSourceEqual(t,e){const n=typeof t;if(n!==typeof e)return!1;if("number"===n||"string"===n||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every((t,n)=>t===e[n]);if(null!==t&&null!==e){const n=Object.keys(t),i=Object.keys(e);return n.length===i.length&&n.every(n=>t[n]===e[n])}return t===e}toRgba(){const[t,e,n,i]=this._components;return{r:t,g:e,b:n,a:i}}toRgb(){const[t,e,n]=this._components;return{r:t,g:e,b:n}}toRgbaString(){const[t,e,n]=this.toUint8RgbArray();return`rgba(${t},${e},${n},${this.alpha})`}toUint8RgbArray(t){const[e,n,i]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(255*e),t[1]=Math.round(255*n),t[2]=Math.round(255*i),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,n,i,r]=this._components;return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,n,i]=this._components;return t[0]=e,t[1]=n,t[2]=i,t}toNumber(){return this._int}toBgrNumber(){const[t,e,n]=this.toUint8RgbArray();return(n<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(e){const[n,i,r,s]=t._temp.setValue(e)._components;return this._components[0]*=n,this._components[1]*=i,this._components[2]*=r,this._components[3]*=s,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let n=this._int>>16&255,i=this._int>>8&255,r=255&this._int;return e&&(n=n*t+.5|0,i=i*t+.5|0,r=r*t+.5|0),(255*t<<24)+(n<<16)+(i<<8)+r}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(e){let n,i,r,s;if(("number"==typeof e||e instanceof Number)&&e>=0&&e<=16777215){n=(e>>16&255)/255,i=(e>>8&255)/255,r=(255&e)/255,s=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[n,i,r,s=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[n,i,r,s=255]=e,n/=255,i/=255,r/=255,s/=255;else if("string"==typeof e||"object"==typeof e){if("string"==typeof e){const n=t.HEX_PATTERN.exec(e);n&&(e=`#${n[2]}`)}const a=Ux(e);a.isValid()&&(({r:n,g:i,b:r,a:s}=a.rgba),n/=255,i/=255,r/=255)}if(void 0===n)throw new Error(`Unable to convert color ${e}`);this._components[0]=n,this._components[1]=i,this._components[2]=r,this._components[3]=s,this._refreshInt()}_refreshInt(){this._clamp(this._components);const[t,e,n]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*n|0)}_clamp(t,e=0,n=1){return"number"==typeof t?Math.min(Math.max(t,e),n):(t.forEach((i,r)=>{t[r]=Math.min(Math.max(i,e),n)}),t)}static isColorLike(e){return"number"==typeof e||"string"==typeof e||e instanceof Number||e instanceof t||Array.isArray(e)||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||void 0!==e.r&&void 0!==e.g&&void 0!==e.b||void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a||void 0!==e.h&&void 0!==e.s&&void 0!==e.l||void 0!==e.h&&void 0!==e.s&&void 0!==e.l&&void 0!==e.a||void 0!==e.h&&void 0!==e.s&&void 0!==e.v||void 0!==e.h&&void 0!==e.s&&void 0!==e.v&&void 0!==e.a}};Nx.shared=new Nx,Nx._temp=new Nx,Nx.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let zx=Nx;const Gx={cullArea:null,cullable:!1,cullableChildren:!0};let Hx=0;function Vx(...t){500!==Hx&&Hx++}let Xx=class{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var e;let n;return n=this._index>0?this._pool[--this._index]:new this._classType,null==(e=n.init)||e.call(n,t),n}return(t){var e;null==(e=t.reset)||e.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){this._pool.length=0,this._index=0}};class Wx{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new Xx(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const n=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[n]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}}const jx=new Wx,Yx={get isCachedAsTexture(){var t;return!!(null==(t=this.renderGroup)?void 0:t.isCachedAsTexture)},cacheAsTexture(t){"boolean"==typeof t&&!1===t?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(!0===t?{}:t))},updateCacheTexture(){var t;null==(t=this.renderGroup)||t.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(t){qy(0,"cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(t)}};function qx(t,e,n){const i=t.length;let r;if(e>=i||0===n)return;const s=i-(n=e+n>i?i-e:n);for(r=e;r<s;++r)t[r]=t[r+n];t.length=s}const Kx={allowChildren:!0,removeChildren(t=0,e){var n;const i=e??this.children.length,r=i-t,s=[];if(r>0&&r<=i){for(let n=i-1;n>=t;n--){const t=this.children[n];t&&(s.push(t),t.parent=null)}qx(this.children,t,i);const e=this.renderGroup||this.parentRenderGroup;e&&e.removeChildren(s);for(let t=0;t<s.length;++t){const e=s[t];null==(n=e.parentRenderLayer)||n.detach(e),this.emit("childRemoved",e,this,t),s[t].emit("removed",this)}return s.length>0&&this._didViewChangeTick++,s}if(0===r&&0===this.children.length)return s;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(t){const e=this.getChildAt(t);return this.removeChild(e)},getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]},setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(t),this.addChildAt(t,e)},getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(t,e){this.allowChildren||qy(0,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:n}=this;if(e<0||e>n.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${n.length}`);if(t.parent){const n=t.parent.children.indexOf(t);if(t.parent===this&&n===e)return t;-1!==n&&t.parent.children.splice(n,1)}e===n.length?n.push(t):n.splice(e,0,t),t.parent=this,t.didChange=!0,t._updateFlags=15;const i=this.renderGroup||this.parentRenderGroup;return i&&i.addChild(t),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",t,this,e),t.emit("added",this),t},swapChildren(t,e){if(t===e)return;const n=this.getChildIndex(t),i=this.getChildIndex(e);this.children[n]=e,this.children[i]=t;const r=this.renderGroup||this.parentRenderGroup;r&&(r.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var t;null==(t=this.parent)||t.removeChild(this)},reparentChild(...t){return 1===t.length?this.reparentChildAt(t[0],this.children.length):(t.forEach(t=>this.reparentChildAt(t,this.children.length)),t[0])},reparentChildAt(t,e){if(t.parent===this)return this.setChildIndex(t,e),t;const n=t.worldTransform.clone();t.removeFromParent(),this.addChildAt(t,e);const i=this.worldTransform.clone();return i.invert(),n.prepend(i),t.setFromMatrix(n),t},replaceChild(t,e){t.updateLocalTransform(),this.addChildAt(e,this.getChildIndex(t)),e.setFromMatrix(t.localTransform),e.updateLocalTransform(),this.removeChild(t)}},Jx={collectRenderables(t,e,n){this.parentRenderLayer&&this.parentRenderLayer!==n||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(t,e,n):this.renderGroup?e.renderPipes.renderGroup.addRenderGroup(this.renderGroup,t):this.collectRenderablesWithEffects(t,e,n))},collectRenderablesSimple(t,e,n){const i=this.children,r=i.length;for(let s=0;s<r;s++)i[s].collectRenderables(t,e,n)},collectRenderablesWithEffects(t,e,n){const{renderPipes:i}=e;for(let r=0;r<this.effects.length;r++){const e=this.effects[r];i[e.pipe].push(e,this,t)}this.collectRenderablesSimple(t,e,n);for(let r=this.effects.length-1;r>=0;r--){const e=this.effects[r];i[e.pipe].pop(e,this,t)}}};class Zx{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class Qx{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const n=this._tests[e];if(n.test(t))return jx.get(n.maskClass,t)}return t}returnMaskEffect(t){jx.return(t)}}const $x=new Qx;vy.handleByList(fy.MaskEffect,$x._effectClasses);const tb={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const t=this.renderGroup||this.parentRenderGroup;t&&(t.structureDidChange=!0)},addEffect(t){-1===this.effects.indexOf(t)&&(this.effects.push(t),this.effects.sort((t,e)=>t.priority-e.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(t){const e=this.effects.indexOf(t);-1!==e&&(this.effects.splice(e,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(t){const e=this._maskEffect;(null==e?void 0:e.mask)!==t&&(e&&(this.removeEffect(e),$x.returnMaskEffect(e),this._maskEffect=null),null!=t&&(this._maskEffect=$x.getMaskEffect(t),this.addEffect(this._maskEffect)))},get mask(){var t;return null==(t=this._maskEffect)?void 0:t.mask},setMask(t){this._maskOptions={...this._maskOptions,...t},t.mask&&(this.mask=t.mask),this._markStructureAsChanged()},set filters(t){var e;!Array.isArray(t)&&t&&(t=[t]);const n=this._filterEffect||(this._filterEffect=new Zx),i=(null==t?void 0:t.length)>0,r=i!==(null==(e=n.filters)?void 0:e.length)>0;t=Array.isArray(t)?t.slice(0):t,n.filters=Object.freeze(t),r&&(i?this.addEffect(n):(this.removeEffect(n),n.filters=t??null))},get filters(){var t;return null==(t=this._filterEffect)?void 0:t.filters},set filterArea(t){this._filterEffect||(this._filterEffect=new Zx),this._filterEffect.filterArea=t},get filterArea(){var t;return null==(t=this._filterEffect)?void 0:t.filterArea}},eb={label:null,get name(){return qy(0,"Container.name property has been removed, use Container.label instead"),this.label},set name(t){qy(0,"Container.name property has been removed, use Container.label instead"),this.label=t},getChildByName(t,e=!1){return this.getChildByLabel(t,e)},getChildByLabel(t,e=!1){const n=this.children;for(let i=0;i<n.length;i++){const e=n[i];if(e.label===t||t instanceof RegExp&&t.test(e.label))return e}if(e)for(let i=0;i<n.length;i++){const e=n[i].getChildByLabel(t,!0);if(e)return e}return null},getChildrenByLabel(t,e=!1,n=[]){const i=this.children;for(let r=0;r<i.length;r++){const e=i[r];(e.label===t||t instanceof RegExp&&t.test(e.label))&&n.push(e)}if(e)for(let r=0;r<i.length;r++)i[r].getChildrenByLabel(t,!0,n);return n}},nb=new Xx(Ry),ib=new Xx(cx),rb=new Ry,sb={getFastGlobalBounds(t,e){e||(e=new cx),e.clear(),this._getGlobalBoundsRecursive(!!t,e,this.parentRenderLayer),e.isValid||e.set(0,0,0,0);const n=this.renderGroup||this.parentRenderGroup;return e.applyMatrix(n.worldTransform),e},_getGlobalBoundsRecursive(t,e,n){let i=e;if(t&&this.parentRenderLayer&&this.parentRenderLayer!==n)return;if(7!==this.localDisplayStatus||!this.measurable)return;const r=!!this.effects.length;if((this.renderGroup||r)&&(i=ib.get().clear()),this.boundsArea)e.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const t=this.bounds;i.addFrame(t.minX,t.minY,t.maxX,t.maxY,this.groupTransform)}const e=this.children;for(let r=0;r<e.length;r++)e[r]._getGlobalBoundsRecursive(t,i,n)}if(r){let t=!1;const n=this.renderGroup||this.parentRenderGroup;for(let e=0;e<this.effects.length;e++)this.effects[e].addBounds&&(t||(t=!0,i.applyMatrix(n.worldTransform)),this.effects[e].addBounds(i,!0));t&&(i.applyMatrix(n.worldTransform.copyTo(rb).invert()),e.addBounds(i,this.relativeGroupTransform)),e.addBounds(i),ib.return(i)}else this.renderGroup&&(e.addBounds(i,this.relativeGroupTransform),ib.return(i))}};function ab(t,e,n){let i,r;return n.clear(),t.parent?e?i=t.parent.worldTransform:(r=nb.get().identity(),i=lb(t,r)):i=Ry.IDENTITY,ob(t,n,i,e),r&&nb.return(r),n.isValid||n.set(0,0,0,0),n}function ob(t,e,n,i){var r,s;if(!t.visible||!t.measurable)return;let a;i?a=t.worldTransform:(t.updateLocalTransform(),a=nb.get(),a.appendFrom(t.localTransform,n));const o=e,l=!!t.effects.length;if(l&&(e=ib.get().clear()),t.boundsArea)e.addRect(t.boundsArea,a);else{t.bounds&&(e.matrix=a,e.addBounds(t.bounds));for(let n=0;n<t.children.length;n++)ob(t.children[n],e,a,i)}if(l){for(let n=0;n<t.effects.length;n++)null==(s=(r=t.effects[n]).addBounds)||s.call(r,e);o.addBounds(e,Ry.IDENTITY),ib.return(e)}i||nb.return(a)}function lb(t,e){const n=t.parent;return n&&(lb(n,e),n.updateLocalTransform(),e.append(n.localTransform)),e}function hb(t,e){if(16777215===t||!e)return e;if(16777215===e||!t)return t;return(((t>>16&255)*(e>>16&255)/255|0)<<16)+(((t>>8&255)*(e>>8&255)/255|0)<<8)+((255&t)*(255&e)/255|0)}const cb=16777215;function ub(t,e){return t===cb?e:e===cb?t:hb(t,e)}function db(t){return((255&t)<<16)+(65280&t)+(t>>16&255)}const pb={getGlobalAlpha(t){if(t)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let e=this.alpha,n=this.parent;for(;n;)e*=n.alpha,n=n.parent;return e},getGlobalTransform(t,e){if(e)return t.copyFrom(this.worldTransform);this.updateLocalTransform();const n=lb(this,nb.get().identity());return t.appendFrom(this.localTransform,n),nb.return(n),t},getGlobalTint(t){if(t)return this.renderGroup?db(this.renderGroup.worldColor):this.parentRenderGroup?db(ub(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let e=this.localColor,n=this.parent;for(;n;)e=ub(e,n.localColor),n=n.parent;return db(e)}};function fb(t,e,n){return e.clear(),n||(n=Ry.IDENTITY),mb(t,e,n,t,!0),e.isValid||e.set(0,0,0,0),e}function mb(t,e,n,i,r){var s,a;let o;if(r)o=nb.get(),o=n.copyTo(o);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();const e=t.localTransform;o=nb.get(),o.appendFrom(e,n)}const l=e,h=!!t.effects.length;if(h&&(e=ib.get().clear()),t.boundsArea)e.addRect(t.boundsArea,o);else{t.renderPipeId&&(e.matrix=o,e.addBounds(t.bounds));const n=t.children;for(let t=0;t<n.length;t++)mb(n[t],e,o,i,!1)}if(h){for(let n=0;n<t.effects.length;n++)null==(a=(s=t.effects[n]).addLocalBounds)||a.call(s,e,i);l.addBounds(e,Ry.IDENTITY),ib.return(e)}nb.return(o)}function gb(t,e){const n=t.children;for(let i=0;i<n.length;i++){const t=n[i],r=t.uid,s=(65535&t._didViewChangeTick)<<16|65535&t._didContainerChangeTick,a=e.index;e.data[a]===r&&e.data[a+1]===s||(e.data[e.index]=r,e.data[e.index+1]=s,e.didChange=!0),e.index=a+2,t.children.length&&gb(t,e)}return e.didChange}const vb=new Ry,yb={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(t,e){const n=Math.sign(this.scale.x)||1;this.scale.x=0!==e?t/e*n:n},_setHeight(t,e){const n=Math.sign(this.scale.y)||1;this.scale.y=0!==e?t/e*n:n},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new cx});const t=this._localBoundsCacheData;return t.index=1,t.didChange=!1,t.data[0]!==this._didViewChangeTick&&(t.didChange=!0,t.data[0]=this._didViewChangeTick),gb(this,t),t.didChange&&fb(this,t.localBounds,vb),t.localBounds},getBounds(t,e){return ab(this,t,e||new cx)}},xb={_onRender:null,set onRender(t){const e=this.renderGroup||this.parentRenderGroup;if(!t)return this._onRender&&(null==e||e.removeOnRender(this)),void(this._onRender=null);this._onRender||null==e||e.addOnRender(this),this._onRender=t},get onRender(){return this._onRender}},bb={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(_b))}};function _b(t,e){return t._zIndex-e._zIndex}const Sb={getGlobalPosition(t=new Cy,e=!1){return this.parent?this.parent.toGlobal(this._position,t,e):(t.x=this._position.x,t.y=this._position.y),t},toGlobal(t,e,n=!1){const i=this.getGlobalTransform(nb.get(),n);return e=i.apply(t,e),nb.return(i),e},toLocal(t,e,n,i){e&&(t=e.toGlobal(t,n,i));const r=this.getGlobalTransform(nb.get(),i);return n=r.applyInverse(t,n),nb.return(r),n}};class wb{constructor(){this.uid=Xy("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize}}let Tb=0;class Mb{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new ex(this.textureOptions)}createTexture(t,e,n){const i=new ix({...this.textureOptions,width:t,height:e,resolution:1,antialias:n,autoGarbageCollect:!1});return new ox({source:i,label:"texturePool_"+Tb++})}getOptimalTexture(t,e,n=1,i){let r=Math.ceil(t*n-1e-6),s=Math.ceil(e*n-1e-6);r=Jy(r),s=Jy(s);const a=(r<<17)+(s<<1)+(i?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let o=this._texturePool[a].pop();return o||(o=this.createTexture(r,s,i)),o.source._resolution=n,o.source.width=r/n,o.source.height=s/n,o.source.pixelWidth=r,o.source.pixelHeight=s,o.frame.x=0,o.frame.y=0,o.frame.width=t,o.frame.height=e,o.updateUvs(),this._poolKeyHash[o.uid]=a,o}getSameSizeTexture(t,e=!1){const n=t.source;return this.getOptimalTexture(t.width,t.height,n._resolution,e)}returnTexture(t,e=!1){const n=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[n].push(t)}clear(t){if(t=!1!==t)for(const e in this._texturePool){const t=this._texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this._texturePool={}}}const Ab=new Mb;class Eb{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new Ry,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new wb,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let n=0;n<e.length;n++){const t=e[n];t._updateFlags=15,this.addChild(t)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(Ab.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup)return void this.addRenderGroupChild(t.renderGroup);t._onRender&&this.addOnRender(t);const e=t.children;for(let n=0;n<e.length;n++)this.addChild(e[n])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup)return void this._removeRenderGroupChild(t.renderGroup);const e=t.children;for(let n=0;n<e.length;n++)this.removeChild(e[n])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return 7===this.root.localDisplayStatus&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let n=0;n<e.length;n++)this._getChildren(e[n],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const n=t.children;for(let i=0;i<n.length;i++)this._getChildren(n[i],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return 1&this._matrixDirty?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new Ry),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return 2&this._matrixDirty?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new Ry),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(4&this._matrixDirty))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new Ry),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Cb(t,e,n={}){for(const i in e)n[i]||void 0===e[i]||(t[i]=e[i])}const Pb=new by(null),Rb=new by(null),Ib=new by(null,1,1),Ob=new by(null);let Db=class t extends Ty{constructor(t={}){var e,n;super(),this.uid=Xy("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new Ry,this.relativeGroupTransform=new Ry,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new by(this,0,0),this._scale=Ib,this._pivot=Rb,this._origin=Ob,this._skew=Pb,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Cb(this,t,{children:!0,parent:!0,effects:!0}),null==(e=t.children)||e.forEach(t=>this.addChild(t)),null==(n=t.parent)||n.addChild(this)}static mixin(e){qy(0,"Container.mixin is deprecated, please use extensions.mixin instead."),vy.mixin(t,e)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=4095&t}get _didChangeId(){return 4095&this._didContainerChangeTick|(4095&this._didViewChangeTick)<<12}addChild(...t){if(this.allowChildren||qy(0,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let e=0;e<t.length;e++)this.addChild(t[e]);return t[0]}const e=t[0],n=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),n&&(n.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,n&&n.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,0!==e._zIndex&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let e=0;e<t.length;e++)this.removeChild(t[e]);return t[0]}const e=t[0],n=this.children.indexOf(e);return n>-1&&(this._didViewChangeTick++,this.children.splice(n,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,n),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,this.didChange||(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;null==t||t.removeChild(this),this.renderGroup=jx.get(Eb,this),this.groupTransform=Ry.IDENTITY,null==t||t.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;null==t||t.removeChild(this),jx.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,null==t||t.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&0===this.effects.length}get worldTransform(){return this._worldTransform||(this._worldTransform=new Ry),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*Ay}set angle(t){this.rotation=t*Ey}get pivot(){return this._pivot===Rb&&(this._pivot=new by(this,0,0)),this._pivot}set pivot(t){this._pivot===Rb&&(this._pivot=new by(this,0,0),this._origin!==Ob&&Vx()),"number"==typeof t?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Pb&&(this._skew=new by(this,0,0)),this._skew}set skew(t){this._skew===Pb&&(this._skew=new by(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===Ib&&(this._scale=new by(this,1,1)),this._scale}set scale(t){this._scale===Ib&&(this._scale=new by(this,0,0)),"string"==typeof t&&(t=parseFloat(t)),"number"==typeof t?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===Ob&&(this._origin=new by(this,0,0)),this._origin}set origin(t){this._origin===Ob&&(this._origin=new by(this,0,0),this._pivot!==Rb&&Vx()),"number"==typeof t?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const n=this.getLocalBounds();"object"==typeof t?(e=t.height??t.width,t=t.width):e??(e=t),void 0!==t&&this._setWidth(t,n.width),void 0!==e&&this._setHeight(e,n.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set("number"==typeof t.x?t.x:this.position.x,"number"==typeof t.y?t.y:this.position.y),this.scale.set("number"==typeof t.scaleX?t.scaleX||1:this.scale.x,"number"==typeof t.scaleY?t.scaleY||1:this.scale.y),this.rotation="number"==typeof t.rotation?t.rotation:this.rotation,this.skew.set("number"==typeof t.skewX?t.skewX:this.skew.x,"number"==typeof t.skewY?t.skewY:this.skew.y),this.pivot.set("number"==typeof t.pivotX?t.pivotX:this.pivot.x,"number"==typeof t.pivotY?t.pivotY:this.pivot.y),this.origin.set("number"==typeof t.originX?t.originX:this.origin.x,"number"==typeof t.originY?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,n=this._scale,i=this._pivot,r=this._origin,s=this._position,a=n._x,o=n._y,l=i._x,h=i._y,c=-r._x,u=-r._y;e.a=this._cx*a,e.b=this._sx*a,e.c=this._cy*o,e.d=this._sy*o,e.tx=s._x-(l*e.a+h*e.c)+(c*e.a+u*e.c)-c*a,e.ty=s._y-(l*e.b+h*e.d)+(c*e.b+u*e.d)-u*o}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=1,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const e=zx.shared.setValue(t??16777215).toBgrNumber();e!==this.localColor&&(this.localColor=e,this._updateFlags|=1,this._onUpdate())}get tint(){return db(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=2,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(2&this.localDisplayStatus)}set visible(t){const e=t?2:0;(2&this.localDisplayStatus)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=4,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(4&this.localDisplayStatus)}set culled(t){const e=t?0:4;(4&this.localDisplayStatus)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=4,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(1&this.localDisplayStatus)}set renderable(t){const e=t?1:0;(1&this.localDisplayStatus)!==e&&(this._updateFlags|=4,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return 7===this.localDisplayStatus&&this.groupAlpha>0}destroy(t=!1){var e;if(this.destroyed)return;let n;this.destroyed=!0,this.children.length&&(n=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners();if(("boolean"==typeof t?t:null==t?void 0:t.children)&&n)for(let i=0;i<n.length;++i)n[i].destroy(t);null==(e=this.renderGroup)||e.destroy(),this.renderGroup=null}};vy.mixin(Db,Kx,sb,Sb,xb,yb,tb,eb,bb,Gx,Yx,pb,Jx);class Bb extends Db{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new cx(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:n,y:i}=t;return n>=e.minX&&n<=e.maxX&&i>=e.minY&&i<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){var e,n;super.destroy(t),this._bounds=null;for(const i in this._gpuData)null==(n=(e=this._gpuData[i]).destroy)||n.call(e);this._gpuData=null}collectRenderablesSimple(t,e,n){const{renderPipes:i}=e;i.blendMode.setBlendMode(this,this.groupBlendMode,t);i[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const r=this.children,s=r.length;for(let a=0;a<s;a++)r[a].collectRenderables(t,e,n)}}let Fb=class t extends Bb{constructor(t=ox.EMPTY){t instanceof ox&&(t={texture:t});const{texture:e=ox.EMPTY,anchor:n,roundPixels:i,width:r,height:s,...a}=t;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new by({_onUpdate:()=>{this.onViewUpdate()}}),n?this.anchor=n:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=i??!1,void 0!==r&&(this.width=r),void 0!==s&&(this.height=s)}static from(e,n=!1){return new t(e instanceof ox?e:ox.from(e,n))}set texture(t){t||(t=ox.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return lx(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return qy(0,"Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,n=this._bounds,{width:i,height:r}=e.orig;n.minX=-t._x*i,n.maxX=n.minX+i,n.minY=-t._y*r,n.maxY=n.minY+r}destroy(t=!1){super.destroy(t);if("boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._texture.destroy(e)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){"object"==typeof t?(e=t.height??t.width,t=t.width):e??(e=t),void 0!==t&&this._setWidth(t,this._texture.orig.width),void 0!==e&&this._setHeight(e,this._texture.orig.height)}};const Lb=new cx;function Ub(t,e,n){const i=Lb;t.measurable=!0,ab(t,n,i),e.addBoundsMask(i),t.measurable=!1}function kb(t,e,n){const i=ib.get();t.measurable=!0;const r=nb.get().identity();fb(t,i,Nb(t,n,r)),t.measurable=!1,e.addBoundsMask(i),nb.return(r),ib.return(i)}function Nb(t,e,n){return t?(t!==e&&(Nb(t.parent,e,n),t.updateLocalTransform(),n.append(t.localTransform)),n):(Vx(),n)}class zb{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",(null==t?void 0:t.mask)&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof Fb),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,e){this.inverse||Ub(this.mask,t,e)}addLocalBounds(t,e){kb(this.mask,t,e)}containsPoint(t,e){return e(this.mask,t)}destroy(){this.reset()}static test(t){return t instanceof Fb}}zb.extension=fy.MaskEffect;class Gb{constructor(t){this.priority=0,this.pipe="colorMask",(null==t?void 0:t.mask)&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return"number"==typeof t}}Gb.extension=fy.MaskEffect;class Hb{constructor(t){this.priority=0,this.pipe="stencilMask",(null==t?void 0:t.mask)&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,e){Ub(this.mask,t,e)}addLocalBounds(t,e){kb(this.mask,t,e)}containsPoint(t,e){return e(this.mask,t)}destroy(){this.reset()}static test(t){return t instanceof Db}}Hb.extension=fy.MaskEffect;const Vb={createCanvas:(t,e)=>{const n=document.createElement("canvas");return n.width=t,n.height=e,n},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")};let Xb=Vb;const Wb={get:()=>Xb,set(t){Xb=t}};class jb extends ix{constructor(t){t.resource||(t.resource=Wb.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),this.resource.width===this.pixelWidth&&this.resource.height===this.pixelHeight||(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,n=this._resolution){const i=super.resize(t,e,n);return i&&this.resizeCanvas(),i}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}jb.extension=fy.TextureSource;class Yb extends ix{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Yb.extension=fy.TextureSource;var qb=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(qb||{});class Kb{constructor(t,e=null,n=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=n,this._once=i}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Jb=class t{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Kb(null,null,1/0),this.deltaMS=1/t.targetFPMS,this.elapsedMS=1/t.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,n=qb.NORMAL){return this._addListener(new Kb(t,e,n))}addOnce(t,e,n=qb.NORMAL){return this._addListener(new Kb(t,e,n,!0))}_addListener(t){let e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this}remove(t,e){let n=this._head.next;for(;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let n;if(e>this.lastTime){if(n=this.elapsedMS=e-this.lastTime,n>this._maxElapsedMS&&(n=this._maxElapsedMS),n*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=n,this.deltaTime=this.deltaMS*t.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const n=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,n)/1e3,t.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!t._shared){const e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared}static get system(){if(!t._system){const e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system}};Jb.targetFPMS=.06;let Zb,Qb=Jb;async function $b(){return Zb??(Zb=(async()=>{var t;const e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";const n=await new Promise(t=>{const e=document.createElement("video");e.onloadeddata=()=>t(e),e.onerror=()=>t(null),e.autoplay=!1,e.crossOrigin="anonymous",e.preload="auto",e.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",e.load()});if(!n)return"premultiply-alpha-on-upload";const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n);const s=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,s),e.deleteFramebuffer(r),e.deleteTexture(i),null==(t=e.getExtension("WEBGL_lose_context"))||t.loseContext(),s[0]<=s[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Zb}const t_=class t extends ix{constructor(e){super(e),this.isReady=!1,this.uploadMethodId="video",e={...t.defaultOptions,...e},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this.alphaMode=e.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==e.autoLoad&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=Qb.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await $b(),this._load=new Promise((n,i)=>{this.isValid?n(this):(this._resolve=n,this._reject=i,void 0!==e.preloadTimeoutMs&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Qb.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Qb.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Qb.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};t_.extension=fy.TextureSource,t_.defaultOptions={...ix.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1},t_.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let e_=t_;const n_=(t,e,n=!1)=>(Array.isArray(t)||(t=[t]),e?t.map(t=>"string"==typeof t||n?e(t):t):t);const i_=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||Vx(),e}set(t,e){const n=n_(t);let i;for(let o=0;o<this.parsers.length;o++){const t=this.parsers[o];if(t.test(e)){i=t.getCacheableAssets(n,e);break}}const r=new Map(Object.entries(i||{}));i||n.forEach(t=>{r.set(t,e)});const s=[...r.keys()],a={cacheKeys:s,keys:n};n.forEach(t=>{this._cacheMap.set(t,a)}),s.forEach(t=>{const n=i?i[t]:e;this._cache.has(t)&&this._cache.get(t)!==n&&Vx(),this._cache.set(t,r.get(t))})}remove(t){if(!this._cacheMap.has(t))return void Vx();const e=this._cacheMap.get(t);e.cacheKeys.forEach(t=>{this._cache.delete(t)}),e.keys.forEach(t=>{this._cacheMap.delete(t)})}get parsers(){return this._parsers}},r_=[];function s_(t={}){const e=t&&t.resource,n=e?t.resource:t,i=e?t:{resource:t};for(let r=0;r<r_.length;r++){const t=r_[r];if(t.test(n))return new t(i)}throw new Error(`Could not find a source type for resource: ${i.resource}`)}function a_(t={},e=!1){const n=t&&t.resource,i=n?t.resource:t,r=n?t:{resource:t};if(!e&&i_.has(i))return i_.get(i);const s=new ox({source:s_(r)});return s.on("destroy",()=>{i_.has(i)&&i_.remove(i)}),e||i_.set(i,s),s}function o_(t,e=!1){return"string"==typeof t?i_.get(t):t instanceof ix?new ox({source:t}):a_(t,e)}vy.handleByList(fy.TextureSource,r_),ox.from=o_,ix.from=s_,vy.add(zb,Gb,Hb,e_,Yb,jb,rx);var l_=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(l_||{});function h_(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function c_(t){return t.split("?")[0].split("#")[0]}const u_={toPosix(t){return e="\\",n="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n);var e,n},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),isBlobUrl:t=>t.startsWith("blob:"),hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){h_(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const n=/^[^/:]+:\/{0,2}/.exec(t);return n?n[0]:""},toAbsolute(t,e,n){if(h_(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const i=c_(this.toPosix(e??Wb.get().getBaseUrl())),r=c_(this.toPosix(n??this.rootname(i)));if((t=this.toPosix(t)).startsWith("/"))return u_.join(r,t.slice(1));return this.isAbsolute(t)?t:this.join(i,t)},normalize(t){if(h_(t),0===t.length)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;let e="";const n=(t=this.toPosix(t)).startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const i=t.endsWith("/");return(t=function(t){let e="",n=0,i=-1,r=0,s=-1;for(let a=0;a<=t.length;++a){if(a<t.length)s=t.charCodeAt(a);else{if(47===s)break;s=47}if(47===s){if(i===a-1||1===r);else if(i!==a-1&&2===r){if(e.length<2||2!==n||46!==e.charCodeAt(e.length-1)||46!==e.charCodeAt(e.length-2))if(e.length>2){const t=e.lastIndexOf("/");if(t!==e.length-1){-1===t?(e="",n=0):(e=e.slice(0,t),n=e.length-1-e.lastIndexOf("/")),i=a,r=0;continue}}else if(2===e.length||1===e.length){e="",n=0,i=a,r=0;continue}}else e.length>0?e+=`/${t.slice(i+1,a)}`:e=t.slice(i+1,a),n=a-i-1;i=a,r=0}else 46===s&&-1!==r?++r:r=-1}return e}(t)).length>0&&i&&(t+="/"),n?`/${t}`:e+t},isAbsolute(t){return h_(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let n=0;n<t.length;++n){const i=t[n];if(h_(i),i.length>0)if(void 0===e)e=i;else{const r=t[n-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?e+=`/../${i}`:e+=`/${i}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(h_(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const n=47===e;let i=-1,r=!0;const s=this.getProtocol(t),a=t;for(let o=(t=t.slice(s.length)).length-1;o>=1;--o)if(e=t.charCodeAt(o),47===e){if(!r){i=o;break}}else r=!1;return-1===i?n?"/":this.isUrl(a)?s+t:s:n&&1===i?"//":s+t.slice(0,i)},rootname(t){h_(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const n=t.indexOf("/",e.length);e=-1!==n?t.slice(0,n):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){h_(t),e&&h_(e),t=c_(this.toPosix(t));let n,i=0,r=-1,s=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let a=e.length-1,o=-1;for(n=t.length-1;n>=0;--n){const l=t.charCodeAt(n);if(47===l){if(!s){i=n+1;break}}else-1===o&&(s=!1,o=n+1),a>=0&&(l===e.charCodeAt(a)?-1===--a&&(r=n):(a=-1,r=o))}return i===r?r=o:-1===r&&(r=t.length),t.slice(i,r)}for(n=t.length-1;n>=0;--n)if(47===t.charCodeAt(n)){if(!s){i=n+1;break}}else-1===r&&(s=!1,r=n+1);return-1===r?"":t.slice(i,r)},extname(t){h_(t);let e=-1,n=0,i=-1,r=!0,s=0;for(let a=(t=c_(this.toPosix(t))).length-1;a>=0;--a){const o=t.charCodeAt(a);if(47!==o)-1===i&&(r=!1,i=a+1),46===o?-1===e?e=a:1!==s&&(s=1):-1!==e&&(s=-1);else if(!r){n=a+1;break}}return-1===e||-1===i||0===s||1===s&&e===i-1&&e===n+1?"":t.slice(e,i)},parse(t){h_(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let n=(t=c_(this.toPosix(t))).charCodeAt(0);const i=this.isAbsolute(t);let r;e.root=this.rootname(t),r=i||this.hasProtocol(t)?1:0;let s=-1,a=0,o=-1,l=!0,h=t.length-1,c=0;for(;h>=r;--h)if(n=t.charCodeAt(h),47!==n)-1===o&&(l=!1,o=h+1),46===n?-1===s?s=h:1!==c&&(c=1):-1!==s&&(c=-1);else if(!l){a=h+1;break}return-1===s||-1===o||0===c||1===c&&s===o-1&&s===a+1?-1!==o&&(e.base=e.name=0===a&&i?t.slice(1,o):t.slice(a,o)):(0===a&&i?(e.name=t.slice(1,s),e.base=t.slice(1,o)):(e.name=t.slice(a,s),e.base=t.slice(a,o)),e.ext=t.slice(s,o)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]};function d_(t,e,n,i,r){const s=e[n];for(let a=0;a<s.length;a++){const o=s[a];n<e.length-1?d_(t.replace(i[n],o),e,n+1,i,r):r.push(t.replace(i[n],o))}}function p_(t){const e=t.match(/\{(.*?)\}/g),n=[];if(e){const i=[];e.forEach(t=>{const e=t.substring(1,t.length-1).split(",");i.push(e)}),d_(t,i,0,e,n)}else n.push(t);return n}const f_=t=>!Array.isArray(t);class m_{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}}getAlias(t){const{alias:e,src:n}=t;return n_(e||n,t=>"string"==typeof t?t:Array.isArray(t)?t.map(t=>(null==t?void 0:t.src)??t):(null==t?void 0:t.src)?t.src:t,!0)}addManifest(t){this._manifest&&Vx(),this._manifest=t,t.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(t,e){const n=[];let i=e;Array.isArray(e)||(i=Object.entries(e).map(([t,e])=>"string"==typeof e||Array.isArray(e)?{alias:t,src:e}:{alias:t,...e})),i.forEach(e=>{const i=e.src,r=e.alias;let s;if("string"==typeof r){const e=this._createBundleAssetId(t,r);n.push(e),s=[r,e]}else{const e=r.map(e=>this._createBundleAssetId(t,e));n.push(...e),s=[...r,...e]}this.add({...e,alias:s,src:i})}),this._bundles[t]=n}add(t){const e=[];let n;Array.isArray(t)?e.push(...t):e.push(t),n=t=>{this.hasKey(t)&&Vx()};n_(e).forEach(t=>{const{src:e}=t;let{data:i,format:r,loadParser:s}=t;const a=n_(e).map(t=>"string"==typeof t?p_(t):Array.isArray(t)?t:[t]),o=this.getAlias(t);Array.isArray(o)?o.forEach(n):n(o);const l=[];a.forEach(t=>{t.forEach(t=>{let e={};if("object"!=typeof t){e.src=t;for(let n=0;n<this._parsers.length;n++){const i=this._parsers[n];if(i.test(t)){e=i.parse(t);break}}}else i=t.data??i,r=t.format??r,s=t.loadParser??s,e={...e,...t};if(!o)throw new Error(`[Resolver] alias is undefined for this asset: ${e.src}`);e=this._buildResolvedAsset(e,{aliases:o,data:i,format:r,loadParser:s}),l.push(e)})}),o.forEach(t=>{this._assetMap[t]=l})})}resolveBundle(t){const e=f_(t);t=n_(t);const n={};return t.forEach(t=>{const e=this._bundles[t];if(e){const i=this.resolve(e),r={};for(const e in i){const n=i[e];r[this._extractAssetIdFromBundle(t,e)]=n}n[t]=r}}),e?n[t[0]]:n}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const n in e)t[n]=e[n].src;return t}return e.src}resolve(t){const e=f_(t);t=n_(t);const n={};return t.forEach(t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const n=this._getPreferredOrder(e);null==n||n.priority.forEach(t=>{n.params[t].forEach(n=>{const i=e.filter(e=>!!e[t]&&e[t]===n);i.length&&(e=i)})}),this._resolverHash[t]=e[0]}else this._resolverHash[t]=this._buildResolvedAsset({alias:[t],src:t},{});n[t]=this._resolverHash[t]}),e?n[t[0]]:n}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const n=t[e],i=this._preferredOrder.find(t=>t.params.format.includes(n.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:n,data:i,loadParser:r,format:s}=e;return(this._basePath||this._rootPath)&&(t.src=u_.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=n??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...i||{},...t.data},t.loadParser=r??t.loadParser,t.format=s??t.format??g_(t.src),t}}function g_(t){return t.split(".").pop().split("?").shift().split("#").shift()}m_.RETINA_PREFIX=/@([0-9\.]+)x/;const v_=(t,e)=>{const n=e.split("?")[1];return n&&(t+=`?${n}`),t},y_=class t{constructor(t,e){this.linkedSheets=[];let n=t;(null==t?void 0:t.source)instanceof ix&&(n={texture:t,data:e});const{texture:i,data:r,cachePrefix:s=""}=n;this.cachePrefix=s,this._texture=i instanceof ox?i:null,this.textureSource=i.source,this.textures={},this.animations={},this.data=r;const a=parseFloat(r.meta.scale);a?(this.resolution=a,i.source.resolution=this.resolution):this.resolution=i.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let n=e;const i=t.BATCH_SIZE;for(;n-e<i&&n<this._frameKeys.length;){const t=this._frameKeys[n],e=this._frames[t],i=e.frame;if(i){let n=null,r=null;const s=!1!==e.trimmed&&e.sourceSize?e.sourceSize:e.frame,a=new Hy(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);n=e.rotated?new Hy(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.h)/this.resolution,Math.floor(i.w)/this.resolution):new Hy(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution),!1!==e.trimmed&&e.spriteSourceSize&&(r=new Hy(Math.floor(e.spriteSourceSize.x)/this.resolution,Math.floor(e.spriteSourceSize.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution)),this.textures[t]=new ox({source:this.textureSource,frame:n,orig:a,trim:r,rotate:e.rotated?2:0,defaultAnchor:e.anchor,defaultBorders:e.borders,label:t.toString()})}n++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let n=0;n<t[e].length;n++){const i=t[e][n];this.animations[e].push(this.textures[i])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*t.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const n in this.textures)this.textures[n].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null==(e=this._texture)||e.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};y_.BATCH_SIZE=1e3;let x_=y_;const b_=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function __(t,e,n){const i={};if(t.forEach(t=>{i[t]=e}),Object.keys(e.textures).forEach(t=>{i[`${e.cachePrefix}${t}`]=e.textures[t]}),!n){const n=u_.dirname(t[0]);e.linkedSheets.forEach((t,r)=>{const s=__([`${n}/${e.data.meta.related_multi_packs[r]}`],t,!0);Object.assign(i,s)})}return i}const S_={extension:fy.Asset,cache:{test:t=>t instanceof x_,getCacheableAssets:(t,e)=>__(t,e,!1)},resolver:{extension:{type:fy.ResolveParser,name:"resolveSpritesheet"},test:t=>{const e=t.split("?")[0].split("."),n=e.pop(),i=e.pop();return"json"===n&&b_.includes(i)},parse:t=>{var e;const n=t.split(".");return{resolution:parseFloat((null==(e=m_.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:n[n.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:fy.LoadParser,priority:l_.Normal,name:"spritesheetLoader"},testParse:async(t,e)=>".json"===u_.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,n){var i,r;const{texture:s,imageFilename:a,textureOptions:o,cachePrefix:l}=(null==e?void 0:e.data)??{};let h,c=u_.dirname(e.src);if(c&&c.lastIndexOf("/")!==c.length-1&&(c+="/"),s instanceof ox)h=s;else{const i=v_(c+(a??t.meta.image),e.src);h=(await n.load([{src:i,data:o}]))[i]}const u=new x_({texture:h.source,data:t,cachePrefix:l});await u.parse();const d=null==(i=null==t?void 0:t.meta)?void 0:i.related_multi_packs;if(Array.isArray(d)){const t=[];for(const s of d){if("string"!=typeof s)continue;let i=c+s;(null==(r=e.data)?void 0:r.ignoreMultiPack)||(i=v_(i,e.src),t.push(n.load({src:i,data:{textureOptions:o,ignoreMultiPack:!0}})))}const i=await Promise.all(t);u.linkedSheets=i,i.forEach(t=>{t.linkedSheets=[u].concat(u.linkedSheets.filter(e=>e!==t))})}return u},async unload(t,e,n){await n.unload(t.textureSource._sourceOrigin),t.destroy(!1)}}};vy.add(S_);class w_{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=w_.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Cy,this.page=new Cy,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,n,i,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var T_=/iPhone/i,M_=/iPod/i,A_=/iPad/i,E_=/\biOS-universal(?:.+)Mac\b/i,C_=/\bAndroid(?:.+)Mobile\b/i,P_=/Android/i,R_=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,I_=/Silk/i,O_=/Windows Phone/i,D_=/\bWindows(?:.+)ARM\b/i,B_=/BlackBerry/i,F_=/BB10/i,L_=/Opera Mini/i,U_=/\b(CriOS|Chrome)(?:.+)Mobile/i,k_=/Mobile(?:.+)Firefox\b/i,N_=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function z_(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var n=e.userAgent,i=n.split("[FBAN");void 0!==i[1]&&(n=i[0]),void 0!==(i=n.split("Twitter"))[1]&&(n=i[0]);var r=function(t){return function(e){return e.test(t)}}(n),s={apple:{phone:r(T_)&&!r(O_),ipod:r(M_),tablet:!r(T_)&&(r(A_)||N_(e))&&!r(O_),universal:r(E_),device:(r(T_)||r(M_)||r(A_)||r(E_)||N_(e))&&!r(O_)},amazon:{phone:r(R_),tablet:!r(R_)&&r(I_),device:r(R_)||r(I_)},android:{phone:!r(O_)&&r(R_)||!r(O_)&&r(C_),tablet:!r(O_)&&!r(R_)&&!r(C_)&&(r(I_)||r(P_)),device:!r(O_)&&(r(R_)||r(I_)||r(C_)||r(P_))||r(/\bokhttp\b/i)},windows:{phone:r(O_),tablet:r(D_),device:r(O_)||r(D_)},other:{blackberry:r(B_),blackberry10:r(F_),opera:r(L_),firefox:r(k_),chrome:r(U_),device:r(B_)||r(F_)||r(L_)||r(k_)||r(U_)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const G_=(z_.default??z_)(globalThis.navigator),H_=class t{constructor(t,e=G_){this._mobileInfo=e,this.debug=!1,this._activateOnTab=!0,this._deactivateOnMouseMove=!0,this._isActive=!1,this._isMobileAccessibility=!1,this._div=null,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(e.tablet||e.phone)&&this._createTouchHook(),this._renderer=t}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){if(this._isActive)return;this._isActive=!0,this._div||(this._div=document.createElement("div"),this._div.style.width="100px",this._div.style.height="100px",this._div.style.position="absolute",this._div.style.top="0px",this._div.style.left="0px",this._div.style.zIndex=2..toString(),this._div.style.pointerEvents="none"),this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._deactivateOnMouseMove&&(this._onMouseMove=this._onMouseMove.bind(this),globalThis.document.addEventListener("mousemove",this._onMouseMove,!0));const t=this._renderer.view.canvas;if(t.parentNode)t.parentNode.appendChild(this._div),this._initAccessibilitySetup();else{const e=new MutationObserver(()=>{t.parentNode&&(t.parentNode.appendChild(this._div),e.disconnect(),this._initAccessibilitySetup())});e.observe(document.body,{childList:!0,subtree:!0})}}_initAccessibilitySetup(){this._renderer.runners.postrender.add(this),this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered)}_deactivate(){if(this._isActive&&!this._isMobileAccessibility){this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),this._activateOnTab&&globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this);for(const t of this._children)t._accessibleDiv&&t._accessibleDiv.parentNode&&(t._accessibleDiv.parentNode.removeChild(t._accessibleDiv),t._accessibleDiv=null),t._accessibleActive=!1;this._pool.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this._div&&this._div.parentNode&&this._div.parentNode.removeChild(this._div),this._pool=[],this._children=[]}}_updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&(t._accessibleActive||this._addChild(t),t._renderId=this._renderId);const e=t.children;if(e)for(let n=0;n<e.length;n++)this._updateAccessibleObjects(e[n])}init(e){const n={accessibilityOptions:{...t.defaultOptions,...(null==e?void 0:e.accessibilityOptions)||{}}};this.debug=n.accessibilityOptions.debug,this._activateOnTab=n.accessibilityOptions.activateOnTab,this._deactivateOnMouseMove=n.accessibilityOptions.deactivateOnMouseMove,n.accessibilityOptions.enabledByDefault?this._activate():this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._renderer.runners.postrender.remove(this)}postrender(){const t=performance.now();if(this._mobileInfo.android.device&&t<this._androidUpdateCount)return;if(this._androidUpdateCount=t+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas)return;const e=new Set;if(this._renderer.lastObjectRendered){this._updateAccessibleObjects(this._renderer.lastObjectRendered);for(const t of this._children)t._renderId===this._renderId&&e.add(this._children.indexOf(t))}for(let n=this._children.length-1;n>=0;n--){const t=this._children[n];e.has(n)||(t._accessibleDiv&&t._accessibleDiv.parentNode&&(t._accessibleDiv.parentNode.removeChild(t._accessibleDiv),this._pool.push(t._accessibleDiv),t._accessibleDiv=null),t._accessibleActive=!1,qx(this._children,n,1))}if(this._renderer.renderingToScreen){const{x:t,y:e,width:n,height:i}=this._renderer.screen,r=this._div;r.style.left=`${t}px`,r.style.top=`${e}px`,r.style.width=`${n}px`,r.style.height=`${i}px`}for(let n=0;n<this._children.length;n++){const t=this._children[n];if(!t._accessibleActive||!t._accessibleDiv)continue;const e=t._accessibleDiv,i=t.hitArea||t.getBounds().rectangle;if(t.hitArea){const n=t.worldTransform,r=this._renderer.resolution,s=this._renderer.resolution;e.style.left=(n.tx+i.x*n.a)*r+"px",e.style.top=(n.ty+i.y*n.d)*s+"px",e.style.width=i.width*n.a*r+"px",e.style.height=i.height*n.d*s+"px"}else{this._capHitArea(i);const t=this._renderer.resolution,n=this._renderer.resolution;e.style.left=i.x*t+"px",e.style.top=i.y*n+"px",e.style.width=i.width*t+"px",e.style.height=i.height*n+"px"}}this._renderId++}_updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}_capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:n}=this._renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>n&&(t.height=n-t.y)}_addChild(t){let e=this._pool.pop();e||("button"===t.accessibleType?e=document.createElement("button"):(e=document.createElement(t.accessibleType),e.style.cssText="\n                        color: transparent;\n                        pointer-events: none;\n                        padding: 0;\n                        margin: 0;\n                        border: 0;\n                        outline: 0;\n                        background: transparent;\n                        box-sizing: border-box;\n                        user-select: none;\n                        -webkit-user-select: none;\n                        -moz-user-select: none;\n                        -ms-user-select: none;\n                    ",t.accessibleText&&(e.innerText=t.accessibleText)),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`container ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this._updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.container=t,this._children.push(t),this._div.appendChild(t._accessibleDiv),t.interactive&&(t._accessibleDiv.tabIndex=t.tabIndex)}_dispatchEvent(t,e){const{container:n}=t.target,i=this._renderer.events.rootBoundary,r=Object.assign(new w_(i),{target:n});i.rootTarget=this._renderer.lastObjectRendered,e.forEach(t=>i.dispatchEvent(r,t))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this._activateOnTab&&this._activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this._deactivate()}destroy(){this._deactivate(),this._destroyTouchHook(),this._div=null,this._pool=null,this._children=null,this._renderer=null,this._activateOnTab&&globalThis.removeEventListener("keydown",this._onKeyDown)}setAccessibilityEnabled(t){t?this._activate():this._deactivate()}};H_.extension={type:[fy.WebGLSystem,fy.WebGPUSystem],name:"accessibility"},H_.defaultOptions={enabledByDefault:!1,debug:!1,activateOnTab:!0,deactivateOnMouseMove:!0};let V_=H_;const X_={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,accessibleType:"button",accessibleText:null,accessiblePointerEvents:"auto",accessibleChildren:!0,_accessibleActive:!1,_accessibleDiv:null,_renderId:-1},W_=Object.create(null),j_=Object.create(null);function Y_(t,e){let n=j_[t];return void 0===n&&(void 0===W_[e]&&(W_[e]=1),j_[t]=n=W_[e]++),n}let q_,K_;function J_(){if(!q_||(null==q_?void 0:q_.isContextLost())){const t=Wb.get().createCanvas();q_=t.getContext("webgl",{})}return q_}function Z_(){if(!K_){K_="mediump";const t=J_();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);K_=e.precision?"highp":"mediump"}}return K_}function Q_(t,e,n){return e?t:n?`\n\n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in varying\n        #define finalColor gl_FragColor\n        #define texture texture2D\n        #endif\n        ${t=t.replace("out vec4 finalColor;","")}\n        `:`\n\n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in attribute\n        #define out varying\n        #endif\n        ${t}\n        `}function $_(t,e,n){const i=n?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if("precision"!==t.substring(0,9)){let r=n?e.requestedFragmentPrecision:e.requestedVertexPrecision;return"highp"===r&&"highp"!==i&&(r="mediump"),`precision ${r} float;\n${t}`}return"highp"!==i&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}function tS(t,e){return e?`#version 300 es\n${t}`:t}const eS={},nS={};function iS(t,{name:e="pixi-program"},n=!0){e=e.replace(/\s+/g,"-");const i=n?eS:nS;if(i[e+=n?"-fragment":"-vertex"]?(i[e]++,e+=`-${i[e]}`):i[e]=1,-1!==t.indexOf("#define SHADER_NAME"))return t;return`${`#define SHADER_NAME ${e}`}\n${t}`}function rS(t,e){return e?t.replace("#version 300 es",""):t}const sS={stripVersion:rS,ensurePrecision:$_,addProgramDefines:Q_,setProgramName:iS,insertVersion:tS},aS=Object.create(null),oS=class t{constructor(e){const n=-1!==(e={...t.defaultOptions,...e}).fragment.indexOf("#version 300 es"),i={stripVersion:n,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Z_()},setProgramName:{name:e.name},addProgramDefines:n,insertVersion:n};let r=e.fragment,s=e.vertex;Object.keys(sS).forEach(t=>{const e=i[t];r=sS[t](r,e,!0),s=sS[t](s,e,!1)}),this.fragment=r,this.vertex=s,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=Y_(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){const n=`${e.vertex}:${e.fragment}`;return aS[n]||(aS[n]=new t(e)),aS[n]}};oS.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let lS=oS;const hS={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function cS(t){return hS[t]??hS.float32}const uS={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function dS({source:t,entryPoint:e}){const n={},i=t.indexOf(`fn ${e}`);if(-1!==i){const e=t.indexOf("->",i);if(-1!==e){const r=t.substring(i,e),s=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;null!==(a=s.exec(r));){const t=uS[a[3]]??"float32";n[a[2]]={location:parseInt(a[1],10),format:t,stride:cS(t).stride,offset:0,instance:!1,start:0}}}}return n}function pS(t){var e,n;const i=/@group\((\d+)\)/,r=/@binding\((\d+)\)/,s=/var(<[^>]+>)? (\w+)/,a=/:\s*(\w+)/,o=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,h=null==(e=t.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g))?void 0:e.map(t=>({group:parseInt(t.match(i)[1],10),binding:parseInt(t.match(r)[1],10),name:t.match(s)[2],isUniform:"<uniform>"===t.match(s)[1],type:t.match(a)[1]}));if(!h)return{groups:[],structs:[]};const c=(null==(n=t.match(/struct\s+(\w+)\s*{([^}]+)}/g))?void 0:n.map(t=>{const e=t.match(l)[1],n=t.match(o).reduce((t,e)=>{const[n,i]=e.split(":");return t[n.trim()]=i.trim(),t},{});return n?{name:e,members:n}:null}).filter(({name:t})=>h.some(e=>e.type===t)))??[];return{groups:h,structs:c}}var fS=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(fS||{});function mS({groups:t}){const e=[];for(let n=0;n<t.length;n++){const i=t[n];e[i.group]||(e[i.group]=[]),i.isUniform?e[i.group].push({binding:i.binding,visibility:fS.VERTEX|fS.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===i.type?e[i.group].push({binding:i.binding,visibility:fS.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===i.type&&e[i.group].push({binding:i.binding,visibility:fS.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}function gS({groups:t}){const e=[];for(let n=0;n<t.length;n++){const i=t[n];e[i.group]||(e[i.group]={}),e[i.group][i.name]=i.binding}return e}function vS(t,e){const n=new Set,i=new Set;return{structs:[...t.structs,...e.structs].filter(t=>!n.has(t.name)&&(n.add(t.name),!0)),groups:[...t.groups,...e.groups].filter(t=>{const e=`${t.name}-${t.binding}`;return!i.has(e)&&(i.add(e),!0)})}}const yS=Object.create(null);class xS{constructor(t){var e,n;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:i,vertex:r,layout:s,gpuLayout:a,name:o}=t;if(this.name=o,this.fragment=i,this.vertex=r,i.source===r.source){const t=pS(i.source);this.structsAndGroups=t}else{const t=pS(r.source),e=pS(i.source);this.structsAndGroups=vS(t,e)}this.layout=s??gS(this.structsAndGroups),this.gpuLayout=a??mS(this.structsAndGroups),this.autoAssignGlobalUniforms=!(void 0===(null==(e=this.layout[0])?void 0:e.globalUniforms)),this.autoAssignLocalUniforms=!(void 0===(null==(n=this.layout[1])?void 0:n.localUniforms)),this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,n=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=Y_(n,"program")}get attributeData(){return this._attributeData??(this._attributeData=dS(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return yS[e]||(yS[e]=new xS(t)),yS[e]}}const bS=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],_S=bS.reduce((t,e)=>(t[e]=!0,t),{});function SS(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const wS=class t{constructor(e,n){this._touched=0,this.uid=Xy("uniform"),this._resourceType="uniformGroup",this._resourceId=Xy("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,n={...t.defaultOptions,...n},this.uniformStructures=e;const i={};for(const t in e){const n=e[t];if(n.name=t,n.size=n.size??1,!_S[n.type])throw new Error(`Uniform type ${n.type} is not supported. Supported uniform types are: ${bS.join(", ")}`);n.value??(n.value=SS(n.type,n.size)),i[t]=n.value}this.uniforms=i,this._dirtyId=1,this.ubo=n.ubo,this.isStatic=n.isStatic,this._signature=Y_(Object.keys(i).map(t=>`${t}-${e[t].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};wS.defaultOptions={ubo:!1,isStatic:!1};let TS=wS;class MS{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const n in t){const i=t[n];this.setResource(i,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const n in this.resources)t[e++]=this.resources[n]._resourceId;this._key=t.join("|")}setResource(t,e){var n,i;const r=this.resources[e];t!==r&&(r&&(null==(n=t.off)||n.call(t,"change",this.onResourceChange,this)),null==(i=t.on)||i.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const n in e)e[n]._touched=t}destroy(){var t;const e=this.resources;for(const n in e){const i=e[n];null==(t=i.off)||t.call(i,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const n in e)e[n]===t&&(e[n]=null)}else this._updateKey()}}var AS=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(AS||{});class ES extends Ty{constructor(t){super(),this.uid=Xy("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:n,groups:i,resources:r,compatibleRenderers:s,groupMap:a}=t;this.gpuProgram=e,this.glProgram=n,void 0===s&&(s=0,e&&(s|=AS.WEBGPU),n&&(s|=AS.WEBGL)),this.compatibleRenderers=s;const o={};if(r||i||(r={}),r&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&i&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&i&&a)for(const l in a)for(const t in a[l]){const e=a[l][t];o[e]={group:l,binding:t,name:e}}else if(e&&i&&!a){const t=e.structsAndGroups.groups;a={},t.forEach(t=>{a[t.group]=a[t.group]||{},a[t.group][t.binding]=t.name,o[t.name]=t})}else if(r){if(i={},a={},e){e.structsAndGroups.groups.forEach(t=>{a[t.group]=a[t.group]||{},a[t.group][t.binding]=t.name,o[t.name]=t})}let t=0;for(const e in r)o[e]||(i[99]||(i[99]=new MS,this._ownedBindGroups.push(i[99])),o[e]={group:99,binding:t,name:e},a[99]=a[99]||{},a[99][t]=e,t++);for(const e in r){const t=e;let n=r[e];n.source||n._resourceType||(n=new TS(n));const s=o[t];s&&(i[s.group]||(i[s.group]=new MS,this._ownedBindGroups.push(i[s.group])),i[s.group].setResource(n,s.binding))}}this.groups=i,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(i,o)}addResource(t,e,n){var i,r;(i=this._uniformBindMap)[e]||(i[e]={}),(r=this._uniformBindMap[e])[n]||(r[n]=t),this.groups[e]||(this.groups[e]=new MS,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const n={};for(const i in e){const r=e[i];Object.defineProperty(n,r.name,{get:()=>t[r.group].getResource(r.binding),set(e){t[r.group].setResource(e,r.binding)}})}return n}destroy(t=!1){var e,n;this.emit("destroy",this),t&&(null==(e=this.gpuProgram)||e.destroy(),null==(n=this.glProgram)||n.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(t=>{t.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:n,...i}=t;let r,s;return e&&(r=xS.from(e)),n&&(s=lS.from(n)),new ES({gpuProgram:r,glProgram:s,...i})}}const CS={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},PS=class t{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}set cullMode(t){"none"!==t?(this.culling=!0,this.clockwiseFrontFace="front"===t):this.culling=!1}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend="none"!==t,this._blendMode=t,this._blendModeId=CS[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new t;return e.depthTest=!1,e.blend=!0,e}};PS.default2d=PS.for2d();let RS=PS;const IS=class t extends ES{constructor(e){super(e={...t.defaultOptions,...e}),this.enabled=!0,this._state=RS.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,"boolean"==typeof e.antialias?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(t,e,n,i){t.applyFilter(this,e,n,i)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(e){const{gpu:n,gl:i,...r}=e;let s,a;return n&&(s=xS.from(n)),i&&(a=lS.from(i)),new t({gpuProgram:s,glProgram:a,...r})}};IS.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let OS=IS;var DS="\nin vec2 vTextureCoord;\nin vec4 vColor;\n\nout vec4 finalColor;\n\nuniform float uBlend;\n\nuniform sampler2D uTexture;\nuniform sampler2D uBackTexture;\n\n{FUNCTIONS}\n\nvoid main()\n{ \n    vec4 back = texture(uBackTexture, vTextureCoord);\n    vec4 front = texture(uTexture, vTextureCoord);\n    float blendedAlpha = front.a + back.a * (1.0 - front.a);\n    \n    {MAIN}\n}\n",BS="in vec2 aPosition;\nout vec2 vTextureCoord;\nout vec2 backgroundUv;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",FS="\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct BlendUniforms {\n  uBlend:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n@group(0) @binding(3) var uBackTexture: texture_2d<f32>;\n\n@group(1) @binding(0) var<uniform> blendUniforms : BlendUniforms;\n\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\n{FUNCTIONS}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>\n) -> @location(0) vec4<f32> {\n\n\n   var back =  textureSample(uBackTexture, uSampler, uv);\n   var front = textureSample(uTexture, uSampler, uv);\n   var blendedAlpha = front.a + back.a * (1.0 - front.a);\n   \n   var out = vec4<f32>(0.0,0.0,0.0,0.0);\n\n   {MAIN}\n\n   return out;\n}";class LS extends OS{constructor(t){const e=t.gpu,n=US({source:FS,...e}),i=xS.from({vertex:{source:n,entryPoint:"mainVertex"},fragment:{source:n,entryPoint:"mainFragment"}}),r=t.gl,s=US({source:DS,...r});super({gpuProgram:i,glProgram:lS.from({vertex:BS,fragment:s}),blendRequired:!0,resources:{blendUniforms:new TS({uBlend:{value:1,type:"f32"}}),uBackTexture:ox.EMPTY}})}}function US(t){const{source:e,functions:n,main:i}=t;return e.replace("{FUNCTIONS}",n).replace("{MAIN}",i)}const kS="\n\tfloat getLuminosity(vec3 c) {\n\t\treturn 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;\n\t}\n\n\tvec3 setLuminosity(vec3 c, float lum) {\n\t\tfloat modLum = lum - getLuminosity(c);\n\t\tvec3 color = c.rgb + vec3(modLum);\n\n\t\t// clip back into legal range\n\t\tmodLum = getLuminosity(color);\n\t\tvec3 modLumVec = vec3(modLum);\n\n\t\tfloat cMin = min(color.r, min(color.g, color.b));\n\t\tfloat cMax = max(color.r, max(color.g, color.b));\n\n\t\tif(cMin < 0.0) {\n\t\t\tcolor = mix(modLumVec, color, modLum / (modLum - cMin));\n\t\t}\n\n\t\tif(cMax > 1.0) {\n\t\t\tcolor = mix(modLumVec, color, (1.0 - modLum) / (cMax - modLum));\n\t\t}\n\n\t\treturn color;\n\t}\n\n\tfloat getSaturation(vec3 c) {\n\t\treturn max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));\n\t}\n\n\tvec3 setSaturationMinMidMax(vec3 cSorted, float s) {\n\t\tvec3 colorSorted = cSorted;\n\n\t\tif(colorSorted.z > colorSorted.x) {\n\t\t\tcolorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));\n\t\t\tcolorSorted.z = s;\n\t\t}\n\t\telse {\n\t\t\tcolorSorted.y = 0.0;\n\t\t\tcolorSorted.z = 0.0;\n\t\t}\n\n\t\tcolorSorted.x = 0.0;\n\n\t\treturn colorSorted;\n\t}\n\n\tvec3 setSaturation(vec3 c, float s) {\n\t\tvec3 color = c;\n\n\t\tif(color.r <= color.g && color.r <= color.b) {\n\t\t\tif(color.g <= color.b) {\n\t\t\t\tcolor = setSaturationMinMidMax(color.rgb, s).rgb;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolor = setSaturationMinMidMax(color.rbg, s).rbg;\n\t\t\t}\n\t\t}\n\t\telse if(color.g <= color.r && color.g <= color.b) {\n\t\t\tif(color.r <= color.b) {\n\t\t\t\tcolor = setSaturationMinMidMax(color.grb, s).grb;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolor = setSaturationMinMidMax(color.gbr, s).gbr;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Using bgr for both fixes part of hue\n\t\t\tif(color.r <= color.g) {\n\t\t\t\tcolor = setSaturationMinMidMax(color.brg, s).brg;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolor = setSaturationMinMidMax(color.bgr, s).bgr;\n\t\t\t}\n\t\t}\n\n\t\treturn color;\n\t}\n    ",NS="\n\tfn getLuminosity(c: vec3<f32>) -> f32\n\t{\n\t\treturn 0.3*c.r + 0.59*c.g + 0.11*c.b;\n\t}\n\n\tfn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32>\n\t{\n\t\tvar modLum: f32 = lum - getLuminosity(c);\n\t\tvar color: vec3<f32> = c.rgb + modLum;\n\n\t\t// clip back into legal range\n\t\tmodLum = getLuminosity(color);\n\t\tlet modLumVec = vec3<f32>(modLum);\n\n\t\tlet cMin: f32 = min(color.r, min(color.g, color.b));\n\t\tlet cMax: f32 = max(color.r, max(color.g, color.b));\n\n\t\tif(cMin < 0.0)\n\t\t{\n\t\t\tcolor = mix(modLumVec, color, modLum / (modLum - cMin));\n\t\t}\n\n\t\tif(cMax > 1.0)\n\t\t{\n\t\t\tcolor = mix(modLumVec, color, (1 - modLum) / (cMax - modLum));\n\t\t}\n\n\t\treturn color;\n\t}\n\n\tfn getSaturation(c: vec3<f32>) -> f32\n\t{\n\t\treturn max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));\n\t}\n\n\tfn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32>\n\t{\n\t\tvar colorSorted = cSorted;\n\n\t\tif(colorSorted.z > colorSorted.x)\n\t\t{\n\t\t\tcolorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));\n\t\t\tcolorSorted.z = s;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcolorSorted.y = 0;\n\t\t\tcolorSorted.z = 0;\n\t\t}\n\n\t\tcolorSorted.x = 0;\n\n\t\treturn colorSorted;\n\t}\n\n\tfn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32>\n\t{\n\t\tvar color = c;\n\n\t\tif (color.r <= color.g && color.r <= color.b)\n\t\t{\n\t\t\tif (color.g <= color.b)\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.rgb, s)).rgb;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.rbg, s)).rbg;\n\t\t\t}\n\t\t}\n\t\telse if (color.g <= color.r && color.g <= color.b)\n\t\t{\n\t\t\tif (color.r <= color.b)\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.grb, s)).grb;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.gbr, s)).gbr;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Using bgr for both fixes part of hue\n\t\t\tif (color.r <= color.g)\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.brg, s)).brg;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor  = vec3<f32>(setSaturationMinMidMax(color.bgr, s)).bgr;\n\t\t\t}\n\t\t}\n\n\t\treturn color;\n\t}\n\t";class zS extends LS{constructor(){super({gl:{functions:`\n                ${kS}\n\n                vec3 blendColor(vec3 base, vec3 blend,  float opacity)\n                {\n                    return (setLuminosity(blend, getLuminosity(base)) * opacity + base * (1.0 - opacity));\n                }\n                `,main:"\n                finalColor = vec4(blendColor(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:`\n                ${NS}\n\n                fn blendColorOpacity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    return (setLuminosity(blend, getLuminosity(base)) * opacity + base * (1.0 - opacity));\n                }\n                `,main:"\n                out = vec4<f32>(blendColorOpacity(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}zS.extension={name:"color",type:fy.BlendMode};class GS extends LS{constructor(){super({gl:{functions:"\n                float colorBurn(float base, float blend)\n                {\n                    return max((1.0 - ((1.0 - base) / blend)), 0.0);\n                }\n\n                vec3 blendColorBurn(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        colorBurn(base.r, blend.r),\n                        colorBurn(base.g, blend.g),\n                        colorBurn(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                finalColor = vec4(blendColorBurn(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n            "},gpu:{functions:"\n                fn colorBurn(base:f32, blend:f32) -> f32\n                {\n                    return max((1.0-((1.0-base)/blend)),0.0);\n                }\n\n                fn blendColorBurn(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        colorBurn(base.r, blend.r),\n                        colorBurn(base.g, blend.g),\n                        colorBurn(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendColorBurn(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}GS.extension={name:"color-burn",type:fy.BlendMode};class HS extends LS{constructor(){super({gl:{functions:"\n                float colorDodge(float base, float blend)\n                {\n                    return base / (1.0 - blend);\n                }\n\n                vec3 blendColorDodge(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        colorDodge(base.r, blend.r),\n                        colorDodge(base.g, blend.g),\n                        colorDodge(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendColorDodge(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn colorDodge(base: f32, blend: f32) -> f32\n                {\n                    return base / (1.0 - blend);\n                }\n\n                fn blendColorDodge(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        colorDodge(base.r, blend.r),\n                        colorDodge(base.g, blend.g),\n                        colorDodge(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                    out = vec4<f32>(blendColorDodge(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}HS.extension={name:"color-dodge",type:fy.BlendMode};class VS extends LS{constructor(){super({gl:{functions:"\n                vec3 blendDarken(vec3 base, vec3 blend, float opacity)\n                {\n                    return (min(base, blend) * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendDarken(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn blendDarken(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    return (min(blend,base) * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                out = vec4<f32>(blendDarken(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}VS.extension={name:"darken",type:fy.BlendMode};class XS extends LS{constructor(){super({gl:{functions:"\n                vec3 blendDifference(vec3 base, vec3 blend,  float opacity)\n                {\n                    return (abs(blend - base) * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                finalColor = vec4(blendDifference(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n            "},gpu:{functions:"\n                fn blendDifference(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    return (abs(blend - base) * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendDifference(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}XS.extension={name:"difference",type:fy.BlendMode};class WS extends LS{constructor(){super({gl:{functions:"\n                float divide(float base, float blend)\n                {\n                    return (blend > 0.0) ? clamp(base / blend, 0.0, 1.0) : 1.0;\n                }\n\n                vec3 blendDivide(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        divide(base.r, blend.r),\n                        divide(base.g, blend.g),\n                        divide(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendDivide(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn divide(base: f32, blend: f32) -> f32\n                {\n                    return select(1.0, clamp(base / blend, 0.0, 1.0), blend > 0.0);\n                }\n\n                fn blendDivide(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        divide(base.r, blend.r),\n                        divide(base.g, blend.g),\n                        divide(base.b, blend.b)\n                    );\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendDivide(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}WS.extension={name:"divide",type:fy.BlendMode};class jS extends LS{constructor(){super({gl:{functions:"\n                vec3 exclusion(vec3 base, vec3 blend)\n                {\n                    return base + blend - 2.0 * base * blend;\n                }\n\n                vec3 blendExclusion(vec3 base, vec3 blend, float opacity)\n                {\n                    return (exclusion(base, blend) * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendExclusion(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn exclusion(base: vec3<f32>, blend: vec3<f32>) -> vec3<f32>\n                {\n                    return base+blend-2.0*base*blend;\n                }\n\n                fn blendExclusion(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>\n                {\n                    return (exclusion(base, blend) * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendExclusion(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}jS.extension={name:"exclusion",type:fy.BlendMode};class YS extends LS{constructor(){super({gl:{functions:"\n                float hardLight(float base, float blend)\n                {\n                    return (blend < 0.5) ? 2.0 * base * blend : 1.0 - 2.0 * (1.0 - base) * (1.0 - blend);\n                }\n\n                vec3 blendHardLight(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        hardLight(base.r, blend.r),\n                        hardLight(base.g, blend.g),\n                        hardLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                finalColor = vec4(blendHardLight(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n            "},gpu:{functions:"\n                fn hardLight(base: f32, blend: f32) -> f32\n                {\n                    return select(1.0 - 2.0 * (1.0 - base) * (1.0 - blend), 2.0 * base * blend, blend < 0.5);\n                }\n\n                fn blendHardLight(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        hardLight(base.r, blend.r),\n                        hardLight(base.g, blend.g),\n                        hardLight(base.b, blend.b)\n                    );\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                out = vec4<f32>(blendHardLight(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}YS.extension={name:"hard-light",type:fy.BlendMode};class qS extends LS{constructor(){super({gl:{functions:"\n                float hardMix(float base, float blend)\n                {\n                    return (base + blend >= 1.0) ? 1.0 : 0.0;\n                }\n\n                vec3 blendHardMix(vec3 base, vec3 blend,  float opacity)\n                {\n                    vec3 blended = vec3(\n                        hardMix(base.r, blend.r),\n                        hardMix(base.g, blend.g),\n                        hardMix(base.b, blend.b)\n                    );\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                finalColor = vec4(blendHardMix(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n            "},gpu:{functions:"\n                fn hardMix(base: f32, blend: f32) -> f32\n                {\n                    return select(0.0, 1.0, base + blend >= 1.0);\n                }\n\n                fn blendHardMix(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blended: vec3<f32> = vec3<f32>(\n                        hardMix(base.r, blend.r),\n                        hardMix(base.g, blend.g),\n                        hardMix(base.b, blend.b)\n                    );\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendHardMix(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}qS.extension={name:"hard-mix",type:fy.BlendMode};class KS extends LS{constructor(){super({gl:{functions:"\n                vec3 blendLighten(vec3 base, vec3 blend, float opacity)\n                {\n                    return (max(base, blend) * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendLighten(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn blendLighten(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    return (max(base, blend) * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendLighten(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}KS.extension={name:"lighten",type:fy.BlendMode};class JS extends LS{constructor(){super({gl:{functions:"\n                float linearBurn(float base, float blend)\n                {\n                    return max(0.0, base + blend - 1.0);\n                }\n\n                vec3 blendLinearBurn(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        linearBurn(base.r, blend.r),\n                        linearBurn(base.g, blend.g),\n                        linearBurn(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendLinearBurn(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn linearBurn(base: f32, blend: f32) -> f32\n                {\n                    return max(0.0, base + blend - 1.0);\n                }\n\n                fn blendLinearBurn(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        linearBurn(base.r, blend.r),\n                        linearBurn(base.g, blend.g),\n                        linearBurn(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                out = vec4<f32>(blendLinearBurn(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}JS.extension={name:"linear-burn",type:fy.BlendMode};class ZS extends LS{constructor(){super({gl:{functions:"\n                float linearDodge(float base, float blend) {\n                    return min(1.0, base + blend);\n                }\n\n                vec3 blendLinearDodge(vec3 base, vec3 blend, float opacity) {\n                    vec3 blended = vec3(\n                        linearDodge(base.r, blend.r),\n                        linearDodge(base.g, blend.g),\n                        linearDodge(base.b, blend.b)\n                    );\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendLinearDodge(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn linearDodge(base: f32, blend: f32) -> f32\n                {\n                    return min(1, base + blend);\n                }\n\n                fn blendLinearDodge(base:vec3<f32>, blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        linearDodge(base.r, blend.r),\n                        linearDodge(base.g, blend.g),\n                        linearDodge(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendLinearDodge(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}ZS.extension={name:"linear-dodge",type:fy.BlendMode};class QS extends LS{constructor(){super({gl:{functions:"\n                float linearBurn(float base, float blend) {\n                    return max(0.0, base + blend - 1.0);\n                }\n\n                float linearDodge(float base, float blend) {\n                    return min(1.0, base + blend);\n                }\n\n                float linearLight(float base, float blend) {\n                    return (blend <= 0.5) ? linearBurn(base,2.0*blend) : linearBurn(base,2.0*(blend-0.5));\n                }\n\n                vec3 blendLinearLight(vec3 base, vec3 blend, float opacity) {\n                    vec3 blended = vec3(\n                        linearLight(base.r, blend.r),\n                        linearLight(base.g, blend.g),\n                        linearLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                finalColor = vec4(blendLinearLight(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn linearBurn(base: f32, blend: f32) -> f32\n                {\n                    return max(0.0, base + blend - 1.0);\n                }\n\n                fn linearDodge(base: f32, blend: f32) -> f32\n                {\n                    return min(1.0, base + blend);\n                }\n\n                fn linearLight(base: f32, blend: f32) -> f32\n                {\n                    return select(linearBurn(base,2.0*(blend-0.5)), linearBurn(base,2.0*blend), blend <= 0.5);\n                }\n\n                fn blendLinearLightOpacity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        linearLight(base.r, blend.r),\n                        linearLight(base.g, blend.g),\n                        linearLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendLinearLightOpacity(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}QS.extension={name:"linear-light",type:fy.BlendMode};class $S extends LS{constructor(){super({gl:{functions:`\n                ${kS}\n\n                vec3 blendLuminosity(vec3 base, vec3 blend,  float opacity)\n                {\n                    vec3 blendLuminosity = setLuminosity(base, getLuminosity(blend));\n                    return (blendLuminosity * opacity + base * (1.0 - opacity));\n                }\n                `,main:"\n                finalColor = vec4(blendLuminosity(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:`\n                ${NS}\n\n                fn blendLuminosity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blendLuminosity: vec3<f32> = setLuminosity(base, getLuminosity(blend));\n                    return (blendLuminosity * opacity + base * (1.0 - opacity));\n                }\n            `,main:"\n                out = vec4<f32>(blendLuminosity(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}$S.extension={name:"luminosity",type:fy.BlendMode};class tw extends LS{constructor(){super({gl:{functions:"\n                vec3 negation(vec3 base, vec3 blend)\n                {\n                    return 1.0-abs(1.0-base-blend);\n                }\n\n                vec3 blendNegation(vec3 base, vec3 blend, float opacity)\n                {\n                    return (negation(base, blend) * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendNegation(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn blendNegation(base: vec3<f32>, blend: vec3<f32>) -> vec3<f32>\n                {\n                    return 1.0-abs(1.0-base-blend);\n                }\n\n                fn blendNegationOpacity(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>\n                {\n                    return (blendNegation(base, blend) * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                out = vec4<f32>(blendNegationOpacity(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}tw.extension={name:"negation",type:fy.BlendMode};class ew extends LS{constructor(){super({gl:{functions:"\n                float overlay(float base, float blend)\n                {\n                    return (base < 0.5) ? (2.0*base*blend) : (1.0-2.0*(1.0-base)*(1.0-blend));\n                }\n\n                vec3 blendOverlay(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        overlay(base.r, blend.r),\n                        overlay(base.g, blend.g),\n                        overlay(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendOverlay(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn overlay(base: f32, blend: f32) -> f32\n                {\n                    return select((1.0-2.0*(1.0-base)*(1.0-blend)), (2.0*base*blend), base < 0.5);\n                }\n\n                fn blendOverlay(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        overlay(base.r, blend.r),\n                        overlay(base.g, blend.g),\n                        overlay(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                out = vec4<f32>(blendOverlay(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}ew.extension={name:"overlay",type:fy.BlendMode};class nw extends LS{constructor(){super({gl:{functions:"\n                float pinLight(float base, float blend)\n                {\n                    return (blend <= 0.5) ? min(base, 2.0 * blend) : max(base, 2.0 * (blend - 0.5));\n                }\n\n                vec3 blendPinLight(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        pinLight(base.r, blend.r),\n                        pinLight(base.g, blend.g),\n                        pinLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                finalColor = vec4(blendPinLight(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn pinLight(base: f32, blend: f32) -> f32\n                {\n                    return select(max(base,2.0*(blend-0.5)), min(base,2.0*blend), blend <= 0.5);\n                }\n\n                fn blendPinLight(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        pinLight(base.r, blend.r),\n                        pinLight(base.g, blend.g),\n                        pinLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                out = vec4<f32>(blendPinLight(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}nw.extension={name:"pin-light",type:fy.BlendMode};class iw extends LS{constructor(){super({gl:{functions:`\n                ${kS}\n\n                vec3 blendSaturation(vec3 base, vec3 blend,  float opacity)\n                {\n                    vec3 blendSaturation = setLuminosity(setSaturation(base, getSaturation(blend)), getLuminosity(base));\n                    return (blendSaturation * opacity + base * (1.0 - opacity));\n                }\n            `,main:"\n                finalColor = vec4(blendSaturation(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;\n            "},gpu:{functions:`\n                ${NS}\n\n                fn blendSaturation(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blendSaturation = setLuminosity(setSaturation(base, getSaturation(blend)), getLuminosity(base));\n                    return (blendSaturation * opacity + base * (1.0 - opacity));\n                }\n            `,main:"\n                out = vec4<f32>(blendSaturation(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n            "}})}}iw.extension={name:"saturation",type:fy.BlendMode};class rw extends LS{constructor(){super({gl:{functions:"\n                float softLight(float base, float blend)\n                {\n                    return (blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend));\n                }\n\n                vec3 blendSoftLight(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        softLight(base.r, blend.r),\n                        softLight(base.g, blend.g),\n                        softLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendSoftLight(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn softLight(base: f32, blend: f32) -> f32\n                {\n                    return select(2.0 * base * blend + base * base * (1.0 - 2.0 * blend), sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend), blend < 0.5);\n                }\n\n                fn blendSoftLight(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blended: vec3<f32> = vec3<f32>(\n                        softLight(base.r, blend.r),\n                        softLight(base.g, blend.g),\n                        softLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                out = vec4<f32>(blendSoftLight(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}rw.extension={name:"soft-light",type:fy.BlendMode};class sw extends LS{constructor(){super({gl:{functions:"\n                float subtract(float base, float blend)\n                {\n                    return max(0.0, base - blend);\n                }\n\n                vec3 blendSubtract(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        subtract(base.r, blend.r),\n                        subtract(base.g, blend.g),\n                        subtract(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                finalColor = vec4(blendSubtract(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;\n                "},gpu:{functions:"\n                fn subtract(base: f32, blend: f32) -> f32\n                {\n                    return max(0, base - blend);\n                }\n\n                fn blendSubtract(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>\n                {\n                    let blended = vec3<f32>(\n                        subtract(base.r, blend.r),\n                        subtract(base.g, blend.g),\n                        subtract(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                out = vec4<f32>(blendSubtract(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}sw.extension={name:"subtract",type:fy.BlendMode};class aw extends LS{constructor(){super({gl:{functions:"\n                float colorBurn(float base, float blend)\n                {\n                    return max((1.0-((1.0-base)/blend)),0.0);\n                }\n\n                float colorDodge(float base, float blend)\n                {\n                    return min(1.0, base / (1.0-blend));\n                }\n\n                float vividLight(float base, float blend)\n                {\n                    return (blend < 0.5) ? colorBurn(base,(2.0*blend)) : colorDodge(base,(2.0*(blend-0.5)));\n                }\n\n                vec3 blendVividLight(vec3 base, vec3 blend, float opacity)\n                {\n                    vec3 blended = vec3(\n                        vividLight(base.r, blend.r),\n                        vividLight(base.g, blend.g),\n                        vividLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n            ",main:"\n                finalColor = vec4(blendVividLight(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;\n            "},gpu:{functions:"\n                fn colorBurn(base:f32, blend:f32) -> f32\n                {\n                    return max((1.0-((1.0-base)/blend)),0.0);\n                }\n\n                fn colorDodge(base: f32, blend: f32) -> f32\n                {\n                    return min(1.0, base / (1.0-blend));\n                }\n\n                fn vividLight(base: f32, blend: f32) -> f32\n                {\n                    return select(colorDodge(base,(2.0*(blend-0.5))), colorBurn(base,(2.0*blend)), blend<0.5);\n                }\n\n                fn blendVividLight(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>\n                {\n                    let blended: vec3<f32> = vec3<f32>(\n                        vividLight(base.r, blend.r),\n                        vividLight(base.g, blend.g),\n                        vividLight(base.b, blend.b)\n                    );\n\n                    return (blended * opacity + base * (1.0 - opacity));\n                }\n                ",main:"\n                out = vec4<f32>(blendVividLight(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;\n                "}})}}aw.extension={name:"vivid-light",type:fy.BlendMode};const ow=[];async function lw(t){if(!t)for(let e=0;e<ow.length;e++){const t=ow[e];if(t.value.test())return void(await t.value.load())}}let hw;function cw(){if("boolean"==typeof hw)return hw;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");hw=!0===t({a:"b"},"a","b")}catch(t){hw=!1}return hw}function uw(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=dw(t,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,h;if(i&&(s=function(t,e,n,i){const r=[];for(let s=0,a=e.length;s<a;s++){const n=dw(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i,!1);n===n.next&&(n.steiner=!0),r.push(ww(n))}r.sort(xw);for(let s=0;s<r.length;s++)n=bw(r[s],n);return n}(t,e,s,n)),t.length>80*n){o=t[0],l=t[1];let e=o,i=l;for(let s=n;s<r;s+=n){const n=t[s],r=t[s+1];n<o&&(o=n),r<l&&(l=r),n>e&&(e=n),r>i&&(i=r)}h=Math.max(e-o,i-l),h=0!==h?32767/h:0}return fw(s,a,n,o,l,h,0),a}function dw(t,e,n,i,r){let s;if(r===function(t,e,n,i){let r=0;for(let s=e,a=n-i;s<n;s+=i)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,n,i)>0)for(let a=e;a<n;a+=i)s=Bw(a/i|0,t[a],t[a+1],s);else for(let a=n-i;a>=e;a-=i)s=Bw(a/i|0,t[a],t[a+1],s);return s&&Cw(s,s.next)&&(Fw(s),s=s.next),s}function pw(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!Cw(i,i.next)&&0!==Ew(i.prev,i,i.next))i=i.next;else{if(Fw(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function fw(t,e,n,i,r,s,a){if(!t)return;!a&&s&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=Sw(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n=1;do{let i,r=t;t=null;let s=null;for(e=0;r;){e++;let a=r,o=0;for(let t=0;t<n&&(o++,a=a.nextZ,a);t++);let l=n;for(;o>0||l>0&&a;)0!==o&&(0===l||!a||r.z<=a.z)?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;r=a}s.nextZ=null,n*=2}while(e>1)}(r)}(t,i,r,s);let o=t;for(;t.prev!==t.next;){const l=t.prev,h=t.next;if(s?gw(t,i,r,s):mw(t))e.push(l.i,t.i,h.i),Fw(t),t=h.next,o=h.next;else if((t=h)===o){a?1===a?fw(t=vw(pw(t),e),e,n,i,r,s,2):2===a&&yw(t,e,n,i,r,s):fw(pw(t),e,n,i,r,s,1);break}}}function mw(t){const e=t.prev,n=t,i=t.next;if(Ew(e,n,i)>=0)return!1;const r=e.x,s=n.x,a=i.x,o=e.y,l=n.y,h=i.y,c=Math.min(r,s,a),u=Math.min(o,l,h),d=Math.max(r,s,a),p=Math.max(o,l,h);let f=i.next;for(;f!==e;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&Mw(r,o,s,l,a,h,f.x,f.y)&&Ew(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function gw(t,e,n,i){const r=t.prev,s=t,a=t.next;if(Ew(r,s,a)>=0)return!1;const o=r.x,l=s.x,h=a.x,c=r.y,u=s.y,d=a.y,p=Math.min(o,l,h),f=Math.min(c,u,d),m=Math.max(o,l,h),g=Math.max(c,u,d),v=Sw(p,f,e,n,i),y=Sw(m,g,e,n,i);let x=t.prevZ,b=t.nextZ;for(;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Mw(o,c,l,u,h,d,x.x,x.y)&&Ew(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Mw(o,c,l,u,h,d,b.x,b.y)&&Ew(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Mw(o,c,l,u,h,d,x.x,x.y)&&Ew(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Mw(o,c,l,u,h,d,b.x,b.y)&&Ew(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function vw(t,e){let n=t;do{const i=n.prev,r=n.next.next;!Cw(i,r)&&Pw(i,n,n.next,r)&&Ow(i,r)&&Ow(r,i)&&(e.push(i.i,n.i,r.i),Fw(n),Fw(n.next),n=t=r),n=n.next}while(n!==t);return pw(n)}function yw(t,e,n,i,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Aw(a,t)){let o=Dw(a,t);return a=pw(a,a.next),o=pw(o,o.next),fw(a,e,n,i,r,s,0),void fw(o,e,n,i,r,s,0)}t=t.next}a=a.next}while(a!==t)}function xw(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function bw(t,e){const n=function(t,e){let n=e;const i=t.x,r=t.y;let s,a=-1/0;if(Cw(t,n))return n;do{if(Cw(t,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>a&&(a=t,s=n.x<n.next.x?n:n.next,t===i))return s}n=n.next}while(n!==e);if(!s)return null;const o=s,l=s.x,h=s.y;let c=1/0;n=s;do{if(i>=n.x&&n.x>=l&&i!==n.x&&Tw(r<h?i:a,r,l,h,r<h?a:i,r,n.x,n.y)){const e=Math.abs(r-n.y)/(i-n.x);Ow(n,t)&&(e<c||e===c&&(n.x>s.x||n.x===s.x&&_w(s,n)))&&(s=n,c=e)}n=n.next}while(n!==o);return s}(t,e);if(!n)return e;const i=Dw(n,t);return pw(i,i.next),pw(n,n.next)}function _w(t,e){return Ew(t.prev,t,e.prev)<0&&Ew(e.next,t,t.next)<0}function Sw(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ww(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Tw(t,e,n,i,r,s,a,o){return(r-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(i-o)>=(n-a)*(e-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Mw(t,e,n,i,r,s,a,o){return!(t===a&&e===o)&&Tw(t,e,n,i,r,s,a,o)}function Aw(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Pw(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ow(t,e)&&Ow(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Ew(t.prev,t,e.prev)||Ew(t,e.prev,e))||Cw(t,e)&&Ew(t.prev,t,t.next)>0&&Ew(e.prev,e,e.next)>0)}function Ew(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Cw(t,e){return t.x===e.x&&t.y===e.y}function Pw(t,e,n,i){const r=Iw(Ew(t,e,n)),s=Iw(Ew(t,e,i)),a=Iw(Ew(n,i,t)),o=Iw(Ew(n,i,e));return r!==s&&a!==o||(!(0!==r||!Rw(t,n,e))||(!(0!==s||!Rw(t,i,e))||(!(0!==a||!Rw(n,t,i))||!(0!==o||!Rw(n,e,i)))))}function Rw(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Iw(t){return t>0?1:t<0?-1:0}function Ow(t,e){return Ew(t.prev,t,t.next)<0?Ew(t,e,t.next)>=0&&Ew(t,t.prev,e)>=0:Ew(t,e,t.prev)<0||Ew(t,t.next,e)<0}function Dw(t,e){const n=Lw(t.i,t.x,t.y),i=Lw(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Bw(t,e,n,i){const r=Lw(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Fw(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lw(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}vy.handleByNamedList(fy.Environment,ow);const Uw=uw.default||uw;var kw=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(kw||{});class Nw{constructor(t){this.items=[],this._name=t}emit(t,e,n,i,r,s,a,o){const{name:l,items:h}=this;for(let c=0,u=h.length;c<u;c++)h[c][l](t,e,n,i,r,s,a,o);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&this.items.splice(e,1),this}contains(t){return-1!==this.items.indexOf(t)}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}const zw=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Gw=class t extends Ty{constructor(t){super(),this.uid=Xy("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...zw,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(e={}){const n=!0===e.skipExtensionImports||!1===e.manageImports;await lw(n),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const t in this._systemsHash){e={...this._systemsHash[t].constructor.defaultOptions,...e}}e={...t.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let t=0;t<this.runners.init.items.length;t++)await this.runners.init.items[t].init(e);this._initOptions=e}render(t,e){let n=t;if(n instanceof Db&&(n={container:n},e&&(qy(0,"passing a second argument is deprecated, please use render options instead"),n.target=e.renderTexture)),n.target||(n.target=this.view.renderTarget),n.target===this.view.renderTarget&&(this._lastObjectRendered=n.container,n.clearColor??(n.clearColor=this.background.colorRgba),n.clear??(n.clear=this.background.clearBeforeRender)),n.clearColor){const t=Array.isArray(n.clearColor)&&4===n.clearColor.length;n.clearColor=t?n.clearColor:zx.shared.setValue(n.clearColor).toArray()}n.transform||(n.container.updateLocalTransform(),n.transform=n.container.localTransform),n.container.enableRenderGroup(),this.runners.prerender.emit(n),this.runners.renderStart.emit(n),this.runners.render.emit(n),this.runners.renderEnd.emit(n),this.runners.postrender.emit(n)}resize(t,e,n){const i=this.view.resolution;this.view.resize(t,e,n),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),void 0!==n&&n!==i&&this.runners.resolutionChange.emit(n)}clear(t={}){t.target||(t.target=this.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=kw.ALL);const{clear:e,clearColor:n,target:i}=t;zx.shared.setValue(n??this.background.colorRgba),this.renderTarget.clear(i,e,zx.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(t=>{this.runners[t]=new Nw(t)})}_addSystems(t){let e;for(e in t){const n=t[e];this._addSystem(n.value,n.name)}}_addSystem(t,e){const n=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=n,this._systemsHash[e]=n;for(const i in this.runners)this.runners[i].add(n);return this}_addPipes(t,e){const n=e.reduce((t,e)=>(t[e.name]=e.value,t),{});t.forEach(t=>{const e=t.value,i=t.name,r=n[i];this.renderPipes[i]=new e(this,r?new r:null)})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!cw())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Gw.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Hw,Vw,Xw=Gw;function Ww(t){return void 0!==Hw||(Hw=(()=>{var e;const n={stencil:!0,failIfMajorPerformanceCaveat:t??Xw.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Wb.get().getWebGLRenderingContext())return!1;let t=Wb.get().createCanvas().getContext("webgl",n);const i=!!(null==(e=null==t?void 0:t.getContextAttributes())?void 0:e.stencil);if(t){const e=t.getExtension("WEBGL_lose_context");e&&e.loseContext()}return t=null,i}catch(i){return!1}})()),Hw}async function jw(t={}){return void 0!==Vw||(Vw=await(async()=>{const e=Wb.get().getNavigator().gpu;if(!e)return!1;try{const n=await e.requestAdapter(t);return await n.requestDevice(),!0}catch(n){return!1}})()),Vw}const Yw=["webgl","webgpu","canvas"];async function qw(t){let e,n=[];t.preference?(n.push(t.preference),Yw.forEach(e=>{e!==t.preference&&n.push(e)})):n=Yw.slice();let i={};for(let s=0;s<n.length;s++){const r=n[s];if("webgpu"===r&&await jw()){const{WebGPURenderer:n}=await py(()=>Promise.resolve().then(()=>kL),void 0);e=n,i={...t,...t.webgpu};break}if("webgl"===r&&Ww(t.failIfMajorPerformanceCaveat??Xw.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:n}=await py(()=>Promise.resolve().then(()=>ZF),void 0);e=n,i={...t,...t.webgl};break}if("canvas"===r)throw i={...t},new Error("CanvasRenderer is not yet implemented")}if(delete i.webgpu,delete i.webgl,!e)throw new Error("No available renderer for the current environment");const r=new e;return await r.init(i),r}const Kw="8.11.0";class Jw{static init(){var t;null==(t=globalThis.__PIXI_APP_INIT__)||t.call(globalThis,this,Kw)}static destroy(){}}Jw.extension=fy.Application;class Zw{constructor(t){this._renderer=t}init(){var t;null==(t=globalThis.__PIXI_RENDERER_INIT__)||t.call(globalThis,this._renderer,Kw)}destroy(){this._renderer=null}}Zw.extension={type:[fy.WebGLSystem,fy.WebGPUSystem],name:"initHook",priority:-10};const Qw=class t{constructor(...t){this.stage=new Db,void 0!==t[0]&&qy(0,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await qw(e),t._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return qy(0,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,n=!1){const i=t._plugins.slice(0);i.reverse(),i.forEach(t=>{t.destroy.call(this)}),this.stage.destroy(n),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Qw._plugins=[];let $w=Qw;vy.handleByList(fy.Application,$w._plugins),vy.add(Jw);class tT{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this._cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:i}=this._resizeTo;t=n,e=i}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}tT.extension=fy.Application;class eT{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,qb.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Qb.shared:new Qb,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}eT.extension=fy.Application;class nT extends Ty{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return qy(0,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return qy(0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return qy(0,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return qy(0,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return qy(0,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners();for(const n in this.chars)null==(e=this.chars[n].texture)||e.destroy();this.chars=null,t&&(this.pages.forEach(t=>t.texture.destroy(!0)),this.pages=null)}}const iT=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function rT(t){const e="number"==typeof t.fontSize?`${t.fontSize}px`:t.fontSize;let n=t.fontFamily;Array.isArray(t.fontFamily)||(n=t.fontFamily.split(","));for(let i=n.length-1;i>=0;i--){let t=n[i].trim();/([\"\'])[^\'\"]+\1/.test(t)||iT.includes(t)||(t=`"${t}"`),n[i]=t}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${n.join(",")}`}const sT={willReadFrequently:!0},aT=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0===e){const n=Wb.get().getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in n||"textLetterSpacing"in n}return e}constructor(t,e,n,i,r,s,a,o,l){this.text=t,this.style=e,this.width=n,this.height=i,this.lines=r,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=l}static measureText(e=" ",n,i=t._canvas,r=n.wordWrap){var s;const a=rT(n),o=t.measureFont(a);0===o.fontSize&&(o.fontSize=n.fontSize,o.ascent=n.fontSize);const l=t.__context;l.font=a;const h=(r?t._wordWrap(e,n,i):e).split(/(?:\r\n|\r|\n)/),c=new Array(h.length);let u=0;for(let g=0;g<h.length;g++){const e=t._measureText(h[g],n.letterSpacing,l);c[g]=e,u=Math.max(u,e)}const d=(null==(s=n._stroke)?void 0:s.width)||0;let p=u+d;n.dropShadow&&(p+=n.dropShadow.distance);const f=n.lineHeight||o.fontSize;let m=Math.max(f,o.fontSize+d)+(h.length-1)*(f+n.leading);n.dropShadow&&(m+=n.dropShadow.distance);return new t(e,n,p,m,h,c,f+n.leading,u,o)}static _measureText(e,n,i){let r=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(i.letterSpacing=`${n}px`,i.textLetterSpacing=`${n}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const s=i.measureText(e);let a=s.width;const o=-s.actualBoundingBoxLeft;let l=s.actualBoundingBoxRight-o;if(a>0)if(r)a-=n,l-=n;else{const i=(t.graphemeSegmenter(e).length-1)*n;a+=i,l+=i}return Math.max(a,l)}static _wordWrap(e,n,i=t._canvas){const r=i.getContext("2d",sT);let s=0,a="",o="";const l=Object.create(null),{letterSpacing:h,whiteSpace:c}=n,u=t._collapseSpaces(c),d=t._collapseNewlines(c);let p=!u;const f=n.wordWrapWidth+h,m=t._tokenize(e);for(let g=0;g<m.length;g++){let e=m[g];if(t._isNewline(e)){if(!d){o+=t._addLine(a),p=!u,a="",s=0;continue}e=" "}if(u){const n=t.isBreakingSpace(e),i=t.isBreakingSpace(a[a.length-1]);if(n&&i)continue}const i=t._getFromCache(e,h,l,r);if(i>f)if(""!==a&&(o+=t._addLine(a),a="",s=0),t.canBreakWords(e,n.breakWords)){const i=t.wordWrapSplit(e);for(let c=0;c<i.length;c++){let u=i[c],d=u,m=1;for(;i[c+m];){const r=i[c+m];if(t.canBreakChars(d,r,e,c,n.breakWords))break;u+=r,d=r,m++}c+=m-1;const g=t._getFromCache(u,h,l,r);g+s>f&&(o+=t._addLine(a),p=!1,a="",s=0),a+=u,s+=g}}else{a.length>0&&(o+=t._addLine(a),a="",s=0);const n=g===m.length-1;o+=t._addLine(e,!n),p=!1,a="",s=0}else i+s>f&&(p=!1,o+=t._addLine(a),a="",s=0),(a.length>0||!t.isBreakingSpace(e)||p)&&(a+=e,s+=i)}return o+=t._addLine(a,!1),o}static _addLine(e,n=!0){return e=t._trimRight(e),e=n?`${e}\n`:e}static _getFromCache(e,n,i,r){let s=i[e];return"number"!=typeof s&&(s=t._measureText(e,n,r)+n,i[e]=s),s}static _collapseSpaces(t){return"normal"===t||"pre-line"===t}static _collapseNewlines(t){return"normal"===t}static _trimRight(e){if("string"!=typeof e)return"";for(let n=e.length-1;n>=0;n--){const i=e[n];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static _isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,n){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const n=[];let i="";if("string"!=typeof e)return n;for(let r=0;r<e.length;r++){const s=e[r],a=e[r+1];t.isBreakingSpace(s,a)||t._isNewline(s)?(""!==i&&(n.push(i),i=""),"\r"===s&&"\n"===a?(n.push("\r\n"),r++):n.push(s)):i+=s}return""!==i&&n.push(i),n}static canBreakWords(t,e){return e}static canBreakChars(t,e,n,i,r){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const n=t._context;n.font=e;const i=n.measureText(t.METRICS_STRING+t.BASELINE_SYMBOL),r={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return t._fonts[e]=r,r}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let n;try{const e=new OffscreenCanvas(0,0),i=e.getContext("2d",sT);if(null==i?void 0:i.measureText)return t.__canvas=e,e;n=Wb.get().createCanvas()}catch(e){n=Wb.get().createCanvas()}n.width=n.height=10,t.__canvas=n}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",sT)),t.__context}};aT.METRICS_STRING="|ÉqÅ",aT.BASELINE_SYMBOL="M",aT.BASELINE_MULTIPLIER=1.4,aT.HEIGHT_MULTIPLIER=2,aT.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const t=new Intl.Segmenter;return e=>{const n=t.segment(e),i=[];let r=0;for(const t of n)i[r++]=t.segment;return i}}return t=>[...t]})(),aT.experimentalLetterSpacing=!1,aT._fonts={},aT._newlines=[10,13],aT._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let oT=aT;const lT=[{offset:0,color:"white"},{offset:1,color:"black"}],hT=class t{constructor(...e){this.uid=Xy("fillGradient"),this.type="linear",this.colorStops=[];let n=function(t){let e=t[0]??{};("number"==typeof e||t[1])&&(qy(0,"use options object instead"),e={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??cT.defaultLinearOptions.textureSize});return e}(e);n={..."radial"===n.type?t.defaultRadialOptions:t.defaultLinearOptions,...Qy(n)},this._textureSize=n.textureSize,this._wrapMode=n.wrapMode,"radial"===n.type?(this.center=n.center,this.outerCenter=n.outerCenter??this.center,this.innerRadius=n.innerRadius,this.outerRadius=n.outerRadius,this.scale=n.scale,this.rotation=n.rotation):(this.start=n.start,this.end=n.end),this.textureSpace=n.textureSpace,this.type=n.type,n.colorStops.forEach(t=>{this.addColorStop(t.offset,t.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:zx.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:n,y:i}=this.end,r=n-t,s=i-e;const a=r<0||s<0;if("clamp-to-edge"===this._wrapMode){if(r<0){const e=t;t=n,n=e,r*=-1}if(s<0){const t=e;e=i,i=t,s*=-1}}const o=this.colorStops.length?this.colorStops:lT,l=this._textureSize,{canvas:h,context:c}=dT(l,1),u=a?c.createLinearGradient(this._textureSize,0,0,0):c.createLinearGradient(0,0,this._textureSize,0);uT(u,o),c.fillStyle=u,c.fillRect(0,0,l,1),this.texture=new ox({source:new Yb({resource:h,addressMode:this._wrapMode})});const d=Math.sqrt(r*r+s*s),p=Math.atan2(s,r),f=new Ry;f.scale(d/l,1),f.rotate(p),f.translate(t,e),"local"===this.textureSpace&&f.scale(l,l),this.transform=f}buildGradient(){"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:lT,e=this._textureSize,{canvas:n,context:i}=dT(e,e),{x:r,y:s}=this.center,{x:a,y:o}=this.outerCenter,l=this.innerRadius,h=this.outerRadius,c=a-h,u=o-h,d=e/(2*h),p=(r-c)*d,f=(s-u)*d,m=i.createRadialGradient(p,f,l*d,(a-c)*d,(o-u)*d,h*d);uT(m,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=m,i.translate(p,f),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-p,-f),i.fillRect(0,0,e,e),this.texture=new ox({source:new Yb({resource:n,addressMode:this._wrapMode})});const g=new Ry;g.scale(1/d,1/d),g.translate(c,u),"local"===this.textureSpace&&g.scale(e,e),this.transform=g}get styleKey(){return this.uid}destroy(){var t;null==(t=this.texture)||t.destroy(!0),this.texture=null}};hT.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"},hT.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let cT=hT;function uT(t,e){for(let n=0;n<e.length;n++){const i=e[n];t.addColorStop(i.offset,i.color)}}function dT(t,e){const n=Wb.get().createCanvas(t,e),i=n.getContext("2d");return{canvas:n,context:i}}const pT={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class fT{constructor(t,e){this.uid=Xy("fillPattern"),this.transform=new Ry,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=pT[e].addressModeU,t.source.style.addressModeV=pT[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._styleKey=null}get styleKey(){return this._styleKey||(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`),this._styleKey}}var mT=function(t){var e=[];return t.replace(vT,function(t,n,i){var r=n.toLowerCase();for(i=function(t){var e=t.match(yT);return e?e.map(Number):[]}(i),"m"==r&&i.length>2&&(e.push([n].concat(i.splice(0,2))),r="l",n="m"==n?"l":"L");;){if(i.length==gT[r])return i.unshift(n),e.push(i);if(i.length<gT[r])throw new Error("malformed path data");e.push([n].concat(i.splice(0,gT[r])))}}),e},gT={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},vT=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var yT=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;const xT=Sy(mT);function bT(t,e){const n=xT(t),i=[];let r=null,s=0,a=0;for(let o=0;o<n.length;o++){const t=n[o],l=t[0],h=t;switch(l){case"M":s=h[1],a=h[2],e.moveTo(s,a);break;case"m":s+=h[1],a+=h[2],e.moveTo(s,a);break;case"H":s=h[1],e.lineTo(s,a);break;case"h":s+=h[1],e.lineTo(s,a);break;case"V":a=h[1],e.lineTo(s,a);break;case"v":a+=h[1],e.lineTo(s,a);break;case"L":s=h[1],a=h[2],e.lineTo(s,a);break;case"l":s+=h[1],a+=h[2],e.lineTo(s,a);break;case"C":s=h[5],a=h[6],e.bezierCurveTo(h[1],h[2],h[3],h[4],s,a);break;case"c":e.bezierCurveTo(s+h[1],a+h[2],s+h[3],a+h[4],s+h[5],a+h[6]),s+=h[5],a+=h[6];break;case"S":s=h[3],a=h[4],e.bezierCurveToShort(h[1],h[2],s,a);break;case"s":e.bezierCurveToShort(s+h[1],a+h[2],s+h[3],a+h[4]),s+=h[3],a+=h[4];break;case"Q":s=h[3],a=h[4],e.quadraticCurveTo(h[1],h[2],s,a);break;case"q":e.quadraticCurveTo(s+h[1],a+h[2],s+h[3],a+h[4]),s+=h[3],a+=h[4];break;case"T":s=h[1],a=h[2],e.quadraticCurveToShort(s,a);break;case"t":s+=h[1],a+=h[2],e.quadraticCurveToShort(s,a);break;case"A":s=h[6],a=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],s,a);break;case"a":s+=h[6],a+=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],s,a);break;case"Z":case"z":e.closePath(),i.length>0&&(r=i.pop(),r?(s=r.startX,a=r.startY):(s=0,a=0)),r=null;break;default:Vx()}"Z"!==l&&"z"!==l&&null===r&&(r={startX:s,startY:a},i.push(r))}return e}class _T{constructor(t=0,e=0,n=0){this.type="circle",this.x=t,this.y=e,this.radius=n}clone(){return new _T(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const n=this.radius*this.radius;let i=this.x-t,r=this.y-e;return i*=i,r*=r,i+r<=n}strokeContains(t,e,n,i=.5){if(0===this.radius)return!1;const r=this.x-t,s=this.y-e,a=this.radius,o=(1-i)*n,l=Math.sqrt(r*r+s*s);return l<=a+o&&l>a-(n-o)}getBounds(t){return t||(t=new Hy),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=2*this.radius,t.height=2*this.radius,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class ST{constructor(t=0,e=0,n=0,i=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=n,this.halfHeight=i}clone(){return new ST(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let n=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return n*=n,i*=i,n+i<=1}strokeContains(t,e,n,i=.5){const{halfWidth:r,halfHeight:s}=this;if(r<=0||s<=0)return!1;const a=n*(1-i),o=n-a,l=r-o,h=s-o,c=r+a,u=s+a,d=t-this.x,p=e-this.y;return d*d/(l*l)+p*p/(h*h)>1&&d*d/(c*c)+p*p/(u*u)<=1}getBounds(t){return t||(t=new Hy),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=2*this.halfWidth,t.height=2*this.halfHeight,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function wT(t,e,n,i,r,s){const a=r-n,o=s-i,l=a*a+o*o;let h,c,u=-1;0!==l&&(u=((t-n)*a+(e-i)*o)/l),u<0?(h=n,c=i):u>1?(h=r,c=s):(h=n+u*a,c=i+u*o);const d=t-h,p=e-c;return d*d+p*p}class TT{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let n=0,i=e.length;n<i;n++)t.push(e[n].x,e[n].y);e=t}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,n=e.length;for(let i=0;i<n;i+=2){const r=e[i],s=e[i+1];t+=(e[(i+2)%n]-r)*(e[(i+3)%n]+s)}return t<0}containsPolygon(t){const e=this.getBounds(undefined),n=t.getBounds(undefined);if(!e.containsRect(n))return!1;const i=t.points;for(let r=0;r<i.length;r+=2){const t=i[r],e=i[r+1];if(!this.contains(t,e))return!1}return!0}clone(){const t=this.points.slice(),e=new TT(t);return e.closePath=this.closePath,e}contains(t,e){let n=!1;const i=this.points.length/2;for(let r=0,s=i-1;r<i;s=r++){const i=this.points[2*r],a=this.points[2*r+1],o=this.points[2*s],l=this.points[2*s+1];a>e!=l>e&&t<(e-a)/(l-a)*(o-i)+i&&(n=!n)}return n}strokeContains(t,e,n,i=.5){const r=n*n,s=r*(1-i),a=r-s,{points:o}=this,l=o.length-(this.closePath?0:2);for(let h=0;h<l;h+=2){const n=o[h],i=o[h+1],r=o[(h+2)%o.length],l=o[(h+3)%o.length];if(wT(t,e,n,i,r,l)<=(Math.sign((r-n)*(e-i)-(l-i)*(t-n))<0?a:s))return!0}return!1}getBounds(t){t||(t=new Hy);const e=this.points;let n=1/0,i=-1/0,r=1/0,s=-1/0;for(let a=0,o=e.length;a<o;a+=2){const t=e[a],o=e[a+1];n=t<n?t:n,i=t>i?t:i,r=o<r?o:r,s=o>s?o:s}return t.x=n,t.width=i-n,t.y=r,t.height=s-r,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return qy(0,"Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return qy(0,"Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const MT=(t,e,n,i,r,s,a)=>{const o=t-n,l=e-i,h=Math.sqrt(o*o+l*l);return h>=r-s&&h<=r+a};class AT{constructor(t=0,e=0,n=0,i=0,r=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=n,this.height=i,this.radius=r}getBounds(t){return t||(t=new Hy),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new AT(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+n&&e<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let i=t-(this.x+n),r=e-(this.y+n);const s=n*n;if(i*i+r*r<=s)return!0;if(i=t-(this.x+this.width-n),i*i+r*r<=s)return!0;if(r=e-(this.y+this.height-n),i*i+r*r<=s)return!0;if(i=t-(this.x+n),i*i+r*r<=s)return!0}return!1}strokeContains(t,e,n,i=.5){const{x:r,y:s,width:a,height:o,radius:l}=this,h=n*(1-i),c=n-h,u=r+l,d=s+l,p=r+a,f=s+o;return(t>=r-h&&t<=r+c||t>=p-c&&t<=p+h)&&e>=d&&e<=d+(o-2*l)||((e>=s-h&&e<=s+c||e>=f-c&&e<=f+h)&&t>=u&&t<=u+(a-2*l)||(t<u&&e<d&&MT(t,e,u,d,l,c,h)||t>p-l&&e<d&&MT(t,e,p-l,d,l,c,h)||t>p-l&&e>f-l&&MT(t,e,p-l,f-l,l,c,h)||t<u&&e>f-l&&MT(t,e,u,f-l,l,c,h)))}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const ET={};function CT(t,e,n){let i=2166136261;for(let r=0;r<e;r++)i^=t[r].uid,i=Math.imul(i,16777619),i>>>=0;return ET[i]||function(t,e,n,i){const r={};let s=0;for(let o=0;o<i;o++){const n=o<e?t[o]:ox.EMPTY.source;r[s++]=n.source,r[s++]=n.style}const a=new MS(r);return ET[n]=a,a}(t,e,i,n)}class PT{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function RT(t,e){const n=t.byteLength/8|0,i=new Float64Array(t,0,n);new Float64Array(e,0,n).set(i);const r=t.byteLength-8*n;if(r>0){const i=new Uint8Array(t,8*n,r);new Uint8Array(e,8*n,r).set(i)}}const IT={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var OT=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",t[t.NONE=5]="NONE",t))(OT||{});function DT(t,e){return"no-premultiply-alpha"===e.alphaMode&&IT[t]||t}const BT=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function FT(t){let e="";for(let n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+=`if(test == ${n}.0){}`);return e}function LT(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const n=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const i=BT.replace(/%forloop%/gi,FT(t));if(e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}}finally{e.deleteShader(n)}return t}let UT=null;function kT(){var t;if(UT)return UT;const e=J_();return UT=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),UT=LT(UT,e),null==(t=e.getExtension("WEBGL_lose_context"))||t.loseContext(),UT}class NT{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class zT{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new NT,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const GT=[];let HT=0;function VT(){return HT>0?GT[--HT]:new zT}function XT(t){GT[HT++]=t}let WT=0;const jT=class t{constructor(e){this.uid=Xy("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],(e={...t.defaultOptions,...e}).maxTextures||(qy(0,"maxTextures is a required option for Batcher now, please pass it in the options"),e.maxTextures=kT());const{maxTextures:n,attributesInitialSize:i,indicesInitialSize:r}=e;this.attributeBuffer=new PT(4*i),this.indexBuffer=new Uint16Array(r),this.maxTextures=n}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)XT(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const n=t._batch.textures.ids[e._source.uid];return!(!n&&0!==n)&&(t._textureId=n,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let n=VT(),i=n.textures;i.clear();const r=e[this.elementStart];let s=DT(r.blendMode,r.texture._source),a=r.topology;4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const o=this.attributeBuffer.float32View,l=this.attributeBuffer.uint32View,h=this.indexBuffer;let c=this._batchIndexSize,u=this._batchIndexStart,d="startBatch";const p=this.maxTextures;for(let f=this.elementStart;f<this.elementSize;++f){const r=e[f];e[f]=null;const m=r.texture._source,g=DT(r.blendMode,m),v=s!==g||a!==r.topology;m._batchTick!==WT||v?(m._batchTick=WT,(i.count>=p||v)&&(this._finishBatch(n,u,c-u,i,s,a,t,d),d="renderBatch",u=c,s=g,a=r.topology,n=VT(),i=n.textures,i.clear(),++WT),r._textureId=m._textureBindLocation=i.count,i.ids[m.uid]=i.count,i.textures[i.count++]=m,r._batch=n,c+=r.indexSize,r.packAsQuad?(this.packQuadAttributes(r,o,l,r._attributeStart,r._textureId),this.packQuadIndex(h,r._indexStart,r._attributeStart/this.vertexSize)):(this.packAttributes(r,o,l,r._attributeStart,r._textureId),this.packIndex(r,h,r._indexStart,r._attributeStart/this.vertexSize))):(r._textureId=m._textureBindLocation,c+=r.indexSize,r.packAsQuad?(this.packQuadAttributes(r,o,l,r._attributeStart,r._textureId),this.packQuadIndex(h,r._indexStart,r._attributeStart/this.vertexSize)):(this.packAttributes(r,o,l,r._attributeStart,r._textureId),this.packIndex(r,h,r._indexStart,r._attributeStart/this.vertexSize)),r._batch=n)}i.count>0&&(this._finishBatch(n,u,c-u,i,s,a,t,d),u=c,++WT),this.elementStart=this.elementSize,this._batchIndexStart=u,this._batchIndexSize=c}_finishBatch(t,e,n,i,r,s,a,o){t.gpuBindGroup=null,t.bindGroup=null,t.action=o,t.batcher=this,t.textures=i,t.blendMode=r,t.topology=s,t.start=e,t.size=n,++WT,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){4*t<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*t)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,2*this.attributeBuffer.size),n=new PT(e);RT(this.attributeBuffer.rawBinaryData,n.rawBinaryData),this.attributeBuffer=n}_resizeIndexBuffer(t){const e=this.indexBuffer;let n=Math.max(t,1.5*e.length);n+=n%2;const i=n>65535?new Uint32Array(n):new Uint16Array(n);if(i.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let r=0;r<e.length;r++)i[r]=e[r];else RT(e.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(t,e,n){t[e]=n+0,t[e+1]=n+1,t[e+2]=n+2,t[e+3]=n+0,t[e+4]=n+2,t[e+5]=n+3}packIndex(t,e,n,i){const r=t.indices,s=t.indexSize,a=t.indexOffset,o=t.attributeOffset;for(let l=0;l<s;l++)e[n++]=i+r[l+a]-o}destroy(){for(let t=0;t<this.batches.length;t++)XT(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};jT.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let YT=jT;var qT=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(qT||{});class KT extends Ty{constructor(t){let{data:e,size:n}=t;const{usage:i,label:r,shrinkToFit:s}=t;super(),this.uid=Xy("buffer"),this._resourceType="buffer",this._resourceId=Xy("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,n??(n=null==e?void 0:e.byteLength);const a=!!e;this.descriptor={size:n,usage:i,mappedAtCreation:a,label:r},this.shrinkToFit=s??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&qT.STATIC)}set static(t){t?this.descriptor.usage|=qT.STATIC:this.descriptor.usage&=~qT.STATIC}setDataWithSize(t,e,n){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t)return void(n&&this.emit("update",this));const i=this._data;this._data=t,this._dataInt32=null,i&&i.length===t.length||!this.shrinkToFit&&i&&t.byteLength<i.byteLength?n&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=Xy("resource"),this.emit("change",this))}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function JT(t,e){if(!(t instanceof KT)){let n=e?qT.INDEX:qT.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),n=qT.INDEX|qT.COPY_DST):(t=new Float32Array(t),n=qT.VERTEX|qT.COPY_DST)),t=new KT({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:n})}return t}function ZT(t,e,n){const i=t.getAttribute(e);if(!i)return n.minX=0,n.minY=0,n.maxX=0,n.maxY=0,n;const r=i.buffer.data;let s=1/0,a=1/0,o=-1/0,l=-1/0;const h=r.BYTES_PER_ELEMENT,c=(i.offset||0)/h,u=(i.stride||8)/h;for(let d=c;d<r.length;d+=u){const t=r[d],e=r[d+1];t>o&&(o=t),e>l&&(l=e),t<s&&(s=t),e<a&&(a=e)}return n.minX=s,n.minY=a,n.maxX=o,n.maxY=l,n}class QT extends Ty{constructor(t={}){super(),this.uid=Xy("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new cx,this._boundsDirty=!0;const{attributes:e,indexBuffer:n,topology:i}=t;if(this.buffers=[],this.attributes={},e)for(const r in e)this.addAttribute(r,e[r]);this.instanceCount=t.instanceCount??1,n&&this.addIndex(n),this.topology=i||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const n=function(t){return(t instanceof KT||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=JT(t.buffer,!1),t}(e);-1===this.buffers.indexOf(n.buffer)&&(this.buffers.push(n.buffer),n.buffer.on("update",this.onBufferUpdate,this),n.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=n}addIndex(t){this.indexBuffer=JT(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,ZT(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(t=>t.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const $T=new Float32Array(1),tM=new Uint32Array(1);class eM extends QT{constructor(){const t=new KT({data:$T,label:"attribute-batch-buffer",usage:qT.VERTEX|qT.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:24,offset:0},aUV:{buffer:t,format:"float32x2",stride:24,offset:8},aColor:{buffer:t,format:"unorm8x4",stride:24,offset:16},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:24,offset:20}},indexBuffer:new KT({data:tM,label:"index-batch-buffer",usage:qT.INDEX|qT.COPY_DST,shrinkToFit:!1})})}}function nM(t,e,n){if(t)for(const i in t){const r=e[i.toLocaleLowerCase()];if(r){let e=t[i];"header"===i&&(e=e.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),n&&r.push(`//----${n}----//`),r.push(e)}else Vx()}}const iM=/\{\{(.*?)\}\}/g;function rM(t){var e;const n={};return((null==(e=t.match(iM))?void 0:e.map(t=>t.replace(/[{()}]/g,"")))??[]).forEach(t=>{n[t]=[]}),n}function sM(t,e){let n;const i=/@in\s+([^;]+);/g;for(;null!==(n=i.exec(t));)e.push(n[1])}function aM(t,e,n=!1){const i=[];sM(e,i),t.forEach(t=>{t.header&&sM(t.header,i)});const r=i;n&&r.sort();const s=r.map((t,e)=>`       @location(${e}) ${t},`).join("\n");let a=e.replace(/@in\s+[^;]+;\s*/g,"");return a=a.replace("{{in}}",`\n${s}\n`),a}function oM(t,e){let n;const i=/@out\s+([^;]+);/g;for(;null!==(n=i.exec(t));)e.push(n[1])}function lM(t,e){const n=[];oM(e,n),t.forEach(t=>{t.header&&oM(t.header,n)});let i=0;const r=n.sort().map(t=>t.indexOf("builtin")>-1?t:`@location(${i++}) ${t}`).join(",\n"),s=n.sort().map(t=>{return`       var ${e=t,e.replace(/@.*?\s+/g,"")};`;var e}).join("\n"),a=`return VSOutput(\n            ${n.sort().map(t=>` ${function(t){const e=/\b(\w+)\s*:/g.exec(t);return e?e[1]:""}(t)}`).join(",\n")});`;let o=e.replace(/@out\s+[^;]+;\s*/g,"");return o=o.replace("{{struct}}",`\n${r}\n`),o=o.replace("{{start}}",`\n${s}\n`),o=o.replace("{{return}}",`\n${a}\n`),o}function hM(t,e){let n=t;for(const i in e){const t=e[i];n=t.join("\n").length?n.replace(`{{${i}}}`,`//-----${i} START-----//\n${t.join("\n")}\n//----${i} FINISH----//`):n.replace(`{{${i}}}`,"")}return n}const cM=Object.create(null),uM=new Map;let dM=0;function pM({template:t,bits:e}){const n=mM(t,e);if(cM[n])return cM[n];const{vertex:i,fragment:r}=function(t,e){const n=e.map(t=>t.vertex).filter(t=>!!t),i=e.map(t=>t.fragment).filter(t=>!!t);let r=aM(n,t.vertex,!0);r=lM(n,r);const s=aM(i,t.fragment,!0);return{vertex:r,fragment:s}}(t,e);return cM[n]=gM(i,r,e),cM[n]}function fM({template:t,bits:e}){const n=mM(t,e);return cM[n]||(cM[n]=gM(t.vertex,t.fragment,e)),cM[n]}function mM(t,e){return e.map(t=>(uM.has(t)||uM.set(t,dM++),uM.get(t))).sort((t,e)=>t-e).join("-")+t.vertex+t.fragment}function gM(t,e,n){const i=rM(t),r=rM(e);return n.forEach(t=>{nM(t.vertex,i,t.name),nM(t.fragment,r,t.name)}),{vertex:hM(t,i),fragment:hM(e,r)}}const vM="\n    @in aPosition: vec2<f32>;\n    @in aUV: vec2<f32>;\n\n    @out @builtin(position) vPosition: vec4<f32>;\n    @out vUV : vec2<f32>;\n    @out vColor : vec4<f32>;\n\n    {{header}}\n\n    struct VSOutput {\n        {{struct}}\n    };\n\n    @vertex\n    fn main( {{in}} ) -> VSOutput {\n\n        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;\n        var modelMatrix = mat3x3<f32>(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        var position = aPosition;\n        var uv = aUV;\n\n        {{start}}\n\n        vColor = vec4<f32>(1., 1., 1., 1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= globalUniforms.uWorldColorAlpha;\n\n        {{end}}\n\n        {{return}}\n    };\n",yM="\n    @in vUV : vec2<f32>;\n    @in vColor : vec4<f32>;\n\n    {{header}}\n\n    @fragment\n    fn main(\n        {{in}}\n      ) -> @location(0) vec4<f32> {\n\n        {{start}}\n\n        var outColor:vec4<f32>;\n\n        {{main}}\n\n        var finalColor:vec4<f32> = outColor * vColor;\n\n        {{end}}\n\n        return finalColor;\n      };\n",xM="\n    in vec2 aPosition;\n    in vec2 aUV;\n\n    out vec4 vColor;\n    out vec2 vUV;\n\n    {{header}}\n\n    void main(void){\n\n        mat3 worldTransformMatrix = uWorldTransformMatrix;\n        mat3 modelMatrix = mat3(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        vec2 position = aPosition;\n        vec2 uv = aUV;\n\n        {{start}}\n\n        vColor = vec4(1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= uWorldColorAlpha;\n\n        {{end}}\n    }\n",bM="\n\n    in vec4 vColor;\n    in vec2 vUV;\n\n    out vec4 finalColor;\n\n    {{header}}\n\n    void main(void) {\n\n        {{start}}\n\n        vec4 outColor;\n\n        {{main}}\n\n        finalColor = outColor * vColor;\n\n        {{end}}\n    }\n",_M={name:"global-uniforms-bit",vertex:{header:"\n        struct GlobalUniforms {\n            uProjectionMatrix:mat3x3<f32>,\n            uWorldTransformMatrix:mat3x3<f32>,\n            uWorldColorAlpha: vec4<f32>,\n            uResolution: vec2<f32>,\n        }\n\n        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\n        "}},SM={name:"global-uniforms-ubo-bit",vertex:{header:"\n          uniform globalUniforms {\n            mat3 uProjectionMatrix;\n            mat3 uWorldTransformMatrix;\n            vec4 uWorldColorAlpha;\n            vec2 uResolution;\n          };\n        "}},wM={name:"global-uniforms-bit",vertex:{header:"\n          uniform mat3 uProjectionMatrix;\n          uniform mat3 uWorldTransformMatrix;\n          uniform vec4 uWorldColorAlpha;\n          uniform vec2 uResolution;\n        "}};function TM({bits:t,name:e}){const n=pM({template:{fragment:yM,vertex:vM},bits:[_M,...t]});return xS.from({name:e,vertex:{source:n.vertex,entryPoint:"main"},fragment:{source:n.fragment,entryPoint:"main"}})}function MM({bits:t,name:e}){return new lS({name:e,...fM({template:{vertex:xM,fragment:bM},bits:[wM,...t]})})}const AM={name:"color-bit",vertex:{header:"\n            @in aColor: vec4<f32>;\n        ",main:"\n            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);\n        "}},EM={name:"color-bit",vertex:{header:"\n            in vec4 aColor;\n        ",main:"\n            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);\n        "}},CM={};function PM(t){const e=[];if(1===t)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let n=0;for(let i=0;i<t;i++)e.push(`@group(1) @binding(${n++}) var textureSource${i+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${n++}) var textureSampler${i+1}: sampler;`)}return e.join("\n")}function RM(t){const e=[];if(1===t)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let n=0;n<t;n++)n===t-1?e.push("  default:{"):e.push(`  case ${n}:{`),e.push(`      outColor = textureSampleGrad(textureSource${n+1}, textureSampler${n+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join("\n")}function IM(t){return CM[t]||(CM[t]={name:"texture-batch-bit",vertex:{header:"\n                @in aTextureIdAndRound: vec2<u32>;\n                @out @interpolate(flat) vTextureId : u32;\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1)\n                {\n                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n                }\n            "},fragment:{header:`\n                @in @interpolate(flat) vTextureId: u32;\n\n                ${PM(t)}\n            `,main:`\n                var uvDx = dpdx(vUV);\n                var uvDy = dpdy(vUV);\n\n                ${RM(t)}\n            `}}),CM[t]}const OM={};function DM(t){const e=[];for(let n=0;n<t;n++)n>0&&e.push("else"),n<t-1&&e.push(`if(vTextureId < ${n}.5)`),e.push("{"),e.push(`\toutColor = texture(uTextures[${n}], vUV);`),e.push("}");return e.join("\n")}function BM(t){return OM[t]||(OM[t]={name:"texture-batch-bit",vertex:{header:"\n                in vec2 aTextureIdAndRound;\n                out float vTextureId;\n\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1.)\n                {\n                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n                }\n            "},fragment:{header:`\n                in float vTextureId;\n\n                uniform sampler2D uTextures[${t}];\n\n            `,main:`\n\n                ${DM(t)}\n            `}}),OM[t]}const FM={name:"round-pixels-bit",vertex:{header:"\n            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>\n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},LM={name:"round-pixels-bit",vertex:{header:"\n            vec2 roundPixels(vec2 position, vec2 targetSize)\n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},UM={};function kM(t){let e=UM[t];if(e)return e;const n=new Int32Array(t);for(let i=0;i<t;i++)n[i]=i;return e=UM[t]=new TS({uTextures:{value:n,type:"i32",size:t}},{isStatic:!0}),e}class NM extends ES{constructor(t){super({glProgram:MM({name:"batch",bits:[EM,BM(t),LM]}),gpuProgram:TM({name:"batch",bits:[AM,IM(t),FM]}),resources:{batchSamplers:kM(t)}})}}let zM=null;const GM=class t extends YT{constructor(e){super(e),this.geometry=new eM,this.name=t.extension.name,this.vertexSize=6,zM??(zM=new NM(e.maxTextures)),this.shader=zM}packAttributes(t,e,n,i,r){const s=r<<16|65535&t.roundPixels,a=t.transform,o=a.a,l=a.b,h=a.c,c=a.d,u=a.tx,d=a.ty,{positions:p,uvs:f}=t,m=t.color,g=t.attributeOffset,v=g+t.attributeSize;for(let y=g;y<v;y++){const t=2*y,r=p[t],a=p[t+1];e[i++]=o*r+h*a+u,e[i++]=c*a+l*r+d,e[i++]=f[t],e[i++]=f[t+1],n[i++]=m,n[i++]=s}}packQuadAttributes(t,e,n,i,r){const s=t.texture,a=t.transform,o=a.a,l=a.b,h=a.c,c=a.d,u=a.tx,d=a.ty,p=t.bounds,f=p.maxX,m=p.minX,g=p.maxY,v=p.minY,y=s.uvs,x=t.color,b=r<<16|65535&t.roundPixels;e[i+0]=o*m+h*v+u,e[i+1]=c*v+l*m+d,e[i+2]=y.x0,e[i+3]=y.y0,n[i+4]=x,n[i+5]=b,e[i+6]=o*f+h*v+u,e[i+7]=c*v+l*f+d,e[i+8]=y.x1,e[i+9]=y.y1,n[i+10]=x,n[i+11]=b,e[i+12]=o*f+h*g+u,e[i+13]=c*g+l*f+d,e[i+14]=y.x2,e[i+15]=y.y2,n[i+16]=x,n[i+17]=b,e[i+18]=o*m+h*g+u,e[i+19]=c*g+l*m+d,e[i+20]=y.x3,e[i+21]=y.y3,n[i+22]=x,n[i+23]=b}};GM.extension={type:[fy.Batcher],name:"default"};let HM=GM;function VM(t,e,n,i,r,s,a,o=null){let l=0;n*=e,r*=s;const h=o.a,c=o.b,u=o.c,d=o.d,p=o.tx,f=o.ty;for(;l<a;){const a=t[n],o=t[n+1];i[r]=h*a+u*o+p,i[r+1]=c*a+d*o+f,r+=s,n+=e,l++}}function XM(t,e,n,i){let r=0;for(e*=n;r<i;)t[e]=0,t[e+1]=0,e+=n,r++}function WM(t,e,n,i,r){const s=e.a,a=e.b,o=e.c,l=e.d,h=e.tx,c=e.ty;n||(n=0),i||(i=2),r||(r=t.length/i-n);let u=n*i;for(let d=0;d<r;d++){const e=t[u],n=t[u+1];t[u]=s*e+o*n+h,t[u+1]=a*e+l*n+c,u+=i}}const jM=new Ry;class YM{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|65280&t|(255&t)<<16,n=this.renderable;return n?hb(e,n.groupColor)+(this.alpha*n.groupAlpha*255<<24):e+(255*this.alpha<<24)}get transform(){var t;return(null==(t=this.renderable)?void 0:t.groupTransform)||jM}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const qM={extension:{type:fy.ShapeBuilder,name:"circle"},build(t,e){let n,i,r,s,a,o;if("circle"===t.type){const e=t;if(a=o=e.radius,a<=0)return!1;n=e.x,i=e.y,r=s=0}else if("ellipse"===t.type){const e=t;if(a=e.halfWidth,o=e.halfHeight,a<=0||o<=0)return!1;n=e.x,i=e.y,r=s=0}else{const e=t,l=e.width/2,h=e.height/2;n=e.x+l,i=e.y+h,a=o=Math.max(0,Math.min(e.radius,Math.min(l,h))),r=l-a,s=h-o}if(r<0||s<0)return!1;const l=Math.ceil(2.3*Math.sqrt(a+o)),h=8*l+(r?4:0)+(s?4:0);if(0===h)return!1;if(0===l)return e[0]=e[6]=n+r,e[1]=e[3]=i+s,e[2]=e[4]=n-r,e[5]=e[7]=i-s,!0;let c=0,u=4*l+(r?2:0)+2,d=u,p=h,f=r+a,m=s,g=n+f,v=n-f,y=i+m;if(e[c++]=g,e[c++]=y,e[--u]=y,e[--u]=v,s){const t=i-m;e[d++]=v,e[d++]=t,e[--p]=t,e[--p]=g}for(let b=1;b<l;b++){const t=Math.PI/2*(b/l),h=r+Math.cos(t)*a,f=s+Math.sin(t)*o,m=n+h,g=n-h,v=i+f,y=i-f;e[c++]=m,e[c++]=v,e[--u]=v,e[--u]=g,e[d++]=g,e[d++]=y,e[--p]=y,e[--p]=m}f=r,m=s+o,g=n+f,v=n-f,y=i+m;const x=i-m;return e[c++]=g,e[c++]=y,e[--p]=x,e[--p]=g,r&&(e[c++]=v,e[c++]=y,e[--p]=x,e[--p]=v),!0},triangulate(t,e,n,i,r,s){if(0===t.length)return;let a=0,o=0;for(let c=0;c<t.length;c+=2)a+=t[c],o+=t[c+1];a/=t.length/2,o/=t.length/2;let l=i;e[l*n]=a,e[l*n+1]=o;const h=l++;for(let c=0;c<t.length;c+=2)e[l*n]=t[c],e[l*n+1]=t[c+1],c>0&&(r[s++]=l,r[s++]=h,r[s++]=l-1),l++;r[s++]=h+1,r[s++]=h,r[s++]=l-1}},KM={...qM,extension:{...qM.extension,name:"ellipse"}},JM={...qM,extension:{...qM.extension,name:"roundedRectangle"}},ZM=1e-4,QM=1e-4;function $M(t){const e=t.length;if(e<6)return 1;let n=0;for(let i=0,r=t[e-2],s=t[e-1];i<e;i+=2){const e=t[i],a=t[i+1];n+=(e-r)*(a+s),r=e,s=a}return n<0?-1:1}function tA(t,e,n,i,r,s,a,o){let l,h;a?(l=i,h=-n):(l=-i,h=n);const c=t-n*r+l,u=e-i*r+h,d=t+n*s+l,p=e+i*s+h;return o.push(c,u),o.push(d,p),2}function eA(t,e,n,i,r,s,a,o){const l=n-t,h=i-e;let c=Math.atan2(l,h),u=Math.atan2(r-t,s-e);o&&c<u?c+=2*Math.PI:!o&&c>u&&(u+=2*Math.PI);let d=c;const p=u-c,f=Math.abs(p),m=Math.sqrt(l*l+h*h),g=1+(15*f*Math.sqrt(m)/Math.PI|0),v=p/g;if(d+=v,o){a.push(t,e),a.push(n,i);for(let n=1,i=d;n<g;n++,i+=v)a.push(t,e),a.push(t+Math.sin(i)*m,e+Math.cos(i)*m);a.push(t,e),a.push(r,s)}else{a.push(n,i),a.push(t,e);for(let n=1,i=d;n<g;n++,i+=v)a.push(t+Math.sin(i)*m,e+Math.cos(i)*m),a.push(t,e);a.push(r,s),a.push(t,e)}return 2*g}function nA(t,e,n,i,r,s){const a=ZM;if(0===t.length)return;const o=e;let l=o.alignment;if(.5!==e.alignment){let e=$M(t);n&&(e*=-1),l=(l-.5)*e+.5}const h=new Cy(t[0],t[1]),c=new Cy(t[t.length-2],t[t.length-1]),u=i,d=Math.abs(h.x-c.x)<a&&Math.abs(h.y-c.y)<a;if(u){t=t.slice(),d&&(t.pop(),t.pop(),c.set(t[t.length-2],t[t.length-1]));const e=.5*(h.x+c.x),n=.5*(c.y+h.y);t.unshift(e,n),t.push(e,n)}const p=r,f=t.length/2;let m=t.length;const g=p.length/2,v=o.width/2,y=v*v,x=o.miterLimit*o.miterLimit;let b=t[0],_=t[1],S=t[2],w=t[3],T=0,M=0,A=-(_-w),E=b-S,C=0,P=0,R=Math.sqrt(A*A+E*E);A/=R,E/=R,A*=v,E*=v;const I=2*(1-l),O=2*l;u||("round"===o.cap?m+=eA(b-A*(I-O)*.5,_-E*(I-O)*.5,b-A*I,_-E*I,b+A*O,_+E*O,p,!0)+2:"square"===o.cap&&(m+=tA(b,_,A,E,I,O,!0,p))),p.push(b-A*I,_-E*I),p.push(b+A*O,_+E*O);for(let D=1;D<f-1;++D){b=t[2*(D-1)],_=t[2*(D-1)+1],S=t[2*D],w=t[2*D+1],T=t[2*(D+1)],M=t[2*(D+1)+1],A=-(_-w),E=b-S,R=Math.sqrt(A*A+E*E),A/=R,E/=R,A*=v,E*=v,C=-(w-M),P=S-T,R=Math.sqrt(C*C+P*P),C/=R,P/=R,C*=v,P*=v;const e=S-b,n=_-w,i=S-T,r=M-w,s=e*i+n*r,a=n*i-r*e,l=a<0;if(Math.abs(a)<.001*Math.abs(s)){p.push(S-A*I,w-E*I),p.push(S+A*O,w+E*O),s>=0&&("round"===o.join?m+=eA(S,w,S-A*I,w-E*I,S-C*I,w-P*I,p,!1)+4:m+=2,p.push(S-C*O,w-P*O),p.push(S+C*I,w+P*I));continue}const h=(-A+b)*(-E+w)-(-A+S)*(-E+_),c=(-C+T)*(-P+w)-(-C+S)*(-P+M),u=(e*c-i*h)/a,d=(r*h-n*c)/a,f=(u-S)*(u-S)+(d-w)*(d-w),g=S+(u-S)*I,B=w+(d-w)*I,F=S-(u-S)*O,L=w-(d-w)*O,U=l?I:O;f<=Math.min(e*e+n*n,i*i+r*r)+U*U*y?"bevel"===o.join||f/y>x?(l?(p.push(g,B),p.push(S+A*O,w+E*O),p.push(g,B),p.push(S+C*O,w+P*O)):(p.push(S-A*I,w-E*I),p.push(F,L),p.push(S-C*I,w-P*I),p.push(F,L)),m+=2):"round"===o.join?l?(p.push(g,B),p.push(S+A*O,w+E*O),m+=eA(S,w,S+A*O,w+E*O,S+C*O,w+P*O,p,!0)+4,p.push(g,B),p.push(S+C*O,w+P*O)):(p.push(S-A*I,w-E*I),p.push(F,L),m+=eA(S,w,S-A*I,w-E*I,S-C*I,w-P*I,p,!1)+4,p.push(S-C*I,w-P*I),p.push(F,L)):(p.push(g,B),p.push(F,L)):(p.push(S-A*I,w-E*I),p.push(S+A*O,w+E*O),"round"===o.join?m+=l?eA(S,w,S+A*O,w+E*O,S+C*O,w+P*O,p,!0)+2:eA(S,w,S-A*I,w-E*I,S-C*I,w-P*I,p,!1)+2:"miter"===o.join&&f/y<=x&&(l?(p.push(F,L),p.push(F,L)):(p.push(g,B),p.push(g,B)),m+=2),p.push(S-C*I,w-P*I),p.push(S+C*O,w+P*O),m+=2)}b=t[2*(f-2)],_=t[2*(f-2)+1],S=t[2*(f-1)],w=t[2*(f-1)+1],A=-(_-w),E=b-S,R=Math.sqrt(A*A+E*E),A/=R,E/=R,A*=v,E*=v,p.push(S-A*I,w-E*I),p.push(S+A*O,w+E*O),u||("round"===o.cap?m+=eA(S-A*(I-O)*.5,w-E*(I-O)*.5,S-A*I,w-E*I,S+A*O,w+E*O,p,!1)+2:"square"===o.cap&&(m+=tA(S,w,A,E,I,O,!1,p)));for(let D=g;D<m+g-2;++D)b=p[2*D],_=p[2*D+1],S=p[2*(D+1)],w=p[2*(D+1)+1],T=p[2*(D+2)],M=p[2*(D+2)+1],Math.abs(b*(w-M)+S*(M-_)+T*(_-w))<1e-8||s.push(D,D+1,D+2)}function iA(t,e,n,i){const r=ZM;if(0===t.length)return;const s=t[0],a=t[1],o=t[t.length-2],l=t[t.length-1],h=e||Math.abs(s-o)<r&&Math.abs(a-l)<r,c=n,u=t.length/2,d=c.length/2;for(let p=0;p<u;p++)c.push(t[2*p]),c.push(t[2*p+1]);for(let p=0;p<u-1;p++)i.push(d+p,d+p+1);h&&i.push(d+u-1,d)}function rA(t,e,n,i,r,s,a){const o=Uw(t,e,2);if(!o)return;for(let h=0;h<o.length;h+=3)s[a++]=o[h]+r,s[a++]=o[h+1]+r,s[a++]=o[h+2]+r;let l=r*i;for(let h=0;h<t.length;h+=2)n[l]=t[h],n[l+1]=t[h+1],l+=i}const sA=[],aA={extension:{type:fy.ShapeBuilder,name:"polygon"},build(t,e){for(let n=0;n<t.points.length;n++)e[n]=t.points[n];return!0},triangulate(t,e,n,i,r,s){rA(t,sA,e,n,i,r,s)}},oA={extension:{type:fy.ShapeBuilder,name:"rectangle"},build(t,e){const n=t,i=n.x,r=n.y,s=n.width,a=n.height;return s>0&&a>0&&(e[0]=i,e[1]=r,e[2]=i+s,e[3]=r,e[4]=i+s,e[5]=r+a,e[6]=i,e[7]=r+a,!0)},triangulate(t,e,n,i,r,s){let a=0;e[(i*=n)+a]=t[0],e[i+a+1]=t[1],a+=n,e[i+a]=t[2],e[i+a+1]=t[3],a+=n,e[i+a]=t[6],e[i+a+1]=t[7],a+=n,e[i+a]=t[4],e[i+a+1]=t[5],a+=n;const o=i/n;r[s++]=o,r[s++]=o+1,r[s++]=o+2,r[s++]=o+1,r[s++]=o+3,r[s++]=o+2}},lA={extension:{type:fy.ShapeBuilder,name:"triangle"},build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,!0),triangulate(t,e,n,i,r,s){let a=0;e[(i*=n)+a]=t[0],e[i+a+1]=t[1],a+=n,e[i+a]=t[2],e[i+a+1]=t[3],a+=n,e[i+a]=t[4],e[i+a+1]=t[5];const o=i/n;r[s++]=o,r[s++]=o+1,r[s++]=o+2}},hA=new Ry,cA=new Hy;function uA(t,e,n,i){const r=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if("local"===e.textureSpace){const t=n.getBounds(cA);e.width&&t.pad(e.width);const{x:i,y:s}=t,a=1/t.width,o=1/t.height,l=-i*a,h=-s*o,c=r.a,u=r.b,d=r.c,p=r.d;r.a*=a,r.b*=a,r.c*=o,r.d*=o,r.tx=l*c+h*d+r.tx,r.ty=l*u+h*p+r.ty}else r.translate(e.texture.frame.x,e.texture.frame.y),r.scale(1/e.texture.source.width,1/e.texture.source.height);const s=e.texture.source.style;return e.fill instanceof cT||"clamp-to-edge"!==s.addressMode||(s.addressMode="repeat",s.update()),i&&r.append(hA.copyFrom(i).invert()),r}const dA={};vy.handleByMap(fy.ShapeBuilder,dA),vy.add(oA,aA,lA,qM,KM,JM);const pA=new Hy,fA=new Ry;function mA(t,e){const{geometryData:n,batches:i}=e;i.length=0,n.indices.length=0,n.vertices.length=0,n.uvs.length=0;for(let r=0;r<t.instructions.length;r++){const e=t.instructions[r];if("texture"===e.action)gA(e.data,i,n);else if("fill"===e.action||"stroke"===e.action){const t="stroke"===e.action,r=e.data.path.shapePath,s=e.data.style,a=e.data.hole;t&&a&&vA(a.shapePath,s,!0,i,n),a&&(r.shapePrimitives[r.shapePrimitives.length-1].holes=a.shapePath.shapePrimitives),vA(r,s,t,i,n)}}}function gA(t,e,n){const i=[],r=dA.rectangle,s=pA;s.x=t.dx,s.y=t.dy,s.width=t.dw,s.height=t.dh;const a=t.transform;if(!r.build(s,i))return;const{vertices:o,uvs:l,indices:h}=n,c=h.length,u=o.length/2;a&&WM(i,a),r.triangulate(i,o,2,u,h,c);const d=t.image,p=d.uvs;l.push(p.x0,p.y0,p.x1,p.y1,p.x3,p.y3,p.x2,p.y2);const f=jx.get(YM);f.indexOffset=c,f.indexSize=h.length-c,f.attributeOffset=u,f.attributeSize=o.length/2-u,f.baseColor=t.style,f.alpha=t.alpha,f.texture=d,f.geometryData=n,e.push(f)}function vA(t,e,n,i,r){const{vertices:s,uvs:a,indices:o}=r;t.shapePrimitives.forEach(({shape:t,transform:l,holes:h})=>{const c=[],u=dA[t.type];if(!u.build(t,c))return;const d=o.length,p=s.length/2;let f="triangle-list";if(l&&WM(c,l),n){const n=t.closePath??!0,i=e;i.pixelLine?(iA(c,n,s,o),f="line-list"):nA(c,i,!1,n,s,o)}else if(h){const t=[],e=c.slice();(function(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n].shape,r=[];dA[i.type].build(i,r)&&e.push(r)}return e})(h).forEach(n=>{t.push(e.length/2),e.push(...n)}),rA(e,t,s,2,p,o,d)}else u.triangulate(c,s,2,p,o,d);const m=a.length/2,g=e.texture;if(g!==ox.WHITE){const n=uA(fA,e,t,l);VM(s,2,p,a,m,2,s.length/2-p,n)}else XM(a,m,2,s.length/2-p);const v=jx.get(YM);v.indexOffset=d,v.indexSize=o.length-d,v.attributeOffset=p,v.attributeSize=s.length/2-p,v.baseColor=e.color,v.alpha=e.alpha,v.texture=g,v.geometryData=r,v.topology=f,i.push(v)})}class yA{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class xA{constructor(){this.instructions=new wb}init(t){this.batcher=new HM({maxTextures:t}),this.instructions.reset()}get geometry(){return qy(0,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const bA=class t{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){t.defaultOptions.bezierSmoothness=(null==e?void 0:e.bezierSmoothness)??t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),mA(t,e);const n=t.batchMode;t.customShader||"no-batch"===n?e.isBatchable=!1:e.isBatchable="auto"!==n||e.geometryData.vertices.length<400,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=jx.get(xA,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:n,geometryData:i}=this._gpuContextHash[t.uid],r=i.vertices.length,s=i.indices.length;for(let h=0;h<n.length;h++)n[h].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(r),a.ensureIndexBuffer(s),a.begin();for(let h=0;h<n.length;h++){const t=n[h];a.add(t)}a.finish(e.instructions);const o=a.geometry;o.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),o.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const l=a.batches;for(let h=0;h<l.length;h++){const t=l[h];t.bindGroup=CT(t.textures.textures,t.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new yA;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(jx.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(t=>{jx.return(t)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};bA.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"graphicsContext"},bA.defaultOptions={bezierSmoothness:.5};let _A=bA;const SA=1.1920929e-7;function wA(t,e,n,i,r,s,a,o,l,h){let c=(1-Math.min(.99,Math.max(0,h??_A.defaultOptions.bezierSmoothness)))/1;return c*=c,function(t,e,n,i,r,s,a,o,l,h){TA(t,e,n,i,r,s,a,o,l,h,0),l.push(a,o)}(e,n,i,r,s,a,o,l,t,c),t}function TA(t,e,n,i,r,s,a,o,l,h,c){if(c>8)return;const u=(t+n)/2,d=(e+i)/2,p=(n+r)/2,f=(i+s)/2,m=(r+a)/2,g=(s+o)/2,v=(u+p)/2,y=(d+f)/2,x=(p+m)/2,b=(f+g)/2,_=(v+x)/2,S=(y+b)/2;if(c>0){let c=a-t,u=o-e;const d=Math.abs((n-a)*u-(i-o)*c),p=Math.abs((r-a)*u-(s-o)*c);if(d>SA&&p>SA){if((d+p)*(d+p)<=h*(c*c+u*u))return void l.push(_,S)}else if(d>SA){if(d*d<=h*(c*c+u*u))return void l.push(_,S)}else if(p>SA){if(p*p<=h*(c*c+u*u))return void l.push(_,S)}else if(c=_-(t+a)/2,u=S-(e+o)/2,c*c+u*u<=h)return void l.push(_,S)}TA(t,e,u,d,v,y,_,S,l,h,c+1),TA(_,S,x,b,m,g,a,o,l,h,c+1)}function MA(t,e,n,i,r,s,a,o){let l=(1-Math.min(.99,Math.max(0,o??_A.defaultOptions.bezierSmoothness)))/1;return l*=l,function(t,e,n,i,r,s,a,o){AA(a,t,e,n,i,r,s,o,0),a.push(r,s)}(e,n,i,r,s,a,t,l),t}function AA(t,e,n,i,r,s,a,o,l){if(l>8)return;const h=(e+i)/2,c=(n+r)/2,u=(i+s)/2,d=(r+a)/2,p=(h+u)/2,f=(c+d)/2;let m=s-e,g=a-n;const v=Math.abs((i-s)*g-(r-a)*m);if(v>1.1920929e-7){if(v*v<=o*(m*m+g*g))return void t.push(p,f)}else if(m=p-(e+s)/2,g=f-(n+a)/2,m*m+g*g<=o)return void t.push(p,f);AA(t,e,n,h,c,p,f,o,l+1),AA(t,p,f,u,d,s,a,o,l+1)}function EA(t,e,n,i,r,s,a,o){let l=Math.abs(r-s);(!a&&r>s||a&&s>r)&&(l=2*Math.PI-l),o||(o=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(l/Math.PI))));let h=l/(o=Math.max(o,3)),c=r;h*=a?-1:1;for(let u=0;u<o+1;u++){const r=e+Math.cos(c)*i,s=n+Math.sin(c)*i;t.push(r,s),c+=h}}function CA(t,e,n,i,r,s){const a=t[t.length-2],o=t[t.length-1]-n,l=a-e,h=r-n,c=i-e,u=Math.abs(o*c-l*h);if(u<1e-8||0===s)return void(t[t.length-2]===e&&t[t.length-1]===n||t.push(e,n));const d=o*o+l*l,p=h*h+c*c,f=o*h+l*c,m=s*Math.sqrt(d)/u,g=s*Math.sqrt(p)/u,v=m*f/d,y=g*f/p,x=m*c+g*l,b=m*h+g*o,_=l*(g+v),S=o*(g+v),w=c*(m+y),T=h*(m+y);EA(t,x+e,b+n,s,Math.atan2(S-b,_-x),Math.atan2(T-b,w-x),l*h>c*o)}const PA=2*Math.PI,RA={centerX:0,centerY:0,ang1:0,ang2:0},IA=({x:t,y:e},n,i,r,s,a,o,l)=>{const h=r*(t*=n)-s*(e*=i),c=s*t+r*e;return l.x=h+a,l.y=c+o,l};function OA(t,e){const n=-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),i=1.5707963267948966===e?.551915024494:n,r=Math.cos(t),s=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[{x:r-s*i,y:s+r*i},{x:a+o*i,y:o-a*i},{x:a,y:o}]}const DA=(t,e,n,i)=>{let r=t*n+e*i;return r>1&&(r=1),r<-1&&(r=-1),(t*i-e*n<0?-1:1)*Math.acos(r)};function BA(t,e,n,i,r,s,a,o=0,l=0,h=0){if(0===s||0===a)return;const c=Math.sin(o*PA/360),u=Math.cos(o*PA/360),d=u*(e-i)/2+c*(n-r)/2,p=-c*(e-i)/2+u*(n-r)/2;if(0===d&&0===p)return;s=Math.abs(s),a=Math.abs(a);const f=Math.pow(d,2)/Math.pow(s,2)+Math.pow(p,2)/Math.pow(a,2);f>1&&(s*=Math.sqrt(f),a*=Math.sqrt(f)),((t,e,n,i,r,s,a,o,l,h,c,u,d)=>{const p=Math.pow(r,2),f=Math.pow(s,2),m=Math.pow(c,2),g=Math.pow(u,2);let v=p*f-p*g-f*m;v<0&&(v=0),v/=p*g+f*m,v=Math.sqrt(v)*(a===o?-1:1);const y=v*r/s*u,x=v*-s/r*c,b=h*y-l*x+(t+n)/2,_=l*y+h*x+(e+i)/2,S=(c-y)/r,w=(u-x)/s,T=(-c-y)/r,M=(-u-x)/s,A=DA(1,0,S,w);let E=DA(S,w,T,M);0===o&&E>0&&(E-=PA),1===o&&E<0&&(E+=PA),d.centerX=b,d.centerY=_,d.ang1=A,d.ang2=E})(e,n,i,r,s,a,l,h,c,u,d,p,RA);let{ang1:m,ang2:g}=RA;const{centerX:v,centerY:y}=RA;let x=Math.abs(g)/(PA/4);Math.abs(1-x)<1e-7&&(x=1);const b=Math.max(Math.ceil(x),1);g/=b;let _=t[t.length-2],S=t[t.length-1];const w={x:0,y:0};for(let T=0;T<b;T++){const e=OA(m,g),{x:n,y:i}=IA(e[0],s,a,u,c,v,y,w),{x:r,y:o}=IA(e[1],s,a,u,c,v,y,w),{x:l,y:h}=IA(e[2],s,a,u,c,v,y,w);wA(t,_,S,n,i,r,o,l,h),_=l,S=h,m+=g}}function FA(t,e,n){const i=(t,e)=>{const n=e.x-t.x,i=e.y-t.y,r=Math.sqrt(n*n+i*i);return{len:r,nx:n/r,ny:i/r}},r=(e,n)=>{0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y)};let s=e[e.length-1];for(let a=0;a<e.length;a++){const o=e[a%e.length],l=o.radius??n;if(l<=0){r(a,o),s=o;continue}const h=e[(a+1)%e.length],c=i(o,s),u=i(o,h);if(c.len<1e-4||u.len<1e-4){r(a,o),s=o;continue}let d=Math.asin(c.nx*u.ny-c.ny*u.nx),p=1,f=!1;c.nx*u.nx-c.ny*-u.ny<0?d<0?d=Math.PI+d:(d=Math.PI-d,p=-1,f=!0):d>0&&(p=-1,f=!0);const m=d/2;let g,v=Math.abs(Math.cos(m)*l/Math.sin(m));v>Math.min(c.len/2,u.len/2)?(v=Math.min(c.len/2,u.len/2),g=Math.abs(v*Math.sin(m)/Math.cos(m))):g=l;const y=o.x+u.nx*v+-u.ny*g*p,x=o.y+u.ny*v+u.nx*g*p,b=Math.atan2(c.ny,c.nx)+Math.PI/2*p,_=Math.atan2(u.ny,u.nx)-Math.PI/2*p;0===a&&t.moveTo(y+Math.cos(b)*g,x+Math.sin(b)*g),t.arc(y,x,g,b,_,f),s=o}}function LA(t,e,n,i){const r=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),s=(t,e,n)=>({x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}),a=e.length;for(let o=0;o<a;o++){const l=e[(o+1)%a],h=l.radius??n;if(h<=0){0===o?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y);continue}const c=e[o],u=e[(o+2)%a],d=r(c,l);let p;if(d<1e-4)p=l;else{p=s(l,c,Math.min(d/2,h)/d)}const f=r(u,l);let m;if(f<1e-4)m=l;else{m=s(l,u,Math.min(f/2,h)/f)}0===o?t.moveTo(p.x,p.y):t.lineTo(p.x,p.y),t.quadraticCurveTo(l.x,l.y,m.x,m.y,i)}}const UA=new Hy;class kA{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new cx,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const n=this._currentPoly.points,i=n[n.length-2],r=n[n.length-1];return i===t&&r===e||n.push(t,e),this}arc(t,e,n,i,r,s){this._ensurePoly(!1);return EA(this._currentPoly.points,t,e,n,i,r,s),this}arcTo(t,e,n,i,r){this._ensurePoly();return CA(this._currentPoly.points,t,e,n,i,r),this}arcToSvg(t,e,n,i,r,s,a){return BA(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,s,a,t,e,n,i,r),this}bezierCurveTo(t,e,n,i,r,s,a){this._ensurePoly();const o=this._currentPoly;return wA(this._currentPoly.points,o.lastX,o.lastY,t,e,n,i,r,s,a),this}quadraticCurveTo(t,e,n,i,r){this._ensurePoly();const s=this._currentPoly;return MA(this._currentPoly.points,s.lastX,s.lastY,t,e,n,i,r),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);const n=this.shapePrimitives,i=n.length;for(let r=0;r<t.instructions.length;r++){const e=t.instructions[r];this[e.action](...e.data)}if(t.checkForHoles&&n.length-i>1){let t=null;for(let e=i;e<n.length;e++){const i=n[e];if("polygon"===i.shape.type){const r=i.shape,s=null==t?void 0:t.shape;s&&s.containsPolygon(r)?(t.holes||(t.holes=[]),t.holes.push(i),n.copyWithin(e,e+1),n.length--,e--):t=i}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,n,i,r){return this.drawShape(new Hy(t,e,n,i),r),this}circle(t,e,n,i){return this.drawShape(new _T(t,e,n),i),this}poly(t,e,n){const i=new TT(t);return i.closePath=e,this.drawShape(i,n),this}regularPoly(t,e,n,i,r=0,s){i=Math.max(0|i,3);const a=-1*Math.PI/2+r,o=2*Math.PI/i,l=[];for(let h=0;h<i;h++){const i=a-h*o;l.push(t+n*Math.cos(i),e+n*Math.sin(i))}return this.poly(l,!0,s),this}roundPoly(t,e,n,i,r,s=0,a){if(i=Math.max(0|i,3),r<=0)return this.regularPoly(t,e,n,i,s);const o=n*Math.sin(Math.PI/i)-.001;r=Math.min(r,o);const l=-1*Math.PI/2+s,h=2*Math.PI/i,c=(i-2)*Math.PI/i/2;for(let u=0;u<i;u++){const i=u*h+l,s=t+n*Math.cos(i),o=e+n*Math.sin(i),d=i+Math.PI+c,p=i-Math.PI-c,f=s+r*Math.cos(d),m=o+r*Math.sin(d),g=s+r*Math.cos(p),v=o+r*Math.sin(p);0===u?this.moveTo(f,m):this.lineTo(f,m),this.quadraticCurveTo(s,o,g,v,a)}return this.closePath()}roundShape(t,e,n=!1,i){return t.length<3?this:(n?LA(this,t,e,i):FA(this,t,e),this.closePath())}filletRect(t,e,n,i,r){if(0===r)return this.rect(t,e,n,i);const s=Math.min(n,i)/2,a=Math.min(s,Math.max(-s,r)),o=t+n,l=e+i,h=a<0?-a:0,c=Math.abs(a);return this.moveTo(t,e+c).arcTo(t+h,e+h,t+c,e,c).lineTo(o-c,e).arcTo(o-h,e+h,o,e+c,c).lineTo(o,l-c).arcTo(o-h,l-h,t+n-c,l,c).lineTo(t+c,l).arcTo(t+h,l-h,t,l-c,c).closePath()}chamferRect(t,e,n,i,r,s){if(r<=0)return this.rect(t,e,n,i);const a=Math.min(r,Math.min(n,i)/2),o=t+n,l=e+i,h=[t+a,e,o-a,e,o,e+a,o,l-a,o-a,l,t+a,l,t,l-a,t,e+a];for(let c=h.length-1;c>=2;c-=2)h[c]===h[c-2]&&h[c-1]===h[c-3]&&h.splice(c-1,2);return this.poly(h,!0,s)}ellipse(t,e,n,i,r){return this.drawShape(new ST(t,e,n,i),r),this}roundRect(t,e,n,i,r,s){return this.drawShape(new AT(t,e,n,i,r),s),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let n=this._currentPoly;return n&&this.endPoly(),n=new TT,n.points.push(t,e),this._currentPoly=n,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new TT,t)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let e=t.shape.x,n=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const i=t.transform,r=e;e=i.a*e+i.c*n+i.tx,n=i.b*r+i.d*n+i.ty}this._currentPoly.points.push(e,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const n=t.instructions[e];this[n.action](...n.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let n=0;n<e.length;n++){const i=e[n],r=i.shape.getBounds(UA);i.transform?t.addRect(r,i.transform):t.addRect(r)}return t}}class NA{constructor(t,e=!1){this.instructions=[],this.uid=Xy("graphicsPath"),this._dirty=!0,this.checkForHoles=e,"string"==typeof t?bT(t,this):this.instructions=(null==t?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new kA(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,n,i,r){const s=this.instructions[this.instructions.length-1],a=this.getLastPoint(Cy.shared);let o=0,l=0;if(s&&"bezierCurveTo"===s.action){o=s.data[2],l=s.data[3];const t=a.x,e=a.y;o=t+(t-o),l=e+(e-l)}else o=a.x,l=a.y;return this.instructions.push({action:"bezierCurveTo",data:[o,l,t,e,n,i,r]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,n){const i=this.instructions[this.instructions.length-1],r=this.getLastPoint(Cy.shared);let s=0,a=0;if(i&&"quadraticCurveTo"===i.action){s=i.data[0],a=i.data[1];const t=r.x,e=r.y;s=t+(t-s),a=e+(e-a)}else s=r.x,a=r.y;return this.instructions.push({action:"quadraticCurveTo",data:[s,a,t,e,n]}),this._dirty=!0,this}rect(t,e,n,i,r){return this.instructions.push({action:"rect",data:[t,e,n,i,r]}),this._dirty=!0,this}circle(t,e,n,i){return this.instructions.push({action:"circle",data:[t,e,n,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,n,i,r,s,a){r||(r=i/2);const o=-1*Math.PI/2+s,l=2*n,h=2*Math.PI/l,c=[];for(let u=0;u<l;u++){const n=u%2?r:i,s=u*h+o;c.push(t+n*Math.cos(s),e+n*Math.sin(s))}return this.poly(c,!0,a),this}clone(t=!1){const e=new NA;if(e.checkForHoles=this.checkForHoles,t)for(let n=0;n<this.instructions.length;n++){const t=this.instructions[n];e.instructions.push({action:t.action,data:t.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,n=t.b,i=t.c,r=t.d,s=t.tx,a=t.ty;let o=0,l=0,h=0,c=0,u=0,d=0,p=0,f=0;for(let m=0;m<this.instructions.length;m++){const g=this.instructions[m],v=g.data;switch(g.action){case"moveTo":case"lineTo":o=v[0],l=v[1],v[0]=e*o+i*l+s,v[1]=n*o+r*l+a;break;case"bezierCurveTo":h=v[0],c=v[1],u=v[2],d=v[3],o=v[4],l=v[5],v[0]=e*h+i*c+s,v[1]=n*h+r*c+a,v[2]=e*u+i*d+s,v[3]=n*u+r*d+a,v[4]=e*o+i*l+s,v[5]=n*o+r*l+a;break;case"quadraticCurveTo":h=v[0],c=v[1],o=v[2],l=v[3],v[0]=e*h+i*c+s,v[1]=n*h+r*c+a,v[2]=e*o+i*l+s,v[3]=n*o+r*l+a;break;case"arcToSvg":o=v[5],l=v[6],p=v[0],f=v[1],v[0]=e*p+i*f,v[1]=n*p+r*f,v[5]=e*o+i*l+s,v[6]=n*o+r*l+a;break;case"circle":v[4]=zA(v[3],t);break;case"rect":v[4]=zA(v[4],t);break;case"ellipse":v[8]=zA(v[8],t);break;case"roundRect":v[5]=zA(v[5],t);break;case"addPath":v[0].transform(t);break;case"poly":v[2]=zA(v[2],t);break;default:Vx(g.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,n=this.instructions[e];if(!n)return t.x=0,t.y=0,t;for(;"closePath"===n.action;){if(e--,e<0)return t.x=0,t.y=0,t;n=this.instructions[e]}switch(n.action){case"moveTo":case"lineTo":t.x=n.data[0],t.y=n.data[1];break;case"quadraticCurveTo":t.x=n.data[2],t.y=n.data[3];break;case"bezierCurveTo":t.x=n.data[4],t.y=n.data[5];break;case"arc":case"arcToSvg":t.x=n.data[5],t.y=n.data[6];break;case"addPath":n.data[0].getLastPoint(t)}return t}}function zA(t,e){return t?t.prepend(e):e.clone()}function GA(t,e,n){const i=t.getAttribute(e);return i?Number(i):n}function HA(t,e){const n=t.querySelectorAll("defs");for(let i=0;i<n.length;i++){const t=n[i];for(let n=0;n<t.children.length;n++){const i=t.children[n];switch(i.nodeName.toLowerCase()){case"lineargradient":e.defs[i.id]=VA(i);break;case"radialgradient":e.defs[i.id]=XA()}}}}function VA(t){const e=GA(t,"x1",0),n=GA(t,"y1",0),i=GA(t,"x2",1),r=GA(t,"y2",0),s=t.getAttribute("gradientUnits")||"objectBoundingBox",a=new cT(e,n,i,r,"objectBoundingBox"===s?"local":"global");for(let o=0;o<t.children.length;o++){const e=t.children[o],n=GA(e,"offset",0),i=zx.shared.setValue(e.getAttribute("stop-color")).toNumber();a.addColorStop(n,i)}return a}function XA(t){return Vx(),new cT(0,0,1,0)}function WA(t){const e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const jA={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function YA(t,e){const n=t.getAttribute("style"),i={},r={},s={strokeStyle:i,fillStyle:r,useFill:!1,useStroke:!1};for(const a in jA){const n=t.getAttribute(a);n&&qA(e,s,a,n.trim())}if(n){const t=n.split(";");for(let n=0;n<t.length;n++){const i=t[n].trim(),[r,a]=i.split(":");jA[r]&&qA(e,s,r,a.trim())}}return{strokeStyle:s.useStroke?i:null,fillStyle:s.useFill?r:null,useFill:s.useFill,useStroke:s.useStroke}}function qA(t,e,n,i){switch(n){case"stroke":if("none"!==i){if(i.startsWith("url(")){const n=WA(i);e.strokeStyle.fill=t.defs[n]}else e.strokeStyle.color=zx.shared.setValue(i).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(i);break;case"fill":if("none"!==i){if(i.startsWith("url(")){const n=WA(i);e.fillStyle.fill=t.defs[n]}else e.fillStyle.color=zx.shared.setValue(i).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(i);break;case"stroke-opacity":e.strokeStyle.alpha=Number(i);break;case"opacity":e.fillStyle.alpha=Number(i),e.strokeStyle.alpha=Number(i)}}function KA(t,e){if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t.trim(),t=e.querySelector("svg")}const n={context:e,defs:{},path:new NA};HA(t,n);const i=t.children,{fillStyle:r,strokeStyle:s}=YA(t,n);for(let a=0;a<i.length;a++){const t=i[a];"defs"!==t.nodeName.toLowerCase()&&JA(t,n,r,s)}return e}function JA(t,e,n,i){const r=t.children,{fillStyle:s,strokeStyle:a}=YA(t,e);s&&n?n={...n,...s}:s&&(n=s),a&&i?i={...i,...a}:a&&(i=a);const o=!n&&!i;let l,h,c,u,d,p,f,m,g,v,y,x,b,_,S,w,T;switch(o&&(n={color:0}),t.nodeName.toLowerCase()){case"path":_=t.getAttribute("d"),"evenodd"===t.getAttribute("fill-rule")&&Vx(),S=new NA(_,!0),e.context.path(S),n&&e.context.fill(n),i&&e.context.stroke(i);break;case"circle":f=GA(t,"cx",0),m=GA(t,"cy",0),g=GA(t,"r",0),e.context.ellipse(f,m,g,g),n&&e.context.fill(n),i&&e.context.stroke(i);break;case"rect":l=GA(t,"x",0),h=GA(t,"y",0),w=GA(t,"width",0),T=GA(t,"height",0),v=GA(t,"rx",0),y=GA(t,"ry",0),v||y?e.context.roundRect(l,h,w,T,v||y):e.context.rect(l,h,w,T),n&&e.context.fill(n),i&&e.context.stroke(i);break;case"ellipse":f=GA(t,"cx",0),m=GA(t,"cy",0),v=GA(t,"rx",0),y=GA(t,"ry",0),e.context.beginPath(),e.context.ellipse(f,m,v,y),n&&e.context.fill(n),i&&e.context.stroke(i);break;case"line":c=GA(t,"x1",0),u=GA(t,"y1",0),d=GA(t,"x2",0),p=GA(t,"y2",0),e.context.beginPath(),e.context.moveTo(c,u),e.context.lineTo(d,p),i&&e.context.stroke(i);break;case"polygon":b=t.getAttribute("points"),x=b.match(/\d+/g).map(t=>parseInt(t,10)),e.context.poly(x,!0),n&&e.context.fill(n),i&&e.context.stroke(i);break;case"polyline":b=t.getAttribute("points"),x=b.match(/\d+/g).map(t=>parseInt(t,10)),e.context.poly(x,!1),i&&e.context.stroke(i);break;case"g":case"svg":break;default:Vx(t.nodeName)}o&&(n=null);for(let M=0;M<r.length;M++)JA(r[M],e,n,i)}function ZA(t){return t instanceof fT}function QA(t){return t instanceof cT}function $A(t,e,n){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...n,...t}}function tE(t,e,n){return e.buildGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,{...n,...t}}function eE(t,e){if(null==t)return null;const n={},i=t;return function(t){return zx.isColorLike(t)}(t)?function(t,e,n){const i=zx.shared.setValue(e??0);return t.color=i.toNumber(),t.alpha=1===i.alpha?n.alpha:i.alpha,t.texture=ox.WHITE,{...n,...t}}(n,t,e):function(t){return t instanceof ox}(t)?function(t,e,n){return t.texture=e,{...n,...t}}(n,t,e):ZA(t)?$A(n,t,e):QA(t)?tE(n,t,e):i.fill&&ZA(i.fill)?$A(i,i.fill,e):i.fill&&QA(i.fill)?tE(i,i.fill,e):function(t,e){const n={...e,...t},i=zx.shared.setValue(n.color);return n.alpha*=i.alpha,n.color=i.toNumber(),n}(i,e)}function nE(t,e){const{width:n,alignment:i,miterLimit:r,cap:s,join:a,pixelLine:o,...l}=e,h=eE(t,l);return h?{width:n,alignment:i,miterLimit:r,cap:s,join:a,pixelLine:o,...h}:null}const iE=new Cy,rE=new Ry,sE=class t extends Ty{constructor(){super(...arguments),this.uid=Xy("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new NA,this._transform=new Ry,this._fillStyle={...t.defaultFillStyle},this._strokeStyle={...t.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new cx,this._boundsDirty=!0}clone(){const e=new t;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=eE(e,t.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=nE(e,t.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=eE(e,t.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=eE(e,t.defaultStrokeStyle),this}texture(t,e,n,i,r,s){return this.instructions.push({action:"texture",data:{image:t,dx:n||0,dy:i||0,dw:r||t.frame.width,dh:s||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?zx.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new NA,this}fill(e,n){let i;const r=this.instructions[this.instructions.length-1];return i=0===this._tick&&r&&"stroke"===r.action?r.data.path:this._activePath.clone(),i?(null!=e&&(void 0!==n&&"number"==typeof e&&(qy(0,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:n}),this._fillStyle=eE(e,t.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(Cy.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(e){let n;const i=this.instructions[this.instructions.length-1];return n=0===this._tick&&i&&"fill"===i.action?i.data.path:this._activePath.clone(),n?(null!=e&&(this._strokeStyle=nE(e,t.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:n}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],n=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action)){if(!e.data.hole){e.data.hole=n;break}e.data.hole.addPath(n)}}return this._initNextPathLocation(),this}arc(t,e,n,i,r,s){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,n,i,r,s),this}arcTo(t,e,n,i,r){this._tick++;const s=this._transform;return this._activePath.arcTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*n+s.c*i+s.tx,s.b*n+s.d*i+s.ty,r),this}arcToSvg(t,e,n,i,r,s,a){this._tick++;const o=this._transform;return this._activePath.arcToSvg(t,e,n,i,r,o.a*s+o.c*a+o.tx,o.b*s+o.d*a+o.ty),this}bezierCurveTo(t,e,n,i,r,s,a){this._tick++;const o=this._transform;return this._activePath.bezierCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*n+o.c*i+o.tx,o.b*n+o.d*i+o.ty,o.a*r+o.c*s+o.tx,o.b*r+o.d*s+o.ty,a),this}closePath(){var t;return this._tick++,null==(t=this._activePath)||t.closePath(),this}ellipse(t,e,n,i){return this._tick++,this._activePath.ellipse(t,e,n,i,this._transform.clone()),this}circle(t,e,n){return this._tick++,this._activePath.circle(t,e,n,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const n=this._transform;return this._activePath.lineTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty),this}moveTo(t,e){this._tick++;const n=this._transform,i=this._activePath.instructions,r=n.a*t+n.c*e+n.tx,s=n.b*t+n.d*e+n.ty;return 1===i.length&&"moveTo"===i[0].action?(i[0].data[0]=r,i[0].data[1]=s,this):(this._activePath.moveTo(r,s),this)}quadraticCurveTo(t,e,n,i,r){this._tick++;const s=this._transform;return this._activePath.quadraticCurveTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*n+s.c*i+s.tx,s.b*n+s.d*i+s.ty,r),this}rect(t,e,n,i){return this._tick++,this._activePath.rect(t,e,n,i,this._transform.clone()),this}roundRect(t,e,n,i,r){return this._tick++,this._activePath.roundRect(t,e,n,i,r,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,n,i,r=0,s){return this._tick++,this._activePath.regularPoly(t,e,n,i,r,s),this}roundPoly(t,e,n,i,r,s){return this._tick++,this._activePath.roundPoly(t,e,n,i,r,s),this}roundShape(t,e,n,i){return this._tick++,this._activePath.roundShape(t,e,n,i),this}filletRect(t,e,n,i,r){return this._tick++,this._activePath.filletRect(t,e,n,i,r),this}chamferRect(t,e,n,i,r,s){return this._tick++,this._activePath.chamferRect(t,e,n,i,r,s),this}star(t,e,n,i,r=0,s=0){return this._tick++,this._activePath.star(t,e,n,i,r,s,this._transform.clone()),this}svg(t){return this._tick++,KA(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,n,i,r,s){return t instanceof Ry?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,n,i,r,s),this)}transform(t,e,n,i,r,s){return t instanceof Ry?(this._transform.append(t),this):(rE.set(t,e,n,i,r,s),this._transform.append(rE),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const n=this.instructions[e],i=n.action;if("fill"===i){const e=n.data;t.addBounds(e.path.bounds)}else if("texture"===i){const e=n.data;t.addFrame(e.dx,e.dy,e.dx+e.dw,e.dy+e.dh,e.transform)}if("stroke"===i){const e=n.data,i=e.style.alignment,r=e.style.width*(1-i),s=e.path.bounds;t.addFrame(s.minX-r,s.minY-r,s.maxX+r,s.maxY+r)}}return t}containsPoint(t){var e;if(!this.bounds.containsPoint(t.x,t.y))return!1;const n=this.instructions;let i=!1;for(let r=0;r<n.length;r++){const s=n[r],a=s.data,o=a.path;if(!s.action||!o)continue;const l=a.style,h=o.shapePath.shapePrimitives;for(let n=0;n<h.length;n++){const r=h[n].shape;if(!l||!r)continue;const o=h[n].transform,c=o?o.applyInverse(t,iE):t;if("fill"===s.action)i=r.contains(c.x,c.y);else{const t=l;i=r.strokeContains(c.x,c.y,t.width,t.alignment)}const u=a.hole;if(u){const t=null==(e=u.shapePath)?void 0:e.shapePrimitives;if(t)for(let e=0;e<t.length;e++)t[e].shape.contains(c.x,c.y)&&(i=!1)}if(i)return!0}}return i}destroy(t=!1){this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners();if("boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};sE.defaultFillStyle={color:16777215,alpha:1,texture:ox.WHITE,matrix:null,fill:null,textureSpace:"local"},sE.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:ox.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let aE=sE;const oE=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function lE(t){const e=[];let n=0;for(let i=0;i<oE.length;i++){const r=`_${oE[i]}`;e[n++]=t[r]}return n=hE(t._fill,e,n),n=function(t,e,n){return t?(n=hE(t,e,n),e[n++]=t.width,e[n++]=t.alignment,e[n++]=t.cap,e[n++]=t.join,e[n++]=t.miterLimit,n):n}(t._stroke,e,n),n=function(t,e,n){return t?(e[n++]=t.alpha,e[n++]=t.angle,e[n++]=t.blur,e[n++]=t.distance,e[n++]=zx.shared.setValue(t.color).toNumber(),n):n}(t.dropShadow,e,n),n=function(t,e,n){if(!t)return n;for(const i of t)e[n++]=i.uid;return n}(t.filters,e,n),e.join("-")}function hE(t,e,n){var i;return t?(e[n++]=t.color,e[n++]=t.alpha,e[n++]=null==(i=t.fill)?void 0:i.styleKey,n):n}const cE=class t extends Ty{constructor(e={}){super(),function(t){const e=t;if("boolean"==typeof e.dropShadow&&e.dropShadow){const n=uE.defaultDropShadow;t.dropShadow={alpha:e.dropShadowAlpha??n.alpha,angle:e.dropShadowAngle??n.angle,blur:e.dropShadowBlur??n.blur,color:e.dropShadowColor??n.color,distance:e.dropShadowDistance??n.distance}}if(void 0!==e.strokeThickness){qy(0,"strokeThickness is now a part of stroke");const n=e.stroke;let i={};if(zx.isColorLike(n))i.color=n;else if(n instanceof cT||n instanceof fT)i.fill=n;else{if(!Object.hasOwnProperty.call(n,"color")&&!Object.hasOwnProperty.call(n,"fill"))throw new Error("Invalid stroke value.");i=n}t.stroke={...i,width:e.strokeThickness}}if(Array.isArray(e.fillGradientStops)){let n;qy(0,"gradient fill is now a fill pattern: `new FillGradient(...)`"),null==t.fontSize?t.fontSize=uE.defaultTextStyle.fontSize:n="string"==typeof t.fontSize?parseInt(t.fontSize,10):t.fontSize;const i=new cT({start:{x:0,y:0},end:{x:0,y:1.7*(n||0)}}),r=e.fillGradientStops.map(t=>zx.shared.setValue(t).toNumber());r.forEach((t,e)=>{const n=e/(r.length-1);i.addColorStop(n,t)}),t.fill={fill:i}}}(e);const n={...t.defaultTextStyle,...e};for(const t in n){this[t]=n[t]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow=null!==e&&"object"==typeof e?this._createProxy({...t.defaultDropShadow,...e}):e?this._createProxy({...t.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize="string"==typeof t?parseInt(t,10):t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get filters(){return this._filters}set filters(t){this._filters=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...aE.defaultFillStyle,...t},()=>{this._fill=eE({...this._originalFill},aE.defaultFillStyle)})),this._fill=eE(0===t?"black":t,aE.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...aE.defaultStrokeStyle,...t},()=>{this._stroke=nE({...this._originalStroke},aE.defaultStrokeStyle)})),this._stroke=nE(t,aE.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=lE(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=t.defaultTextStyle;for(const t in e)this[t]=e[t]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){var e,n,i,r;this.removeAllListeners();if("boolean"==typeof t?t:null==t?void 0:t.texture){const s="boolean"==typeof t?t:null==t?void 0:t.textureSource;(null==(e=this._fill)?void 0:e.texture)&&this._fill.texture.destroy(s),(null==(n=this._originalFill)?void 0:n.texture)&&this._originalFill.texture.destroy(s),(null==(i=this._stroke)?void 0:i.texture)&&this._stroke.texture.destroy(s),(null==(r=this._originalStroke)?void 0:r.texture)&&this._originalStroke.texture.destroy(s)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(t,n,i)=>(t[n]=i,null==e||e(n,i),this.update(),!0)})}_isFillStyle(t){return null!==(t??null)&&!(zx.isColorLike(t)||t instanceof cT||t instanceof fT)}};cE.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},cE.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let uE=cE;class dE{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const n=Wb.get().createCanvas();n.width=t,n.height=e;const i=n.getContext("2d");return{canvas:n,context:i}}getOptimalCanvasAndContext(t,e,n=1){t=Math.ceil(t*n-1e-6),e=Math.ceil(e*n-1e-6);const i=((t=Jy(t))<<17)+((e=Jy(e))<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let r=this._canvasPool[i].pop();return r||(r=this._createCanvasAndContext(t,e)),r}returnCanvasAndContext(t){const e=t.canvas,{width:n,height:i}=e,r=(n<<17)+(i<<1);t.context.resetTransform(),t.context.clearRect(0,0,n,i),this._canvasPool[r].push(t)}clear(){this._canvasPool={}}}const pE=new dE,fE=1e5;function mE(t,e,n,i=0){if(t.texture===ox.WHITE&&!t.fill)return zx.shared.setValue(t.color).setAlpha(t.alpha??1).toHexa();if(!t.fill){const n=e.createPattern(t.texture.source.resource,"repeat"),i=t.matrix.copyTo(Ry.shared);return i.scale(t.texture.frame.width,t.texture.frame.height),n.setTransform(i),n}if(t.fill instanceof fT){const n=t.fill,i=e.createPattern(n.texture.source.resource,"repeat"),r=n.transform.copyTo(Ry.shared);return r.scale(n.texture.frame.width,n.texture.frame.height),i.setTransform(r),i}if(t.fill instanceof cT){const r=t.fill,s="linear"===r.type,a="local"===r.textureSpace;let o,l=1,h=1;a&&n&&(l=n.width+i,h=n.height+i);let c=!1;if(s){const{start:t,end:n}=r;o=e.createLinearGradient(t.x*l,t.y*h,n.x*l,n.y*h),c=Math.abs(n.x-t.x)<Math.abs(.1*(n.y-t.y))}else{const{center:t,innerRadius:n,outerCenter:i,outerRadius:s}=r;o=e.createRadialGradient(t.x*l,t.y*h,n*l,i.x*l,i.y*h,s*l)}if(c&&a&&n){const t=n.lineHeight/h;for(let e=0;e<n.lines.length;e++){const s=(e*n.lineHeight+i/2)/h;r.colorStops.forEach(e=>{const n=s+e.offset*t;o.addColorStop(Math.floor(n*fE)/fE,zx.shared.setValue(e.color).toHex())})}}else r.colorStops.forEach(t=>{o.addColorStop(t.offset,zx.shared.setValue(t.color).toHex())});return o}return Vx(),"red"}const gE=class t extends nT{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const n={...t.defaultOptions,...e};this._textureSize=n.textureSize,this._mipmap=n.mipmap;const i=n.style.clone();n.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=ox.WHITE,i._fill.fill=null),this.applyFillAsTint=n.overrideFill;const r=i.fontSize;i.fontSize=this.baseMeasurementFontSize;const s=rT(i);n.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/r):i.fontSize=this.baseRenderedFontSize=r,this._style=i,this._skipKerning=n.skipKerning??!1,this.resolution=n.resolution??1,this._padding=n.padding??4,n.textureStyle&&(this._textureStyle=n.textureStyle instanceof ex?n.textureStyle:new ex(n.textureStyle)),this.fontMetrics=oT.measureFont(s),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){var e,n;const i=oT.graphemeSegmenter(t).filter(t=>!this._currentChars.includes(t)).filter((t,e,n)=>n.indexOf(t)===e);if(!i.length)return;let r;this._currentChars=[...this._currentChars,...i],r=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex];let{canvas:s,context:a}=r.canvasAndContext,o=r.texture.source;const l=this._style;let h=this._currentX,c=this._currentY,u=this._currentMaxCharHeight;const d=this.baseRenderedFontSize/this.baseMeasurementFontSize,p=this._padding*d;let f=!1;const m=s.width/this.resolution,g=s.height/this.resolution;for(let v=0;v<i.length;v++){const t=i[v],r=oT.measureText(t,l,s,!1);r.lineHeight=r.height;const y=r.width*d,x=Math.ceil(("italic"===l.fontStyle?2:1)*y)+2*p,b=r.height*d+2*p;if(f=!1,"\n"!==t&&"\r"!==t&&"\t"!==t&&" "!==t&&(f=!0,u=Math.ceil(Math.max(b,u))),h+x>m&&(c+=u,u=b,h=0,c+u>g)){o.update();const t=this._nextPage();s=t.canvasAndContext.canvas,a=t.canvasAndContext.context,o=t.texture.source,h=0,c=0,u=0}const _=y/d-((null==(e=l.dropShadow)?void 0:e.distance)??0)-((null==(n=l._stroke)?void 0:n.width)??0);if(this.chars[t]={id:t.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:_,kerning:{}},f){this._drawGlyph(a,r,h+p,c+p,d,l);const e=o.width*d,n=o.height*d,i=new Hy(h/e*o.width,c/n*o.height,x/e*o.width,b/n*o.height);this.chars[t].texture=new ox({source:o,frame:i}),h+=Math.ceil(x)}}o.update(),this._currentX=h,this._currentY=c,this._currentMaxCharHeight=u,this._skipKerning&&this._applyKerning(i,a)}get pageTextures(){return qy(0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const n=this._measureCache;for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<this._currentChars.length;t++){const i=this._currentChars[t];let s=n[r];s||(s=n[r]=e.measureText(r).width);let a=n[i];a||(a=n[i]=e.measureText(i).width);let o=e.measureText(r+i).width,l=o-(s+a);l&&(this.chars[r].kerning[i]=l),o=e.measureText(r+i).width,l=o-(s+a),l&&(this.chars[i].kerning[r]=l)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=pE.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const n=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i=new ox({source:new Yb({resource:e.canvas,resolution:n,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(i.source.style=this._textureStyle);const r={canvasAndContext:e,texture:i};return this.pages[this._currentPageIndex]=r,r}_setupContext(t,e,n){e.fontSize=this.baseRenderedFontSize,t.scale(n,n),t.font=rT(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const i=e._stroke,r=(null==i?void 0:i.width)??0;if(i&&(t.lineWidth=r,t.lineJoin=i.join,t.miterLimit=i.miterLimit,t.strokeStyle=mE(i,t)),e._fill&&(t.fillStyle=mE(e._fill,t)),e.dropShadow){const i=e.dropShadow,r=zx.shared.setValue(i.color).toArray(),s=i.blur*n,a=i.distance*n;t.shadowColor=`rgba(${255*r[0]},${255*r[1]},${255*r[2]},${i.alpha})`,t.shadowBlur=s,t.shadowOffsetX=Math.cos(i.angle)*a,t.shadowOffsetY=Math.sin(i.angle)*a}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,n,i,r,s){const a=e.text,o=e.fontProperties,l=s._stroke,h=((null==l?void 0:l.width)??0)*r,c=n+h/2,u=i-h/2,d=o.descent*r,p=e.lineHeight*r;let f=!1;s.stroke&&h&&(f=!0,t.strokeText(a,c,u+p-d));const{shadowBlur:m,shadowOffsetX:g,shadowOffsetY:v}=t;s._fill&&(f&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(a,c,u+p-d)),f&&(t.shadowBlur=m,t.shadowOffsetX=g,t.shadowOffsetY=v)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:n}=this.pages[t];pE.returnCanvasAndContext(e),n.destroy(!0)}this.pages=null}};gE.defaultOptions={textureSize:512,style:new uE,mipmap:!0};let vE=gE;function yE(t,e,n,i){const r={width:0,height:0,offsetY:0,scale:e.fontSize/n.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};r.offsetY=n.baseLineOffset;let s=r.lines[0],a=null,o=!0;const l={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=t=>{const e=s.width;for(let n=0;n<l.index;n++){const i=t.positions[n];s.chars.push(t.chars[n]),s.charPositions.push(i+e)}s.width+=t.width,o=!1,l.width=0,l.index=0,l.chars.length=0},c=()=>{let t=s.chars.length-1;if(i){let e=s.chars[t];for(;" "===e;)s.width-=n.chars[e].xAdvance,e=s.chars[--t]}r.width=Math.max(r.width,s.width),s={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,r.lines.push(s),r.height+=n.lineHeight},u=n.baseMeasurementFontSize/e.fontSize,d=e.letterSpacing*u,p=e.wordWrapWidth*u,f=e.wordWrap&&e.breakWords,m=t=>t-d>p;for(let g=0;g<t.length+1;g++){let i;const r=g===t.length;r||(i=t[g]);const u=n.chars[i]||n.chars[" "];if(/(?:\s)/.test(i)||"\r"===i||"\n"===i||r){if(!o&&e.wordWrap&&m(s.width+l.width)?(c(),h(l),r||s.charPositions.push(0)):(l.start=s.width,h(l),r||s.charPositions.push(0)),"\r"===i||"\n"===i)0!==s.width&&c();else if(!r){const t=u.xAdvance+(u.kerning[a]||0)+d;s.width+=t,s.spaceWidth=t,s.spacesIndex.push(s.charPositions.length),s.chars.push(i)}}else{const t=u.kerning[a]||0,e=u.xAdvance+t+d;f&&m(s.width+l.width+e)&&(h(l),c()),l.positions[l.index++]=l.width+t,l.chars.push(i),l.width+=e}a=i}return c(),"center"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const n=t.lines[e],i=t.width/2-n.width/2;for(let t=0;t<n.charPositions.length;t++)n.charPositions[t]+=i}}(r):"right"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const n=t.lines[e],i=t.width-n.width;for(let t=0;t<n.charPositions.length;t++)n.charPositions[t]+=i}}(r):"justify"===e.align&&function(t){const e=t.width;for(let n=0;n<t.lines.length;n++){const i=t.lines[n];let r=0,s=i.spacesIndex[r++],a=0;const o=i.spacesIndex.length,l=(e-i.width)/o;for(let t=0;t<i.charPositions.length;t++)t===s&&(s=i.spacesIndex[r++],a+=l),i.charPositions[t]+=a}}(r),r}function xE(t){if(""===t)return[];"string"==typeof t&&(t=[t]);const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(0===i[0].length||0===i[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");const t=i[0].charCodeAt(0),n=i[1].charCodeAt(0);if(n<t)throw new Error("[BitmapFont]: Invalid character range.");for(let i=t,r=n;i<=r;i++)e.push(String.fromCharCode(i))}else e.push(...Array.from(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}let bE=0;const _E=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null}}getFont(t,e){var n;let i=`${e.fontFamily}-bitmap`,r=!0;if(e._fill.fill&&!e._stroke)i+=e._fill.fill.styleKey,r=!1;else if(e._stroke||e.dropShadow){let t=e.styleKey;t=t.substring(0,t.lastIndexOf("-")),i=`${t}-bitmap`,r=!1}if(!i_.has(i)){const t=new vE({style:e,overrideFill:r,overrideSize:!0,...this.defaultOptions});bE++,bE>50&&Vx(),t.once("destroy",()=>{bE--,i_.remove(i)}),i_.set(i,t)}const s=i_.get(i);return null==(n=s.ensureCharacters)||n.call(s,t),s}getLayout(t,e,n=!0){const i=this.getFont(t,e);return yE(oT.graphemeSegmenter(t),e,i,n)}measureText(t,e,n=!0){return this.getLayout(t,e,n)}install(...t){var e,n,i,r;let s=t[0];"string"==typeof s&&(s={name:s,style:t[1],chars:null==(e=t[2])?void 0:e.chars,resolution:null==(n=t[2])?void 0:n.resolution,padding:null==(i=t[2])?void 0:i.padding,skipKerning:null==(r=t[2])?void 0:r.skipKerning},qy(0,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const a=null==s?void 0:s.name;if(!a)throw new Error("[BitmapFontManager] Property `name` is required.");s={...this.defaultOptions,...s};const o=s.style,l=o instanceof uE?o:new uE(o),h=null!==l._fill.fill&&void 0!==l._fill.fill,c=new vE({style:l,overrideFill:h,skipKerning:s.skipKerning,padding:s.padding,resolution:s.resolution,overrideSize:!1,textureStyle:s.textureStyle}),u=xE(s.chars);return c.ensureCharacters(u.join("")),i_.set(`${a}-bitmap`,c),c.once("destroy",()=>i_.remove(`${a}-bitmap`)),c}uninstall(t){const e=`${t}-bitmap`,n=i_.get(e);n&&n.destroy()}};class SE extends nT{constructor(t,e){super();const{textures:n,data:i}=t;Object.keys(i.pages).forEach(t=>{const e=i.pages[parseInt(t,10)],r=n[e.id];this.pages.push({texture:r})}),Object.keys(i.chars).forEach(t=>{const e=i.chars[t],{frame:r,source:s}=n[e.page],a=new Hy(e.x+r.x,e.y+r.y,e.width,e.height),o=new ox({source:s,frame:a});this.chars[t]={id:t.codePointAt(0),xOffset:e.xOffset,yOffset:e.yOffset,xAdvance:e.xAdvance,kerning:e.kerning??{},texture:o}}),this.baseRenderedFontSize=i.fontSize,this.baseMeasurementFontSize=i.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:i.fontSize},this.baseLineOffset=i.baseLineOffset,this.lineHeight=i.lineHeight,this.fontFamily=i.fontFamily,this.distanceField=i.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){_E.install(t)}static uninstall(t){_E.uninstall(t)}}const wE={test:t=>"string"==typeof t&&t.startsWith("info face="),parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in e){const t=e[u].match(/^[a-z]+/gm)[0],i=e[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),r={};for(const e in i){const t=i[e].split("="),n=t[0],s=t[1].replace(/"/gm,""),a=parseFloat(s),o=isNaN(a)?s:a;r[n]=o}n[t].push(r)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[r]=n.info,[s]=n.common,[a]=n.distanceField??[];a&&(i.distanceField={range:parseInt(a.distanceRange,10),type:a.fieldType}),i.fontSize=parseInt(r.size,10),i.fontFamily=r.face,i.lineHeight=parseInt(s.lineHeight,10);const o=n.page;for(let u=0;u<o.length;u++)i.pages.push({id:parseInt(o[u].id,10)||0,file:o[u].file});const l={};i.baseLineOffset=i.lineHeight-parseInt(s.base,10);const h=n.char;for(let u=0;u<h.length;u++){const t=h[u],e=parseInt(t.id,10);let n=t.letter??t.char??String.fromCharCode(e);"space"===n&&(n=" "),l[e]=n,i.chars[n]={id:e,page:parseInt(t.page,10)||0,x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xOffset:parseInt(t.xoffset,10),yOffset:parseInt(t.yoffset,10),xAdvance:parseInt(t.xadvance,10),kerning:{}}}const c=n.kerning||[];for(let u=0;u<c.length;u++){const t=parseInt(c[u].first,10),e=parseInt(c[u].second,10),n=parseInt(c[u].amount,10);i.chars[l[e]].kerning[l[t]]=n}return i}},TE={test(t){const e=t;return"string"!=typeof e&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")},parse(t){const e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},n=t.getElementsByTagName("info")[0],i=t.getElementsByTagName("common")[0],r=t.getElementsByTagName("distanceField")[0];r&&(e.distanceField={type:r.getAttribute("fieldType"),range:parseInt(r.getAttribute("distanceRange"),10)});const s=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning");e.fontSize=parseInt(n.getAttribute("size"),10),e.fontFamily=n.getAttribute("face"),e.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let h=0;h<s.length;h++)e.pages.push({id:parseInt(s[h].getAttribute("id"),10)||0,file:s[h].getAttribute("file")});const l={};e.baseLineOffset=e.lineHeight-parseInt(i.getAttribute("base"),10);for(let h=0;h<a.length;h++){const t=a[h],n=parseInt(t.getAttribute("id"),10);let i=t.getAttribute("letter")??t.getAttribute("char")??String.fromCharCode(n);"space"===i&&(i=" "),l[n]=i,e.chars[i]={id:n,page:parseInt(t.getAttribute("page"),10)||0,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10),xOffset:parseInt(t.getAttribute("xoffset"),10),yOffset:parseInt(t.getAttribute("yoffset"),10),xAdvance:parseInt(t.getAttribute("xadvance"),10),kerning:{}}}for(let h=0;h<o.length;h++){const t=parseInt(o[h].getAttribute("first"),10),n=parseInt(o[h].getAttribute("second"),10),i=parseInt(o[h].getAttribute("amount"),10);e.chars[l[n]].kerning[l[t]]=i}return e}},ME={test:t=>!("string"!=typeof t||!t.includes("<font>"))&&TE.test(Wb.get().parseXML(t)),parse:t=>TE.parse(Wb.get().parseXML(t))},AE=[".xml",".fnt"],EE={extension:{type:fy.CacheParser,name:"cacheBitmapFont"},test:t=>t instanceof SE,getCacheableAssets(t,e){const n={};return t.forEach(t=>{n[t]=e,n[`${t}-bitmap`]=e}),n[`${e.fontFamily}-bitmap`]=e,n}},CE={extension:{type:fy.LoadParser,priority:l_.Normal},name:"loadBitmapFont",test:t=>AE.includes(u_.extname(t).toLowerCase()),testParse:async t=>wE.test(t)||ME.test(t),async parse(t,e,n){const i=wE.test(t)?wE.parse(t):ME.parse(t),{src:r}=e,{pages:s}=i,a=[],o=i.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let c=0;c<s.length;++c){const t=s[c].file;let e=u_.join(u_.dirname(r),t);e=v_(e,r),a.push({src:e,data:o})}const l=await n.load(a),h=a.map(t=>l[t.src]);return new SE({data:i,textures:h},r)},async load(t,e){const n=await Wb.get().fetch(t);return await n.text()},async unload(t,e,n){await Promise.all(t.pages.map(t=>n.unload(t.texture.source._sourceOrigin))),t.destroy()}};class PE{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(t=>{this._assetList.push(t)}),this.verbose,this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<e;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const RE={extension:{type:fy.CacheParser,name:"cacheTextureArray"},test:t=>Array.isArray(t)&&t.every(t=>t instanceof ox),getCacheableAssets:(t,e)=>{const n={};return t.forEach(t=>{e.forEach((e,i)=>{n[t+(0===i?"":i+1)]=e})}),n}};async function IE(t){if("Image"in globalThis)return new Promise(e=>{const n=new Image;n.onload=()=>{e(!0)},n.onerror=()=>{e(!1)},n.src=t});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch(e){return!1}return!0}return!1}const OE={extension:{type:fy.DetectionParser,priority:1},test:async()=>IE("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter(t=>"avif"!==t)},DE=["png","jpg","jpeg"],BE={extension:{type:fy.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...DE],remove:async t=>t.filter(t=>!DE.includes(t))},FE="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function LE(t){if(FE)return!1;return""!==document.createElement("video").canPlayType(t)}const UE={extension:{type:fy.DetectionParser,priority:0},test:async()=>LE("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter(t=>"mp4"!==t&&"m4v"!==t)},kE={extension:{type:fy.DetectionParser,priority:0},test:async()=>LE("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter(t=>"ogv"!==t)},NE={extension:{type:fy.DetectionParser,priority:0},test:async()=>LE("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter(t=>"webm"!==t)},zE={extension:{type:fy.DetectionParser,priority:0},test:async()=>IE("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter(t=>"webp"!==t)};class GE{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,n)=>(this._parsersValidated=!1,t[e]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const n={promise:null,parser:null};return n.promise=(async()=>{var i,r;let s=null,a=null;if(e.loadParser&&(a=this._parserHash[e.loadParser],a||Vx(e.loadParser)),!a){for(let n=0;n<this.parsers.length;n++){const r=this.parsers[n];if(r.load&&(null==(i=r.test)?void 0:i.call(r,t,e,this))){a=r;break}}if(!a)return Vx(),null}s=await a.load(t,e,this),n.parser=a;for(let t=0;t<this.parsers.length;t++){const i=this.parsers[t];i.parse&&i.parse&&await(null==(r=i.testParse)?void 0:r.call(i,s,e,this))&&(s=await i.parse(s,e,this)||s,n.parser=i)}return s})(),n}async load(t,e){this._parsersValidated||this._validateParsers();let n=0;const i={},r=f_(t),s=n_(t,t=>({alias:[t],src:t,data:{}})),a=s.length,o=s.map(async t=>{const r=u_.toAbsolute(t.src);if(!i[t.src])try{this.promiseCache[r]||(this.promiseCache[r]=this._getLoadPromiseAndParser(r,t)),i[t.src]=await this.promiseCache[r].promise,e&&e(++n/a)}catch(s){throw delete this.promiseCache[r],delete i[t.src],new Error(`[Loader.load] Failed to load ${r}.\n${s}`)}});return await Promise.all(o),r?i[s[0].src]:i}async unload(t){const e=n_(t,t=>({alias:[t],src:t})).map(async t=>{var e,n;const i=u_.toAbsolute(t.src),r=this.promiseCache[i];if(r){const s=await r.promise;delete this.promiseCache[i],await(null==(n=null==(e=r.parser)?void 0:e.unload)?void 0:n.call(e,s,t,this))}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(e.name?t[e.name]&&Vx(e.name):Vx(),{...t,[e.name]:e}),{})}}function HE(t,e){if(Array.isArray(e)){for(const n of e)if(t.startsWith(`data:${n}`))return!0;return!1}return t.startsWith(`data:${e}`)}function VE(t,e){const n=t.split("?")[0],i=u_.extname(n).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const XE={extension:{type:fy.LoadParser,priority:l_.Low},name:"loadJson",test:t=>HE(t,"application/json")||VE(t,".json"),async load(t){const e=await Wb.get().fetch(t);return await e.json()}},WE={name:"loadTxt",extension:{type:fy.LoadParser,priority:l_.Low,name:"loadTxt"},test:t=>HE(t,"text/plain")||VE(t,".txt"),async load(t){const e=await Wb.get().fetch(t);return await e.text()}},jE=["normal","bold","100","200","300","400","500","600","700","800","900"],YE=[".ttf",".otf",".woff",".woff2"],qE=["font/ttf","font/otf","font/woff","font/woff2"],KE=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function JE(t){const e=u_.extname(t),n=u_.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1));let i=n.length>0;for(const s of n)if(!s.match(KE)){i=!1;break}let r=n.join(" ");return i||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}const ZE=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function QE(t){return ZE.test(t)?t:encodeURI(t)}const $E={extension:{type:fy.LoadParser,priority:l_.Low},name:"loadWebFont",test:t=>HE(t,qE)||VE(t,YE),async load(t,e){var n,i,r;const s=Wb.get().getFontFaceSet();if(s){const a=[],o=(null==(n=e.data)?void 0:n.family)??JE(t),l=(null==(r=null==(i=e.data)?void 0:i.weights)?void 0:r.filter(t=>jE.includes(t)))??["normal"],h=e.data??{};for(let e=0;e<l.length;e++){const n=l[e],i=new FontFace(o,`url(${QE(t)})`,{...h,weight:n});await i.load(),s.add(i),a.push(i)}return i_.set(`${o}-and-url`,{url:t,fontFaces:a}),1===a.length?a[0]:a}return Vx(),null},unload(t){(Array.isArray(t)?t:[t]).forEach(t=>{i_.remove(`${t.family}-and-url`),Wb.get().getFontFaceSet().delete(t)})}};function tC(t,e=1){var n;const i=null==(n=m_.RETINA_PREFIX)?void 0:n.exec(t);return i?parseFloat(i[1]):e}function eC(t,e,n){t.label=n,t._sourceOrigin=n;const i=new ox({source:t,label:n}),r=()=>{delete e.promiseCache[n],i_.has(n)&&i_.remove(n)};return i.source.once("destroy",()=>{e.promiseCache[n]&&(Vx(),r())}),i.once("destroy",()=>{t.destroyed||(Vx(),r())}),i}const nC={extension:{type:fy.LoadParser,priority:l_.Low,name:"loadSVG"},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test:t=>HE(t,"image/svg+xml")||VE(t,".svg"),async load(t,e,n){var i;return(null==(i=e.data)?void 0:i.parseAsGraphicsContext)??this.config.parseAsGraphicsContext?async function(t){const e=await Wb.get().fetch(t),n=await e.text(),i=new aE;return i.svg(n),i}(t):async function(t,e,n,i){var r,s,a;const o=await Wb.get().fetch(t),l=await o.blob(),h=URL.createObjectURL(l),c=new Image;c.src=h,c.crossOrigin=i,await c.decode(),URL.revokeObjectURL(h);const u=document.createElement("canvas"),d=u.getContext("2d"),p=(null==(r=e.data)?void 0:r.resolution)||tC(t),f=(null==(s=e.data)?void 0:s.width)??c.width,m=(null==(a=e.data)?void 0:a.height)??c.height;u.width=f*p,u.height=m*p,d.drawImage(c,0,0,f*p,m*p);const{parseAsGraphicsContext:g,...v}=e.data??{};return eC(new Yb({resource:u,alphaMode:"premultiply-alpha-on-upload",resolution:p,...v}),n,t)}(t,e,n,this.config.crossOrigin)},unload(t){t.destroy(!0)}};let iC=null,rC=class{constructor(){iC||(iC=URL.createObjectURL(new Blob(['(function () {\n    \'use strict\';\n\n    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n    async function checkImageBitmap() {\n      try {\n        if (typeof createImageBitmap !== "function")\n          return false;\n        const response = await fetch(WHITE_PNG);\n        const imageBlob = await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n        return imageBitmap.width === 1 && imageBitmap.height === 1;\n      } catch (_e) {\n        return false;\n      }\n    }\n    void checkImageBitmap().then((result) => {\n      self.postMessage(result);\n    });\n\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(iC)}};rC.revokeObjectURL=function(){iC&&(URL.revokeObjectURL(iC),iC=null)};let sC=null,aC=class{constructor(){sC||(sC=URL.createObjectURL(new Blob(['(function () {\n    \'use strict\';\n\n    async function loadImageBitmap(url, alphaMode) {\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n      }\n      const imageBlob = await response.blob();\n      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);\n    }\n    self.onmessage = async (event) => {\n      try {\n        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);\n        self.postMessage({\n          data: imageBitmap,\n          uuid: event.data.uuid,\n          id: event.data.id\n        }, [imageBitmap]);\n      } catch (e) {\n        self.postMessage({\n          error: e,\n          uuid: event.data.uuid,\n          id: event.data.id\n        });\n      }\n    };\n\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(sC)}};aC.revokeObjectURL=function(){sC&&(URL.revokeObjectURL(sC),sC=null)};let oC,lC=0;const hC=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new rC;e.addEventListener("message",n=>{e.terminate(),rC.revokeObjectURL(),t(n.data)})})),this._isImageBitmapSupported}loadImageBitmap(t,e){var n;return this._run("loadImageBitmap",[t,null==(n=null==e?void 0:e.data)?void 0:n.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){void 0===oC&&(oC=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<oC&&(this._createdWorkers++,t=(new aC).worker,t.addEventListener("message",t=>{this._complete(t.data),this._returnWorker(t.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){void 0!==t.error?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),this._resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const n=new Promise((n,i)=>{this._queue.push({id:t,arguments:e,resolve:n,reject:i})});return this._next(),n}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),n=e.id;this._resolveHash[lC]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:lC++,id:n})}},cC=[".jpeg",".jpg",".png",".webp",".avif"],uC=["image/jpeg","image/png","image/webp","image/avif"];async function dC(t,e){var n;const i=await Wb.get().fetch(t);if(!i.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${i.status} ${i.statusText}`);const r=await i.blob();return"premultiplied-alpha"===(null==(n=null==e?void 0:e.data)?void 0:n.alphaMode)?createImageBitmap(r,{premultiplyAlpha:"none"}):createImageBitmap(r)}const pC={name:"loadTextures",extension:{type:fy.LoadParser,priority:l_.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>HE(t,uC)||VE(t,cC),async load(t,e,n){var i;let r=null;r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await hC.isImageBitmapSupported()?await hC.loadImageBitmap(t,e):await dC(t,e):await new Promise((e,n)=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=t,r.complete?e(r):(r.onload=()=>{e(r)},r.onerror=n)});return eC(new Yb({resource:r,alphaMode:"premultiply-alpha-on-upload",resolution:(null==(i=e.data)?void 0:i.resolution)||tC(t),...e.data}),n,t)},unload(t){t.destroy(!0)}},fC=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],mC=fC.map(t=>`video/${t.substring(1)}`);function gC(t,e,n){void 0!==n||e.startsWith("data:")?!1!==n&&(t.crossOrigin="string"==typeof n?n:"anonymous"):t.crossOrigin=yC(e)}function vC(t){return new Promise((e,n)=>{function i(){s(),e()}function r(t){s(),n(t)}function s(){t.removeEventListener("canplaythrough",i),t.removeEventListener("error",r)}t.addEventListener("canplaythrough",i),t.addEventListener("error",r),t.load()})}function yC(t,e=globalThis.location){if(t.startsWith("data:"))return"";e||(e=globalThis.location);const n=new URL(t,document.baseURI);return n.hostname!==e.hostname||n.port!==e.port||n.protocol!==e.protocol?"anonymous":""}const xC={name:"loadVideo",extension:{type:fy.LoadParser,name:"loadVideo"},test(t){const e=HE(t,mC),n=VE(t,fC);return e||n},async load(t,e,n){var i,r;const s={...e_.defaultOptions,resolution:(null==(i=e.data)?void 0:i.resolution)||tC(t),alphaMode:(null==(r=e.data)?void 0:r.alphaMode)||await $b(),...e.data},a=document.createElement("video"),o={preload:!1!==s.autoLoad?"auto":void 0,"webkit-playsinline":!1!==s.playsinline?"":void 0,playsinline:!1!==s.playsinline?"":void 0,muted:!0===s.muted?"":void 0,loop:!0===s.loop?"":void 0,autoplay:!1!==s.autoPlay?"":void 0};Object.keys(o).forEach(t=>{const e=o[t];void 0!==e&&a.setAttribute(t,e)}),!0===s.muted&&(a.muted=!0),gC(a,t,s.crossorigin);const l=document.createElement("source");let h;if(t.startsWith("data:"))h=t.slice(5,t.indexOf(";"));else if(!t.startsWith("blob:")){const e=t.split("?")[0].slice(t.lastIndexOf(".")+1).toLowerCase();h=e_.MIME_TYPES[e]||`video/${e}`}return l.src=t,h&&(l.type=h),new Promise(i=>{const r=async()=>{const o=new e_({...s,resource:a});a.removeEventListener("canplay",r),e.data.preload&&await vC(a),i(eC(o,n,t))};s.preload&&!s.autoPlay&&a.load(),a.addEventListener("canplay",r),a.appendChild(l)})},unload(t){t.destroy(!0)}},bC={extension:{type:fy.ResolveParser,name:"resolveTexture"},test:pC.test,parse:t=>{var e;return{resolution:parseFloat((null==(e=m_.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:t.split(".").pop(),src:t}}},_C={extension:{type:fy.ResolveParser,priority:-2,name:"resolveJson"},test:t=>m_.RETINA_PREFIX.test(t)&&t.endsWith(".json"),parse:bC.parse};class SC{constructor(){this._detections=[],this._initialized=!1,this.resolver=new m_,this.loader=new GE,this.cache=i_,this._backgroundLoader=new PE(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var e,n;if(this._initialized)return void Vx();if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const i=(null==(e=t.texturePreference)?void 0:e.resolution)??1,r="number"==typeof i?[i]:i,s=await this._detectFormats({preferredFormats:null==(n=t.texturePreference)?void 0:n.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const n=f_(t),i=n_(t).map(t=>{if("string"!=typeof t){const e=this.resolver.getAlias(t);return e.some(t=>!this.resolver.hasKey(t))&&this.add(t),Array.isArray(e)?e[0]:e}return this.resolver.hasKey(t)||this.add({alias:t,src:t}),t}),r=this.resolver.resolve(i),s=await this._mapLoadToResolve(r,e);return n?s[i[0]]:s}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let n=!1;"string"==typeof t&&(n=!0,t=[t]);const i=this.resolver.resolveBundle(t),r={},s=Object.keys(i);let a=0,o=0;const l=()=>{null==e||e(++a/o)},h=s.map(t=>{const e=i[t];return o+=Object.keys(e).length,this._mapLoadToResolve(e,l).then(e=>{r[t]=e})});return await Promise.all(h),n?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(t=>{this._backgroundLoader.add(Object.values(t))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return i_.get(t);const e={};for(let n=0;n<t.length;n++)e[n]=i_.get(t[n]);return e}async _mapLoadToResolve(t,e){const n=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const i=await this.loader.load(n,e);this._backgroundLoader.active=!0;const r={};return n.forEach(t=>{const e=i[t.src],n=[t.src];t.alias&&n.push(...t.alias),n.forEach(t=>{r[t]=e}),i_.set(n,e)}),r}async unload(t){this._initialized||await this.init();const e=n_(t).map(t=>"string"!=typeof t?t.src:t),n=this.resolver.resolve(e);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=n_(t);const e=this.resolver.resolveBundle(t),n=Object.keys(e).map(t=>this._unloadFromResolved(e[t]));await Promise.all(n)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(t=>{i_.remove(t.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const n of t.detections)t.skipDetections||await n.test()?e=await n.add(e):t.skipDetections||(e=await n.remove(e));return e=e.filter((t,n)=>e.indexOf(t)===n),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(e=>e in t).forEach(n=>{e.config[n]=t[n]})})}}const wC=new SC;vy.handleByList(fy.LoadParser,wC.loader.parsers).handleByList(fy.ResolveParser,wC.resolver.parsers).handleByList(fy.CacheParser,wC.cache.parsers).handleByList(fy.DetectionParser,wC.detections),vy.add(RE,BE,OE,zE,UE,kE,NE,XE,WE,$E,nC,pC,xC,CE,EE,bC,_C);const TC={loader:fy.LoadParser,resolver:fy.ResolveParser,cache:fy.CacheParser,detection:fy.DetectionParser};vy.handle(fy.Asset,t=>{const e=t.ref;Object.entries(TC).filter(([t])=>!!e[t]).forEach(([t,n])=>vy.add(Object.assign(e[t],{extension:e[t].extension??n})))},t=>{const e=t.ref;Object.keys(TC).filter(t=>!!e[t]).forEach(t=>vy.remove(e[t]))});const MC={extension:{type:fy.DetectionParser,priority:3},test:async()=>!!(await jw())||!!Ww(),add:async t=>[...t,"basis"],remove:async t=>t.filter(t=>"basis"!==t)};class AC extends ix{constructor(t){super(t),this.uploadMethodId="compressed",this.resource=t.resource,this.mipLevelCount=this.resource.length}}let EC,CC,PC;function RC(){if(EC)return EC;const t=document.createElement("canvas").getContext("webgl");return t?(EC=[...t.getExtension("EXT_texture_compression_bptc")?["bc6h-rgb-ufloat","bc6h-rgb-float","bc7-rgba-unorm","bc7-rgba-unorm-srgb"]:[],...t.getExtension("WEBGL_compressed_texture_s3tc")?["bc1-rgba-unorm","bc2-rgba-unorm","bc3-rgba-unorm"]:[],...t.getExtension("WEBGL_compressed_texture_s3tc_srgb")?["bc1-rgba-unorm-srgb","bc2-rgba-unorm-srgb","bc3-rgba-unorm-srgb"]:[],...t.getExtension("EXT_texture_compression_rgtc")?["bc4-r-unorm","bc4-r-snorm","bc5-rg-unorm","bc5-rg-snorm"]:[],...t.getExtension("WEBGL_compressed_texture_etc")?["etc2-rgb8unorm","etc2-rgb8unorm-srgb","etc2-rgba8unorm","etc2-rgba8unorm-srgb","etc2-rgb8a1unorm","etc2-rgb8a1unorm-srgb","eac-r11unorm","eac-rg11unorm"]:[],...t.getExtension("WEBGL_compressed_texture_astc")?["astc-4x4-unorm","astc-4x4-unorm-srgb","astc-5x4-unorm","astc-5x4-unorm-srgb","astc-5x5-unorm","astc-5x5-unorm-srgb","astc-6x5-unorm","astc-6x5-unorm-srgb","astc-6x6-unorm","astc-6x6-unorm-srgb","astc-8x5-unorm","astc-8x5-unorm-srgb","astc-8x6-unorm","astc-8x6-unorm-srgb","astc-8x8-unorm","astc-8x8-unorm-srgb","astc-10x5-unorm","astc-10x5-unorm-srgb","astc-10x6-unorm","astc-10x6-unorm-srgb","astc-10x8-unorm","astc-10x8-unorm-srgb","astc-10x10-unorm","astc-10x10-unorm-srgb","astc-12x10-unorm","astc-12x10-unorm-srgb","astc-12x12-unorm","astc-12x12-unorm-srgb"]:[]],EC):[]}async function IC(){if(CC)return CC;const t=await Wb.get().getNavigator().gpu.requestAdapter();return CC=[...t.features.has("texture-compression-bc")?["bc1-rgba-unorm","bc1-rgba-unorm-srgb","bc2-rgba-unorm","bc2-rgba-unorm-srgb","bc3-rgba-unorm","bc3-rgba-unorm-srgb","bc4-r-unorm","bc4-r-snorm","bc5-rg-unorm","bc5-rg-snorm","bc6h-rgb-ufloat","bc6h-rgb-float","bc7-rgba-unorm","bc7-rgba-unorm-srgb"]:[],...t.features.has("texture-compression-etc2")?["etc2-rgb8unorm","etc2-rgb8unorm-srgb","etc2-rgb8a1unorm","etc2-rgb8a1unorm-srgb","etc2-rgba8unorm","etc2-rgba8unorm-srgb","eac-r11unorm","eac-r11snorm","eac-rg11unorm","eac-rg11snorm"]:[],...t.features.has("texture-compression-astc")?["astc-4x4-unorm","astc-4x4-unorm-srgb","astc-5x4-unorm","astc-5x4-unorm-srgb","astc-5x5-unorm","astc-5x5-unorm-srgb","astc-6x5-unorm","astc-6x5-unorm-srgb","astc-6x6-unorm","astc-6x6-unorm-srgb","astc-8x5-unorm","astc-8x5-unorm-srgb","astc-8x6-unorm","astc-8x6-unorm-srgb","astc-8x8-unorm","astc-8x8-unorm-srgb","astc-10x5-unorm","astc-10x5-unorm-srgb","astc-10x6-unorm","astc-10x6-unorm-srgb","astc-10x8-unorm","astc-10x8-unorm-srgb","astc-10x10-unorm","astc-10x10-unorm-srgb","astc-12x10-unorm","astc-12x10-unorm-srgb","astc-12x12-unorm","astc-12x12-unorm-srgb"]:[]],CC}async function OC(){return void 0!==PC||(PC=await(async()=>{const t=await jw(),e=Ww();if(t&&e){const t=await IC(),e=RC();return t.filter(t=>e.includes(t))}return t?await IC():e?RC():[]})()),PC}const DC=["r8unorm","r8snorm","r8uint","r8sint","r16uint","r16sint","r16float","rg8unorm","rg8snorm","rg8uint","rg8sint","r32uint","r32sint","r32float","rg16uint","rg16sint","rg16float","rgba8unorm","rgba8unorm-srgb","rgba8snorm","rgba8uint","rgba8sint","bgra8unorm","bgra8unorm-srgb","rgb9e5ufloat","rgb10a2unorm","rg11b10ufloat","rg32uint","rg32sint","rg32float","rgba16uint","rgba16sint","rgba16float","rgba32uint","rgba32sint","rgba32float","stencil8","depth16unorm","depth24plus","depth24plus-stencil8","depth32float","depth32float-stencil8"];let BC;async function FC(){if(void 0!==BC)return BC;const t=await OC();return BC=[...DC,...t],BC}let LC=null,UC=class{constructor(){LC||(LC=URL.createObjectURL(new Blob(['(function () {\n    \'use strict\';\n\n    function createLevelBuffers(basisTexture, basisTranscoderFormat) {\n      const images = basisTexture.getNumImages();\n      const levels = basisTexture.getNumLevels(0);\n      const success = basisTexture.startTranscoding();\n      if (!success) {\n        throw new Error("startTranscoding failed");\n      }\n      const levelBuffers = [];\n      for (let levelIndex = 0; levelIndex < levels; ++levelIndex) {\n        for (let sliceIndex = 0; sliceIndex < images; ++sliceIndex) {\n          const transcodeSize = basisTexture.getImageTranscodedSizeInBytes(sliceIndex, levelIndex, basisTranscoderFormat);\n          const levelBuffer = new Uint8Array(transcodeSize);\n          const success2 = basisTexture.transcodeImage(levelBuffer, sliceIndex, levelIndex, basisTranscoderFormat, 1, 0);\n          if (!success2) {\n            throw new Error("transcodeImage failed");\n          }\n          levelBuffers.push(levelBuffer);\n        }\n      }\n      return levelBuffers;\n    }\n\n    const gpuFormatToBasisTranscoderFormatMap = {\n      "bc3-rgba-unorm": 3,\n      // cTFBC3_RGBA\n      "bc7-rgba-unorm": 6,\n      // cTFBC7_RGBA,\n      "etc2-rgba8unorm": 1,\n      // cTFETC2_RGBA,\n      "astc-4x4-unorm": 10,\n      // cTFASTC_4x4_RGBA,\n      // Uncompressed\n      rgba8unorm: 13,\n      // cTFRGBA32,\n      rgba4unorm: 16\n      // cTFRGBA4444,\n    };\n    function gpuFormatToBasisTranscoderFormat(transcoderFormat) {\n      const format = gpuFormatToBasisTranscoderFormatMap[transcoderFormat];\n      if (format) {\n        return format;\n      }\n      throw new Error(`Unsupported transcoderFormat: ${transcoderFormat}`);\n    }\n\n    const settings = {\n      jsUrl: "basis/basis_transcoder.js",\n      wasmUrl: "basis/basis_transcoder.wasm"\n    };\n    let basisTranscoderFormat;\n    let basisTranscodedTextureFormat;\n    let basisPromise;\n    async function getBasis() {\n      if (!basisPromise) {\n        const absoluteJsUrl = new URL(settings.jsUrl, location.origin).href;\n        const absoluteWasmUrl = new URL(settings.wasmUrl, location.origin).href;\n        importScripts(absoluteJsUrl);\n        basisPromise = new Promise((resolve) => {\n          BASIS({\n            locateFile: (_file) => absoluteWasmUrl\n          }).then((module) => {\n            module.initializeBasis();\n            resolve(module.BasisFile);\n          });\n        });\n      }\n      return basisPromise;\n    }\n    async function fetchBasisTexture(url, BasisTexture) {\n      const basisResponse = await fetch(url);\n      if (basisResponse.ok) {\n        const basisArrayBuffer = await basisResponse.arrayBuffer();\n        return new BasisTexture(new Uint8Array(basisArrayBuffer));\n      }\n      throw new Error(`Failed to load Basis texture: ${url}`);\n    }\n    const preferredTranscodedFormat = [\n      "bc7-rgba-unorm",\n      "astc-4x4-unorm",\n      "etc2-rgba8unorm",\n      "bc3-rgba-unorm",\n      "rgba8unorm"\n    ];\n    async function load(url) {\n      const BasisTexture = await getBasis();\n      const basisTexture = await fetchBasisTexture(url, BasisTexture);\n      const levelBuffers = createLevelBuffers(basisTexture, basisTranscoderFormat);\n      return {\n        width: basisTexture.getImageWidth(0, 0),\n        height: basisTexture.getImageHeight(0, 0),\n        format: basisTranscodedTextureFormat,\n        resource: levelBuffers,\n        alphaMode: "no-premultiply-alpha"\n      };\n    }\n    async function init(jsUrl, wasmUrl, supportedTextures) {\n      if (jsUrl)\n        settings.jsUrl = jsUrl;\n      if (wasmUrl)\n        settings.wasmUrl = wasmUrl;\n      basisTranscodedTextureFormat = preferredTranscodedFormat.filter((format) => supportedTextures.includes(format))[0];\n      basisTranscoderFormat = gpuFormatToBasisTranscoderFormat(basisTranscodedTextureFormat);\n      await getBasis();\n    }\n    const messageHandlers = {\n      init: async (data) => {\n        const { jsUrl, wasmUrl, supportedTextures } = data;\n        await init(jsUrl, wasmUrl, supportedTextures);\n      },\n      load: async (data) => {\n        try {\n          const textureOptions = await load(data.url);\n          return {\n            type: "load",\n            url: data.url,\n            success: true,\n            textureOptions,\n            transferables: textureOptions.resource?.map((arr) => arr.buffer)\n          };\n        } catch (e) {\n          throw e;\n        }\n      }\n    };\n    self.onmessage = async (messageEvent) => {\n      const message = messageEvent.data;\n      const response = await messageHandlers[message.type](message);\n      if (response) {\n        self.postMessage(response, response.transferables);\n      }\n    };\n\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(LC)}};UC.revokeObjectURL=function(){LC&&(URL.revokeObjectURL(LC),LC=null)};const kC={jsUrl:"https://files.pixijs.download/transcoders/basis/basis_transcoder.js",wasmUrl:"https://files.pixijs.download/transcoders/basis/basis_transcoder.wasm"};let NC;const zC={};function GC(t,e){const n=function(t){return NC||(NC=(new UC).worker,NC.onmessage=t=>{const{success:e,url:n,textureOptions:i}=t.data;zC[n](i)},NC.postMessage({type:"init",jsUrl:kC.jsUrl,wasmUrl:kC.wasmUrl,supportedTextures:t})),NC}(e);return new Promise(e=>{zC[t]=e,n.postMessage({type:"load",url:t})})}const HC={extension:{type:fy.LoadParser,priority:l_.High,name:"loadBasis"},name:"loadBasis",test:t=>VE(t,[".basis"]),async load(t,e,n){const i=await FC(),r=await GC(t,i);return eC(new AC(r),n,t)},unload(t){Array.isArray(t)?t.forEach(t=>t.destroy(!0)):t.destroy(!0)}};const VC={"bc3-rgba-unorm":3,"bc7-rgba-unorm":6,"etc2-rgba8unorm":1,"astc-4x4-unorm":10,rgba8unorm:13,rgba4unorm:16};var XC=(t=>(t[t.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",t[t.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",t[t.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",t[t.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",t[t.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",t[t.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",t[t.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",t[t.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",t[t.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",t[t.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",t[t.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",t[t.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",t[t.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",t[t.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",t[t.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",t[t.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",t[t.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",t[t.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",t[t.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",t[t.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",t[t.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",t[t.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",t[t.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",t[t.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",t[t.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",t[t.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",t[t.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",t[t.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",t[t.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",t[t.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",t[t.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",t[t.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",t[t.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",t[t.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",t[t.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",t[t.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",t[t.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",t[t.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",t[t.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",t[t.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",t[t.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",t[t.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",t[t.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",t[t.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",t[t.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",t[t.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",t[t.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",t[t.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",t[t.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",t[t.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",t[t.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",t[t.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",t[t.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",t[t.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",t[t.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",t[t.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",t[t.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",t[t.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",t[t.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",t[t.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",t[t.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",t[t.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",t[t.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",t[t.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",t[t.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",t[t.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",t[t.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",t[t.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",t[t.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",t[t.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",t[t.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",t[t.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",t[t.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",t[t.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",t[t.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",t[t.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",t[t.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",t[t.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",t[t.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",t[t.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",t[t.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",t[t.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",t[t.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",t[t.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",t[t.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",t[t.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",t[t.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",t[t.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",t[t.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",t[t.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",t[t.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",t[t.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",t[t.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",t[t.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",t[t.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",t[t.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",t[t.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",t[t.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",t[t.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",t[t.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",t[t.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",t[t.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",t[t.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",t[t.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",t[t.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",t[t.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",t[t.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",t[t.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",t[t.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",t[t.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",t[t.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",t[t.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT",t))(XC||{}),WC=(t=>(t[t.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",t[t.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",t[t.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D",t))(WC||{});function jC(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}var YC,qC=((YC=qC||{})[YC.UNKNOWN=0]="UNKNOWN",YC[YC.R8G8B8=20]="R8G8B8",YC[YC.A8R8G8B8=21]="A8R8G8B8",YC[YC.X8R8G8B8=22]="X8R8G8B8",YC[YC.R5G6B5=23]="R5G6B5",YC[YC.X1R5G5B5=24]="X1R5G5B5",YC[YC.A1R5G5B5=25]="A1R5G5B5",YC[YC.A4R4G4B4=26]="A4R4G4B4",YC[YC.R3G3B2=27]="R3G3B2",YC[YC.A8=28]="A8",YC[YC.A8R3G3B2=29]="A8R3G3B2",YC[YC.X4R4G4B4=30]="X4R4G4B4",YC[YC.A2B10G10R10=31]="A2B10G10R10",YC[YC.A8B8G8R8=32]="A8B8G8R8",YC[YC.X8B8G8R8=33]="X8B8G8R8",YC[YC.G16R16=34]="G16R16",YC[YC.A2R10G10B10=35]="A2R10G10B10",YC[YC.A16B16G16R16=36]="A16B16G16R16",YC[YC.A8P8=40]="A8P8",YC[YC.P8=41]="P8",YC[YC.L8=50]="L8",YC[YC.A8L8=51]="A8L8",YC[YC.A4L4=52]="A4L4",YC[YC.V8U8=60]="V8U8",YC[YC.L6V5U5=61]="L6V5U5",YC[YC.X8L8V8U8=62]="X8L8V8U8",YC[YC.Q8W8V8U8=63]="Q8W8V8U8",YC[YC.V16U16=64]="V16U16",YC[YC.A2W10V10U10=67]="A2W10V10U10",YC[YC.Q16W16V16U16=110]="Q16W16V16U16",YC[YC.R16F=111]="R16F",YC[YC.G16R16F=112]="G16R16F",YC[YC.A16B16G16R16F=113]="A16B16G16R16F",YC[YC.R32F=114]="R32F",YC[YC.G32R32F=115]="G32R32F",YC[YC.A32B32G32R32F=116]="A32B32G32R32F",YC[YC.UYVY=jC("UYVY")]="UYVY",YC[YC.R8G8_B8G8=jC("RGBG")]="R8G8_B8G8",YC[YC.YUY2=jC("YUY2")]="YUY2",YC[YC.D3DFMT_G8R8_G8B8=jC("GRGB")]="D3DFMT_G8R8_G8B8",YC[YC.DXT1=jC("DXT1")]="DXT1",YC[YC.DXT2=jC("DXT2")]="DXT2",YC[YC.DXT3=jC("DXT3")]="DXT3",YC[YC.DXT4=jC("DXT4")]="DXT4",YC[YC.DXT5=jC("DXT5")]="DXT5",YC[YC.ATI1=jC("ATI1")]="ATI1",YC[YC.AT1N=jC("AT1N")]="AT1N",YC[YC.ATI2=jC("ATI2")]="ATI2",YC[YC.AT2N=jC("AT2N")]="AT2N",YC[YC.BC4U=jC("BC4U")]="BC4U",YC[YC.BC4S=jC("BC4S")]="BC4S",YC[YC.BC5U=jC("BC5U")]="BC5U",YC[YC.BC5S=jC("BC5S")]="BC5S",YC[YC.DX10=jC("DX10")]="DX10",YC);const KC={[qC.DXT1]:"bc1-rgba-unorm",[qC.DXT2]:"bc2-rgba-unorm",[qC.DXT3]:"bc2-rgba-unorm",[qC.DXT4]:"bc3-rgba-unorm",[qC.DXT5]:"bc3-rgba-unorm",[qC.ATI1]:"bc4-r-unorm",[qC.BC4U]:"bc4-r-unorm",[qC.BC4S]:"bc4-r-snorm",[qC.ATI2]:"bc5-rg-unorm",[qC.BC5U]:"bc5-rg-unorm",[qC.BC5S]:"bc5-rg-snorm",36:"rgba16uint",110:"rgba16sint",111:"r16float",112:"rg16float",113:"rgba16float",114:"r32float",115:"rg32float",116:"rgba32float"},JC={70:"bc1-rgba-unorm",71:"bc1-rgba-unorm",72:"bc1-rgba-unorm-srgb",73:"bc2-rgba-unorm",74:"bc2-rgba-unorm",75:"bc2-rgba-unorm-srgb",76:"bc3-rgba-unorm",77:"bc3-rgba-unorm",78:"bc3-rgba-unorm-srgb",79:"bc4-r-unorm",80:"bc4-r-unorm",81:"bc4-r-snorm",82:"bc5-rg-unorm",83:"bc5-rg-unorm",84:"bc5-rg-snorm",94:"bc6h-rgb-ufloat",95:"bc6h-rgb-ufloat",96:"bc6h-rgb-float",97:"bc7-rgba-unorm",98:"bc7-rgba-unorm",99:"bc7-rgba-unorm-srgb",28:"rgba8unorm",29:"rgba8unorm-srgb",87:"bgra8unorm",91:"bgra8unorm-srgb",41:"r32float",49:"rg8unorm",56:"r16uint",61:"r8unorm",24:"rgb10a2unorm",11:"rgba16uint",13:"rgba16sint",10:"rgba16float",54:"r16float",34:"rg16float",16:"rg32float",2:"rgba32float"},ZC={MAGIC_VALUE:542327876,MAGIC_SIZE:4,HEADER_SIZE:124,HEADER_DX10_SIZE:20,PIXEL_FORMAT_FLAGS:{ALPHAPIXELS:1,ALPHA:2,FOURCC:4,RGB:64,RGBA:65,YUV:512,LUMINANCE:131072,LUMINANCEA:131073},RESOURCE_MISC_TEXTURECUBE:4,HEADER_FIELDS:{MAGIC:0,SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19,PF_FLAGS:20,FOURCC:21,RGB_BITCOUNT:22,R_BIT_MASK:23,G_BIT_MASK:24,B_BIT_MASK:25,A_BIT_MASK:26},HEADER_DX10_FIELDS:{DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},DXGI_FORMAT:XC,D3D10_RESOURCE_DIMENSION:WC,D3DFMT:qC},QC={"bc1-rgba-unorm":8,"bc1-rgba-unorm-srgb":8,"bc2-rgba-unorm":16,"bc2-rgba-unorm-srgb":16,"bc3-rgba-unorm":16,"bc3-rgba-unorm-srgb":16,"bc4-r-unorm":8,"bc4-r-snorm":8,"bc5-rg-unorm":16,"bc5-rg-snorm":16,"bc6h-rgb-ufloat":16,"bc6h-rgb-float":16,"bc7-rgba-unorm":16,"bc7-rgba-unorm-srgb":16};function $C(t,e){const{format:n,fourCC:i,width:r,height:s,dataOffset:a,mipmapCount:o}=function(t){const e=new Uint32Array(t,0,ZC.HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT);if(e[ZC.HEADER_FIELDS.MAGIC]!==ZC.MAGIC_VALUE)throw new Error("Invalid magic number in DDS header");const n=e[ZC.HEADER_FIELDS.HEIGHT],i=e[ZC.HEADER_FIELDS.WIDTH],r=Math.max(1,e[ZC.HEADER_FIELDS.MIPMAP_COUNT]),s=e[ZC.HEADER_FIELDS.PF_FLAGS],a=e[ZC.HEADER_FIELDS.FOURCC],o=function(t,e,n,i){if(e&ZC.PIXEL_FORMAT_FLAGS.FOURCC){if(n===ZC.D3DFMT.DX10){const t=new Uint32Array(i,ZC.MAGIC_SIZE+ZC.HEADER_SIZE,ZC.HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT);if(t[ZC.HEADER_DX10_FIELDS.MISC_FLAG]===ZC.RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(t[ZC.HEADER_DX10_FIELDS.RESOURCE_DIMENSION]===ZC.D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSParser does not supported 3D texture data");const e=t[ZC.HEADER_DX10_FIELDS.DXGI_FORMAT];if(e in JC)return JC[e];throw new Error(`DDSParser cannot parse texture data with DXGI format ${e}`)}if(n in KC)return KC[n];throw new Error(`DDSParser cannot parse texture data with fourCC format ${n}`)}if(e&ZC.PIXEL_FORMAT_FLAGS.RGB||e&ZC.PIXEL_FORMAT_FLAGS.RGBA)return function(t){const e=t[ZC.HEADER_FIELDS.RGB_BITCOUNT],n=t[ZC.HEADER_FIELDS.R_BIT_MASK],i=t[ZC.HEADER_FIELDS.G_BIT_MASK],r=t[ZC.HEADER_FIELDS.B_BIT_MASK],s=t[ZC.HEADER_FIELDS.A_BIT_MASK];switch(e){case 32:if(255===n&&65280===i&&16711680===r&&4278190080===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_UNORM];if(16711680===n&&65280===i&&255===r&&4278190080===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_B8G8R8A8_UNORM];if(1072693248===n&&1047552===i&&1023===r&&3221225472===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_R10G10B10A2_UNORM];if(65535===n&&4294901760===i&&0===r&&0===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_R16G16_UNORM];if(4294967295===n&&0===i&&0===r&&0===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_R32_FLOAT];break;case 24:break;case 16:if(31744===n&&992===i&&31===r&&32768===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_B5G5R5A1_UNORM];if(63488===n&&2016===i&&31===r&&0===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_B5G6R5_UNORM];if(3840===n&&240===i&&15===r&&61440===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_B4G4R4A4_UNORM];if(255===n&&0===i&&0===r&&65280===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_R8G8_UNORM];if(65535===n&&0===i&&0===r&&0===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_R16_UNORM];break;case 8:if(255===n&&0===i&&0===r&&0===s)return JC[ZC.DXGI_FORMAT.DXGI_FORMAT_R8_UNORM]}throw new Error(`DDSParser does not support uncompressed texture with configuration:\n                bitCount = ${e}, rBitMask = ${n}, gBitMask = ${i}, aBitMask = ${s}`)}(t);if(e&ZC.PIXEL_FORMAT_FLAGS.YUV)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(e&ZC.PIXEL_FORMAT_FLAGS.LUMINANCE||e&ZC.PIXEL_FORMAT_FLAGS.LUMINANCEA)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(e&ZC.PIXEL_FORMAT_FLAGS.ALPHA||e&ZC.PIXEL_FORMAT_FLAGS.ALPHAPIXELS)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(e,s,a,t),l=ZC.MAGIC_SIZE+ZC.HEADER_SIZE+(a===ZC.D3DFMT.DX10?ZC.HEADER_DX10_SIZE:0);return{format:o,fourCC:a,width:i,height:n,dataOffset:l,mipmapCount:r}}(t);if(!e.includes(n))throw new Error(`Unsupported texture format: ${i} ${n}, supported: ${e}`);if(o<=1)return{format:n,width:r,height:s,resource:[new Uint8Array(t,a)],alphaMode:"no-premultiply-alpha"};const l=function(t,e,n,i,r,s){const a=[],o=QC[t];let l=e,h=n,c=i;for(let u=0;u<r;++u){const t=4*Math.ceil(Math.max(4,l)/4),e=4*Math.ceil(Math.max(4,h)/4),n=o?t/4*e/4*o:l*h*4,i=new Uint8Array(s,c,n);a.push(i),c+=n,l=Math.max(l>>1,1),h=Math.max(h>>1,1)}return a}(n,r,s,a,o,t);return{format:n,width:r,height:s,resource:l,alphaMode:"no-premultiply-alpha"}}const tP={extension:{type:fy.LoadParser,priority:l_.High,name:"loadDDS"},name:"loadDDS",test:t=>VE(t,[".dds"]),async load(t,e,n){const i=await FC(),r=await fetch(t),s=$C(await r.arrayBuffer(),i);return eC(new AC(s),n,t)},unload(t){Array.isArray(t)?t.forEach(t=>t.destroy(!0)):t.destroy(!0)}};var eP=(t=>(t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGBA=6408]="RGBA",t[t.RGBA8UI=36220]="RGBA8UI",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8=32856]="RGBA8",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t))(eP||{});const nP={FILE_HEADER_SIZE:64,FILE_IDENTIFIER:[171,75,84,88,32,49,49,187,13,10,26,10],FORMATS_TO_COMPONENTS:{6408:4,6407:3,33319:2,6403:1,6409:1,6410:2,6406:1},INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:{33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,36283:.5,36284:.5,36285:1,36286:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,37808:1,37840:1,37809:.8,37841:.8,37810:.64,37842:.64,37811:.53375,37843:.53375,37812:.445,37844:.445,37813:.4,37845:.4,37814:.33375,37846:.33375,37815:.25,37847:.25,37816:.32,37848:.32,37817:.26625,37849:.26625,37818:.2,37850:.2,37819:.16,37851:.16,37820:.13375,37852:.13375,37821:.11125,37853:.11125,36492:1,36493:1,36494:1,36495:1},INTERNAL_FORMAT_TO_TEXTURE_FORMATS:{33776:"bc1-rgba-unorm",33777:"bc1-rgba-unorm",33778:"bc2-rgba-unorm",33779:"bc3-rgba-unorm",35916:"bc1-rgba-unorm-srgb",35917:"bc1-rgba-unorm-srgb",35918:"bc2-rgba-unorm-srgb",35919:"bc3-rgba-unorm-srgb",36283:"bc4-r-unorm",36284:"bc4-r-snorm",36285:"bc5-rg-unorm",36286:"bc5-rg-snorm",37488:"eac-r11unorm",37490:"eac-rg11snorm",37492:"etc2-rgb8unorm",37496:"etc2-rgba8unorm",37493:"etc2-rgb8unorm-srgb",37497:"etc2-rgba8unorm-srgb",37494:"etc2-rgb8a1unorm",37495:"etc2-rgb8a1unorm-srgb",37808:"astc-4x4-unorm",37840:"astc-4x4-unorm-srgb",37809:"astc-5x4-unorm",37841:"astc-5x4-unorm-srgb",37810:"astc-5x5-unorm",37842:"astc-5x5-unorm-srgb",37811:"astc-6x5-unorm",37843:"astc-6x5-unorm-srgb",37812:"astc-6x6-unorm",37844:"astc-6x6-unorm-srgb",37813:"astc-8x5-unorm",37845:"astc-8x5-unorm-srgb",37814:"astc-8x6-unorm",37846:"astc-8x6-unorm-srgb",37815:"astc-8x8-unorm",37847:"astc-8x8-unorm-srgb",37816:"astc-10x5-unorm",37848:"astc-10x5-unorm-srgb",37817:"astc-10x6-unorm",37849:"astc-10x6-unorm-srgb",37818:"astc-10x8-unorm",37850:"astc-10x8-unorm-srgb",37819:"astc-10x10-unorm",37851:"astc-10x10-unorm-srgb",37820:"astc-12x10-unorm",37852:"astc-12x10-unorm-srgb",37821:"astc-12x12-unorm",37853:"astc-12x12-unorm-srgb",36492:"bc7-rgba-unorm",36493:"bc7-rgba-unorm-srgb",36494:"bc6h-rgb-float",36495:"bc6h-rgb-ufloat",35907:"rgba8unorm-srgb",36759:"rgba8snorm",36220:"rgba8uint",36238:"rgba8sint",6408:"rgba8unorm"},FIELDS:{FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},TYPES_TO_BYTES_PER_COMPONENT:{5121:1,5123:2,5124:4,5125:4,5126:4,36193:8},TYPES_TO_BYTES_PER_PIXEL:{32819:2,32820:2,33635:2},ENDIANNESS:67305985};function iP(t,e){const n=new DataView(t);if(!function(t){for(let e=0;e<nP.FILE_IDENTIFIER.length;e++)if(t.getUint8(e)!==nP.FILE_IDENTIFIER[e])return!1;return!0}(n))throw new Error("Invalid KTX identifier in header");const{littleEndian:i,glType:r,glFormat:s,glInternalFormat:a,pixelWidth:o,pixelHeight:l,numberOfMipmapLevels:h,offset:c}=function(t){const e=t.getUint32(nP.FIELDS.ENDIANNESS,!0)===nP.ENDIANNESS,n=t.getUint32(nP.FIELDS.GL_TYPE,e),i=t.getUint32(nP.FIELDS.GL_FORMAT,e),r=t.getUint32(nP.FIELDS.GL_INTERNAL_FORMAT,e),s=t.getUint32(nP.FIELDS.PIXEL_WIDTH,e),a=t.getUint32(nP.FIELDS.PIXEL_HEIGHT,e)||1,o=t.getUint32(nP.FIELDS.PIXEL_DEPTH,e)||1,l=t.getUint32(nP.FIELDS.NUMBER_OF_ARRAY_ELEMENTS,e)||1,h=t.getUint32(nP.FIELDS.NUMBER_OF_FACES,e),c=t.getUint32(nP.FIELDS.NUMBER_OF_MIPMAP_LEVELS,e),u=t.getUint32(nP.FIELDS.BYTES_OF_KEY_VALUE_DATA,e);if(0===a||1!==o)throw new Error("Only 2D textures are supported");if(1!==h)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==l)throw new Error("WebGL does not support array textures");return{littleEndian:e,glType:n,glFormat:i,glInternalFormat:r,pixelWidth:s,pixelHeight:a,numberOfMipmapLevels:c,offset:nP.FILE_HEADER_SIZE+u}}(n),u=nP.INTERNAL_FORMAT_TO_TEXTURE_FORMATS[a];if(!u)throw new Error(`Unknown texture format ${a}`);if(!e.includes(u))throw new Error(`Unsupported texture format: ${u}, supportedFormats: ${e}`);const d=function(t,e,n){let i=nP.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[n];0!==t&&(i=nP.TYPES_TO_BYTES_PER_COMPONENT[t]?nP.TYPES_TO_BYTES_PER_COMPONENT[t]*nP.FORMATS_TO_COMPONENTS[e]:nP.TYPES_TO_BYTES_PER_PIXEL[t]);if(void 0===i)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");return i}(r,s,a),p=function(t,e,n,i,r,s,a,o){const l=i+3&-4,h=r+3&-4;let c=i*r;0===e&&(c=l*h);let u=c*n,d=i,p=r,f=l,m=h,g=s;const v=new Array(a);for(let y=0;y<a;y++){const e=t.getUint32(g,o);let i=g+4;v[y]=new Uint8Array(t.buffer,i,u),i+=u,g+=e+4,g=g%4!=0?g+4-g%4:g,d=d>>1||1,p=p>>1||1,f=d+4-1&-4,m=p+4-1&-4,u=f*m*n}return v}(n,r,d,o,l,c,h,i);return{format:u,width:o,height:l,resource:p,alphaMode:"no-premultiply-alpha"}}const rP={extension:{type:fy.LoadParser,priority:l_.High,name:"loadKTX"},name:"loadKTX",test:t=>VE(t,".ktx"),async load(t,e,n){const i=await FC(),r=await fetch(t),s=iP(await r.arrayBuffer(),i);return eC(new AC(s),n,t)},unload(t){Array.isArray(t)?t.forEach(t=>t.destroy(!0)):t.destroy(!0)}};let sP=null;class aP{constructor(){sP||(sP=URL.createObjectURL(new Blob(['(function () {\n    \'use strict\';\n\n    const converters = {\n      rgb8unorm: {\n        convertedFormat: "rgba8unorm",\n        convertFunction: convertRGBtoRGBA\n      },\n      "rgb8unorm-srgb": {\n        convertedFormat: "rgba8unorm-srgb",\n        convertFunction: convertRGBtoRGBA\n      }\n    };\n    function convertFormatIfRequired(textureOptions) {\n      const format = textureOptions.format;\n      if (converters[format]) {\n        const convertFunction = converters[format].convertFunction;\n        const levelBuffers = textureOptions.resource;\n        for (let i = 0; i < levelBuffers.length; i++) {\n          levelBuffers[i] = convertFunction(levelBuffers[i]);\n        }\n        textureOptions.format = converters[format].convertedFormat;\n      }\n    }\n    function convertRGBtoRGBA(levelBuffer) {\n      const pixelCount = levelBuffer.byteLength / 3;\n      const levelBufferWithAlpha = new Uint32Array(pixelCount);\n      for (let i = 0; i < pixelCount; ++i) {\n        levelBufferWithAlpha[i] = levelBuffer[i * 3] + (levelBuffer[i * 3 + 1] << 8) + (levelBuffer[i * 3 + 2] << 16) + 4278190080;\n      }\n      return new Uint8Array(levelBufferWithAlpha.buffer);\n    }\n\n    function createLevelBuffersFromKTX(ktxTexture) {\n      const levelBuffers = [];\n      for (let i = 0; i < ktxTexture.numLevels; i++) {\n        const imageData = ktxTexture.getImageData(i, 0, 0);\n        const levelBuffer = new Uint8Array(imageData.byteLength);\n        levelBuffer.set(imageData);\n        levelBuffers.push(levelBuffer);\n      }\n      return levelBuffers;\n    }\n\n    const glFormatToGPUFormatMap = {\n      6408: "rgba8unorm",\n      32856: "bgra8unorm",\n      //\n      32857: "rgb10a2unorm",\n      33189: "depth16unorm",\n      33190: "depth24plus",\n      33321: "r8unorm",\n      33323: "rg8unorm",\n      33325: "r16float",\n      33326: "r32float",\n      33327: "rg16float",\n      33328: "rg32float",\n      33329: "r8sint",\n      33330: "r8uint",\n      33331: "r16sint",\n      33332: "r16uint",\n      33333: "r32sint",\n      33334: "r32uint",\n      33335: "rg8sint",\n      33336: "rg8uint",\n      33337: "rg16sint",\n      33338: "rg16uint",\n      33339: "rg32sint",\n      33340: "rg32uint",\n      33778: "bc2-rgba-unorm",\n      33779: "bc3-rgba-unorm",\n      34836: "rgba32float",\n      34842: "rgba16float",\n      35056: "depth24plus-stencil8",\n      35898: "rg11b10ufloat",\n      35901: "rgb9e5ufloat",\n      35907: "rgba8unorm-srgb",\n      // bgra8unorm-srgb\n      36012: "depth32float",\n      36013: "depth32float-stencil8",\n      36168: "stencil8",\n      36208: "rgba32uint",\n      36214: "rgba16uint",\n      36220: "rgba8uint",\n      36226: "rgba32sint",\n      36232: "rgba16sint",\n      36238: "rgba8sint",\n      36492: "bc7-rgba-unorm",\n      36756: "r8snorm",\n      36757: "rg8snorm",\n      36759: "rgba8snorm",\n      37496: "etc2-rgba8unorm",\n      37808: "astc-4x4-unorm"\n    };\n    function glFormatToGPUFormat(glInternalFormat) {\n      const format = glFormatToGPUFormatMap[glInternalFormat];\n      if (format) {\n        return format;\n      }\n      throw new Error(`Unsupported glInternalFormat: ${glInternalFormat}`);\n    }\n\n    const vkFormatToGPUFormatMap = {\n      23: "rgb8unorm",\n      // VK_FORMAT_R8G8B8_UNORM\n      37: "rgba8unorm",\n      // VK_FORMAT_R8G8B8A8_UNORM\n      43: "rgba8unorm-srgb"\n      // VK_FORMAT_R8G8B8A8_SRGB\n      // TODO add more!\n    };\n    function vkFormatToGPUFormat(vkFormat) {\n      const format = vkFormatToGPUFormatMap[vkFormat];\n      if (format) {\n        return format;\n      }\n      throw new Error(`Unsupported VkFormat: ${vkFormat}`);\n    }\n\n    function getTextureFormatFromKTXTexture(ktxTexture) {\n      if (ktxTexture.classId === 2) {\n        return vkFormatToGPUFormat(ktxTexture.vkFormat);\n      }\n      return glFormatToGPUFormat(ktxTexture.glInternalformat);\n    }\n\n    const gpuFormatToBasisTranscoderFormatMap = {\n      "bc3-rgba-unorm": "BC3_RGBA",\n      "bc7-rgba-unorm": "BC7_M5_RGBA",\n      "etc2-rgba8unorm": "ETC2_RGBA",\n      "astc-4x4-unorm": "ASTC_4x4_RGBA",\n      // Uncompressed\n      rgba8unorm: "RGBA32",\n      rg11b10ufloat: "R11F_G11F_B10F"\n    };\n    function gpuFormatToKTXBasisTranscoderFormat(transcoderFormat) {\n      const format = gpuFormatToBasisTranscoderFormatMap[transcoderFormat];\n      if (format) {\n        return format;\n      }\n      throw new Error(`Unsupported transcoderFormat: ${transcoderFormat}`);\n    }\n\n    const settings = {\n      jsUrl: "",\n      wasmUrl: ""\n    };\n    let basisTranscoderFormat;\n    let basisTranscodedTextureFormat;\n    let ktxPromise;\n    async function getKTX() {\n      if (!ktxPromise) {\n        const absoluteJsUrl = new URL(settings.jsUrl, location.origin).href;\n        const absoluteWasmUrl = new URL(settings.wasmUrl, location.origin).href;\n        importScripts(absoluteJsUrl);\n        ktxPromise = new Promise((resolve) => {\n          LIBKTX({\n            locateFile: (_file) => absoluteWasmUrl\n          }).then((libktx) => {\n            resolve(libktx);\n          });\n        });\n      }\n      return ktxPromise;\n    }\n    async function fetchKTXTexture(url, ktx) {\n      const ktx2Response = await fetch(url);\n      if (ktx2Response.ok) {\n        const ktx2ArrayBuffer = await ktx2Response.arrayBuffer();\n        return new ktx.ktxTexture(new Uint8Array(ktx2ArrayBuffer));\n      }\n      throw new Error(`Failed to load KTX(2) texture: ${url}`);\n    }\n    const preferredTranscodedFormat = [\n      "bc7-rgba-unorm",\n      "astc-4x4-unorm",\n      "etc2-rgba8unorm",\n      "bc3-rgba-unorm",\n      "rgba8unorm"\n    ];\n    async function load(url) {\n      const ktx = await getKTX();\n      const ktxTexture = await fetchKTXTexture(url, ktx);\n      let format;\n      if (ktxTexture.needsTranscoding) {\n        format = basisTranscodedTextureFormat;\n        const transcodeFormat = ktx.TranscodeTarget[basisTranscoderFormat];\n        const result = ktxTexture.transcodeBasis(transcodeFormat, 0);\n        if (result !== ktx.ErrorCode.SUCCESS) {\n          throw new Error("Unable to transcode basis texture.");\n        }\n      } else {\n        format = getTextureFormatFromKTXTexture(ktxTexture);\n      }\n      const levelBuffers = createLevelBuffersFromKTX(ktxTexture);\n      const textureOptions = {\n        width: ktxTexture.baseWidth,\n        height: ktxTexture.baseHeight,\n        format,\n        mipLevelCount: ktxTexture.numLevels,\n        resource: levelBuffers,\n        alphaMode: "no-premultiply-alpha"\n      };\n      convertFormatIfRequired(textureOptions);\n      return textureOptions;\n    }\n    async function init(jsUrl, wasmUrl, supportedTextures) {\n      if (jsUrl)\n        settings.jsUrl = jsUrl;\n      if (wasmUrl)\n        settings.wasmUrl = wasmUrl;\n      basisTranscodedTextureFormat = preferredTranscodedFormat.filter((format) => supportedTextures.includes(format))[0];\n      basisTranscoderFormat = gpuFormatToKTXBasisTranscoderFormat(basisTranscodedTextureFormat);\n      await getKTX();\n    }\n    const messageHandlers = {\n      init: async (data) => {\n        const { jsUrl, wasmUrl, supportedTextures } = data;\n        await init(jsUrl, wasmUrl, supportedTextures);\n      },\n      load: async (data) => {\n        try {\n          const textureOptions = await load(data.url);\n          return {\n            type: "load",\n            url: data.url,\n            success: true,\n            textureOptions,\n            transferables: textureOptions.resource?.map((arr) => arr.buffer)\n          };\n        } catch (e) {\n          throw e;\n        }\n      }\n    };\n    self.onmessage = async (messageEvent) => {\n      const message = messageEvent.data;\n      const response = await messageHandlers[message.type]?.(message);\n      if (response) {\n        self.postMessage(response, response.transferables);\n      }\n    };\n\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(sP)}}aP.revokeObjectURL=function(){sP&&(URL.revokeObjectURL(sP),sP=null)};const oP={jsUrl:"https://files.pixijs.download/transcoders/ktx/libktx.js",wasmUrl:"https://files.pixijs.download/transcoders/ktx/libktx.wasm"};let lP;const hP={};function cP(t,e){const n=function(t){return lP||(lP=(new aP).worker,lP.onmessage=t=>{const{success:e,url:n,textureOptions:i}=t.data;hP[n](i)},lP.postMessage({type:"init",jsUrl:oP.jsUrl,wasmUrl:oP.wasmUrl,supportedTextures:t})),lP}(e);return new Promise(e=>{hP[t]=e,n.postMessage({type:"load",url:t})})}const uP={extension:{type:fy.LoadParser,priority:l_.High,name:"loadKTX2"},name:"loadKTX2",test:t=>VE(t,".ktx2"),async load(t,e,n){const i=await FC(),r=await cP(t,i);return eC(new AC(r),n,t)},async unload(t){Array.isArray(t)?t.forEach(t=>t.destroy(!0)):t.destroy(!0)}},dP={rgb8unorm:{convertedFormat:"rgba8unorm",convertFunction:pP},"rgb8unorm-srgb":{convertedFormat:"rgba8unorm-srgb",convertFunction:pP}};function pP(t){const e=t.byteLength/3,n=new Uint32Array(e);for(let i=0;i<e;++i)n[i]=t[3*i]+(t[3*i+1]<<8)+(t[3*i+2]<<16)+4278190080;return new Uint8Array(n.buffer)}const fP={6408:"rgba8unorm",32856:"bgra8unorm",32857:"rgb10a2unorm",33189:"depth16unorm",33190:"depth24plus",33321:"r8unorm",33323:"rg8unorm",33325:"r16float",33326:"r32float",33327:"rg16float",33328:"rg32float",33329:"r8sint",33330:"r8uint",33331:"r16sint",33332:"r16uint",33333:"r32sint",33334:"r32uint",33335:"rg8sint",33336:"rg8uint",33337:"rg16sint",33338:"rg16uint",33339:"rg32sint",33340:"rg32uint",33778:"bc2-rgba-unorm",33779:"bc3-rgba-unorm",34836:"rgba32float",34842:"rgba16float",35056:"depth24plus-stencil8",35898:"rg11b10ufloat",35901:"rgb9e5ufloat",35907:"rgba8unorm-srgb",36012:"depth32float",36013:"depth32float-stencil8",36168:"stencil8",36208:"rgba32uint",36214:"rgba16uint",36220:"rgba8uint",36226:"rgba32sint",36232:"rgba16sint",36238:"rgba8sint",36492:"bc7-rgba-unorm",36756:"r8snorm",36757:"rg8snorm",36759:"rgba8snorm",37496:"etc2-rgba8unorm",37808:"astc-4x4-unorm"};function mP(t){const e=fP[t];if(e)return e;throw new Error(`Unsupported glInternalFormat: ${t}`)}const gP={23:"rgb8unorm",37:"rgba8unorm",43:"rgba8unorm-srgb"};function vP(t){const e=gP[t];if(e)return e;throw new Error(`Unsupported VkFormat: ${t}`)}const yP={"bc3-rgba-unorm":"BC3_RGBA","bc7-rgba-unorm":"BC7_M5_RGBA","etc2-rgba8unorm":"ETC2_RGBA","astc-4x4-unorm":"ASTC_4x4_RGBA",rgba8unorm:"RGBA32",rg11b10ufloat:"R11F_G11F_B10F"};const xP=["basis","bc7","bc6h","astc","etc2","bc5","bc4","bc3","bc2","bc1","eac"],bP={extension:fy.ResolveParser,test:t=>VE(t,[".ktx",".ktx2",".dds"]),parse:t=>{var e;let n;const i=t.split(".");if(i.length>2){const t=i[i.length-2];xP.includes(t)&&(n=t)}else n=i[i.length-1];return{resolution:parseFloat((null==(e=m_.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:n,src:t}}};let _P;const SP={extension:{type:fy.DetectionParser,priority:2},test:async()=>!!(await jw())||!!Ww(),add:async t=>{const e=await OC();return _P=function(t){const e=["basis"],n={};return t.forEach(t=>{const i=t.split("-")[0];i&&!n[i]&&(n[i]=!0,e.push(i))}),e.sort((t,e)=>{const n=xP.indexOf(t),i=xP.indexOf(e);return-1===n?1:-1===i?-1:n-i}),e}(e),[..._P,...t]},remove:async t=>_P?t.filter(t=>!(t in _P)):t};const wP=new cx,TP=class{cull(t,e,n=!0){this._cullRecursive(t,e,n)}_cullRecursive(t,e,n=!0){if(t.cullable&&t.measurable&&t.includeInBuild){const i=t.cullArea??ab(t,n,wP);t.culled=i.x>=e.x+e.width||i.y>=e.y+e.height||i.x+i.width<=e.x||i.y+i.height<=e.y}else t.culled=!1;if(t.cullableChildren&&!t.culled&&t.renderable&&t.measurable&&t.includeInBuild)for(let i=0;i<t.children.length;i++)this._cullRecursive(t.children[i],e,n)}};TP.shared=new TP;let MP=TP;class AP{static init(){this._renderRef=this.render.bind(this),this.render=()=>{MP.shared.cull(this.stage,this.renderer.screen),this.renderer.render({container:this.stage})}}static destroy(){this.render=this._renderRef}}AP.extension={priority:10,type:fy.Application,name:"culler"};class EP{constructor(t){this._attachedDomElements=[],this._renderer=t,this._renderer.runners.postrender.add(this),this._domElement=document.createElement("div"),this._domElement.style.position="absolute",this._domElement.style.top="0",this._domElement.style.left="0",this._domElement.style.pointerEvents="none",this._domElement.style.zIndex="1000"}addRenderable(t,e){this._attachedDomElements.includes(t)||this._attachedDomElements.push(t)}updateRenderable(t){}validateRenderable(t){return!0}postrender(){var t;const e=this._attachedDomElements;if(0===e.length)return void this._domElement.remove();const n=this._renderer.view.canvas;this._domElement.parentNode!==n.parentNode&&(null==(t=n.parentNode)||t.appendChild(this._domElement));const i=parseFloat(n.style.width)/n.width*this._renderer.resolution,r=parseFloat(n.style.height)/n.height*this._renderer.resolution;this._domElement.style.transform=`translate(${n.offsetLeft}px, ${n.offsetTop}px) scale(${i}, ${r})`;for(let s=0;s<e.length;s++){const t=e[s],n=t.element;if(!t.parent||t.globalDisplayStatus<7)null==n||n.remove(),e.splice(s,1),s--;else{this._domElement.contains(n)||(n.style.position="absolute",n.style.pointerEvents="auto",this._domElement.appendChild(n));const e=t.worldTransform,i=t._anchor,r=t.width*i.x,s=t.height*i.y;n.style.transformOrigin=`${r}px ${s}px`,n.style.transform=`matrix(${e.a}, ${e.b}, ${e.c}, ${e.d}, ${e.tx-r}, ${e.ty-s})`,n.style.opacity=t.groupAlpha.toString()}}}destroy(){var t;this._renderer.runners.postrender.remove(this);for(let e=0;e<this._attachedDomElements.length;e++){null==(t=this._attachedDomElements[e].element)||t.remove()}this._attachedDomElements.length=0,this._domElement.remove(),this._renderer=null}}EP.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"dom"};var CP={},PP={};function RP(t,e){return void 0===e&&(e=Object),e&&"function"==typeof e.freeze?e.freeze(t):t}var IP=RP({HTML:"text/html",isHTML:function(t){return t===IP.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),OP=RP({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(t){return t===OP.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});PP.assign=function(t,e){if(null===t||"object"!=typeof t)throw new TypeError("target is not an object");for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},PP.find=function(t,e,n){if(void 0===n&&(n=Array.prototype),t&&"function"==typeof n.find)return n.find.call(t,e);for(var i=0;i<t.length;i++)if(Object.prototype.hasOwnProperty.call(t,i)){var r=t[i];if(e.call(void 0,r,i,t))return r}},PP.freeze=RP,PP.MIME_TYPE=IP,PP.NAMESPACE=OP;var DP=PP,BP=DP.find,FP=DP.NAMESPACE;function LP(t){return""!==t}function UP(t,e){return t.hasOwnProperty(e)||(t[e]=!0),t}function kP(t){if(!t)return[];var e=function(t){return t?t.split(/[\t\n\f\r ]+/).filter(LP):[]}(t);return Object.keys(e.reduce(UP,{}))}function NP(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}function zP(t,e){var n=t.prototype;if(!(n instanceof e)){let i=function(){};i.prototype=e.prototype,i=new i,NP(n,i),t.prototype=n=i}n.constructor!=t&&(n.constructor=t)}var GP={},HP=GP.ELEMENT_NODE=1,VP=GP.ATTRIBUTE_NODE=2,XP=GP.TEXT_NODE=3,WP=GP.CDATA_SECTION_NODE=4,jP=GP.ENTITY_REFERENCE_NODE=5,YP=GP.ENTITY_NODE=6,qP=GP.PROCESSING_INSTRUCTION_NODE=7,KP=GP.COMMENT_NODE=8,JP=GP.DOCUMENT_NODE=9,ZP=GP.DOCUMENT_TYPE_NODE=10,QP=GP.DOCUMENT_FRAGMENT_NODE=11,$P=GP.NOTATION_NODE=12,tR={},eR={};tR.INDEX_SIZE_ERR=(eR[1]="Index size error",1),tR.DOMSTRING_SIZE_ERR=(eR[2]="DOMString size error",2);var nR=tR.HIERARCHY_REQUEST_ERR=(eR[3]="Hierarchy request error",3);tR.WRONG_DOCUMENT_ERR=(eR[4]="Wrong document",4),tR.INVALID_CHARACTER_ERR=(eR[5]="Invalid character",5),tR.NO_DATA_ALLOWED_ERR=(eR[6]="No data allowed",6),tR.NO_MODIFICATION_ALLOWED_ERR=(eR[7]="No modification allowed",7);var iR=tR.NOT_FOUND_ERR=(eR[8]="Not found",8);tR.NOT_SUPPORTED_ERR=(eR[9]="Not supported",9);var rR=tR.INUSE_ATTRIBUTE_ERR=(eR[10]="Attribute in use",10);function sR(t,e){if(e instanceof Error)var n=e;else n=this,Error.call(this,eR[t]),this.message=eR[t],Error.captureStackTrace&&Error.captureStackTrace(this,sR);return n.code=t,e&&(this.message=this.message+": "+e),n}function aR(){}function oR(t,e){this._node=t,this._refresh=e,lR(this)}function lR(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!==e){var n=t._refresh(t._node);if(KR(t,"length",n.length),!t.$$length||n.length<t.$$length)for(var i=n.length;i in t;i++)Object.prototype.hasOwnProperty.call(t,i)&&delete t[i];NP(n,t),t._inc=e}}function hR(){}function cR(t,e){for(var n=t.length;n--;)if(t[n]===e)return n}function uR(t,e,n,i){if(i?e[cR(e,i)]=n:e[e.length++]=n,t){n.ownerElement=t;var r=t.ownerDocument;r&&(i&&yR(r,t,i),function(t,e,n){t&&t._inc++;var i=n.namespaceURI;i===FP.XMLNS&&(e._nsMap[n.prefix?n.localName:""]=n.value)}(r,t,n))}}function dR(t,e,n){var i=cR(e,n);if(!(i>=0))throw new sR(iR,new Error(t.tagName+"@"+n));for(var r=e.length-1;i<r;)e[i]=e[++i];if(e.length=r,t){var s=t.ownerDocument;s&&(yR(s,t,n),n.ownerElement=null)}}function pR(){}function fR(){}function mR(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function gR(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(gR(t,e))return!0}while(t=t.nextSibling)}function vR(){this.ownerDocument=this}function yR(t,e,n,i){t&&t._inc++,n.namespaceURI===FP.XMLNS&&delete e._nsMap[n.prefix?n.localName:""]}function xR(t,e,n){if(t&&t._inc){t._inc++;var i=e.childNodes;if(n)i[i.length++]=n;else{for(var r=e.firstChild,s=0;r;)i[s++]=r,r=r.nextSibling;i.length=s,delete i[i.length]}}}function bR(t,e){var n=e.previousSibling,i=e.nextSibling;return n?n.nextSibling=i:t.firstChild=i,i?i.previousSibling=n:t.lastChild=n,e.parentNode=null,e.previousSibling=null,e.nextSibling=null,xR(t.ownerDocument,t),e}function _R(t){return t&&t.nodeType===fR.DOCUMENT_TYPE_NODE}function SR(t){return t&&t.nodeType===fR.ELEMENT_NODE}function wR(t){return t&&t.nodeType===fR.TEXT_NODE}function TR(t,e){var n=t.childNodes||[];if(BP(n,SR)||_R(e))return!1;var i=BP(n,_R);return!(e&&i&&n.indexOf(i)>n.indexOf(e))}function MR(t,e){var n=t.childNodes||[];if(BP(n,function(t){return SR(t)&&t!==e}))return!1;var i=BP(n,_R);return!(e&&i&&n.indexOf(i)>n.indexOf(e))}function AR(t,e,n){if(!function(t){return t&&(t.nodeType===fR.DOCUMENT_NODE||t.nodeType===fR.DOCUMENT_FRAGMENT_NODE||t.nodeType===fR.ELEMENT_NODE)}(t))throw new sR(nR,"Unexpected parent node type "+t.nodeType);if(n&&n.parentNode!==t)throw new sR(iR,"child not in parent");if(!function(t){return t&&(SR(t)||wR(t)||_R(t)||t.nodeType===fR.DOCUMENT_FRAGMENT_NODE||t.nodeType===fR.COMMENT_NODE||t.nodeType===fR.PROCESSING_INSTRUCTION_NODE)}(e)||_R(e)&&t.nodeType!==fR.DOCUMENT_NODE)throw new sR(nR,"Unexpected node type "+e.nodeType+" for parent node type "+t.nodeType)}function ER(t,e,n){var i=t.childNodes||[],r=e.childNodes||[];if(e.nodeType===fR.DOCUMENT_FRAGMENT_NODE){var s=r.filter(SR);if(s.length>1||BP(r,wR))throw new sR(nR,"More than one element or text in fragment");if(1===s.length&&!TR(t,n))throw new sR(nR,"Element in fragment can not be inserted before doctype")}if(SR(e)&&!TR(t,n))throw new sR(nR,"Only one element can be added and only after doctype");if(_R(e)){if(BP(i,_R))throw new sR(nR,"Only one doctype is allowed");var a=BP(i,SR);if(n&&i.indexOf(a)<i.indexOf(n))throw new sR(nR,"Doctype can only be inserted before an element");if(!n&&a)throw new sR(nR,"Doctype can not be appended since element is present")}}function CR(t,e,n){var i=t.childNodes||[],r=e.childNodes||[];if(e.nodeType===fR.DOCUMENT_FRAGMENT_NODE){var s=r.filter(SR);if(s.length>1||BP(r,wR))throw new sR(nR,"More than one element or text in fragment");if(1===s.length&&!MR(t,n))throw new sR(nR,"Element in fragment can not be inserted before doctype")}if(SR(e)&&!MR(t,n))throw new sR(nR,"Only one element can be added and only after doctype");if(_R(e)){if(BP(i,function(t){return _R(t)&&t!==n}))throw new sR(nR,"Only one doctype is allowed");var a=BP(i,SR);if(n&&i.indexOf(a)<i.indexOf(n))throw new sR(nR,"Doctype can only be inserted before an element")}}function PR(t,e,n,i){AR(t,e,n),t.nodeType===fR.DOCUMENT_NODE&&(i||ER)(t,e,n);var r=e.parentNode;if(r&&r.removeChild(e),e.nodeType===QP){var s=e.firstChild;if(null==s)return e;var a=e.lastChild}else s=a=e;var o=n?n.previousSibling:t.lastChild;s.previousSibling=o,a.nextSibling=n,o?o.nextSibling=s:t.firstChild=s,null==n?t.lastChild=a:n.previousSibling=a;do{s.parentNode=t}while(s!==a&&(s=s.nextSibling));return xR(t.ownerDocument||t,t),e.nodeType==QP&&(e.firstChild=e.lastChild=null),e}function RR(){this._nsMap={}}function IR(){}function OR(){}function DR(){}function BR(){}function FR(){}function LR(){}function UR(){}function kR(){}function NR(){}function zR(){}function GR(){}function HR(){}function VR(t,e){var n=[],i=9==this.nodeType&&this.documentElement||this,r=i.prefix,s=i.namespaceURI;if(s&&null==r&&null==(r=i.lookupPrefix(s)))var a=[{namespace:s,prefix:null}];return jR(this,n,t,e,a),n.join("")}function XR(t,e,n){var i=t.prefix||"",r=t.namespaceURI;if(!r)return!1;if("xml"===i&&r===FP.XML||r===FP.XMLNS)return!1;for(var s=n.length;s--;){var a=n[s];if(a.prefix===i)return a.namespace!==r}return!0}function WR(t,e,n){t.push(" ",e,'="',n.replace(/[<>&"\t\n\r]/g,mR),'"')}function jR(t,e,n,i,r){if(r||(r=[]),i){if(!(t=i(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case HP:var s=t.attributes,a=s.length,o=t.firstChild,l=t.tagName,h=l;if(!(n=FP.isHTML(t.namespaceURI)||n)&&!t.prefix&&t.namespaceURI){for(var c,u=0;u<s.length;u++)if("xmlns"===s.item(u).name){c=s.item(u).value;break}if(!c)for(var d=r.length-1;d>=0;d--){if(""===(p=r[d]).prefix&&p.namespace===t.namespaceURI){c=p.namespace;break}}if(c!==t.namespaceURI)for(d=r.length-1;d>=0;d--){var p;if((p=r[d]).namespace===t.namespaceURI){p.prefix&&(h=p.prefix+":"+l);break}}}e.push("<",h);for(var f=0;f<a;f++){"xmlns"==(m=s.item(f)).prefix?r.push({prefix:m.localName,namespace:m.value}):"xmlns"==m.nodeName&&r.push({prefix:"",namespace:m.value})}for(f=0;f<a;f++){var m,g,v;if(XR(m=s.item(f),0,r))WR(e,(g=m.prefix||"")?"xmlns:"+g:"xmlns",v=m.namespaceURI),r.push({prefix:g,namespace:v});jR(m,e,n,i,r)}if(l===h&&XR(t,0,r))WR(e,(g=t.prefix||"")?"xmlns:"+g:"xmlns",v=t.namespaceURI),r.push({prefix:g,namespace:v});if(o||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(e.push(">"),n&&/^script$/i.test(l))for(;o;)o.data?e.push(o.data):jR(o,e,n,i,r.slice()),o=o.nextSibling;else for(;o;)jR(o,e,n,i,r.slice()),o=o.nextSibling;e.push("</",h,">")}else e.push("/>");return;case JP:case QP:for(o=t.firstChild;o;)jR(o,e,n,i,r.slice()),o=o.nextSibling;return;case VP:return WR(e,t.name,t.value);case XP:return e.push(t.data.replace(/[<&>]/g,mR));case WP:return e.push("<![CDATA[",t.data,"]]>");case KP:return e.push("\x3c!--",t.data,"--\x3e");case ZP:var y=t.publicId,x=t.systemId;if(e.push("<!DOCTYPE ",t.name),y)e.push(" PUBLIC ",y),x&&"."!=x&&e.push(" ",x),e.push(">");else if(x&&"."!=x)e.push(" SYSTEM ",x,">");else{var b=t.internalSubset;b&&e.push(" [",b,"]"),e.push(">")}return;case qP:return e.push("<?",t.target," ",t.data,"?>");case jP:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function YR(t,e,n){var i;switch(e.nodeType){case HP:(i=e.cloneNode(!1)).ownerDocument=t;case QP:break;case VP:n=!0}if(i||(i=e.cloneNode(!1)),i.ownerDocument=t,i.parentNode=null,n)for(var r=e.firstChild;r;)i.appendChild(YR(t,r,n)),r=r.nextSibling;return i}function qR(t,e,n){var i=new e.constructor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=e[r];"object"!=typeof s&&s!=i[r]&&(i[r]=s)}switch(e.childNodes&&(i.childNodes=new aR),i.ownerDocument=t,i.nodeType){case HP:var a=e.attributes,o=i.attributes=new hR,l=a.length;o._ownerElement=i;for(var h=0;h<l;h++)i.setAttributeNode(qR(t,a.item(h),!0));break;case VP:n=!0}if(n)for(var c=e.firstChild;c;)i.appendChild(qR(t,c,n)),c=c.nextSibling;return i}function KR(t,e,n){t[e]=n}tR.INVALID_STATE_ERR=(eR[11]="Invalid state",11),tR.SYNTAX_ERR=(eR[12]="Syntax error",12),tR.INVALID_MODIFICATION_ERR=(eR[13]="Invalid modification",13),tR.NAMESPACE_ERR=(eR[14]="Invalid namespace",14),tR.INVALID_ACCESS_ERR=(eR[15]="Invalid access",15),sR.prototype=Error.prototype,NP(tR,sR),aR.prototype={length:0,item:function(t){return t>=0&&t<this.length?this[t]:null},toString:function(t,e){for(var n=[],i=0;i<this.length;i++)jR(this[i],n,t,e);return n.join("")},filter:function(t){return Array.prototype.filter.call(this,t)},indexOf:function(t){return Array.prototype.indexOf.call(this,t)}},oR.prototype.item=function(t){return lR(this),this[t]||null},zP(oR,aR),hR.prototype={length:0,item:aR.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var n=this[e];if(n.nodeName==t)return n}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new sR(rR);var n=this.getNamedItem(t.nodeName);return uR(this._ownerElement,this,t,n),n},setNamedItemNS:function(t){var e,n=t.ownerElement;if(n&&n!=this._ownerElement)throw new sR(rR);return e=this.getNamedItemNS(t.namespaceURI,t.localName),uR(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return dR(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var n=this.getNamedItemNS(t,e);return dR(this._ownerElement,this,n),n},getNamedItemNS:function(t,e){for(var n=this.length;n--;){var i=this[n];if(i.localName==e&&i.namespaceURI==t)return i}return null}},pR.prototype={hasFeature:function(t,e){return!0},createDocument:function(t,e,n){var i=new vR;if(i.implementation=this,i.childNodes=new aR,i.doctype=n||null,n&&i.appendChild(n),e){var r=i.createElementNS(t,e);i.appendChild(r)}return i},createDocumentType:function(t,e,n){var i=new LR;return i.name=t,i.nodeName=t,i.publicId=e||"",i.systemId=n||"",i}},fR.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return PR(this,t,e)},replaceChild:function(t,e){PR(this,t,e,CR),e&&this.removeChild(e)},removeChild:function(t){return bR(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return qR(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==XP&&t.nodeType==XP?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var n=e._nsMap;if(n)for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&n[i]===t)return i;e=e.nodeType==VP?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var n=e._nsMap;if(n&&Object.prototype.hasOwnProperty.call(n,t))return n[t];e=e.nodeType==VP?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},NP(GP,fR),NP(GP,fR.prototype),vR.prototype={nodeName:"#document",nodeType:JP,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==QP){for(var n=t.firstChild;n;){var i=n.nextSibling;this.insertBefore(n,e),n=i}return t}return PR(this,t,e),t.ownerDocument=this,null===this.documentElement&&t.nodeType===HP&&(this.documentElement=t),t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),bR(this,t)},replaceChild:function(t,e){PR(this,t,e,CR),t.ownerDocument=this,e&&this.removeChild(e),SR(t)&&(this.documentElement=t)},importNode:function(t,e){return YR(this,t,e)},getElementById:function(t){var e=null;return gR(this.documentElement,function(n){if(n.nodeType==HP&&n.getAttribute("id")==t)return e=n,!0}),e},getElementsByClassName:function(t){var e=kP(t);return new oR(this,function(n){var i=[];return e.length>0&&gR(n.documentElement,function(r){if(r!==n&&r.nodeType===HP){var s=r.getAttribute("class");if(s){var a=t===s;if(!a){var o=kP(s);a=e.every((l=o,function(t){return l&&-1!==l.indexOf(t)}))}a&&i.push(r)}}var l}),i})},createElement:function(t){var e=new RR;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.localName=t,e.childNodes=new aR,(e.attributes=new hR)._ownerElement=e,e},createDocumentFragment:function(){var t=new zR;return t.ownerDocument=this,t.childNodes=new aR,t},createTextNode:function(t){var e=new DR;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new BR;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new FR;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var n=new GR;return n.ownerDocument=this,n.tagName=n.nodeName=n.target=t,n.nodeValue=n.data=e,n},createAttribute:function(t){var e=new IR;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new NR;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var n=new RR,i=e.split(":"),r=n.attributes=new hR;return n.childNodes=new aR,n.ownerDocument=this,n.nodeName=e,n.tagName=e,n.namespaceURI=t,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=e,r._ownerElement=n,n},createAttributeNS:function(t,e){var n=new IR,i=e.split(":");return n.ownerDocument=this,n.nodeName=e,n.name=e,n.namespaceURI=t,n.specified=!0,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=e,n}},zP(vR,fR),RR.prototype={nodeType:HP,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var n=this.ownerDocument.createAttribute(t);n.value=n.nodeValue=""+e,this.setAttributeNode(n)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===QP?this.insertBefore(t,null):function(t,e){return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=t,e.previousSibling=t.lastChild,e.nextSibling=null,e.previousSibling?e.previousSibling.nextSibling=e:t.firstChild=e,t.lastChild=e,xR(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);n&&this.removeAttributeNode(n)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var n=this.getAttributeNodeNS(t,e);return n&&n.value||""},setAttributeNS:function(t,e,n){var i=this.ownerDocument.createAttributeNS(t,e);i.value=i.nodeValue=""+n,this.setAttributeNode(i)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new oR(this,function(e){var n=[];return gR(e,function(i){i===e||i.nodeType!=HP||"*"!==t&&i.tagName!=t||n.push(i)}),n})},getElementsByTagNameNS:function(t,e){return new oR(this,function(n){var i=[];return gR(n,function(r){r===n||r.nodeType!==HP||"*"!==t&&r.namespaceURI!==t||"*"!==e&&r.localName!=e||i.push(r)}),i})}},vR.prototype.getElementsByTagName=RR.prototype.getElementsByTagName,vR.prototype.getElementsByTagNameNS=RR.prototype.getElementsByTagNameNS,zP(RR,fR),IR.prototype.nodeType=VP,zP(IR,fR),OR.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(eR[nR])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,n){n=this.data.substring(0,t)+n+this.data.substring(t+e),this.nodeValue=this.data=n,this.length=n.length}},zP(OR,fR),DR.prototype={nodeName:"#text",nodeType:XP,splitText:function(t){var e=this.data,n=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var i=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(i,this.nextSibling),i}},zP(DR,OR),BR.prototype={nodeName:"#comment",nodeType:KP},zP(BR,OR),FR.prototype={nodeName:"#cdata-section",nodeType:WP},zP(FR,OR),LR.prototype.nodeType=ZP,zP(LR,fR),UR.prototype.nodeType=$P,zP(UR,fR),kR.prototype.nodeType=YP,zP(kR,fR),NR.prototype.nodeType=jP,zP(NR,fR),zR.prototype.nodeName="#document-fragment",zR.prototype.nodeType=QP,zP(zR,fR),GR.prototype.nodeType=qP,zP(GR,fR),HR.prototype.serializeToString=function(t,e,n){return VR.call(t,e,n)},fR.prototype.toString=VR;try{if(Object.defineProperty){let t=function(e){switch(e.nodeType){case HP:case QP:var n=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&n.push(t(e)),e=e.nextSibling;return n.join("");default:return e.nodeValue}};Object.defineProperty(oR.prototype,"length",{get:function(){return lR(this),this.$$length}}),Object.defineProperty(fR.prototype,"textContent",{get:function(){return t(this)},set:function(t){switch(this.nodeType){case HP:case QP:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),KR=function(t,e,n){t["$$"+e]=n}}}catch(S6){}CP.DocumentType=LR,CP.DOMException=sR,CP.DOMImplementation=pR,CP.Element=RR,CP.Node=fR,CP.NodeList=aR,CP.XMLSerializer=HR;var JR,ZR,QR={},$R={};JR=$R,ZR=PP.freeze,JR.XML_ENTITIES=ZR({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),JR.HTML_ENTITIES=ZR({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),JR.entityMap=JR.HTML_ENTITIES;var tI={},eI=PP.NAMESPACE,nI=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,iI=new RegExp("[\\-\\.0-9"+nI.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),rI=new RegExp("^"+nI.source+iI.source+"*(?::"+nI.source+iI.source+"*)?$");function sI(t,e){this.message=t,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,sI)}function aI(){}function oI(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function lI(t,e,n,i,r,s){function a(t,e,i){n.attributeNames.hasOwnProperty(t)&&s.fatalError("Attribute "+t+" redefined"),n.addValue(t,e.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,r),i)}for(var o,l=++e,h=0;;){var c=t.charAt(l);switch(c){case"=":if(1===h)o=t.slice(e,l),h=3;else{if(2!==h)throw new Error("attribute equal must after attrName");h=3}break;case"'":case'"':if(3===h||1===h){if(1===h&&(s.warning('attribute value must after "="'),o=t.slice(e,l)),e=l+1,!((l=t.indexOf(c,e))>0))throw new Error("attribute value no end '"+c+"' match");a(o,u=t.slice(e,l),e-1),h=5}else{if(4!=h)throw new Error('attribute value must after "="');a(o,u=t.slice(e,l),e),s.warning('attribute "'+o+'" missed start quot('+c+")!!"),e=l+1,h=5}break;case"/":switch(h){case 0:n.setTagName(t.slice(e,l));case 5:case 6:case 7:h=7,n.closed=!0;case 4:case 1:break;case 2:n.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),0==h&&n.setTagName(t.slice(e,l)),l;case">":switch(h){case 0:n.setTagName(t.slice(e,l));case 5:case 6:case 7:break;case 4:case 1:"/"===(u=t.slice(e,l)).slice(-1)&&(n.closed=!0,u=u.slice(0,-1));case 2:2===h&&(u=o),4==h?(s.warning('attribute "'+u+'" missed quot(")!'),a(o,u,e)):(eI.isHTML(i[""])&&u.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),a(u,u,e));break;case 3:throw new Error("attribute value missed!!")}return l;case"":c=" ";default:if(c<=" ")switch(h){case 0:n.setTagName(t.slice(e,l)),h=6;break;case 1:o=t.slice(e,l),h=2;break;case 4:var u=t.slice(e,l);s.warning('attribute "'+u+'" missed quot(")!!'),a(o,u,e);case 5:h=6}else switch(h){case 2:n.tagName,eI.isHTML(i[""])&&o.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),a(o,o,e),e=l,h=1;break;case 5:s.warning('attribute space is required"'+o+'"!!');case 6:h=1,e=l;break;case 3:h=4,e=l;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}l++}}function hI(t,e,n){for(var i=t.tagName,r=null,s=t.length;s--;){var a=t[s],o=a.qName,l=a.value;if((d=o.indexOf(":"))>0)var h=a.prefix=o.slice(0,d),c=o.slice(d+1),u="xmlns"===h&&c;else c=o,h=null,u="xmlns"===o&&"";a.localName=c,!1!==u&&(null==r&&(r={},dI(n,n={})),n[u]=r[u]=l,a.uri=eI.XMLNS,e.startPrefixMapping(u,l))}for(s=t.length;s--;){(h=(a=t[s]).prefix)&&("xml"===h&&(a.uri=eI.XML),"xmlns"!==h&&(a.uri=n[h||""]))}var d;(d=i.indexOf(":"))>0?(h=t.prefix=i.slice(0,d),c=t.localName=i.slice(d+1)):(h=null,c=t.localName=i);var p=t.uri=n[h||""];if(e.startElement(p,c,i,t),!t.closed)return t.currentNSMap=n,t.localNSMap=r,!0;if(e.endElement(p,c,i),r)for(h in r)Object.prototype.hasOwnProperty.call(r,h)&&e.endPrefixMapping(h)}function cI(t,e,n,i,r){if(/^(?:script|textarea)$/i.test(n)){var s=t.indexOf("</"+n+">",e),a=t.substring(e+1,s);if(/[&<]/.test(a))return/^script$/i.test(n)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,i),r.characters(a,0,a.length),s)}return e+1}function uI(t,e,n,i){var r=i[n];return null==r&&((r=t.lastIndexOf("</"+n+">"))<e&&(r=t.lastIndexOf("</"+n)),i[n]=r),r<e}function dI(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}function pI(t,e,n,i){if("-"===t.charAt(e+2))return"-"===t.charAt(e+3)?(r=t.indexOf("--\x3e",e+4))>e?(n.comment(t,e+4,r-e-4),r+3):(i.error("Unclosed comment"),-1):-1;if("CDATA["==t.substr(e+3,6)){var r=t.indexOf("]]>",e+9);return n.startCDATA(),n.characters(t,e+9,r-e-9),n.endCDATA(),r+3}var s=function(t,e){var n,i=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;r.lastIndex=e,r.exec(t);for(;n=r.exec(t);)if(i.push(n),n[1])return i}(t,e),a=s.length;if(a>1&&/!doctype/i.test(s[0][0])){var o=s[1][0],l=!1,h=!1;a>3&&(/^public$/i.test(s[2][0])?(l=s[3][0],h=a>4&&s[4][0]):/^system$/i.test(s[2][0])&&(h=s[3][0]));var c=s[a-1];return n.startDTD(o,l,h),n.endDTD(),c.index+c[0].length}return-1}function fI(t,e,n){var i=t.indexOf("?>",e);if(i){var r=t.substring(e,i).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return r?(r[0].length,n.processingInstruction(r[1],r[2]),i+2):-1}return-1}function mI(){this.attributeNames={}}sI.prototype=new Error,sI.prototype.name=sI.name,aI.prototype={parse:function(t,e,n){var i=this.domBuilder;i.startDocument(),dI(e,e={}),function(t,e,n,i,r){function s(t){if(t>65535){var e=55296+((t-=65536)>>10),n=56320+(1023&t);return String.fromCharCode(e,n)}return String.fromCharCode(t)}function a(t){var e=t.slice(1,-1);return Object.hasOwnProperty.call(n,e)?n[e]:"#"===e.charAt(0)?s(parseInt(e.substr(1).replace("x","0x"))):(r.error("entity not found:"+t),t)}function o(e){if(e>m){var n=t.substring(m,e).replace(/&#?\w+;/g,a);d&&l(m),i.characters(n,0,e-m),m=e}}function l(e,n){for(;e>=c&&(n=u.exec(t));)h=n.index,c=h+n[0].length,d.lineNumber++;d.columnNumber=e-h+1}var h=0,c=0,u=/.*(?:\r\n?|\n)|.*$/g,d=i.locator,p=[{currentNSMap:e}],f={},m=0;for(;;){try{var g=t.indexOf("<",m);if(g<0){if(!t.substr(m).match(/^\s*$/)){var v=i.doc,y=v.createTextNode(t.substr(m));v.appendChild(y),i.currentElement=y}return}switch(g>m&&o(g),t.charAt(g+1)){case"/":var x=t.indexOf(">",g+3),b=t.substring(g+2,x).replace(/[ \t\n\r]+$/g,""),_=p.pop();x<0?(b=t.substring(g+2).replace(/[\s<].*/,""),r.error("end tag name: "+b+" is not complete:"+_.tagName),x=g+1+b.length):b.match(/\s</)&&(b=b.replace(/[\s<].*/,""),r.error("end tag name: "+b+" maybe not complete"),x=g+1+b.length);var S=_.localNSMap,w=_.tagName==b;if(w||_.tagName&&_.tagName.toLowerCase()==b.toLowerCase()){if(i.endElement(_.uri,_.localName,b),S)for(var T in S)Object.prototype.hasOwnProperty.call(S,T)&&i.endPrefixMapping(T);w||r.fatalError("end tag name: "+b+" is not match the current start tagName:"+_.tagName)}else p.push(_);x++;break;case"?":d&&l(g),x=fI(t,g,i);break;case"!":d&&l(g),x=pI(t,g,i,r);break;default:d&&l(g);var M=new mI,A=p[p.length-1].currentNSMap,E=(x=lI(t,g,M,A,a,r),M.length);if(!M.closed&&uI(t,x,M.tagName,f)&&(M.closed=!0,n.nbsp||r.warning("unclosed xml attribute")),d&&E){for(var C=oI(d,{}),P=0;P<E;P++){var R=M[P];l(R.offset),R.locator=oI(d,{})}i.locator=C,hI(M,i,A)&&p.push(M),i.locator=d}else hI(M,i,A)&&p.push(M);eI.isHTML(M.uri)&&!M.closed?x=cI(t,x,M.tagName,a,i):x++}}catch(S6){if(S6 instanceof sI)throw S6;r.error("element parse error: "+S6),x=-1}x>m?m=x:o(Math.max(g,m)+1)}}(t,e,n,i,this.errorHandler),i.endDocument()}},mI.prototype={setTagName:function(t){if(!rI.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},addValue:function(t,e,n){if(!rI.test(t))throw new Error("invalid attribute:"+t);this.attributeNames[t]=this.length,this[this.length++]={qName:t,value:e,offset:n}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},tI.XMLReader=aI,tI.ParseError=sI;var gI=PP,vI=$R,yI=tI,xI=CP.DOMImplementation,bI=gI.NAMESPACE,_I=yI.ParseError,SI=yI.XMLReader;function wI(t){return t.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function TI(t){this.options=t||{locator:{}}}function MI(){this.cdata=!1}function AI(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function EI(t,e,n){return"string"==typeof t?t.substr(e,n):t.length>=e+n||e?new java.lang.String(t,e,n)+"":t}function CI(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}TI.prototype.parseFromString=function(t,e){var n=this.options,i=new SI,r=n.domBuilder||new MI,s=n.errorHandler,a=n.locator,o=n.xmlns||{},l=/\/x?html?$/.test(e),h=l?vI.HTML_ENTITIES:vI.XML_ENTITIES;a&&r.setDocumentLocator(a),i.errorHandler=function(t,e,n){if(!t){if(e instanceof MI)return e;t=e}var i={},r=t instanceof Function;function s(e){var s=t[e];!s&&r&&(s=2==t.length?function(n){t(e,n)}:t),i[e]=s&&function(t){s("[xmldom "+e+"]\t"+t+function(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}(n))}||function(){}}return n=n||{},s("warning"),s("error"),s("fatalError"),i}(s,r,a),i.domBuilder=n.domBuilder||r,l&&(o[""]=bI.HTML),o.xml=o.xml||bI.XML;var c=n.normalizeLineEndings||wI;return t&&"string"==typeof t?i.parse(c(t),o,h):i.errorHandler.error("invalid doc source"),r.doc},MI.prototype={startDocument:function(){this.doc=(new xI).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,n,i){var r=this.doc,s=r.createElementNS(t,n||e),a=i.length;CI(this,s),this.currentElement=s,this.locator&&AI(this.locator,s);for(var o=0;o<a;o++){t=i.getURI(o);var l=i.getValue(o),h=(n=i.getQName(o),r.createAttributeNS(t,n));this.locator&&AI(i.getLocator(o),h),h.value=h.nodeValue=l,s.setAttributeNode(h)}},endElement:function(t,e,n){var i=this.currentElement;i.tagName,this.currentElement=i.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var n=this.doc.createProcessingInstruction(t,e);this.locator&&AI(this.locator,n),CI(this,n)},ignorableWhitespace:function(t,e,n){},characters:function(t,e,n){if(t=EI.apply(this,arguments)){if(this.cdata)var i=this.doc.createCDATASection(t);else i=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(i):/^\s*$/.test(t)&&this.doc.appendChild(i),this.locator&&AI(this.locator,i)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,n){t=EI.apply(this,arguments);var i=this.doc.createComment(t);this.locator&&AI(this.locator,i),CI(this,i)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,n){var i=this.doc.implementation;if(i&&i.createDocumentType){var r=i.createDocumentType(t,e,n);this.locator&&AI(this.locator,r),CI(this,r),this.doc.doctype=r}},warning:function(t){},error:function(t){},fatalError:function(t){throw new _I(t,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){MI.prototype[t]=function(){return null}}),QR.__DOMHandler=MI,QR.normalizeLineEndings=wI,QR.DOMParser=TI;var PI=QR.DOMParser;const RI={createCanvas:(t,e)=>new OffscreenCanvas(t??0,e??0),getCanvasRenderingContext2D:()=>OffscreenCanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>globalThis.location.href,getFontFaceSet:()=>globalThis.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new PI).parseFromString(t,"text/xml")};const II=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this._tickerAdded&&this.domElement&&(Qb.system.add(this._tickerUpdate,this,qb.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(Qb.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events._rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(this.events.supportsPointerEvents?new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,pointerId:t.pointerId}):new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY}))}_tickerUpdate(t){this._deltaTime+=t.deltaTime,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this._update())}};class OI extends w_{constructor(){super(...arguments),this.client=new Cy,this.movement=new Cy,this.offset=new Cy,this.global=new Cy,this.screen=new Cy}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,n,i,r,s,a,o,l,h,c,u,d,p,f){throw new Error("Method not implemented.")}}class DI extends OI{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class BI extends OI{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}BI.DOM_DELTA_PIXEL=0,BI.DOM_DELTA_LINE=1,BI.DOM_DELTA_PAGE=2;const FI=new Cy,LI=new Cy;class UI{constructor(t){this.dispatch=new Ty,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((t,e)=>t.priority-e.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let n=0,i=e.length;n<i;n++)e[n].fn(t);else Vx(t.type)}hitTest(t,e){II.pauseUpdate=!0;const n=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,FI.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,r=n.length-1;i<r;i++)if(t.currentTarget=n[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let i=n.length-2;i>=0;i--)if(t.currentTarget=n[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,n=this._allInteractiveElements){if(0===n.length)return;t.eventPhase=t.BUBBLING_PHASE;const i=Array.isArray(e)?e:[e];for(let r=n.length-1;r>=0;r--)i.forEach(e=>{t.currentTarget=n[r],this.notifyTarget(t,e)})}propagationPath(t){const e=[t];for(let n=0;n<2048&&t!==this.rootTarget&&t.parent;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,n,i,r,s=!1){let a=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(II.pauseUpdate=!1),t.interactiveChildren&&t.children){const o=t.children;for(let l=o.length-1;l>=0;l--){const h=o[l],c=this.hitTestMoveRecursive(h,this._isInteractive(e)?e:h.eventMode,n,i,r,s||r(t,n));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const e=t.isInteractive();(c.length>0||e)&&(e&&this._allInteractiveElements.push(t),c.push(t)),0===this._hitElements.length&&(this._hitElements=c),a=!0}}}const o=this._isInteractive(e),l=t.isInteractive();return l&&l&&this._allInteractiveElements.push(t),s||this._hitElements.length>0?null:a?this._hitElements:o&&!r(t,n)&&i(t,n)?l?[t]:[]:null}hitTestRecursive(t,e,n,i,r){if(this._interactivePrune(t)||r(t,n))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(II.pauseUpdate=!1),t.interactiveChildren&&t.children){const s=t.children,a=n;for(let n=s.length-1;n>=0;n--){const o=s[n],l=this.hitTestRecursive(o,this._isInteractive(e)?e:o.eventMode,a,i,r);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const e=t.isInteractive();return(l.length>0||e)&&l.push(t),l}}}const s=this._isInteractive(e),a=t.isInteractive();return s&&i(t,n)?a?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&t.visible&&t.renderable&&t.measurable)||("none"===t.eventMode||"passive"===t.eventMode&&!t.interactiveChildren)}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,LI),!t.hitArea.contains(LI.x,LI.y)))return!0;if(t.effects&&t.effects.length)for(let n=0;n<t.effects.length;n++){const i=t.effects[n];if(i.containsPoint){if(!i.containsPoint(e,this.hitTestFn))return!0}}return!1}hitTestFn(t,e){return!!t.hitArea||!!(null==t?void 0:t.containsPoint)&&(t.worldTransform.applyInverse(e,LI),t.containsPoint(LI))}notifyTarget(t,e){var n,i;if(!t.currentTarget.isInteractive())return;e??(e=t.type);const r=`on${e}`;null==(i=(n=t.currentTarget)[r])||i.call(n,t);const s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this._notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this._notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof DI))return void Vx();const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var e,n;if(!(t instanceof DI))return void Vx();this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const i=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r="mouse"===i.pointerType||"pen"===i.pointerType,s=this.trackingData(t.pointerId),a=this.findMountedTarget(s.overTargets);if((null==(e=s.overTargets)?void 0:e.length)>0&&a!==i.target){const e="mousemove"===t.type?"mouseout":"pointerout",n=this.createPointerEvent(t,e,a);if(this.dispatchEvent(n,"pointerout"),r&&this.dispatchEvent(n,"mouseout"),!i.composedPath().includes(a)){const e=this.createPointerEvent(t,"pointerleave",a);for(e.eventPhase=e.AT_TARGET;e.target&&!i.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),r&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(n)}if(a!==i.target){const e="mousemove"===t.type?"mouseover":"pointerover",n=this.clonePointerEvent(i,e);this.dispatchEvent(n,"pointerover"),r&&this.dispatchEvent(n,"mouseover");let s=null==a?void 0:a.parent;for(;s&&s!==this.rootTarget.parent&&s!==i.target;)s=s.parent;if(!s||s===this.rootTarget.parent){const t=this.clonePointerEvent(i,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==a&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(n)}const o=[],l=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(i,"pointermove"),l&&o.push("globalpointermove"),"touch"===i.pointerType&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(i,"touchmove"),l&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(i,"mousemove"),l&&o.push("globalmousemove"),this.cursor=null==(n=i.target)?void 0:n.cursor),o.length>0&&this.all(i,o),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=i.composedPath(),this.freeEvent(i)}mapPointerOver(t){var e;if(!(t instanceof DI))return void Vx();const n=this.trackingData(t.pointerId),i=this.createPointerEvent(t),r="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),r&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=null==(e=i.target)?void 0:e.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),r&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;n.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof DI))return void Vx();const e=this.trackingData(t.pointerId);if(e.overTargets){const n="mouse"===t.pointerType||"pen"===t.pointerType,i=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(r),n&&this.dispatchEvent(r,"mouseout");const s=this.createPointerEvent(t,"pointerleave",i);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(s)}this.cursor=null}mapPointerUp(t){if(!(t instanceof DI))return void Vx();const e=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType)this.dispatchEvent(n,"touchend");else if("mouse"===n.pointerType||"pen"===n.pointerType){const t=2===n.button;this.dispatchEvent(n,t?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),r=this.findMountedTarget(i.pressTargetsByButton[t.button]);let s=r;if(r&&!n.composedPath().includes(r)){let e=r;for(;e&&!n.composedPath().includes(e);){if(n.currentTarget=e,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType)this.notifyTarget(n,"touchendoutside");else if("mouse"===n.pointerType||"pen"===n.pointerType){const t=2===n.button;this.notifyTarget(n,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete i.pressTargetsByButton[t.button],s=e}if(s){const r=this.clonePointerEvent(n,"click");r.target=s,r.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:r.target,timeStamp:e});const a=i.clicksByButton[t.button];if(a.target===r.target&&e-a.timeStamp<200?++a.clickCount:a.clickCount=1,a.target=r.target,a.timeStamp=e,r.detail=a.clickCount,"mouse"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightclick":"click")}else"touch"===r.pointerType&&this.dispatchEvent(r,"tap");this.dispatchEvent(r,"pointertap"),this.freeEvent(r)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof DI))return void Vx();const e=this.trackingData(t.pointerId),n=this.findMountedTarget(e.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(n){let r=n;for(;r;)i.currentTarget=r,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof BI))return void Vx();const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let n=1;n<t.length&&t[n].parent===e;n++)e=t[n];return e}createPointerEvent(t,e,n){const i=this.allocateEvent(DI);return this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=n??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],"string"==typeof e&&(i.type=e),i}createWheelEvent(t){const e=this.allocateEvent(BI);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const n=this.allocateEvent(DI);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=e??n.type,n}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof DI&&e instanceof DI&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof OI&&e instanceof OI&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.defaultPrevented=!1,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}_notifyListeners(t,e){const n=t.currentTarget._events[e];if(n)if("fn"in n)n.once&&t.currentTarget.removeListener(e,n.fn,void 0,!0),n.fn.call(n.context,t);else for(let i=0,r=n.length;i<r&&!t.propagationImmediatelyStopped;i++)n[i].once&&t.currentTarget.removeListener(e,n[i].fn,void 0,!0),n[i].fn.call(n[i].context,t)}}const kI={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},NI=class t{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new UI(null),II.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new DI(null),this._rootWheelEvent=new BI(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...t.defaultEventFeatures},{set:(t,e,n)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=n),t[e]=n,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{canvas:n,resolution:i}=this.renderer;this.setTargetElement(n),this.resolution=i,t._defaultEventMode=e.eventMode??"passive",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(t){t||(t="default");let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this._currentCursor===t)return;this._currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":e&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":e&&Object.assign(this.domElement.style,n)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this._rootPointerEvent}_onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this._normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let n=0,i=e.length;n<i;n++){const t=e[n],i=this._bootstrapEvent(this._rootPointerEvent,t);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,II.pointerMoved();const e=this._normalizeToPointerData(t);for(let n=0,i=e.length;n<i;n++){const t=this._bootstrapEvent(this._rootPointerEvent,e[n]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const n=e!==this.domElement?"outside":"",i=this._normalizeToPointerData(t);for(let r=0,s=i.length;r<s;r++){const t=this._bootstrapEvent(this._rootPointerEvent,i[r]);t.type+=n,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this._normalizeToPointerData(t);for(let n=0,i=e.length;n<i;n++){const t=this._bootstrapEvent(this._rootPointerEvent,e[n]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this._removeEvents(),this.domElement=t,II.domElement=t,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;II.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;II.removeTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(t,e,n){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},r=1/this.resolution;t.x=(e-i.left)*(this.domElement.width/i.width)*r,t.y=(n-i.top)*(this.domElement.height/i.height)*r}_normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,i=t.changedTouches.length;n<i;n++){const i=t.changedTouches[n];void 0===i.button&&(i.button=0),void 0===i.buttons&&(i.buttons=1),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=t.type,e.push(i)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const n=t;void 0===n.isPrimary&&(n.isPrimary=!0),void 0===n.width&&(n.width=1),void 0===n.height&&(n.height=1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="mouse"),void 0===n.pointerId&&(n.pointerId=1),void 0===n.pressure&&(n.pressure=.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),n.isNormalized=!0,e.push(n)}return e}normalizeWheelEvent(t){const e=this._rootWheelEvent;return this._transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}_bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this._transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=kI[t.type]||t.type),t}_transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};NI.extension={name:"events",type:[fy.WebGLSystem,fy.CanvasSystem,fy.WebGPUSystem],priority:-1},NI.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let zI=NI;const GI={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return"dynamic"===this.eventMode||"static"===this.eventMode},set interactive(t){this.eventMode=t?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??zI.defaultEventMode},set eventMode(t){this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,n){const i="boolean"==typeof n&&n||"object"==typeof n&&n.capture,r="object"==typeof n?n.signal:void 0,s="object"==typeof n&&!0===n.once,a="function"==typeof e?void 0:e;t=i?`${t}capture`:t;const o="function"==typeof e?e:e.handleEvent,l=this;r&&r.addEventListener("abort",()=>{l.off(t,o,a)}),s?l.once(t,o,a):l.on(t,o,a)},removeEventListener(t,e,n){const i="function"==typeof e?void 0:e;t="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,i)},dispatchEvent(t){if(!(t instanceof w_))throw new Error("Container cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};var HI="in vec2 aPosition;\nout vec2 vTextureCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",VI="\nin vec2 vTextureCoord;\n\nout vec4 finalColor;\n\nuniform float uAlpha;\nuniform sampler2D uTexture;\n\nvoid main()\n{\n    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;\n}\n",XI="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct AlphaUniforms {\n  uAlpha:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n \n    var sample = textureSample(uTexture, uSampler, uv);\n    \n    return sample * alphaUniforms.uAlpha;\n}";const WI=class t extends OS{constructor(e){e={...t.defaultOptions,...e};const n=xS.from({vertex:{source:XI,entryPoint:"mainVertex"},fragment:{source:XI,entryPoint:"mainFragment"}}),i=lS.from({vertex:HI,fragment:VI,name:"alpha-filter"}),{alpha:r,...s}=e;super({...s,gpuProgram:n,glProgram:i,resources:{alphaUniforms:new TS({uAlpha:{value:r,type:"f32"}})}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(t){this.resources.alphaUniforms.uniforms.uAlpha=t}};WI.defaultOptions={alpha:1};let jI=WI;const YI={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},qI=["in vec2 vBlurTexCoords[%size%];","uniform sampler2D uTexture;","out vec4 finalColor;","void main(void)","{","    finalColor = vec4(0.0);","    %blur%","}"].join("\n");function KI(t){const e=YI[t],n=e.length;let i=qI,r="";let s;for(let a=0;a<t;a++){let i="finalColor += texture(uTexture, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());s=a,a>=n&&(s=t-a-1),i=i.replace("%value%",e[s].toString()),r+=i,r+="\n"}return i=i.replace("%blur%",r),i=i.replace("%size%",t.toString()),i}function JI(t,e){const n=Math.ceil(t/2);let i,r="\n    in vec2 aPosition;\n\n    uniform float uStrength;\n\n    out vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 uInputSize;\n    uniform vec4 uOutputFrame;\n    uniform vec4 uOutputTexture;\n\n    vec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\n    vec2 filterTextureCoord( void )\n    {\n        return aPosition * (uOutputFrame.zw * uInputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        float pixelStrength = uInputSize.%dimension% * uStrength;\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * pixelStrength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * pixelStrength);";for(let a=0;a<t;a++){let t=i.replace("%index%",a.toString());t=t.replace("%sampleIndex%",a-(n-1)+".0"),s+=t,s+="\n"}return r=r.replace("%blur%",s),r=r.replace("%size%",t.toString()),r=r.replace("%dimension%",e?"z":"w"),r}function ZI(t,e){const n=JI(e,t),i=KI(e);return lS.from({vertex:n,fragment:i,name:`blur-${t?"horizontal":"vertical"}-pass-filter`})}var QI="\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct BlurUniforms {\n  uStrength:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> blurUniforms : BlurUniforms;\n\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    %blur-struct%\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n\n  let filteredCord = filterTextureCoord(aPosition);\n\n  let pixelStrength = gfu.uInputSize.%dimension% * blurUniforms.uStrength;\n\n  return VSOutput(\n   filterVertexPosition(aPosition),\n    %blur-vertex-out%\n  );\n}\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  %blur-fragment-in%\n) -> @location(0) vec4<f32> {\n\n    var   finalColor = vec4(0.0);\n\n    %blur-sampling%\n\n    return finalColor;\n}";function $I(t,e){const n=YI[e],i=n.length,r=[],s=[],a=[];for(let u=0;u<e;u++){r[u]=`@location(${u}) offset${u}: vec2<f32>,`,s[u]=t?`filteredCord + vec2(${u-i+1} * pixelStrength, 0.0),`:`filteredCord + vec2(0.0, ${u-i+1} * pixelStrength),`;const o=n[u<i?u:e-u-1].toString();a[u]=`finalColor += textureSample(uTexture, uSampler, offset${u}) * ${o};`}const o=r.join("\n"),l=s.join("\n"),h=a.join("\n"),c=QI.replace("%blur-struct%",o).replace("%blur-vertex-out%",l).replace("%blur-fragment-in%",o).replace("%blur-sampling%",h).replace("%dimension%",t?"z":"w");return xS.from({vertex:{source:c,entryPoint:"mainVertex"},fragment:{source:c,entryPoint:"mainFragment"}})}const tO=class t extends OS{constructor(e){super({glProgram:ZI((e={...t.defaultOptions,...e}).horizontal,e.kernelSize),gpuProgram:$I(e.horizontal,e.kernelSize),resources:{blurUniforms:{uStrength:{value:0,type:"f32"}}},...e}),this.horizontal=e.horizontal,this._quality=0,this.quality=e.quality,this.blur=e.strength,this._uniforms=this.resources.blurUniforms.uniforms}apply(t,e,n,i){if(this._uniforms.uStrength=this.strength/this.passes,1===this.passes)t.applyFilter(this,e,n,i);else{const r=Ab.getSameSizeTexture(e);let s=e,a=r;this._state.blend=!1;const o=t.renderer.type===AS.WEBGPU;for(let e=0;e<this.passes-1;e++){t.applyFilter(this,s,a,0===e||o);const n=a;a=s,s=n}this._state.blend=!0,t.applyFilter(this,s,n,i),Ab.returnTexture(r)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}};tO.defaultOptions={strength:8,quality:4,kernelSize:5};let eO=tO;class nO extends OS{constructor(...t){let e=t[0]??{};"number"==typeof e&&(qy(0,"BlurFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }"),e={strength:e},void 0!==t[1]&&(e.quality=t[1]),void 0!==t[2]&&(e.resolution=t[2]||"inherit"),void 0!==t[3]&&(e.kernelSize=t[3])),e={...eO.defaultOptions,...e};const{strength:n,strengthX:i,strengthY:r,quality:s,...a}=e;super({...a,compatibleRenderers:AS.BOTH,resources:{}}),this._repeatEdgePixels=!1,this.blurXFilter=new eO({horizontal:!0,...e}),this.blurYFilter=new eO({horizontal:!1,...e}),this.quality=s,this.strengthX=i??n,this.strengthY=r??n,this.repeatEdgePixels=!1}apply(t,e,n,i){const r=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(r&&s){const r=Ab.getSameSizeTexture(e);this.blurXFilter.blendMode="normal",this.blurXFilter.apply(t,e,r,!0),this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(t,r,n,i),Ab.returnTexture(r)}else s?(this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(t,e,n,i)):(this.blurXFilter.blendMode=this.blendMode,this.blurXFilter.apply(t,e,n,i))}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.blur),Math.abs(this.blurYFilter.blur))}get strength(){if(this.strengthX!==this.strengthY)throw new Error("BlurFilter's strengthX and strengthY are different");return this.strengthX}set strength(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get strengthX(){return this.blurXFilter.blur}set strengthX(t){this.blurXFilter.blur=t,this.updatePadding()}get strengthY(){return this.blurYFilter.blur}set strengthY(t){this.blurYFilter.blur=t,this.updatePadding()}get blur(){return qy(0,"BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength}set blur(t){qy(0,"BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength=t}get blurX(){return qy(0,"BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX}set blurX(t){qy(0,"BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX=t}get blurY(){return qy(0,"BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY}set blurY(t){qy(0,"BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}nO.defaultOptions={strength:8,quality:4,kernelSize:5};var iO="\nin vec2 vTextureCoord;\nin vec4 vColor;\n\nout vec4 finalColor;\n\nuniform float uColorMatrix[20];\nuniform float uAlpha;\n\nuniform sampler2D uTexture;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * 0.2);\n    float diff = (randomValue - 0.5) *  0.5;\n\n    if (uAlpha == 0.0) {\n        finalColor = color;\n        return;\n    }\n\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    vec4 result;\n\n    result.r = (uColorMatrix[0] * color.r);\n        result.r += (uColorMatrix[1] * color.g);\n        result.r += (uColorMatrix[2] * color.b);\n        result.r += (uColorMatrix[3] * color.a);\n        result.r += uColorMatrix[4];\n\n    result.g = (uColorMatrix[5] * color.r);\n        result.g += (uColorMatrix[6] * color.g);\n        result.g += (uColorMatrix[7] * color.b);\n        result.g += (uColorMatrix[8] * color.a);\n        result.g += uColorMatrix[9];\n\n    result.b = (uColorMatrix[10] * color.r);\n       result.b += (uColorMatrix[11] * color.g);\n       result.b += (uColorMatrix[12] * color.b);\n       result.b += (uColorMatrix[13] * color.a);\n       result.b += uColorMatrix[14];\n\n    result.a = (uColorMatrix[15] * color.r);\n       result.a += (uColorMatrix[16] * color.g);\n       result.a += (uColorMatrix[17] * color.b);\n       result.a += (uColorMatrix[18] * color.a);\n       result.a += uColorMatrix[19];\n\n    vec3 rgb = mix(color.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    finalColor = vec4(rgb, result.a);\n}\n",rO="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct ColorMatrixUniforms {\n  uColorMatrix:array<vec4<f32>, 5>,\n  uAlpha:f32,\n};\n\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n@group(1) @binding(0) var<uniform> colorMatrixUniforms : ColorMatrixUniforms;\n\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n  };\n  \nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition),\n  );\n}\n\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n) -> @location(0) vec4<f32> {\n\n\n  var c = textureSample(uTexture, uSampler, uv);\n  \n  if (colorMatrixUniforms.uAlpha == 0.0) {\n    return c;\n  }\n\n \n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.r /= c.a;\n      c.g /= c.a;\n      c.b /= c.a;\n    }\n\n    var cm = colorMatrixUniforms.uColorMatrix;\n\n\n    var result = vec4<f32>(0.);\n\n    result.r = (cm[0][0] * c.r);\n    result.r += (cm[0][1] * c.g);\n    result.r += (cm[0][2] * c.b);\n    result.r += (cm[0][3] * c.a);\n    result.r += cm[1][0];\n\n    result.g = (cm[1][1] * c.r);\n    result.g += (cm[1][2] * c.g);\n    result.g += (cm[1][3] * c.b);\n    result.g += (cm[2][0] * c.a);\n    result.g += cm[2][1];\n\n    result.b = (cm[2][2] * c.r);\n    result.b += (cm[2][3] * c.g);\n    result.b += (cm[3][0] * c.b);\n    result.b += (cm[3][1] * c.a);\n    result.b += cm[3][2];\n\n    result.a = (cm[3][3] * c.r);\n    result.a += (cm[4][0] * c.g);\n    result.a += (cm[4][1] * c.b);\n    result.a += (cm[4][2] * c.a);\n    result.a += cm[4][3];\n\n    var rgb = mix(c.rgb, result.rgb, colorMatrixUniforms.uAlpha);\n\n    rgb.r *= result.a;\n    rgb.g *= result.a;\n    rgb.b *= result.a;\n\n    return vec4(rgb, result.a);\n}";var sO="\nin vec2 vTextureCoord;\nin vec2 vFilterUv;\n\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMapTexture;\n\nuniform vec4 uInputClamp;\nuniform highp vec4 uInputSize;\nuniform mat2 uRotation;\nuniform vec2 uScale;\n\nvoid main()\n{\n    vec4 map = texture(uMapTexture, vFilterUv);\n    \n    vec2 offset = uInputSize.zw * (uRotation * (map.xy - 0.5)) * uScale; \n\n    finalColor = texture(uTexture, clamp(vTextureCoord + offset, uInputClamp.xy, uInputClamp.zw));\n}\n",aO="in vec2 aPosition;\nout vec2 vTextureCoord;\nout vec2 vFilterUv;\n\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nuniform mat3 uFilterMatrix;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvec2 getFilterCoord( void )\n{\n  return ( uFilterMatrix * vec3( filterTextureCoord(), 1.0)  ).xy;\n}\n\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n    vFilterUv = getFilterCoord();\n}\n",oO="\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct DisplacementUniforms {\n  uFilterMatrix:mat3x3<f32>,\n  uScale:vec2<f32>,\n  uRotation:mat2x2<f32>\n};\n\n\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> filterUniforms : DisplacementUniforms;\n@group(1) @binding(1) var uMapTexture: texture_2d<f32>;\n@group(1) @binding(2) var uMapSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) filterUv : vec2<f32>,\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}\n\nfn getSize() -> vec2<f32>\n{\n\n  \n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition),\n   getFilterCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) filterUv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n\n    var map = textureSample(uMapTexture, uMapSampler, filterUv);\n\n    var offset =  gfu.uInputSize.zw * (filterUniforms.uRotation * (map.xy - 0.5)) * filterUniforms.uScale; \n   \n    return textureSample(uTexture, uSampler, clamp(uv + offset, gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n}";var lO="\nin vec2 vTextureCoord;\nin vec4 vColor;\n\nout vec4 finalColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uTexture;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) *  uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    finalColor = color;\n}\n",hO="\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct NoiseUniforms {\n  uNoise:f32,\n  uSeed:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> noiseUniforms : NoiseUniforms;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\nfn rand(co:vec2<f32>) -> f32\n{\n  return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\n\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n\n    var pixelPosition =  globalTextureCoord(position.xy);// / (getSize());//-  gfu.uOutputFrame.xy);\n  \n    \n    var sample = textureSample(uTexture, uSampler, uv);\n    var randomValue =  rand(pixelPosition.xy * noiseUniforms.uSeed);\n    var diff = (randomValue - 0.5) * noiseUniforms.uNoise;\n  \n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (sample.a > 0.0) {\n      sample.r /= sample.a;\n      sample.g /= sample.a;\n      sample.b /= sample.a;\n    }\n\n    sample.r += diff;\n    sample.g += diff;\n    sample.b += diff;\n\n    // Premultiply alpha again.\n    sample.r *= sample.a;\n    sample.g *= sample.a;\n    sample.b *= sample.a;\n    \n    return sample;\n}";const cO=class t extends OS{constructor(e={}){e={...t.defaultOptions,...e};const n=xS.from({vertex:{source:hO,entryPoint:"mainVertex"},fragment:{source:hO,entryPoint:"mainFragment"}}),i=lS.from({vertex:HI,fragment:lO,name:"noise-filter"}),{noise:r,seed:s,...a}=e;super({...a,gpuProgram:n,glProgram:i,resources:{noiseUniforms:new TS({uNoise:{value:1,type:"f32"},uSeed:{value:1,type:"f32"}})}}),this.noise=r,this.seed=s??Math.random()}get noise(){return this.resources.noiseUniforms.uniforms.uNoise}set noise(t){this.resources.noiseUniforms.uniforms.uNoise=t}get seed(){return this.resources.noiseUniforms.uniforms.uSeed}set seed(t){this.resources.noiseUniforms.uniforms.uSeed=t}};cO.defaultOptions={noise:.5};let uO=cO;class dO{constructor(t){this._renderer=t}push(t,e,n){this._renderer.renderPipes.batch.break(n),n.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,n){this._renderer.renderPipes.batch.break(n),n.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this._renderer.filter.push(t):"popFilter"===t.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}function pO(t,e){e.clear();const n=e.matrix;for(let i=0;i<t.length;i++){const n=t[i];n.globalDisplayStatus<7||(e.matrix=n.worldTransform,e.addBounds(n.bounds))}return e.matrix=n,e}dO.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"filter"};const fO=new QT({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class mO{constructor(){this.skip=!1,this.inputTexture=null,this.backTexture=null,this.filters=null,this.bounds=new cx,this.container=null,this.blendRequired=!1,this.outputRenderSurface=null,this.globalFrame={x:0,y:0,width:0,height:0}}}class gO{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new TS({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new MS({}),this.renderer=t}get activeBackTexture(){var t;return null==(t=this._activeFilterData)?void 0:t.backTexture}push(t){const e=this.renderer,n=t.filterEffect.filters,i=this._pushFilterData();i.skip=!1,i.filters=n,i.container=t.container,i.outputRenderSurface=e.renderTarget.renderSurface;const r=e.renderTarget.renderTarget.colorTexture.source,s=r.resolution,a=r.antialias;if(0===n.length)return void(i.skip=!0);const o=i.bounds;if(this._calculateFilterArea(t,o),this._calculateFilterBounds(i,e.renderTarget.rootViewPort,a,s,1),i.skip)return;const l=this._getPreviousFilterData(),h=this._findFilterResolution(s);let c=0,u=0;l&&(c=l.bounds.minX,u=l.bounds.minY),this._calculateGlobalFrame(i,c,u,h,r.width,r.height),this._setupFilterTextures(i,o,e,l)}generateFilteredTexture({texture:t,filters:e}){const n=this._pushFilterData();this._activeFilterData=n,n.skip=!1,n.filters=e;const i=t.source,r=i.resolution,s=i.antialias;if(0===e.length)return n.skip=!0,t;const a=n.bounds;if(a.addRect(t.frame),this._calculateFilterBounds(n,a.rectangle,s,r,0),n.skip)return t;const o=r;this._calculateGlobalFrame(n,0,0,o,i.width,i.height),n.outputRenderSurface=Ab.getOptimalTexture(a.width,a.height,n.resolution,n.antialias),n.backTexture=ox.EMPTY,n.inputTexture=t;this.renderer.renderTarget.finishRenderPass(),this._applyFiltersToTexture(n,!0);const l=n.outputRenderSurface;return l.source.alphaMode="premultiplied-alpha",l}pop(){const t=this.renderer,e=this._popFilterData();e.skip||(t.globalUniforms.pop(),t.renderTarget.finishRenderPass(),this._activeFilterData=e,this._applyFiltersToTexture(e,!1),e.blendRequired&&Ab.returnTexture(e.backTexture),Ab.returnTexture(e.inputTexture))}getBackTexture(t,e,n){const i=t.colorTexture.source._resolution,r=Ab.getOptimalTexture(e.width,e.height,i,!1);let s=e.minX,a=e.minY;n&&(s-=n.minX,a-=n.minY),s=Math.floor(s*i),a=Math.floor(a*i);const o=Math.ceil(e.width*i),l=Math.ceil(e.height*i);return this.renderer.renderTarget.copyToTexture(t,r,{x:s,y:a},{width:o,height:l},{x:0,y:0}),r}applyFilter(t,e,n,i){const r=this.renderer,s=this._activeFilterData,a=s.outputRenderSurface===n,o=r.renderTarget.rootRenderTarget.colorTexture.source._resolution,l=this._findFilterResolution(o);let h=0,c=0;if(a){const t=this._findPreviousFilterOffset();h=t.x,c=t.y}this._updateFilterUniforms(e,n,s,h,c,l,a,i),this._setupBindGroupsAndRender(t,e,r)}calculateSpriteMatrix(t,e){const n=this._activeFilterData,i=t.set(n.inputTexture._source.width,0,0,n.inputTexture._source.height,n.bounds.minX,n.bounds.minY),r=e.worldTransform.copyTo(Ry.shared),s=e.renderGroup||e.parentRenderGroup;return s&&s.cacheToLocalTransform&&r.prepend(s.cacheToLocalTransform),r.invert(),i.prepend(r),i.scale(1/e.texture.frame.width,1/e.texture.frame.height),i.translate(e.anchor.x,e.anchor.y),i}destroy(){}_setupBindGroupsAndRender(t,e,n){if(n.renderPipes.uniformBatch){const t=n.renderPipes.uniformBatch.getUboResource(this._filterGlobalUniforms);this._globalFilterBindGroup.setResource(t,0)}else this._globalFilterBindGroup.setResource(this._filterGlobalUniforms,0);this._globalFilterBindGroup.setResource(e.source,1),this._globalFilterBindGroup.setResource(e.source.style,2),t.groups[0]=this._globalFilterBindGroup,n.encoder.draw({geometry:fO,shader:t,state:t._state,topology:"triangle-list"}),n.type===AS.WEBGL&&n.renderTarget.finishRenderPass()}_setupFilterTextures(t,e,n,i){if(t.backTexture=ox.EMPTY,t.blendRequired){n.renderTarget.finishRenderPass();const r=n.renderTarget.getRenderTarget(t.outputRenderSurface);t.backTexture=this.getBackTexture(r,e,null==i?void 0:i.bounds)}t.inputTexture=Ab.getOptimalTexture(e.width,e.height,t.resolution,t.antialias),n.renderTarget.bind(t.inputTexture,!0),n.globalUniforms.push({offset:e})}_calculateGlobalFrame(t,e,n,i,r,s){const a=t.globalFrame;a.x=e*i,a.y=n*i,a.width=r*i,a.height=s*i}_updateFilterUniforms(t,e,n,i,r,s,a,o){const l=this._filterGlobalUniforms.uniforms,h=l.uOutputFrame,c=l.uInputSize,u=l.uInputPixel,d=l.uInputClamp,p=l.uGlobalFrame,f=l.uOutputTexture;a?(h[0]=n.bounds.minX-i,h[1]=n.bounds.minY-r):(h[0]=0,h[1]=0),h[2]=t.frame.width,h[3]=t.frame.height,c[0]=t.source.width,c[1]=t.source.height,c[2]=1/c[0],c[3]=1/c[1],u[0]=t.source.pixelWidth,u[1]=t.source.pixelHeight,u[2]=1/u[0],u[3]=1/u[1],d[0]=.5*u[2],d[1]=.5*u[3],d[2]=t.frame.width*c[2]-.5*u[2],d[3]=t.frame.height*c[3]-.5*u[3];const m=this.renderer.renderTarget.rootRenderTarget.colorTexture;p[0]=i*s,p[1]=r*s,p[2]=m.source.width*s,p[3]=m.source.height*s,e instanceof ox&&(e.source.resource=null);const g=this.renderer.renderTarget.getRenderTarget(e);this.renderer.renderTarget.bind(e,!!o),e instanceof ox?(f[0]=e.frame.width,f[1]=e.frame.height):(f[0]=g.width,f[1]=g.height),f[2]=g.isRoot?-1:1,this._filterGlobalUniforms.update()}_findFilterResolution(t){let e=this._filterStackIndex-1;for(;e>0&&this._filterStack[e].skip;)--e;return e>0&&this._filterStack[e].inputTexture?this._filterStack[e].inputTexture.source._resolution:t}_findPreviousFilterOffset(){let t=0,e=0,n=this._filterStackIndex;for(;n>0;){n--;const i=this._filterStack[n];if(!i.skip){t=i.bounds.minX,e=i.bounds.minY;break}}return{x:t,y:e}}_calculateFilterArea(t,e){if(t.renderables?pO(t.renderables,e):t.filterEffect.filterArea?(e.clear(),e.addRect(t.filterEffect.filterArea),e.applyMatrix(t.container.worldTransform)):t.container.getFastGlobalBounds(!0,e),t.container){const n=(t.container.renderGroup||t.container.parentRenderGroup).cacheToLocalTransform;n&&e.applyMatrix(n)}}_applyFiltersToTexture(t,e){const n=t.inputTexture,i=t.bounds,r=t.filters;if(this._globalFilterBindGroup.setResource(n.source.style,2),this._globalFilterBindGroup.setResource(t.backTexture.source,3),1===r.length)r[0].apply(this,n,t.outputRenderSurface,e);else{let n=t.inputTexture;const s=Ab.getOptimalTexture(i.width,i.height,n.source._resolution,!1);let a=s,o=0;for(o=0;o<r.length-1;++o){r[o].apply(this,n,a,!0);const t=n;n=a,a=t}r[o].apply(this,n,t.outputRenderSurface,e),Ab.returnTexture(s)}}_calculateFilterBounds(t,e,n,i,r){var s;const a=this.renderer,o=t.bounds,l=t.filters;let h=1/0,c=0,u=!0,d=!1,p=!1,f=!0;for(let m=0;m<l.length;m++){const t=l[m];h=Math.min(h,"inherit"===t.resolution?i:t.resolution),c+=t.padding,"off"===t.antialias?u=!1:"inherit"===t.antialias&&u&&(u=n),t.clipToViewport||(f=!1);if(!!!(t.compatibleRenderers&a.type)){p=!1;break}if(t.blendRequired&&!((null==(s=a.backBuffer)?void 0:s.useBackBuffer)??1)){Vx(),p=!1;break}p=t.enabled||p,d||(d=t.blendRequired)}p?(f&&o.fitBounds(0,e.width/i,0,e.height/i),o.scale(h).ceil().scale(1/h).pad((0|c)*r),o.isPositive?(t.antialias=u,t.resolution=h,t.blendRequired=d):t.skip=!0):t.skip=!0}_popFilterData(){return this._filterStackIndex--,this._filterStack[this._filterStackIndex]}_getPreviousFilterData(){let t,e=this._filterStackIndex-1;for(;e>1&&(e--,t=this._filterStack[e],t.skip););return t}_pushFilterData(){let t=this._filterStack[this._filterStackIndex];return t||(t=this._filterStack[this._filterStackIndex]=new mO),this._filterStackIndex++,t}}gO.extension={type:[fy.WebGLSystem,fy.WebGPUSystem],name:"filter"};var vO="in vec2 vMaskCoord;\nin vec2 vTextureCoord;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMaskTexture;\n\nuniform float uAlpha;\nuniform vec4 uMaskClamp;\nuniform float uInverse;\n\nout vec4 finalColor;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(uMaskClamp.x, vMaskCoord.x) +\n        step(uMaskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, uMaskClamp.z) +\n        step(vMaskCoord.y, uMaskClamp.w));\n\n    // TODO look into why this is needed\n    float npmAlpha = uAlpha;\n    vec4 original = texture(uTexture, vTextureCoord);\n    vec4 masky = texture(uMaskTexture, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    float a = alphaMul * masky.r * npmAlpha * clip;\n\n    if (uInverse == 1.0) {\n        a = 1.0 - a;\n    }\n\n    finalColor = original * a;\n}\n",yO="in vec2 aPosition;\n\nout vec2 vTextureCoord;\nout vec2 vMaskCoord;\n\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\nuniform mat3 uFilterMatrix;\n\nvec4 filterVertexPosition(  vec2 aPosition )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n       \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord(  vec2 aPosition )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvec2 getFilterCoord( vec2 aPosition )\n{\n    return  ( uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}   \n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition(aPosition);\n    vTextureCoord = filterTextureCoord(aPosition);\n    vMaskCoord = getFilterCoord(aPosition);\n}\n",xO="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct MaskUniforms {\n  uFilterMatrix:mat3x3<f32>,\n  uMaskClamp:vec4<f32>,\n  uAlpha:f32,\n  uInverse:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> filterUniforms : MaskUniforms;\n@group(1) @binding(1) var uMaskTexture: texture_2d<f32>;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) filterUv : vec2<f32>,\n};\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);\n}\n\nfn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>,\n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition),\n   getFilterCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) filterUv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n\n    var maskClamp = filterUniforms.uMaskClamp;\n    var uAlpha = filterUniforms.uAlpha;\n\n    var clip = step(3.5,\n      step(maskClamp.x, filterUv.x) +\n      step(maskClamp.y, filterUv.y) +\n      step(filterUv.x, maskClamp.z) +\n      step(filterUv.y, maskClamp.w));\n\n    var mask = textureSample(uMaskTexture, uSampler, filterUv);\n    var source = textureSample(uTexture, uSampler, uv);\n    var alphaMul = 1.0 - uAlpha * (1.0 - mask.a);\n\n    var a: f32 = alphaMul * mask.r * uAlpha * clip;\n\n    if (filterUniforms.uInverse == 1.0) {\n        a = 1.0 - a;\n    }\n\n    return source * a;\n}\n";class bO extends OS{constructor(t){const{sprite:e,...n}=t,i=new ax(e.texture),r=new TS({uFilterMatrix:{value:new Ry,type:"mat3x3<f32>"},uMaskClamp:{value:i.uClampFrame,type:"vec4<f32>"},uAlpha:{value:1,type:"f32"},uInverse:{value:t.inverse?1:0,type:"f32"}});super({...n,gpuProgram:xS.from({vertex:{source:xO,entryPoint:"mainVertex"},fragment:{source:xO,entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:yO,fragment:vO,name:"mask-filter"}),resources:{filterUniforms:r,uMaskTexture:e.texture.source}}),this.sprite=e,this._textureMatrix=i}set inverse(t){this.resources.filterUniforms.uniforms.uInverse=t?1:0}get inverse(){return 1===this.resources.filterUniforms.uniforms.uInverse}apply(t,e,n,i){this._textureMatrix.texture=this.sprite.texture,t.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.uFilterMatrix,this.sprite).prepend(this._textureMatrix.mapCoord),this.resources.uMaskTexture=this.sprite.texture.source,t.applyFilter(this,e,n,i)}}function _O(t,e,n,i,r,s,a,o){const l=a-n,h=o-i,c=r-n,u=s-i,d=t-n,p=e-i,f=l*l+h*h,m=l*c+h*u,g=l*d+h*p,v=c*c+u*u,y=c*d+u*p,x=1/(f*v-m*m),b=(v*g-m*y)*x,_=(f*y-m*g)*x;return b>=0&&_>=0&&b+_<1}class SO{constructor(t=0,e=0,n=0,i=0,r=0,s=0){this.type="triangle",this.x=t,this.y=e,this.x2=n,this.y2=i,this.x3=r,this.y3=s}contains(t,e){const n=(this.x-this.x3)*(e-this.y3)-(this.y-this.y3)*(t-this.x3),i=(this.x2-this.x)*(e-this.y)-(this.y2-this.y)*(t-this.x);if(n<0!=i<0&&0!==n&&0!==i)return!1;const r=(this.x3-this.x2)*(e-this.y2)-(this.y3-this.y2)*(t-this.x2);return 0===r||r<0==n+i<=0}strokeContains(t,e,n,i=.5){const r=n/2,s=r*r,{x:a,x2:o,x3:l,y:h,y2:c,y3:u}=this;return wT(t,e,a,h,o,u)<=s||wT(t,e,o,c,l,u)<=s||wT(t,e,l,u,a,h)<=s}clone(){return new SO(this.x,this.y,this.x2,this.y2,this.x3,this.y3)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x2=t.x2,this.y2=t.y2,this.x3=t.x3,this.y3=t.y3,this}copyTo(t){return t.copyFrom(this),t}getBounds(t){t||(t=new Hy);const e=Math.min(this.x,this.x2,this.x3),n=Math.max(this.x,this.x2,this.x3),i=Math.min(this.y,this.y2,this.y3),r=Math.max(this.y,this.y2,this.y3);return t.x=e,t.y=i,t.width=n-e,t.height=r-i,t}}const wO=class t{constructor(e){this._tick=()=>{this.timeout=setTimeout(this._processQueue,0)},this._processQueue=()=>{const{queue:e}=this;let n=0;for(;e.length&&n<t.uploadsPerFrame;){const t=e.shift();this.uploadQueueItem(t),n++}e.length?Qb.system.addOnce(this._tick,this,qb.UTILITY):this._resolve()},this.renderer=e,this.queue=[],this.resolves=[]}getQueue(){return[...this.queue]}add(t){const e=Array.isArray(t)?t:[t];for(const n of e)n instanceof Db?this._addContainer(n):this.resolveQueueItem(n,this.queue);return this}_addContainer(t){this.resolveQueueItem(t,this.queue);for(const e of t.children)this._addContainer(e)}upload(t){return t&&this.add(t),new Promise(t=>{this.queue.length?(this.resolves.push(t),this.dedupeQueue(),Qb.system.addOnce(this._tick,this,qb.UTILITY)):t()})}dedupeQueue(){const t=Object.create(null);let e=0;for(let n=0;n<this.queue.length;n++){const i=this.queue[n];t[i.uid]||(t[i.uid]=!0,this.queue[e++]=i)}this.queue.length=e}_resolve(){const{resolves:t}=this,e=t.slice(0);t.length=0;for(const n of e)n()}};wO.uploadsPerFrame=4;let TO=wO,MO=class t extends Bb{constructor(t){t instanceof aE&&(t={context:t});const{context:e,roundPixels:n,...i}=t||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",this._context=e||(this._ownedContext=new aE),this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=n??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):!0!==t&&!0!==(null==t?void 0:t.context)||this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(e=!1){if(e)return new t(this._context.clone());this._ownedContext=null;return new t(this._context)}lineStyle(t,e,n){qy(0,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const i={};return t&&(i.width=t),e&&(i.color=e),n&&(i.alpha=n),this.context.strokeStyle=i,this}beginFill(t,e){qy(0,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const n={};return void 0!==t&&(n.color=t),void 0!==e&&(n.alpha=e),this.context.fillStyle=n,this}endFill(){qy(0,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return t.width===aE.defaultStrokeStyle.width&&t.color===aE.defaultStrokeStyle.color&&t.alpha===aE.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(...t){return qy(0,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return qy(0,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return qy(0,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return qy(0,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return qy(0,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return qy(0,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}};const AO=class t extends QT{constructor(...e){let n=e[0]??{};n instanceof Float32Array&&(qy(0,"use new MeshGeometry({ positions, uvs, indices }) instead"),n={positions:n,uvs:e[1],indices:e[2]}),n={...t.defaultOptions,...n};const i=n.positions||new Float32Array([0,0,1,0,1,1,0,1]);let r=n.uvs;r||(r=n.positions?new Float32Array(i.length):new Float32Array([0,0,1,0,1,1,0,1]));const s=n.indices||new Uint32Array([0,1,2,0,2,3]),a=n.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new KT({data:i,label:"attribute-mesh-positions",shrinkToFit:a,usage:qT.VERTEX|qT.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new KT({data:r,label:"attribute-mesh-uvs",shrinkToFit:a,usage:qT.VERTEX|qT.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new KT({data:s,label:"index-mesh-buffer",shrinkToFit:a,usage:qT.INDEX|qT.COPY_DST}),topology:n.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};AO.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let EO=AO,CO=class extends Bb{constructor(...t){let e=t[0];e instanceof QT&&(qy(0,"Mesh: use new Mesh({ geometry, shader }) instead"),e={geometry:e,shader:t[1]},t[3]&&(qy(0,"Mesh: drawMode argument has been removed, use geometry.topology instead"),e.geometry.topology=t[3]));const{geometry:n,shader:i,texture:r,roundPixels:s,state:a,...o}=e;super({label:"Mesh",...o}),this.renderPipeId="mesh",this._shader=null,this.allowChildren=!1,this.shader=i??null,this.texture=r??(null==i?void 0:i.texture)??ox.WHITE,this.state=a??RS.for2d(),this._geometry=n,this._geometry.on("update",this.onViewUpdate,this),this.roundPixels=s??!1}get material(){return qy(0,"mesh.material property has been removed, use mesh.shader instead"),this._shader}set shader(t){this._shader!==t&&(this._shader=t,this.onViewUpdate())}get shader(){return this._shader}set geometry(t){var e;this._geometry!==t&&(null==(e=this._geometry)||e.off("update",this.onViewUpdate,this),t.on("update",this.onViewUpdate,this),this._geometry=t,this.onViewUpdate())}get geometry(){return this._geometry}set texture(t){t||(t=ox.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this.shader&&(this.shader.texture=t),this._texture=t,this.onViewUpdate())}get texture(){return this._texture}get batched(){return!this._shader&&(!(12&this.state.data)&&(this._geometry instanceof EO&&("auto"===this._geometry.batchMode?this._geometry.positions.length/2<=100:"batch"===this._geometry.batchMode)))}get bounds(){return this._geometry.bounds}updateBounds(){this._bounds=this._geometry.bounds}containsPoint(t){const{x:e,y:n}=t;if(!this.bounds.containsPoint(e,n))return!1;const i=this.geometry.getBuffer("aPosition").data,r="triangle-strip"===this.geometry.topology?3:1;if(this.geometry.getIndex()){const t=this.geometry.getIndex().data,s=t.length;for(let a=0;a+2<s;a+=r){const r=2*t[a],s=2*t[a+1],o=2*t[a+2];if(_O(e,n,i[r],i[r+1],i[s],i[s+1],i[o],i[o+1]))return!0}}else{const t=i.length/2;for(let s=0;s+2<t;s+=r){const t=2*s,r=2*(s+1),a=2*(s+2);if(_O(e,n,i[t],i[t+1],i[r],i[r+1],i[a],i[a+1]))return!0}}return!1}destroy(t){var e;super.destroy(t);if("boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._texture.destroy(e)}null==(e=this._geometry)||e.off("update",this.onViewUpdate,this),this._texture=null,this._geometry=null,this._shader=null,this._gpuData=null}},PO=class t extends Fb{constructor(...t){let e=t[0];Array.isArray(t[0])&&(e={textures:t[0],autoUpdate:t[1]});const{animationSpeed:n=1,autoPlay:i=!1,autoUpdate:r=!0,loop:s=!0,onComplete:a=null,onFrameChange:o=null,onLoop:l=null,textures:h,updateAnchor:c=!1,...u}=e,[d]=h;super({...u,texture:d instanceof ox?d:d.texture}),this._textures=null,this._durations=null,this._autoUpdate=r,this._isConnectedToTicker=!1,this.animationSpeed=n,this.loop=s,this.updateAnchor=c,this.onComplete=a,this.onFrameChange=o,this.onLoop=l,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=h,i&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Qb.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Qb.shared.add(this.update,this,qb.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=t.deltaTime,n=this.animationSpeed*e,i=this.currentFrame;if(null!==this._durations){let t=this._currentTime%1*this._durations[this.currentFrame];for(t+=n/60*1e3;t<0;)this._currentTime--,t+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);t>=this._durations[this.currentFrame];)t-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=t/this._durations[this.currentFrame]}else this._currentTime+=n;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this._updateTexture())}_updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this.texture=this._textures[t],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const n=[];for(let t=0;t<e.length;++t)n.push(ox.from(e[t]));return new t(n)}static fromImages(e){const n=[];for(let t=0;t<e.length;++t)n.push(ox.from(e[t]));return new t(n)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof ox)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Qb.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Qb.shared.add(this.update,this),this._isConnectedToTicker=!0))}},RO=class{constructor({matrix:t,observer:e}={}){this.dirty=!0,this._matrix=t??new Ry,this.observer=e,this.position=new by(this,0,0),this.scale=new by(this,1,1),this.pivot=new by(this,0,0),this.skew=new by(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const t=this._matrix;return this.dirty?(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this.dirty=!1,t):t}_onUpdate(t){var e;this.dirty=!0,t===this.skew&&this.updateSkew(),null==(e=this.observer)||e._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(t){t.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this.skew))}};const IO=class t extends Bb{constructor(...e){let n=e[0]||{};n instanceof ox&&(n={texture:n}),e.length>1&&(qy(0,"use new TilingSprite({ texture, width:100, height:100 }) instead"),n.width=e[1],n.height=e[2]),n={...t.defaultOptions,...n};const{texture:i,anchor:r,tilePosition:s,tileScale:a,tileRotation:o,width:l,height:h,applyAnchorToTexture:c,roundPixels:u,...d}=n??{};super({label:"TilingSprite",...d}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new by({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=c,this.texture=i,this._width=l??i.width,this._height=h??i.height,this._tileTransform=new RO({observer:{_onUpdate:()=>this.onViewUpdate()}}),r&&(this.anchor=r),this.tilePosition=s,this.tileScale=a,this.tileRotation=o,this.roundPixels=u??!1}static from(e,n={}){return new t("string"==typeof e?{texture:i_.get(e),...n}:{texture:e,...n})}get uvRespectAnchor(){return Vx(),this.applyAnchorToTexture}set uvRespectAnchor(t){Vx(),this.applyAnchorToTexture=t}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(t){this._texture.textureMatrix.clampMargin=t}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get tilePosition(){return this._tileTransform.position}set tilePosition(t){this._tileTransform.position.copyFrom(t)}get tileScale(){return this._tileTransform.scale}set tileScale(t){"number"==typeof t?this._tileTransform.scale.set(t):this._tileTransform.scale.copyFrom(t)}set tileRotation(t){this._tileTransform.rotation=t}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(t){t||(t=ox.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get texture(){return this._texture}set width(t){this._width=t,this.onViewUpdate()}get width(){return this._width}set height(t){this._height=t,this.onViewUpdate()}get height(){return this._height}setSize(t,e){"object"==typeof t&&(e=t.height??t.width,t=t.width),this._width=t,this._height=e??t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}updateBounds(){const t=this._bounds,e=this._anchor,n=this._width,i=this._height;t.minX=-e._x*n,t.maxX=t.minX+n,t.minY=-e._y*i,t.maxY=t.minY+i}containsPoint(t){const e=this._width,n=this._height,i=-e*this._anchor._x;let r=0;return t.x>=i&&t.x<=i+e&&(r=-n*this._anchor._y,t.y>=r&&t.y<=r+n)}destroy(t=!1){super.destroy(t),this._anchor=null,this._tileTransform=null,this._bounds=null;if("boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._texture.destroy(e)}this._texture=null}};IO.defaultOptions={texture:ox.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let OO=IO;class DO extends Bb{constructor(t,e){const{text:n,resolution:i,style:r,anchor:s,width:a,height:o,roundPixels:l,...h}=t;super({...h}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=n??"",this.style=r,this.resolution=i??null,this.allowChildren=!1,this._anchor=new by({_onUpdate:()=>{this.onViewUpdate()}}),s&&(this.anchor=s),this.roundPixels=l??!1,void 0!==a&&(this.width=a),void 0!==o&&(this.height=o)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=null===t,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){var e;t||(t={}),null==(e=this._style)||e.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){"object"==typeof t?(e=t.height??t.width,t=t.width):e??(e=t),void 0!==t&&this._setWidth(t,this.bounds.width),void 0!==e&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,n=this.bounds.height,i=-e*this.anchor.x;let r=0;return t.x>=i&&t.x<=i+e&&(r=-n*this.anchor.y,t.y>=r&&t.y<=r+n)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,("boolean"==typeof t?t:null==t?void 0:t.style)&&this._style.destroy(t),this._style=null,this._text=null}}function BO(t,e){let n=t[0]??{};return("string"==typeof n||t[1])&&(qy(0,`use new ${e}({ text: "hi!", style }) instead`),n={text:n,style:t[1]}),n}let FO=null,LO=null;function UO(t,e,n){for(let i=0,r=4*n*e;i<e;++i,r+=4)if(0!==t[r+3])return!1;return!0}function kO(t,e,n,i,r){const s=4*e;for(let a=i,o=i*s+4*n;a<=r;++a,o+=s)if(0!==t[o+3])return!1;return!0}function NO(...t){let e=t[0];e.canvas||(e={canvas:t[0],resolution:t[1]});const{canvas:n}=e,i=Math.min(e.resolution??1,1),r=e.width??n.width,s=e.height??n.height;let a=e.output;if(function(t,e){FO||(FO=Wb.get().createCanvas(256,128),LO=FO.getContext("2d",{willReadFrequently:!0}),LO.globalCompositeOperation="copy",LO.globalAlpha=1),(FO.width<t||FO.height<e)&&(FO.width=Jy(t),FO.height=Jy(e))}(r,s),!LO)throw new TypeError("Failed to get canvas 2D context");LO.drawImage(n,0,0,r,s,0,0,r*i,s*i);const o=LO.getImageData(0,0,r,s).data;let l=0,h=0,c=r-1,u=s-1;for(;h<s&&UO(o,r,h);)++h;if(h===s)return Hy.EMPTY;for(;UO(o,r,u);)--u;for(;kO(o,r,l,h,u);)++l;for(;kO(o,r,c,h,u);)--c;return++c,++u,LO.globalCompositeOperation="source-over",LO.strokeRect(l,h,c-l,u-h),LO.globalCompositeOperation="copy",a??(a=new Hy),a.set(l/i,h/i,(c-l)/i,(u-h)/i),a}const zO=new Hy;const GO=new class{getCanvasAndContext(t){const{text:e,style:n,resolution:i=1}=t,r=n._getFinalPadding(),s=oT.measureText(e||" ",n),a=Math.ceil(Math.ceil(Math.max(1,s.width)+2*r)*i),o=Math.ceil(Math.ceil(Math.max(1,s.height)+2*r)*i),l=pE.getOptimalCanvasAndContext(a,o);this._renderTextToCanvas(e,n,r,i,l);return{canvasAndContext:l,frame:n.trim?NO({canvas:l.canvas,width:a,height:o,resolution:1,output:zO}):zO.set(0,0,a,o)}}returnCanvasAndContext(t){pE.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,n,i,r){var s,a,o,l;const{canvas:h,context:c}=r,u=rT(e),d=oT.measureText(t||" ",e),p=d.lines,f=d.lineHeight,m=d.lineWidths,g=d.maxLineWidth,v=d.fontProperties,y=h.height;if(c.resetTransform(),c.scale(i,i),c.textBaseline=e.textBaseline,null==(s=e._stroke)?void 0:s.width){const t=e._stroke;c.lineWidth=t.width,c.miterLimit=t.miterLimit,c.lineJoin=t.join,c.lineCap=t.cap}let x,b;c.font=u;const _=e.dropShadow?2:1;for(let S=0;S<_;++S){const t=e.dropShadow&&0===S,s=t?Math.ceil(Math.max(1,y)+2*n):0,h=s*i;if(t){c.fillStyle="black",c.strokeStyle="black";const t=e.dropShadow,n=t.color,r=t.alpha;c.shadowColor=zx.shared.setValue(n).setAlpha(r).toRgbaString();const s=t.blur*i,a=t.distance*i;c.shadowBlur=s,c.shadowOffsetX=Math.cos(t.angle)*a,c.shadowOffsetY=Math.sin(t.angle)*a+h}else{if(c.fillStyle=e._fill?mE(e._fill,c,d):null,null==(a=e._stroke)?void 0:a.width){const t=e._stroke.width*e._stroke.alignment;c.strokeStyle=mE(e._stroke,c,d,t)}c.shadowColor="black"}let u=(f-v.fontSize)/2;f-v.fontSize<0&&(u=0);const _=(null==(o=e._stroke)?void 0:o.width)??0;for(let i=0;i<p.length;i++)x=_/2,b=_/2+i*f+v.ascent+u,"right"===e.align?x+=g-m[i]:"center"===e.align&&(x+=(g-m[i])/2),(null==(l=e._stroke)?void 0:l.width)&&this._drawLetterSpacing(p[i],e,r,x+n,b+n-s,!0),void 0!==e._fill&&this._drawLetterSpacing(p[i],e,r,x+n,b+n-s)}}_drawLetterSpacing(t,e,n,i,r,s=!1){const{context:a}=n,o=e.letterSpacing;let l=!1;if(oT.experimentalLetterSpacingSupported&&(oT.experimentalLetterSpacing?(a.letterSpacing=`${o}px`,a.textLetterSpacing=`${o}px`,l=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),0===o||l)return void(s?a.strokeText(t,i,r):a.fillText(t,i,r));let h=i;const c=oT.graphemeSegmenter(t);let u=a.measureText(t).width,d=0;for(let p=0;p<c.length;++p){const t=c[p];s?a.strokeText(t,h,r):a.fillText(t,h,r);let e="";for(let n=p+1;n<c.length;++n)e+=c[n];d=a.measureText(e).width,h+=u-d+o,u=d}}};let HO=class extends DO{constructor(...t){const e=BO(t,"Text");super(e,uE),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof ex?e.textureStyle:new ex(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let n=0,i=0;if(this._style.trim){const{frame:t,canvasAndContext:e}=GO.getCanvasAndContext({text:this.text,style:this._style,resolution:1});GO.returnCanvasAndContext(e),n=t.width,i=t.height}else{const t=oT.measureText(this._text,this._style);n=t.width,i=t.height}t.minX=-e._x*n,t.maxX=t.minX+n,t.minY=-e._y*i,t.maxY=t.minY+i}};class VO extends TO{resolveQueueItem(t,e){return t instanceof Db?this.resolveContainerQueueItem(t,e):t instanceof ix||t instanceof ox?e.push(t.source):t instanceof aE&&e.push(t),null}resolveContainerQueueItem(t,e){t instanceof Fb||t instanceof OO||t instanceof CO?e.push(t.texture.source):t instanceof HO?e.push(t):t instanceof MO?e.push(t.context):t instanceof PO&&t.textures.forEach(t=>{t.source?e.push(t.source):e.push(t.texture.source)})}resolveGraphicsContextQueueItem(t){this.renderer.graphicsContext.getGpuContext(t);const{instructions:e}=t;for(const n of e){if("texture"===n.action){const{image:t}=n.data;return t.source}if("fill"===n.action){const{texture:t}=n.data.style;return t.source}}return null}}class XO extends DO{constructor(...t){var e;const n=BO(t,"BitmapText");n.style??(n.style=n.style||{}),(e=n.style).fill??(e.fill=16777215),super(n,uE),this.renderPipeId="bitmapText"}updateBounds(){const t=this._bounds,e=this._anchor,n=_E.measureText(this.text,this._style),i=n.scale,r=n.offsetY*i;let s=n.width*i,a=n.height*i;const o=this._style._stroke;o&&(s+=o.width,a+=o.width),t.minX=-e._x*s,t.maxX=t.minX+s,t.minY=-e._y*(a+r),t.maxY=t.minY+a}set resolution(t){null!==t&&Vx()}get resolution(){return this._resolution}}function WO(t){const e=t._stroke,n=t._fill,i=[`div { ${[`color: ${zx.shared.setValue(n.color).toHex()}`,`font-size: ${t.fontSize}px`,`font-family: ${t.fontFamily}`,`font-weight: ${t.fontWeight}`,`font-style: ${t.fontStyle}`,`font-variant: ${t.fontVariant}`,`letter-spacing: ${t.letterSpacing}px`,`text-align: ${t.align}`,`padding: ${t.padding}px`,`white-space: ${"pre"===t.whiteSpace&&t.wordWrap?"pre-wrap":t.whiteSpace}`,...t.lineHeight?[`line-height: ${t.lineHeight}px`]:[],...t.wordWrap?["word-wrap: "+(t.breakWords?"break-all":"break-word"),`max-width: ${t.wordWrapWidth}px`]:[],...e?[YO(e)]:[],...t.dropShadow?[jO(t.dropShadow)]:[],...t.cssOverrides].join(";")} }`];return function(t,e){for(const n in t){const i=t[n],r=[];for(const t in i)KO[t]?r.push(KO[t](i[t])):qO[t]&&r.push(qO[t].replace("{{VALUE}}",i[t]));e.push(`${n} { ${r.join(";")} }`)}}(t.tagStyles,i),i.join(" ")}function jO(t){const e=zx.shared.setValue(t.color).setAlpha(t.alpha).toHexa(),n=`${Math.round(Math.cos(t.angle)*t.distance)}px ${Math.round(Math.sin(t.angle)*t.distance)}px`;return t.blur>0?`text-shadow: ${n} ${t.blur}px ${e}`:`text-shadow: ${n} ${e}`}function YO(t){return[`-webkit-text-stroke-width: ${t.width}px`,`-webkit-text-stroke-color: ${zx.shared.setValue(t.color).toHex()}`,`text-stroke-width: ${t.width}px`,`text-stroke-color: ${zx.shared.setValue(t.color).toHex()}`,"paint-order: stroke"].join(";")}const qO={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},KO={fill:t=>`color: ${zx.shared.setValue(t).toHex()}`,breakWords:t=>"word-wrap: "+(t?"break-all":"break-word"),stroke:YO,dropShadow:jO};class JO extends uE{constructor(t={}){super(t),this._cssOverrides=[],this.cssOverrides=t.cssOverrides??[],this.tagStyles=t.tagStyles??{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}update(){this._cssStyle=null,super.update()}clone(){return new JO({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides,tagStyles:{...this.tagStyles}})}get cssStyle(){return this._cssStyle||(this._cssStyle=WO(this)),this._cssStyle}addOverride(...t){const e=t.filter(t=>!this.cssOverrides.includes(t));e.length>0&&(this.cssOverrides.push(...e),this.update())}removeOverride(...t){const e=t.filter(t=>this.cssOverrides.includes(t));e.length>0&&(this.cssOverrides=this.cssOverrides.filter(t=>!e.includes(t)),this.update())}set fill(t){"string"!=typeof t&&"number"!=typeof t&&Vx(),super.fill=t}set stroke(t){t&&"string"!=typeof t&&"number"!=typeof t&&Vx(),super.stroke=t}}const ZO="http://www.w3.org/2000/svg",QO="http://www.w3.org/1999/xhtml";class $O{constructor(){this.svgRoot=document.createElementNS(ZO,"svg"),this.foreignObject=document.createElementNS(ZO,"foreignObject"),this.domElement=document.createElementNS(QO,"div"),this.styleElement=document.createElementNS(QO,"style"),this.image=new Image;const{foreignObject:t,svgRoot:e,styleElement:n,domElement:i}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(n),t.appendChild(i)}}let tD;function eD(t,e,n,i){i||(i=tD||(tD=new $O));const{domElement:r,styleElement:s,svgRoot:a}=i;r.innerHTML=`<style>${e.cssStyle};</style><div style='padding:0'>${t}</div>`,r.setAttribute("style","transform-origin: top left; display: inline-block"),n&&(s.textContent=n),document.body.appendChild(a);const o=r.getBoundingClientRect();a.remove();const l=2*e.padding;return{width:o.width-l,height:o.height-l}}let nD=class extends DO{constructor(...t){const e=BO(t,"HtmlText");super(e,JO),this.renderPipeId="htmlText",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof ex?e.textureStyle:new ex(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor,n=eD(this.text,this._style),{width:i,height:r}=n;t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*r,t.maxY=t.minY+r}};class iD extends VO{uploadQueueItem(t){t instanceof ix?this.uploadTextureSource(t):t instanceof HO?this.uploadText(t):t instanceof nD?this.uploadHTMLText(t):t instanceof XO?this.uploadBitmapText(t):t instanceof aE&&this.uploadGraphicsContext(t)}uploadTextureSource(t){this.renderer.texture.initSource(t)}uploadText(t){this.renderer.renderPipes.text.initGpuText(t)}uploadBitmapText(t){this.renderer.renderPipes.bitmapText.initGpuText(t)}uploadHTMLText(t){this.renderer.renderPipes.htmlText.initGpuText(t)}uploadGraphicsContext(t){this.renderer.graphicsContext.getGpuContext(t);const{instructions:e}=t;for(const n of e)if("texture"===n.action){const{image:t}=n.data;this.uploadTextureSource(t.source)}else if("fill"===n.action){const{texture:t}=n.data.style;this.uploadTextureSource(t.source)}return null}}class rD extends iD{destroy(){clearTimeout(this.timeout),this.renderer=null,this.queue=null,this.resolves=null}}rD.extension={type:[fy.WebGLSystem,fy.WebGPUSystem],name:"prepare"};class sD{constructor(){this._tempState=RS.for2d(),this._didUploadHash={}}init(t){t.renderer.runners.contextChange.add(this)}contextChange(){this._didUploadHash={}}start(t,e,n){const i=t.renderer,r=this._didUploadHash[n.uid];i.shader.bind(n,r),r||(this._didUploadHash[n.uid]=!0),i.shader.updateUniformGroup(i.globalUniforms.uniformGroup),i.geometry.bind(e,n.glProgram)}execute(t,e){const n=t.renderer;this._tempState.blendMode=e.blendMode,n.state.set(this._tempState);const i=e.textures.textures;for(let r=0;r<e.textures.count;r++)n.texture.bind(i[r],r);n.geometry.draw(e.topology,e.size,e.start)}}sD.extension={type:[fy.WebGLPipesAdaptor],name:"batch"};const aD=RS.for2d();class oD{start(t,e,n){const i=t.renderer,r=i.encoder,s=n.gpuProgram;this._shader=n,this._geometry=e,r.setGeometry(e,s),aD.blendMode="normal",i.pipeline.getPipeline(e,s,aD);const a=i.globalUniforms.bindGroup;r.resetBindGroup(1),r.setBindGroup(0,a,s)}execute(t,e){const n=this._shader.gpuProgram,i=t.renderer,r=i.encoder;if(!e.bindGroup){const t=e.textures;e.bindGroup=CT(t.textures,t.count,i.limits.maxBatchableTextures)}aD.blendMode=e.blendMode;const s=i.bindGroup.getBindGroup(e.bindGroup,n,1),a=i.pipeline.getPipeline(this._geometry,n,aD,e.topology);e.bindGroup._touch(i.textureGC.count),r.setPipeline(a),r.renderPassEncoder.setBindGroup(1,s),r.renderPassEncoder.drawIndexed(e.size,1,e.start)}}oD.extension={type:[fy.WebGPUPipesAdaptor],name:"batch"};const lD=class t{constructor(t,e){var n,i;this.state=RS.for2d(),this._batchersByInstructionSet=Object.create(null),this._activeBatches=Object.create(null),this.renderer=t,this._adaptor=e,null==(i=(n=this._adaptor).init)||i.call(n,this)}static getBatcher(t){return new this._availableBatchers[t]}buildStart(t){let e=this._batchersByInstructionSet[t.uid];e||(e=this._batchersByInstructionSet[t.uid]=Object.create(null),e.default||(e.default=new HM({maxTextures:this.renderer.limits.maxBatchableTextures}))),this._activeBatches=e,this._activeBatch=this._activeBatches.default;for(const n in this._activeBatches)this._activeBatches[n].begin()}addToBatch(e,n){if(this._activeBatch.name!==e.batcherName){this._activeBatch.break(n);let i=this._activeBatches[e.batcherName];i||(i=this._activeBatches[e.batcherName]=t.getBatcher(e.batcherName),i.begin()),this._activeBatch=i}this._activeBatch.add(e)}break(t){this._activeBatch.break(t)}buildEnd(t){this._activeBatch.break(t);const e=this._activeBatches;for(const n in e){const t=e[n],i=t.geometry;i.indexBuffer.setDataWithSize(t.indexBuffer,t.indexSize,!0),i.buffers[0].setDataWithSize(t.attributeBuffer.float32View,t.attributeSize,!1)}}upload(t){const e=this._batchersByInstructionSet[t.uid];for(const n in e){const t=e[n],i=t.geometry;t.dirty&&(t.dirty=!1,i.buffers[0].update(4*t.attributeSize))}}execute(t){if("startBatch"===t.action){const e=t.batcher,n=e.geometry,i=e.shader;this._adaptor.start(this,n,i)}this._adaptor.execute(this,t)}destroy(){this.state=null,this.renderer=null,this._adaptor=null;for(const t in this._activeBatches)this._activeBatches[t].destroy();this._activeBatches=null}};lD.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"batch"},lD._availableBatchers=Object.create(null);let hD=lD;vy.handleByMap(fy.Batcher,hD._availableBatchers),vy.add(HM);const cD={name:"local-uniform-bit",vertex:{header:"\n\n            struct LocalUniforms {\n                uTransformMatrix:mat3x3<f32>,\n                uColor:vec4<f32>,\n                uRound:f32,\n            }\n\n            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "}},uD={...cD,vertex:{...cD.vertex,header:cD.vertex.header.replace("group(1)","group(2)")}},dD={name:"local-uniform-bit",vertex:{header:"\n\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix = uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "}},pD={name:"texture-bit",vertex:{header:"\n\n        struct TextureUniforms {\n            uTextureMatrix:mat3x3<f32>,\n        }\n\n        @group(2) @binding(2) var<uniform> textureUniforms : TextureUniforms;\n        ",main:"\n            uv = (textureUniforms.uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n            @group(2) @binding(0) var uTexture: texture_2d<f32>;\n            @group(2) @binding(1) var uSampler: sampler;\n\n\n        ",main:"\n            outColor = textureSample(uTexture, uSampler, vUV);\n        "}},fD={name:"texture-bit",vertex:{header:"\n            uniform mat3 uTextureMatrix;\n        ",main:"\n            uv = (uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n        uniform sampler2D uTexture;\n\n\n        ",main:"\n            outColor = texture(uTexture, vUV);\n        "}},mD=new cx;class gD extends Zx{constructor(){super(),this.filters=[new bO({sprite:new Fb(ox.EMPTY),inverse:!1,resolution:"inherit",antialias:"inherit"})]}get sprite(){return this.filters[0].sprite}set sprite(t){this.filters[0].sprite=t}get inverse(){return this.filters[0].inverse}set inverse(t){this.filters[0].inverse=t}}class vD{constructor(t){this._activeMaskStage=[],this._renderer=t}push(t,e,n){const i=this._renderer;if(i.renderPipes.batch.break(n),n.add({renderPipeId:"alphaMask",action:"pushMaskBegin",mask:t,inverse:e._maskOptions.inverse,canBundle:!1,maskedContainer:e}),t.inverse=e._maskOptions.inverse,t.renderMaskToTexture){const e=t.mask;e.includeInBuild=!0,e.collectRenderables(n,i,null),e.includeInBuild=!1}i.renderPipes.batch.break(n),n.add({renderPipeId:"alphaMask",action:"pushMaskEnd",mask:t,maskedContainer:e,inverse:e._maskOptions.inverse,canBundle:!1})}pop(t,e,n){this._renderer.renderPipes.batch.break(n),n.add({renderPipeId:"alphaMask",action:"popMaskEnd",mask:t,inverse:e._maskOptions.inverse,canBundle:!1})}execute(t){const e=this._renderer,n=t.mask.renderMaskToTexture;if("pushMaskBegin"===t.action){const i=jx.get(gD);if(i.inverse=t.inverse,n){t.mask.mask.measurable=!0;const n=ab(t.mask.mask,!0,mD);t.mask.mask.measurable=!1,n.ceil();const r=e.renderTarget.renderTarget.colorTexture.source,s=Ab.getOptimalTexture(n.width,n.height,r._resolution,r.antialias);e.renderTarget.push(s,!0),e.globalUniforms.push({offset:n,worldColor:4294967295});const a=i.sprite;a.texture=s,a.worldTransform.tx=n.minX,a.worldTransform.ty=n.minY,this._activeMaskStage.push({filterEffect:i,maskedContainer:t.maskedContainer,filterTexture:s})}else i.sprite=t.mask.mask,this._activeMaskStage.push({filterEffect:i,maskedContainer:t.maskedContainer})}else if("pushMaskEnd"===t.action){const t=this._activeMaskStage[this._activeMaskStage.length-1];n&&(e.type===AS.WEBGL&&e.renderTarget.finishRenderPass(),e.renderTarget.pop(),e.globalUniforms.pop()),e.filter.push({renderPipeId:"filter",action:"pushFilter",container:t.maskedContainer,filterEffect:t.filterEffect,canBundle:!1})}else if("popMaskEnd"===t.action){e.filter.pop();const t=this._activeMaskStage.pop();n&&Ab.returnTexture(t.filterTexture),jx.return(t.filterEffect)}}destroy(){this._renderer=null,this._activeMaskStage=null}}vD.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"alphaMask"};class yD{constructor(t){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=t}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(t,e,n){this._renderer.renderPipes.batch.break(n);const i=this._colorStack;i[this._colorStackIndex]=i[this._colorStackIndex-1]&t.mask;const r=this._colorStack[this._colorStackIndex];r!==this._currentColor&&(this._currentColor=r,n.add({renderPipeId:"colorMask",colorMask:r,canBundle:!1})),this._colorStackIndex++}pop(t,e,n){this._renderer.renderPipes.batch.break(n);const i=this._colorStack;this._colorStackIndex--;const r=i[this._colorStackIndex-1];r!==this._currentColor&&(this._currentColor=r,n.add({renderPipeId:"colorMask",colorMask:r,canBundle:!1}))}execute(t){this._renderer.colorMask.setMask(t.colorMask)}destroy(){this._colorStack=null}}yD.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"colorMask"};class xD{constructor(t){this._maskStackHash={},this._maskHash=new WeakMap,this._renderer=t}push(t,e,n){var i;const r=t,s=this._renderer;s.renderPipes.batch.break(n),s.renderPipes.blendMode.setBlendMode(r.mask,"none",n),n.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:t,inverse:e._maskOptions.inverse,canBundle:!1});const a=r.mask;a.includeInBuild=!0,this._maskHash.has(r)||this._maskHash.set(r,{instructionsStart:0,instructionsLength:0});const o=this._maskHash.get(r);o.instructionsStart=n.instructionSize,a.collectRenderables(n,s,null),a.includeInBuild=!1,s.renderPipes.batch.break(n),n.add({renderPipeId:"stencilMask",action:"pushMaskEnd",mask:t,inverse:e._maskOptions.inverse,canBundle:!1});const l=n.instructionSize-o.instructionsStart-1;o.instructionsLength=l;const h=s.renderTarget.renderTarget.uid;(i=this._maskStackHash)[h]??(i[h]=0)}pop(t,e,n){const i=t,r=this._renderer;r.renderPipes.batch.break(n),r.renderPipes.blendMode.setBlendMode(i.mask,"none",n),n.add({renderPipeId:"stencilMask",action:"popMaskBegin",inverse:e._maskOptions.inverse,canBundle:!1});const s=this._maskHash.get(t);for(let a=0;a<s.instructionsLength;a++)n.instructions[n.instructionSize++]=n.instructions[s.instructionsStart++];n.add({renderPipeId:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(t){var e;const n=this._renderer,i=n.renderTarget.renderTarget.uid;let r=(e=this._maskStackHash)[i]??(e[i]=0);"pushMaskBegin"===t.action?(n.renderTarget.ensureDepthStencil(),n.stencil.setStencilMode(OT.RENDERING_MASK_ADD,r),r++,n.colorMask.setMask(0)):"pushMaskEnd"===t.action?(t.inverse?n.stencil.setStencilMode(OT.INVERSE_MASK_ACTIVE,r):n.stencil.setStencilMode(OT.MASK_ACTIVE,r),n.colorMask.setMask(15)):"popMaskBegin"===t.action?(n.colorMask.setMask(0),0!==r?n.stencil.setStencilMode(OT.RENDERING_MASK_REMOVE,r):(n.renderTarget.clear(null,kw.STENCIL),n.stencil.setStencilMode(OT.DISABLED,r)),r--):"popMaskEnd"===t.action&&(t.inverse?n.stencil.setStencilMode(OT.INVERSE_MASK_ACTIVE,r):n.stencil.setStencilMode(OT.MASK_ACTIVE,r),n.colorMask.setMask(15)),this._maskStackHash[i]=r}destroy(){this._renderer=null,this._maskStackHash=null,this._maskHash=null}}xD.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"stencilMask"};var bD=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(bD||{});class _D{constructor(t,e){this._lastBindBaseLocation=-1,this._lastBindCallId=-1,this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.type=e}}class SD{constructor(t){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._minBaseLocation=0,this._nextBindBaseIndex=this._minBaseLocation,this._bindCallId=0,this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBuffers")}destroy(){this._renderer=null,this._gl=null,this._gpuBuffers=null,this._boundBufferBases=null}contextChange(){this._gl=this._renderer.gl,this._gpuBuffers=Object.create(null),this._maxBindings=this._renderer.limits.maxUniformBindings}getGlBuffer(t){return this._gpuBuffers[t.uid]||this.createGLBuffer(t)}bind(t){const{_gl:e}=this,n=this.getGlBuffer(t);e.bindBuffer(n.type,n.buffer)}bindBufferBase(t,e){const{_gl:n}=this;this._boundBufferBases[e]!==t&&(this._boundBufferBases[e]=t,t._lastBindBaseLocation=e,n.bindBufferBase(n.UNIFORM_BUFFER,e,t.buffer))}nextBindBase(t){this._bindCallId++,this._minBaseLocation=0,t&&(this._boundBufferBases[0]=null,this._minBaseLocation=1,this._nextBindBaseIndex<1&&(this._nextBindBaseIndex=1))}freeLocationForBufferBase(t){let e=this.getLastBindBaseLocation(t);if(e>=this._minBaseLocation)return t._lastBindCallId=this._bindCallId,e;let n=0,i=this._nextBindBaseIndex;for(;n<2;){i>=this._maxBindings&&(i=this._minBaseLocation,n++);const t=this._boundBufferBases[i];if(!t||t._lastBindCallId!==this._bindCallId)break;i++}return e=i,this._nextBindBaseIndex=i+1,n>=2?-1:(t._lastBindCallId=this._bindCallId,this._boundBufferBases[e]=null,e)}getLastBindBaseLocation(t){const e=t._lastBindBaseLocation;return this._boundBufferBases[e]===t?e:-1}bindBufferRange(t,e,n,i){const{_gl:r}=this;n||(n=0),e||(e=0),this._boundBufferBases[e]=null,r.bindBufferRange(r.UNIFORM_BUFFER,e||0,t.buffer,256*n,i||256)}updateBuffer(t){const{_gl:e}=this,n=this.getGlBuffer(t);if(t._updateID===n.updateID)return n;n.updateID=t._updateID,e.bindBuffer(n.type,n.buffer);const i=t.data,r=t.descriptor.usage&qT.STATIC?e.STATIC_DRAW:e.DYNAMIC_DRAW;return i?n.byteLength>=i.byteLength?e.bufferSubData(n.type,0,i,0,t._updateSize/i.BYTES_PER_ELEMENT):(n.byteLength=i.byteLength,e.bufferData(n.type,i,r)):(n.byteLength=t.descriptor.size,e.bufferData(n.type,n.byteLength,r)),n}destroyAll(){const t=this._gl;for(const e in this._gpuBuffers)t.deleteBuffer(this._gpuBuffers[e].buffer);this._gpuBuffers=Object.create(null)}onBufferDestroy(t,e){const n=this._gpuBuffers[t.uid],i=this._gl;e||i.deleteBuffer(n.buffer),this._gpuBuffers[t.uid]=null}createGLBuffer(t){const{_gl:e}=this;let n=bD.ARRAY_BUFFER;t.descriptor.usage&qT.INDEX?n=bD.ELEMENT_ARRAY_BUFFER:t.descriptor.usage&qT.UNIFORM&&(n=bD.UNIFORM_BUFFER);const i=new _D(e.createBuffer(),n);return this._gpuBuffers[t.uid]=i,t.on("destroy",this.onBufferDestroy,this),i}resetState(){this._boundBufferBases=Object.create(null)}}SD.extension={type:[fy.WebGLSystem],name:"buffer"};const wD=class t{constructor(t){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this._renderer=t,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this._renderer.gl=t}init(e){e={...t.defaultOptions,...e};let n=this.multiView=e.multiView;if(e.context&&n&&(Vx(),n=!1),this.canvas=n?Wb.get().createCanvas(this._renderer.canvas.width,this._renderer.canvas.height):this._renderer.view.canvas,e.context)this.initFromContext(e.context);else{const t=this._renderer.background.alpha<1,n=e.premultipliedAlpha??!0,i=e.antialias&&!this._renderer.backBuffer.useBackBuffer;this.createContext(e.preferWebGLVersion,{alpha:t,premultipliedAlpha:n,antialias:i,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference??"default"})}}ensureCanvasSize(t){if(!this.multiView)return void(t!==this.canvas&&Vx());const{canvas:e}=this;(e.width<t.width||e.height<t.height)&&(e.width=Math.max(t.width,t.width),e.height=Math.max(t.height,t.height))}initFromContext(t){this.gl=t,this.webGLVersion=t instanceof Wb.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(t),this._renderer.runners.contextChange.emit(t);const e=this._renderer.view.canvas;e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(t,e){let n;const i=this.canvas;if(2===t&&(n=i.getContext("webgl2",e)),!n&&(n=i.getContext("webgl",e),!n))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=n,this.initFromContext(this.gl)}getExtensions(){const{gl:t}=this,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc"),rgtc:t.getExtension("EXT_texture_compression_rgtc"),loseContext:t.getExtension("WEBGL_lose_context")};if(1===this.webGLVersion)this.extensions={...e,drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:t.getExtension("ANGLE_instanced_arrays"),srgb:t.getExtension("EXT_sRGB")};else{this.extensions={...e,colorBufferFloat:t.getExtension("EXT_color_buffer_float")};const n=t.getExtension("WEBGL_provoking_vertex");n&&n.provokingVertexWEBGL(n.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(t){t.preventDefault(),this._contextLossForced&&(this._contextLossForced=!1,setTimeout(()=>{var t;this.gl.isContextLost()&&(null==(t=this.extensions.loseContext)||t.restoreContext())},0))}handleContextRestored(){this.getExtensions(),this._renderer.runners.contextChange.emit(this.gl)}destroy(){var t;const e=this._renderer.view.canvas;this._renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),null==(t=this.extensions.loseContext)||t.loseContext()}forceContextLoss(){var t;null==(t=this.extensions.loseContext)||t.loseContext(),this._contextLossForced=!0}validateContext(t){const e=t.getContextAttributes();e&&!e.stencil&&Vx();const n=this.supports,i=2===this.webGLVersion,r=this.extensions;n.uint32Indices=i||!!r.uint32ElementIndex,n.uniformBufferObject=i,n.vertexArrayObject=i||!!r.vertexArrayObject,n.srgbTextures=i||!!r.srgb,n.nonPowOf2wrapping=i,n.nonPowOf2mipmaps=i,n.msaa=i,n.uint32Indices||Vx()}};wD.extension={type:[fy.WebGLSystem],name:"context"},wD.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};let TD=wD;function MD(t,e){for(const n in t.attributes){const i=t.attributes[n],r=e[n];r?(i.format??(i.format=r.format),i.offset??(i.offset=r.offset),i.instance??(i.instance=r.instance)):Vx()}!function(t){const{buffers:e,attributes:n}=t,i={},r={};for(const s in e){const t=e[s];i[t.uid]=0,r[t.uid]=0}for(const s in n){const t=n[s];i[t.buffer.uid]+=cS(t.format).stride}for(const s in n){const t=n[s];t.stride??(t.stride=i[t.buffer.uid]),t.start??(t.start=r[t.buffer.uid]),r[t.buffer.uid]+=cS(t.format).stride}}(t)}var AD=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(AD||{}),ED=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(ED||{}),CD=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(CD||{}),PD=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(PD||{});const RD={uint8x2:PD.UNSIGNED_BYTE,uint8x4:PD.UNSIGNED_BYTE,sint8x2:PD.BYTE,sint8x4:PD.BYTE,unorm8x2:PD.UNSIGNED_BYTE,unorm8x4:PD.UNSIGNED_BYTE,snorm8x2:PD.BYTE,snorm8x4:PD.BYTE,uint16x2:PD.UNSIGNED_SHORT,uint16x4:PD.UNSIGNED_SHORT,sint16x2:PD.SHORT,sint16x4:PD.SHORT,unorm16x2:PD.UNSIGNED_SHORT,unorm16x4:PD.UNSIGNED_SHORT,snorm16x2:PD.SHORT,snorm16x4:PD.SHORT,float16x2:PD.HALF_FLOAT,float16x4:PD.HALF_FLOAT,float32:PD.FLOAT,float32x2:PD.FLOAT,float32x3:PD.FLOAT,float32x4:PD.FLOAT,uint32:PD.UNSIGNED_INT,uint32x2:PD.UNSIGNED_INT,uint32x3:PD.UNSIGNED_INT,uint32x4:PD.UNSIGNED_INT,sint32:PD.INT,sint32x2:PD.INT,sint32x3:PD.INT,sint32x4:PD.INT};function ID(t){return RD[t]??RD.float32}const OD={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class DD{constructor(t){this._geometryVaoHash=Object.create(null),this._renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this._renderer.renderableGC.addManagedHash(this,"_geometryVaoHash")}contextChange(){const t=this.gl=this._renderer.gl;if(!this._renderer.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");const e=this._renderer.context.extensions.vertexArrayObject;e&&(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t));const n=this._renderer.context.extensions.vertexAttribDivisorANGLE;n&&(t.drawArraysInstanced=(t,e,i,r)=>{n.drawArraysInstancedANGLE(t,e,i,r)},t.drawElementsInstanced=(t,e,i,r,s)=>{n.drawElementsInstancedANGLE(t,e,i,r,s)},t.vertexAttribDivisor=(t,e)=>n.vertexAttribDivisorANGLE(t,e)),this._activeGeometry=null,this._activeVao=null,this._geometryVaoHash=Object.create(null)}bind(t,e){const n=this.gl;this._activeGeometry=t;const i=this.getVao(t,e);this._activeVao!==i&&(this._activeVao=i,n.bindVertexArray(i)),this.updateBuffers()}resetState(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this._renderer.buffer;for(let n=0;n<t.buffers.length;n++){const i=t.buffers[n];e.updateBuffer(i)}}checkCompatibility(t,e){const n=t.attributes,i=e._attributeData;for(const r in i)if(!n[r])throw new Error(`shader and geometry incompatible, geometry missing the "${r}" attribute`)}getSignature(t,e){const n=t.attributes,i=e._attributeData,r=["g",t.uid];for(const s in n)i[s]&&r.push(s,i[s].location);return r.join("-")}getVao(t,e){var n;return(null==(n=this._geometryVaoHash[t.uid])?void 0:n[e._key])||this.initGeometryVao(t,e)}initGeometryVao(t,e,n=!0){const i=this._renderer.gl,r=this._renderer.buffer;this._renderer.shader._getProgramData(e),this.checkCompatibility(t,e);const s=this.getSignature(t,e);this._geometryVaoHash[t.uid]||(this._geometryVaoHash[t.uid]=Object.create(null),t.on("destroy",this.onGeometryDestroy,this));const a=this._geometryVaoHash[t.uid];let o=a[s];if(o)return a[e._key]=o,o;MD(t,e._attributeData);const l=t.buffers;o=i.createVertexArray(),i.bindVertexArray(o);for(let h=0;h<l.length;h++){const t=l[h];r.bind(t)}return this.activateVao(t,e),a[e._key]=o,a[s]=o,i.bindVertexArray(null),o}onGeometryDestroy(t,e){const n=this._geometryVaoHash[t.uid],i=this.gl;if(n){if(e)for(const t in n)this._activeVao!==n[t]&&this.unbind(),i.deleteVertexArray(n[t]);this._geometryVaoHash[t.uid]=null}}destroyAll(t=!1){const e=this.gl;for(const n in this._geometryVaoHash){if(t)for(const t in this._geometryVaoHash[n]){const i=this._geometryVaoHash[n];this._activeVao!==i&&this.unbind(),e.deleteVertexArray(i[t])}this._geometryVaoHash[n]=null}}activateVao(t,e){var n;const i=this._renderer.gl,r=this._renderer.buffer,s=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let a=null;for(const o in s){const t=s[o],l=t.buffer,h=r.getGlBuffer(l),c=e._attributeData[o];if(c){a!==h&&(r.bind(l),a=h);const e=c.location;i.enableVertexAttribArray(e);const s=cS(t.format),o=ID(t.format);if("int"===(null==(n=c.format)?void 0:n.substring(1,4))?i.vertexAttribIPointer(e,s.size,o,t.stride,t.offset):i.vertexAttribPointer(e,s.size,o,s.normalised,t.stride,t.offset),t.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");{const n=t.divisor??1;i.vertexAttribDivisor(e,n)}}}}}draw(t,e,n,i){const{gl:r}=this._renderer,s=this._activeGeometry,a=OD[t||s.topology];if(i??(i=s.instanceCount),s.indexBuffer){const t=s.indexBuffer.data.BYTES_PER_ELEMENT,o=2===t?r.UNSIGNED_SHORT:r.UNSIGNED_INT;i>1?r.drawElementsInstanced(a,e||s.indexBuffer.data.length,o,(n||0)*t,i):r.drawElements(a,e||s.indexBuffer.data.length,o,(n||0)*t)}else i>1?r.drawArraysInstanced(a,n||0,e||s.getSize(),i):r.drawArrays(a,n||0,e||s.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}DD.extension={type:[fy.WebGLSystem],name:"geometry"};const BD=new QT({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),FD=class t{constructor(t){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=t}init(e={}){const{useBackBuffer:n,antialias:i}={...t.defaultOptions,...e};this.useBackBuffer=n,this._antialias=i,this._renderer.context.supports.msaa||(Vx(),this._antialias=!1),this._state=RS.for2d();const r=new lS({vertex:"\n                attribute vec2 aPosition;\n                out vec2 vUv;\n\n                void main() {\n                    gl_Position = vec4(aPosition, 0.0, 1.0);\n\n                    vUv = (aPosition + 1.0) / 2.0;\n\n                    // flip dem UVs\n                    vUv.y = 1.0 - vUv.y;\n                }",fragment:"\n                in vec2 vUv;\n                out vec4 finalColor;\n\n                uniform sampler2D uTexture;\n\n                void main() {\n                    finalColor = texture(uTexture, vUv);\n                }",name:"big-triangle"});this._bigTriangleShader=new ES({glProgram:r,resources:{uTexture:ox.WHITE.source}})}renderStart(t){const e=this._renderer.renderTarget.getRenderTarget(t.target);if(this._useBackBufferThisRender=this.useBackBuffer&&!!e.isRoot,this._useBackBufferThisRender){const e=this._renderer.renderTarget.getRenderTarget(t.target);this._targetTexture=e.colorTexture,t.target=this._getBackBufferTexture(e.colorTexture)}}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){const t=this._renderer;t.renderTarget.finishRenderPass(),this._useBackBufferThisRender&&(t.renderTarget.bind(this._targetTexture,!1),this._bigTriangleShader.resources.uTexture=this._backBufferTexture.source,t.encoder.draw({geometry:BD,shader:this._bigTriangleShader,state:this._state}))}_getBackBufferTexture(t){return this._backBufferTexture=this._backBufferTexture||new ox({source:new ix({width:t.width,height:t.height,resolution:t._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(t.width,t.height,t._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};FD.extension={type:[fy.WebGLSystem],name:"backBuffer",priority:1},FD.defaultOptions={useBackBuffer:!1};let LD=FD;class UD{constructor(t){this._colorMaskCache=15,this._renderer=t}setMask(t){this._colorMaskCache!==t&&(this._colorMaskCache=t,this._renderer.gl.colorMask(!!(8&t),!!(4&t),!!(2&t),!!(1&t)))}}UD.extension={type:[fy.WebGLSystem],name:"colorMask"};class kD{constructor(t){this.commandFinished=Promise.resolve(),this._renderer=t}setGeometry(t,e){this._renderer.geometry.bind(t,e.glProgram)}finishRenderPass(){}draw(t){const e=this._renderer,{geometry:n,shader:i,state:r,skipSync:s,topology:a,size:o,start:l,instanceCount:h}=t;e.shader.bind(i,s),e.geometry.bind(n,e.shader._activeProgram),r&&e.state.set(r),e.geometry.draw(a,o,l,h??n.instanceCount)}destroy(){this._renderer=null}}kD.extension={type:[fy.WebGLSystem],name:"encoder"};class ND{constructor(t){this._renderer=t}contextChange(){const t=this._renderer.gl;this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxBatchableTextures=LT(this.maxTextures,t),this.maxUniformBindings=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS)}destroy(){}}ND.extension={type:[fy.WebGLSystem],name:"limits"};class zD{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}const GD=[];GD[OT.NONE]=void 0,GD[OT.DISABLED]={stencilWriteMask:0,stencilReadMask:0},GD[OT.RENDERING_MASK_ADD]={stencilFront:{compare:"equal",passOp:"increment-clamp"},stencilBack:{compare:"equal",passOp:"increment-clamp"}},GD[OT.RENDERING_MASK_REMOVE]={stencilFront:{compare:"equal",passOp:"decrement-clamp"},stencilBack:{compare:"equal",passOp:"decrement-clamp"}},GD[OT.MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"equal",passOp:"keep"},stencilBack:{compare:"equal",passOp:"keep"}},GD[OT.INVERSE_MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"not-equal",passOp:"keep"},stencilBack:{compare:"not-equal",passOp:"keep"}};class HD{constructor(t){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:OT.NONE},this._renderTargetStencilState=Object.create(null),t.renderTarget.onRenderTargetChange.add(this)}contextChange(t){this._gl=t,this._comparisonFuncMapping={always:t.ALWAYS,never:t.NEVER,equal:t.EQUAL,"not-equal":t.NOTEQUAL,less:t.LESS,"less-equal":t.LEQUAL,greater:t.GREATER,"greater-equal":t.GEQUAL},this._stencilOpsMapping={keep:t.KEEP,zero:t.ZERO,replace:t.REPLACE,invert:t.INVERT,"increment-clamp":t.INCR,"decrement-clamp":t.DECR,"increment-wrap":t.INCR_WRAP,"decrement-wrap":t.DECR_WRAP},this.resetState()}onRenderTargetChange(t){if(this._activeRenderTarget===t)return;this._activeRenderTarget=t;let e=this._renderTargetStencilState[t.uid];e||(e=this._renderTargetStencilState[t.uid]={stencilMode:OT.DISABLED,stencilReference:0}),this.setStencilMode(e.stencilMode,e.stencilReference)}resetState(){this._stencilCache.enabled=!1,this._stencilCache.stencilMode=OT.NONE,this._stencilCache.stencilReference=0}setStencilMode(t,e){const n=this._renderTargetStencilState[this._activeRenderTarget.uid],i=this._gl,r=GD[t],s=this._stencilCache;n.stencilMode=t,n.stencilReference=e,t!==OT.DISABLED?(this._stencilCache.enabled||(this._stencilCache.enabled=!0,i.enable(i.STENCIL_TEST)),t===s.stencilMode&&s.stencilReference===e||(s.stencilMode=t,s.stencilReference=e,i.stencilFunc(this._comparisonFuncMapping[r.stencilBack.compare],e,255),i.stencilOp(i.KEEP,i.KEEP,this._stencilOpsMapping[r.stencilBack.passOp]))):this._stencilCache.enabled&&(this._stencilCache.enabled=!1,i.disable(i.STENCIL_TEST))}}HD.extension={type:[fy.WebGLSystem],name:"stencil"};class VD{constructor(t){this._syncFunctionHash=Object.create(null),this._adaptor=t,this._systemCheck()}_systemCheck(){if(!cw())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}ensureUniformGroup(t){const e=this.getUniformGroupData(t);t.buffer||(t.buffer=new KT({data:new Float32Array(e.layout.size/4),usage:qT.UNIFORM|qT.COPY_DST}))}getUniformGroupData(t){return this._syncFunctionHash[t._signature]||this._initUniformGroup(t)}_initUniformGroup(t){const e=t._signature;let n=this._syncFunctionHash[e];if(!n){const i=Object.keys(t.uniformStructures).map(e=>t.uniformStructures[e]),r=this._adaptor.createUboElements(i),s=this._generateUboSync(r.uboElements);n=this._syncFunctionHash[e]={layout:r,syncFunction:s}}return this._syncFunctionHash[e]}_generateUboSync(t){return this._adaptor.generateUboSync(t)}syncUniformGroup(t,e,n){const i=this.getUniformGroupData(t);t.buffer||(t.buffer=new KT({data:new Float32Array(i.layout.size/4),usage:qT.UNIFORM|qT.COPY_DST}));let r=null;return e||(e=t.buffer.data,r=t.buffer.dataInt32),n||(n=0),i.syncFunction(t.uniforms,e,r,n),!0}updateUniformGroup(t){if(t.isStatic&&!t._dirtyId)return!1;t._dirtyId=0;const e=this.syncUniformGroup(t);return t.buffer.update(),e}destroy(){this._syncFunctionHash=null}}const XD={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":32,"mat3x3<f32>":48,"mat4x4<f32>":64};function WD(t){const e=t.map(t=>({data:t,offset:0,size:0}));let n=0,i=0;for(let r=0;r<e.length;r++){const t=e[r];if(n=XD[t.data.type],!n)throw new Error(`Unknown type ${t.data.type}`);t.data.size>1&&(n=Math.max(n,16)*t.data.size);const s=12===n?16:n;t.size=n;const a=i%16;i+=a>0&&16-a<s?(16-a)%16:(n-a%n)%n,t.offset=i,i+=n}return i=16*Math.ceil(i/16),{uboElements:e,size:i}}const jD=[{type:"mat3x3<f32>",test:t=>void 0!==t.value.a,ubo:"\n            var matrix = uv[name].toArray(true);\n            data[offset] = matrix[0];\n            data[offset + 1] = matrix[1];\n            data[offset + 2] = matrix[2];\n            data[offset + 4] = matrix[3];\n            data[offset + 5] = matrix[4];\n            data[offset + 6] = matrix[5];\n            data[offset + 8] = matrix[6];\n            data[offset + 9] = matrix[7];\n            data[offset + 10] = matrix[8];\n        ",uniform:"\n            gl.uniformMatrix3fv(ud[name].location, false, uv[name].toArray(true));\n        "},{type:"vec4<f32>",test:t=>"vec4<f32>"===t.type&&1===t.size&&void 0!==t.value.width,ubo:"\n            v = uv[name];\n            data[offset] = v.x;\n            data[offset + 1] = v.y;\n            data[offset + 2] = v.width;\n            data[offset + 3] = v.height;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height) {\n                cv[0] = v.x;\n                cv[1] = v.y;\n                cv[2] = v.width;\n                cv[3] = v.height;\n                gl.uniform4f(ud[name].location, v.x, v.y, v.width, v.height);\n            }\n        "},{type:"vec2<f32>",test:t=>"vec2<f32>"===t.type&&1===t.size&&void 0!==t.value.x,ubo:"\n            v = uv[name];\n            data[offset] = v.x;\n            data[offset + 1] = v.y;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.x || cv[1] !== v.y) {\n                cv[0] = v.x;\n                cv[1] = v.y;\n                gl.uniform2f(ud[name].location, v.x, v.y);\n            }\n        "},{type:"vec4<f32>",test:t=>"vec4<f32>"===t.type&&1===t.size&&void 0!==t.value.red,ubo:"\n            v = uv[name];\n            data[offset] = v.red;\n            data[offset + 1] = v.green;\n            data[offset + 2] = v.blue;\n            data[offset + 3] = v.alpha;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha) {\n                cv[0] = v.red;\n                cv[1] = v.green;\n                cv[2] = v.blue;\n                cv[3] = v.alpha;\n                gl.uniform4f(ud[name].location, v.red, v.green, v.blue, v.alpha);\n            }\n        "},{type:"vec3<f32>",test:t=>"vec3<f32>"===t.type&&1===t.size&&void 0!==t.value.red,ubo:"\n            v = uv[name];\n            data[offset] = v.red;\n            data[offset + 1] = v.green;\n            data[offset + 2] = v.blue;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue) {\n                cv[0] = v.red;\n                cv[1] = v.green;\n                cv[2] = v.blue;\n                gl.uniform3f(ud[name].location, v.red, v.green, v.blue);\n            }\n        "}];function YD(t,e,n,i){const r=["\n        var v = null;\n        var v2 = null;\n        var t = 0;\n        var index = 0;\n        var name = null;\n        var arrayOffset = null;\n    "];let s=0;for(let o=0;o<t.length;o++){const a=t[o],l=a.data.name;let h=!1,c=0;for(let t=0;t<jD.length;t++){if(jD[t].test(a.data)){c=a.offset/4,r.push(`name = "${l}";`,`offset += ${c-s};`,jD[t][e]||jD[t].ubo),h=!0;break}}if(!h)if(a.data.size>1)c=a.offset/4,r.push(n(a,c-s));else{const t=i[a.data.type];c=a.offset/4,r.push(`\n                    v = uv.${l};\n                    offset += ${c-s};\n                    ${t};\n                `)}s=c}const a=r.join("\n");return new Function("uv","data","dataInt32","offset",a)}function qD(t,e){return`\n        for (let i = 0; i < ${t*e}; i++) {\n            data[offset + (((i / ${t})|0) * 4) + (i % ${t})] = v[i];\n        }\n    `}const KD={f32:"\n        data[offset] = v;",i32:"\n        dataInt32[offset] = v;","vec2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];","vec3<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];","vec4<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 3] = v[3];","vec2<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];","vec3<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];\n        dataInt32[offset + 2] = v[2];","vec4<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];\n        dataInt32[offset + 2] = v[2];\n        dataInt32[offset + 3] = v[3];","mat2x2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 4] = v[2];\n        data[offset + 5] = v[3];","mat3x3<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];","mat4x4<f32>":"\n        for (let i = 0; i < 16; i++) {\n            data[offset + i] = v[i];\n        }","mat3x2<f32>":qD(3,2),"mat4x2<f32>":qD(4,2),"mat2x3<f32>":qD(2,3),"mat4x3<f32>":qD(4,3),"mat2x4<f32>":qD(2,4),"mat3x4<f32>":qD(3,4)},JD={...KD,"mat2x2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 3] = v[3];\n    "};function ZD(t,e){const n=Math.max(XD[t.data.type]/16,1),i=t.data.value.length/t.data.size,r=(4-i%4)%4,s=t.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n        v = uv.${t.data.name};\n        offset += ${e};\n\n        arrayOffset = offset;\n\n        t = 0;\n\n        for(var i=0; i < ${t.data.size*n}; i++)\n        {\n            for(var j = 0; j < ${i}; j++)\n            {\n                ${s}[arrayOffset++] = v[t++];\n            }\n            ${0!==r?`arrayOffset += ${r};`:""}\n        }\n    `}function QD(t){return YD(t,"uboStd40",ZD,KD)}class $D extends VD{constructor(){super({createUboElements:WD,generateUboSync:QD})}}$D.extension={type:[fy.WebGLSystem],name:"ubo"};class tB{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new Hy}init(t,e){this._renderer=t,this._renderTargetSystem=e,t.runners.contextChange.add(this)}contextChange(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new Hy}copyToTexture(t,e,n,i,r){const s=this._renderTargetSystem,a=this._renderer,o=s.getGpuRenderTarget(t),l=a.gl;return this.finishRenderPass(t),l.bindFramebuffer(l.FRAMEBUFFER,o.resolveTargetFramebuffer),a.texture.bind(e,0),l.copyTexSubImage2D(l.TEXTURE_2D,0,r.x,r.y,n.x,n.y,i.width,i.height),e}startRenderPass(t,e=!0,n,i){const r=this._renderTargetSystem,s=t.colorTexture,a=r.getGpuRenderTarget(t);let o=i.y;t.isRoot&&(o=s.pixelHeight-i.height),t.colorTextures.forEach(t=>{this._renderer.texture.unbind(t)});const l=this._renderer.gl;l.bindFramebuffer(l.FRAMEBUFFER,a.framebuffer);const h=this._viewPortCache;h.x===i.x&&h.y===o&&h.width===i.width&&h.height===i.height||(h.x=i.x,h.y=o,h.width=i.width,h.height=i.height,l.viewport(i.x,o,i.width,i.height)),a.depthStencilRenderBuffer||!t.stencil&&!t.depth||this._initStencil(a),this.clear(t,e,n)}finishRenderPass(t){const e=this._renderTargetSystem.getGpuRenderTarget(t);if(!e.msaa)return;const n=this._renderer.gl;n.bindFramebuffer(n.FRAMEBUFFER,e.resolveTargetFramebuffer),n.bindFramebuffer(n.READ_FRAMEBUFFER,e.framebuffer),n.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,n.COLOR_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,e.framebuffer)}initGpuRenderTarget(t){const e=this._renderer.gl,n=new zD;return t.colorTexture instanceof jb?(this._renderer.context.ensureCanvasSize(t.colorTexture.resource),n.framebuffer=null,n):(this._initColor(t,n),e.bindFramebuffer(e.FRAMEBUFFER,null),n)}destroyGpuRenderTarget(t){const e=this._renderer.gl;t.framebuffer&&(e.deleteFramebuffer(t.framebuffer),t.framebuffer=null),t.resolveTargetFramebuffer&&(e.deleteFramebuffer(t.resolveTargetFramebuffer),t.resolveTargetFramebuffer=null),t.depthStencilRenderBuffer&&(e.deleteRenderbuffer(t.depthStencilRenderBuffer),t.depthStencilRenderBuffer=null),t.msaaRenderBuffer.forEach(t=>{e.deleteRenderbuffer(t)}),t.msaaRenderBuffer=null}clear(t,e,n){if(!e)return;const i=this._renderTargetSystem;"boolean"==typeof e&&(e=e?kw.ALL:kw.NONE);const r=this._renderer.gl;if(e&kw.COLOR){n??(n=i.defaultClearColor);const t=this._clearColorCache,e=n;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],r.clearColor(e[0],e[1],e[2],e[3]))}r.clear(e)}resizeGpuRenderTarget(t){if(t.isRoot)return;const e=this._renderTargetSystem.getGpuRenderTarget(t);this._resizeColor(t,e),(t.stencil||t.depth)&&this._resizeStencil(e)}_initColor(t,e){const n=this._renderer,i=n.gl,r=i.createFramebuffer();if(e.resolveTargetFramebuffer=r,i.bindFramebuffer(i.FRAMEBUFFER,r),e.width=t.colorTexture.source.pixelWidth,e.height=t.colorTexture.source.pixelHeight,t.colorTextures.forEach((t,r)=>{const s=t.source;s.antialias&&(n.context.supports.msaa?e.msaa=!0:Vx()),n.texture.bindSource(s,0);const a=n.texture.getGlSource(s).texture;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+r,3553,a,0)}),e.msaa){const n=i.createFramebuffer();e.framebuffer=n,i.bindFramebuffer(i.FRAMEBUFFER,n),t.colorTextures.forEach((t,n)=>{const r=i.createRenderbuffer();e.msaaRenderBuffer[n]=r})}else e.framebuffer=r;this._resizeColor(t,e)}_resizeColor(t,e){const n=t.colorTexture.source;if(e.width=n.pixelWidth,e.height=n.pixelHeight,t.colorTextures.forEach((t,e)=>{0!==e&&t.source.resize(n.width,n.height,n._resolution)}),e.msaa){const n=this._renderer,i=n.gl,r=e.framebuffer;i.bindFramebuffer(i.FRAMEBUFFER,r),t.colorTextures.forEach((t,r)=>{const s=t.source;n.texture.bindSource(s,0);const a=n.texture.getGlSource(s).internalFormat,o=e.msaaRenderBuffer[r];i.bindRenderbuffer(i.RENDERBUFFER,o),i.renderbufferStorageMultisample(i.RENDERBUFFER,4,a,s.pixelWidth,s.pixelHeight),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+r,i.RENDERBUFFER,o)})}}_initStencil(t){if(null===t.framebuffer)return;const e=this._renderer.gl,n=e.createRenderbuffer();t.depthStencilRenderBuffer=n,e.bindRenderbuffer(e.RENDERBUFFER,n),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,n),this._resizeStencil(t)}_resizeStencil(t){const e=this._renderer.gl;e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilRenderBuffer),t.msaa?e.renderbufferStorageMultisample(e.RENDERBUFFER,4,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,2===this._renderer.context.webGLVersion?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,t.width,t.height)}prerender(t){const e=t.colorTexture.resource;this._renderer.context.multiView&&jb.test(e)&&this._renderer.context.ensureCanvasSize(e)}postrender(t){if(this._renderer.context.multiView&&jb.test(t.colorTexture.resource)){const e=this._renderer.context.canvas,n=t.colorTexture;n.context2D.drawImage(e,0,n.pixelHeight-e.height)}}}function eB(t,e,n,i,r,s){const a=s?1:-1;return t.identity(),t.a=1/i*2,t.d=a*(1/r*2),t.tx=-1-e*t.a,t.ty=-a-n*t.d,t}const nB=new Map;function iB(t,e){if(!nB.has(t)){const n=new ox({source:new jb({resource:t,...e})}),i=()=>{nB.get(t)===n&&nB.delete(t)};n.once("destroy",i),n.source.once("destroy",i),nB.set(t,n)}return nB.get(t)}function rB(t){const e=t.colorTexture.source.resource;return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement&&document.body.contains(e)}const sB=class t{constructor(e={}){if(this.uid=Xy("renderTarget"),this.colorTextures=[],this.dirtyId=0,this.isRoot=!1,this._size=new Float32Array(2),this._managedColorTextures=!1,e={...t.defaultOptions,...e},this.stencil=e.stencil,this.depth=e.depth,this.isRoot=e.isRoot,"number"==typeof e.colorTextures){this._managedColorTextures=!0;for(let t=0;t<e.colorTextures;t++)this.colorTextures.push(new ix({width:e.width,height:e.height,resolution:e.resolution,antialias:e.antialias}))}else{this.colorTextures=[...e.colorTextures.map(t=>t.source)];const t=this.colorTexture.source;this.resize(t.width,t.height,t._resolution)}this.colorTexture.source.on("resize",this.onSourceResize,this),(e.depthStencilTexture||this.stencil)&&(e.depthStencilTexture instanceof ox||e.depthStencilTexture instanceof ix?this.depthStencilTexture=e.depthStencilTexture.source:this.ensureDepthStencilTexture())}get size(){const t=this._size;return t[0]=this.pixelWidth,t[1]=this.pixelHeight,t}get width(){return this.colorTexture.source.width}get height(){return this.colorTexture.source.height}get pixelWidth(){return this.colorTexture.source.pixelWidth}get pixelHeight(){return this.colorTexture.source.pixelHeight}get resolution(){return this.colorTexture.source._resolution}get colorTexture(){return this.colorTextures[0]}onSourceResize(t){this.resize(t.width,t.height,t._resolution,!0)}ensureDepthStencilTexture(){this.depthStencilTexture||(this.depthStencilTexture=new ix({width:this.width,height:this.height,resolution:this.resolution,format:"depth24plus-stencil8",autoGenerateMipmaps:!1,antialias:!1,mipLevelCount:1}))}resize(t,e,n=this.resolution,i=!1){this.dirtyId++,this.colorTextures.forEach((r,s)=>{i&&0===s||r.source.resize(t,e,n)}),this.depthStencilTexture&&this.depthStencilTexture.source.resize(t,e,n)}destroy(){this.colorTexture.source.off("resize",this.onSourceResize,this),this._managedColorTextures&&this.colorTextures.forEach(t=>{t.destroy()}),this.depthStencilTexture&&(this.depthStencilTexture.destroy(),delete this.depthStencilTexture)}};sB.defaultOptions={width:0,height:0,resolution:1,colorTextures:1,stencil:!1,depth:!1,antialias:!1,isRoot:!1};let aB=sB;class oB{constructor(t){this.rootViewPort=new Hy,this.viewport=new Hy,this.onRenderTargetChange=new Nw("onRenderTargetChange"),this.projectionMatrix=new Ry,this.defaultClearColor=[0,0,0,0],this._renderSurfaceToRenderTargetHash=new Map,this._gpuRenderTargetHash=Object.create(null),this._renderTargetStack=[],this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuRenderTargetHash")}finishRenderPass(){this.adaptor.finishRenderPass(this.renderTarget)}renderStart({target:t,clear:e,clearColor:n,frame:i}){var r,s;this._renderTargetStack.length=0,this.push(t,e,n,i),this.rootViewPort.copyFrom(this.viewport),this.rootRenderTarget=this.renderTarget,this.renderingToScreen=rB(this.rootRenderTarget),null==(s=(r=this.adaptor).prerender)||s.call(r,this.rootRenderTarget)}postrender(){var t,e;null==(e=(t=this.adaptor).postrender)||e.call(t,this.rootRenderTarget)}bind(t,e=!0,n,i){const r=this.getRenderTarget(t),s=this.renderTarget!==r;this.renderTarget=r,this.renderSurface=t;const a=this.getGpuRenderTarget(r);r.pixelWidth===a.width&&r.pixelHeight===a.height||(this.adaptor.resizeGpuRenderTarget(r),a.width=r.pixelWidth,a.height=r.pixelHeight);const o=r.colorTexture,l=this.viewport,h=o.pixelWidth,c=o.pixelHeight;if(!i&&t instanceof ox&&(i=t.frame),i){const t=o._resolution;l.x=i.x*t+.5|0,l.y=i.y*t+.5|0,l.width=i.width*t+.5|0,l.height=i.height*t+.5|0}else l.x=0,l.y=0,l.width=h,l.height=c;return eB(this.projectionMatrix,0,0,l.width/o.resolution,l.height/o.resolution,!r.isRoot),this.adaptor.startRenderPass(r,e,n,l),s&&this.onRenderTargetChange.emit(r),r}clear(t,e=kw.ALL,n){e&&(t&&(t=this.getRenderTarget(t)),this.adaptor.clear(t||this.renderTarget,e,n,this.viewport))}contextChange(){this._gpuRenderTargetHash=Object.create(null)}push(t,e=kw.ALL,n,i){const r=this.bind(t,e,n,i);return this._renderTargetStack.push({renderTarget:r,frame:i}),r}pop(){this._renderTargetStack.pop();const t=this._renderTargetStack[this._renderTargetStack.length-1];this.bind(t.renderTarget,!1,null,t.frame)}getRenderTarget(t){return t.isTexture&&(t=t.source),this._renderSurfaceToRenderTargetHash.get(t)??this._initRenderTarget(t)}copyToTexture(t,e,n,i,r){n.x<0&&(i.width+=n.x,r.x-=n.x,n.x=0),n.y<0&&(i.height+=n.y,r.y-=n.y,n.y=0);const{pixelWidth:s,pixelHeight:a}=t;return i.width=Math.min(i.width,s-n.x),i.height=Math.min(i.height,a-n.y),this.adaptor.copyToTexture(t,e,n,i,r)}ensureDepthStencil(){this.renderTarget.stencil||(this.renderTarget.stencil=!0,this.adaptor.startRenderPass(this.renderTarget,!1,null,this.viewport))}destroy(){this._renderer=null,this._renderSurfaceToRenderTargetHash.forEach((t,e)=>{t!==e&&t.destroy()}),this._renderSurfaceToRenderTargetHash.clear(),this._gpuRenderTargetHash=Object.create(null)}_initRenderTarget(t){let e=null;return jb.test(t)&&(t=iB(t).source),t instanceof aB?e=t:t instanceof ix&&(e=new aB({colorTextures:[t]}),t.source instanceof jb&&(e.isRoot=!0),t.once("destroy",()=>{e.destroy(),this._renderSurfaceToRenderTargetHash.delete(t);const n=this._gpuRenderTargetHash[e.uid];n&&(this._gpuRenderTargetHash[e.uid]=null,this.adaptor.destroyGpuRenderTarget(n))})),this._renderSurfaceToRenderTargetHash.set(t,e),e}getGpuRenderTarget(t){return this._gpuRenderTargetHash[t.uid]||(this._gpuRenderTargetHash[t.uid]=this.adaptor.initGpuRenderTarget(t))}resetState(){this.renderTarget=null,this.renderSurface=null}}class lB extends oB{constructor(t){super(t),this.adaptor=new tB,this.adaptor.init(t,this)}}lB.extension={type:[fy.WebGLSystem],name:"renderTarget"};class hB extends Ty{constructor({buffer:t,offset:e,size:n}){super(),this.uid=Xy("buffer"),this._resourceType="bufferResource",this._touched=0,this._resourceId=Xy("resource"),this._bufferResource=!0,this.destroyed=!1,this.buffer=t,this.offset=0|e,this.size=n,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this._resourceId=Xy("resource"),this.emit("change",this)}destroy(t=!1){this.destroyed=!0,t&&this.buffer.destroy(),this.emit("change",this),this.buffer=null}}function cB(t,e){const n=[],i=["\n        var g = s.groups;\n        var sS = r.shader;\n        var p = s.glProgram;\n        var ugS = r.uniformGroup;\n        var resources;\n    "];let r=!1,s=0;const a=e._getProgramData(t.glProgram);for(const l in t.groups){const o=t.groups[l];n.push(`\n            resources = g[${l}].resources;\n        `);for(const h in o.resources){const c=o.resources[h];if(c instanceof TS)if(c.ubo){const e=t._uniformBindMap[l][Number(h)];n.push(`\n                        sS.bindUniformBlock(\n                            resources[${h}],\n                            '${e}',\n                            ${t.glProgram._uniformBlockData[e].index}\n                        );\n                    `)}else n.push(`\n                        ugS.updateUniformGroup(resources[${h}], p, sD);\n                    `);else if(c instanceof hB){const e=t._uniformBindMap[l][Number(h)];n.push(`\n                    sS.bindUniformBlock(\n                        resources[${h}],\n                        '${e}',\n                        ${t.glProgram._uniformBlockData[e].index}\n                    );\n                `)}else if(c instanceof ix){const o=t._uniformBindMap[l][h],c=a.uniformData[o];c&&(r||(r=!0,i.push("\n                        var tS = r.texture;\n                        ")),e._gl.uniform1i(c.location,s),n.push(`\n                        tS.bind(resources[${h}], ${s});\n                    `),s++)}}}const o=[...i,...n].join("\n");return new Function("r","s","sD",o)}class uB{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function dB(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}function pB(t){const e=new Array(t);for(let n=0;n<e.length;n++)e[n]=!1;return e}function fB(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return pB(2*e);case"bvec3":return pB(3*e);case"bvec4":return pB(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let mB=null;const gB={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},vB={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function yB(t,e){if(!mB){const e=Object.keys(gB);mB={};for(let n=0;n<e.length;++n){const i=e[n];mB[t[i]]=gB[i]}}return mB[e]}function xB(t,e){const n=yB(t,e);return vB[n]||"float32"}function bB(t,e,n=!1){const i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let a=0;a<r;a++){const n=e.getActiveAttrib(t,a);if(n.name.startsWith("gl_"))continue;const r=xB(e,n.type);i[n.name]={location:0,format:r,stride:cS(r).stride,offset:0,instance:!1,start:0}}const s=Object.keys(i);if(n){s.sort((t,e)=>t>e?1:-1);for(let n=0;n<s.length;n++)i[s[n]].location=n,e.bindAttribLocation(t,n,s[n]);e.linkProgram(t)}else for(let a=0;a<s.length;a++)i[s[a]].location=e.getAttribLocation(t,s[a]);return i}function _B(t,e){if(!e.ACTIVE_UNIFORM_BLOCKS)return{};const n={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS);for(let r=0;r<i;r++){const i=e.getActiveUniformBlockName(t,r),s=e.getUniformBlockIndex(t,i),a=e.getActiveUniformBlockParameter(t,r,e.UNIFORM_BLOCK_DATA_SIZE);n[i]={name:i,index:s,size:a}}return n}function SB(t,e){const n={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const i=e.getActiveUniform(t,r),s=i.name.replace(/\[.*?\]$/,""),a=!!i.name.match(/\[.*?\]$/),o=yB(e,i.type);n[s]={name:s,index:r,type:o,size:i.size,isArray:a,value:fB(o,i.size)}}return n}function wB(t,e){const n=t.getShaderSource(e).split("\n").map((t,e)=>`${e}: ${t}`),i=t.getShaderInfoLog(e).split("\n"),r={},s=i.map(t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(t=>!(!t||r[t])&&(r[t]=!0,!0)),a=[""];s.forEach(t=>{n[t-1]=`%c${n[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const o=n.join("\n");a[0]=o}function TB(t,e,n,i){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||wB(t,n),t.getShaderParameter(i,t.COMPILE_STATUS)||wB(t,i),t.getProgramInfoLog(e))}function MB(t,e){const n=dB(t,t.VERTEX_SHADER,e.vertex),i=dB(t,t.FRAGMENT_SHADER,e.fragment),r=t.createProgram();t.attachShader(r,n),t.attachShader(r,i);const s=e.transformFeedbackVaryings;s&&("function"!=typeof t.transformFeedbackVaryings?Vx():t.transformFeedbackVaryings(r,s.names,"separate"===s.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||TB(t,r,n,i),e._attributeData=bB(r,t,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertex)),e._uniformData=SB(r,t),e._uniformBlockData=_B(r,t),t.deleteShader(n),t.deleteShader(i);const a={};for(const o in e._uniformData){const n=e._uniformData[o];a[o]={location:t.getUniformLocation(r,o),value:fB(n.type,n.size)}}return new uB(r,a)}const AB={textureCount:0,blockIndex:0};class EB{constructor(t){this._activeProgram=null,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_programDataHash")}contextChange(t){this._gl=t,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._activeProgram=null}bind(t,e){if(this._setProgram(t.glProgram),e)return;AB.textureCount=0,AB.blockIndex=0;let n=this._shaderSyncFunctions[t.glProgram._key];n||(n=this._shaderSyncFunctions[t.glProgram._key]=this._generateShaderSync(t,this)),this._renderer.buffer.nextBindBase(!!t.glProgram.transformFeedbackVaryings),n(this._renderer,t,AB)}updateUniformGroup(t){this._renderer.uniformGroup.updateUniformGroup(t,this._activeProgram,AB)}bindUniformBlock(t,e,n=0){const i=this._renderer.buffer,r=this._getProgramData(this._activeProgram),s=t._bufferResource;s||this._renderer.ubo.updateUniformGroup(t);const a=t.buffer,o=i.updateBuffer(a),l=i.freeLocationForBufferBase(o);if(s){const{offset:e,size:n}=t;0===e&&n===a.data.byteLength?i.bindBufferBase(o,l):i.bindBufferRange(o,l,e)}else i.getLastBindBaseLocation(o)!==l&&i.bindBufferBase(o,l);const h=this._activeProgram._uniformBlockData[e].index;r.uniformBlockBindings[n]!==l&&(r.uniformBlockBindings[n]=l,this._renderer.gl.uniformBlockBinding(r.program,h,l))}_setProgram(t){if(this._activeProgram===t)return;this._activeProgram=t;const e=this._getProgramData(t);this._gl.useProgram(e.program)}_getProgramData(t){return this._programDataHash[t._key]||this._createProgramData(t)}_createProgramData(t){const e=t._key;return this._programDataHash[e]=MB(this._gl,t),this._programDataHash[e]}destroy(){for(const t of Object.keys(this._programDataHash)){this._programDataHash[t].destroy(),this._programDataHash[t]=null}this._programDataHash=null}_generateShaderSync(t,e){return cB(t,e)}resetState(){this._activeProgram=null}}EB.extension={type:[fy.WebGLSystem],name:"shader"};const CB={f32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1f(location, v);\n        }","vec2<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2f(location, v[0], v[1]);\n        }","vec3<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3f(location, v[0], v[1], v[2]);\n        }","vec4<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n        }",i32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }",u32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1ui(location, v);\n        }","vec2<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2ui(location, v[0], v[1]);\n        }","vec3<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3ui(location, v[0], v[1], v[2]);\n        }","vec4<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n        }",bool:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},PB={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};function RB(t,e){const n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n        var name = null;\n    "];for(const i in t.uniforms){if(!e[i]){t.uniforms[i]instanceof TS?t.uniforms[i].ubo?n.push(`\n                        renderer.shader.bindUniformBlock(uv.${i}, "${i}");\n                    `):n.push(`\n                        renderer.shader.updateUniformGroup(uv.${i});\n                    `):t.uniforms[i]instanceof hB&&n.push(`\n                        renderer.shader.bindBufferResource(uv.${i}, "${i}");\n                    `);continue}const r=t.uniformStructures[i];let s=!1;for(let t=0;t<jD.length;t++){const e=jD[t];if(r.type===e.type&&e.test(r)){n.push(`name = "${i}";`,jD[t].uniform),s=!0;break}}if(!s){const t=(1===r.size?CB:PB)[r.type].replace("location",`ud["${i}"].location`);n.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",n.join("\n"))}class IB{constructor(t){this._cache={},this._uniformGroupSyncHash={},this._renderer=t,this.gl=null,this._cache={}}contextChange(t){this.gl=t}updateUniformGroup(t,e,n){const i=this._renderer.shader._getProgramData(e);if(!t.isStatic||t._dirtyId!==i.uniformDirtyGroups[t.uid]){i.uniformDirtyGroups[t.uid]=t._dirtyId;this._getUniformSyncFunction(t,e)(i.uniformData,t.uniforms,this._renderer,n)}}_getUniformSyncFunction(t,e){var n;return(null==(n=this._uniformGroupSyncHash[t._signature])?void 0:n[e._key])||this._createUniformSyncFunction(t,e)}_createUniformSyncFunction(t,e){const n=this._uniformGroupSyncHash[t._signature]||(this._uniformGroupSyncHash[t._signature]={}),i=this._getSignature(t,e._uniformData,"u");return this._cache[i]||(this._cache[i]=this._generateUniformsSync(t,e._uniformData)),n[e._key]=this._cache[i],n[e._key]}_generateUniformsSync(t,e){return RB(t,e)}_getSignature(t,e,n){const i=t.uniforms,r=[`${n}-`];for(const s in i)r.push(s),e[s]&&r.push(e[s].type);return r.join("-")}destroy(){this._renderer=null,this._cache=null}}IB.extension={type:[fy.WebGLSystem],name:"uniformGroup"};const OB={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function DB(t){const e={};e.normal=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.add=[t.ONE,t.ONE],e.multiply=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.screen=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.none=[0,0],e["normal-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e["add-npm"]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e["screen-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.erase=[t.ZERO,t.ONE_MINUS_SRC_ALPHA];if(!(t instanceof Wb.get().getWebGLRenderingContext()))e.min=[t.ONE,t.ONE,t.ONE,t.ONE,t.MIN,t.MIN],e.max=[t.ONE,t.ONE,t.ONE,t.ONE,t.MAX,t.MAX];else{const n=t.getExtension("EXT_blend_minmax");n&&(e.min=[t.ONE,t.ONE,t.ONE,t.ONE,n.MIN_EXT,n.MIN_EXT],e.max=[t.ONE,t.ONE,t.ONE,t.ONE,n.MAX_EXT,n.MAX_EXT])}return e}const BB=class t{constructor(t){this._invertFrontFace=!1,this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=RS.for2d(),t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){this._invertFrontFace=!t.isRoot,this._cullFace?this.setFrontFace(this._frontFace):this._frontFaceDirty=!0}contextChange(t){this.gl=t,this.blendModesMap=DB(t),this.resetState()}set(t){if(t||(t=this.defaultState),this.stateId!==t.data){let e=this.stateId^t.data,n=0;for(;e;)1&e&&this.map[n].call(this,!!(t.data&1<<n)),e>>=1,n++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t||(t=this.defaultState);for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(e){this._updateCheck(t._checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this._updateCheck(t._checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this._cullFace=t,this.gl[t?"enable":"disable"](this.gl.CULL_FACE),this._cullFace&&this._frontFaceDirty&&this.setFrontFace(this._frontFace)}setFrontFace(t){this._frontFace=t,this._frontFaceDirty=!1;const e=this._invertFrontFace?!t:t;this._glFrontFace!==e&&(this._glFrontFace=e,this.gl.frontFace(this.gl[e?"CW":"CCW"]))}setBlendMode(t){if(this.blendModesMap[t]||(t="normal"),t===this.blendMode)return;this.blendMode=t;const e=this.blendModesMap[t],n=this.gl;2===e.length?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}resetState(){this._glFrontFace=!1,this._frontFace=!1,this._cullFace=!1,this._frontFaceDirty=!1,this._invertFrontFace=!1,this.gl.frontFace(this.gl.CCW),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(t,e){const n=this.checks.indexOf(t);e&&-1===n?this.checks.push(t):e||-1===n||this.checks.splice(n,1)}static _checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static _checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};BB.extension={type:[fy.WebGLSystem],name:"state"};let FB=BB;class LB{constructor(t){this.target=ED.TEXTURE_2D,this.texture=t,this.width=-1,this.height=-1,this.type=PD.UNSIGNED_BYTE,this.internalFormat=AD.RGBA,this.format=AD.RGBA,this.samplerType=0}}const UB={id:"buffer",upload(t,e,n){e.width===t.width||e.height===t.height?n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,e.format,e.type,t.resource):n.texImage2D(e.target,0,e.internalFormat,t.width,t.height,0,e.format,e.type,t.resource),e.width=t.width,e.height=t.height}},kB={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},NB={id:"compressed",upload(t,e,n){n.pixelStorei(n.UNPACK_ALIGNMENT,4);let i=t.pixelWidth,r=t.pixelHeight;const s=!!kB[t.format];for(let a=0;a<t.resource.length;a++){const o=t.resource[a];s?n.compressedTexImage2D(n.TEXTURE_2D,a,e.internalFormat,i,r,0,o):n.texImage2D(n.TEXTURE_2D,a,e.internalFormat,i,r,0,e.format,e.type,o),i=Math.max(i>>1,1),r=Math.max(r>>1,1)}}},zB={id:"image",upload(t,e,n,i){const r=e.width,s=e.height,a=t.pixelWidth,o=t.pixelHeight,l=t.resourceWidth,h=t.resourceHeight;l<a||h<o?(r===a&&s===o||n.texImage2D(e.target,0,e.internalFormat,a,o,0,e.format,e.type,null),2===i?n.texSubImage2D(n.TEXTURE_2D,0,0,0,l,h,e.format,e.type,t.resource):n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,e.type,t.resource)):r===a&&s===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,e.type,t.resource):2===i?n.texImage2D(e.target,0,e.internalFormat,a,o,0,e.format,e.type,t.resource):n.texImage2D(e.target,0,e.internalFormat,e.format,e.type,t.resource),e.width=a,e.height=o}},GB={id:"video",upload(t,e,n,i){t.isValid?zB.upload(t,e,n,i):n.texImage2D(e.target,0,e.internalFormat,1,1,0,e.format,e.type,null)}},HB={linear:9729,nearest:9728},VB={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},XB={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},WB={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function jB(t,e,n,i,r,s,a,o){const l=s;if(!o||"repeat"!==t.addressModeU||"repeat"!==t.addressModeV||"repeat"!==t.addressModeW){const n=XB[a?"clamp-to-edge":t.addressModeU],i=XB[a?"clamp-to-edge":t.addressModeV],s=XB[a?"clamp-to-edge":t.addressModeW];e[r](l,e.TEXTURE_WRAP_S,n),e[r](l,e.TEXTURE_WRAP_T,i),e.TEXTURE_WRAP_R&&e[r](l,e.TEXTURE_WRAP_R,s)}if(o&&"linear"===t.magFilter||e[r](l,e.TEXTURE_MAG_FILTER,HB[t.magFilter]),n){if(!o||"linear"!==t.mipmapFilter){const n=VB[t.minFilter][t.mipmapFilter];e[r](l,e.TEXTURE_MIN_FILTER,n)}}else e[r](l,e.TEXTURE_MIN_FILTER,HB[t.minFilter]);if(i&&t.maxAnisotropy>1){const n=Math.min(t.maxAnisotropy,e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));e[r](l,i.TEXTURE_MAX_ANISOTROPY_EXT,n)}t.compare&&e[r](l,e.TEXTURE_COMPARE_FUNC,WB[t.compare])}function YB(t){return{r8unorm:t.RED,r8snorm:t.RED,r8uint:t.RED,r8sint:t.RED,r16uint:t.RED,r16sint:t.RED,r16float:t.RED,rg8unorm:t.RG,rg8snorm:t.RG,rg8uint:t.RG,rg8sint:t.RG,r32uint:t.RED,r32sint:t.RED,r32float:t.RED,rg16uint:t.RG,rg16sint:t.RG,rg16float:t.RG,rgba8unorm:t.RGBA,"rgba8unorm-srgb":t.RGBA,rgba8snorm:t.RGBA,rgba8uint:t.RGBA,rgba8sint:t.RGBA,bgra8unorm:t.RGBA,"bgra8unorm-srgb":t.RGBA,rgb9e5ufloat:t.RGB,rgb10a2unorm:t.RGBA,rg11b10ufloat:t.RGB,rg32uint:t.RG,rg32sint:t.RG,rg32float:t.RG,rgba16uint:t.RGBA,rgba16sint:t.RGBA,rgba16float:t.RGBA,rgba32uint:t.RGBA,rgba32sint:t.RGBA,rgba32float:t.RGBA,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT,depth24plus:t.DEPTH_COMPONENT,"depth24plus-stencil8":t.DEPTH_STENCIL,depth32float:t.DEPTH_COMPONENT,"depth32float-stencil8":t.DEPTH_STENCIL}}function qB(t,e){let n={},i=t.RGBA;return t instanceof Wb.get().getWebGLRenderingContext()?e.srgb&&(n={"rgba8unorm-srgb":e.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":e.srgb.SRGB8_ALPHA8_EXT}):(n={"rgba8unorm-srgb":t.SRGB8_ALPHA8,"bgra8unorm-srgb":t.SRGB8_ALPHA8},i=t.RGBA8),{r8unorm:t.R8,r8snorm:t.R8_SNORM,r8uint:t.R8UI,r8sint:t.R8I,r16uint:t.R16UI,r16sint:t.R16I,r16float:t.R16F,rg8unorm:t.RG8,rg8snorm:t.RG8_SNORM,rg8uint:t.RG8UI,rg8sint:t.RG8I,r32uint:t.R32UI,r32sint:t.R32I,r32float:t.R32F,rg16uint:t.RG16UI,rg16sint:t.RG16I,rg16float:t.RG16F,rgba8unorm:t.RGBA,...n,rgba8snorm:t.RGBA8_SNORM,rgba8uint:t.RGBA8UI,rgba8sint:t.RGBA8I,bgra8unorm:i,rgb9e5ufloat:t.RGB9_E5,rgb10a2unorm:t.RGB10_A2,rg11b10ufloat:t.R11F_G11F_B10F,rg32uint:t.RG32UI,rg32sint:t.RG32I,rg32float:t.RG32F,rgba16uint:t.RGBA16UI,rgba16sint:t.RGBA16I,rgba16float:t.RGBA16F,rgba32uint:t.RGBA32UI,rgba32sint:t.RGBA32I,rgba32float:t.RGBA32F,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT16,depth24plus:t.DEPTH_COMPONENT24,"depth24plus-stencil8":t.DEPTH24_STENCIL8,depth32float:t.DEPTH_COMPONENT32F,"depth32float-stencil8":t.DEPTH32F_STENCIL8,...e.s3tc?{"bc1-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...e.s3tc_sRGB?{"bc1-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...e.rgtc?{"bc4-r-unorm":e.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":e.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":e.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":e.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...e.bptc?{"bc6h-rgb-float":e.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":e.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":e.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":e.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...e.etc?{"etc2-rgb8unorm":e.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":e.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":e.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":e.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":e.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":e.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":e.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":e.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...e.astc?{"astc-4x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}function KB(t){return{r8unorm:t.UNSIGNED_BYTE,r8snorm:t.BYTE,r8uint:t.UNSIGNED_BYTE,r8sint:t.BYTE,r16uint:t.UNSIGNED_SHORT,r16sint:t.SHORT,r16float:t.HALF_FLOAT,rg8unorm:t.UNSIGNED_BYTE,rg8snorm:t.BYTE,rg8uint:t.UNSIGNED_BYTE,rg8sint:t.BYTE,r32uint:t.UNSIGNED_INT,r32sint:t.INT,r32float:t.FLOAT,rg16uint:t.UNSIGNED_SHORT,rg16sint:t.SHORT,rg16float:t.HALF_FLOAT,rgba8unorm:t.UNSIGNED_BYTE,"rgba8unorm-srgb":t.UNSIGNED_BYTE,rgba8snorm:t.BYTE,rgba8uint:t.UNSIGNED_BYTE,rgba8sint:t.BYTE,bgra8unorm:t.UNSIGNED_BYTE,"bgra8unorm-srgb":t.UNSIGNED_BYTE,rgb9e5ufloat:t.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:t.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:t.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:t.UNSIGNED_INT,rg32sint:t.INT,rg32float:t.FLOAT,rgba16uint:t.UNSIGNED_SHORT,rgba16sint:t.SHORT,rgba16float:t.HALF_FLOAT,rgba32uint:t.UNSIGNED_INT,rgba32sint:t.INT,rgba32float:t.FLOAT,stencil8:t.UNSIGNED_BYTE,depth16unorm:t.UNSIGNED_SHORT,depth24plus:t.UNSIGNED_INT,"depth24plus-stencil8":t.UNSIGNED_INT_24_8,depth32float:t.FLOAT,"depth32float-stencil8":t.FLOAT_32_UNSIGNED_INT_24_8_REV}}class JB{constructor(t){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:zB,buffer:UB,video:GB,compressed:NB},this._premultiplyAlpha=!1,this._useSeparateSamplers=!1,this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_glTextures"),this._renderer.renderableGC.addManagedHash(this,"_glSamplers")}contextChange(t){this._gl=t,this._mapFormatToInternalFormat||(this._mapFormatToInternalFormat=qB(t,this._renderer.context.extensions),this._mapFormatToType=KB(t),this._mapFormatToFormat=YB(t)),this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundSamplers=Object.create(null),this._premultiplyAlpha=!1;for(let e=0;e<16;e++)this.bind(ox.EMPTY,e)}initSource(t){this.bind(t)}bind(t,e=0){const n=t.source;t?(this.bindSource(n,e),this._useSeparateSamplers&&this._bindSampler(n.style,e)):(this.bindSource(null,e),this._useSeparateSamplers&&this._bindSampler(null,e))}bindSource(t,e=0){const n=this._gl;if(t._touched=this._renderer.textureGC.count,this._boundTextures[e]!==t){this._boundTextures[e]=t,this._activateLocation(e),t||(t=ox.EMPTY.source);const i=this.getGlSource(t);n.bindTexture(i.target,i.texture)}}_bindSampler(t,e=0){const n=this._gl;if(!t)return this._boundSamplers[e]=null,void n.bindSampler(e,null);const i=this._getGlSampler(t);this._boundSamplers[e]!==i&&(this._boundSamplers[e]=i,n.bindSampler(e,i))}unbind(t){const e=t.source,n=this._boundTextures,i=this._gl;for(let r=0;r<n.length;r++)if(n[r]===e){this._activateLocation(r);const t=this.getGlSource(e);i.bindTexture(t.target,null),n[r]=null}}_activateLocation(t){this._activeTextureLocation!==t&&(this._activeTextureLocation=t,this._gl.activeTexture(this._gl.TEXTURE0+t))}_initSource(t){const e=this._gl,n=new LB(e.createTexture());if(n.type=this._mapFormatToType[t.format],n.internalFormat=this._mapFormatToInternalFormat[t.format],n.format=this._mapFormatToFormat[t.format],t.autoGenerateMipmaps&&(this._renderer.context.supports.nonPowOf2mipmaps||t.isPowerOfTwo)){const e=Math.max(t.width,t.height);t.mipLevelCount=Math.floor(Math.log2(e))+1}return this._glTextures[t.uid]=n,this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceUpdate,this),t.on("styleChange",this.onStyleChange,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),this.updateStyle(t,!1),n}onStyleChange(t){this.updateStyle(t,!1)}updateStyle(t,e){const n=this._gl,i=this.getGlSource(t);n.bindTexture(n.TEXTURE_2D,i.texture),this._boundTextures[this._activeTextureLocation]=t,jB(t.style,n,t.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",n.TEXTURE_2D,!this._renderer.context.supports.nonPowOf2wrapping&&!t.isPowerOfTwo,e)}onSourceUnload(t){const e=this._glTextures[t.uid];e&&(this.unbind(t),this._glTextures[t.uid]=null,this._gl.deleteTexture(e.texture))}onSourceUpdate(t){const e=this._gl,n=this.getGlSource(t);e.bindTexture(e.TEXTURE_2D,n.texture),this._boundTextures[this._activeTextureLocation]=t;const i="premultiply-alpha-on-upload"===t.alphaMode;this._premultiplyAlpha!==i&&(this._premultiplyAlpha=i,e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i)),this._uploads[t.uploadMethodId]?this._uploads[t.uploadMethodId].upload(t,n,e,this._renderer.context.webGLVersion):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.pixelWidth,t.pixelHeight,0,e.RGBA,e.UNSIGNED_BYTE,null),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t,!1)}onUpdateMipmaps(t,e=!0){e&&this.bindSource(t,0);const n=this.getGlSource(t);this._gl.generateMipmap(n.target)}onSourceDestroy(t){t.off("destroy",this.onSourceDestroy,this),t.off("update",this.onSourceUpdate,this),t.off("resize",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("styleChange",this.onStyleChange,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}_initSampler(t){const e=this._gl,n=this._gl.createSampler();return this._glSamplers[t._resourceId]=n,jB(t,e,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",n,!1,!0),this._glSamplers[t._resourceId]}_getGlSampler(t){return this._glSamplers[t._resourceId]||this._initSampler(t)}getGlSource(t){return this._glTextures[t.uid]||this._initSource(t)}generateCanvas(t){const{pixels:e,width:n,height:i}=this.getPixels(t),r=Wb.get().createCanvas();r.width=n,r.height=i;const s=r.getContext("2d");if(s){const t=s.createImageData(n,i);t.data.set(e),s.putImageData(t,0,0)}return r}getPixels(t){const e=t.source.resolution,n=t.frame,i=Math.max(Math.round(n.width*e),1),r=Math.max(Math.round(n.height*e),1),s=new Uint8Array(4*i*r),a=this._renderer,o=a.renderTarget.getRenderTarget(t),l=a.renderTarget.getGpuRenderTarget(o),h=a.gl;return h.bindFramebuffer(h.FRAMEBUFFER,l.resolveTargetFramebuffer),h.readPixels(Math.round(n.x*e),Math.round(n.y*e),i,r,h.RGBA,h.UNSIGNED_BYTE,s),{pixels:new Uint8ClampedArray(s.buffer),width:i,height:r}}destroy(){this.managedTextures.slice().forEach(t=>this.onSourceDestroy(t)),this.managedTextures=null,this._renderer=null}resetState(){this._activeTextureLocation=-1,this._boundTextures.fill(ox.EMPTY.source),this._boundSamplers=Object.create(null);const t=this._gl;this._premultiplyAlpha=!1,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha)}}JB.extension={type:[fy.WebGLSystem],name:"texture"};class ZB{contextChange(t){const e=new TS({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new Ry,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),n=t.limits.maxBatchableTextures,i=MM({name:"graphics",bits:[EM,BM(n),dD,LM]});this.shader=new ES({glProgram:i,resources:{localUniforms:e,batchSamplers:kM(n)}})}execute(t,e){const n=e.context,i=n.customShader||this.shader,r=t.renderer,s=r.graphicsContext,{batcher:a,instructions:o}=s.getContextRenderData(n);i.groups[0]=r.globalUniforms.bindGroup,r.state.set(t.state),r.shader.bind(i),r.geometry.bind(a.geometry,i.glProgram);const l=o.instructions;for(let h=0;h<o.instructionSize;h++){const t=l[h];if(t.size){for(let e=0;e<t.textures.count;e++)r.texture.bind(t.textures.textures[e],e);r.geometry.draw(t.topology,t.size,t.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}ZB.extension={type:[fy.WebGLPipesAdaptor],name:"graphics"};class QB{init(){const t=MM({name:"mesh",bits:[dD,fD,LM]});this._shader=new ES({glProgram:t,resources:{uTexture:ox.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new Ry}}}})}execute(t,e){const n=t.renderer;let i=e._shader;if(i){if(!i.glProgram)return void Vx(e.shader)}else{i=this._shader;const t=e.texture,n=t.source;i.resources.uTexture=n,i.resources.uSampler=n.style,i.resources.textureUniforms.uniforms.uTextureMatrix=t.textureMatrix.mapCoord}i.groups[100]=n.globalUniforms.bindGroup,i.groups[101]=t.localUniformsBindGroup,n.encoder.draw({geometry:e._geometry,shader:i,state:e.state})}destroy(){this._shader.destroy(!0),this._shader=null}}QB.extension={type:[fy.WebGLPipesAdaptor],name:"mesh"};class $B{constructor(t){this._renderer=t}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(t,e){this._renderer.renderPipes.batch.break(e),e.add(t)}execute(t){t.isRenderable&&t.render(this._renderer)}destroy(){this._renderer=null}}$B.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"customRender"};class tF{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}destroy(){}}function eF(t,e){const n=t.instructionSet,i=n.instructions;for(let r=0;r<n.instructionSize;r++){const t=i[r];e[t.renderPipeId].execute(t)}}const nF=new Ry;class iF{constructor(t){this._renderer=t}addRenderGroup(t,e){t.isCachedAsTexture?this._addRenderableCacheAsTexture(t,e):this._addRenderableDirect(t,e)}execute(t){t.isRenderable&&(t.isCachedAsTexture?this._executeCacheAsTexture(t):this._executeDirect(t))}destroy(){this._renderer=null}_addRenderableDirect(t,e){this._renderer.renderPipes.batch.break(e),t._batchableRenderGroup&&(jx.return(t._batchableRenderGroup),t._batchableRenderGroup=null),e.add(t)}_addRenderableCacheAsTexture(t,e){const n=t._batchableRenderGroup??(t._batchableRenderGroup=jx.get(tF));n.renderable=t.root,n.transform=t.root.relativeGroupTransform,n.texture=t.texture,n.bounds=t._textureBounds,e.add(t),this._renderer.renderPipes.batch.addToBatch(n,e)}_executeCacheAsTexture(t){if(t.textureNeedsUpdate){t.textureNeedsUpdate=!1;const e=nF.identity().translate(-t._textureBounds.x,-t._textureBounds.y);this._renderer.renderTarget.push(t.texture,!0,null,t.texture.frame),this._renderer.globalUniforms.push({worldTransformMatrix:e,worldColor:4294967295}),eF(t,this._renderer.renderPipes),this._renderer.renderTarget.finishRenderPass(),this._renderer.renderTarget.pop(),this._renderer.globalUniforms.pop()}t._batchableRenderGroup._batcher.updateElement(t._batchableRenderGroup),t._batchableRenderGroup._batcher.geometry.buffers[0].update()}_executeDirect(t){this._renderer.globalUniforms.push({worldTransformMatrix:t.inverseParentTextureTransform,worldColor:t.worldColorAlpha}),eF(t,this._renderer.renderPipes),this._renderer.globalUniforms.pop()}}function rF(t,e){e||(e=0);for(let n=e;n<t.length&&t[n];n++)t[n]=null}iF.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"renderGroup"};const sF=new Db;function aF(t,e=!1){oF(t);const n=t.childrenToUpdate,i=t.updateTick++;for(const r in n){const e=Number(r),s=n[r],a=s.list,o=s.index;for(let n=0;n<o;n++){const r=a[n];r.parentRenderGroup===t&&r.relativeRenderGroupDepth===e&&lF(r,i,0)}rF(a,o),s.index=0}if(e)for(let r=0;r<t.renderGroupChildren.length;r++)aF(t.renderGroupChildren[r],e)}function oF(t){const e=t.root;let n;if(t.renderGroupParent){const i=t.renderGroupParent;t.worldTransform.appendFrom(e.relativeGroupTransform,i.worldTransform),t.worldColor=ub(e.groupColor,i.worldColor),n=e.groupAlpha*i.worldAlpha}else t.worldTransform.copyFrom(e.localTransform),t.worldColor=e.localColor,n=e.localAlpha;n=n<0?0:n>1?1:n,t.worldAlpha=n,t.worldColorAlpha=t.worldColor+(255*n<<24)}function lF(t,e,n){if(e===t.updateTick)return;t.updateTick=e,t.didChange=!1;const i=t.localTransform;t.updateLocalTransform();const r=t.parent;if(r&&!r.renderGroup?(n|=t._updateFlags,t.relativeGroupTransform.appendFrom(i,r.relativeGroupTransform),7&n&&hF(t,r,n)):(n=t._updateFlags,t.relativeGroupTransform.copyFrom(i),7&n&&hF(t,sF,n)),!t.renderGroup){const i=t.children,r=i.length;for(let t=0;t<r;t++)lF(i[t],e,n);const s=t.parentRenderGroup,a=t;a.renderPipeId&&!s.structureDidChange&&s.updateRenderable(a)}}function hF(t,e,n){if(1&n){t.groupColor=ub(t.localColor,e.groupColor);let n=t.localAlpha*e.groupAlpha;n=n<0?0:n>1?1:n,t.groupAlpha=n,t.groupColorAlpha=t.groupColor+(255*n<<24)}2&n&&(t.groupBlendMode="inherit"===t.localBlendMode?e.groupBlendMode:t.localBlendMode),4&n&&(t.globalDisplayStatus=t.localDisplayStatus&e.globalDisplayStatus),t._updateFlags=0}function cF(t,e){const{list:n,index:i}=t.childrenRenderablesToUpdate;let r=!1;for(let s=0;s<i;s++){const t=n[s];if(r=e[t.renderPipeId].validateRenderable(t),r)break}return t.structureDidChange=r,r}const uF=new Ry;class dF{constructor(t){this._renderer=t}render({container:t,transform:e}){const n=t.parent,i=t.renderGroup.renderGroupParent;t.parent=null,t.renderGroup.renderGroupParent=null;const r=this._renderer;let s=uF;e&&(s=s.copyFrom(t.renderGroup.localTransform),t.renderGroup.localTransform.copyFrom(e));const a=r.renderPipes;this._updateCachedRenderGroups(t.renderGroup,null),this._updateRenderGroups(t.renderGroup),r.globalUniforms.start({worldTransformMatrix:e?t.renderGroup.localTransform:t.renderGroup.worldTransform,worldColor:t.renderGroup.worldColorAlpha}),eF(t.renderGroup,a),a.uniformBatch&&a.uniformBatch.renderEnd(),e&&t.renderGroup.localTransform.copyFrom(s),t.parent=n,t.renderGroup.renderGroupParent=i}destroy(){this._renderer=null}_updateCachedRenderGroups(t,e){if(t.isCachedAsTexture){if(!t.updateCacheTexture)return;e=t}t._parentCacheAsTextureRenderGroup=e;for(let n=t.renderGroupChildren.length-1;n>=0;n--)this._updateCachedRenderGroups(t.renderGroupChildren[n],e);if(t.invalidateMatrices(),t.isCachedAsTexture){if(t.textureNeedsUpdate){const e=t.root.getLocalBounds();e.ceil();const n=t.texture;t.texture&&Ab.returnTexture(t.texture);const i=this._renderer,r=t.textureOptions.resolution||i.view.resolution,s=t.textureOptions.antialias??i.view.antialias;t.texture=Ab.getOptimalTexture(e.width,e.height,r,s),t._textureBounds||(t._textureBounds=new cx),t._textureBounds.copyFrom(e),n!==t.texture&&t.renderGroupParent&&(t.renderGroupParent.structureDidChange=!0)}}else t.texture&&(Ab.returnTexture(t.texture),t.texture=null)}_updateRenderGroups(t){const e=this._renderer,n=e.renderPipes;if(t.runOnRender(e),t.instructionSet.renderPipes=n,t.structureDidChange?rF(t.childrenRenderablesToUpdate.list,0):cF(t,n),aF(t),t.structureDidChange?(t.structureDidChange=!1,this._buildInstructions(t,e)):this._updateRenderables(t),t.childrenRenderablesToUpdate.index=0,e.renderPipes.batch.upload(t.instructionSet),!t.isCachedAsTexture||t.textureNeedsUpdate)for(let i=0;i<t.renderGroupChildren.length;i++)this._updateRenderGroups(t.renderGroupChildren[i])}_updateRenderables(t){const{list:e,index:n}=t.childrenRenderablesToUpdate;for(let i=0;i<n;i++){const n=e[i];n.didViewUpdate&&t.updateRenderable(n)}rF(e,n)}_buildInstructions(t,e){const n=t.root,i=t.instructionSet;i.reset();const r=e.renderPipes?e:e.batch.renderer,s=r.renderPipes;s.batch.buildStart(i),s.blendMode.buildStart(),s.colorMask.buildStart(),n.sortableChildren&&n.sortChildren(),n.collectRenderablesWithEffects(i,r,null),s.batch.buildEnd(i),s.blendMode.buildEnd(i)}}dF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"renderGroup"};class pF{constructor(t){this._renderer=t}addRenderable(t,e){const n=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,n),this._renderer.renderPipes.batch.addToBatch(n,e)}updateRenderable(t){const e=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}_updateBatchableSprite(t,e){e.bounds=t.visualBounds,e.texture=t._texture}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=new tF;return e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.bounds=t.visualBounds,e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}pF.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"sprite"};const fF=class t{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new zx(0),this.color=this._backgroundColor,this.alpha=1}init(e){e={...t.defaultOptions,...e},this.clearBeforeRender=e.clearBeforeRender,this.color=e.background||e.backgroundColor||this._backgroundColor,this.alpha=e.backgroundAlpha,this._backgroundColor.setAlpha(e.backgroundAlpha)}get color(){return this._backgroundColor}set color(t){zx.shared.setValue(t).alpha<1&&1===this._backgroundColor.alpha&&Vx(),this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get colorRgba(){return this._backgroundColor.toArray()}destroy(){}};fF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"background",priority:0},fF.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};let mF=fF;const gF={};vy.handle(fy.BlendMode,t=>{if(!t.name)throw new Error("BlendMode extension must have a name property");gF[t.name]=t.ref},t=>{delete gF[t.name]});class vF{constructor(t){this._isAdvanced=!1,this._filterHash=Object.create(null),this._renderer=t,this._renderer.runners.prerender.add(this)}prerender(){this._activeBlendMode="normal",this._isAdvanced=!1}setBlendMode(t,e,n){this._activeBlendMode!==e?(this._activeBlendMode=e,this._isAdvanced&&this._endAdvancedBlendMode(n),this._isAdvanced=!!gF[e],this._isAdvanced&&(this._beginAdvancedBlendMode(n),this._renderableList.push(t))):this._isAdvanced&&this._renderableList.push(t)}_beginAdvancedBlendMode(t){this._renderer.renderPipes.batch.break(t);const e=this._activeBlendMode;if(!gF[e])return void Vx();let n=this._filterHash[e];n||(n=this._filterHash[e]=new Zx,n.filters=[new gF[e]]);const i={renderPipeId:"filter",action:"pushFilter",renderables:[],filterEffect:n,canBundle:!1};this._renderableList=i.renderables,t.add(i)}_endAdvancedBlendMode(t){this._renderableList=null,this._renderer.renderPipes.batch.break(t),t.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}buildStart(){this._isAdvanced=!1}buildEnd(t){this._isAdvanced&&this._endAdvancedBlendMode(t)}destroy(){this._renderer=null,this._renderableList=null;for(const t in this._filterHash)this._filterHash[t].destroy();this._filterHash=null}}vF.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"blendMode"};const yF={png:"image/png",jpg:"image/jpeg",webp:"image/webp"},xF=class t{constructor(t){this._renderer=t}_normalizeOptions(t,e={}){return t instanceof Db||t instanceof ox?{target:t,...e}:{...e,...t}}async image(t){const e=new Image;return e.src=await this.base64(t),e}async base64(e){e=this._normalizeOptions(e,t.defaultImageOptions);const{format:n,quality:i}=e,r=this.canvas(e);if(void 0!==r.toBlob)return new Promise((t,e)=>{r.toBlob(n=>{if(!n)return void e(new Error("ICanvas.toBlob failed!"));const i=new FileReader;i.onload=()=>t(i.result),i.onerror=e,i.readAsDataURL(n)},yF[n],i)});if(void 0!==r.toDataURL)return r.toDataURL(yF[n],i);if(void 0!==r.convertToBlob){const t=await r.convertToBlob({type:yF[n],quality:i});return new Promise((e,n)=>{const i=new FileReader;i.onload=()=>e(i.result),i.onerror=n,i.readAsDataURL(t)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t){const e=(t=this._normalizeOptions(t)).target,n=this._renderer;if(e instanceof ox)return n.texture.generateCanvas(e);const i=n.textureGenerator.generateTexture(t),r=n.texture.generateCanvas(i);return i.destroy(!0),r}pixels(t){const e=(t=this._normalizeOptions(t)).target,n=this._renderer,i=e instanceof ox?e:n.textureGenerator.generateTexture(t),r=n.texture.getPixels(i);return e instanceof Db&&i.destroy(!0),r}texture(t){return(t=this._normalizeOptions(t)).target instanceof ox?t.target:this._renderer.textureGenerator.generateTexture(t)}download(t){t=this._normalizeOptions(t);const e=this.canvas(t),n=document.createElement("a");n.download=t.filename??"image.png",n.href=e.toDataURL("image/png"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}log(t){const e=t.width??200;t=this._normalizeOptions(t);["font-size: 1px;",`padding: ${e}px 300px;`,`background: url(${this.canvas(t).toDataURL()}) no-repeat;`,"background-size: contain;"].join(" ")}destroy(){this._renderer=null}};xF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem],name:"extract"},xF.defaultImageOptions={format:"png",quality:1};let bF=xF;class _F extends ox{static create(t){return new _F({source:new ix(t)})}resize(t,e,n){return this.source.resize(t,e,n),this}}const SF=new Hy,wF=new cx,TF=[0,0,0,0];class MF{constructor(t){this._renderer=t}generateTexture(t){var e;t instanceof Db&&(t={target:t,frame:void 0,textureSourceOptions:{},resolution:void 0});const n=t.resolution||this._renderer.resolution,i=t.antialias||this._renderer.view.antialias,r=t.target;let s=t.clearColor;if(s){s=Array.isArray(s)&&4===s.length?s:zx.shared.setValue(s).toArray()}else s=TF;const a=(null==(e=t.frame)?void 0:e.copyTo(SF))||fb(r,wF).rectangle;a.width=0|Math.max(a.width,1/n),a.height=0|Math.max(a.height,1/n);const o=_F.create({...t.textureSourceOptions,width:a.width,height:a.height,resolution:n,antialias:i}),l=Ry.shared.translate(-a.x,-a.y);return this._renderer.render({container:r,transform:l,target:o,clearColor:s}),o.source.updateMipmaps(),o}destroy(){this._renderer=null}}function AF(t,e,n){const i=(t>>24&255)/255;e[n++]=(255&t)/255*i,e[n++]=(t>>8&255)/255*i,e[n++]=(t>>16&255)/255*i,e[n++]=i}MF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem],name:"textureGenerator"};class EF{constructor(t){this._stackIndex=0,this._globalUniformDataStack=[],this._uniformsPool=[],this._activeUniforms=[],this._bindGroupPool=[],this._activeBindGroups=[],this._renderer=t}reset(){this._stackIndex=0;for(let t=0;t<this._activeUniforms.length;t++)this._uniformsPool.push(this._activeUniforms[t]);for(let t=0;t<this._activeBindGroups.length;t++)this._bindGroupPool.push(this._activeBindGroups[t]);this._activeUniforms.length=0,this._activeBindGroups.length=0}start(t){this.reset(),this.push(t)}bind({size:t,projectionMatrix:e,worldTransformMatrix:n,worldColor:i,offset:r}){const s=this._renderer.renderTarget.renderTarget,a=this._stackIndex?this._globalUniformDataStack[this._stackIndex-1]:{projectionData:s,worldTransformMatrix:new Ry,worldColor:4294967295,offset:new Cy},o={projectionMatrix:e||this._renderer.renderTarget.projectionMatrix,resolution:t||s.size,worldTransformMatrix:n||a.worldTransformMatrix,worldColor:i||a.worldColor,offset:r||a.offset,bindGroup:null},l=this._uniformsPool.pop()||this._createUniforms();this._activeUniforms.push(l);const h=l.uniforms;let c;h.uProjectionMatrix=o.projectionMatrix,h.uResolution=o.resolution,h.uWorldTransformMatrix.copyFrom(o.worldTransformMatrix),h.uWorldTransformMatrix.tx-=o.offset.x,h.uWorldTransformMatrix.ty-=o.offset.y,AF(o.worldColor,h.uWorldColorAlpha,0),l.update(),this._renderer.renderPipes.uniformBatch?c=this._renderer.renderPipes.uniformBatch.getUniformBindGroup(l,!1):(c=this._bindGroupPool.pop()||new MS,this._activeBindGroups.push(c),c.setResource(l,0)),o.bindGroup=c,this._currentGlobalUniformData=o}push(t){this.bind(t),this._globalUniformDataStack[this._stackIndex++]=this._currentGlobalUniformData}pop(){this._currentGlobalUniformData=this._globalUniformDataStack[--this._stackIndex-1],this._renderer.type===AS.WEBGL&&this._currentGlobalUniformData.bindGroup.resources[0].update()}get bindGroup(){return this._currentGlobalUniformData.bindGroup}get globalUniformData(){return this._currentGlobalUniformData}get uniformGroup(){return this._currentGlobalUniformData.bindGroup.resources[0]}_createUniforms(){return new TS({uProjectionMatrix:{value:new Ry,type:"mat3x3<f32>"},uWorldTransformMatrix:{value:new Ry,type:"mat3x3<f32>"},uWorldColorAlpha:{value:new Float32Array(4),type:"vec4<f32>"},uResolution:{value:[0,0],type:"vec2<f32>"}},{isStatic:!0})}destroy(){this._renderer=null}}EF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"globalUniforms"};let CF=1;class PF{constructor(){this._tasks=[],this._offset=0}init(){Qb.system.add(this._update,this)}repeat(t,e,n=!0){const i=CF++;let r=0;return n&&(this._offset+=1e3,r=this._offset),this._tasks.push({func:t,duration:e,start:performance.now(),offset:r,last:performance.now(),repeat:!0,id:i}),i}cancel(t){for(let e=0;e<this._tasks.length;e++)if(this._tasks[e].id===t)return void this._tasks.splice(e,1)}_update(){const t=performance.now();for(let e=0;e<this._tasks.length;e++){const n=this._tasks[e];if(t-n.offset-n.last>=n.duration){const e=t-n.start;n.func(e),n.last=t}}}destroy(){Qb.system.remove(this._update,this),this._tasks.length=0}}PF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"scheduler",priority:0};let RF=!1;function IF(t){if(!RF){if(Wb.get().getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){const e=[`%c  %c  %c  %c  %c PixiJS %c v${Kw} (${t}) http://www.pixijs.com/\n\n`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...e)}else globalThis.console&&globalThis.console.log(`PixiJS ${Kw} - ${t} - http://www.pixijs.com/`);RF=!0}}class OF{constructor(t){this._renderer=t}init(t){if(t.hello){let t=this._renderer.name;this._renderer.type===AS.WEBGL&&(t+=` ${this._renderer.context.webGLVersion}`),IF(t)}}}function DF(t){let e=!1;for(const i in t)if(null==t[i]){e=!0;break}if(!e)return t;const n=Object.create(null);for(const i in t){const e=t[i];e&&(n[i]=e)}return n}function BF(t){let e=0;for(let n=0;n<t.length;n++)null==t[n]?e++:t[n-e]=t[n];return t.length-=e,t}OF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"hello",priority:-2},OF.defaultOptions={hello:!1};let FF=0;const LF=class t{constructor(t){this._managedRenderables=[],this._managedHashes=[],this._managedArrays=[],this._renderer=t}init(e){e={...t.defaultOptions,...e},this.maxUnusedTime=e.renderableGCMaxUnusedTime,this._frequency=e.renderableGCFrequency,this.enabled=e.renderableGCActive}get enabled(){return!!this._handler}set enabled(t){this.enabled!==t&&(t?(this._handler=this._renderer.scheduler.repeat(()=>this.run(),this._frequency,!1),this._hashHandler=this._renderer.scheduler.repeat(()=>{for(const t of this._managedHashes)t.context[t.hash]=DF(t.context[t.hash])},this._frequency),this._arrayHandler=this._renderer.scheduler.repeat(()=>{for(const t of this._managedArrays)BF(t.context[t.hash])},this._frequency)):(this._renderer.scheduler.cancel(this._handler),this._renderer.scheduler.cancel(this._hashHandler),this._renderer.scheduler.cancel(this._arrayHandler)))}addManagedHash(t,e){this._managedHashes.push({context:t,hash:e})}addManagedArray(t,e){this._managedArrays.push({context:t,hash:e})}prerender({container:t}){this._now=performance.now(),t.renderGroup.gcTick=FF++,this._updateInstructionGCTick(t.renderGroup,t.renderGroup.gcTick)}addRenderable(t){this.enabled&&(-1===t._lastUsed&&(this._managedRenderables.push(t),t.once("destroyed",this._removeRenderable,this)),t._lastUsed=this._now)}run(){var t;const e=this._now,n=this._managedRenderables,i=this._renderer.renderPipes;let r=0;for(let s=0;s<n.length;s++){const a=n[s];if(null===a){r++;continue}const o=a.renderGroup??a.parentRenderGroup,l=(null==(t=null==o?void 0:o.instructionSet)?void 0:t.gcTick)??-1;if(((null==o?void 0:o.gcTick)??0)===l&&(a._lastUsed=e),e-a._lastUsed>this.maxUnusedTime){if(!a.destroyed){const t=i;o&&(o.structureDidChange=!0),t[a.renderPipeId].destroyRenderable(a)}a._lastUsed=-1,r++,a.off("destroyed",this._removeRenderable,this)}else n[s-r]=a}n.length-=r}destroy(){this.enabled=!1,this._renderer=null,this._managedRenderables.length=0,this._managedHashes.length=0,this._managedArrays.length=0}_removeRenderable(t){const e=this._managedRenderables.indexOf(t);e>=0&&(t.off("destroyed",this._removeRenderable,this),this._managedRenderables[e]=null)}_updateInstructionGCTick(t,e){t.instructionSet.gcTick=e;for(const n of t.renderGroupChildren)this._updateInstructionGCTick(n,e)}};LF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem],name:"renderableGC",priority:0},LF.defaultOptions={renderableGCActive:!0,renderableGCMaxUnusedTime:6e4,renderableGCFrequency:3e4};let UF=LF;const kF=class t{constructor(t){this._renderer=t,this.count=0,this.checkCount=0}init(e){e={...t.defaultOptions,...e},this.checkCountMax=e.textureGCCheckCountMax,this.maxIdle=e.textureGCAMaxIdle??e.textureGCMaxIdle,this.active=e.textureGCActive}postrender(){this._renderer.renderingToScreen&&(this.count++,this.active&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this._renderer.texture.managedTextures;for(let e=0;e<t.length;e++){const n=t[e];n.autoGarbageCollect&&n.resource&&n._touched>-1&&this.count-n._touched>this.maxIdle&&(n._touched=-1,n.unload())}}destroy(){this._renderer=null}};kF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem],name:"textureGC"},kF.defaultOptions={textureGCActive:!0,textureGCAMaxIdle:null,textureGCMaxIdle:3600,textureGCCheckCountMax:600};let NF=kF;const zF=class t{get autoDensity(){return this.texture.source.autoDensity}set autoDensity(t){this.texture.source.autoDensity=t}get resolution(){return this.texture.source._resolution}set resolution(t){this.texture.source.resize(this.texture.source.width,this.texture.source.height,t)}init(e){(e={...t.defaultOptions,...e}).view&&(qy(0,"ViewSystem.view has been renamed to ViewSystem.canvas"),e.canvas=e.view),this.screen=new Hy(0,0,e.width,e.height),this.canvas=e.canvas||Wb.get().createCanvas(),this.antialias=!!e.antialias,this.texture=iB(this.canvas,e),this.renderTarget=new aB({colorTextures:[this.texture],depth:!!e.depth,isRoot:!0}),this.texture.source.transparent=e.backgroundAlpha<1,this.resolution=e.resolution}resize(t,e,n){this.texture.source.resize(t,e,n),this.screen.width=this.texture.frame.width,this.screen.height=this.texture.frame.height}destroy(t=!1){("boolean"==typeof t?t:!!(null==t?void 0:t.removeView))&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}};zF.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"view",priority:0},zF.defaultOptions={width:800,height:600,autoDensity:!1,antialias:!1};let GF=zF;const HF=[mF,EF,OF,GF,dF,NF,MF,bF,Zw,UF,PF],VF=[vF,hD,pF,iF,vD,xD,yD,$B],XF=[...HF,$D,LD,TD,ND,SD,JB,lB,DD,IB,EB,kD,FB,HD,UD],WF=[...VF],jF=[sD,QB,ZB],YF=[],qF=[],KF=[];vy.handleByNamedList(fy.WebGLSystem,YF),vy.handleByNamedList(fy.WebGLPipes,qF),vy.handleByNamedList(fy.WebGLPipesAdaptor,KF),vy.add(...XF,...WF,...jF);class JF extends Xw{constructor(){super({name:"webgl",type:AS.WEBGL,systems:YF,renderPipes:qF,renderPipeAdaptors:KF})}}const ZF=Object.freeze(Object.defineProperty({__proto__:null,WebGLRenderer:JF},Symbol.toStringTag,{value:"Module"}));class QF{constructor(t){this._hash=Object.create(null),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_hash")}contextChange(t){this._gpu=t}getBindGroup(t,e,n){t._updateKey();return this._hash[t._key]||this._createBindGroup(t,e,n)}_createBindGroup(t,e,n){const i=this._gpu.device,r=e.layout[n],s=[],a=this._renderer;for(const h in r){const e=t.resources[h]??t.resources[r[h]];let n;if("uniformGroup"===e._resourceType){const t=e;a.ubo.updateUniformGroup(t);const i=t.buffer;n={buffer:a.buffer.getGPUBuffer(i),offset:0,size:i.descriptor.size}}else if("buffer"===e._resourceType){const t=e;n={buffer:a.buffer.getGPUBuffer(t),offset:0,size:t.descriptor.size}}else if("bufferResource"===e._resourceType){const t=e;n={buffer:a.buffer.getGPUBuffer(t.buffer),offset:t.offset,size:t.size}}else if("textureSampler"===e._resourceType){const t=e;n=a.texture.getGpuSampler(t)}else if("textureSource"===e._resourceType){const t=e;n=a.texture.getGpuSource(t).createView({})}s.push({binding:r[h],resource:n})}const o=a.shader.getProgramData(e).bindGroups[n],l=i.createBindGroup({layout:o,entries:s});return this._hash[t._key]=l,l}destroy(){for(const t of Object.keys(this._hash))this._hash[t]=null;this._hash=null,this._renderer=null}}QF.extension={type:[fy.WebGPUSystem],name:"bindGroup"};class $F{constructor(t){this._gpuBuffers=Object.create(null),this._managedBuffers=[],t.renderableGC.addManagedHash(this,"_gpuBuffers")}contextChange(t){this._gpu=t}getGPUBuffer(t){return this._gpuBuffers[t.uid]||this.createGPUBuffer(t)}updateBuffer(t){const e=this._gpuBuffers[t.uid]||this.createGPUBuffer(t),n=t.data;return t._updateID&&n&&(t._updateID=0,this._gpu.device.queue.writeBuffer(e,0,n.buffer,0,(t._updateSize||n.byteLength)+3&-4)),e}destroyAll(){for(const t in this._gpuBuffers)this._gpuBuffers[t].destroy();this._gpuBuffers={}}createGPUBuffer(t){this._gpuBuffers[t.uid]||(t.on("update",this.updateBuffer,this),t.on("change",this.onBufferChange,this),t.on("destroy",this.onBufferDestroy,this),this._managedBuffers.push(t));const e=this._gpu.device.createBuffer(t.descriptor);return t._updateID=0,t.data&&(RT(t.data.buffer,e.getMappedRange()),e.unmap()),this._gpuBuffers[t.uid]=e,e}onBufferChange(t){this._gpuBuffers[t.uid].destroy(),t._updateID=0,this._gpuBuffers[t.uid]=this.createGPUBuffer(t)}onBufferDestroy(t){this._managedBuffers.splice(this._managedBuffers.indexOf(t),1),this._destroyBuffer(t)}destroy(){this._managedBuffers.forEach(t=>this._destroyBuffer(t)),this._managedBuffers=null,this._gpuBuffers=null}_destroyBuffer(t){this._gpuBuffers[t.uid].destroy(),t.off("update",this.updateBuffer,this),t.off("change",this.onBufferChange,this),t.off("destroy",this.onBufferDestroy,this),this._gpuBuffers[t.uid]=null}}$F.extension={type:[fy.WebGPUSystem],name:"buffer"};class tL{constructor({minUniformOffsetAlignment:t}){this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=t,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(t){if(t>this._minUniformOffsetAlignment/4)throw new Error("UniformBufferBatch: array is too large: "+4*t);const e=this.byteIndex;let n=e+4*t;if(n=Math.ceil(n/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment,n>4*this.data.length)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=n,e}addGroup(t){const e=this.addEmptyGroup(t.length);for(let n=0;n<t.length;n++)this.data[e/4+n]=t[n];return e}destroy(){this.data=null}}class eL{constructor(t){this._colorMaskCache=15,this._renderer=t}setMask(t){this._colorMaskCache!==t&&(this._colorMaskCache=t,this._renderer.pipeline.setColorMask(t))}destroy(){this._renderer=null,this._colorMaskCache=null}}eL.extension={type:[fy.WebGPUSystem],name:"colorMask"};class nL{constructor(t){this._renderer=t}async init(t){return this._initPromise||(this._initPromise=this._createDeviceAndAdaptor(t).then(t=>{this.gpu=t,this._renderer.runners.contextChange.emit(this.gpu)})),this._initPromise}contextChange(t){this._renderer.gpu=t}async _createDeviceAndAdaptor(t){const e=await Wb.get().getNavigator().gpu.requestAdapter({powerPreference:t.powerPreference,forceFallbackAdapter:t.forceFallbackAdapter}),n=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter(t=>e.features.has(t)),i=await e.requestDevice({requiredFeatures:n});return{adapter:e,device:i}}destroy(){this.gpu=null,this._renderer=null}}nL.extension={type:[fy.WebGPUSystem],name:"device"},nL.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1};class iL{constructor(t){this._boundBindGroup=Object.create(null),this._boundVertexBuffer=Object.create(null),this._renderer=t}renderStart(){this.commandFinished=new Promise(t=>{this._resolveCommandFinished=t}),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(t){this.endRenderPass(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(t.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(t){this.renderPassEncoder.setViewport(t.x,t.y,t.width,t.height,0,1)}setPipelineFromGeometryProgramAndState(t,e,n,i){const r=this._renderer.pipeline.getPipeline(t,e,n,i);this.setPipeline(r)}setPipeline(t){this._boundPipeline!==t&&(this._boundPipeline=t,this.renderPassEncoder.setPipeline(t))}_setVertexBuffer(t,e){this._boundVertexBuffer[t]!==e&&(this._boundVertexBuffer[t]=e,this.renderPassEncoder.setVertexBuffer(t,this._renderer.buffer.updateBuffer(e)))}_setIndexBuffer(t){if(this._boundIndexBuffer===t)return;this._boundIndexBuffer=t;const e=2===t.data.BYTES_PER_ELEMENT?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(t),e)}resetBindGroup(t){this._boundBindGroup[t]=null}setBindGroup(t,e,n){if(this._boundBindGroup[t]===e)return;this._boundBindGroup[t]=e,e._touch(this._renderer.textureGC.count);const i=this._renderer.bindGroup.getBindGroup(e,n,t);this.renderPassEncoder.setBindGroup(t,i)}setGeometry(t,e){const n=this._renderer.pipeline.getBufferNamesToBind(t,e);for(const i in n)this._setVertexBuffer(i,t.attributes[n[i]].buffer);t.indexBuffer&&this._setIndexBuffer(t.indexBuffer)}_setShaderBindGroups(t,e){for(const n in t.groups){const i=t.groups[n];e||this._syncBindGroup(i),this.setBindGroup(n,i,t.gpuProgram)}}_syncBindGroup(t){for(const e in t.resources){const n=t.resources[e];n.isUniformGroup&&this._renderer.ubo.updateUniformGroup(n)}}draw(t){const{geometry:e,shader:n,state:i,topology:r,size:s,start:a,instanceCount:o,skipSync:l}=t;this.setPipelineFromGeometryProgramAndState(e,n.gpuProgram,i,r),this.setGeometry(e,n.gpuProgram),this._setShaderBindGroups(n,l),e.indexBuffer?this.renderPassEncoder.drawIndexed(s||e.indexBuffer.data.length,o??e.instanceCount,a||0):this.renderPassEncoder.draw(s||e.getSize(),o??e.instanceCount,a||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished(),this.commandEncoder=null}restoreRenderPass(){const t=this._renderer.renderTarget.adaptor.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(t);const e=this._boundPipeline,n={...this._boundVertexBuffer},i=this._boundIndexBuffer,r={...this._boundBindGroup};this._clearCache();const s=this._renderer.renderTarget.viewport;this.renderPassEncoder.setViewport(s.x,s.y,s.width,s.height,0,1),this.setPipeline(e);for(const a in n)this._setVertexBuffer(a,n[a]);for(const a in r)this.setBindGroup(a,r[a],null);this._setIndexBuffer(i)}_clearCache(){for(let t=0;t<16;t++)this._boundBindGroup[t]=null,this._boundVertexBuffer[t]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){this._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(t){this._gpu=t}}iL.extension={type:[fy.WebGPUSystem],name:"encoder",priority:1};class rL{constructor(t){this._renderer=t}contextChange(){this.maxTextures=this._renderer.device.gpu.device.limits.maxSampledTexturesPerShaderStage,this.maxBatchableTextures=this.maxTextures}destroy(){}}rL.extension={type:[fy.WebGPUSystem],name:"limits"};class sL{constructor(t){this._renderTargetStencilState=Object.create(null),this._renderer=t,t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){let e=this._renderTargetStencilState[t.uid];e||(e=this._renderTargetStencilState[t.uid]={stencilMode:OT.DISABLED,stencilReference:0}),this._activeRenderTarget=t,this.setStencilMode(e.stencilMode,e.stencilReference)}setStencilMode(t,e){const n=this._renderTargetStencilState[this._activeRenderTarget.uid];n.stencilMode=t,n.stencilReference=e;const i=this._renderer;i.pipeline.setStencilMode(t),i.encoder.renderPassEncoder.setStencilReference(e)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this),this._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}}sL.extension={type:[fy.WebGPUSystem],name:"stencil"};const aL={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}};function oL(t){const e=t.map(t=>({data:t,offset:0,size:0}));let n=0;for(let i=0;i<e.length;i++){const t=e[i];let r=aL[t.data.type].size;const s=aL[t.data.type].align;if(!aL[t.data.type])throw new Error(`[Pixi.js] WebGPU UniformBuffer: Unknown type ${t.data.type}`);t.data.size>1&&(r=Math.max(r,s)*t.data.size),n=Math.ceil(n/s)*s,t.size=r,t.offset=n,n+=r}return n=16*Math.ceil(n/16),{uboElements:e,size:n}}function lL(t,e){const{size:n,align:i}=aL[t.data.type],r=(i-n)/4,s=t.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n         v = uv.${t.data.name};\n         ${0!==e?`offset += ${e};`:""}\n\n         arrayOffset = offset;\n\n         t = 0;\n\n         for(var i=0; i < ${t.data.size*(n/4)}; i++)\n         {\n             for(var j = 0; j < ${n/4}; j++)\n             {\n                 ${s}[arrayOffset++] = v[t++];\n             }\n             ${0!==r?`arrayOffset += ${r};`:""}\n         }\n     `}function hL(t){return YD(t,"uboWgsl",lL,JD)}class cL extends VD{constructor(){super({createUboElements:oL,generateUboSync:hL})}}cL.extension={type:[fy.WebGPUSystem],name:"ubo"};const uL=128;class dL{constructor(t){this._bindGroupHash=Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_bindGroupHash"),this._batchBuffer=new tL({minUniformOffsetAlignment:uL});for(let e=0;e<2;e++){let t=qT.UNIFORM|qT.COPY_DST;0===e&&(t|=qT.COPY_SRC),this._buffers.push(new KT({data:this._batchBuffer.data,usage:t}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(const t in this._bindGroupHash)this._bindGroupHash[t]=null;this._batchBuffer.clear()}getUniformBindGroup(t,e){if(!e&&this._bindGroupHash[t.uid])return this._bindGroupHash[t.uid];this._renderer.ubo.ensureUniformGroup(t);const n=t.buffer.data,i=this._batchBuffer.addEmptyGroup(n.length);return this._renderer.ubo.syncUniformGroup(t,this._batchBuffer.data,i/4),this._bindGroupHash[t.uid]=this._getBindGroup(i/uL),this._bindGroupHash[t.uid]}getUboResource(t){this._renderer.ubo.updateUniformGroup(t);const e=t.buffer.data,n=this._batchBuffer.addGroup(e);return this._getBufferResource(n/uL)}getArrayBindGroup(t){const e=this._batchBuffer.addGroup(t);return this._getBindGroup(e/uL)}getArrayBufferResource(t){const e=this._batchBuffer.addGroup(t)/uL;return this._getBufferResource(e)}_getBufferResource(t){if(!this._bufferResources[t]){const e=this._buffers[t%2];this._bufferResources[t]=new hB({buffer:e,offset:256*(t/2|0),size:uL})}return this._bufferResources[t]}_getBindGroup(t){if(!this._bindGroups[t]){const e=new MS({0:this._getBufferResource(t)});this._bindGroups[t]=e}return this._bindGroups[t]}_uploadBindGroups(){const t=this._renderer.buffer,e=this._buffers[0];e.update(this._batchBuffer.byteIndex),t.updateBuffer(e);const n=this._renderer.gpu.device.createCommandEncoder();for(let i=1;i<this._buffers.length;i++){const r=this._buffers[i];n.copyBufferToBuffer(t.getGPUBuffer(e),uL,t.getGPUBuffer(r),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([n.finish()])}destroy(){for(let t=0;t<this._bindGroups.length;t++)this._bindGroups[t].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let t=0;t<this._buffers.length;t++)this._buffers[t].destroy();this._buffers=null;for(let t=0;t<this._bufferResources.length;t++)this._bufferResources[t].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}}dL.extension={type:[fy.WebGPUPipes],name:"uniformBatch"};const pL={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};class fL{constructor(t){this._moduleCache=Object.create(null),this._bufferLayoutsCache=Object.create(null),this._bindingNamesCache=Object.create(null),this._pipeCache=Object.create(null),this._pipeStateCaches=Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=t}contextChange(t){this._gpu=t,this.setStencilMode(OT.DISABLED),this._updatePipeHash()}setMultisampleCount(t){this._multisampleCount!==t&&(this._multisampleCount=t,this._updatePipeHash())}setRenderTarget(t){this._multisampleCount=t.msaaSamples,this._depthStencilAttachment=t.descriptor.depthStencilAttachment?1:0,this._updatePipeHash()}setColorMask(t){this._colorMask!==t&&(this._colorMask=t,this._updatePipeHash())}setStencilMode(t){this._stencilMode!==t&&(this._stencilMode=t,this._stencilState=GD[t],this._updatePipeHash())}setPipeline(t,e,n,i){const r=this.getPipeline(t,e,n);i.setPipeline(r)}getPipeline(t,e,n,i){t._layoutKey||(MD(t,e.attributeData),this._generateBufferKey(t)),i||(i=t.topology);const r=function(t,e,n,i,r){return t<<24|e<<16|n<<10|i<<5|r}(t._layoutKey,e._layoutKey,n.data,n._blendModeId,pL[i]);return this._pipeCache[r]||(this._pipeCache[r]=this._createPipeline(t,e,n,i)),this._pipeCache[r]}_createPipeline(t,e,n,i){const r=this._gpu.device,s=this._createVertexBufferLayouts(t,e),a=this._renderer.state.getColorTargets(n);a[0].writeMask=this._stencilMode===OT.RENDERING_MASK_ADD?0:this._colorMask;const o=this._renderer.shader.getProgramData(e).pipeline,l={vertex:{module:this._getModule(e.vertex.source),entryPoint:e.vertex.entryPoint,buffers:s},fragment:{module:this._getModule(e.fragment.source),entryPoint:e.fragment.entryPoint,targets:a},primitive:{topology:i,cullMode:n.cullMode},layout:o,multisample:{count:this._multisampleCount},label:"PIXI Pipeline"};this._depthStencilAttachment&&(l.depthStencil={...this._stencilState,format:"depth24plus-stencil8",depthWriteEnabled:n.depthTest,depthCompare:n.depthTest?"less":"always"});return r.createRenderPipeline(l)}_getModule(t){return this._moduleCache[t]||this._createModule(t)}_createModule(t){const e=this._gpu.device;return this._moduleCache[t]=e.createShaderModule({code:t}),this._moduleCache[t]}_generateBufferKey(t){const e=[];let n=0;const i=Object.keys(t.attributes).sort();for(let s=0;s<i.length;s++){const r=t.attributes[i[s]];e[n++]=r.offset,e[n++]=r.format,e[n++]=r.stride,e[n++]=r.instance}const r=e.join("|");return t._layoutKey=Y_(r,"geometry"),t._layoutKey}_generateAttributeLocationsKey(t){const e=[];let n=0;const i=Object.keys(t.attributeData).sort();for(let s=0;s<i.length;s++){const r=t.attributeData[i[s]];e[n++]=r.location}const r=e.join("|");return t._attributeLocationsKey=Y_(r,"programAttributes"),t._attributeLocationsKey}getBufferNamesToBind(t,e){const n=t._layoutKey<<16|e._attributeLocationsKey;if(this._bindingNamesCache[n])return this._bindingNamesCache[n];const i=this._createVertexBufferLayouts(t,e),r=Object.create(null),s=e.attributeData;for(let a=0;a<i.length;a++){const t=Object.values(i[a].attributes)[0].shaderLocation;for(const e in s)if(s[e].location===t){r[a]=e;break}}return this._bindingNamesCache[n]=r,r}_createVertexBufferLayouts(t,e){e._attributeLocationsKey||this._generateAttributeLocationsKey(e);const n=t._layoutKey<<16|e._attributeLocationsKey;if(this._bufferLayoutsCache[n])return this._bufferLayoutsCache[n];const i=[];return t.buffers.forEach(n=>{const r={arrayStride:0,stepMode:"vertex",attributes:[]},s=r.attributes;for(const i in e.attributeData){const a=t.attributes[i];1!==(a.divisor??1)&&Vx(a.divisor),a.buffer===n&&(r.arrayStride=a.stride,r.stepMode=a.instance?"instance":"vertex",s.push({shaderLocation:e.attributeData[i].location,offset:a.offset,format:a.format}))}s.length&&i.push(r)}),this._bufferLayoutsCache[n]=i,i}_updatePipeHash(){const t=(e=this._stencilMode,n=this._multisampleCount,i=this._colorMask,r=this._depthStencilAttachment,i<<6|e<<3|r<<1|n);var e,n,i,r;this._pipeStateCaches[t]||(this._pipeStateCaches[t]=Object.create(null)),this._pipeCache=this._pipeStateCaches[t]}destroy(){this._renderer=null,this._bufferLayoutsCache=null}}fL.extension={type:[fy.WebGPUSystem],name:"pipeline"};class mL{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}class gL{init(t,e){this._renderer=t,this._renderTargetSystem=e}copyToTexture(t,e,n,i,r){const s=this._renderer,a=this._getGpuColorTexture(t),o=s.texture.getGpuSource(e.source);return s.encoder.commandEncoder.copyTextureToTexture({texture:a,origin:n},{texture:o,origin:r},i),e}startRenderPass(t,e=!0,n,i){const r=this._renderTargetSystem.getGpuRenderTarget(t),s=this.getDescriptor(t,e,n);r.descriptor=s,this._renderer.pipeline.setRenderTarget(r),this._renderer.encoder.beginRenderPass(r),this._renderer.encoder.setViewport(i)}finishRenderPass(){this._renderer.encoder.endRenderPass()}_getGpuColorTexture(t){const e=this._renderTargetSystem.getGpuRenderTarget(t);return e.contexts[0]?e.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(t.colorTextures[0].source)}getDescriptor(t,e,n){"boolean"==typeof e&&(e=e?kw.ALL:kw.NONE);const i=this._renderTargetSystem,r=i.getGpuRenderTarget(t),s=t.colorTextures.map((t,s)=>{const a=r.contexts[s];let o,l;if(a){o=a.getCurrentTexture().createView()}else o=this._renderer.texture.getGpuSource(t).createView({mipLevelCount:1});r.msaaTextures[s]&&(l=o,o=this._renderer.texture.getTextureView(r.msaaTextures[s]));const h=e&kw.COLOR?"clear":"load";return n??(n=i.defaultClearColor),{view:o,resolveTarget:l,clearValue:n,storeOp:"store",loadOp:h}});let a;if(!t.stencil&&!t.depth||t.depthStencilTexture||(t.ensureDepthStencilTexture(),t.depthStencilTexture.source.sampleCount=r.msaa?4:1),t.depthStencilTexture){const n=e&kw.STENCIL?"clear":"load",i=e&kw.DEPTH?"clear":"load";a={view:this._renderer.texture.getGpuSource(t.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:n,depthClearValue:1,depthLoadOp:i,depthStoreOp:"store"}}return{colorAttachments:s,depthStencilAttachment:a}}clear(t,e=!0,n,i){if(!e)return;const{gpu:r,encoder:s}=this._renderer,a=r.device;if(null===s.commandEncoder){const r=a.createCommandEncoder(),s=this.getDescriptor(t,e,n),o=r.beginRenderPass(s);o.setViewport(i.x,i.y,i.width,i.height,0,1),o.end();const l=r.finish();a.queue.submit([l])}else this.startRenderPass(t,e,n,i)}initGpuRenderTarget(t){t.isRoot=!0;const e=new mL;return t.colorTextures.forEach((t,n)=>{if(t instanceof jb){const i=t.resource.getContext("webgpu"),r=t.transparent?"premultiplied":"opaque";try{i.configure({device:this._renderer.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:r})}catch(S6){}e.contexts[n]=i}if(e.msaa=t.source.antialias,t.source.antialias){const t=new ix({width:0,height:0,sampleCount:4});e.msaaTextures[n]=t}}),e.msaa&&(e.msaaSamples=4,t.depthStencilTexture&&(t.depthStencilTexture.source.sampleCount=4)),e}destroyGpuRenderTarget(t){t.contexts.forEach(t=>{t.unconfigure()}),t.msaaTextures.forEach(t=>{t.destroy()}),t.msaaTextures.length=0,t.contexts.length=0}ensureDepthStencilTexture(t){const e=this._renderTargetSystem.getGpuRenderTarget(t);t.depthStencilTexture&&e.msaa&&(t.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(t){const e=this._renderTargetSystem.getGpuRenderTarget(t);e.width=t.width,e.height=t.height,e.msaa&&t.colorTextures.forEach((t,n)=>{const i=e.msaaTextures[n];null==i||i.resize(t.source.width,t.source.height,t.source._resolution)})}}class vL extends oB{constructor(t){super(t),this.adaptor=new gL,this.adaptor.init(t,this)}}vL.extension={type:[fy.WebGPUSystem],name:"renderTarget"};class yL{constructor(){this._gpuProgramData=Object.create(null)}contextChange(t){this._gpu=t}getProgramData(t){return this._gpuProgramData[t._layoutKey]||this._createGPUProgramData(t)}_createGPUProgramData(t){const e=this._gpu.device,n=t.gpuLayout.map(t=>e.createBindGroupLayout({entries:t})),i={bindGroupLayouts:n};return this._gpuProgramData[t._layoutKey]={bindGroups:n,pipeline:e.createPipelineLayout(i)},this._gpuProgramData[t._layoutKey]}destroy(){this._gpu=null,this._gpuProgramData=null}}yL.extension={type:[fy.WebGPUSystem],name:"shader"};const xL={normal:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}},add:{alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}},multiply:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}},screen:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},overlay:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},none:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}},"normal-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},"add-npm":{alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}},"screen-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}},erase:{alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}},min:{alpha:{srcFactor:"one",dstFactor:"one",operation:"min"},color:{srcFactor:"one",dstFactor:"one",operation:"min"}},max:{alpha:{srcFactor:"one",dstFactor:"one",operation:"max"},color:{srcFactor:"one",dstFactor:"one",operation:"max"}}};class bL{constructor(){this.defaultState=new RS,this.defaultState.blend=!0}contextChange(t){this.gpu=t}getColorTargets(t){return[{format:"bgra8unorm",writeMask:0,blend:xL[t.blendMode]||xL.normal}]}destroy(){this.gpu=null}}bL.extension={type:[fy.WebGPUSystem],name:"state"};const _L={type:"image",upload(t,e,n){const i=t.resource,r=(0|t.pixelWidth)*(0|t.pixelHeight),s=i.byteLength/r;n.device.queue.writeTexture({texture:e},i,{offset:0,rowsPerImage:t.pixelHeight,bytesPerRow:t.pixelHeight*s},{width:t.pixelWidth,height:t.pixelHeight,depthOrArrayLayers:1})}},SL={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},wL={blockBytes:4,blockWidth:1,blockHeight:1},TL={type:"compressed",upload(t,e,n){let i=t.pixelWidth,r=t.pixelHeight;const s=SL[t.format]||wL;for(let a=0;a<t.resource.length;a++){const o=t.resource[a],l=Math.ceil(i/s.blockWidth)*s.blockBytes;n.device.queue.writeTexture({texture:e,mipLevel:a},o,{offset:0,bytesPerRow:l},{width:Math.ceil(i/s.blockWidth)*s.blockWidth,height:Math.ceil(r/s.blockHeight)*s.blockHeight,depthOrArrayLayers:1}),i=Math.max(i>>1,1),r=Math.max(r>>1,1)}}},ML={type:"image",upload(t,e,n){const i=t.resource;if(!i)return;if(globalThis.HTMLImageElement&&i instanceof HTMLImageElement){const e=Wb.get().createCanvas(i.width,i.height);e.getContext("2d").drawImage(i,0,0,i.width,i.height),t.resource=e,Vx()}const r=Math.min(e.width,t.resourceWidth||t.pixelWidth),s=Math.min(e.height,t.resourceHeight||t.pixelHeight),a="premultiply-alpha-on-upload"===t.alphaMode;n.device.queue.copyExternalImageToTexture({source:i},{texture:e,premultipliedAlpha:a},{width:r,height:s})}},AL={type:"video",upload(t,e,n){ML.upload(t,e,n)}};class EL{constructor(t){this.device=t,this.sampler=t.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(t){let e=this.pipelines[t];return e||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:"\n                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(\n                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));\n\n                        struct VertexOutput {\n                        @builtin(position) position : vec4<f32>,\n                        @location(0) texCoord : vec2<f32>,\n                        };\n\n                        @vertex\n                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {\n                        var output : VertexOutput;\n                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);\n                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);\n                        return output;\n                        }\n\n                        @group(0) @binding(0) var imgSampler : sampler;\n                        @group(0) @binding(1) var img : texture_2d<f32>;\n\n                        @fragment\n                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {\n                        return textureSample(img, imgSampler, texCoord);\n                        }\n                    "})),e=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:t}]}}),this.pipelines[t]=e),e}generateMipmap(t){const e=this._getMipmapPipeline(t.format);if("3d"===t.dimension||"1d"===t.dimension)throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let n=t;const i=t.depthOrArrayLayers||1,r=t.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!r){const e={size:{width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:i},format:t.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:t.mipLevelCount-1};n=this.device.createTexture(e)}const s=this.device.createCommandEncoder({}),a=e.getBindGroupLayout(0);for(let o=0;o<i;++o){let i=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:o,arrayLayerCount:1}),l=r?1:0;for(let r=1;r<t.mipLevelCount;++r){const t=n.createView({baseMipLevel:l++,mipLevelCount:1,dimension:"2d",baseArrayLayer:o,arrayLayerCount:1}),r=s.beginRenderPass({colorAttachments:[{view:t,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),h=this.device.createBindGroup({layout:a,entries:[{binding:0,resource:this.sampler},{binding:1,resource:i}]});r.setPipeline(e),r.setBindGroup(0,h),r.draw(3,1,0,0),r.end(),i=t}}if(!r){const e={width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:i};for(let i=1;i<t.mipLevelCount;++i)s.copyTextureToTexture({texture:n,mipLevel:i-1},{texture:t,mipLevel:i},e),e.width=Math.ceil(e.width/2),e.height=Math.ceil(e.height/2)}return this.device.queue.submit([s.finish()]),r||n.destroy(),t}}class CL{constructor(t){this.managedTextures=[],this._gpuSources=Object.create(null),this._gpuSamplers=Object.create(null),this._bindGroupHash=Object.create(null),this._textureViewHash=Object.create(null),this._uploads={image:ML,buffer:_L,video:AL,compressed:TL},this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuSources"),t.renderableGC.addManagedHash(this,"_gpuSamplers"),t.renderableGC.addManagedHash(this,"_bindGroupHash"),t.renderableGC.addManagedHash(this,"_textureViewHash")}contextChange(t){this._gpu=t}initSource(t){if(t.autoGenerateMipmaps){const e=Math.max(t.pixelWidth,t.pixelHeight);t.mipLevelCount=Math.floor(Math.log2(e))+1}let e=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;"compressed"!==t.uploadMethodId&&(e|=GPUTextureUsage.RENDER_ATTACHMENT,e|=GPUTextureUsage.COPY_SRC);const n=SL[t.format]||{blockBytes:4,blockWidth:1,blockHeight:1},i=Math.ceil(t.pixelWidth/n.blockWidth)*n.blockWidth,r=Math.ceil(t.pixelHeight/n.blockHeight)*n.blockHeight,s={label:t.label,size:{width:i,height:r},format:t.format,sampleCount:t.sampleCount,mipLevelCount:t.mipLevelCount,dimension:t.dimension,usage:e},a=this._gpu.device.createTexture(s);return this._gpuSources[t.uid]=a,this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceResize,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),a}onSourceUpdate(t){const e=this.getGpuSource(t);e&&(this._uploads[t.uploadMethodId]&&this._uploads[t.uploadMethodId].upload(t,e,this._gpu),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t))}onSourceUnload(t){const e=this._gpuSources[t.uid];e&&(this._gpuSources[t.uid]=null,e.destroy())}onUpdateMipmaps(t){this._mipmapGenerator||(this._mipmapGenerator=new EL(this._gpu.device));const e=this.getGpuSource(t);this._mipmapGenerator.generateMipmap(e)}onSourceDestroy(t){t.off("update",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("destroy",this.onSourceDestroy,this),t.off("resize",this.onSourceResize,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}onSourceResize(t){const e=this._gpuSources[t.uid];e?e.width===t.pixelWidth&&e.height===t.pixelHeight||(this._textureViewHash[t.uid]=null,this._bindGroupHash[t.uid]=null,this.onSourceUnload(t),this.initSource(t)):this.initSource(t)}_initSampler(t){return this._gpuSamplers[t._resourceId]=this._gpu.device.createSampler(t),this._gpuSamplers[t._resourceId]}getGpuSampler(t){return this._gpuSamplers[t._resourceId]||this._initSampler(t)}getGpuSource(t){return this._gpuSources[t.uid]||this.initSource(t)}getTextureBindGroup(t){return this._bindGroupHash[t.uid]??this._createTextureBindGroup(t)}_createTextureBindGroup(t){const e=t.source;return this._bindGroupHash[t.uid]=new MS({0:e,1:e.style,2:new TS({uTextureMatrix:{type:"mat3x3<f32>",value:t.textureMatrix.mapCoord}})}),this._bindGroupHash[t.uid]}getTextureView(t){const e=t.source;return this._textureViewHash[e.uid]??this._createTextureView(e)}_createTextureView(t){return this._textureViewHash[t.uid]=this.getGpuSource(t).createView(),this._textureViewHash[t.uid]}generateCanvas(t){const e=this._renderer,n=e.gpu.device.createCommandEncoder(),i=Wb.get().createCanvas();i.width=t.source.pixelWidth,i.height=t.source.pixelHeight;const r=i.getContext("webgpu");return r.configure({device:e.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:Wb.get().getNavigator().gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),n.copyTextureToTexture({texture:e.texture.getGpuSource(t.source),origin:{x:0,y:0}},{texture:r.getCurrentTexture()},{width:i.width,height:i.height}),e.gpu.device.queue.submit([n.finish()]),i}getPixels(t){const e=this.generateCanvas(t),n=pE.getOptimalCanvasAndContext(e.width,e.height),i=n.context;i.drawImage(e,0,0);const{width:r,height:s}=e,a=i.getImageData(0,0,r,s),o=new Uint8ClampedArray(a.data.buffer);return pE.returnCanvasAndContext(n),{pixels:o,width:r,height:s}}destroy(){this.managedTextures.slice().forEach(t=>this.onSourceDestroy(t)),this.managedTextures=null;for(const t of Object.keys(this._bindGroupHash)){const e=Number(t),n=this._bindGroupHash[e];null==n||n.destroy(),this._bindGroupHash[e]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}}CL.extension={type:[fy.WebGPUSystem],name:"texture"};class PL{constructor(){this._maxTextures=0}contextChange(t){const e=new TS({uTransformMatrix:{value:new Ry,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}});this._maxTextures=t.limits.maxBatchableTextures;const n=TM({name:"graphics",bits:[AM,IM(this._maxTextures),uD,FM]});this.shader=new ES({gpuProgram:n,resources:{localUniforms:e}})}execute(t,e){const n=e.context,i=n.customShader||this.shader,r=t.renderer,s=r.graphicsContext,{batcher:a,instructions:o}=s.getContextRenderData(n),l=r.encoder;l.setGeometry(a.geometry,i.gpuProgram);const h=r.globalUniforms.bindGroup;l.setBindGroup(0,h,i.gpuProgram);const c=r.renderPipes.uniformBatch.getUniformBindGroup(i.resources.localUniforms,!0);l.setBindGroup(2,c,i.gpuProgram);const u=o.instructions;let d=null;for(let p=0;p<o.instructionSize;p++){const e=u[p];if(e.topology!==d&&(d=e.topology,l.setPipelineFromGeometryProgramAndState(a.geometry,i.gpuProgram,t.state,e.topology)),i.groups[1]=e.bindGroup,!e.gpuBindGroup){const t=e.textures;e.bindGroup=CT(t.textures,t.count,this._maxTextures),e.gpuBindGroup=r.bindGroup.getBindGroup(e.bindGroup,i.gpuProgram,1)}l.setBindGroup(1,e.bindGroup,i.gpuProgram),l.renderPassEncoder.drawIndexed(e.size,1,e.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}PL.extension={type:[fy.WebGPUPipesAdaptor],name:"graphics"};class RL{init(){const t=TM({name:"mesh",bits:[cD,pD,FM]});this._shader=new ES({gpuProgram:t,resources:{uTexture:ox.EMPTY._source,uSampler:ox.EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new Ry}}}})}execute(t,e){const n=t.renderer;let i=e._shader;if(i){if(!i.gpuProgram)return void Vx(e.shader)}else i=this._shader,i.groups[2]=n.texture.getTextureBindGroup(e.texture);const r=i.gpuProgram;if(r.autoAssignGlobalUniforms&&(i.groups[0]=n.globalUniforms.bindGroup),r.autoAssignLocalUniforms){const e=t.localUniforms;i.groups[1]=n.renderPipes.uniformBatch.getUniformBindGroup(e,!0)}n.encoder.draw({geometry:e._geometry,shader:i,state:e.state})}destroy(){this._shader.destroy(!0),this._shader=null}}RL.extension={type:[fy.WebGPUPipesAdaptor],name:"mesh"};const IL=[...HF,cL,iL,nL,rL,$F,CL,vL,yL,bL,fL,eL,sL,QF],OL=[...VF,dL],DL=[oD,RL,PL],BL=[],FL=[],LL=[];vy.handleByNamedList(fy.WebGPUSystem,BL),vy.handleByNamedList(fy.WebGPUPipes,FL),vy.handleByNamedList(fy.WebGPUPipesAdaptor,LL),vy.add(...IL,...OL,...DL);class UL extends Xw{constructor(){super({name:"webgpu",type:AS.WEBGPU,systems:BL,renderPipes:FL,renderPipeAdaptors:LL})}}const kL=Object.freeze(Object.defineProperty({__proto__:null,WebGPURenderer:UL},Symbol.toStringTag,{value:"Module"})),NL={POINTS:"point-list",LINES:"line-list",LINE_STRIP:"line-strip",TRIANGLES:"triangle-list",TRIANGLE_STRIP:"triangle-strip"},zL=new Proxy(NL,{get:(t,e)=>(qy(0,`DRAW_MODES.${e} is deprecated, use '${NL[e]}' instead`),t[e])});var GL=(t=>(t.CLAMP="clamp-to-edge",t.REPEAT="repeat",t.MIRRORED_REPEAT="mirror-repeat",t))(GL||{});const HL=new Proxy(GL,{get:(t,e)=>(qy(0,`DRAW_MODES.${e} is deprecated, use '${GL[e]}' instead`),t[e])});var VL=(t=>(t.NEAREST="nearest",t.LINEAR="linear",t))(VL||{});const XL=new Proxy(VL,{get:(t,e)=>(qy(0,`DRAW_MODES.${e} is deprecated, use '${VL[e]}' instead`),t[e])});function WL(t,e,n){qy(0,"Please use container.collectRenderables instead.");const i=n.renderPipes?n:n.batch.renderer;return t.collectRenderables(e,i,null)}class jL{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{jx.return(t)}),this.batches.length=0}}class YL{constructor(t,e){this.state=RS.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this)}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){const e=t.context,n=!!t._gpuData,i=this.renderer.graphicsContext.updateGpuContext(e);return!(!i.isBatchable&&n===i.isBatchable)}addRenderable(t,e){const n=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),n.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const e=this._getGpuDataForRenderable(t).batches;for(let n=0;n<e.length;n++){const t=e[n];t._batcher.updateElement(t)}}execute(t){if(!t.isRenderable)return;const e=this.renderer,n=t.context;if(!e.graphicsContext.getGpuContext(n).batches.length)return;const i=n.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const r=i.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=e._roundPixels|t._roundPixels,AF(t.groupColorAlpha,r.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=this._getGpuDataForRenderable(t),n=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),n.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){const n=this.renderer.renderPipes.batch,i=this._getGpuDataForRenderable(t).batches;for(let r=0;r<i.length;r++){const t=i[r];n.addToBatch(t,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){const e=new jL;return t._gpuData[this.renderer.uid]=e,e}_updateBatchesForRenderable(t,e){const n=t.context,i=this.renderer.graphicsContext.getGpuContext(n),r=this.renderer._roundPixels|t._roundPixels;e.batches=i.batches.map(e=>{const n=jx.get(YM);return e.copyTo(n),n.renderable=t,n.roundPixels=r,n})}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}YL.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"graphics"};const qL=class t extends Db{constructor(e={}){e={...t.defaultOptions,...e},super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...t){for(let e=0;e<t.length;e++){const n=t[e];if(n.parentRenderLayer){if(n.parentRenderLayer===this)continue;n.parentRenderLayer.detach(n)}this.renderLayerChildren.push(n),n.parentRenderLayer=this;const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0)}return t[0]}detach(...t){for(let e=0;e<t.length;e++){const n=t[e],i=this.renderLayerChildren.indexOf(n);-1!==i&&this.renderLayerChildren.splice(i,1),n.parentRenderLayer=null;const r=this.renderGroup||this.parentRenderGroup;r&&(r.structureDidChange=!0)}return t[0]}detachAll(){const t=this.renderLayerChildren;for(let e=0;e<t.length;e++)t[e].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(t,e,n){const i=this.renderLayerChildren,r=i.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let s=0;s<r;s++)i[s].parent||Vx(i[s]),i[s].collectRenderables(t,e,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(t,e,n){if(!t)return;const i=this.renderLayerChildren;for(let r=0;r<i.length;r++)i[r]._getGlobalBoundsRecursive(!0,e,this)}};qL.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};const KL=qL,JL=class t extends EO{constructor(...t){super({});let e=t[0]??{};"number"==typeof e&&(qy(0,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),e={width:e,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(e)}build(e){e={...t.defaultOptions,...e},this.verticesX=this.verticesX??e.verticesX,this.verticesY=this.verticesY??e.verticesY,this.width=this.width??e.width,this.height=this.height??e.height;const n=this.verticesX*this.verticesY,i=[],r=[],s=[],a=this.verticesX-1,o=this.verticesY-1,l=this.width/a,h=this.height/o;for(let t=0;t<n;t++){const e=t%this.verticesX,n=t/this.verticesX|0;i.push(e*l,n*h),r.push(e/a,n/o)}const c=a*o;for(let t=0;t<c;t++){const e=t%a,n=t/a|0,i=n*this.verticesX+e,r=n*this.verticesX+e+1,o=(n+1)*this.verticesX+e,l=(n+1)*this.verticesX+e+1;s.push(i,r,o,r,l,o)}this.buffers[0].data=new Float32Array(i),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint32Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};JL.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let ZL=JL;function QL(t,e,n,i){const r=n.buffers[0],s=r.data,{verticesX:a,verticesY:o}=n,l=t/(a-1),h=e/(o-1);let c=0;const u=i[0],d=i[1],p=i[2],f=i[3],m=i[4],g=i[5],v=i[6],y=i[7],x=i[8];for(let b=0;b<s.length;b+=2){const t=c%a*l,e=(c/a|0)*h,n=u*t+d*e+p,i=f*t+m*e+g,r=v*t+y*e+x;s[b]=n/r,s[b+1]=i/r,c++}r.update()}function $L(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=e[8];return t[0]=a*c-o*h,t[1]=r*h-i*c,t[2]=i*o-r*a,t[3]=o*l-s*c,t[4]=n*c-r*l,t[5]=r*s-n*o,t[6]=s*h-a*l,t[7]=i*l-n*h,t[8]=n*a-i*s,t}function tU(t,e,n){const i=e[0],r=e[1],s=e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=e[7],u=e[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],v=n[5],y=n[6],x=n[7],b=n[8];return t[0]=d*i+p*a+f*h,t[1]=d*r+p*o+f*c,t[2]=d*s+p*l+f*u,t[3]=m*i+g*a+v*h,t[4]=m*r+g*o+v*c,t[5]=m*s+g*l+v*u,t[6]=y*i+x*a+b*h,t[7]=y*r+x*o+b*c,t[8]=y*s+x*l+b*u,t}const eU=[0,0,0,0,0,0,0,0,0],nU=[0,0,0],iU=[0,0,0];function rU(t,e,n,i,r,s,a,o,l){const h=eU;h[0]=e,h[1]=i,h[2]=s,h[3]=n,h[4]=r,h[5]=a,h[6]=1,h[7]=1,h[8]=1;const c=$L(t,h);iU[0]=o,iU[1]=l,iU[2]=1;const u=function(t,e,n){const i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i+e[1]*r+e[2]*s,t[1]=e[3]*i+e[4]*r+e[5]*s,t[2]=e[6]*i+e[7]*r+e[8]*s,t}(nU,c,iU),d=t;return t[0]=u[0],t[1]=0,t[2]=0,t[3]=0,t[4]=u[1],t[5]=0,t[6]=0,t[7]=0,t[8]=u[2],tU(t,d,h)}const sU=[0,0,0,0,0,0,0,0,0],aU=[0,0,0,0,0,0,0,0,0];function oU(t,e,n,i,r,s,a,o,l,h,c,u,d,p,f,m,g){const v=rU(sU,e,n,s,a,h,c,p,f),y=rU(aU,i,r,o,l,u,d,m,g);return tU(t,$L(v,v),y)}class lU extends ZL{constructor(t){super(t),this._projectionMatrix=[0,0,0,0,0,0,0,0,0];const{width:e,height:n}=t;this.corners=[0,0,e,0,e,n,0,n]}setCorners(t,e,n,i,r,s,a,o){const l=this.corners;l[0]=t,l[1]=e,l[2]=n,l[3]=i,l[4]=r,l[5]=s,l[6]=a,l[7]=o,this.updateProjection()}updateProjection(){const{width:t,height:e}=this,n=this.corners;QL(t,e,this,oU(this._projectionMatrix,0,0,n[0],n[1],t,0,n[2],n[3],t,e,n[4],n[5],0,e,n[6],n[7]))}}const hU=class t extends CO{constructor(e){e={...t.defaultOptions,...e};const{texture:n,verticesX:i,verticesY:r,...s}=e,a=new lU(Qy({width:n.width,height:n.height,verticesX:i,verticesY:r}));super(Qy({...s,geometry:a})),this._texture=n,this.geometry.setCorners(e.x0,e.y0,e.x1,e.y1,e.x2,e.y2,e.x3,e.y3)}textureUpdated(){const t=this.geometry;if(!t)return;const{width:e,height:n}=this.texture;t.width===e&&t.height===n||(t.width=e,t.height=n,t.updateProjection())}set texture(t){this._texture!==t&&(super.texture=t,this.textureUpdated())}get texture(){return this._texture}setCorners(t,e,n,i,r,s,a,o){this.geometry.setCorners(t,e,n,i,r,s,a,o)}};hU.defaultOptions={texture:ox.WHITE,verticesX:10,verticesY:10,x0:0,y0:0,x1:100,y1:0,x2:100,y2:100,x3:0,y3:100};let cU=hU;const uU=class t extends EO{constructor(e){const{width:n,points:i,textureScale:r}={...t.defaultOptions,...e};super({positions:new Float32Array(4*i.length),uvs:new Float32Array(4*i.length),indices:new Uint32Array(6*(i.length-1))}),this.points=i,this._width=n,this.textureScale=r,this._build()}get width(){return this._width}_build(){const t=this.points;if(!t)return;const e=this.getBuffer("aPosition"),n=this.getBuffer("aUV"),i=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),n.data=new Float32Array(4*t.length),i.data=new Uint16Array(6*(t.length-1)));const r=n.data,s=i.data;r[0]=0,r[1]=0,r[2]=0,r[3]=1;let a=0,o=t[0];const l=this._width*this.textureScale,h=t.length;for(let u=0;u<h;u++){const e=4*u;if(this.textureScale>0){const e=o.x-t[u].x,n=o.y-t[u].y,i=Math.sqrt(e*e+n*n);o=t[u],a+=i/l}else a=u/(h-1);r[e]=a,r[e+1]=0,r[e+2]=a,r[e+3]=1}let c=0;for(let u=0;u<h-1;u++){const t=2*u;s[c++]=t,s[c++]=t+1,s[c++]=t+2,s[c++]=t+2,s[c++]=t+1,s[c++]=t+3}n.update(),i.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e,n=t[0],i=0,r=0;const s=this.buffers[0].data,a=t.length,o=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<a;l++){const a=t[l],h=4*l;e=l<t.length-1?t[l+1]:a,r=-(e.x-n.x),i=e.y-n.y;const c=Math.sqrt(i*i+r*r);c<1e-6?(i=0,r=0):(i/=c,r/=c,i*=o,r*=o),s[h]=a.x+i,s[h+1]=a.y+r,s[h+2]=a.x-i,s[h+3]=a.y-r,n=a}this.buffers[0].update()}update(){this.textureScale>0?this._build():this.updateVertices()}};uU.defaultOptions={width:200,points:[],textureScale:0};let dU=uU;const pU=class t extends CO{constructor(e){const{texture:n,points:i,textureScale:r,...s}={...t.defaultOptions,...e},a=new dU(Qy({width:n.height,points:i,textureScale:r}));r>0&&(n.source.style.addressMode="repeat"),super(Qy({...s,texture:n,geometry:a})),this.autoUpdate=!0,this.onRender=this._render}_render(){const t=this.geometry;(this.autoUpdate||t._width!==this.texture.height)&&(t._width=this.texture.height,t.update())}};pU.defaultOptions={textureScale:0};let fU=pU;class mU{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){const t=this.geometry.getBuffer("aUV"),e=t.data;let n=e;const i=this.texture.textureMatrix;return i.isSimple||(n=this._transformedUvs,this._textureMatrixUpdateId===i._updateID&&this._uvUpdateId===t._updateID||((!n||n.length<e.length)&&(n=this._transformedUvs=new Float32Array(e.length)),this._textureMatrixUpdateId=i._updateID,this._uvUpdateId=t._updateID,i.multiplyUvs(e,n))),n}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class gU{destroy(){}}class vU{constructor(t,e){this.localUniforms=new TS({uTransformMatrix:{value:new Ry,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new MS({0:this.localUniforms}),this.renderer=t,this._adaptor=e,this._adaptor.init()}validateRenderable(t){const e=this._getMeshData(t),n=e.batched,i=t.batched;if(e.batched=i,n!==i)return!0;if(i){const n=t._geometry;if(n.indices.length!==e.indexSize||n.positions.length!==e.vertexSize)return e.indexSize=n.indices.length,e.vertexSize=n.positions.length,!0;const i=this._getBatchableMesh(t);return i.texture.uid!==t._texture.uid&&(i._textureMatrixUpdateId=-1),!i._batcher.checkAndUpdateTexture(i,t._texture)}return!1}addRenderable(t,e){const n=this.renderer.renderPipes.batch,{batched:i}=this._getMeshData(t);if(i){const i=this._getBatchableMesh(t);i.setTexture(t._texture),i.geometry=t._geometry,n.addToBatch(i,e)}else n.break(e),e.add(t)}updateRenderable(t){if(t.batched){const e=this._getBatchableMesh(t);e.setTexture(t._texture),e.geometry=t._geometry,e._batcher.updateElement(e)}}execute(t){if(!t.isRenderable)return;t.state.blendMode=DT(t.groupBlendMode,t.texture._source);const e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),AF(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){var e,n;return(e=t._gpuData)[n=this.renderer.uid]||(e[n]=new gU),t._gpuData[this.renderer.uid].meshData||this._initMeshData(t)}_initMeshData(t){var e,n;return t._gpuData[this.renderer.uid].meshData={batched:t.batched,indexSize:null==(e=t._geometry.indices)?void 0:e.length,vertexSize:null==(n=t._geometry.positions)?void 0:n.length},t._gpuData[this.renderer.uid].meshData}_getBatchableMesh(t){var e,n;return(e=t._gpuData)[n=this.renderer.uid]||(e[n]=new gU),t._gpuData[this.renderer.uid].batchableMesh||this._initBatchableMesh(t)}_initBatchableMesh(t){const e=new mU;return e.renderable=t,e.setTexture(t._texture),e.transform=t.groupTransform,e.roundPixels=this.renderer._roundPixels|t._roundPixels,t._gpuData[this.renderer.uid].batchableMesh=e,e}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}vU.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"mesh"};class yU{execute(t,e){const n=t.state,i=t.renderer,r=e.shader||t.defaultShader;r.resources.uTexture=e.texture._source,r.resources.uniforms=t.localUniforms;const s=i.gl,a=t.getBuffers(e);i.shader.bind(r),i.state.set(n),i.geometry.bind(a.geometry,r.glProgram);const o=2===a.geometry.indexBuffer.data.BYTES_PER_ELEMENT?s.UNSIGNED_SHORT:s.UNSIGNED_INT;s.drawElements(s.TRIANGLES,6*e.particleChildren.length,o,0)}}class xU{execute(t,e){const n=t.renderer,i=e.shader||t.defaultShader;i.groups[0]=n.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),i.groups[1]=n.texture.getTextureBindGroup(e.texture);const r=t.state,s=t.getBuffers(e);n.encoder.draw({geometry:s.geometry,shader:e.shader||t.defaultShader,state:r,size:6*e.particleChildren.length})}}function bU(t,e=null){const n=6*t;if(n>65535?e||(e=new Uint32Array(n)):e||(e=new Uint16Array(n)),e.length!==n)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${n}`);for(let i=0,r=0;i<n;i+=6,r+=4)e[i+0]=r+0,e[i+1]=r+1,e[i+2]=r+2,e[i+3]=r+0,e[i+4]=r+2,e[i+5]=r+3;return e}function _U(t){return{dynamicUpdate:SU(t,!0),staticUpdate:SU(t,!1)}}function SU(t,e){const n=[];n.push("\n\n        var index = 0;\n\n        for (let i = 0; i < ps.length; ++i)\n        {\n            const p = ps[i];\n\n            ");let i=0;for(const s in t){const r=t[s];if(e!==r.dynamic)continue;n.push(`offset = index + ${i}`),n.push(r.code);i+=cS(r.format).stride/4}n.push("\n            index += stride * 4;\n        }\n    "),n.unshift(`\n        var stride = ${i};\n    `);const r=n.join("\n");return new Function("ps","f32v","u32v",r)}class wU{constructor(t){this._size=0,this._generateParticleUpdateCache={};const e=this._size=t.size??1e3,n=t.properties;let i=0,r=0;for(const h in n){const t=n[h],e=cS(t.format);t.dynamic?r+=e.stride:i+=e.stride}this._dynamicStride=r/4,this._staticStride=i/4,this.staticAttributeBuffer=new PT(4*e*i),this.dynamicAttributeBuffer=new PT(4*e*r),this.indexBuffer=bU(e);const s=new QT;let a=0,o=0;this._staticBuffer=new KT({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:qT.VERTEX|qT.COPY_DST}),this._dynamicBuffer=new KT({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:qT.VERTEX|qT.COPY_DST});for(const h in n){const t=n[h],e=cS(t.format);t.dynamic?(s.addAttribute(t.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*a,format:t.format}),a+=e.size):(s.addAttribute(t.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*o,format:t.format}),o+=e.size)}s.addIndex(this.indexBuffer);const l=this.getParticleUpdate(n);this._dynamicUpload=l.dynamicUpdate,this._staticUpload=l.staticUpdate,this.geometry=s}getParticleUpdate(t){const e=function(t){const e=[];for(const n in t){const i=t[n];e.push(n,i.code,i.dynamic?"d":"s")}return e.join("_")}(t);return this._generateParticleUpdateCache[e]||(this._generateParticleUpdateCache[e]=this.generateParticleUpdate(t)),this._generateParticleUpdateCache[e]}generateParticleUpdate(t){return _U(t)}update(t,e){t.length>this._size&&(e=!0,this._size=Math.max(t.length,1.5*this._size|0),this.staticAttributeBuffer=new PT(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new PT(this._size*this._dynamicStride*4*4),this.indexBuffer=bU(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const n=this.dynamicAttributeBuffer;if(this._dynamicUpload(t,n.float32View,n.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this._dynamicStride*4,!0),e){const e=this.staticAttributeBuffer;this._staticUpload(t,e.float32View,e.uint32View),this._staticBuffer.setDataWithSize(e.float32View,t.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var TU="varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}",MU="attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",AU="\nstruct ParticleUniforms {\n  uProjectionMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uResolution:vec2<f32>,\n  uRoundPixels:f32,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class EU extends ES{constructor(){super({glProgram:lS.from({vertex:MU,fragment:TU}),gpuProgram:xS.from({fragment:{source:AU,entryPoint:"mainFragment"},vertex:{source:AU,entryPoint:"mainVertex"}}),resources:{uTexture:ox.WHITE.source,uSampler:new ex({}),uniforms:{uTranslationMatrix:{value:new Ry,type:"mat3x3<f32>"},uColor:{value:new zx(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class CU{constructor(t,e){this.state=RS.for2d(),this.localUniforms=new TS({uTranslationMatrix:{value:new Ry,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=e,this.defaultShader=new EU,this.state=RS.for2d()}validateRenderable(t){return!1}addRenderable(t,e){this.renderer.renderPipes.batch.break(e),e.add(t)}getBuffers(t){return t._gpuData[this.renderer.uid]||this._initBuffer(t)}_initBuffer(t){return t._gpuData[this.renderer.uid]=new wU({size:t.particleChildren.length,properties:t._properties}),t._gpuData[this.renderer.uid]}updateRenderable(t){}execute(t){const e=t.particleChildren;if(0===e.length)return;const n=this.renderer,i=this.getBuffers(t);t.texture||(t.texture=e[0].texture);const r=this.state;i.update(e,t._childrenDirty),t._childrenDirty=!1,r.blendMode=DT(t.blendMode,t.texture._source);const s=this.localUniforms.uniforms,a=s.uTranslationMatrix;t.worldTransform.copyTo(a),a.prepend(n.globalUniforms.globalUniformData.projectionMatrix),s.uResolution=n.globalUniforms.globalUniformData.resolution,s.uRound=n._roundPixels|t._roundPixels,AF(t.groupColorAlpha,s.uColor,0),this.adaptor.execute(this,t)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class PU extends CU{constructor(t){super(t,new yU)}}PU.extension={type:[fy.WebGLPipes],name:"particle"};class RU extends CU{constructor(t){super(t,new xU)}}RU.extension={type:[fy.WebGPUPipes],name:"particle"};const IU=class t{constructor(e){if(e instanceof ox)this.texture=e,Cb(this,t.defaultOptions,{});else{Cb(this,{...t.defaultOptions,...e},{})}}get alpha(){return this._alpha}set alpha(t){this._alpha=Math.min(Math.max(t,0),1),this._updateColor()}get tint(){return db(this._tint)}set tint(t){this._tint=zx.shared.setValue(t??16777215).toBgrNumber(),this._updateColor()}_updateColor(){this.color=this._tint+(255*this._alpha<<24)}};IU.defaultOptions={anchorX:0,anchorY:0,x:0,y:0,scaleX:1,scaleY:1,rotation:0,tint:16777215,alpha:1};let OU=IU;const DU={vertex:{attributeName:"aVertex",format:"float32x2",code:"\n            const texture = p.texture;\n            const sx = p.scaleX;\n            const sy = p.scaleY;\n            const ax = p.anchorX;\n            const ay = p.anchorY;\n            const trim = texture.trim;\n            const orig = texture.orig;\n\n            if (trim)\n            {\n                w1 = trim.x - (ax * orig.width);\n                w0 = w1 + trim.width;\n\n                h1 = trim.y - (ay * orig.height);\n                h0 = h1 + trim.height;\n            }\n            else\n            {\n                w1 = -ax * (orig.width);\n                w0 = w1 + orig.width;\n\n                h1 = -ay * (orig.height);\n                h0 = h1 + orig.height;\n            }\n\n            f32v[offset] = w1 * sx;\n            f32v[offset + 1] = h1 * sy;\n\n            f32v[offset + stride] = w0 * sx;\n            f32v[offset + stride + 1] = h1 * sy;\n\n            f32v[offset + (stride * 2)] = w0 * sx;\n            f32v[offset + (stride * 2) + 1] = h0 * sy;\n\n            f32v[offset + (stride * 3)] = w1 * sx;\n            f32v[offset + (stride * 3) + 1] = h0 * sy;\n        ",dynamic:!1},position:{attributeName:"aPosition",format:"float32x2",code:"\n            var x = p.x;\n            var y = p.y;\n\n            f32v[offset] = x;\n            f32v[offset + 1] = y;\n\n            f32v[offset + stride] = x;\n            f32v[offset + stride + 1] = y;\n\n            f32v[offset + (stride * 2)] = x;\n            f32v[offset + (stride * 2) + 1] = y;\n\n            f32v[offset + (stride * 3)] = x;\n            f32v[offset + (stride * 3) + 1] = y;\n        ",dynamic:!0},rotation:{attributeName:"aRotation",format:"float32",code:"\n            var rotation = p.rotation;\n\n            f32v[offset] = rotation;\n            f32v[offset + stride] = rotation;\n            f32v[offset + (stride * 2)] = rotation;\n            f32v[offset + (stride * 3)] = rotation;\n        ",dynamic:!1},uvs:{attributeName:"aUV",format:"float32x2",code:"\n            var uvs = p.texture.uvs;\n\n            f32v[offset] = uvs.x0;\n            f32v[offset + 1] = uvs.y0;\n\n            f32v[offset + stride] = uvs.x1;\n            f32v[offset + stride + 1] = uvs.y1;\n\n            f32v[offset + (stride * 2)] = uvs.x2;\n            f32v[offset + (stride * 2) + 1] = uvs.y2;\n\n            f32v[offset + (stride * 3)] = uvs.x3;\n            f32v[offset + (stride * 3) + 1] = uvs.y3;\n        ",dynamic:!1},color:{attributeName:"aColor",format:"unorm8x4",code:"\n            const c = p.color;\n\n            u32v[offset] = c;\n            u32v[offset + stride] = c;\n            u32v[offset + (stride * 2)] = c;\n            u32v[offset + (stride * 3)] = c;\n        ",dynamic:!1}},BU=new cx(0,0,0,0),FU=class t extends Bb{constructor(e={}){e={...t.defaultOptions,...e,dynamicProperties:{...t.defaultOptions.dynamicProperties,...null==e?void 0:e.dynamicProperties}};const{dynamicProperties:n,shader:i,roundPixels:r,texture:s,particles:a,...o}=e;super({label:"ParticleContainer",...o}),this.renderPipeId="particle",this.batched=!1,this._childrenDirty=!1,this.texture=s||null,this.shader=i,this._properties={};for(const t in DU){const e=DU[t],i=n[t];this._properties[t]={...e,dynamic:i}}this.allowChildren=!0,this.roundPixels=r??!1,this.particleChildren=a??[]}addParticle(...t){for(let e=0;e<t.length;e++)this.particleChildren.push(t[e]);return this.onViewUpdate(),t[0]}removeParticle(...t){let e=!1;for(let n=0;n<t.length;n++){const i=this.particleChildren.indexOf(t[n]);i>-1&&(this.particleChildren.splice(i,1),e=!0)}return e&&this.onViewUpdate(),t[0]}update(){this._childrenDirty=!0}onViewUpdate(){this._childrenDirty=!0,super.onViewUpdate()}get bounds(){return BU}updateBounds(){}destroy(t=!1){var e,n;super.destroy(t);if("boolean"==typeof t?t:null==t?void 0:t.texture){const n="boolean"==typeof t?t:null==t?void 0:t.textureSource,i=this.texture??(null==(e=this.particleChildren[0])?void 0:e.texture);i&&i.destroy(n)}this.texture=null,null==(n=this.shader)||n.destroy()}removeParticles(t,e){t??(t=0),e??(e=this.particleChildren.length);const n=this.particleChildren.splice(t,e-t);return this.onViewUpdate(),n}removeParticleAt(t){const e=this.particleChildren.splice(t,1);return this.onViewUpdate(),e[0]}addParticleAt(t,e){return this.particleChildren.splice(e,0,t),this.onViewUpdate(),t}addChild(...t){throw new Error("ParticleContainer.addChild() is not available. Please use ParticleContainer.addParticle()")}removeChild(...t){throw new Error("ParticleContainer.removeChild() is not available. Please use ParticleContainer.removeParticle()")}removeChildren(t,e){throw new Error("ParticleContainer.removeChildren() is not available. Please use ParticleContainer.removeParticles()")}removeChildAt(t){throw new Error("ParticleContainer.removeChildAt() is not available. Please use ParticleContainer.removeParticleAt()")}getChildAt(t){throw new Error("ParticleContainer.getChildAt() is not available. Please use ParticleContainer.getParticleAt()")}setChildIndex(t,e){throw new Error("ParticleContainer.setChildIndex() is not available. Please use ParticleContainer.setParticleIndex()")}getChildIndex(t){throw new Error("ParticleContainer.getChildIndex() is not available. Please use ParticleContainer.getParticleIndex()")}addChildAt(t,e){throw new Error("ParticleContainer.addChildAt() is not available. Please use ParticleContainer.addParticleAt()")}swapChildren(t,e){throw new Error("ParticleContainer.swapChildren() is not available. Please use ParticleContainer.swapParticles()")}reparentChild(...t){throw new Error("ParticleContainer.reparentChild() is not available with the particle container")}reparentChildAt(t,e){throw new Error("ParticleContainer.reparentChildAt() is not available with the particle container")}};FU.defaultOptions={dynamicProperties:{vertex:!1,position:!0,rotation:!1,uvs:!1,color:!1},roundPixels:!1};let LU=FU;const UU=class t extends ZL{constructor(e={}){super({width:(e={...t.defaultOptions,...e}).width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(t){var e,n;this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this._anchorX=null==(e=t.anchor)?void 0:e.x,this._anchorY=null==(n=t.anchor)?void 0:n.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:e,height:n,_leftWidth:i,_rightWidth:r,_topHeight:s,_bottomHeight:a,_anchorX:o,_anchorY:l}=this,h=i+r,c=e>h?1:e/h,u=s+a,d=n>u?1:n/u,p=Math.min(c,d),f=o*e,m=l*n;t[0]=t[8]=t[16]=t[24]=-f,t[2]=t[10]=t[18]=t[26]=i*p-f,t[4]=t[12]=t[20]=t[28]=e-r*p-f,t[6]=t[14]=t[22]=t[30]=e-f,t[1]=t[3]=t[5]=t[7]=-m,t[9]=t[11]=t[13]=t[15]=s*p-m,t[17]=t[19]=t[21]=t[23]=n-a*p-m,t[25]=t[27]=t[29]=t[31]=n-m,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const e=1/this._originalWidth,n=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=n*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-n*this._bottomHeight,this.getBuffer("aUV").update()}};UU.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let kU=UU;const NU=class t extends Bb{constructor(e){var n,i,r,s;e instanceof ox&&(e={texture:e});const{width:a,height:o,anchor:l,leftWidth:h,rightWidth:c,topHeight:u,bottomHeight:d,texture:p,roundPixels:f,...m}=e;super({label:"NineSliceSprite",...m}),this.renderPipeId="nineSliceSprite",this.batched=!0,this._leftWidth=h??(null==(n=null==p?void 0:p.defaultBorders)?void 0:n.left)??kU.defaultOptions.leftWidth,this._topHeight=u??(null==(i=null==p?void 0:p.defaultBorders)?void 0:i.top)??kU.defaultOptions.topHeight,this._rightWidth=c??(null==(r=null==p?void 0:p.defaultBorders)?void 0:r.right)??kU.defaultOptions.rightWidth,this._bottomHeight=d??(null==(s=null==p?void 0:p.defaultBorders)?void 0:s.bottom)??kU.defaultOptions.bottomHeight,this._width=a??p.width??kU.defaultOptions.width,this._height=o??p.height??kU.defaultOptions.height,this.allowChildren=!1,this.texture=p??t.defaultOptions.texture,this.roundPixels=f??!1,this._anchor=new by({_onUpdate:()=>{this.onViewUpdate()}}),l?this.anchor=l:this.texture.defaultAnchor&&(this.anchor=this.texture.defaultAnchor)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return this._width}set width(t){this._width=t,this.onViewUpdate()}get height(){return this._height}set height(t){this._height=t,this.onViewUpdate()}setSize(t,e){"object"==typeof t&&(e=t.height??t.width,t=t.width),this._width=t,this._height=e??t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this.onViewUpdate()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this.onViewUpdate()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this.onViewUpdate()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this.onViewUpdate()}get texture(){return this._texture}set texture(t){t||(t=ox.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get originalWidth(){return this._texture.width}get originalHeight(){return this._texture.height}destroy(t){super.destroy(t);if("boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._texture.destroy(e)}this._texture=null}updateBounds(){const t=this._bounds,e=this._anchor,n=this._width,i=this._height;t.minX=-e._x*n,t.maxX=t.minX+n,t.minY=-e._y*i,t.maxY=t.minY+i}};NU.defaultOptions={texture:ox.EMPTY};let zU=NU;class GU extends mU{constructor(){super(),this.geometry=new kU}destroy(){this.geometry.destroy()}}class HU{constructor(t){this._renderer=t}addRenderable(t,e){const n=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,n),this._renderer.renderPipes.batch.addToBatch(n,e)}updateRenderable(t){const e=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}_updateBatchableSprite(t,e){e.geometry.update(t),e.setTexture(t._texture)}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=t._gpuData[this._renderer.uid]=new GU,n=e;return n.renderable=t,n.transform=t.groupTransform,n.texture=t._texture,n.roundPixels=this._renderer._roundPixels|t._roundPixels,t.didViewUpdate||this._updateBatchableSprite(t,n),e}destroy(){this._renderer=null}}HU.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"nineSliceSprite"};const VU={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            }\n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},XU={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n\n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n\n        "}};let WU,jU;class YU extends ES{constructor(){WU??(WU=TM({name:"tiling-sprite-shader",bits:[cD,VU,FM]})),jU??(jU=MM({name:"tiling-sprite-shader",bits:[dD,XU,LM]}));const t=new TS({uMapCoord:{value:new Ry,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new Ry,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:jU,gpuProgram:WU,resources:{localUniforms:new TS({uTransformMatrix:{value:new Ry,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:t,uTexture:ox.EMPTY.source,uSampler:ox.EMPTY.source.style}})}updateUniforms(t,e,n,i,r,s){const a=this.resources.tilingUniforms,o=s.width,l=s.height,h=s.textureMatrix,c=a.uniforms.uTextureTransform;c.set(n.a*o/t,n.b*o/e,n.c*l/t,n.d*l/e,n.tx/t,n.ty/e),c.invert(),a.uniforms.uMapCoord=h.mapCoord,a.uniforms.uClampFrame=h.uClampFrame,a.uniforms.uClampOffset=h.uClampOffset,a.uniforms.uTextureTransform=c,a.uniforms.uSizeAnchor[0]=t,a.uniforms.uSizeAnchor[1]=e,a.uniforms.uSizeAnchor[2]=i,a.uniforms.uSizeAnchor[3]=r,s&&(this.resources.uTexture=s.source,this.resources.uSampler=s.source.style)}}class qU extends EO{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}function KU(t,e){const n=t.anchor.x,i=t.anchor.y;e[0]=-n*t.width,e[1]=-i*t.height,e[2]=(1-n)*t.width,e[3]=-i*t.height,e[4]=(1-n)*t.width,e[5]=(1-i)*t.height,e[6]=-n*t.width,e[7]=(1-i)*t.height}function JU(t,e,n,i){let r=0;const s=t.length/(e||2),a=i.a,o=i.b,l=i.c,h=i.d,c=i.tx,u=i.ty;for(n*=e;r<s;){const i=t[n],s=t[n+1];t[n]=a*i+l*s+c,t[n+1]=o*i+h*s+u,n+=e,r++}}function ZU(t,e){const n=t.texture,i=n.frame.width,r=n.frame.height;let s=0,a=0;t.applyAnchorToTexture&&(s=t.anchor.x,a=t.anchor.y),e[0]=e[6]=-s,e[2]=e[4]=1-s,e[1]=e[3]=-a,e[5]=e[7]=1-a;const o=Ry.shared;o.copyFrom(t._tileTransform.matrix),o.tx/=t.width,o.ty/=t.height,o.invert(),o.scale(t.width/i,t.height/r),JU(e,2,0,o)}const QU=new qU;class $U{constructor(){this.canBatch=!0,this.geometry=new EO({indices:QU.indices.slice(),positions:QU.positions.slice(),uvs:QU.uvs.slice()})}destroy(){var t;this.geometry.destroy(),null==(t=this.shader)||t.destroy()}}class tk{constructor(t){this._state=RS.default2d,this._renderer=t}validateRenderable(t){const e=this._getTilingSpriteData(t),n=e.canBatch;this._updateCanBatch(t);const i=e.canBatch;if(i&&i===n){const{batchableMesh:n}=e;return!n._batcher.checkAndUpdateTexture(n,t.texture)}return n!==i}addRenderable(t,e){const n=this._renderer.renderPipes.batch;this._updateCanBatch(t);const i=this._getTilingSpriteData(t),{geometry:r,canBatch:s}=i;if(s){i.batchableMesh||(i.batchableMesh=new mU);const s=i.batchableMesh;t.didViewUpdate&&(this._updateBatchableMesh(t),s.geometry=r,s.renderable=t,s.transform=t.groupTransform,s.setTexture(t._texture)),s.roundPixels=this._renderer._roundPixels|t._roundPixels,n.addToBatch(s,e)}else n.break(e),i.shader||(i.shader=new YU),this.updateRenderable(t),e.add(t)}execute(t){const{shader:e}=this._getTilingSpriteData(t);e.groups[0]=this._renderer.globalUniforms.bindGroup;const n=e.resources.localUniforms.uniforms;n.uTransformMatrix=t.groupTransform,n.uRound=this._renderer._roundPixels|t._roundPixels,AF(t.groupColorAlpha,n.uColor,0),this._state.blendMode=DT(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:QU,shader:e,state:this._state})}updateRenderable(t){const e=this._getTilingSpriteData(t),{canBatch:n}=e;if(n){const{batchableMesh:n}=e;t.didViewUpdate&&this._updateBatchableMesh(t),n._batcher.updateElement(n)}else if(t.didViewUpdate){const{shader:n}=e;n.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}}_getTilingSpriteData(t){return t._gpuData[this._renderer.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){const e=new $U;return e.renderable=t,t._gpuData[this._renderer.uid]=e,e}_updateBatchableMesh(t){const e=this._getTilingSpriteData(t),{geometry:n}=e,i=t.texture.source.style;"repeat"!==i.addressMode&&(i.addressMode="repeat",i.update()),ZU(t,n.uvs),KU(t,n.positions)}destroy(){this._renderer=null}_updateCanBatch(t){const e=this._getTilingSpriteData(t),n=t.texture;let i=!0;return this._renderer.type===AS.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=n.textureMatrix.isSimple&&(i||n.source.isPowerOfTwo),e.canBatch}}tk.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"tilingSprite"};const ek={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:"\n            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));\n        "}},nk={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:"\n            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));\n        "}},ik={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {\n\n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n\n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));\n                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);\n                var coverage: f32 = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n\n            }\n        "}},rk={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {\n\n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n\n                // SDF\n                median = min(median, msdfColor.a);\n\n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));\n                float gamma = mix(1.0, 1.0 / 2.2, luma);\n                float coverage = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n            }\n        "}};let sk,ak;class ok extends ES{constructor(t){const e=new TS({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new Ry,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});sk??(sk=TM({name:"sdf-shader",bits:[AM,IM(t),ek,ik,FM]})),ak??(ak=MM({name:"sdf-shader",bits:[EM,BM(t),nk,rk,LM]})),super({glProgram:ak,gpuProgram:sk,resources:{localUniforms:e,batchSamplers:kM(t)}})}}class lk extends MO{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class hk{constructor(t){this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(t){const e=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,e)),this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){const n=this._getGpuBitmapText(t);ck(t,n),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,n)),this._renderer.renderPipes.graphics.addRenderable(n,e),n.context.customShader&&this._updateDistanceField(t)}updateRenderable(t){const e=this._getGpuBitmapText(t);ck(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){const{context:n}=e,i=_E.getFont(t.text,t._style);n.clear(),"none"!==i.distanceField.type&&(n.customShader||(n.customShader=new ok(this._renderer.limits.maxBatchableTextures)));const r=oT.graphemeSegmenter(t.text),s=t._style;let a=i.baseLineOffset;const o=yE(r,s,i,!0),l=s.padding,h=o.scale;let c=o.width,u=o.height+o.offsetY;s._stroke&&(c+=s._stroke.width/h,u+=s._stroke.width/h),n.translate(-t._anchor._x*c-l,-t._anchor._y*u-l).scale(h,h);const d=i.applyFillAsTint?s._fill.color:16777215;for(let p=0;p<o.lines.length;p++){const t=o.lines[p];for(let e=0;e<t.charPositions.length;e++){const r=t.chars[e],s=i.chars[r];(null==s?void 0:s.texture)&&n.texture(s.texture,d||"black",Math.round(t.charPositions[e]+s.xOffset),Math.round(a+s.yOffset))}a+=i.lineHeight}}_getGpuBitmapText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new lk;return t._gpuData[this._renderer.uid]=e,this._updateContext(t,e),e}_updateDistanceField(t){const e=this._getGpuBitmapText(t).context,n=t._style.fontFamily,i=i_.get(`${n}-bitmap`),{a:r,b:s,c:a,d:o}=t.groupTransform,l=Math.sqrt(r*r+s*s),h=Math.sqrt(a*a+o*o),c=(Math.abs(l)+Math.abs(h))/2,u=i.baseRenderedFontSize/t._style.fontSize,d=c*i.distanceField.range*(1/u);e.customShader.resources.localUniforms.uniforms.uDistance=d}destroy(){this._renderer=null}}function ck(t,e){e.groupTransform=t.groupTransform,e.groupColorAlpha=t.groupColorAlpha,e.groupColor=t.groupColor,e.groupBlendMode=t.groupBlendMode,e.globalDisplayStatus=t.globalDisplayStatus,e.groupTransform=t.groupTransform,e.localDisplayStatus=t.localDisplayStatus,e.groupAlpha=t.groupAlpha,e._roundPixels=t._roundPixels}function uk(t){const{text:e,style:n,chars:i}=t,r=n,s=_E.getFont(e,r),a=yE(oT.graphemeSegmenter(e),r,s,!0),o=a.scale,l=[],h=[],c=[];let u=0;for(const d of a.lines){if(0===d.chars.length)continue;const t=new Db({label:"line"});t.y=u,c.push(t);let e=new Db({label:"word"}),n=0;for(let a=0;a<d.chars.length;a++){const c=d.chars[a];if(!c)continue;if(!s.chars[c])continue;const u=" "===c,p=a===d.chars.length-1;let f;i.length>0?(f=i.shift(),f.text=c,f.style=r,f.label=`char-${c}`,f.x=d.charPositions[a]*o-d.charPositions[n]*o):f=new XO({text:c,style:r,label:`char-${c}`,x:d.charPositions[a]*o-d.charPositions[n]*o}),u||(l.push(f),e.addChild(f)),(u||p)&&e.children.length>0&&(e.x=d.charPositions[n]*o,h.push(e),t.addChild(e),e=new Db({label:"word"}),n=a+1)}u+=s.lineHeight*o}return{chars:l,lines:c,words:h}}hk.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"bitmapText"};class dk extends tF{constructor(t){super(),this.generatingTexture=!1,this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){this._renderer.htmlText.returnTexturePromise(this.texturePromise),this.texturePromise=null,this._renderer=null}}function pk(t,e){const{texture:n,bounds:i}=t,r=e._style._getFinalPadding();lx(i,e._anchor,n);const s=e._anchor._x*r*2,a=e._anchor._y*r*2;i.minX-=r-s,i.minY-=r-a,i.maxX-=r-s,i.maxY-=r-a}class fk{constructor(t){this._renderer=t}validateRenderable(t){return t._didTextUpdate}addRenderable(t,e){const n=this._getGpuText(t);t._didTextUpdate&&(this._updateGpuText(t).catch(t=>{}),t._didTextUpdate=!1,pk(n,t)),this._renderer.renderPipes.batch.addToBatch(n,e)}updateRenderable(t){const e=this._getGpuText(t);e._batcher.updateElement(e)}async _updateGpuText(t){t._didTextUpdate=!1;const e=this._getGpuText(t);if(e.generatingTexture)return;e.texturePromise&&(this._renderer.htmlText.returnTexturePromise(e.texturePromise),e.texturePromise=null),e.generatingTexture=!0,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const n=this._renderer.htmlText.getTexturePromise(t);e.texturePromise=n,e.texture=await n;const i=t.renderGroup||t.parentRenderGroup;i&&(i.structureDidChange=!0),e.generatingTexture=!1,pk(e,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new dk(this._renderer);return e.renderable=t,e.transform=t.groupTransform,e.texture=ox.EMPTY,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}function mk(){const{userAgent:t}=Wb.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}fk.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"htmlText"};const gk=new cx;function vk(t,e,n,i){const r=gk;r.minX=0,r.minY=0,r.maxX=t.width/i|0,r.maxY=t.height/i|0;const s=Ab.getOptimalTexture(r.width,r.height,i,!1);return s.source.uploadMethodId="image",s.source.resource=t,s.source.alphaMode="premultiply-alpha-on-upload",s.frame.width=e/i,s.frame.height=n/i,s.source.emit("update",s.source),s.updateUvs(),s}function yk(t,e){const n=e.fontFamily,i=[],r={},s=t.match(/font-family:([^;"\s]+)/g);function a(t){r[t]||(i.push(t),r[t]=!0)}if(Array.isArray(n))for(let o=0;o<n.length;o++)a(n[o]);else a(n);s&&s.forEach(t=>{a(t.split(":")[1].trim())});for(const o in e.tagStyles){a(e.tagStyles[o].fontFamily)}return i}async function xk(t){const e=await Wb.get().fetch(t),n=await e.blob(),i=new FileReader;return await new Promise((t,e)=>{i.onloadend=()=>t(i.result),i.onerror=e,i.readAsDataURL(n)})}async function bk(t,e){const n=await xk(e);return`@font-face {\n        font-family: "${t.fontFamily}";\n        src: url('${n}');\n        font-weight: ${t.fontWeight};\n        font-style: ${t.fontStyle};\n    }`}const _k=new Map;async function Sk(t,e,n){const i=t.filter(t=>i_.has(`${t}-and-url`)).map((t,i)=>{if(!_k.has(t)){const{url:r}=i_.get(`${t}-and-url`);0===i?_k.set(t,bk({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:t},r)):_k.set(t,bk({fontWeight:n.fontWeight,fontStyle:n.fontStyle,fontFamily:t},r))}return _k.get(t)});return(await Promise.all(i)).join("\n")}function wk(t,e,n,i,r){const{domElement:s,styleElement:a,svgRoot:o}=r;s.innerHTML=`<style>${e.cssStyle}</style><div style='padding:0;'>${t}</div>`,s.setAttribute("style",`transform: scale(${n});transform-origin: top left; display: inline-block`),a.textContent=i;const{width:l,height:h}=r.image;return o.setAttribute("width",l.toString()),o.setAttribute("height",h.toString()),(new XMLSerializer).serializeToString(o)}function Tk(t,e){const n=pE.getOptimalCanvasAndContext(t.width,t.height,e),{context:i}=n;return i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),n}function Mk(t,e,n){return new Promise(async i=>{n&&await new Promise(t=>setTimeout(t,100)),t.onload=()=>{i()},t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,t.crossOrigin="anonymous"})}class Ak{constructor(t){this._renderer=t,this._createCanvas=t.type===AS.WEBGPU}getTexture(t){return this.getTexturePromise(t)}getTexturePromise(t){return this._buildTexturePromise(t)}async _buildTexturePromise(t){const{text:e,style:n,resolution:i,textureStyle:r}=t,s=jx.get($O),a=yk(e,n),o=await Sk(a,n,JO.defaultTextStyle),l=eD(e,n,o,s),h=Math.ceil(Math.ceil(Math.max(1,l.width)+2*n.padding)*i),c=Math.ceil(Math.ceil(Math.max(1,l.height)+2*n.padding)*i),u=s.image;u.width=2+(0|h),u.height=2+(0|c);const d=wk(e,n,i,o,s);await Mk(u,d,mk()&&a.length>0);const p=u;let f;this._createCanvas&&(f=Tk(u,i));const m=vk(f?f.canvas:p,u.width-2,u.height-2,i);return r&&(m.source.style=r),this._createCanvas&&(this._renderer.texture.initSource(m.source),pE.returnCanvasAndContext(f)),jx.return(s),m}returnTexturePromise(t){t.then(t=>{this._cleanUp(t)}).catch(()=>{Vx()})}_cleanUp(t){Ab.returnTexture(t,!0),t.source.resource=null,t.source.uploadMethodId="unknown"}destroy(){this._renderer=null}}Ak.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"htmlText"};class Ek extends Db{constructor(t){const{text:e,style:n,autoSplit:i,lineAnchor:r,wordAnchor:s,charAnchor:a,...o}=t;super(o),this._dirty=!1,this._canReuseChars=!1,this.chars=[],this.words=[],this.lines=[],this._originalText=e,this._autoSplit=i,this._lineAnchor=r,this._wordAnchor=s,this._charAnchor=a,this.style=n}split(){const t=this.splitFn();this.chars=t.chars,this.words=t.words,this.lines=t.lines,this.addChild(...this.lines),this.charAnchor=this._charAnchor,this.wordAnchor=this._wordAnchor,this.lineAnchor=this._lineAnchor,this._dirty=!1,this._canReuseChars=!0}get text(){return this._originalText}set text(t){this._originalText=t,this.lines.forEach(t=>t.destroy({children:!0})),this.lines.length=0,this.words.length=0,this.chars.length=0,this._canReuseChars=!1,this.onTextUpdate()}_setOrigin(t,e,n){let i;i="number"==typeof t?{x:t,y:t}:{x:t.x,y:t.y},e.forEach(t=>{const e=t.getLocalBounds(),n=e.minX+e.width*i.x,r=e.minY+e.height*i.y;t.origin.set(n,r)}),this[n]=t}get lineAnchor(){return this._lineAnchor}set lineAnchor(t){this._setOrigin(t,this.lines,"_lineAnchor")}get wordAnchor(){return this._wordAnchor}set wordAnchor(t){this._setOrigin(t,this.words,"_wordAnchor")}get charAnchor(){return this._charAnchor}set charAnchor(t){this._setOrigin(t,this.chars,"_charAnchor")}get style(){return this._style}set style(t){t||(t={}),this._style=new uE(t),this.words.forEach(t=>t.destroy()),this.words.length=0,this.lines.forEach(t=>t.destroy()),this.lines.length=0,this._canReuseChars=!0,this.onTextUpdate()}onTextUpdate(){this._dirty=!0,this._autoSplit&&this.split()}destroy(t){super.destroy(t),this.chars=[],this.words=[],this.lines=[],("boolean"==typeof t?t:null==t?void 0:t.style)&&this._style.destroy(t),this._style=null,this._originalText=""}}const Ck=class t extends Ek{constructor(e){super({...t.defaultOptions,...e})}static from(e,n){const i={...t.defaultOptions,...n,text:e.text,style:new uE(e.style)};return new t({...i})}splitFn(){return uk({text:this._originalText,style:this._style,chars:this._canReuseChars?this.chars:[]})}};Ck.defaultOptions={autoSplit:!0,lineAnchor:0,wordAnchor:0,charAnchor:0};let Pk=Ck;function Rk(t){return"\r"===t||"\n"===t||"\r\n"===t}function Ik(t){var e,n;const{text:i,style:r,chars:s}=t,a=r,o=oT.measureText(i,a),l=function(t,e,n){const i=[];let r=e.lines[0],s="",a=[],o=0;return n.wordWrap=!1,t.forEach(t=>{const l=/^\s*$/.test(t),h=Rk(t),c=0===s.length&&l;if(l&&!h&&c)return;h||(s+=t);const u=oT.measureText(t,n);a.push({char:t,metric:u}),s.length>=r.length&&(i.push({line:s,chars:a,width:a.reduce((t,e)=>t+e.metric.width,0)}),a=[],s="",o++,r=e.lines[o])}),i}(oT.graphemeSegmenter(i),o,a.clone()),h=a.align,c=o.lineWidths.reduce((t,e)=>Math.max(t,e),0),u=[],d=[],p=[];let f=0;const m=(null==(e=a.stroke)?void 0:e.width)||0,g=(null==(n=a.dropShadow)?void 0:n.distance)||0;return l.forEach((t,e)=>{const n=new Db({label:`line-${e}`});n.y=f,d.push(n);const i=o.lineWidths[e];let r=function(t,e,n){switch(t){case"center":return(n-e)/2;case"right":return n-e;default:return 0}}(h,i,c),l=new Db({label:"word"});l.x=r,t.chars.forEach((t,e)=>{if(0!==t.metric.width)if(Rk(t.char))r+=t.metric.width-m;else if(" "===t.char)l.children.length>0&&(p.push(l),n.addChild(l)),r+=t.metric.width+a.letterSpacing-m,l=new Db({label:"word"}),l.x=r;else{let n;s.length>0?(n=s.shift(),n.text=t.char,n.style=a,n.setFromMatrix(Ry.IDENTITY),n.x=r-l.x-g*e):n=new HO({text:t.char,style:a,x:r-l.x-g*e}),u.push(n),l.addChild(n),r+=t.metric.width+a.letterSpacing-m}}),l.children.length>0&&(p.push(l),n.addChild(l)),f+=o.lineHeight}),{chars:u,lines:d,words:p}}const Ok=class t extends Ek{constructor(e){super({...t.defaultOptions,...e})}static from(e,n){const i={...t.defaultOptions,...n,text:e.text,style:new uE(e.style)};return new t({...i})}splitFn(){return Ik({text:this._originalText,style:this._style,chars:this._canReuseChars?this.chars:[]})}};Ok.defaultOptions={autoSplit:!0,lineAnchor:0,wordAnchor:0,charAnchor:0};let Dk=Ok;class Bk extends tF{constructor(t){super(),this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){this._renderer.canvasText.returnTexture(this.texture),this._renderer=null}}class Fk{constructor(t){this._renderer=t}validateRenderable(t){return t._didTextUpdate}addRenderable(t,e){const n=this._getGpuText(t);t._didTextUpdate&&(this._updateGpuText(t),t._didTextUpdate=!1),this._renderer.renderPipes.batch.addToBatch(n,e)}updateRenderable(t){const e=this._getGpuText(t);e._batcher.updateElement(e)}_updateGpuText(t){const e=this._getGpuText(t);e.texture&&this._renderer.canvasText.returnTexture(e.texture),t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,e.texture=e.texture=this._renderer.canvasText.getTexture(t),pk(e,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new Bk(this._renderer);return e.renderable=t,e.transform=t.groupTransform,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}Fk.extension={type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"text"};class Lk{constructor(t){this._renderer=t}getTexture(t,e,n,i){"string"==typeof t&&(qy(0,"CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:n,resolution:e}),t.style instanceof uE||(t.style=new uE(t.style)),t.textureStyle instanceof ex||(t.textureStyle=new ex(t.textureStyle)),"string"!=typeof t.text&&(t.text=t.text.toString());const{text:r,style:s,textureStyle:a}=t,o=t.resolution??this._renderer.resolution,{frame:l,canvasAndContext:h}=GO.getCanvasAndContext({text:r,style:s,resolution:o}),c=vk(h.canvas,l.width,l.height,o);if(a&&(c.source.style=a),s.trim&&(l.pad(s.padding),c.frame.copyFrom(l),c.updateUvs()),s.filters){const t=this._applyFilters(c,s.filters);return this.returnTexture(c),GO.returnCanvasAndContext(h),t}return this._renderer.texture.initSource(c._source),GO.returnCanvasAndContext(h),c}returnTexture(t){const e=t.source;e.resource=null,e.uploadMethodId="unknown",e.alphaMode="no-premultiply-alpha",Ab.returnTexture(t,!0)}renderTextToCanvas(){qy(0,"CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}_applyFilters(t,e){const n=this._renderer.renderTarget.renderTarget,i=this._renderer.filter.generateFilteredTexture({texture:t,filters:e});return this._renderer.renderTarget.bind(n,!1),i}destroy(){this._renderer=null}}Lk.extension={type:[fy.WebGLSystem,fy.WebGPUSystem,fy.CanvasSystem],name:"canvasText"};const Uk=["#000080","#228B22","#8B0000","#4169E1","#008080","#800000","#9400D3","#FF8C00","#556B2F","#8B008B"];let kk=0;vy.add(yy,xy);const Nk=Object.freeze(Object.defineProperty({__proto__:null,AbstractBitmapFont:nT,AbstractRenderer:Xw,AbstractSplitText:Ek,AbstractText:DO,AccessibilitySystem:V_,AlphaFilter:jI,AlphaMask:zb,AlphaMaskPipe:vD,AnimatedSprite:PO,Application:$w,ApplicationInitHook:Jw,Assets:wC,AssetsClass:SC,BLEND_TO_NPM:IT,BUFFER_TYPE:bD,BackgroundLoader:PE,BackgroundSystem:mF,Batch:zT,BatchGeometry:eM,BatchTextureArray:NT,BatchableGraphics:YM,BatchableHTMLText:dk,BatchableMesh:mU,BatchableSprite:tF,BatchableText:Bk,Batcher:YT,BatcherPipe:hD,BigPool:jx,BindGroup:MS,BindGroupSystem:QF,BitmapFont:SE,BitmapFontManager:_E,BitmapText:XO,BitmapTextGraphics:lk,BitmapTextPipe:hk,BlendModeFilter:LS,BlendModePipe:vF,BlurFilter:nO,BlurFilterPass:eO,Bounds:cx,BrowserAdapter:Vb,Buffer:KT,BufferImageSource:rx,BufferResource:hB,BufferUsage:qT,CLEAR:kw,Cache:i_,CanvasPool:pE,CanvasPoolClass:dE,CanvasSource:jb,CanvasTextGenerator:GO,CanvasTextMetrics:oT,CanvasTextPipe:Fk,CanvasTextSystem:Lk,Circle:_T,Color:zx,ColorBlend:zS,ColorBurnBlend:GS,ColorDodgeBlend:HS,ColorMask:Gb,ColorMaskPipe:yD,ColorMatrixFilter:class extends OS{constructor(t={}){const e=new TS({uColorMatrix:{value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],type:"f32",size:20},uAlpha:{value:1,type:"f32"}});super({...t,gpuProgram:xS.from({vertex:{source:rO,entryPoint:"mainVertex"},fragment:{source:rO,entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:HI,fragment:iO,name:"color-matrix-filter"}),resources:{colorMatrixUniforms:e}}),this.alpha=1}_loadMatrix(t,e=!1){let n=t;e&&(this._multiply(n,this.matrix,t),n=this._colorMatrix(n)),this.resources.colorMatrixUniforms.uniforms.uColorMatrix=n,this.resources.colorMatrixUniforms.update()}_multiply(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}tint(t,e){const[n,i,r]=zx.shared.setValue(t).toArray(),s=[n,0,0,0,0,0,i,0,0,0,0,0,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}greyscale(t,e){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}grayscale(t,e){this.greyscale(t,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const n=Math.cos(t),i=Math.sin(t),r=1/3,s=(0,Math.sqrt)(r),a=[n+(1-n)*r,r*(1-n)-s*i,r*(1-n)+s*i,0,0,r*(1-n)+s*i,n+r*(1-n),r*(1-n)-s*i,0,0,r*(1-n)-s*i,r*(1-n)+s*i,n+r*(1-n),0,0,0,0,0,1,0];this._loadMatrix(a,e)}contrast(t,e){const n=(t||0)+1,i=-.5*(n-1),r=[n,0,0,0,i,0,n,0,0,i,0,0,n,0,i,0,0,0,1,0];this._loadMatrix(r,e)}saturate(t=0,e){const n=2*t/3+1,i=-.5*(n-1),r=[n,i,i,0,0,i,n,i,0,0,i,i,n,0,0,0,0,0,1,0];this._loadMatrix(r,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,n,i,r){t||(t=.2),e||(e=.15),n||(n=16770432),i||(i=3375104);const s=zx.shared,[a,o,l]=s.setValue(n).toArray(),[h,c,u]=s.setValue(i).toArray(),d=[.3,.59,.11,0,0,a,o,l,t,0,h,c,u,e,0,a-h,o-c,l-u,0,0];this._loadMatrix(d,r)}night(t,e){t||(t=.1);const n=[-2*t,-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}predator(t,e){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.resources.colorMatrixUniforms.uniforms.uColorMatrix}set matrix(t){this.resources.colorMatrixUniforms.uniforms.uColorMatrix=t}get alpha(){return this.resources.colorMatrixUniforms.uniforms.uAlpha}set alpha(t){this.resources.colorMatrixUniforms.uniforms.uAlpha=t}},CompressedSource:AC,Container:Db,Culler:MP,CullerPlugin:AP,CustomRenderPipe:$B,D3D10_RESOURCE_DIMENSION:WC,D3DFMT:qC,DATA_URI:/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i,DDS:ZC,DEG_TO_RAD:Ey,DEPRECATED_SCALE_MODES:VL,DEPRECATED_WRAP_MODES:GL,DOMAdapter:Wb,DOMContainer:class extends Bb{constructor(t={}){const{element:e,anchor:n,...i}=t;super({label:"DOMContainer",...i}),this.renderPipeId="dom",this.batched=!1,this._anchor=new Cy(0,0),n&&(this.anchor=n),this.element=t.element||document.createElement("div")}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}set element(t){this._element!==t&&(this._element=t,this.onViewUpdate())}get element(){return this._element}updateBounds(){const t=this._bounds,e=this._element;if(!e)return t.minX=0,t.minY=0,t.maxX=0,void(t.maxY=0);const{offsetWidth:n,offsetHeight:i}=e;t.minX=0,t.maxX=n,t.minY=0,t.maxY=i}destroy(t=!1){var e,n;super.destroy(t),null==(n=null==(e=this._element)?void 0:e.parentNode)||n.removeChild(this._element),this._element=null,this._anchor=null}},DOMPipe:EP,DRAW_MODES:zL,DXGI_FORMAT:XC,DXGI_TO_TEXTURE_FORMAT:JC,DarkenBlend:VS,DefaultBatcher:HM,DefaultShader:NM,DifferenceBlend:XS,DisplacementFilter:class extends OS{constructor(...t){let e=t[0];e instanceof Fb&&(t[1]&&qy(0,"DisplacementFilter now uses options object instead of params. {sprite, scale}"),e={sprite:e,scale:t[1]});const{sprite:n,scale:i,...r}=e;let s=i??20;"number"==typeof s&&(s=new Cy(s,s));const a=new TS({uFilterMatrix:{value:new Ry,type:"mat3x3<f32>"},uScale:{value:s,type:"vec2<f32>"},uRotation:{value:new Float32Array([0,0,0,0]),type:"mat2x2<f32>"}}),o=lS.from({vertex:aO,fragment:sO,name:"displacement-filter"}),l=xS.from({vertex:{source:oO,entryPoint:"mainVertex"},fragment:{source:oO,entryPoint:"mainFragment"}}),h=n.texture.source;super({...r,gpuProgram:l,glProgram:o,resources:{filterUniforms:a,uMapTexture:h,uMapSampler:h.style}}),this._sprite=e.sprite,this._sprite.renderable=!1}apply(t,e,n,i){const r=this.resources.filterUniforms.uniforms;t.calculateSpriteMatrix(r.uFilterMatrix,this._sprite);const s=this._sprite.worldTransform,a=Math.sqrt(s.a*s.a+s.b*s.b),o=Math.sqrt(s.c*s.c+s.d*s.d);0!==a&&0!==o&&(r.uRotation[0]=s.a/a,r.uRotation[1]=s.b/a,r.uRotation[2]=s.c/o,r.uRotation[3]=s.d/o),this.resources.uMapTexture=this._sprite.texture.source,t.applyFilter(this,e,n,i)}get scale(){return this.resources.filterUniforms.uniforms.uScale}},DivideBlend:WS,DynamicBitmapFont:vE,Ellipse:ST,EventBoundary:UI,EventEmitter:Ty,EventSystem:zI,EventsTicker:II,ExclusionBlend:jS,ExtensionType:fy,ExtractSystem:bF,FOURCC_TO_TEXTURE_FORMAT:KC,FederatedContainer:GI,FederatedEvent:w_,FederatedMouseEvent:OI,FederatedPointerEvent:DI,FederatedWheelEvent:BI,FillGradient:cT,FillPattern:fT,Filter:OS,FilterEffect:Zx,FilterPipe:dO,FilterSystem:gO,FontStylePromiseCache:_k,GAUSSIAN_VALUES:YI,GL_FORMATS:AD,GL_INTERNAL_FORMAT:eP,GL_TARGETS:ED,GL_TYPES:PD,GL_WRAP_MODES:CD,GenerateTextureSystem:MF,Geometry:QT,GlBackBufferSystem:LD,GlBatchAdaptor:sD,GlBuffer:_D,GlBufferSystem:SD,GlColorMaskSystem:UD,GlContextSystem:TD,GlEncoderSystem:kD,GlGeometrySystem:DD,GlGraphicsAdaptor:ZB,GlLimitsSystem:ND,GlMeshAdaptor:QB,GlParticleContainerAdaptor:yU,GlParticleContainerPipe:PU,GlProgram:lS,GlProgramData:uB,GlRenderTarget:zD,GlRenderTargetAdaptor:tB,GlRenderTargetSystem:lB,GlShaderSystem:EB,GlStateSystem:FB,GlStencilSystem:HD,GlTexture:LB,GlTextureSystem:JB,GlUboSystem:$D,GlUniformGroupSystem:IB,GlobalUniformSystem:EF,GpuBatchAdaptor:oD,GpuBlendModesToPixi:xL,GpuBufferSystem:$F,GpuColorMaskSystem:eL,GpuDeviceSystem:nL,GpuEncoderSystem:iL,GpuGraphicsAdaptor:PL,GpuGraphicsContext:yA,GpuLimitsSystem:rL,GpuMeshAdapter:RL,GpuMipmapGenerator:EL,GpuParticleContainerAdaptor:xU,GpuParticleContainerPipe:RU,GpuProgram:xS,GpuRenderTarget:mL,GpuRenderTargetAdaptor:gL,GpuRenderTargetSystem:vL,GpuShaderSystem:yL,GpuStateSystem:bL,GpuStencilModesToPixi:GD,GpuStencilSystem:sL,GpuTextureSystem:CL,GpuUboSystem:cL,GpuUniformBatchPipe:dL,Graphics:MO,GraphicsContext:aE,GraphicsContextRenderData:xA,GraphicsContextSystem:_A,GraphicsGpuData:jL,GraphicsPath:NA,GraphicsPipe:YL,HTMLText:nD,HTMLTextPipe:fk,HTMLTextRenderData:$O,HTMLTextStyle:JO,HTMLTextSystem:Ak,HardLightBlend:YS,HardMixBlend:qS,HelloSystem:OF,IGLUniformData:class{},ImageSource:Yb,InstructionSet:wb,KTX:nP,LightenBlend:KS,LinearBurnBlend:JS,LinearDodgeBlend:ZS,LinearLightBlend:QS,Loader:GE,LoaderParserPriority:l_,LuminosityBlend:$S,MaskEffectManager:$x,MaskEffectManagerClass:Qx,MaskFilter:bO,Matrix:Ry,Mesh:CO,MeshGeometry:EO,MeshGpuData:gU,MeshPipe:vU,MeshPlane:class extends CO{constructor(t){const{texture:e,verticesX:n,verticesY:i,...r}=t,s=new ZL(Qy({width:e.width,height:e.height,verticesX:n,verticesY:i}));super(Qy({...r,geometry:s,texture:e})),this.texture=e,this.autoResize=!0}textureUpdated(){const t=this.geometry,{width:e,height:n}=this.texture;!this.autoResize||t.width===e&&t.height===n||(t.width=e,t.height=n,t.build({}))}set texture(t){var e;null==(e=this._texture)||e.off("update",this.textureUpdated,this),super.texture=t,t.on("update",this.textureUpdated,this),this.textureUpdated()}get texture(){return this._texture}destroy(t){this.texture.off("update",this.textureUpdated,this),super.destroy(t)}},MeshRope:fU,MeshSimple:class extends CO{constructor(t){const{texture:e,vertices:n,uvs:i,indices:r,topology:s,...a}=t,o=new EO(Qy({positions:n,uvs:i,indices:r,topology:s}));super(Qy({...a,texture:e,geometry:o})),this.autoUpdate=!0,this.onRender=this._render}get vertices(){return this.geometry.getBuffer("aPosition").data}set vertices(t){this.geometry.getBuffer("aPosition").data=t}_render(){this.autoUpdate&&this.geometry.getBuffer("aPosition").update()}},NOOP:Ky,NegationBlend:tw,NineSliceGeometry:kU,NineSlicePlane:class extends zU{constructor(...t){let e=t[0];e instanceof ox&&(qy(0,"NineSlicePlane now uses the options object {texture, leftWidth, rightWidth, topHeight, bottomHeight}"),e={texture:e,leftWidth:t[1],topHeight:t[2],rightWidth:t[3],bottomHeight:t[4]}),qy(0,"NineSlicePlane is deprecated. Use NineSliceSprite instead."),super(e)}},NineSliceSprite:zU,NineSliceSpriteGpuData:GU,NineSliceSpritePipe:HU,NoiseFilter:uO,ObservablePoint:by,OverlayBlend:ew,PI_2:My,Particle:OU,ParticleBuffer:wU,ParticleContainer:LU,ParticleContainerPipe:CU,ParticleShader:EU,PerspectiveMesh:cU,PerspectivePlaneGeometry:lU,PinLightBlend:nw,PipelineSystem:fL,PlaneGeometry:ZL,Point:Cy,Polygon:TT,Pool:Xx,PoolGroupClass:Wx,PrepareBase:TO,PrepareQueue:VO,PrepareSystem:rD,PrepareUpload:iD,QuadGeometry:qU,RAD_TO_DEG:Ay,Rectangle:Hy,RenderContainer:class extends Bb{constructor(t){"function"==typeof t&&(t={render:t});const{render:e,...n}=t;super({label:"RenderContainer",...n}),this.renderPipeId="customRender",this.batched=!1,e&&(this.render=e),this.containsPoint=t.containsPoint??(()=>!1),this.addBounds=t.addBounds??(()=>!1)}updateBounds(){this._bounds.clear(),this.addBounds(this._bounds)}render(t){}},RenderGroup:Eb,RenderGroupPipe:iF,RenderGroupSystem:dF,RenderLayer:KL,RenderTarget:aB,RenderTargetSystem:oB,RenderTexture:_F,RenderableGCSystem:UF,RendererInitHook:Zw,RendererType:AS,ResizePlugin:tT,Resolver:m_,RopeGeometry:dU,RoundedRectangle:AT,SCALE_MODES:XL,STENCIL_MODES:OT,SVGParser:KA,SaturationBlend:iw,SchedulerSystem:PF,ScissorMask:class{constructor(t){this.priority=0,this.pipe="scissorMask",this.mask=t,this.mask.renderable=!1,this.mask.measurable=!1}addBounds(t,e){Ub(this.mask,t,e)}addLocalBounds(t,e){kb(this.mask,t,e)}containsPoint(t,e){return e(this.mask,t)}reset(){this.mask.measurable=!0,this.mask=null}destroy(){this.reset()}},SdfShader:ok,Shader:ES,ShaderStage:fS,ShapePath:kA,SharedRenderPipes:VF,SharedSystems:HF,SoftLightBlend:rw,SplitBitmapText:Pk,SplitText:Dk,Sprite:Fb,SpritePipe:pF,Spritesheet:x_,State:RS,StencilMask:Hb,StencilMaskPipe:xD,SubtractBlend:sw,SystemRunner:Nw,TEXTURE_FORMAT_BLOCK_SIZE:QC,Text:HO,TextStyle:uE,Texture:ox,TextureGCSystem:NF,TextureMatrix:ax,TexturePool:Ab,TexturePoolClass:Mb,TextureSource:ix,TextureStyle:ex,TextureUvs:class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,n){const i=e.width,r=e.height;if(n){const e=t.width/2/i,s=t.height/2/r,a=t.x/i+e,o=t.y/r+s;n=zy.add(n,zy.NW),this.x0=a+e*zy.uX(n),this.y0=o+s*zy.uY(n),n=zy.add(n,2),this.x1=a+e*zy.uX(n),this.y1=o+s*zy.uY(n),n=zy.add(n,2),this.x2=a+e*zy.uX(n),this.y2=o+s*zy.uY(n),n=zy.add(n,2),this.x3=a+e*zy.uX(n),this.y3=o+s*zy.uY(n)}else this.x0=t.x/i,this.y0=t.y/r,this.x1=(t.x+t.width)/i,this.y1=t.y/r,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/r,this.x3=t.x/i,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[pixi.js/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}},Ticker:Qb,TickerListener:Kb,TickerPlugin:eT,TilingSprite:OO,TilingSpriteGpuData:$U,TilingSpritePipe:tk,TilingSpriteShader:YU,Transform:RO,Triangle:SO,UNIFORM_TO_ARRAY_SETTERS:PB,UNIFORM_TO_SINGLE_SETTERS:CB,UNIFORM_TYPES_MAP:_S,UNIFORM_TYPES_VALUES:bS,UPDATE_BLEND:2,UPDATE_COLOR:1,UPDATE_PRIORITY:qb,UPDATE_TRANSFORM:8,UPDATE_VISIBLE:4,UboBatch:tL,UboSystem:VD,UniformGroup:TS,VERSION:Kw,VideoSource:e_,ViewContainer:Bb,ViewSystem:GF,ViewableBuffer:PT,VividLightBlend:aw,WGSL_ALIGN_SIZE_DATA:aL,WGSL_TO_STD40_SIZE:XD,WRAP_MODES:HL,WebGLRenderer:JF,WebGPURenderer:UL,WebWorkerAdapter:RI,WorkerManager:hC,accessibilityTarget:X_,addBits:nM,addMaskBounds:Ub,addMaskLocalBounds:kb,addProgramDefines:Q_,alphaFrag:VI,alphaWgsl:XI,applyMatrix:JU,applyProjectiveTransformationToPlane:QL,applyStyleParams:jB,assignWithIgnore:Cb,autoDetectEnvironment:async function(t){return lw(!t)},autoDetectRenderer:qw,autoDetectSource:function(t={}){return s_(t)},basisTranscoderUrls:kC,bgr2rgb:db,bitmapFontCachePlugin:EE,bitmapFontTextParser:wE,bitmapFontXMLParser:TE,bitmapFontXMLStringParser:ME,bitmapTextSplit:uk,blendTemplateFrag:DS,blendTemplateVert:BS,blendTemplateWgsl:FS,blockDataMap:SL,blurTemplateWgsl:QI,boundsPool:ib,browserExt:yy,buildAdaptiveBezier:wA,buildAdaptiveQuadratic:MA,buildArc:EA,buildArcTo:CA,buildArcToSvg:BA,buildCircle:qM,buildContextBatches:mA,buildEllipse:KM,buildLine:nA,buildPixelLine:iA,buildPolygon:aA,buildRectangle:oA,buildRoundedRectangle:JM,buildSimpleUvs:XM,buildTriangle:lA,buildUvs:VM,cacheAsTextureMixin:Yx,cacheTextureArray:RE,calculateProjection:eB,canvasTextSplit:Ik,checkChildrenDidChange:gb,checkDataUrl:HE,checkExtension:VE,checkMaxIfStatementsInShader:LT,childrenHelperMixin:Kx,cleanArray:BF,cleanHash:DF,clearList:rF,closePointEps:ZM,collectAllRenderables:WL,collectRenderablesMixin:Jx,color32BitToUniform:AF,colorBit:AM,colorBitGl:EM,colorMatrixFilterFrag:iO,colorMatrixFilterWgsl:rO,colorToUniform:function(t,e,n,i){n[i++]=(t>>16&255)/255,n[i++]=(t>>8&255)/255,n[i++]=(255&t)/255,n[i++]=e},compareModeToGlCompare:WB,compileHighShader:pM,compileHighShaderGl:fM,compileHighShaderGlProgram:MM,compileHighShaderGpuProgram:TM,compileHooks:rM,compileInputs:aM,compileOutputs:lM,compileShader:dB,compute2DProjection:oU,convertFormatIfRequired:function(t){const e=t.format;if(dP[e]){const n=dP[e].convertFunction,i=t.resource;for(let t=0;t<i.length;t++)i[t]=n(i[t]);t.format=dP[e].convertedFormat}},convertToList:n_,copySearchParams:v_,createIdFromString:Y_,createIndicesForQuads:bU,createLevelBuffers:function(t,e){const n=t.getNumImages(),i=t.getNumLevels(0);if(!t.startTranscoding())throw new Error("startTranscoding failed");const r=[];for(let s=0;s<i;++s)for(let i=0;i<n;++i){const n=t.getImageTranscodedSizeInBytes(i,s,e),a=new Uint8Array(n);if(!t.transcodeImage(a,i,s,e,1,0))throw new Error("transcodeImage failed");r.push(a)}return r},createLevelBuffersFromKTX:function(t){const e=[];for(let n=0;n<t.numLevels;n++){const i=t.getImageData(n,0,0),r=new Uint8Array(i.byteLength);r.set(i),e.push(r)}return e},createStringVariations:p_,createTexture:eC,createUboElementsSTD40:WD,createUboElementsWGSL:oL,createUboSyncFunction:YD,createUboSyncFunctionSTD40:QD,createUboSyncFunctionWGSL:hL,crossOrigin:gC,cullingMixin:Gx,curveEps:QM,defaultFilterVert:HI,defaultValue:fB,definedProps:Qy,deprecation:qy,detectAvif:OE,detectBasis:MC,detectCompressed:SP,detectDefaults:BE,detectMp4:UE,detectOgv:kE,detectVideoAlphaMode:$b,detectWebm:NE,detectWebp:zE,determineCrossOrigin:yC,displacementFrag:sO,displacementVert:aO,displacementWgsl:oO,earcut:Uw,effectsMixin:tb,ensureAttributes:MD,ensureIsBuffer:JT,ensurePrecision:$_,ensureTextOptions:BO,executeInstructions:eF,extensions:vy,extractAttributesFromGlProgram:bB,extractAttributesFromGpuProgram:dS,extractFontFamilies:yk,extractStructAndGroups:pS,extractSvgUrlId:WA,fastCopy:RT,findMixin:eb,fontStringFromTextStyle:rT,formatShader:function(t){const e=t.split(/([\n{}])/g).map(t=>t.trim()).filter(t=>t.length);let n="";return e.map(t=>{let e=n+t;return"{"===t?n+="    ":"}"===t&&(n=n.substr(0,n.length-4),e=n+t),e}).join("\n")},fragmentGPUTemplate:yM,fragmentGlTemplate:bM,generateArraySyncSTD40:ZD,generateArraySyncWGSL:lL,generateBlurFragSource:KI,generateBlurGlProgram:ZI,generateBlurProgram:$I,generateBlurVertSource:JI,generateGPULayout:function(t){const e=[];let n=0;for(let i=0;i<t;i++)e[n]={texture:{sampleType:"float",viewDimension:"2d",multisampled:!1},binding:n,visibility:GPUShaderStage.FRAGMENT},n++,e[n]={sampler:{type:"filtering"},binding:n,visibility:GPUShaderStage.FRAGMENT},n++;return e},generateGpuLayoutGroups:mS,generateLayout:function(t){const e={};let n=0;for(let i=0;i<t;i++)e[`textureSource${i+1}`]=n++,e[`textureSampler${i+1}`]=n++;return e},generateLayoutHash:gS,generateParticleUpdateFunction:_U,generateProgram:MB,generateShaderSyncCode:cB,generateTextStyleKey:lE,generateTextureBatchBit:IM,generateTextureBatchBitGl:BM,generateTextureMatrix:uA,generateUniformsSync:RB,getAdjustedBlendModeBlend:DT,getAttributeInfoFromFormat:cS,getBatchSamplersUniformGroup:kM,getBitmapTextLayout:yE,getCanvasBoundingBox:NO,getCanvasFillStyle:mE,getCanvasTexture:iB,getDefaultUniformValue:SS,getFastGlobalBounds:function(t,e){return qy(0,"Use container.getFastGlobalBounds() instead"),t.getFastGlobalBounds(!0,e)},getFastGlobalBoundsMixin:sb,getFontCss:Sk,getFontFamilyName:JE,getGeometryBounds:ZT,getGlTypeFromFormat:ID,getGlobalBounds:ab,getGlobalMixin:pb,getGlobalRenderableBounds:pO,getLocalBounds:fb,getMaxFragmentPrecision:Z_,getMaxTexturesPerBatch:kT,getOrientationOfPoints:$M,getPo2TextureFromSource:vk,getResolutionOfUrl:tC,getSVGUrl:wk,getSupportedCompressedTextureFormats:OC,getSupportedGPUCompressedTextureFormats:IC,getSupportedGlCompressedTextureFormats:RC,getSupportedTextureFormats:FC,getTemporaryCanvasFromImage:Tk,getTestContext:J_,getTextureBatchBindGroup:CT,getTextureDefaultMatrix:function(t,e){const{width:n,height:i}=t.frame;return e.scale(1/n,1/i),e},getTextureFormatFromKTXTexture:function(t){return 2===t.classId?vP(t.vkFormat):mP(t.glInternalformat)},getUboData:_B,getUniformData:SB,getUrlExtension:g_,glFormatToGPUFormat:mP,glUploadBufferImageResource:UB,glUploadCompressedTextureResource:NB,glUploadImageResource:zB,glUploadVideoResource:GB,globalUniformsBit:_M,globalUniformsBitGl:wM,globalUniformsUBOBitGl:SM,gpuFormatToBasisTranscoderFormat:function(t){const e=VC[t];if(e)return e;throw new Error(`Unsupported transcoderFormat: ${t}`)},gpuFormatToKTXBasisTranscoderFormat:function(t){const e=yP[t];if(e)return e;throw new Error(`Unsupported transcoderFormat: ${t}`)},gpuUploadBufferImageResource:_L,gpuUploadCompressedTextureResource:TL,gpuUploadImageResource:ML,gpuUploadVideoResource:AL,groupD8:zy,hasCachedCanvasTexture:function(t){return nB.has(t)},hslWgsl:"fn getLuminosity(c: vec3<f32>) -> f32 {\n  return 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;\n}\n\nfn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32> {\n  let d: f32 = lum - getLuminosity(c);\n  let newColor: vec3<f32> = c.rgb + vec3<f32>(d, d, d);\n\n  // clip back into legal range\n  let newLum: f32 = getLuminosity(newColor);\n  let cMin: f32 = min(newColor.r, min(newColor.g, newColor.b));\n  let cMax: f32 = max(newColor.r, max(newColor.g, newColor.b));\n\n  let t1: f32 = newLum / (newLum - cMin);\n  let t2: f32 = (1.0 - newLum) / (cMax - newLum);\n\n  let finalColor = mix(vec3<f32>(newLum, newLum, newLum), newColor, select(select(1.0, t2, cMax > 1.0), t1, cMin < 0.0));\n\n  return finalColor;\n}\n\nfn getSaturation(c: vec3<f32>) -> f32 {\n  return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));\n}\n\n// Set saturation if color components are sorted in ascending order.\nfn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32> {\n  var result: vec3<f32>;\n  if (cSorted.z > cSorted.x) {\n    let newY = (((cSorted.y - cSorted.x) * s) / (cSorted.z - cSorted.x));\n    result = vec3<f32>(0.0, newY, s);\n  } else {\n    result = vec3<f32>(0.0, 0.0, 0.0);\n  }\n  return vec3<f32>(result.x, result.y, result.z);\n}\n\nfn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32> {\n    var result: vec3<f32> = c;\n\n    if (c.r <= c.g && c.r <= c.b) {\n        if (c.g <= c.b) {\n            result = setSaturationMinMidMax(result, s);\n        } else {\n            var temp: vec3<f32> = vec3<f32>(result.r, result.b, result.g);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.r, temp.b, temp.g);\n        }\n    } else if (c.g <= c.r && c.g <= c.b) {\n        if (c.r <= c.b) {\n            var temp: vec3<f32> = vec3<f32>(result.g, result.r, result.b);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.g, temp.r, temp.b);\n        } else {\n            var temp: vec3<f32> = vec3<f32>(result.g, result.b, result.r);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.g, temp.b, temp.r);\n        }\n    } else {\n        if (c.r <= c.g) {\n            var temp: vec3<f32> = vec3<f32>(result.b, result.r, result.g);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.b, temp.r, temp.g);\n        } else {\n            var temp: vec3<f32> = vec3<f32>(result.b, result.g, result.r);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.b, temp.g, temp.r);\n        }\n    }\n\n    return result;\n}",hslgl:kS,hslgpu:NS,injectBits:hM,insertVersion:tS,isMobile:G_,isPow2:Zy,isRenderingToScreen:rB,isSafari:mk,isSingleItem:f_,isWebGLSupported:Ww,isWebGPUSupported:jw,ktxTranscoderUrls:oP,loadBasis:HC,loadBasisOnWorker:GC,loadBitmapFont:CE,loadDDS:tP,loadEnvironmentExtensions:lw,loadFontAsBase64:xk,loadFontCSS:bk,loadImageBitmap:dC,loadJson:XE,loadKTX:rP,loadKTX2:uP,loadKTX2onWorker:cP,loadSVGImage:Mk,loadSvg:nC,loadTextures:pC,loadTxt:WE,loadVideoTextures:xC,loadWebFont:$E,localUniformBit:cD,localUniformBitGl:dD,localUniformBitGroup2:uD,localUniformMSDFBit:ek,localUniformMSDFBitGl:nk,log2:function(t){let e=(t>65535?1:0)<<4,n=((t>>>=e)>255?1:0)<<3;return e|=n,n=((t>>>=n)>15?1:0)<<2,e|=n,n=((t>>>=n)>3?1:0)<<1,e|=n,e|(t>>>=n)>>1},logDebugTexture:async function(t,e,n=200){const i=await e.extract.base64(t);await e.encoder.commandFinished,["font-size: 1px;",`padding: ${n}px 300px;`,`background: url(${i}) no-repeat;`,"background-size: contain;"].join(" ")},logProgramError:TB,logRenderGroupScene:function t(e,n=0,i={index:0,color:"#000000"}){let r="";for(let s=0;s<n;s++)r+="    ";i.index,e.root.label,e.worldTransform.tx,n++;for(let s=0;s<e.renderGroupChildren.length;s++){t(e.renderGroupChildren[s],n,{...i,index:s})}},logScene:function t(e,n=0,i={color:"#000000"}){e.renderGroup&&(i.color=Uk[kk++]);let r="";for(let o=0;o<n;o++)r+="    ";let s=e.label;!s&&e instanceof Fb&&(s=`sprite:${e.texture.label}`);let a=`%c ${r}|- ${s} (worldX:${e.worldTransform.tx}, relativeRenderX:${e.relativeGroupTransform.tx}, renderX:${e.groupTransform.tx}, localX:${e.x})`;e.renderGroup&&(a+=" (RenderGroup)"),e.filters&&(a+="(*filters)"),n++;for(let o=0;o<e.children.length;o++){t(e.children[o],n,{...i})}},mSDFBit:ik,mSDFBitGl:rk,mapFormatToGlFormat:YB,mapFormatToGlInternalFormat:qB,mapFormatToGlType:KB,mapGlToVertexFormat:xB,mapSize:function(t){return OB[t]},mapType:yB,mapWebGLBlendModesToPixi:DB,maskFrag:vO,maskVert:yO,maskWgsl:xO,matrixPool:nb,measureHtmlText:eD,measureMixin:yb,migrateFragmentFromV7toV8:function(t){return t=`\n        out vec4 finalColor;\n    ${t=t.replaceAll("texture2D","texture").replaceAll("gl_FragColor","finalColor").replaceAll("varying","in")}\n    `},mipmapScaleModeToGlFilter:VB,multiplyColors:ub,multiplyHexColors:hb,nextPow2:Jy,noiseFrag:lO,noiseWgsl:hO,nonCompressedFormats:DC,normalizeExtensionPriority:gy,onRenderMixin:xb,parseDDS:$C,parseFunctionBody:function(t){const e=t.toString(),n=e.indexOf("{"),i=e.lastIndexOf("}");if(-1===n||-1===i)throw new Error("getFunctionBody: No body found in function definition");return e.slice(n+1,i).trim()},parseKTX:iP,parseSVGDefinitions:HA,parseSVGFloatAttribute:GA,parseSVGPath:bT,parseSVGStyle:YA,particleData:DU,particlesFrag:TU,particlesVert:MU,particlesWgsl:AU,path:u_,pointInTriangle:_O,preloadVideo:vC,removeItems:qx,removeStructAndGroupDuplicates:vS,resetUids:function(){for(const t in Vy)delete Vy[t]},resolveCharacters:xE,resolveCompressedTextureUrl:bP,resolveJsonUrl:_C,resolveTextureUrl:bC,resourceToTexture:a_,roundPixelsBit:FM,roundPixelsBitGl:LM,roundedShapeArc:FA,roundedShapeQuadraticCurve:LA,sayHello:IF,scaleModeToGlFilter:HB,setBasisTranscoderPath:function(t){Object.assign(kC,t)},setKTXTranscoderPath:function(t){Object.assign(oP,t)},setPositions:KU,setProgramName:iS,setUvs:ZU,shapeBuilders:dA,sortMixin:bb,spritesheetAsset:S_,squaredDistanceToLineSegment:wT,stripVersion:rS,styleAttributes:jA,testImageFormat:IE,testVideoFormat:LE,textStyleToCSS:WO,textureBit:pD,textureBitGl:fD,textureFrom:o_,tilingBit:VU,tilingBitGl:XU,toFillStyle:eE,toLocalGlobalMixin:Sb,toStrokeStyle:nE,transformVertices:WM,triangulateWithHoles:rA,uboSyncFunctionsSTD40:KD,uboSyncFunctionsWGSL:JD,uid:Xy,uniformParsers:jD,unpremultiplyAlpha:function(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let n=0;n<e;n+=4){const e=t[n+3];if(0!==e){const i=255.001/e;t[n]=t[n]*i+.5,t[n+1]=t[n+1]*i+.5,t[n+2]=t[n+2]*i+.5}}},unsafeEvalSupported:cw,updateLocalTransform:function(t,e){const n=e._scale,i=e._pivot,r=e._position,s=n._x,a=n._y,o=i._x,l=i._y;t.a=e._cx*s,t.b=e._sx*s,t.c=e._cy*a,t.d=e._sy*a,t.tx=r._x-(o*t.a+l*t.c),t.ty=r._y-(o*t.b+l*t.d)},updateQuadBounds:lx,updateRenderGroupTransform:oF,updateRenderGroupTransforms:aF,updateTextBounds:pk,updateTransformAndChildren:lF,updateTransformBackwards:lb,updateWorldTransform:function(t,e,n){const i=t.a,r=t.b,s=t.c,a=t.d,o=t.tx,l=t.ty,h=e.a,c=e.b,u=e.c,d=e.d;n.a=i*h+r*u,n.b=i*c+r*d,n.c=s*h+a*u,n.d=s*c+a*d,n.tx=o*h+l*u+e.tx,n.ty=o*c+l*d+e.ty},v8_0_0:jy,v8_3_4:Yy,validFormats:xP,validateRenderables:cF,vertexGPUTemplate:vM,vertexGlTemplate:xM,vkFormatToGPUFormat:vP,warn:Vx,webworkerExt:xy,wrapModeToGlAddress:XB},Symbol.toStringTag,{value:"Module"})),zk=class t extends Ty{static getInstance(){return t.instance||(t.instance=new t),t.instance}};n(zk,"instance",null);let Gk=zk;class Hk extends ed{constructor(t="#ffffff",e=1){super(t,e),n(this,"lightHelper"),n(this,"shadowHelper"),n(this,"shadowSize",20),n(this,"debugEnabled",!1),n(this,"eventEmitter",Gk.getInstance()),this.initComponentSystem(),this.lightHelper=new dp(this,2,0),this.shadowHelper=new mp(this.shadow.camera)}updateHelpers(){this.target.updateMatrixWorld(),this.shadow.camera.updateProjectionMatrix(),this.lightHelper.update(),this.shadowHelper.update()}updateDirectionalLightComponent(t){this.setTarget(t.target.x,t.target.y,t.target.z),this.castShadow=t.castShadow,this.shadowMapWidth=t.shadowMapSize,this.shadowMapHeight=t.shadowMapSize,this.shadowAreaSize=t.shadowAreaSize,this.shadow.camera.near=.5,this.shadow.camera.far=500,this.shadow.bias=t.bias,this.changeDebug(t.debug),this.updateHelpers()}updateComponents(t){const e=t.directionalLight;e&&this.updateDirectionalLightComponent(e),super.updateComponents(t)}setTarget(t,e,n){t instanceof Oi?this.target.position.set(t.position.x,t.position.y,t.position.z):this.target.position.set(t,e,n),this.target.updateMatrixWorld(),this.lightHelper.update()}set shadowMapWidth(t){this.shadow.mapSize.width=t,this.shadow.map=null}get shadowMapWidth(){return this.shadow.mapSize.width}set shadowMapHeight(t){this.shadow.mapSize.height=t,this.shadow.map=null}get shadowMapHeight(){return this.shadow.mapSize.height}set shadowAreaSize(t){this.shadowSize=t,this.shadow.camera.left=-this.shadowSize,this.shadow.camera.right=this.shadowSize,this.shadow.camera.top=this.shadowSize,this.shadow.camera.bottom=-this.shadowSize}get shadowAreaSize(){return this.shadowSize}changeDebug(t){var e,n;this.debugEnabled!==t&&(t?(this.eventEmitter.emit("addToScene3D",this.lightHelper),this.eventEmitter.emit("addToScene3D",this.shadowHelper)):(null==(e=this.lightHelper.parent)||e.remove(this.lightHelper),null==(n=this.shadowHelper.parent)||n.remove(this.shadowHelper)),this.debugEnabled=t)}transformUpdate(){this.debugEnabled&&this.updateHelpers()}destroy(){var t,e;super.destroy(),null==(t=this.lightHelper.parent)||t.remove(this.lightHelper),null==(e=this.shadowHelper.parent)||e.remove(this.shadowHelper)}setVisible(t){this.visible=t,this.lightHelper.visible=t,this.shadowHelper.visible=t}}class Vk extends $u{constructor(t="#ffffff",e=1){super(t,e),n(this,"lightHelper"),n(this,"debugEnabled",!1),n(this,"eventEmitter",Gk.getInstance()),this.initComponentSystem(),this.lightHelper=new rp(this,2,0)}updatePointLightComponent(t){this.distance=t.distance,this.decay=t.decay,this.castShadow=t.castShadow,this.changeDebug(t.debug),this.lightHelper.update()}updateComponents(t){const e=t.pointLight;e&&this.updatePointLightComponent(e),super.updateComponents(t)}changeDebug(t){var e;this.debugEnabled!==t&&(t?this.eventEmitter.emit("addToScene3D",this.lightHelper):null==(e=this.lightHelper.parent)||e.remove(this.lightHelper),this.debugEnabled=t)}destroy(){var t;super.destroy(),null==(t=this.lightHelper.parent)||t.remove(this.lightHelper)}setVisible(t){this.visible=t,this.lightHelper.visible=t}}class Xk extends qu{constructor(t="#ffffff",e=1){super(t,e),n(this,"lightHelper"),n(this,"debugEnabled",!1),n(this,"eventEmitter",Gk.getInstance()),this.initComponentSystem(),this.lightHelper=new $d(this,0)}updateHelpers(){this.target.updateMatrixWorld(),this.shadow.camera.updateProjectionMatrix(),this.lightHelper.update()}updateSpotLightComponent(t){var e,n,i;this.setTarget(null==(e=t.target)?void 0:e.x,null==(n=t.target)?void 0:n.y,null==(i=t.target)?void 0:i.z),this.distance=t.distance,this.decay=t.decay,this.castShadow=t.castShadow,this.angle=t.angle,this.penumbra=t.penumbra,this.setShadowMapSize(t.shadowMapSize),this.changeDebug(t.debug),setTimeout(()=>{this.updateHelpers()},1)}updateComponents(t){const e=t.spotLight;e&&this.updateSpotLightComponent(e),super.updateComponents(t)}setTarget(t,e,n){t instanceof Oi?this.target.position.set(t.position.x,t.position.y,t.position.z):this.target.position.set(t,e,n),this.target.updateMatrixWorld(),this.updateHelpers()}set shadowMapWidth(t){this.shadow.mapSize.width=t,this.shadow.map=null}get shadowMapWidth(){return this.shadow.mapSize.width}set shadowMapHeight(t){this.shadow.mapSize.height=t,this.shadow.map=null}get shadowMapHeight(){return this.shadow.mapSize.height}setShadowMapSize(t){this.shadowMapWidth=t,this.shadowMapHeight=t}changeDebug(t){var e;this.debugEnabled!==t&&(t?this.eventEmitter.emit("addToScene3D",this.lightHelper):null==(e=this.lightHelper.parent)||e.remove(this.lightHelper),this.debugEnabled=t)}transformUpdate(){this.debugEnabled&&this.updateHelpers()}destroy(){var t;super.destroy(),null==(t=this.lightHelper.parent)||t.remove(this.lightHelper)}setVisible(t){this.visible=t,this.lightHelper.visible=t}}class Wk extends Fr{constructor(t,e){super(t,e),n(this,"sID",""),n(this,"type","Mesh"),n(this,"selected",!1),n(this,"locked",!1),n(this,"isGameObject",!0),this.initComponentSystem()}updateMeshComponent(t){if(this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,t.material){const e=$v.get(t.material);e&&(this.material=e)}}updateComponents(t){const e=t.mesh;e&&this.updateMeshComponent(e),super.updateComponents(t)}}const jk=new Ur(1,1,1),Yk=new nu({color:16777215});class qk extends Wk{constructor(t){super(jk,t||Yk)}}const Kk=new nc(1,1,1,16),Jk=new nu({color:16777215});class Zk extends Wk{constructor(t){super(Kk,t||Jk)}}const Qk=new os(1,1),$k=new nu({color:16777215});class tN extends Wk{constructor(t){super(Qk,t||$k)}}const eN=new jc(1,16,16),nN=new nu({color:16777215});class iN extends Wk{constructor(t){super(eN,t||nN)}}class rN extends Hu{constructor(t="#ffffff",e="#ffffff",i=1){super(t,e,i),n(this,"lightHelper"),n(this,"eventEmitter",new Gk),n(this,"debugEnabled",!1),this.initComponentSystem(),this.lightHelper=new lp(this,2,0)}updateDirectionalLightComponent(t){this.color.set(t.color),this.groundColor.set(t.groundColor),this.intensity=t.intensity,this.changeDebug(t.debug),this.lightHelper.update()}updateComponents(t){const e=t.hemisphereLight;e&&this.updateDirectionalLightComponent(e),super.updateComponents(t)}changeDebug(t){var e;this.debugEnabled=t,t?(this.eventEmitter.emit("addToScene3D",this.lightHelper),this.lightHelper.update()):null==(e=this.lightHelper.parent)||e.remove(this.lightHelper)}transformUpdate(){this.debugEnabled&&this.lightHelper.update()}destroy(){var t;super.destroy(),null==(t=this.lightHelper.parent)||t.remove(this.lightHelper)}setVisible(t){this.visible=t,this.lightHelper.visible=t}}class sN extends Yr{constructor(t=75,e=1,i=.1,r=1e3){super(t,e,i,r),n(this,"cameraHelper"),n(this,"eventEmitter",Gk.getInstance()),n(this,"debugEnabled",!1),this.initComponentSystem(),this.cameraHelper=new mp(this)}updatePerspectiveCameraComponent(t){this.fov=t.fov,this.aspect=t.aspect,this.near=t.near,this.far=t.far,this.changeDebug(t.debug),this.cameraHelper.update()}updateComponents(t){const e=t.perspectiveCamera;e&&this.updatePerspectiveCameraComponent(e),super.updateComponents(t)}changeDebug(t){var e;this.debugEnabled!==t&&(t?this.eventEmitter.emit("addToScene3D",this.cameraHelper):null==(e=this.cameraHelper.parent)||e.remove(this.cameraHelper),this.debugEnabled=t)}transformUpdate(){this.debugEnabled&&this.cameraHelper.update()}destroy(){var t;super.destroy(),null==(t=this.cameraHelper.parent)||t.remove(this.cameraHelper)}setVisible(t){this.visible=t,this.cameraHelper.visible=t}}var aN=(t=>(t.PREFAB_ROOT="prefabRoot",t.ROOT="root",t.NODE2D="node2D",t.SPRITE="sprite",t.ANIMATED_SPRITE="animatedSprite",t.TEXT="text",t.HTML_TEXT="htmlText",t.CONTAINER="container",t.GRAPHICS="graphics",t.TILING_SPRITE="tilingSprite",t.LAYOUT2D="layout2D",t.CELL2D="cell2D",t.PARTICLE_EMITTER="particleEmitter",t.SPINE="spine",t.NINESLICE="nineSliceSprite",t.VIEWPORT="viewport",t.TUTORIAL="tutorial",t.CAMERA="camera",t.FEEDBACK="feedback",t.SCRIPTS="scripts",t.CTA="cta",t.LOTTIE="lottie",t.LAYER="layer",t.VIDEO="video",t.NODE3D="node3D",t.BOX="box",t.SPHERE="sphere",t.CYLINDER="cylinder",t.CONE="cone",t.PLANE="plane",t.SPRITE3D="sprite3D",t.MESH="mesh",t.LIGHT="light",t.POINT_LIGHT="pointLight",t.SPOT_LIGHT="spotLight",t.DIRECTIONAL_LIGHT="directionalLight",t.AMBIENT_LIGHT="ambientLight",t.HEMISPHERE_LIGHT="hemisphereLight",t.RECT_AREA_LIGHT="rectAreaLight",t.PERSPECTIVE_CAMERA="perspectiveCamera",t.MODEL="model",t.QUARKS_PARTICLE="quarksParticle",t.SKINNED_MESH="skinnedMesh",t.BONE="bone",t.INLINE_MODEL="inlineModel",t.SHURA_PARTICLE="shuraParticle",t))(aN||{});const oN=new $o({color:16777215});let lN=class extends pl{constructor(t){super(t||oN),n(this,"type",aN.SPRITE3D),this.initComponentSystem()}updateSpriteComponent(t){if(this.center.copy(t.center),t.material){const e=$v.get(t.material);e&&(this.material=e)}}updateComponents(t){const e=t.sprite3D;e&&this.updateSpriteComponent(e),super.updateComponents(t)}},hN="portrait",cN=null,uN=null,dN=null,pN="",fN={width:0,height:0};function mN(){return hN}function gN(){return uN}function vN(){return dN}function yN(t){pN=t}function xN(){return pN}class bN{constructor(t,e,i=!0){n(this,"mixer"),n(this,"curAnim",null),n(this,"animActions",{}),n(this,"model"),n(this,"animClips",{}),n(this,"prevAnim",null),n(this,"events",{}),n(this,"removeBonesFromAnim",(t,e,n=!1)=>{for(let i=t.tracks.length-1;i>=0;i--){const r=t.tracks[i];let s=!1;for(const t of e)if(r.name.includes(t)){s=!0;break}n?s||t.tracks.splice(i,1):s&&t.tracks.splice(i,1)}return t.tracks}),n(this,"getCurPercentage",()=>this.curAnim?this.curAnim.time/this.curAnim.getClip().duration:0),n(this,"getAnimPercentage",t=>t.time/t.getClip().duration),n(this,"getAnimActions",()=>this.animActions),n(this,"getCurAnim",()=>this.curAnim),n(this,"getPrevAnim",()=>this.prevAnim),this.mixer=new Gd(t),this.model=t,e.forEach(t=>{const e=t;this.animClips[t.name]=e,e.defaultDuration=t.duration}),this.initEventListener(),i&&this.addAllAnims(),this.events={}}playAnim(t,{loopType:e=2201,fadeDuration:n=.2,speed:i=1,force:r=!1,noFade:s=!1,startPerc:a=0}={}){if(!this.animClips[t])return;this.curAnim||(s=!0);return s?this.startAnimation(t,{loopType:e,force:r,speed:i,startPerc:a}):this.fadeToAction(t,{fadeDuration:n,loopType:e,speed:i,forced:r,startPerc:a})}addAllAnims(){Object.entries(this.animClips).forEach(([t,e])=>{const n=this.mixer.clipAction(e,this.model);this.animActions[t]=n,n.animClip=e,n.onComplete=t=>{n.oncompleteCallback=t}})}addAnimation({name:t,startTime:e,duration:n}){const i=this.animClips[t];if(!i)return;const r=this.mixer.clipAction(i,this.model);this.animActions[t]=r,void 0!==e&&(i.startTime=e),void 0!==n&&(i.duration=n),r.animClip=i}stopAllAnimations(){this.mixer.stopAllAction()}initEventListener(){this.mixer.addEventListener("finished",t=>{t.action.oncompleteCallback&&t.action.oncompleteCallback()})}startAnimation(t,{force:e=!1,loopType:n=2201,speed:i=1,startPerc:r=0}={}){var s;const a=this.animActions[t];if(a&&(e||(null==(s=this.curAnim)?void 0:s.animClip.name)!==t))return a.reset(),n&&(a.loop=n),a.play(),this.curAnim=a,this.curAnim.timeScale=i,this.skipToAnimPerc(r),a}startAnotherAnim(t){var e;if((null==(e=this.curAnim)?void 0:e.animClip.name)===t)return;const n=this.animActions[t];n&&(n.setEffectiveTimeScale(1),n.play(),this.curAnim=n)}checkCurAnimName(t){var e;return(null==(e=this.curAnim)?void 0:e.animClip.name)===t}fadeToAction(t,{fadeDuration:e=.3,loopType:n=2201,speed:i=1,forced:r=!1,startPerc:s=0}={}){const a=this.animActions[t];if(a&&(this.prevAnim=this.curAnim,this.curAnim=a,this.prevAnim!==this.curAnim||r))return this.prevAnim&&this.prevAnim.fadeOut(e),this.curAnim.clampWhenFinished=!0,this.curAnim.loop=n,this.curAnim.reset().setEffectiveTimeScale(i).setEffectiveWeight(1).fadeIn(e).play(),this.skipToAnimPerc(s),this.curAnim}skipToAnimPerc(t){this.curAnim&&(this.curAnim.time=this.curAnim.getClip().duration*t)}update(t){this.mixer.update(t),this.updateAnimEventSystem(t)}addEvent(t,e,n){this.events[t]||(this.events[t]=[]),this.events[t].push({fired:!1,perc:e,event:n,anim:this.animActions[t]})}resetEvents(t){this.events[t]=[]}getCurAnimCurEvent(){var t;let e=this.getCurPercentage(),n=(null==(t=this.curAnim)?void 0:t.getClip().name)??"";return this.getCurAnimEvent(n,e)}getCurAnimEvent(t,e){let n=null;if(this.events[t]&&this.events[t].length>0)for(let i=0;i<this.events[t].length;i++)if(e>=this.events[t][i].perc&&!this.events[t][i].fired)return n=this.events[t][i],n;return n}updateAnimEventSystem(t){if(this.curAnim)for(let e in this.events){let t=this.events[e];for(let e=0;e<t.length;e++){let n=t[e],i=n.anim,r=this.getAnimPercentage(i);r>=n.perc&&!n.fired&&(n.fired=!0,n.event(this)),r<n.perc&&(n.fired=!1)}}}}class _N extends Oi{constructor(t){super(),n(this,"sID",""),n(this,"type",aN.MODEL),n(this,"selected",!1),n(this,"locked",!1),n(this,"isGameObject",!0),n(this,"modelUUID",""),n(this,"stuffsID",null),n(this,"model",null),n(this,"internalAnimationPlayer"),n(this,"morphObjects",{}),n(this,"eventEmitter",Gk.getInstance()),n(this,"activeModel","empty"),n(this,"componentRef",null),n(this,"modelPath"),n(this,"animationManager"),t&&this.setModel(t),this.initComponentSystem()}handleModelLoad(t){this.sID,this.model&&this.remove(this.model);const{scene:e,animations:n}=t;this.model=vv(e),this.add(this.model),n.forEach(t=>{const e=t.name.replace(/[|]/g,"_").replace(/\./g,"_");t.name=e}),this.animationManager=new bN(this.model,n)}setModel(t){if(this.modelUUID===t&&"model"===this.activeModel)return;this.modelUUID=t,this.activeModel="model";const e=cy.getModel(t,t=>{"model"===this.activeModel&&t&&this.handleModelLoad(t)});e&&this.handleModelLoad(e)}setModelFromStuffs(t,e){if(!t)return;this.activeModel="stuffs";let n=t;n=t+"_"+(window.app.data[e]||0);const i=cy.getModelFromStuffs(n,t=>{"stuffs"===this.activeModel&&(t?this.handleModelLoad(t):this.model&&(this.remove(this.model),this.model=null))});i&&this.handleModelLoad(i)}updateModelComponent(t){this.componentRef=t,t.modelPath&&(this.modelPath=t.modelPath);const{animations:e,morphs:n}=t;this.internalAnimationPlayer&&Object.entries(e).forEach(([t,e])=>{"play"===e.state?this.internalAnimationPlayer.play(t,e.loop):"stop"===e.state&&this.internalAnimationPlayer.stop(t)}),n&&n.length>0&&n.forEach(t=>{const e=this.morphObjects[t.name];e&&e.morphTargetInfluences&&(e.morphTargetInfluences=t.targets)}),t.stuffs?this.setModelFromStuffs(t.stuffs,t.stuffsDataId):this.setModel(t.modelUUID)}getModelComponent(){return this.componentRef}updateTreeComponent(t){this.model?t.modelData&&Object.keys(t.modelData).forEach(e=>{const n=t.modelData[e],i=this.model.getObjectByName(e);i&&(i.visible=n.visible,i.castShadow=n.castShadow,i.receiveShadow=n.receiveShadow)}):setTimeout(()=>{this.updateTreeComponent(t)},250)}updateComponents(t){const e=t.model,n=t.modelTree;e&&this.updateModelComponent(e),n&&this.updateTreeComponent(n),super.updateComponents(t)}update(t){var e;this.internalAnimationPlayer&&this.internalAnimationPlayer.update(t),null==(e=this.animationManager)||e.update(t)}}class SN extends Oi{constructor(t){super(),n(this,"sID",""),n(this,"type",aN.QUARKS_PARTICLE),n(this,"selected",!1),n(this,"locked",!1),n(this,"isGameObject",!0),n(this,"modelUUID",""),n(this,"particle"),n(this,"emitterList",[]),n(this,"orgValues",{}),n(this,"eventEmitter",Gk.getInstance()),this.modelUUID=t;const e=cy.getQuarks(t,t=>{t&&this.handleQuarksData(t.particle,t.emitterList)});e&&this.handleQuarksData(e.particle,e.emitterList),this.initComponentSystem()}handleQuarksData(t,e){this.particle=t,this.emitterList=e,this.add(this.particle);const n=[];for(let i=0;i<this.emitterList.length;i++){const t=this.emitterList[i];n.push({name:t.name,worldSpace:t.system.worldSpace})}return this.particle}updateComponents(t){const e=t.quarksParticle;e&&this.particle&&this.updateQuarksComponent(e),super.updateComponents(t)}play(){for(let t=0;t<this.emitterList.length;t++){this.emitterList[t].system.restart()}}updateQuarksComponent(t){ty.multiplyParticleScale(this.emitterList,t.scale,!1)}stop(t=!0){for(let e=0;e<this.emitterList.length;e++){const n=this.emitterList[e];t?(n.system.restart(),n.system.pause()):n.system.pause()}}}class wN extends Oi{constructor(t){super(),n(this,"sID",""),n(this,"internalAnimationPlayer"),n(this,"modelAnimations",[]),n(this,"modelRef"),n(this,"eventEmitter",Gk.getInstance()),n(this,"morphObjects",{}),n(this,"isInlineModel"),n(this,"componentRef",null),n(this,"animationManager"),this.modelRef=t,this.initializeInlineModel(),this.initComponentSystem(),this.isGameObject=!0,this.isInlineModel=!0}initializeInlineModel(){var t;this.sID,this.modelAnimations=this.modelRef.animations,null==(t=this.modelAnimations)||t.forEach(t=>{const e=t.name.replace(/[|]/g,"_").replace(/\./g,"_");t.name=e});const e={};this.modelAnimations.forEach(t=>{e[t.name]={state:"stop",loop:"none"}}),this.eventEmitter.emit("inlineModelAnimUpdate",{id:this.sID,animations:e}),this.animationManager=new bN(this,this.modelAnimations)}updateInlineModelComponent(t){this.componentRef=t,0===this.modelAnimations.length&&this.initializeInlineModel();const{animations:e}=t;this.internalAnimationPlayer&&Object.entries(e).forEach(([t,e])=>{"play"===e.state?this.internalAnimationPlayer.play(t,e.loop):"stop"===e.state&&this.internalAnimationPlayer.stop(t)})}updateComponents(t){const e=t.inlineModel;e&&this.updateInlineModelComponent(e),super.updateComponents(t)}update(t){var e,n;null==(e=this.internalAnimationPlayer)||e.update(t),null==(n=this.animationManager)||n.update(t)}}function TN(t,e,n=1){if(!e)throw new Error("empty path");const i=e.split("/")||[];let r=t;for(let s=n;s<i.length;s++)if(i[s].startsWith("#")){let t=!1;for(let e=0;e<r.length;e++){const n=r[e];if(n.name===i[s].slice(1,i[s].length)){r=n,t=!0;break}}if(!t)throw new Error(`Child with name "${i[s].slice(1)}" not found at path segment ${s}: "${i[s]}"`)}else{if(!(i[s]in r))throw new Error(`Property "${i[s]}" not found on object at path segment ${s}`);r=r[i[s]]}return r}const MN=new nu({color:16188919}),AN=new Ur(5,5,5,5);class EN extends Wk{constructor(t,e,i){const{geometry:r,material:s}=EN.loadCustomMesh(t,e,i);super(r||AN,s||MN),n(this,"eventEmitter",Gk.getInstance()),n(this,"component"),this.component=e}static loadCustomMesh(t,e,n){if(!t)return{geometry:null,material:null};let i=(t=cy.getModel(t.modelUUID)).scene;i=TN(i,(null==e?void 0:e.geometry)??"");let r=null;(null==e?void 0:e.material)&&(r=$v.get(e.material)),r||(r=MN);return{geometry:i,material:r}}updateMaterial(){var t,e;(null==(t=this.component)?void 0:t.material)&&(this.material=$v.get(null==(e=this.component)?void 0:e.material))}}const CN=new nu({color:16188919});new Ur(5,5,5,5);class PN extends El{constructor(t,e,i){const{geometry:r,material:s,skeleton:a,bindMatrix:o}=PN.loadSkinnedMesh(t,e,i);super(r,s||CN),n(this,"sID",""),n(this,"type","Mesh"),n(this,"selected",!1),n(this,"locked",!1),n(this,"isGameObject",!0),n(this,"materialID",""),n(this,"component"),this.bind(a,o),this.component=e,this.initComponentSystem()}updateMaterial(){var t;this.material=$v.get(null==(t=this.component)?void 0:t.material)}static loadSkinnedMesh(t,e,n){let i=t.scene;i=TN(i,(null==e?void 0:e.geometry)??"");let r=null;r=$v.get(e.material),r||(r=CN);let s=t.scene;return s=TN(s,(null==e?void 0:e.geometry.replace("/geometry",""))??""),{geometry:i,material:r,skeleton:s.skeleton,bindMatrix:s.bindMatrix}}updateMeshComponent(t){if(this.component=t,t.material){const e=$v.get(t.material);e&&(this.material=e),this.materialID=t.material}}updateComponents(t){const e=t.mesh;e&&this.updateMeshComponent(e),super.updateComponents(t)}update(t){super.update(t)}}class RN{static get world(){return"rapier3d"===this.currentPhysicsType?this.rapierPhysics.getWorld():"cannon"===this.currentPhysicsType?this.cannonPhysics.getWorld():void 0}static setPhysicsType(t){this.currentPhysicsType!==t&&(this.currentPhysicsType=t,"rapier3d"===t?this.scene&&this.rapierPhysics.setScene(this.scene):"cannon"===t&&this.scene&&this.cannonPhysics.setScene(this.scene))}static setScene(t){var e,n;this.scene=t,null==(e=this.rapierPhysics)||e.setScene(t),null==(n=this.cannonPhysics)||n.setScene(t)}static setDebugEnabled(t){var e,n,i;null==(e=this.rapierPhysics)||e.setDebugEnabled(!1),null==(n=this.cannonPhysics)||n.setDebugEnabled(!1),"rapier3d"===this.currentPhysicsType?null==(i=this.rapierPhysics)||i.setDebugEnabled(t):"cannon"===this.currentPhysicsType&&this.cannonPhysics.setDebugEnabled(t)}static step(t){"rapier3d"===this.currentPhysicsType?this.rapierPhysics.step(t):"cannon"===this.currentPhysicsType&&this.cannonPhysics.step(t)}static getWorld(){return"rapier3d"===this.currentPhysicsType?this.rapierPhysics.getWorld():"cannon"===this.currentPhysicsType?this.cannonPhysics.getWorld():null}static isReady(){return"rapier3d"===this.currentPhysicsType?null!==this.rapierPhysics&&null!==this.rapierPhysics.getWorld():"cannon"===this.currentPhysicsType&&(null!==this.cannonPhysics&&null!==this.cannonPhysics.getWorld())}static getCurrentPhysicsType(){return this.currentPhysicsType}static removeBody(t){if("rapier3d"===this.currentPhysicsType){const e=this.rapierPhysics.getWorld();e&&t&&e.removeRigidBody(t)}else if("cannon"===this.currentPhysicsType){const e=this.cannonPhysics.getWorld();e&&t&&e.removeBody(t)}}static clearAllBodies(){const t=this.rapierPhysics.getWorld();if(t){const e=[];t.bodies.forEach(t=>{e.push(t)}),e.forEach(e=>{t.removeRigidBody(e)})}const e=this.cannonPhysics.getWorld();if(e){[...e.bodies].forEach(t=>{e.removeBody(t)})}}}n(RN,"currentPhysicsType","none"),n(RN,"scene",null);class IN{constructor(t){n(this,"node"),n(this,"componentData"),n(this,"defaults",null),this.node=t}update(t){if(t)if(this.componentData=t,this.defaults||(this.defaults=this.get().data||null),this.node.body)this.node.body.updateBody(this.node,t);else{RN.getCurrentPhysicsType()}}remove(){this.node.body&&(this.node.body.remove(!0),this.node.body=null),this.componentData=void 0,this.defaults=null}get(){return{type:"physics3D",data:this.componentData}}step(){var t;(null==(t=this.node)?void 0:t.body)&&(this.node.position.copy(this.node.body.position),this.node.quaternion.copy(this.node.body.quaternion))}}class ON{static add(t,e){let n;const{type:i,components:r,id:s}=t;return n="node3D"===i?this.addNode3D():i===aN.MESH?this.addCustomMesh(r,e,s):"box"===i?this.addBox():"sphere"===i?this.addSphere():"cylinder"===i?this.addCylinder():"plane"===i?this.addPlane():"ambientLight"===i?this.addAmbientLight():"directionalLight"===i?this.addDirectionalLight(r):"pointLight"===i?this.addPointLight(r):"spotLight"===i?this.addSpotLight(r):"hemisphereLight"===i?this.addHemisphereLight(r):"perspectiveCamera"===i?this.addPerspectiveCamera(r):"sprite3D"===i?this.addSprite():"model"===i?this.addModel(r):i===aN.QUARKS_PARTICLE?this.addQuarksParticle(r):i===aN.SKINNED_MESH?this.addSkinnedMesh(r,e,s):i===aN.BONE?this.addBone(r,e):i===aN.INLINE_MODEL?this.addInlineModel(e):this.addBox(),(null==r?void 0:r.physics3D)&&(n.components.physics3D=new IN(n)),n.updateComponents(r),n.isStudioObject=!0,n}static addInlineModel(t){return new wN(t)}static addSkinnedMesh(t,e,n){if(t.skinnedMesh){return new PN(e,t.skinnedMesh,n)}return new Oi}static addCustomMesh(t,e,n){if(t.mesh){return new EN(e,t.mesh,n)}return new Oi}static addBone(t,e){var n,i;if(!t.bone)return new Cl;const r=TN(e.scene,(null==(n=t.bone)?void 0:n.skeleton)??"",0).bones[t.bone.index];return r?(r.clear(),null==(i=r.initComponentSystem)||i.call(r),r):new Cl}static addNode3D(){const t=new Oi;return t.initComponentSystem(),t}static addBox(){return new qk}static addModel(t){const e=t.model;return new _N(e.modelUUID)}static addSphere(){return new iN}static addCylinder(){return new Zk}static addPlane(){return new tN}static addSprite(){return new lN}static addPerspectiveCamera(t){const e=t.perspectiveCamera;return new sN(e.fov,e.aspect,e.near,e.far)}static addAmbientLight(){return new uy}static addDirectionalLight(t){var e,n;return new Hk(null==(e=t.light)?void 0:e.color,null==(n=t.light)?void 0:n.intensity)}static addPointLight(t){var e,n;return new Vk(null==(e=t.light)?void 0:e.color,null==(n=t.light)?void 0:n.intensity)}static addSpotLight(t){var e,n;return new Xk(null==(e=t.light)?void 0:e.color,null==(n=t.light)?void 0:n.intensity)}static addHemisphereLight(t){const e=t.hemisphereLight;return new rN(null==e?void 0:e.color,null==e?void 0:e.groundColor,null==e?void 0:e.intensity)}static addQuarksParticle(t){const e=t.quarksParticle;return new SN(e.modelUUID)}}class DN{static checkValidColor(t){return/^#[0-9A-F]{6}$/i.test(t)}static initSolidTexture(t){if(!this.checkValidColor(t))return null;const e=document.createElement("canvas"),n=e.getContext("2d");e.width=512,e.height=512,n.fillStyle=t,n.fillRect(0,0,e.width,e.height);const i=new Rh(e);return i.wrapS=it,i.wrapT=it,i.repeat.set(1,1),i.colorSpace=ye,i}static initGradientTexture(t,e){if(!this.checkValidColor(t)||!this.checkValidColor(e))return null;const n=document.createElement("canvas"),i=n.getContext("2d");n.width=512,n.height=512;const r=i.createLinearGradient(0,0,0,n.height);r.addColorStop(0,t),r.addColorStop(1,e),i.fillStyle=r,i.fillRect(0,0,n.width,n.height);const s=new Rh(n);return s.wrapS=it,s.wrapT=it,s.repeat.set(1,1),s}static getImageBg(t){const e=cy.get(t);return e?(e.colorSpace=ye,e):null}static async getHdrBg(t){const e=cy.get(t);return e?(e.mapping=tt,e):null}static async getCubeMapBg(t){const e=cy.get(t);return e?(e.mapping=Q,e):null}static getEnvironmentMap(t){const e=cy.get(t);return e?(e.mapping=e instanceof Jr?Q:tt,e):null}static resizeTexture(t,e,n){if(!t)return;if(!e||!n)return;const i=e,r=n;if(!t.image)return;t.wrapS=it,t.wrapT=it;const s=t.image.width/t.image.height/(i/r);t.offset.x=s>1?(1-1/s)/2:0,t.repeat.x=s>1?1/s:1,t.offset.y=s>1?0:(1-s)/2,t.repeat.y=s>1?1:s,t.needsUpdate=!0}}class BN{static addObject(t,e){t.sID||(t.sID=t.id.toString());const n=t.sID;if(!n)throw new Error("Object ID is not set");if(this.objects.set(n,t),this.objectByScene.has(e)||this.objectByScene.set(e,[]),t.parentScene){const e=t.parentScene;this.objectByScene.get(e).splice(this.objectByScene.get(e).indexOf(t),1)}this.objectByScene.get(e).push(t),t.parentScene=e}static removeObject(t){t&&t.destroy()}static removeFromList(t){if(!t)return;const e=this.objects.delete(t.sID);if(e){const e=t.parentScene;e&&this.objectByScene.get(e).splice(this.objectByScene.get(e).indexOf(t),1),t.parentScene=null}return e}static removeObjectById(t){this.removeObject(this.objects.get(t))}static getObjectById(t){return this.objects.get(t)}static getObjectByName(t,e){let n,i;if(!e||(n=this.objectByScene.get(e),n)){n||(n=this.objects);for(const e of n.values())e.name===t&&(i=e);return i}}static getObjectByType(t,e){let n;if(!e||(n=this.objectByScene.get(e),n)){n||(n=this.objects);for(const e of n.values())if(e instanceof t)return e}}static getObjectsByType(t,e){let n;if(e&&(n=this.objectByScene.get(e),!n))return;n||(n=this.objects);const i=[];for(const r of n.values())r instanceof t&&i.push(r);return i}static getSceneObjects(t){return this.objectByScene.get(t)}static getNodeById(t){return this.objects.get(t)}static getObjects(){return this.objects}static DoNotDestroyOnLoad(t){WK.addPersistentGameObject(t)}}n(BN,"objects",new Map),n(BN,"objectByScene",new Map);class FN{constructor(t){n(this,"particleList",[]),n(this,"batchedRenderer"),n(this,"scene"),this.batchedRenderer=new Wg,this.scene=t,t.add(this.batchedRenderer)}add(t){if(this.particleList.includes(t))return;this.particleList.push(t);const e=t.emitterList;if(e&&e.length)for(const n of e)this.batchedRenderer.addSystem(n.system)}destroy(){for(const t of this.batchedRenderer.systemToBatchIndex)this.batchedRenderer.deleteSystem(t[0]);setTimeout(()=>{},1e3),this.particleList=[]}update(t){this.batchedRenderer.update(t)}}
/**
 * postprocessing v6.36.2 build Tue Sep 10 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var LN=.001,UN=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(t){"undefined"!=typeof document&&void 0!==document.hidden&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=t)}get delta(){return this._delta*LN}get fixedDelta(){return this._fixedDelta*LN}set fixedDelta(t){this._fixedDelta=1e3*t}get elapsed(){return this._elapsed*LN}update(t){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(void 0!==t?t:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(t){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},kN=(()=>{const t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),n=new vr;return n.setAttribute("position",new ar(t,3)),n.setAttribute("uv",new ar(e,2)),n})(),NN=class t{static get fullscreenGeometry(){return kN}constructor(t="Pass",e=new Ko,n=new Vr){this.name=t,this.renderer=null,this.scene=e,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const e=this.fullscreenMaterial;null!==e&&(e.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let n=this.screen;null!==n?n.material=e:(n=new Fr(t.fullscreenGeometry,e),n.frustumCulled=!1,null===this.scene&&(this.scene=new Ko),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,e=3200){}render(t,e,n,i,r){throw new Error("Render method not implemented!")}setSize(t,e){}initialize(t,e,n){}dispose(){for(const e of Object.keys(this)){const n=this[e];(n instanceof Mn||n instanceof Zi||n instanceof Sn||n instanceof t)&&this[e].dispose()}null!==this.fullscreenMaterial&&this.fullscreenMaterial.dispose()}},zN=class extends NN{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,n,i,r){const s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},GN="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",HN=class extends Hr{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Hd(null),opacity:new Hd(1)},blending:0,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <colorspace_fragment>\n#include <dithering_fragment>\n}",vertexShader:GN})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},VN=class extends NN{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new HN,this.needsSwap=!1,this.renderTarget=t,void 0===t&&(this.renderTarget=new Mn(1,1,{minFilter:ht,magFilter:ht,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,n,i,r){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,n){void 0!==n&&(this.renderTarget.texture.type=n,n!==dt?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":null!==t&&t.outputColorSpace===ye&&(this.renderTarget.texture.colorSpace=ye))}},XN=new qi,WN=class extends NN{constructor(t=!0,e=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,n){this.color=t,this.depth=e,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,n,i,r){const s=this.overrideClearColor,a=this.overrideClearAlpha,o=t.getClearAlpha(),l=null!==s,h=a>=0;l?(t.getClearColor(XN),t.setClearColor(s,h?a:o)):h&&t.setClearAlpha(a),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),l?t.setClearColor(XN,o):h&&t.setClearAlpha(o)}},jN=class extends NN{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new WN(!1,!1,!0),this.inverse=!1}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,n,i,r){const s=t.getContext(),a=t.state.buffers,o=this.scene,l=this.camera,h=this.clearPass,c=this.inverted?0:1,u=1-c;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,c,4294967295),a.stencil.setClear(u),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(t,null):(h.render(t,e),h.render(t,n))),this.renderToScreen?(t.setRenderTarget(null),t.render(o,l)):(t.setRenderTarget(e),t.render(o,l),t.setRenderTarget(n),t.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},YN=class{constructor(t=null,{depthBuffer:e=!0,stencilBuffer:n=!1,multisampling:i=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,n,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new VN,this.depthTexture=null,this.passes=[],this.timer=new UN,this.autoRenderToScreen=!0,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){const e=this.inputBuffer,n=this.multisampling;n>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,t),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){if(this.renderer=t,null!==t){const e=t.getSize(new Qe),n=t.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===dt&&t.outputColorSpace===ye&&(this.inputBuffer.texture.colorSpace=ye,this.outputBuffer.texture.colorSpace=ye,this.inputBuffer.dispose(),this.outputBuffer.dispose()),t.autoClear=!1,this.setSize(e.width,e.height);for(const r of this.passes)r.initialize(t,n,i)}}replaceRenderer(t,e=!0){const n=this.renderer,i=n.domElement.parentNode;return this.setRenderer(t),e&&null!==i&&(i.removeChild(n.domElement),i.appendChild(t.domElement)),n}createDepthTexture(){const t=this.depthTexture=new Ws;return this.inputBuffer.depthTexture=t,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(t.format=wt,t.type=bt):t.type=mt,t}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const t of this.passes)t.setDepthTexture(null)}}createBuffer(t,e,n,i){const r=this.renderer,s=null===r?new Qe:r.getDrawingBufferSize(new Qe),a={minFilter:ht,magFilter:ht,stencilBuffer:e,depthBuffer:t,type:n},o=new Mn(s.width,s.height,a);return i>0&&(o.ignoreDepthForMultisampleCopy=!1,o.samples=i),n===dt&&null!==r&&r.outputColorSpace===ye&&(o.texture.colorSpace=ye),o.texture.name="EffectComposer.Buffer",o.texture.generateMipmaps=!1,o}setMainScene(t){for(const e of this.passes)e.mainScene=t}setMainCamera(t){for(const e of this.passes)e.mainCamera=t}addPass(t,e){const n=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new Qe),s=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(t.setRenderer(i),t.setSize(r.width,r.height),t.initialize(i,s,a),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==e?n.splice(e,0,t):n.push(t),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),t.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){const e=this.createDepthTexture();for(t of n)t.setDepthTexture(e)}else t.setDepthTexture(this.depthTexture)}removePass(t){const e=this.passes,n=e.indexOf(t);if(-1!==n&&e.splice(n,1).length>0){if(null!==this.depthTexture){const n=(t,e)=>t||e.needsDepthTexture;e.reduce(n,!1)||(t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&n===e.length&&(t.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const t=this.passes;this.deleteDepthTexture(),t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){const e=this.renderer,n=this.copyPass;let i,r,s,a=this.inputBuffer,o=this.outputBuffer,l=!1;void 0===t&&(this.timer.update(),t=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(e,a,o,t,l),h.needsSwap&&(l&&(n.renderToScreen=h.renderToScreen,i=e.getContext(),r=e.state.buffers.stencil,r.setFunc(i.NOTEQUAL,1,4294967295),n.render(e,a,o,t,l),r.setFunc(i.EQUAL,1,4294967295)),s=a,a=o,o=s),h instanceof jN?l=!0:h instanceof zN&&(l=!1))}setSize(t,e,n){const i=this.renderer,r=i.getSize(new Qe);void 0!==t&&void 0!==e||(t=r.width,e=r.height),r.width===t&&r.height===e||i.setSize(t,e,n);const s=i.getDrawingBufferSize(new Qe);this.inputBuffer.setSize(s.width,s.height),this.outputBuffer.setSize(s.width,s.height);for(const a of this.passes)a.setSize(s.width,s.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const t of this.passes)t.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),NN.fullscreenGeometry.dispose()}},qN=0,KN=1,JN=2,ZN={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},QN=class{constructor(){this.shaderParts=new Map([[ZN.FRAGMENT_HEAD,null],[ZN.FRAGMENT_MAIN_UV,null],[ZN.FRAGMENT_MAIN_IMAGE,null],[ZN.VERTEX_HEAD,null],[ZN.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=qN,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=xe}},$N=!1,tz=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let e;if(t.material.flatShading)switch(t.material.side){case 2:e=this.materialsFlatShadedDoubleSide;break;case 1:e=this.materialsFlatShadedBackSide;break;default:e=this.materialsFlatShaded}else switch(t.material.side){case 2:e=this.materialsDoubleSide;break;case 1:e=this.materialsBackSide;break;default:e=this.materials}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=e[2]:t.isInstancedMesh?t.material=e[1]:t.material=e[0],++this.meshCount}}}cloneMaterial(t){if(!(t instanceof Hr))return t.clone();const e=t.uniforms,n=new Map;for(const r in e){const t=e[r].value;t.isRenderTargetTexture&&(e[r].value=null,n.set(r,t))}const i=t.clone();for(const r of n)e[r[0]].value=r[1],i.uniforms[r[0]].value=r[1];return i}setMaterial(t){if(this.disposeMaterials(),this.material=t,null!==t){const e=this.materials=[this.cloneMaterial(t),this.cloneMaterial(t),this.cloneMaterial(t)];for(const n of e)n.uniforms=Object.assign({},t.uniforms),n.side=0;e[2].skinning=!0,this.materialsBackSide=e.map(e=>{const n=this.cloneMaterial(e);return n.uniforms=Object.assign({},t.uniforms),n.side=1,n}),this.materialsDoubleSide=e.map(e=>{const n=this.cloneMaterial(e);return n.uniforms=Object.assign({},t.uniforms),n.side=2,n}),this.materialsFlatShaded=e.map(e=>{const n=this.cloneMaterial(e);return n.uniforms=Object.assign({},t.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=e.map(e=>{const n=this.cloneMaterial(e);return n.uniforms=Object.assign({},t.uniforms),n.flatShading=!0,n.side=1,n}),this.materialsFlatShadedDoubleSide=e.map(e=>{const n=this.cloneMaterial(e);return n.uniforms=Object.assign({},t.uniforms),n.flatShading=!0,n.side=2,n})}}render(t,e,n){const i=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,$N){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,n);for(const t of i)t[0].material=t[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,n),e.overrideMaterial=i}t.shadowMap.enabled=i}disposeMaterials(){if(null!==this.material){const t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return $N}static set workaroundEnabled(t){$N=t}},ez=-1,nz=class extends ze{constructor(t,e=-1,n=-1,i=1){super(),this.resizable=t,this.baseSize=new Qe(1,1),this.preferredSize=new Qe(e,n),this.target=this.preferredSize,this.s=i,this.effectiveSize=new Qe,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const t=this.baseSize,e=this.preferredSize,n=this.effectiveSize,i=this.scale;e.width!==ez?n.width=e.width:e.height!==ez?n.width=Math.round(e.height*(t.width/Math.max(t.height,1))):n.width=Math.round(t.width*i),e.height!==ez?n.height=e.height:e.width!==ez?n.height=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):n.height=Math.round(t.height*i)}get width(){return this.effectiveSize.width}set width(t){this.preferredWidth=t}get height(){return this.effectiveSize.height}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferredSize.setScalar(ez),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.baseSize.width}set baseWidth(t){this.baseSize.width!==t&&(this.baseSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(t){this.baseWidth=t}get baseHeight(){return this.baseSize.height}set baseHeight(t){this.baseSize.height!==t&&(this.baseSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){this.baseSize.width===t&&this.baseSize.height===e||(this.baseSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(t){this.preferredSize.width!==t&&(this.preferredSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferredSize.height}set preferredHeight(t){this.preferredSize.height!==t&&(this.preferredSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){this.preferredSize.width===t&&this.preferredSize.height===e||(this.preferredSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(t){this.s=t.scale,this.baseSize.set(t.baseWidth,t.baseHeight),this.preferredSize.set(t.preferredWidth,t.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return ez}},iz=new class{constructor(t=0){this.nextId=t}getNextId(){return this.nextId++}reset(t=0){return this.nextId=t,this}}(2),rz=class extends Set{constructor(t,e=iz.getNextId()){super(),this.exclusive=!1,this._layer=e,(this._layer<1||this._layer>31)&&(iz.reset(2),this._layer=iz.getNextId()),void 0!==t&&this.set(t)}get layer(){return this._layer}set layer(t){const e=this._layer;for(const n of this)n.layers.disable(e),n.layers.enable(t);this._layer=t}getLayer(){return this.layer}setLayer(t){this.layer=t}isExclusive(){return this.exclusive}setExclusive(t){this.exclusive=t}clear(){const t=this.layer;for(const e of this)e.layers.disable(t);return super.clear()}set(t){this.clear();for(const e of t)this.add(e);return this}indexOf(t){return this.has(t)?0:-1}add(t){return this.exclusive?t.layers.set(this.layer):t.layers.enable(this.layer),super.add(t)}delete(t){return this.has(t)&&t.layers.disable(this.layer),super.delete(t)}toggle(t){let e;return this.has(t)?(this.delete(t),e=!1):(this.add(t),e=!0),e}setVisible(t){for(const e of this)t?e.layers.enable(0):e.layers.disable(0);return this}},sz={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},az=new Map([[sz.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}"],[sz.ALPHA,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}"],[sz.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}"],[sz.COLOR,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[sz.COLOR_BURN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}"],[sz.COLOR_DODGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}"],[sz.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}"],[sz.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}"],[sz.DIVIDE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}"],[sz.DST,null],[sz.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}"],[sz.HARD_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}"],[sz.HARD_MIX,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}"],[sz.HUE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}"],[sz.INVERT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}"],[sz.INVERT_RGB,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}"],[sz.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}"],[sz.LINEAR_BURN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}"],[sz.LINEAR_DODGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}"],[sz.LINEAR_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}"],[sz.LUMINOSITY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[sz.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}"],[sz.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}"],[sz.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}"],[sz.OVERLAY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}"],[sz.PIN_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}"],[sz.REFLECT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}"],[sz.SATURATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[sz.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}"],[sz.SOFT_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}"],[sz.SRC,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}"],[sz.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}"],[sz.VIVID_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}"]]),oz=class extends ze{constructor(t,e=1){super(),this._blendFunction=t,this.opacity=new Hd(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this._blendFunction}set blendFunction(t){this._blendFunction=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return az.get(this.blendFunction)}},lz=2,hz=3,cz=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],uz=class extends Hr{constructor(t=new wn){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Hd(null),texelSize:new Hd(new wn),scale:new Hd(1),kernel:new Hd(0)},blending:0,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.setTexelSize(t.x,t.y),this.kernelSize=lz}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.inputBuffer=t}get kernelSequence(){return cz[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(){return this.uniforms.scale.value}setScale(t){this.uniforms.scale.value=t}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(t){this.uniforms.kernel.value=t}setKernel(t){this.kernel=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e,.5*t,.5*e)}setSize(t,e){const n=1/t,i=1/e;this.uniforms.texelSize.value.set(n,i,.5*n,.5*i)}},dz=class extends NN{constructor({kernelSize:t=lz,resolutionScale:e=.5,width:n=nz.AUTO_SIZE,height:i=nz.AUTO_SIZE,resolutionX:r=n,resolutionY:s=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Mn(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new nz(this,r,s,e);a.addEventListener("change",t=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new uz,this._blurMaterial.kernelSize=t,this.copyMaterial=new HN}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(t){this._blurMaterial=t}get dithering(){return this.copyMaterial.dithering}set dithering(t){this.copyMaterial.dithering=t}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(t){this.blurMaterial.kernelSize=t}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get scale(){return this.blurMaterial.scale}set scale(t){this.blurMaterial.scale=t}getScale(){return this.blurMaterial.scale}setScale(t){this.blurMaterial.scale=t}getKernelSize(){return this.kernelSize}setKernelSize(t){this.kernelSize=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,n,i,r){const s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,h=this.blurMaterial,c=h.kernelSequence;let u=e;this.fullscreenMaterial=h;for(let d=0,p=c.length;d<p;++d){const e=1&d?l:o;h.kernel=c[d],h.inputBuffer=u.texture,t.setRenderTarget(e),t.render(s,a),u=e}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=u.texture,t.setRenderTarget(this.renderToScreen?null:n),t.render(s,a)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e);const i=n.width,r=n.height;this.renderTargetA.setSize(i,r),this.renderTargetB.setSize(i,r),this.blurMaterial.setSize(t,e)}initialize(t,e,n){void 0!==n&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==dt?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):null!==t&&t.outputColorSpace===ye&&(this.renderTargetA.texture.colorSpace=ye,this.renderTargetB.texture.colorSpace=ye))}static get AUTO_SIZE(){return nz.AUTO_SIZE}},pz=class extends Hr{constructor(t=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:M.replace(/\D+/g,"")},uniforms:{inputBuffer:new Hd(null),threshold:new Hd(0),smoothing:new Hd(1),range:new Hd(null)},blending:0,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l)*l;\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:GN}),this.colorOutput=t,this.luminanceRange=e}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get threshold(){return this.uniforms.threshold.value}set threshold(t){this.smoothing>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=t}getThreshold(){return this.threshold}setThreshold(t){this.threshold=t}get smoothing(){return this.uniforms.smoothing.value}set smoothing(t){this.threshold>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=t}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(t){this.smoothing=t}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(t){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(t){return this.colorOutput}setColorOutputEnabled(t){this.colorOutput=t}get useRange(){return null!==this.luminanceRange}set useRange(t){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(t){null!==t?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=t,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(t){this.luminanceRange=t}},fz=class extends NN{constructor({renderTarget:t,luminanceRange:e,colorOutput:n,resolutionScale:i=1,width:r=nz.AUTO_SIZE,height:s=nz.AUTO_SIZE,resolutionX:a=r,resolutionY:o=s}={}){super("LuminancePass"),this.fullscreenMaterial=new pz(n,e),this.needsSwap=!1,this.renderTarget=t,void 0===this.renderTarget&&(this.renderTarget=new Mn(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new nz(this,a,o,i);l.addEventListener("change",t=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(t,e,n,i,r){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height)}initialize(t,e,n){void 0!==n&&n!==dt&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},mz=class extends Hr{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Hd(null),texelSize:new Hd(new Qe)},blending:0,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#define WEIGHT_INNER 0.125\n#define WEIGHT_OUTER 0.0555555\nvarying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},gz=class extends Hr{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Hd(null),supportBuffer:new Hd(null),texelSize:new Hd(new Qe),radius:new Hd(.85)},blending:0,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;\n#else\nuniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;\n#endif\nuniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}"})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}set supportBuffer(t){this.uniforms.supportBuffer.value=t}get radius(){return this.uniforms.radius.value}set radius(t){this.uniforms.radius.value=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},vz=class extends NN{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Mn(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new mz,this.upsamplingMaterial=new gz,this.resolution=new Qe}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(t){if(this.levels!==t){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let n=0;n<t;++n){const t=e.clone();t.texture.name="Downsampling.Mipmap"+n,this.downsamplingMipmaps.push(t)}this.upsamplingMipmaps.push(e);for(let n=1,i=t-1;n<i;++n){const t=e.clone();t.texture.name="Upsampling.Mipmap"+n,this.upsamplingMipmaps.push(t)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(t){this.upsamplingMaterial.radius=t}render(t,e,n,i,r){const{scene:s,camera:a}=this,{downsamplingMaterial:o,upsamplingMaterial:l}=this,{downsamplingMipmaps:h,upsamplingMipmaps:c}=this;let u=e;this.fullscreenMaterial=o;for(let d=0,p=h.length;d<p;++d){const e=h[d];o.setSize(u.width,u.height),o.inputBuffer=u.texture,t.setRenderTarget(e),t.render(s,a),u=e}this.fullscreenMaterial=l;for(let d=c.length-1;d>=0;--d){const e=c[d];l.setSize(u.width,u.height),l.inputBuffer=u.texture,l.supportBuffer=h[d].texture,t.setRenderTarget(e),t.render(s,a),u=e}}setSize(t,e){const n=this.resolution;n.set(t,e);let i=n.width,r=n.height;for(let s=0,a=this.downsamplingMipmaps.length;s<a;++s)i=Math.round(.5*i),r=Math.round(.5*r),this.downsamplingMipmaps[s].setSize(i,r),s<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[s].setSize(i,r)}initialize(t,e,n){if(void 0!==n){const e=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const t of e)t.texture.type=n;if(n!==dt)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(null!==t&&t.outputColorSpace===ye)for(const t of e)t.texture.colorSpace=ye}}dispose(){super.dispose();for(const t of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))t.dispose()}},yz=class extends ze{constructor(t,e,{attributes:n=qN,blendFunction:i=sz.NORMAL,defines:r=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=t,this.renderer=null,this.attributes=n,this.fragmentShader=e,this.vertexShader=o,this.defines=r,this.uniforms=s,this.extensions=a,this.blendMode=new oz(i),this.blendMode.addEventListener("change",t=>this.setChanged()),this._inputColorSpace=xe,this._outputColorSpace=ve}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(t){this._inputColorSpace=t,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t,this.setChanged()}set mainScene(t){}set mainCamera(t){}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=3200){}update(t,e,n){}setSize(t,e){}initialize(t,e,n){}dispose(){for(const t of Object.keys(this)){const e=this[t];(e instanceof Mn||e instanceof Zi||e instanceof Sn||e instanceof NN)&&this[t].dispose()}}},xz=class extends yz{constructor({blendFunction:t=sz.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:n=.025,mipmapBlur:i=!1,intensity:r=1,radius:s=.85,levels:a=8,kernelSize:o=hz,resolutionScale:l=.5,width:h=nz.AUTO_SIZE,height:c=nz.AUTO_SIZE,resolutionX:u=h,resolutionY:d=c}={}){super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}",{blendFunction:t,uniforms:new Map([["map",new Hd(null)],["intensity",new Hd(r)]])}),this.renderTarget=new Mn(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new dz({kernelSize:o}),this.luminancePass=new fz({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=n,this.mipmapBlurPass=new vz,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=s,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const p=this.resolution=new nz(this,u,d,l);p.addEventListener("change",t=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return 1}set distinction(t){}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,n){const i=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(t,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(t,r.renderTarget):this.blurPass.render(t,r.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(t,e):this.blurPass.render(t,e,i)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n),this.luminancePass.setSize(t,e),this.mipmapBlurPass.setSize(t,e)}initialize(t,e,n){this.blurPass.initialize(t,e,n),this.luminancePass.initialize(t,e,n),this.mipmapBlurPass.initialize(t,e,n),void 0!==n&&(this.renderTarget.texture.type=n,null!==t&&t.outputColorSpace===ye&&(this.renderTarget.texture.colorSpace=ye))}},bz=class extends NN{constructor(t,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=t,this.input=e}setInput(t){this.input=t}render(t,e,n,i,r){const s=this.fullscreenMaterial.uniforms;null!==e&&void 0!==s&&void 0!==s[this.input]&&(s[this.input].value=e.texture),t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}initialize(t,e,n){void 0!==n&&n!==dt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},_z=class extends yz{constructor({blendFunction:t=sz.SRC}={}){super("FXAAEffect","#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\n#define ONE_OVER_TWELVE 0.08333333333333333\nvarying vec2 vUvDown;varying vec2 vUvUp;varying vec2 vUvLeft;varying vec2 vUvRight;varying vec2 vUvDownLeft;varying vec2 vUvUpRight;varying vec2 vUvUpLeft;varying vec2 vUvDownRight;vec4 fxaa(const in vec4 inputColor,const in vec2 uv){float lumaCenter=luminance(inputColor.rgb);float lumaDown=luminance(texture2D(inputBuffer,vUvDown).rgb);float lumaUp=luminance(texture2D(inputBuffer,vUvUp).rgb);float lumaLeft=luminance(texture2D(inputBuffer,vUvLeft).rgb);float lumaRight=luminance(texture2D(inputBuffer,vUvRight).rgb);float lumaMin=min(lumaCenter,min(min(lumaDown,lumaUp),min(lumaLeft,lumaRight)));float lumaMax=max(lumaCenter,max(max(lumaDown,lumaUp),max(lumaLeft,lumaRight)));float lumaRange=lumaMax-lumaMin;if(lumaRange<max(EDGE_THRESHOLD_MIN,lumaMax*EDGE_THRESHOLD_MAX)){return inputColor;}float lumaDownLeft=luminance(texture2D(inputBuffer,vUvDownLeft).rgb);float lumaUpRight=luminance(texture2D(inputBuffer,vUvUpRight).rgb);float lumaUpLeft=luminance(texture2D(inputBuffer,vUvUpLeft).rgb);float lumaDownRight=luminance(texture2D(inputBuffer,vUvDownRight).rgb);float lumaDownUp=lumaDown+lumaUp;float lumaLeftRight=lumaLeft+lumaRight;float lumaLeftCorners=lumaDownLeft+lumaUpLeft;float lumaDownCorners=lumaDownLeft+lumaDownRight;float lumaRightCorners=lumaDownRight+lumaUpRight;float lumaUpCorners=lumaUpRight+lumaUpLeft;float edgeHorizontal=(abs(-2.0*lumaLeft+lumaLeftCorners)+abs(-2.0*lumaCenter+lumaDownUp)*2.0+abs(-2.0*lumaRight+lumaRightCorners));float edgeVertical=(abs(-2.0*lumaUp+lumaUpCorners)+abs(-2.0*lumaCenter+lumaLeftRight)*2.0+abs(-2.0*lumaDown+lumaDownCorners));bool isHorizontal=(edgeHorizontal>=edgeVertical);float stepLength=isHorizontal?texelSize.y:texelSize.x;float luma1=isHorizontal?lumaDown:lumaLeft;float luma2=isHorizontal?lumaUp:lumaRight;float gradient1=abs(luma1-lumaCenter);float gradient2=abs(luma2-lumaCenter);bool is1Steepest=gradient1>=gradient2;float gradientScaled=0.25*max(gradient1,gradient2);float lumaLocalAverage=0.0;if(is1Steepest){stepLength=-stepLength;lumaLocalAverage=0.5*(luma1+lumaCenter);}else{lumaLocalAverage=0.5*(luma2+lumaCenter);}vec2 currentUv=uv;if(isHorizontal){currentUv.y+=stepLength*0.5;}else{currentUv.x+=stepLength*0.5;}vec2 offset=isHorizontal?vec2(texelSize.x,0.0):vec2(0.0,texelSize.y);vec2 uv1=currentUv-offset*QUALITY(0);vec2 uv2=currentUv+offset*QUALITY(0);float lumaEnd1=luminance(texture2D(inputBuffer,uv1).rgb);float lumaEnd2=luminance(texture2D(inputBuffer,uv2).rgb);lumaEnd1-=lumaLocalAverage;lumaEnd2-=lumaLocalAverage;bool reached1=abs(lumaEnd1)>=gradientScaled;bool reached2=abs(lumaEnd2)>=gradientScaled;bool reachedBoth=reached1&&reached2;if(!reached1){uv1-=offset*QUALITY(1);}if(!reached2){uv2+=offset*QUALITY(1);}if(!reachedBoth){for(int i=2;i<SAMPLES;++i){if(!reached1){lumaEnd1=luminance(texture2D(inputBuffer,uv1).rgb);lumaEnd1=lumaEnd1-lumaLocalAverage;}if(!reached2){lumaEnd2=luminance(texture2D(inputBuffer,uv2).rgb);lumaEnd2=lumaEnd2-lumaLocalAverage;}reached1=abs(lumaEnd1)>=gradientScaled;reached2=abs(lumaEnd2)>=gradientScaled;reachedBoth=reached1&&reached2;if(!reached1){uv1-=offset*QUALITY(i);}if(!reached2){uv2+=offset*QUALITY(i);}if(reachedBoth){break;}}}float distance1=isHorizontal?(uv.x-uv1.x):(uv.y-uv1.y);float distance2=isHorizontal?(uv2.x-uv.x):(uv2.y-uv.y);bool isDirection1=distance1<distance2;float distanceFinal=min(distance1,distance2);float edgeThickness=(distance1+distance2);bool isLumaCenterSmaller=lumaCenter<lumaLocalAverage;bool correctVariation1=(lumaEnd1<0.0)!=isLumaCenterSmaller;bool correctVariation2=(lumaEnd2<0.0)!=isLumaCenterSmaller;bool correctVariation=isDirection1?correctVariation1:correctVariation2;float pixelOffset=-distanceFinal/edgeThickness+0.5;float finalOffset=correctVariation?pixelOffset:0.0;float lumaAverage=ONE_OVER_TWELVE*(2.0*(lumaDownUp+lumaLeftRight)+lumaLeftCorners+lumaRightCorners);float subPixelOffset1=clamp(abs(lumaAverage-lumaCenter)/lumaRange,0.0,1.0);float subPixelOffset2=(-2.0*subPixelOffset1+3.0)*subPixelOffset1*subPixelOffset1;float subPixelOffsetFinal=subPixelOffset2*subPixelOffset2*SUBPIXEL_QUALITY;finalOffset=max(finalOffset,subPixelOffsetFinal);vec2 finalUv=uv;if(isHorizontal){finalUv.y+=finalOffset*stepLength;}else{finalUv.x+=finalOffset*stepLength;}return texture2D(inputBuffer,finalUv);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=fxaa(inputColor,uv);}",{vertexShader:"varying vec2 vUvDown;varying vec2 vUvUp;varying vec2 vUvLeft;varying vec2 vUvRight;varying vec2 vUvDownLeft;varying vec2 vUvUpRight;varying vec2 vUvUpLeft;varying vec2 vUvDownRight;void mainSupport(const in vec2 uv){vUvDown=uv+vec2(0.0,-1.0)*texelSize;vUvUp=uv+vec2(0.0,1.0)*texelSize;vUvRight=uv+vec2(1.0,0.0)*texelSize;vUvLeft=uv+vec2(-1.0,0.0)*texelSize;vUvDownLeft=uv+vec2(-1.0,-1.0)*texelSize;vUvUpRight=uv+vec2(1.0,1.0)*texelSize;vUvUpLeft=uv+vec2(-1.0,1.0)*texelSize;vUvDownRight=uv+vec2(1.0,-1.0)*texelSize;}",blendFunction:t,defines:new Map([["EDGE_THRESHOLD_MIN","0.0312"],["EDGE_THRESHOLD_MAX","0.125"],["SUBPIXEL_QUALITY","0.75"],["SAMPLES","12"]])})}get minEdgeThreshold(){return Number(this.defines.get("EDGE_THRESHOLD_MIN"))}set minEdgeThreshold(t){this.defines.set("EDGE_THRESHOLD_MIN",t.toFixed(12)),this.setChanged()}get maxEdgeThreshold(){return Number(this.defines.get("EDGE_THRESHOLD_MAX"))}set maxEdgeThreshold(t){this.defines.set("EDGE_THRESHOLD_MAX",t.toFixed(12)),this.setChanged()}get subpixelQuality(){return Number(this.defines.get("SUBPIXEL_QUALITY"))}set subpixelQuality(t){this.defines.set("SUBPIXEL_QUALITY",t.toFixed(12)),this.setChanged()}get samples(){return Number(this.defines.get("SAMPLES"))}set samples(t){this.defines.set("SAMPLES",t.toFixed(0)),this.setChanged()}},Sz=1,wz=2,Tz=class extends Hr{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:Sz},uniforms:{inputBuffer:new Hd(null),depthBuffer0:new Hd(null),depthBuffer1:new Hd(null),cameraNearFar:new Hd(new Qe(1,1))},blending:0,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;\n#else\nuniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;\n#endif\nuniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#endif\n}varying vec2 vUv;void main(){vec2 depth;\n#if DEPTH_PACKING_0 == 3201\ndepth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));\n#else\ndepth.x=texture2D(depthBuffer0,vUv).r;\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;\n#endif\n#endif\n#if DEPTH_PACKING_1 == 3201\ndepth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));\n#else\ndepth.y=texture2D(depthBuffer1,vUv).r;\n#ifdef LOG_DEPTH\nfloat d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;\n#endif\n#endif\nbool isMaxDepth=(depth.x==1.0);\n#ifdef PERSPECTIVE_CAMERA\ndepth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);\n#endif\n#if DEPTH_TEST_STRATEGY == 0\nbool keep=depthTest(depth.x,depth.y);\n#elif DEPTH_TEST_STRATEGY == 1\nbool keep=isMaxDepth||depthTest(depth.x,depth.y);\n#else\nbool keep=!isMaxDepth&&depthTest(depth.x,depth.y);\n#endif\nif(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}",vertexShader:GN}),this.depthMode=2}set depthBuffer0(t){this.uniforms.depthBuffer0.value=t}set depthPacking0(t){this.defines.DEPTH_PACKING_0=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(t,e=3200){this.depthBuffer0=t,this.depthPacking0=e}set depthBuffer1(t){this.uniforms.depthBuffer1.value=t}set depthPacking1(t){this.defines.DEPTH_PACKING_1=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(t,e=3200){this.depthBuffer1=t,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(t){this.defines.DEPTH_TEST_STRATEGY=t.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(t){this.maxDepthStrategy=t?Sz:wz}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(t){this.maxDepthStrategy=t}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(t){this.defines.DEPTH_EPSILON=t.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(t){this.epsilon=t}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(t){let e;switch(t){case 0:e="false";break;case 1:e="true";break;case 4:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case 7:e="abs(d1 - d0) > DEPTH_EPSILON";break;case 2:e="d0 > d1";break;case 3:e="d0 >= d1";break;case 5:e="d0 <= d1";break;default:e="d0 < d1"}this.defines.DEPTH_MODE=t.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(t){this.depthMode=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){t&&(this.uniforms.cameraNearFar.value.set(t.near,t.far),t instanceof Yr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Mz=class extends NN{constructor(t,e,n=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new WN,this.overrideMaterialManager=null===n?null:new tz(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){const t=this.overrideMaterialManager;return null!==t?t.material:null}set overrideMaterial(t){const e=this.overrideMaterialManager;null!==t?null!==e?e.setMaterial(t):this.overrideMaterialManager=new tz(t):null!==e&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,n,i,r){const s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,h=s.background,c=t.shadowMap.autoUpdate,u=this.renderToScreen?null:e;null!==o&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(u),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(t,s,a):t.render(s,a),a.layers.mask=l,s.background=h,t.shadowMap.autoUpdate=c}},Az=0,Ez=1,Cz=2,Pz=3,Rz=5,Iz=5,Oz=6,Dz=7,Bz=8,Fz=class extends NN{constructor(t,e,{renderTarget:n,resolutionScale:i=1,width:r=nz.AUTO_SIZE,height:s=nz.AUTO_SIZE,resolutionX:a=r,resolutionY:o=s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Mz(t,e,new Ro({depthPacking:ge}));const l=this.renderPass;l.skipShadowMapUpdate=!0,l.ignoreBackground=!0;const h=l.clearPass;h.overrideClearColor=new qi(16777215),h.overrideClearAlpha=1,this.renderTarget=n,void 0===this.renderTarget&&(this.renderTarget=new Mn(1,1,{minFilter:at,magFilter:at}),this.renderTarget.texture.name="DepthPass.Target");const c=this.resolution=new nz(this,a,o,i);c.addEventListener("change",t=>this.setSize(c.baseWidth,c.baseHeight))}set mainScene(t){this.renderPass.mainScene=t}set mainCamera(t){this.renderPass.mainCamera=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,n,i,r){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,s)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height)}},Lz=class extends xz{constructor(t,e,n){super(n),this.setAttributes(this.getAttributes()|KN),this.camera=e,this.depthPass=new Fz(t,e),this.clearPass=new WN(!0,!1,!1),this.clearPass.overrideClearColor=new qi(0),this.depthMaskPass=new bz(new Tz);const i=this.depthMaskMaterial;i.copyCameraSettings(e),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=ge,i.depthMode=4,this.renderTargetMasked=new Mn(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new rz,this._inverted=!1,this._ignoreBackground=!1}set mainScene(t){this.depthPass.mainScene=t}set mainCamera(t){this.camera=t,this.depthPass.mainCamera=t,this.depthMaskMaterial.copyCameraSettings(t)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(t){this._inverted=t,this.depthMaskMaterial.depthMode=t?7:4}isInverted(){return this.inverted}setInverted(t){this.inverted=t}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(t){this._ignoreBackground=t,this.depthMaskMaterial.maxDepthStrategy=t?wz:Sz}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}setDepthTexture(t,e=3200){this.depthMaskMaterial.depthBuffer0=t,this.depthMaskMaterial.depthPacking0=e}update(t,e,n){const i=this.camera,r=this.selection,s=this.inverted;let a=e;if(this.ignoreBackground||!s||r.size>0){const n=i.layers.mask;i.layers.set(r.layer),this.depthPass.render(t),i.layers.mask=n,a=this.renderTargetMasked,this.clearPass.render(t,a),this.depthMaskPass.render(t,e,a)}super.update(t,a,n)}setSize(t,e){super.setSize(t,e),this.renderTargetMasked.setSize(t,e),this.depthPass.setSize(t,e)}initialize(t,e,n){super.initialize(t,e,n),this.clearPass.initialize(t,e,n),this.depthPass.initialize(t,e,n),this.depthMaskPass.initialize(t,e,n),null!==t&&t.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),void 0!==n&&(this.renderTargetMasked.texture.type=n,null!==t&&t.outputColorSpace===ye&&(this.renderTargetMasked.texture.colorSpace=ye))}},Uz=class extends Hr{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Hd(null),luminanceBuffer1:new Hd(null),minLuminance:new Hd(.01),deltaTime:new Hd(0),tau:new Hd(1)},extensions:{shaderTextureLOD:!0},blending:0,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <packing>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\nuniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));\n#if __VERSION__ < 300\nfloat l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;\n#else\nfloat l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;\n#endif\nl0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}",vertexShader:GN})}set luminanceBuffer0(t){this.uniforms.luminanceBuffer0.value=t}setLuminanceBuffer0(t){this.uniforms.luminanceBuffer0.value=t}set luminanceBuffer1(t){this.uniforms.luminanceBuffer1.value=t}setLuminanceBuffer1(t){this.uniforms.luminanceBuffer1.value=t}set mipLevel1x1(t){this.defines.MIP_LEVEL_1X1=t.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(t){this.mipLevel1x1=t}set deltaTime(t){this.uniforms.deltaTime.value=t}setDeltaTime(t){this.uniforms.deltaTime.value=t}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(t){this.uniforms.minLuminance.value=t}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(t){this.uniforms.minLuminance.value=t}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(t){this.uniforms.tau.value=t}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(t){this.uniforms.tau.value=t}},kz=class extends NN{constructor(t,{minLuminance:e=.01,adaptationRate:n=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new Uz,this.needsSwap=!1,this.renderTargetPrevious=new Mn(1,1,{minFilter:at,magFilter:at,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const i=this.fullscreenMaterial;i.luminanceBuffer0=this.renderTargetPrevious.texture,i.luminanceBuffer1=t,i.minLuminance=e,i.adaptationRate=n,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new VN(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(t){this.fullscreenMaterial.mipLevel1x1=t}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(t){this.fullscreenMaterial.adaptationRate=t}render(t,e,n,i,r){this.fullscreenMaterial.deltaTime=i,t.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),t.render(this.scene,this.camera),this.copyPass.render(t,this.renderTargetAdapted)}},Nz=class extends yz{constructor({blendFunction:t=sz.SRC,adaptive:e=!1,mode:n=(e?Pz:Dz),resolution:i=256,maxLuminance:r=4,whitePoint:s=r,middleGrey:a=.6,minLuminance:o=.01,averageLuminance:l=1,adaptationRate:h=1}={}){super("ToneMappingEffect","#include <tonemapping_pars_fragment>\nuniform float whitePoint;\n#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3\nuniform float middleGrey;\n#if TONE_MAPPING_MODE == 3\nuniform lowp sampler2D luminanceBuffer;\n#else\nuniform float averageLuminance;\n#endif\nvec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);\n#if TONE_MAPPING_MODE == 3\nfloat lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));\n#else\nfloat lumAvg=averageLuminance;\n#endif\nfloat lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}\n#elif TONE_MAPPING_MODE == 4\n#define A 0.15\n#define B 0.50\n#define C 0.10\n#define D 0.20\n#define E 0.02\n#define F 0.30\nvec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}\n#endif\nvoid mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){\n#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3\noutputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);\n#elif TONE_MAPPING_MODE == 4\noutputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);\n#else\noutputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);\n#endif\n}",{blendFunction:t,uniforms:new Map([["luminanceBuffer",new Hd(null)],["maxLuminance",new Hd(r)],["whitePoint",new Hd(s)],["middleGrey",new Hd(a)],["averageLuminance",new Hd(l)]])}),this.renderTargetLuminance=new Mn(1,1,{minFilter:ut,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new fz({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new kz(this.luminancePass.texture,{minLuminance:o,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=i,this.mode=n}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(t){if(this.mode===t)return;const e=M.replace(/\D+/g,"")>=168?"CineonToneMapping(texel)":"OptimizedCineonToneMapping(texel)";switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",t.toFixed(0)),t){case Az:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case Ez:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case Iz:case Rz:this.defines.set("toneMapping(texel)",e);break;case Oz:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case Dz:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case Bz:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel")}this.adaptiveLuminancePass.enabled=t===Pz,this.setChanged()}getMode(){return this.mode}setMode(t){this.mode=t}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(t){this.uniforms.get("whitePoint").value=t}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(t){this.uniforms.get("middleGrey").value=t}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(t){this.uniforms.get("averageLuminance").value=t}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(t){const e=Math.max(0,Math.ceil(Math.log2(t))),n=Math.pow(2,e);this.luminancePass.resolution.setPreferredSize(n,n),this.adaptiveLuminanceMaterial.mipLevel1x1=e}getResolution(){return this.resolution}setResolution(t){this.resolution=t}get adaptive(){return this.mode===Pz}set adaptive(t){this.mode=t?Pz:Cz}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(t){this.adaptiveLuminanceMaterial.adaptationRate=t}get distinction(){return 1}set distinction(t){}update(t,e,n){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(t,e),this.adaptiveLuminancePass.render(t,null,null,n))}initialize(t,e,n){this.adaptiveLuminancePass.initialize(t,e,n)}},zz=class extends Hr{constructor(t,e,n,i,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:M.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Hd(null),depthBuffer:new Hd(null),resolution:new Hd(new Qe),texelSize:new Hd(new Qe),cameraNear:new Hd(.3),cameraFar:new Hd(1e3),aspect:new Hd(1),time:new Hd(0)},blending:0,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),t&&this.setShaderParts(t),e&&this.setDefines(e),n&&this.setUniforms(n),this.copyCameraSettings(i)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=3200){this.depthBuffer=t,this.depthPacking=e}setShaderData(t){this.setShaderParts(t.shaderParts),this.setDefines(t.defines),this.setUniforms(t.uniforms),this.setExtensions(t.extensions)}setShaderParts(t){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <colorspace_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(ZN.FRAGMENT_HEAD,t.get(ZN.FRAGMENT_HEAD)||"").replace(ZN.FRAGMENT_MAIN_UV,t.get(ZN.FRAGMENT_MAIN_UV)||"").replace(ZN.FRAGMENT_MAIN_IMAGE,t.get(ZN.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}".replace(ZN.VERTEX_HEAD,t.get(ZN.VERTEX_HEAD)||"").replace(ZN.VERTEX_MAIN_SUPPORT,t.get(ZN.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(t){for(const e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(const e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(const e of t)this.extensions[e]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof Yr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){const n=this.uniforms;n.resolution.value.set(t,e),n.texelSize.value.set(1/t,1/e),n.aspect.value=t/e}static get Section(){return ZN}};function Gz(t,e,n){for(const i of e){const e="$1"+t+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const t of n.entries())null!==t[1]&&n.set(t[0],t[1].replace(r,e))}}function Hz(t,e,n){let i=e.getFragmentShader(),r=e.getVertexShader();const s=void 0!==i&&/mainImage/.test(i),a=void 0!==i&&/mainUv/.test(i);if(n.attributes|=e.getAttributes(),void 0===i)throw new Error(`Missing fragment shader (${e.name})`);if(a&&0!==(n.attributes&JN))throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!a)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const o=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=n.shaderParts;let h=l.get(ZN.FRAGMENT_HEAD)||"",c=l.get(ZN.FRAGMENT_MAIN_UV)||"",u=l.get(ZN.FRAGMENT_MAIN_IMAGE)||"",d=l.get(ZN.VERTEX_HEAD)||"",p=l.get(ZN.VERTEX_MAIN_SUPPORT)||"";const f=new Set,m=new Set;if(a&&(c+=`\t${t}MainUv(UV);\n`,n.uvTransformation=!0),null!==r&&/mainSupport/.test(r)){const e=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);p+=`\t${t}MainSupport(`,p+=e?"vUv);\n":");\n";for(const t of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const e of t[1].split(/\s*,\s*/))n.varyings.add(e),f.add(e),m.add(e);for(const t of r.matchAll(o))m.add(t[1])}for(const t of i.matchAll(o))m.add(t[1]);for(const t of e.defines.keys())m.add(t.replace(/\([\w\s,]*\)/g,""));for(const t of e.uniforms.keys())m.add(t);m.delete("while"),m.delete("for"),m.delete("if"),e.uniforms.forEach((e,i)=>n.uniforms.set(t+i.charAt(0).toUpperCase()+i.slice(1),e)),e.defines.forEach((e,i)=>n.defines.set(t+i.charAt(0).toUpperCase()+i.slice(1),e));const g=new Map([["fragment",i],["vertex",r]]);Gz(t,m,n.defines),Gz(t,m,g),i=g.get("fragment"),r=g.get("vertex");const v=e.blendMode;if(n.blendModes.set(v.blendFunction,v),s){null!==e.inputColorSpace&&e.inputColorSpace!==n.colorSpace&&(u+=e.inputColorSpace===ye?"color0 = sRGBTransferOETF(color0);\n\t":"color0 = sRGBToLinear(color0);\n\t"),e.outputColorSpace!==ve?n.colorSpace=e.outputColorSpace:null!==e.inputColorSpace&&(n.colorSpace=e.inputColorSpace);const r=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;u+=`${t}MainImage(color0, UV, `,0!==(n.attributes&KN)&&r.test(i)&&(u+="depth, ",n.readDepth=!0),u+="color1);\n\t";const s=t+"BlendOpacity";n.uniforms.set(s,v.opacity),u+=`color0 = blend${v.blendFunction}(color0, color1, ${s});\n\n\t`,h+=`uniform float ${s};\n\n`}if(h+=i+"\n",null!==r&&(d+=r+"\n"),l.set(ZN.FRAGMENT_HEAD,h),l.set(ZN.FRAGMENT_MAIN_UV,c),l.set(ZN.FRAGMENT_MAIN_IMAGE,u),l.set(ZN.VERTEX_HEAD,d),l.set(ZN.VERTEX_MAIN_SUPPORT,p),null!==e.extensions)for(const t of e.extensions)n.extensions.add(t)}}var Vz=class extends NN{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new zz(null,null,null,t),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(t){for(const e of this.effects)e.mainScene=t}set mainCamera(t){this.fullscreenMaterial.copyCameraSettings(t);for(const e of this.effects)e.mainCamera=t}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){const e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}setEffects(t){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=t.sort((t,e)=>e.attributes-t.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const t=new QN;let e=0;for(const a of this.effects)if(a.blendMode.blendFunction===sz.DST)t.attributes|=a.getAttributes()&KN;else{if(0!==(t.attributes&a.getAttributes()&JN))throw new Error(`Convolution effects cannot be merged (${a.name})`);Hz("e"+e++,a,t)}let n=t.shaderParts.get(ZN.FRAGMENT_HEAD),i=t.shaderParts.get(ZN.FRAGMENT_MAIN_IMAGE),r=t.shaderParts.get(ZN.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const a of t.blendModes.values())n+=a.getShaderCode().replace(s,`blend${a.blendFunction}`)+"\n";0!==(t.attributes&KN)?(t.readDepth&&(i="float depth = readDepth(UV);\n\n\t"+i),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,t.colorSpace===ye&&(i+="color0 = sRGBToLinear(color0);\n\t"),t.uvTransformation?(r="vec2 transformedUv = vUv;\n"+r,t.defines.set("UV","transformedUv")):t.defines.set("UV","vUv"),t.shaderParts.set(ZN.FRAGMENT_HEAD,n),t.shaderParts.set(ZN.FRAGMENT_MAIN_IMAGE,i),t.shaderParts.set(ZN.FRAGMENT_MAIN_UV,r);for(const[a,o]of t.shaderParts)null!==o&&t.shaderParts.set(a,o.trim().replace(/^#/,"\n#"));this.skipRendering=0===e,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(t)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=3200){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(const n of this.effects)n.setDepthTexture(t,e)}render(t,e,n,i,r){for(const s of this.effects)s.update(t,e,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=i*this.timeScale,t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(const n of this.effects)n.setSize(t,e)}initialize(t,e,n){this.renderer=t;for(const i of this.effects)i.initialize(t,e,n);this.updateMaterial(),void 0!==n&&n!==dt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const t of this.effects)t.removeEventListener("change",this.listener),t.dispose()}handleEvent(t){if("change"===t.type)this.recompile()}};let Xz=(n(t=class{static get(){return this.eventEmitter}static on(t,e,n){return this.eventEmitter.on(t,e,n),this}static off(t,e,n){return this.eventEmitter.off(t,e,n),this}static once(t,e,n){return this.eventEmitter.once(t,e,n),this}static emit(t,...e){return this.eventEmitter.emit(t,...e),this}static removeAllListeners(t){return this.eventEmitter.removeAllListeners(t),this}static listenerCount(t){return this.eventEmitter.listenerCount(t)}static eventNames(){return this.eventEmitter.eventNames()}},"eventEmitter",Gk.getInstance()),t);function Wz(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function jz(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}
/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Yz,qz,Kz,Jz,Zz,Qz,$z,tG,eG,nG,iG,rG,sG,aG,oG,lG,hG,cG,uG,dG,pG,fG,mG,gG,vG,yG,xG,bG,_G,SG,wG,TG,MG={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},AG={duration:.5,overwrite:!1,delay:0},EG=1e8,CG=1e-8,PG=2*Math.PI,RG=PG/4,IG=0,OG=Math.sqrt,DG=Math.cos,BG=Math.sin,FG=function(t){return"string"==typeof t},LG=function(t){return"function"==typeof t},UG=function(t){return"number"==typeof t},kG=function(t){return void 0===t},NG=function(t){return"object"==typeof t},zG=function(t){return!1!==t},GG=function(){return"undefined"!=typeof window},HG=function(t){return LG(t)||FG(t)},VG="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},XG=Array.isArray,WG=/(?:-?\.?\d|\.)+/gi,jG=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,YG=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,qG=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,KG=/[+-]=-?[.\d]+/,JG=/[^,'"\[\]\s]+/gi,ZG=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,QG={},$G={},tH=function(t){return($G=PH(t,QG))&&PX},eH=function(t,e){},nH=function(t,e){return!e&&void 0},iH=function(t,e){return t&&(QG[t]=e)&&$G&&($G[t]=e)||QG},rH=function(){return 0},sH={suppressEvents:!0,isStart:!0,kill:!1},aH={suppressEvents:!0,kill:!1},oH={suppressEvents:!0},lH={},hH=[],cH={},uH={},dH={},pH=30,fH=[],mH="",gH=function(t){var e,n,i=t[0];if(NG(i)||LG(i)||(t=[t]),!(e=(i._gsap||{}).harness)){for(n=fH.length;n--&&!fH[n].targetTest(i););e=fH[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new VV(t[n],e)))||t.splice(n,1);return t},vH=function(t){return t._gsap||gH(aV(t))[0]._gsap},yH=function(t,e,n){return(n=t[e])&&LG(n)?t[e]():kG(n)&&t.getAttribute&&t.getAttribute(e)||n},xH=function(t,e){return(t=t.split(",")).forEach(e)||t},bH=function(t){return Math.round(1e5*t)/1e5||0},_H=function(t){return Math.round(1e7*t)/1e7||0},SH=function(t,e){var n=e.charAt(0),i=parseFloat(e.substr(2));return t=parseFloat(t),"+"===n?t+i:"-"===n?t-i:"*"===n?t*i:t/i},wH=function(t,e){for(var n=e.length,i=0;t.indexOf(e[i])<0&&++i<n;);return i<n},TH=function(){var t,e,n=hH.length,i=hH.slice(0);for(cH={},hH.length=0,t=0;t<n;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},MH=function(t,e,n,i){hH.length&&!qz&&TH(),t.render(e,n,qz&&e<0&&(t._initted||t._startAt)),hH.length&&!qz&&TH()},AH=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(JG).length<2?e:FG(t)?t.trim():t},EH=function(t){return t},CH=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},PH=function(t,e){for(var n in e)t[n]=e[n];return t},RH=function t(e,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(e[i]=NG(n[i])?t(e[i]||(e[i]={}),n[i]):n[i]);return e},IH=function(t,e){var n,i={};for(n in t)n in e||(i[n]=t[n]);return i},OH=function(t){var e,n=t.parent||Jz,i=t.keyframes?(e=XG(t.keyframes),function(t,n){for(var i in n)i in t||"duration"===i&&e||"ease"===i||(t[i]=n[i])}):CH;if(zG(t.inherit))for(;n;)i(t,n.vars.defaults),n=n.parent||n._dp;return t},DH=function(t,e,n,i,r){var s,a=t[i];if(r)for(s=e[r];a&&a[r]>s;)a=a._prev;return a?(e._next=a._next,a._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[i]=e,e._prev=a,e.parent=e._dp=t,e},BH=function(t,e,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=e._prev,s=e._next;r?r._next=s:t[n]===e&&(t[n]=s),s?s._prev=r:t[i]===e&&(t[i]=r),e._next=e._prev=e.parent=null},FH=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},LH=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},UH=function(t,e,n,i){return t._startAt&&(qz?t._startAt.revert(aH):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,i))},kH=function t(e){return!e||e._ts&&t(e.parent)},NH=function(t){return t._repeat?zH(t._tTime,t=t.duration()+t._rDelay)*t:0},zH=function(t,e){var n=Math.floor(t/=e);return t&&n===t?n-1:n},GH=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},HH=function(t){return t._end=_H(t._start+(t._tDur/Math.abs(t._ts||t._rts||CG)||0))},VH=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=_H(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),HH(t),n._dirty||LH(n,t)),t},XH=function(t,e){var n;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(n=GH(t.rawTime(),e),(!e._dur||nV(0,e.totalDuration(),n)-e._tTime>CG)&&e.render(n,!0)),LH(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},WH=function(t,e,n,i){return e.parent&&FH(e),e._start=_H((UG(n)?n:n||t!==Jz?$H(t,n,e):t._time)+e._delay),e._end=_H(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),DH(t,e,"_first","_last",t._sort?"_start":0),KH(e)||(t._recent=e),i||XH(t,e),t._ts<0&&VH(t,t._tTime),t},jH=function(t,e){return QG.ScrollTrigger?QG.ScrollTrigger.create(e,t):void 0},YH=function(t,e,n,i,r){return ZV(t,e,r),t._initted?!n&&t._pt&&!qz&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&eG!==RV.frame?(hH.push(t),t._lazy=[r,i],1):void 0:1},qH=function t(e){var n=e.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||t(n))},KH=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},JH=function(t,e,n,i){var r=t._repeat,s=_H(e)||0,a=t._tTime/t._tDur;return a&&!i&&(t._time*=s/t._dur),t._dur=s,t._tDur=r?r<0?1e10:_H(s*(r+1)+t._rDelay*r):s,a>0&&!i&&VH(t,t._tTime=t._tDur*a),t.parent&&HH(t),n||LH(t.parent,t),t},ZH=function(t){return t instanceof WV?LH(t):JH(t,t._dur)},QH={_start:0,endTime:rH,totalDuration:rH},$H=function t(e,n,i){var r,s,a,o=e.labels,l=e._recent||QH,h=e.duration()>=EG?l.endTime(!1):e._dur;return FG(n)&&(isNaN(n)||n in o)?(s=n.charAt(0),a="%"===n.substr(-1),r=n.indexOf("="),"<"===s||">"===s?(r>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(a?(r<0?l:i).totalDuration()/100:1)):r<0?(n in o||(o[n]=h),o[n]):(s=parseFloat(n.charAt(r-1)+n.substr(r+1)),a&&i&&(s=s/100*(XG(i)?i[0]:i).totalDuration()),r>1?t(e,n.substr(0,r-1),i)+s:h+s)):null==n?h:+n},tV=function(t,e,n){var i,r,s=UG(e[1]),a=(s?2:1)+(t<2?0:1),o=e[a];if(s&&(o.duration=e[1]),o.parent=n,t){for(i=o,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=zG(r.vars.inherit)&&r.parent;o.immediateRender=zG(i.immediateRender),t<2?o.runBackwards=1:o.startAt=e[a-1]}return new nX(e[0],o,e[a+1])},eV=function(t,e){return t||0===t?e(t):e},nV=function(t,e,n){return n<t?t:n>e?e:n},iV=function(t,e){return FG(t)&&(e=ZG.exec(t))?e[1]:""},rV=[].slice,sV=function(t,e){return t&&NG(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&NG(t[0]))&&!t.nodeType&&t!==Zz},aV=function(t,e,n){return Kz&&!e&&Kz.selector?Kz.selector(t):!FG(t)||n||!Qz&&IV()?XG(t)?function(t,e,n){return void 0===n&&(n=[]),t.forEach(function(t){var i;return FG(t)&&!e||sV(t,1)?(i=n).push.apply(i,aV(t)):n.push(t)})||n}(t,n):sV(t)?rV.call(t,0):t?[t]:[]:rV.call((e||$z).querySelectorAll(t),0)},oV=function(t){return t=aV(t)[0]||nH()||{},function(e){var n=t.current||t.nativeElement||t;return aV(e,n.querySelectorAll?n:n===t?nH()||$z.createElement("div"):t)}},lV=function(t){return t.sort(function(){return.5-Math.random()})},hV=function(t){if(LG(t))return t;var e=NG(t)?t:{each:t},n=kV(e.ease),i=e.from||0,r=parseFloat(e.base)||0,s={},a=i>0&&i<1,o=isNaN(i)||a,l=e.axis,h=i,c=i;return FG(i)?h=c={center:.5,edges:.5,end:1}[i]||0:!a&&o&&(h=i[0],c=i[1]),function(t,a,u){var d,p,f,m,g,v,y,x,b,_=(u||e).length,S=s[_];if(!S){if(!(b="auto"===e.grid?0:(e.grid||[1,EG])[1])){for(y=-1e8;y<(y=u[b++].getBoundingClientRect().left)&&b<_;);b<_&&b--}for(S=s[_]=[],d=o?Math.min(b,_)*h-.5:i%b,p=b===EG?0:o?_*c/b-.5:i/b|0,y=0,x=EG,v=0;v<_;v++)f=v%b-d,m=p-(v/b|0),S[v]=g=l?Math.abs("y"===l?m:f):OG(f*f+m*m),g>y&&(y=g),g<x&&(x=g);"random"===i&&lV(S),S.max=y-x,S.min=x,S.v=_=(parseFloat(e.amount)||parseFloat(e.each)*(b>_?_-1:l?"y"===l?_/b:b:Math.max(b,_/b))||0)*("edges"===i?-1:1),S.b=_<0?r-_:r,S.u=iV(e.amount||e.each)||0,n=n&&_<0?LV(n):n}return _=(S[t]-S.min)/S.max||0,_H(S.b+(n?n(_):_)*S.v)+S.u}},cV=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(n){var i=_H(Math.round(parseFloat(n)/t)*t*e);return(i-i%1)/e+(UG(n)?0:iV(n))}},uV=function(t,e){var n,i,r=XG(t);return!r&&NG(t)&&(n=r=t.radius||EG,t.values?(t=aV(t.values),(i=!UG(t[0]))&&(n*=n)):t=cV(t.increment)),eV(e,r?LG(t)?function(e){return i=t(e),Math.abs(i-e)<=n?i:e}:function(e){for(var r,s,a=parseFloat(i?e.x:e),o=parseFloat(i?e.y:0),l=EG,h=0,c=t.length;c--;)(r=i?(r=t[c].x-a)*r+(s=t[c].y-o)*s:Math.abs(t[c]-a))<l&&(l=r,h=c);return h=!n||l<=n?t[h]:e,i||h===e||UG(e)?h:h+iV(e)}:cV(t))},dV=function(t,e,n,i){return eV(XG(t)?!e:!0===n?!!(n=0):!i,function(){return XG(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*i)/i})},pV=function(t,e,n){return eV(n,function(n){return t[~~e(n)]})},fV=function(t){for(var e,n,i,r,s=0,a="";~(e=t.indexOf("random(",s));)i=t.indexOf(")",e),r="["===t.charAt(e+7),n=t.substr(e+7,i-e-7).match(r?JG:WG),a+=t.substr(s,e-s)+dV(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),s=i+1;return a+t.substr(s,t.length-s)},mV=function(t,e,n,i,r){var s=e-t,a=i-n;return eV(r,function(e){return n+((e-t)/s*a||0)})},gV=function(t,e,n){var i,r,s,a=t.labels,o=EG;for(i in a)(r=a[i]-e)<0==!!n&&r&&o>(r=Math.abs(r))&&(s=i,o=r);return s},vV=function(t,e,n){var i,r,s,a=t.vars,o=a[e],l=Kz,h=t._ctx;if(o)return i=a[e+"Params"],r=a.callbackScope||t,n&&hH.length&&TH(),h&&(Kz=h),s=i?o.apply(r,i):o.call(r),Kz=l,s},yV=function(t){return FH(t),t.scrollTrigger&&t.scrollTrigger.kill(!!qz),t.progress()<1&&vV(t,"onInterrupt"),t},xV=[],bV=function(t){if(t)if(t=!t.name&&t.default||t,GG()||t.headless){var e=t.name,n=LG(t),i=e&&!n&&t.init?function(){this._props=[]}:t,r={init:rH,render:uX,add:KV,kill:pX,modifier:dX,rawVars:0},s={targetTest:0,get:0,getSetter:oX,aliases:{},register:0};if(IV(),t!==i){if(uH[e])return;CH(i,CH(IH(t,r),s)),PH(i.prototype,PH(r,IH(t,s))),uH[i.prop=e]=i,t.targetTest&&(fH.push(i),lH[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}iH(e,i),t.register&&t.register(PX,i,gX)}else xV.push(t)},_V=255,SV={aqua:[0,_V,_V],lime:[0,_V,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_V],navy:[0,0,128],white:[_V,_V,_V],olive:[128,128,0],yellow:[_V,_V,0],orange:[_V,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_V,0,0],pink:[_V,192,203],cyan:[0,_V,_V],transparent:[_V,_V,_V,0]},wV=function(t,e,n){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*_V+.5|0},TV=function(t,e,n){var i,r,s,a,o,l,h,c,u,d,p=t?UG(t)?[t>>16,t>>8&_V,t&_V]:0:SV.black;if(!p){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),SV[t])p=SV[t];else if("#"===t.charAt(0)){if(t.length<6&&(i=t.charAt(1),r=t.charAt(2),s=t.charAt(3),t="#"+i+i+r+r+s+s+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(p=parseInt(t.substr(1,6),16))>>16,p>>8&_V,p&_V,parseInt(t.substr(7),16)/255];p=[(t=parseInt(t.substr(1),16))>>16,t>>8&_V,t&_V]}else if("hsl"===t.substr(0,3))if(p=d=t.match(WG),e){if(~t.indexOf("="))return p=t.match(jG),n&&p.length<4&&(p[3]=1),p}else a=+p[0]%360/360,o=+p[1]/100,i=2*(l=+p[2]/100)-(r=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=wV(a+1/3,i,r),p[1]=wV(a,i,r),p[2]=wV(a-1/3,i,r);else p=t.match(WG)||SV.transparent;p=p.map(Number)}return e&&!d&&(i=p[0]/_V,r=p[1]/_V,s=p[2]/_V,l=((h=Math.max(i,r,s))+(c=Math.min(i,r,s)))/2,h===c?a=o=0:(u=h-c,o=l>.5?u/(2-h-c):u/(h+c),a=h===i?(r-s)/u+(r<s?6:0):h===r?(s-i)/u+2:(i-r)/u+4,a*=60),p[0]=~~(a+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},MV=function(t){var e=[],n=[],i=-1;return t.split(EV).forEach(function(t){var r=t.match(YG)||[];e.push.apply(e,r),n.push(i+=r.length+1)}),e.c=n,e},AV=function(t,e,n){var i,r,s,a,o="",l=(t+o).match(EV),h=e?"hsla(":"rgba(",c=0;if(!l)return t;if(l=l.map(function(t){return(t=TV(t,e,1))&&h+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"}),n&&(s=MV(t),(i=n.c).join(o)!==s.c.join(o)))for(a=(r=t.replace(EV,"1").split(YG)).length-1;c<a;c++)o+=r[c]+(~i.indexOf(c)?l.shift()||h+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!r)for(a=(r=t.split(EV)).length-1;c<a;c++)o+=r[c]+l[c];return o+r[a]},EV=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in SV)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),CV=/hsl[a]?\(/,PV=function(t){var e,n=t.join(" ");if(EV.lastIndex=0,EV.test(n))return e=CV.test(n),t[1]=AV(t[1],e),t[0]=AV(t[0],e,MV(t[1])),!0},RV=(cG=Date.now,uG=500,dG=33,pG=cG(),fG=pG,gG=mG=1e3/240,yG=function t(e){var n,i,r,s,a=cG()-fG,o=!0===e;if((a>uG||a<0)&&(pG+=a-dG),((n=(r=(fG+=a)-pG)-gG)>0||o)&&(s=++oG.frame,lG=r-1e3*oG.time,oG.time=r/=1e3,gG+=n+(n>=mG?4:mG-n),i=1),o||(rG=sG(t)),i)for(hG=0;hG<vG.length;hG++)vG[hG](r,lG,s,e)},oG={time:0,frame:0,tick:function(){yG(!0)},deltaRatio:function(t){return lG/(1e3/(t||60))},wake:function(){tG&&(!Qz&&GG()&&(Zz=Qz=window,$z=Zz.document||{},QG.gsap=PX,(Zz.gsapVersions||(Zz.gsapVersions=[])).push(PX.version),tH($G||Zz.GreenSockGlobals||!Zz.gsap&&Zz||{}),xV.forEach(bV)),aG="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,rG&&oG.sleep(),sG=aG||function(t){return setTimeout(t,gG-1e3*oG.time+1|0)},iG=1,yG(2))},sleep:function(){(aG?cancelAnimationFrame:clearTimeout)(rG),iG=0,sG=rH},lagSmoothing:function(t,e){uG=t||1/0,dG=Math.min(e||33,uG)},fps:function(t){mG=1e3/(t||240),gG=1e3*oG.time+mG},add:function(t,e,n){var i=e?function(e,n,r,s){t(e,n,r,s),oG.remove(i)}:t;return oG.remove(t),vG[n?"unshift":"push"](i),IV(),i},remove:function(t,e){~(e=vG.indexOf(t))&&vG.splice(e,1)&&hG>=e&&hG--},_listeners:vG=[]}),IV=function(){return!iG&&RV.wake()},OV={},DV=/^[\d.\-M][\d.\-,\s]/,BV=/["']/g,FV=function(t){for(var e,n,i,r={},s=t.substr(1,t.length-3).split(":"),a=s[0],o=1,l=s.length;o<l;o++)n=s[o],e=o!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,e),r[a]=isNaN(i)?i.replace(BV,"").trim():+i,a=n.substr(e+1).trim();return r},LV=function(t){return function(e){return 1-t(1-e)}},UV=function t(e,n){for(var i,r=e._first;r;)r instanceof WV?t(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?t(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},kV=function(t,e){return t&&(LG(t)?t:OV[t]||function(t){var e,n,i,r,s=(t+"").split("("),a=OV[s[0]];return a&&s.length>1&&a.config?a.config.apply(null,~t.indexOf("{")?[FV(s[1])]:(e=t,n=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",n),e.substring(n,~r&&r<i?e.indexOf(")",i+1):i)).split(",").map(AH)):OV._CE&&DV.test(t)?OV._CE("",t):a}(t))||e},NV=function(t,e,n,i){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===i&&(i=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var r,s={easeIn:e,easeOut:n,easeInOut:i};return xH(t,function(t){for(var e in OV[t]=QG[t]=s,OV[r=t.toLowerCase()]=n,s)OV[r+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=OV[t+"."+e]=s[e]}),s},zV=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},GV=function t(e,n,i){var r=n>=1?n:1,s=(i||(e?.3:.45))/(n<1?n:1),a=s/PG*(Math.asin(1/r)||0),o=function(t){return 1===t?1:r*Math.pow(2,-10*t)*BG((t-a)*s)+1},l="out"===e?o:"in"===e?function(t){return 1-o(1-t)}:zV(o);return s=PG/s,l.config=function(n,i){return t(e,n,i)},l},HV=function t(e,n){void 0===n&&(n=1.70158);var i=function(t){return t?--t*t*((n+1)*t+n)+1:0},r="out"===e?i:"in"===e?function(t){return 1-i(1-t)}:zV(i);return r.config=function(n){return t(e,n)},r};xH("Linear,Quad,Cubic,Quart,Quint,Strong",function(t,e){var n=e<5?e+1:e;NV(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},function(t){return 1-Math.pow(1-t,n)},function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2})}),OV.Linear.easeNone=OV.none=OV.Linear.easeIn,NV("Elastic",GV("in"),GV("out"),GV()),xG=7.5625,SG=2*(_G=1/(bG=2.75)),wG=2.5*_G,NV("Bounce",function(t){return 1-TG(1-t)},TG=function(t){return t<_G?xG*t*t:t<SG?xG*Math.pow(t-1.5/bG,2)+.75:t<wG?xG*(t-=2.25/bG)*t+.9375:xG*Math.pow(t-2.625/bG,2)+.984375}),NV("Expo",function(t){return t?Math.pow(2,10*(t-1)):0}),NV("Circ",function(t){return-(OG(1-t*t)-1)}),NV("Sine",function(t){return 1===t?1:1-DG(t*RG)}),NV("Back",HV("in"),HV("out"),HV()),OV.SteppedEase=OV.steps=QG.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,i=t+(e?0:1),r=e?1:0;return function(t){return((i*nV(0,.99999999,t)|0)+r)*n}}},AG.ease=OV["quad.out"],xH("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(t){return mH+=t+","+t+"Params,"});var VV=function(t,e){this.id=IG++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:yH,this.set=e?e.getSetter:oX},XV=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,JH(this,+t.duration,1,1),this.data=t.data,Kz&&(this._ctx=Kz,Kz.data.push(this)),iG||RV.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,JH(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(IV(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(VH(this,t),!n._dp||n.parent||XH(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&WH(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===CG||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),MH(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+NH(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+NH(this),e):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?zH(this._tTime,n)+1:1},e.timeScale=function(t,e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var n=this.parent&&this._ts?GH(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,this.totalTime(nV(-Math.abs(this._delay),this._tDur,n),!1!==e),HH(this),function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t}(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(IV(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==CG&&(this._tTime-=CG)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&WH(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(zG(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?GH(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=oH);var e=qz;return qz=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),qz=e,this},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(Math.abs(e._ts)||1),e=e._dp;return!this.parent&&this._sat?this._sat.globalTime(t):n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,ZH(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,ZH(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime($H(this,t),zG(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,zG(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-CG))},e.eventCallback=function(t,e,n){var i=this.vars;return arguments.length>1?(e?(i[t]=e,n&&(i[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},e.then=function(t){var e=this;return new Promise(function(n){var i=LG(t)?t:EH,r=function(){var t=e.then;e.then=null,LG(i)&&(i=i(e))&&(i.then||i===e)&&(e.then=t),n(i),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?r():e._prom=r})},e.kill=function(){yV(this)},t}();CH(XV.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var WV=function(t){function e(e,n){var i;return void 0===e&&(e={}),(i=t.call(this,e)||this).labels={},i.smoothChildTiming=!!e.smoothChildTiming,i.autoRemoveChildren=!!e.autoRemoveChildren,i._sort=zG(e.sortChildren),Jz&&WH(e.parent||Jz,Wz(i),n),e.reversed&&i.reverse(),e.paused&&i.paused(!0),e.scrollTrigger&&jH(Wz(i),e.scrollTrigger),i}jz(e,t);var n=e.prototype;return n.to=function(t,e,n){return tV(0,arguments,this),this},n.from=function(t,e,n){return tV(1,arguments,this),this},n.fromTo=function(t,e,n,i){return tV(2,arguments,this),this},n.set=function(t,e,n){return e.duration=0,e.parent=this,OH(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new nX(t,e,$H(this,n),1),this},n.call=function(t,e,n){return WH(this,nX.delayedCall(0,t,e),n)},n.staggerTo=function(t,e,n,i,r,s,a){return n.duration=e,n.stagger=n.stagger||i,n.onComplete=s,n.onCompleteParams=a,n.parent=this,new nX(t,n,$H(this,r)),this},n.staggerFrom=function(t,e,n,i,r,s,a){return n.runBackwards=1,OH(n).immediateRender=zG(n.immediateRender),this.staggerTo(t,e,n,i,r,s,a)},n.staggerFromTo=function(t,e,n,i,r,s,a,o){return i.startAt=n,OH(i).immediateRender=zG(i.immediateRender),this.staggerTo(t,e,i,r,s,a,o)},n.render=function(t,e,n){var i,r,s,a,o,l,h,c,u,d,p,f,m=this._time,g=this._dirty?this.totalDuration():this._tDur,v=this._dur,y=t<=0?0:_H(t),x=this._zTime<0!=t<0&&(this._initted||!v);if(this!==Jz&&y>g&&t>=0&&(y=g),y!==this._tTime||n||x){if(m!==this._time&&v&&(y+=this._time-m,t+=this._time-m),i=y,u=this._start,l=!(c=this._ts),x&&(v||(m=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(p=this._yoyo,o=v+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*o+t,e,n);if(i=_H(y%o),y===g?(a=this._repeat,i=v):((a=~~(y/o))&&a===y/o&&(i=v,a--),i>v&&(i=v)),d=zH(this._tTime,o),!m&&this._tTime&&d!==a&&this._tTime-d*o-this._dur<=0&&(d=a),p&&1&a&&(i=v-i,f=1),a!==d&&!this._lock){var b=p&&1&d,_=b===(p&&1&a);if(a<d&&(b=!b),m=b?0:y%v?v:y,this._lock=1,this.render(m||(f?0:_H(a*o)),e,!v)._lock=0,this._tTime=y,!e&&this.parent&&vV(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(v=this._dur,g=this._tDur,_&&(this._lock=2,m=b?v:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;UV(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(h=function(t,e,n){var i;if(n>e)for(i=t._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<e)return i;i=i._prev}}(this,_H(m),_H(i)),h&&(y-=i-(i=h._start))),this._tTime=y,this._time=i,this._act=!c,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,m=0),!m&&i&&!e&&!a&&(vV(this,"onStart"),this._tTime!==y))return this;if(i>=m&&t>=0)for(r=this._first;r;){if(s=r._next,(r._act||i>=r._start)&&r._ts&&h!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,e,n),i!==this._time||!this._ts&&!l){h=0,s&&(y+=this._zTime=-1e-8);break}}r=s}else{r=this._last;for(var S=t<0?t:i;r;){if(s=r._prev,(r._act||S<=r._end)&&r._ts&&h!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(S-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(S-r._start)*r._ts,e,n||qz&&(r._initted||r._startAt)),i!==this._time||!this._ts&&!l){h=0,s&&(y+=this._zTime=S?-1e-8:CG);break}}r=s}}if(h&&!e&&(this.pause(),h.render(i>=m?0:-1e-8)._zTime=i>=m?1:-1,this._ts))return this._start=u,HH(this),this.render(t,e,n);this._onUpdate&&!e&&vV(this,"onUpdate",!0),(y===g&&this._tTime>=this.totalDuration()||!y&&m)&&(u!==this._start&&Math.abs(c)===Math.abs(this._ts)||this._lock||((t||!v)&&(y===g&&this._ts>0||!y&&this._ts<0)&&FH(this,1),e||t<0&&!m||!y&&!m&&g||(vV(this,y===g&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(y<g&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(t,e){var n=this;if(UG(e)||(e=$H(this,e,t)),!(t instanceof XV)){if(XG(t))return t.forEach(function(t){return n.add(t,e)}),this;if(FG(t))return this.addLabel(t,e);if(!LG(t))return this;t=nX.delayedCall(0,t)}return this!==t?WH(this,t,e):this},n.getChildren=function(t,e,n,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===i&&(i=-1e8);for(var r=[],s=this._first;s;)s._start>=i&&(s instanceof nX?e&&r.push(s):(n&&r.push(s),t&&r.push.apply(r,s.getChildren(!0,e,n)))),s=s._next;return r},n.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},n.remove=function(t){return FG(t)?this.removeLabel(t):LG(t)?this.killTweensOf(t):(BH(this,t),t===this._recent&&(this._recent=this._last),LH(this))},n.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_H(RV.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},n.addLabel=function(t,e){return this.labels[t]=$H(this,e),this},n.removeLabel=function(t){return delete this.labels[t],this},n.addPause=function(t,e,n){var i=nX.delayedCall(0,e||rH,n);return i.data="isPause",this._hasPause=1,WH(this,i,$H(this,t))},n.removePause=function(t){var e=this._first;for(t=$H(this,t);e;)e._start===t&&"isPause"===e.data&&FH(e),e=e._next},n.killTweensOf=function(t,e,n){for(var i=this.getTweensOf(t,n),r=i.length;r--;)jV!==i[r]&&i[r].kill(t,e);return this},n.getTweensOf=function(t,e){for(var n,i=[],r=aV(t),s=this._first,a=UG(e);s;)s instanceof nX?wH(s._targets,r)&&(a?(!jV||s._initted&&s._ts)&&s.globalTime(0)<=e&&s.globalTime(s.totalDuration())>e:!e||s.isActive())&&i.push(s):(n=s.getTweensOf(r,e)).length&&i.push.apply(i,n),s=s._next;return i},n.tweenTo=function(t,e){e=e||{};var n,i=this,r=$H(i,t),s=e,a=s.startAt,o=s.onStart,l=s.onStartParams,h=s.immediateRender,c=nX.to(i,CH({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:e.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale())||CG,onStart:function(){if(i.pause(),!n){var t=e.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale());c._dur!==t&&JH(c,t,0,1).render(c._time,!0,!0),n=1}o&&o.apply(c,l||[])}},e));return h?c.render(0):c},n.tweenFromTo=function(t,e,n){return this.tweenTo(e,CH({startAt:{time:$H(this,t)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(t){return void 0===t&&(t=this._time),gV(this,$H(this,t))},n.previousLabel=function(t){return void 0===t&&(t=this._time),gV(this,$H(this,t),1)},n.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+CG)},n.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var i,r=this._first,s=this.labels;r;)r._start>=n&&(r._start+=t,r._end+=t),r=r._next;if(e)for(i in s)s[i]>=n&&(s[i]+=t);return LH(this)},n.invalidate=function(e){var n=this._first;for(this._lock=0;n;)n.invalidate(e),n=n._next;return t.prototype.invalidate.call(this,e)},n.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),LH(this)},n.totalDuration=function(t){var e,n,i,r=0,s=this,a=s._last,o=EG;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(i=s.parent;a;)e=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>o&&s._sort&&a._ts&&!s._lock?(s._lock=1,WH(s,a,n-a._delay,1)._lock=0):o=n,n<0&&a._ts&&(r-=n,(!i&&!s._dp||i&&i.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-1/0),o=0),a._end>r&&a._ts&&(r=a._end),a=e;JH(s,s===Jz&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(t){if(Jz._ts&&(MH(Jz,GH(t,Jz)),eG=RV.frame),RV.frame>=pH){pH+=MG.autoSleep||120;var e=Jz._first;if((!e||!e._ts)&&MG.autoSleep&&RV._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||RV.sleep()}}},e}(XV);CH(WV.prototype,{_lock:0,_hasPause:0,_forcing:0});var jV,YV,qV=function(t,e,n,i,r,s,a){var o,l,h,c,u,d,p,f,m=new gX(this._pt,t,e,0,1,cX,null,r),g=0,v=0;for(m.b=n,m.e=i,n+="",(p=~(i+="").indexOf("random("))&&(i=fV(i)),s&&(s(f=[n,i],t,e),n=f[0],i=f[1]),l=n.match(qG)||[];o=qG.exec(i);)c=o[0],u=i.substring(g,o.index),h?h=(h+1)%5:"rgba("===u.substr(-5)&&(h=1),c!==l[v++]&&(d=parseFloat(l[v-1])||0,m._pt={_next:m._pt,p:u||1===v?u:",",s:d,c:"="===c.charAt(1)?SH(d,c)-d:parseFloat(c)-d,m:h&&h<4?Math.round:0},g=qG.lastIndex);return m.c=g<i.length?i.substring(g,i.length):"",m.fp=a,(KG.test(i)||p)&&(m.e=0),this._pt=m,m},KV=function(t,e,n,i,r,s,a,o,l,h){LG(i)&&(i=i(r||0,t,s));var c,u=t[e],d="get"!==n?n:LG(u)?l?t[e.indexOf("set")||!LG(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():u,p=LG(u)?l?sX:rX:iX;if(FG(i)&&(~i.indexOf("random(")&&(i=fV(i)),"="===i.charAt(1)&&((c=SH(d,i)+(iV(d)||0))||0===c)&&(i=c)),!h||d!==i||YV)return isNaN(d*i)||""===i?qV.call(this,t,e,d,i,p,o||MG.stringFilter,l):(c=new gX(this._pt,t,e,+d||0,i-(d||0),"boolean"==typeof u?hX:lX,0,p),l&&(c.fp=l),a&&c.modifier(a,this,t),this._pt=c)},JV=function(t,e,n,i,r,s){var a,o,l,h;if(uH[t]&&!1!==(a=new uH[t]).init(r,a.rawVars?e[t]:function(t,e,n,i,r){if(LG(t)&&(t=$V(t,r,e,n,i)),!NG(t)||t.style&&t.nodeType||XG(t)||VG(t))return FG(t)?$V(t,r,e,n,i):t;var s,a={};for(s in t)a[s]=$V(t[s],r,e,n,i);return a}(e[t],i,r,s,n),n,i,s)&&(n._pt=o=new gX(n._pt,r,t,0,1,a.render,a,0,a.priority),n!==nG))for(l=n._ptLookup[n._targets.indexOf(r)],h=a._props.length;h--;)l[a._props[h]]=o;return a},ZV=function t(e,n,i){var r,s,a,o,l,h,c,u,d,p,f,m,g,v=e.vars,y=v.ease,x=v.startAt,b=v.immediateRender,_=v.lazy,S=v.onUpdate,w=v.runBackwards,T=v.yoyoEase,M=v.keyframes,A=v.autoRevert,E=e._dur,C=e._startAt,P=e._targets,R=e.parent,I=R&&"nested"===R.data?R.vars.targets:P,O="auto"===e._overwrite&&!Yz,D=e.timeline;if(D&&(!M||!y)&&(y="none"),e._ease=kV(y,AG.ease),e._yEase=T?LV(kV(!0===T?y:T,AG.ease)):0,T&&e._yoyo&&!e._repeat&&(T=e._yEase,e._yEase=e._ease,e._ease=T),e._from=!D&&!!v.runBackwards,!D||M&&!v.stagger){if(m=(u=P[0]?vH(P[0]).harness:0)&&v[u.prop],r=IH(v,lH),C&&(C._zTime<0&&C.progress(1),n<0&&w&&b&&!A?C.render(-1,!0):C.revert(w&&E?aH:sH),C._lazy=0),x){if(FH(e._startAt=nX.set(P,CH({data:"isStart",overwrite:!1,parent:R,immediateRender:!0,lazy:!C&&zG(_),startAt:null,delay:0,onUpdate:S&&function(){return vV(e,"onUpdate")},stagger:0},x))),e._startAt._dp=0,e._startAt._sat=e,n<0&&(qz||!b&&!A)&&e._startAt.revert(aH),b&&E&&n<=0&&i<=0)return void(n&&(e._zTime=n))}else if(w&&E&&!C)if(n&&(b=!1),a=CH({overwrite:!1,data:"isFromStart",lazy:b&&!C&&zG(_),immediateRender:b,stagger:0,parent:R},r),m&&(a[u.prop]=m),FH(e._startAt=nX.set(P,a)),e._startAt._dp=0,e._startAt._sat=e,n<0&&(qz?e._startAt.revert(aH):e._startAt.render(-1,!0)),e._zTime=n,b){if(!n)return}else t(e._startAt,CG,CG);for(e._pt=e._ptCache=0,_=E&&zG(_)||_&&!E,s=0;s<P.length;s++){if(c=(l=P[s])._gsap||gH(P)[s]._gsap,e._ptLookup[s]=p={},cH[c.id]&&hH.length&&TH(),f=I===P?s:I.indexOf(l),u&&!1!==(d=new u).init(l,m||r,e,f,I)&&(e._pt=o=new gX(e._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach(function(t){p[t]=o}),d.priority&&(h=1)),!u||m)for(a in r)uH[a]&&(d=JV(a,r,e,f,l,I))?d.priority&&(h=1):p[a]=o=KV.call(e,l,a,"get",r[a],f,I,0,v.stringFilter);e._op&&e._op[s]&&e.kill(l,e._op[s]),O&&e._pt&&(jV=e,Jz.killTweensOf(l,p,e.globalTime(n)),g=!e.parent,jV=0),e._pt&&_&&(cH[c.id]=1)}h&&mX(e),e._onInit&&e._onInit(e)}e._onUpdate=S,e._initted=(!e._op||e._pt)&&!g,M&&n<=0&&D.render(EG,!0,!0)},QV=function(t,e,n,i){var r,s,a=e.ease||i||"power1.inOut";if(XG(e))s=n[t]||(n[t]=[]),e.forEach(function(t,n){return s.push({t:n/(e.length-1)*100,v:t,e:a})});else for(r in e)s=n[r]||(n[r]=[]),"ease"===r||s.push({t:parseFloat(t),v:e[r],e:a})},$V=function(t,e,n,i,r){return LG(t)?t.call(e,n,i,r):FG(t)&&~t.indexOf("random(")?fV(t):t},tX=mH+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",eX={};xH(tX+",id,stagger,delay,duration,paused,scrollTrigger",function(t){return eX[t]=1});var nX=function(t){function e(e,n,i,r){var s;"number"==typeof n&&(i.duration=n,n=i,i=null);var a,o,l,h,c,u,d,p,f=(s=t.call(this,r?n:OH(n))||this).vars,m=f.duration,g=f.delay,v=f.immediateRender,y=f.stagger,x=f.overwrite,b=f.keyframes,_=f.defaults,S=f.scrollTrigger,w=f.yoyoEase,T=n.parent||Jz,M=(XG(e)||VG(e)?UG(e[0]):"length"in n)?[e]:aV(e);if(s._targets=M.length?gH(M):nH(0,!MG.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=x,b||y||HG(m)||HG(g)){if(n=s.vars,(a=s.timeline=new WV({data:"nested",defaults:_||{},targets:T&&"nested"===T.data?T.vars.targets:M})).kill(),a.parent=a._dp=Wz(s),a._start=0,y||HG(m)||HG(g)){if(h=M.length,d=y&&hV(y),NG(y))for(c in y)~tX.indexOf(c)&&(p||(p={}),p[c]=y[c]);for(o=0;o<h;o++)(l=IH(n,eX)).stagger=0,w&&(l.yoyoEase=w),p&&PH(l,p),u=M[o],l.duration=+$V(m,Wz(s),o,u,M),l.delay=(+$V(g,Wz(s),o,u,M)||0)-s._delay,!y&&1===h&&l.delay&&(s._delay=g=l.delay,s._start+=g,l.delay=0),a.to(u,l,d?d(o,u,M):0),a._ease=OV.none;a.duration()?m=g=0:s.timeline=0}else if(b){OH(CH(a.vars.defaults,{ease:"none"})),a._ease=kV(b.ease||n.ease||"none");var A,E,C,P=0;if(XG(b))b.forEach(function(t){return a.to(M,t,">")}),a.duration();else{for(c in l={},b)"ease"===c||"easeEach"===c||QV(c,b[c],l,b.easeEach);for(c in l)for(A=l[c].sort(function(t,e){return t.t-e.t}),P=0,o=0;o<A.length;o++)(C={ease:(E=A[o]).e,duration:(E.t-(o?A[o-1].t:0))/100*m})[c]=E.v,a.to(M,C,P),P+=C.duration;a.duration()<m&&a.to({},{duration:m-a.duration()})}}m||s.duration(m=a.duration())}else s.timeline=0;return!0!==x||Yz||(jV=Wz(s),Jz.killTweensOf(M),jV=0),WH(T,Wz(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),(v||!m&&!b&&s._start===_H(T._time)&&zG(v)&&kH(Wz(s))&&"nested"!==T.data)&&(s._tTime=-1e-8,s.render(Math.max(0,-g)||0)),S&&jH(Wz(s),S),s}jz(e,t);var n=e.prototype;return n.render=function(t,e,n){var i,r,s,a,o,l,h,c,u,d=this._time,p=this._tDur,f=this._dur,m=t<0,g=t>p-CG&&!m?p:t<CG?0:t;if(f){if(g!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m){if(i=g,c=this.timeline,this._repeat){if(a=f+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*a+t,e,n);if(i=_H(g%a),g===p?(s=this._repeat,i=f):((s=~~(g/a))&&s===_H(g/a)&&(i=f,s--),i>f&&(i=f)),(l=this._yoyo&&1&s)&&(u=this._yEase,i=f-i),o=zH(this._tTime,a),i===d&&!n&&this._initted&&s===o)return this._tTime=g,this;s!==o&&(c&&this._yEase&&UV(c,l),this.vars.repeatRefresh&&!l&&!this._lock&&this._time!==a&&this._initted&&(this._lock=n=1,this.render(_H(a*s),!0).invalidate()._lock=0))}if(!this._initted){if(YH(this,m?t:i,n,e,g))return this._tTime=0,this;if(!(d===this._time||n&&this.vars.repeatRefresh&&s!==o))return this;if(f!==this._dur)return this.render(t,e,n)}if(this._tTime=g,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=h=(u||this._ease)(i/f),this._from&&(this.ratio=h=1-h),i&&!d&&!e&&!s&&(vV(this,"onStart"),this._tTime!==g))return this;for(r=this._pt;r;)r.r(h,r.d),r=r._next;c&&c.render(t<0?t:c._dur*c._ease(i/this._dur),e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(m&&UH(this,t,0,n),vV(this,"onUpdate")),this._repeat&&s!==o&&this.vars.onRepeat&&!e&&this.parent&&vV(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(m&&!this._onUpdate&&UH(this,t,0,!0),(t||!f)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&FH(this,1),e||m&&!d||!(g||d||l)||(vV(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,i){var r,s,a,o=t.ratio,l=e<0||!e&&(!t._start&&qH(t)&&(t._initted||!KH(t))||(t._ts<0||t._dp._ts<0)&&!KH(t))?0:1,h=t._rDelay,c=0;if(h&&t._repeat&&(c=nV(0,t._tDur,e),s=zH(c,h),t._yoyo&&1&s&&(l=1-l),s!==zH(t._tTime,h)&&(o=1-l,t.vars.repeatRefresh&&t._initted&&t.invalidate())),l!==o||qz||i||t._zTime===CG||!e&&t._zTime){if(!t._initted&&YH(t,e,i,n,c))return;for(a=t._zTime,t._zTime=e||(n?CG:0),n||(n=e&&!a),t.ratio=l,t._from&&(l=1-l),t._time=0,t._tTime=c,r=t._pt;r;)r.r(l,r.d),r=r._next;e<0&&UH(t,e,0,!0),t._onUpdate&&!n&&vV(t,"onUpdate"),c&&t._repeat&&!n&&t.parent&&vV(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===l&&(l&&FH(t,1),n||qz||(vV(t,l?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},n.targets=function(){return this._targets},n.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},n.resetTo=function(t,e,n,i,r){iG||RV.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||ZV(this,s),function(t,e,n,i,r,s,a,o){var l,h,c,u,d=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!d)for(d=t._ptCache[e]=[],c=t._ptLookup,u=t._targets.length;u--;){if((l=c[u][e])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==e&&l.fp!==e;)l=l._next;if(!l)return YV=1,t.vars[e]="+=0",ZV(t,a),YV=0,o?nH():1;d.push(l)}for(u=d.length;u--;)(l=(h=d[u])._pt||h).s=!i&&0!==i||r?l.s+(i||0)+s*l.c:i,l.c=n-l.s,h.e&&(h.e=bH(n)+iV(h.e)),h.b&&(h.b=l.s+iV(h.b))}(this,t,e,n,i,this._ease(s/this._dur),s,r)?this.resetTo(t,e,n,i,1):(VH(this,0),this.parent||DH(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?yV(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,jV&&!0!==jV.vars.overwrite)._first||yV(this),this.parent&&n!==this.timeline.totalDuration()&&JH(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,s,a,o,l,h,c=this._targets,u=t?aV(t):c,d=this._ptLookup,p=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,i=n===e.length;i&&n--&&t[n]===e[n];);return n<0}(c,u))return"all"===e&&(this._pt=0),yV(this);for(i=this._op=this._op||[],"all"!==e&&(FG(e)&&(o={},xH(e,function(t){return o[t]=1}),e=o),e=function(t,e){var n,i,r,s,a=t[0]?vH(t[0]).harness:0,o=a&&a.aliases;if(!o)return e;for(i in n=PH({},e),o)if(i in n)for(r=(s=o[i].split(",")).length;r--;)n[s[r]]=n[i];return n}(c,e)),h=c.length;h--;)if(~u.indexOf(c[h]))for(o in r=d[h],"all"===e?(i[h]=e,a=r,s={}):(s=i[h]=i[h]||{},a=e),a)(l=r&&r[o])&&("kill"in l.d&&!0!==l.d.kill(o)||BH(this,l,"_pt"),delete r[o]),"all"!==s&&(s[o]=1);return this._initted&&!this._pt&&p&&yV(this),this},e.to=function(t,n){return new e(t,n,arguments[2])},e.from=function(t,e){return tV(1,arguments)},e.delayedCall=function(t,n,i,r){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},e.fromTo=function(t,e,n){return tV(2,arguments)},e.set=function(t,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(t,n)},e.killTweensOf=function(t,e,n){return Jz.killTweensOf(t,e,n)},e}(XV);CH(nX.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),xH("staggerTo,staggerFrom,staggerFromTo",function(t){nX[t]=function(){var e=new WV,n=rV.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}});var iX=function(t,e,n){return t[e]=n},rX=function(t,e,n){return t[e](n)},sX=function(t,e,n,i){return t[e](i.fp,n)},aX=function(t,e,n){return t.setAttribute(e,n)},oX=function(t,e){return LG(t[e])?rX:kG(t[e])&&t.setAttribute?aX:iX},lX=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},hX=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},cX=function(t,e){var n=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+i,n=n._next;i+=e.c}e.set(e.t,e.p,i,e)},uX=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},dX=function(t,e,n,i){for(var r,s=this._pt;s;)r=s._next,s.p===i&&s.modifier(t,e,n),s=r},pX=function(t){for(var e,n,i=this._pt;i;)n=i._next,i.p===t&&!i.op||i.op===t?BH(this,i,"_pt"):i.dep||(e=1),i=n;return!e},fX=function(t,e,n,i){i.mSet(t,e,i.m.call(i.tween,n,i.mt),i)},mX=function(t){for(var e,n,i,r,s=t._pt;s;){for(e=s._next,n=i;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:i=s,(s._next=n)?n._prev=s:r=s,s=e}t._pt=i},gX=function(){function t(t,e,n,i,r,s,a,o,l){this.t=e,this.s=i,this.c=r,this.p=n,this.r=s||lX,this.d=a||this,this.set=o||iX,this.pr=l||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=fX,this.m=t,this.mt=n,this.tween=e},t}();xH(mH+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(t){return lH[t]=1}),QG.TweenMax=QG.TweenLite=nX,QG.TimelineLite=QG.TimelineMax=WV,Jz=new WV({sortChildren:!1,defaults:AG,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),MG.stringFilter=PV;var vX=[],yX={},xX=[],bX=0,_X=0,SX=function(t){return(yX[t]||xX).map(function(t){return t()})},wX=function(){var t=Date.now(),e=[];t-bX>2&&(SX("matchMediaInit"),vX.forEach(function(t){var n,i,r,s,a=t.queries,o=t.conditions;for(i in a)(n=Zz.matchMedia(a[i]).matches)&&(r=1),n!==o[i]&&(o[i]=n,s=1);s&&(t.revert(),r&&e.push(t))}),SX("matchMediaRevert"),e.forEach(function(t){return t.onMatch(t,function(e){return t.add(null,e)})}),bX=t,SX("matchMedia"))},TX=function(){function t(t,e){this.selector=e&&oV(e),this.data=[],this._r=[],this.isReverted=!1,this.id=_X++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,n){LG(t)&&(n=e,e=t,t=LG);var i=this,r=function(){var t,r=Kz,s=i.selector;return r&&r!==i&&r.data.push(i),n&&(i.selector=oV(n)),Kz=i,t=e.apply(i,arguments),LG(t)&&i._r.push(t),Kz=r,i.selector=s,i.isReverted=!1,t};return i.last=r,t===LG?r(i,function(t){return i.add(null,t)}):t?i[t]=r:r},e.ignore=function(t){var e=Kz;Kz=null,t(this),Kz=e},e.getTweens=function(){var e=[];return this.data.forEach(function(n){return n instanceof t?e.push.apply(e,n.getTweens()):n instanceof nX&&!(n.parent&&"nested"===n.parent.data)&&e.push(n)}),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var n=this;if(t?function(){for(var e,i=n.getTweens(),r=n.data.length;r--;)"isFlip"===(e=n.data[r]).data&&(e.revert(),e.getChildren(!0,!0,!1).forEach(function(t){return i.splice(i.indexOf(t),1)}));for(i.map(function(t){return{g:t._dur||t._delay||t._sat&&!t._sat.vars.immediateRender?t.globalTime(0):-1/0,t:t}}).sort(function(t,e){return e.g-t.g||-1/0}).forEach(function(e){return e.t.revert(t)}),r=n.data.length;r--;)(e=n.data[r])instanceof WV?"nested"!==e.data&&(e.scrollTrigger&&e.scrollTrigger.revert(),e.kill()):!(e instanceof nX)&&e.revert&&e.revert(t);n._r.forEach(function(e){return e(t,n)}),n.isReverted=!0}():this.data.forEach(function(t){return t.kill&&t.kill()}),this.clear(),e)for(var i=vX.length;i--;)vX[i].id===this.id&&vX.splice(i,1)},e.revert=function(t){this.kill(t||{})},t}(),MX=function(){function t(t){this.contexts=[],this.scope=t,Kz&&Kz.data.push(this)}var e=t.prototype;return e.add=function(t,e,n){NG(t)||(t={matches:t});var i,r,s,a=new TX(0,n||this.scope),o=a.conditions={};for(r in Kz&&!a.selector&&(a.selector=Kz.selector),this.contexts.push(a),e=a.add("onMatch",e),a.queries=t,t)"all"===r?s=1:(i=Zz.matchMedia(t[r]))&&(vX.indexOf(a)<0&&vX.push(a),(o[r]=i.matches)&&(s=1),i.addListener?i.addListener(wX):i.addEventListener("change",wX));return s&&e(a,function(t){return a.add(null,t)}),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach(function(e){return e.kill(t,!0)})},t}(),AX={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(function(t){return bV(t)})},timeline:function(t){return new WV(t)},getTweensOf:function(t,e){return Jz.getTweensOf(t,e)},getProperty:function(t,e,n,i){FG(t)&&(t=aV(t)[0]);var r=vH(t||{}).get,s=n?EH:AH;return"native"===n&&(n=""),t?e?s((uH[e]&&uH[e].get||r)(t,e,n,i)):function(e,n,i){return s((uH[e]&&uH[e].get||r)(t,e,n,i))}:t},quickSetter:function(t,e,n){if((t=aV(t)).length>1){var i=t.map(function(t){return PX.quickSetter(t,e,n)}),r=i.length;return function(t){for(var e=r;e--;)i[e](t)}}t=t[0]||{};var s=uH[e],a=vH(t),o=a.harness&&(a.harness.aliases||{})[e]||e,l=s?function(e){var i=new s;nG._pt=0,i.init(t,n?e+n:e,nG,0,[t]),i.render(1,i),nG._pt&&uX(1,nG)}:a.set(t,o);return s?l:function(e){return l(t,o,n?e+n:e,a,1)}},quickTo:function(t,e,n){var i,r=PX.to(t,PH(((i={})[e]="+=0.1",i.paused=!0,i),n||{})),s=function(t,n,i){return r.resetTo(e,t,n,i)};return s.tween=r,s},isTweening:function(t){return Jz.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=kV(t.ease,AG.ease)),RH(AG,t||{})},config:function(t){return RH(MG,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,i=t.plugins,r=t.defaults,s=t.extendTimeline;(i||"").split(",").forEach(function(t){return t&&!uH[t]&&!QG[t]&&nH()}),dH[e]=function(t,e,i){return n(aV(t),CH(e||{},r),i)},s&&(WV.prototype[e]=function(t,n,i){return this.add(dH[e](t,NG(n)?n:(i=n)&&{},this),i)})},registerEase:function(t,e){OV[t]=kV(e)},parseEase:function(t,e){return arguments.length?kV(t,e):OV},getById:function(t){return Jz.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,i,r=new WV(t);for(r.smoothChildTiming=zG(t.smoothChildTiming),Jz.remove(r),r._dp=0,r._time=r._tTime=Jz._time,n=Jz._first;n;)i=n._next,!e&&!n._dur&&n instanceof nX&&n.vars.onComplete===n._targets[0]||WH(r,n,n._start-n._delay),n=i;return WH(Jz,r,0),r},context:function(t,e){return t?new TX(t,e):Kz},matchMedia:function(t){return new MX(t)},matchMediaRefresh:function(){return vX.forEach(function(t){var e,n,i=t.conditions;for(n in i)i[n]&&(i[n]=!1,e=1);e&&t.revert()})||wX()},addEventListener:function(t,e){var n=yX[t]||(yX[t]=[]);~n.indexOf(e)||n.push(e)},removeEventListener:function(t,e){var n=yX[t],i=n&&n.indexOf(e);i>=0&&n.splice(i,1)},utils:{wrap:function t(e,n,i){var r=n-e;return XG(e)?pV(e,t(0,e.length),n):eV(i,function(t){return(r+(t-e)%r)%r+e})},wrapYoyo:function t(e,n,i){var r=n-e,s=2*r;return XG(e)?pV(e,t(0,e.length-1),n):eV(i,function(t){return e+((t=(s+(t-e)%s)%s||0)>r?s-t:t)})},distribute:hV,random:dV,snap:uV,normalize:function(t,e,n){return mV(t,e,0,1,n)},getUnit:iV,clamp:function(t,e,n){return eV(n,function(n){return nV(t,e,n)})},splitColor:TV,toArray:aV,selector:oV,mapRange:mV,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce(function(t,e){return e(t)},t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||iV(n))}},interpolate:function t(e,n,i,r){var s=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!s){var a,o,l,h,c,u=FG(e),d={};if(!0===i&&(r=1)&&(i=null),u)e={p:e},n={p:n};else if(XG(e)&&!XG(n)){for(l=[],h=e.length,c=h-2,o=1;o<h;o++)l.push(t(e[o-1],e[o]));h--,s=function(t){t*=h;var e=Math.min(c,~~t);return l[e](t-e)},i=n}else r||(e=PH(XG(e)?[]:{},e));if(!l){for(a in n)KV.call(d,e,a,"get",n[a]);s=function(t){return uX(t,d)||(u?e.p:e)}}}return eV(i,s)},shuffle:lV},install:tH,effects:dH,ticker:RV,updateRoot:WV.updateRoot,plugins:uH,globalTimeline:Jz,core:{PropTween:gX,globals:iH,Tween:nX,Timeline:WV,Animation:XV,getCache:vH,_removeLinkedListItem:BH,reverting:function(){return qz},context:function(t){return t&&Kz&&(Kz.data.push(t),t._ctx=Kz),Kz},suppressOverwrites:function(t){return Yz=t}}};xH("to,from,fromTo,delayedCall,set,killTweensOf",function(t){return AX[t]=nX[t]}),RV.add(WV.updateRoot),nG=AX.to({},{duration:0});var EX=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},CX=function(t,e){return{name:t,rawVars:1,init:function(t,n,i){i._onInit=function(t){var i,r;if(FG(n)&&(i={},xH(n,function(t){return i[t]=1}),n=i),e){for(r in i={},n)i[r]=e(n[r]);n=i}!function(t,e){var n,i,r,s=t._targets;for(n in e)for(i=s.length;i--;)(r=t._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=EX(r,n)),r&&r.modifier&&r.modifier(e[n],t,s[i],n))}(t,n)}}}},PX=AX.registerPlugin({name:"attr",init:function(t,e,n,i,r){var s,a,o;for(s in this.tween=n,e)o=t.getAttribute(s)||"",(a=this.add(t,"setAttribute",(o||0)+"",e[s],i,r,0,0,s)).op=s,a.b=o,this._props.push(s)},render:function(t,e){for(var n=e._pt;n;)qz?n.set(n.t,n.p,n.b,n):n.r(t,n.d),n=n._next}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n],0,0,0,0,0,1)}},CX("roundProps",cV),CX("modifiers"),CX("snap",uV))||AX;nX.version=WV.version=PX.version="3.12.5",tG=1,GG()&&IV(),OV.Power0,OV.Power1,OV.Power2,OV.Power3,OV.Power4,OV.Linear,OV.Quad,OV.Cubic,OV.Quart,OV.Quint,OV.Strong,OV.Elastic,OV.Back,OV.SteppedEase,OV.Bounce,OV.Sine,OV.Expo,OV.Circ;
/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
var RX,IX,OX,DX,BX,FX,LX,UX,kX={},NX=180/Math.PI,zX=Math.PI/180,GX=Math.atan2,HX=/([A-Z])/g,VX=/(left|right|width|margin|padding|x)/i,XX=/[\s,\(]\S/,WX={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},jX=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},YX=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},qX=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},KX=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},JX=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},ZX=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},QX=function(t,e,n){return t.style[e]=n},$X=function(t,e,n){return t.style.setProperty(e,n)},tW=function(t,e,n){return t._gsap[e]=n},eW=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},nW=function(t,e,n,i,r){var s=t._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},iW=function(t,e,n,i,r){var s=t._gsap;s[e]=n,s.renderTransform(r,s)},rW="transform",sW=rW+"Origin",aW=function t(e,n){var i=this,r=this.target,s=r.style,a=r._gsap;if(e in kX&&s){if(this.tfm=this.tfm||{},"transform"===e)return WX.transform.split(",").forEach(function(e){return t.call(i,e,n)});if(~(e=WX[e]||e).indexOf(",")?e.split(",").forEach(function(t){return i.tfm[t]=TW(r,t)}):this.tfm[e]=a.x?a[e]:TW(r,e),e===sW&&(this.tfm.zOrigin=a.zOrigin),this.props.indexOf(rW)>=0)return;a.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(sW,n,"")),e=rW}(s||n)&&this.props.push(e,n,s[e])},oW=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},lW=function(){var t,e,n=this.props,i=this.target,r=i.style,s=i._gsap;for(t=0;t<n.length;t+=3)n[t+1]?i[n[t]]=n[t+2]:n[t+2]?r[n[t]]=n[t+2]:r.removeProperty("--"===n[t].substr(0,2)?n[t]:n[t].replace(HX,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)s[e]=this.tfm[e];s.svg&&(s.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),(t=LX())&&t.isStart||r[rW]||(oW(r),s.zOrigin&&r[sW]&&(r[sW]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},hW=function(t,e){var n={target:t,props:[],revert:lW,save:aW};return t._gsap||PX.core.getCache(t),e&&e.split(",").forEach(function(t){return n.save(t)}),n},cW=function(t,e){var n=IX.createElementNS?IX.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):IX.createElement(t);return n&&n.style?n:IX.createElement(t)},uW=function t(e,n,i){var r=getComputedStyle(e);return r[n]||r.getPropertyValue(n.replace(HX,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&t(e,pW(n)||n,1)||""},dW="O,Moz,ms,Ms,Webkit".split(","),pW=function(t,e,n){var i=(e||BX).style,r=5;if(t in i&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);r--&&!(dW[r]+t in i););return r<0?null:(3===r?"ms":r>=0?dW[r]:"")+t},fW=function(){"undefined"!=typeof window&&window.document&&(RX=window,IX=RX.document,OX=IX.documentElement,BX=cW("div")||{style:{}},cW("div"),rW=pW(rW),sW=rW+"Origin",BX.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",UX=!!pW("perspective"),LX=PX.core.reverting,DX=1)},mW=function t(e){var n,i=cW("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,s=this.nextSibling,a=this.style.cssText;if(OX.appendChild(i),i.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(S6){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(s?r.insertBefore(this,s):r.appendChild(this)),OX.removeChild(i),this.style.cssText=a,n},gW=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},vW=function(t){var e;try{e=t.getBBox()}catch(n){e=mW.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===mW||(e=mW.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+gW(t,["x","cx","x1"])||0,y:+gW(t,["y","cy","y1"])||0,width:0,height:0}},yW=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!vW(t))},xW=function(t,e){if(e){var n,i=t.style;e in kX&&e!==sW&&(e=rW),i.removeProperty?("ms"!==(n=e.substr(0,2))&&"webkit"!==e.substr(0,6)||(e="-"+e),i.removeProperty("--"===n?e:e.replace(HX,"-$1").toLowerCase())):i.removeAttribute(e)}},bW=function(t,e,n,i,r,s){var a=new gX(t._pt,e,n,0,1,s?ZX:JX);return t._pt=a,a.b=i,a.e=r,t._props.push(n),a},_W={deg:1,rad:1,turn:1},SW={grid:1,flex:1},wW=function t(e,n,i,r){var s,a,o,l,h=parseFloat(i)||0,c=(i+"").trim().substr((h+"").length)||"px",u=BX.style,d=VX.test(n),p="svg"===e.tagName.toLowerCase(),f=(p?"client":"offset")+(d?"Width":"Height"),m=100,g="px"===r,v="%"===r;if(r===c||!h||_W[r]||_W[c])return h;if("px"!==c&&!g&&(h=t(e,n,i,"px")),l=e.getCTM&&yW(e),(v||"%"===c)&&(kX[n]||~n.indexOf("adius")))return s=l?e.getBBox()[d?"width":"height"]:e[f],bH(v?h/s*m:h/100*s);if(u[d?"width":"height"]=m+(g?c:r),a=~n.indexOf("adius")||"em"===r&&e.appendChild&&!p?e:e.parentNode,l&&(a=(e.ownerSVGElement||{}).parentNode),a&&a!==IX&&a.appendChild||(a=IX.body),(o=a._gsap)&&v&&o.width&&d&&o.time===RV.time&&!o.uncache)return bH(h/o.width*m);if(!v||"height"!==n&&"width"!==n)(v||"%"===c)&&!SW[uW(a,"display")]&&(u.position=uW(e,"position")),a===e&&(u.position="static"),a.appendChild(BX),s=BX[f],a.removeChild(BX),u.position="absolute";else{var y=e.style[n];e.style[n]=m+r,s=e[f],y?e.style[n]=y:xW(e,n)}return d&&v&&((o=vH(a)).time=RV.time,o.width=a[f]),bH(g?s*h/m:s&&h?m/s*h:0)},TW=function(t,e,n,i){var r;return DX||fW(),e in WX&&"transform"!==e&&~(e=WX[e]).indexOf(",")&&(e=e.split(",")[0]),kX[e]&&"transform"!==e?(r=LW(t,i),r="transformOrigin"!==e?r[e]:r.svg?r.origin:UW(uW(t,sW))+" "+r.zOrigin+"px"):(!(r=t.style[e])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=PW[e]&&PW[e](t,e,n)||uW(t,e)||yH(t,e)||("opacity"===e?1:0)),n&&!~(r+"").trim().indexOf(" ")?wW(t,e,r,n)+n:r},MW=function(t,e,n,i){if(!n||"none"===n){var r=pW(e,t,1),s=r&&uW(t,r,1);s&&s!==n?(e=r,n=s):"borderColor"===e&&(n=uW(t,"borderTopColor"))}var a,o,l,h,c,u,d,p,f,m,g,v=new gX(this._pt,t.style,e,0,1,cX),y=0,x=0;if(v.b=n,v.e=i,n+="","auto"===(i+="")&&(u=t.style[e],t.style[e]=i,i=uW(t,e)||i,u?t.style[e]=u:xW(t,e)),PV(a=[n,i]),i=a[1],l=(n=a[0]).match(YG)||[],(i.match(YG)||[]).length){for(;o=YG.exec(i);)d=o[0],f=i.substring(y,o.index),c?c=(c+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(c=1),d!==(u=l[x++]||"")&&(h=parseFloat(u)||0,g=u.substr((h+"").length),"="===d.charAt(1)&&(d=SH(h,d)+g),p=parseFloat(d),m=d.substr((p+"").length),y=YG.lastIndex-m.length,m||(m=m||MG.units[e]||g,y===i.length&&(i+=m,v.e+=m)),g!==m&&(h=wW(t,e,u,m)||0),v._pt={_next:v._pt,p:f||1===x?f:",",s:h,c:p-h,m:c&&c<4||"zIndex"===e?Math.round:0});v.c=y<i.length?i.substring(y,i.length):""}else v.r="display"===e&&"none"===i?ZX:JX;return KG.test(i)&&(v.e=0),this._pt=v,v},AW={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},EW=function(t){var e=t.split(" "),n=e[0],i=e[1]||"50%";return"top"!==n&&"bottom"!==n&&"left"!==i&&"right"!==i||(t=n,n=i,i=t),e[0]=AW[n]||n,e[1]=AW[i]||i,e.join(" ")},CW=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,i,r,s=e.t,a=s.style,o=e.u,l=s._gsap;if("all"===o||!0===o)a.cssText="",i=1;else for(r=(o=o.split(",")).length;--r>-1;)n=o[r],kX[n]&&(i=1,n="transformOrigin"===n?sW:rW),xW(s,n);i&&(xW(s,rW),l&&(l.svg&&s.removeAttribute("transform"),LW(s,1),l.uncache=1,oW(a)))}},PW={clearProps:function(t,e,n,i,r){if("isFromStart"!==r.data){var s=t._pt=new gX(t._pt,e,n,0,0,CW);return s.u=i,s.pr=-10,s.tween=r,t._props.push(n),1}}},RW=[1,0,0,1,0,0],IW={},OW=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},DW=function(t){var e=uW(t,rW);return OW(e)?RW:e.substr(7).match(jG).map(bH)},BW=function(t,e){var n,i,r,s,a=t._gsap||vH(t),o=t.style,l=DW(t);return a.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(r=t.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?RW:l:(l!==RW||t.offsetParent||t===OX||a.svg||(r=o.display,o.display="block",(n=t.parentNode)&&t.offsetParent||(s=1,i=t.nextElementSibling,OX.appendChild(t)),l=DW(t),r?o.display=r:xW(t,"display"),s&&(i?n.insertBefore(t,i):n?n.appendChild(t):OX.removeChild(t))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},FW=function(t,e,n,i,r,s){var a,o,l,h=t._gsap,c=r||BW(t,!0),u=h.xOrigin||0,d=h.yOrigin||0,p=h.xOffset||0,f=h.yOffset||0,m=c[0],g=c[1],v=c[2],y=c[3],x=c[4],b=c[5],_=e.split(" "),S=parseFloat(_[0])||0,w=parseFloat(_[1])||0;n?c!==RW&&(o=m*y-g*v)&&(l=S*(-g/o)+w*(m/o)-(m*b-g*x)/o,S=S*(y/o)+w*(-v/o)+(v*b-y*x)/o,w=l):(S=(a=vW(t)).x+(~_[0].indexOf("%")?S/100*a.width:S),w=a.y+(~(_[1]||_[0]).indexOf("%")?w/100*a.height:w)),i||!1!==i&&h.smooth?(x=S-u,b=w-d,h.xOffset=p+(x*m+b*v)-x,h.yOffset=f+(x*g+b*y)-b):h.xOffset=h.yOffset=0,h.xOrigin=S,h.yOrigin=w,h.smooth=!!i,h.origin=e,h.originIsAbsolute=!!n,t.style[sW]="0px 0px",s&&(bW(s,h,"xOrigin",u,S),bW(s,h,"yOrigin",d,w),bW(s,h,"xOffset",p,h.xOffset),bW(s,h,"yOffset",f,h.yOffset)),t.setAttribute("data-svg-origin",S+" "+w)},LW=function(t,e){var n=t._gsap||new VV(t);if("x"in n&&!e&&!n.uncache)return n;var i,r,s,a,o,l,h,c,u,d,p,f,m,g,v,y,x,b,_,S,w,T,M,A,E,C,P,R,I,O,D,B,F=t.style,L=n.scaleX<0,U="px",k="deg",N=getComputedStyle(t),z=uW(t,sW)||"0";return i=r=s=l=h=c=u=d=p=0,a=o=1,n.svg=!(!t.getCTM||!yW(t)),N.translate&&("none"===N.translate&&"none"===N.scale&&"none"===N.rotate||(F[rW]=("none"!==N.translate?"translate3d("+(N.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==N.rotate?"rotate("+N.rotate+") ":"")+("none"!==N.scale?"scale("+N.scale.split(" ").join(",")+") ":"")+("none"!==N[rW]?N[rW]:"")),F.scale=F.rotate=F.translate="none"),g=BW(t,n.svg),n.svg&&(n.uncache?(E=t.getBBox(),z=n.xOrigin-E.x+"px "+(n.yOrigin-E.y)+"px",A=""):A=!e&&t.getAttribute("data-svg-origin"),FW(t,A||z,!!A||n.originIsAbsolute,!1!==n.smooth,g)),f=n.xOrigin||0,m=n.yOrigin||0,g!==RW&&(b=g[0],_=g[1],S=g[2],w=g[3],i=T=g[4],r=M=g[5],6===g.length?(a=Math.sqrt(b*b+_*_),o=Math.sqrt(w*w+S*S),l=b||_?GX(_,b)*NX:0,(u=S||w?GX(S,w)*NX+l:0)&&(o*=Math.abs(Math.cos(u*zX))),n.svg&&(i-=f-(f*b+m*S),r-=m-(f*_+m*w))):(B=g[6],O=g[7],P=g[8],R=g[9],I=g[10],D=g[11],i=g[12],r=g[13],s=g[14],h=(v=GX(B,I))*NX,v&&(A=T*(y=Math.cos(-v))+P*(x=Math.sin(-v)),E=M*y+R*x,C=B*y+I*x,P=T*-x+P*y,R=M*-x+R*y,I=B*-x+I*y,D=O*-x+D*y,T=A,M=E,B=C),c=(v=GX(-S,I))*NX,v&&(y=Math.cos(-v),D=w*(x=Math.sin(-v))+D*y,b=A=b*y-P*x,_=E=_*y-R*x,S=C=S*y-I*x),l=(v=GX(_,b))*NX,v&&(A=b*(y=Math.cos(v))+_*(x=Math.sin(v)),E=T*y+M*x,_=_*y-b*x,M=M*y-T*x,b=A,T=E),h&&Math.abs(h)+Math.abs(l)>359.9&&(h=l=0,c=180-c),a=bH(Math.sqrt(b*b+_*_+S*S)),o=bH(Math.sqrt(M*M+B*B)),v=GX(T,M),u=Math.abs(v)>2e-4?v*NX:0,p=D?1/(D<0?-D:D):0),n.svg&&(A=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!OW(uW(t,rW)),A&&t.setAttribute("transform",A))),Math.abs(u)>90&&Math.abs(u)<270&&(L?(a*=-1,u+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,u+=u<=0?180:-180)),e=e||n.uncache,n.x=i-((n.xPercent=i&&(!e&&n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-i)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+U,n.y=r-((n.yPercent=r&&(!e&&n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-r)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+U,n.z=s+U,n.scaleX=bH(a),n.scaleY=bH(o),n.rotation=bH(l)+k,n.rotationX=bH(h)+k,n.rotationY=bH(c)+k,n.skewX=u+k,n.skewY=d+k,n.transformPerspective=p+U,(n.zOrigin=parseFloat(z.split(" ")[2])||!e&&n.zOrigin||0)&&(F[sW]=UW(z)),n.xOffset=n.yOffset=0,n.force3D=MG.force3D,n.renderTransform=n.svg?XW:UX?VW:NW,n.uncache=0,n},UW=function(t){return(t=t.split(" "))[0]+" "+t[1]},kW=function(t,e,n){var i=iV(e);return bH(parseFloat(e)+parseFloat(wW(t,"x",n+"px",i)))+i},NW=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,VW(t,e)},zW="0deg",GW="0px",HW=") ",VW=function(t,e){var n=e||this,i=n.xPercent,r=n.yPercent,s=n.x,a=n.y,o=n.z,l=n.rotation,h=n.rotationY,c=n.rotationX,u=n.skewX,d=n.skewY,p=n.scaleX,f=n.scaleY,m=n.transformPerspective,g=n.force3D,v=n.target,y=n.zOrigin,x="",b="auto"===g&&t&&1!==t||!0===g;if(y&&(c!==zW||h!==zW)){var _,S=parseFloat(h)*zX,w=Math.sin(S),T=Math.cos(S);S=parseFloat(c)*zX,_=Math.cos(S),s=kW(v,s,w*_*-y),a=kW(v,a,-Math.sin(S)*-y),o=kW(v,o,T*_*-y+y)}m!==GW&&(x+="perspective("+m+HW),(i||r)&&(x+="translate("+i+"%, "+r+"%) "),(b||s!==GW||a!==GW||o!==GW)&&(x+=o!==GW||b?"translate3d("+s+", "+a+", "+o+") ":"translate("+s+", "+a+HW),l!==zW&&(x+="rotate("+l+HW),h!==zW&&(x+="rotateY("+h+HW),c!==zW&&(x+="rotateX("+c+HW),u===zW&&d===zW||(x+="skew("+u+", "+d+HW),1===p&&1===f||(x+="scale("+p+", "+f+HW),v.style[rW]=x||"translate(0, 0)"},XW=function(t,e){var n,i,r,s,a,o=e||this,l=o.xPercent,h=o.yPercent,c=o.x,u=o.y,d=o.rotation,p=o.skewX,f=o.skewY,m=o.scaleX,g=o.scaleY,v=o.target,y=o.xOrigin,x=o.yOrigin,b=o.xOffset,_=o.yOffset,S=o.forceCSS,w=parseFloat(c),T=parseFloat(u);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=zX,p*=zX,n=Math.cos(d)*m,i=Math.sin(d)*m,r=Math.sin(d-p)*-g,s=Math.cos(d-p)*g,p&&(f*=zX,a=Math.tan(p-f),r*=a=Math.sqrt(1+a*a),s*=a,f&&(a=Math.tan(f),n*=a=Math.sqrt(1+a*a),i*=a)),n=bH(n),i=bH(i),r=bH(r),s=bH(s)):(n=m,s=g,i=r=0),(w&&!~(c+"").indexOf("px")||T&&!~(u+"").indexOf("px"))&&(w=wW(v,"x",c,"px"),T=wW(v,"y",u,"px")),(y||x||b||_)&&(w=bH(w+y-(y*n+x*r)+b),T=bH(T+x-(y*i+x*s)+_)),(l||h)&&(a=v.getBBox(),w=bH(w+l/100*a.width),T=bH(T+h/100*a.height)),a="matrix("+n+","+i+","+r+","+s+","+w+","+T+")",v.setAttribute("transform",a),S&&(v.style[rW]=a)},WW=function(t,e,n,i,r){var s,a,o=360,l=FG(r),h=parseFloat(r)*(l&&~r.indexOf("rad")?NX:1)-i,c=i+h+"deg";return l&&("short"===(s=r.split("_")[1])&&(h%=o)!==h%180&&(h+=h<0?o:-360),"cw"===s&&h<0?h=(h+36e9)%o-~~(h/o)*o:"ccw"===s&&h>0&&(h=(h-36e9)%o-~~(h/o)*o)),t._pt=a=new gX(t._pt,e,n,i,h,YX),a.e=c,a.u="deg",t._props.push(n),a},jW=function(t,e){for(var n in e)t[n]=e[n];return t},YW=function(t,e,n){var i,r,s,a,o,l,h,c=jW({},n._gsap),u=n.style;for(r in c.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),u[rW]=e,i=LW(n,1),xW(n,rW),n.setAttribute("transform",s)):(s=getComputedStyle(n)[rW],u[rW]=e,i=LW(n,1),u[rW]=s),kX)(s=c[r])!==(a=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(o=iV(s)!==(h=iV(a))?wW(n,r,s,h):parseFloat(s),l=parseFloat(a),t._pt=new gX(t._pt,i,r,o,l-o,jX),t._pt.u=h||0,t._props.push(r));jW(i,c)};xH("padding,margin,Width,Radius",function(t,e){var n="Top",i="Right",r="Bottom",s="Left",a=(e<3?[n,i,r,s]:[n+s,n+i,r+i,r+s]).map(function(n){return e<2?t+n:"border"+n+t});PW[e>1?"border"+t:t]=function(t,e,n,i,r){var s,o;if(arguments.length<4)return s=a.map(function(e){return TW(t,e,n)}),5===(o=s.join(" ")).split(s[0]).length?s[0]:o;s=(i+"").split(" "),o={},a.forEach(function(t,e){return o[t]=s[e]=s[e]||s[(e-1)/2|0]}),t.init(e,o,r)}});var qW,KW,JW,ZW={name:"css",register:fW,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,i,r){var s,a,o,l,h,c,u,d,p,f,m,g,v,y,x,b,_=this._props,S=t.style,w=n.vars.startAt;for(u in DX||fW(),this.styles=this.styles||hW(t),b=this.styles.props,this.tween=n,e)if("autoRound"!==u&&(a=e[u],!uH[u]||!JV(u,e,n,i,t,r)))if(h=typeof a,c=PW[u],"function"===h&&(h=typeof(a=a.call(n,i,t,r))),"string"===h&&~a.indexOf("random(")&&(a=fV(a)),c)c(this,t,u,a,n)&&(x=1);else if("--"===u.substr(0,2))s=(getComputedStyle(t).getPropertyValue(u)+"").trim(),a+="",EV.lastIndex=0,EV.test(s)||(d=iV(s),p=iV(a)),p?d!==p&&(s=wW(t,u,s,p)+p):d&&(a+=d),this.add(S,"setProperty",s,a,i,r,0,0,u),_.push(u),b.push(u,0,S[u]);else if("undefined"!==h){if(w&&u in w?(s="function"==typeof w[u]?w[u].call(n,i,t,r):w[u],FG(s)&&~s.indexOf("random(")&&(s=fV(s)),iV(s+"")||"auto"===s||(s+=MG.units[u]||iV(TW(t,u))||""),"="===(s+"").charAt(1)&&(s=TW(t,u))):s=TW(t,u),l=parseFloat(s),(f="string"===h&&"="===a.charAt(1)&&a.substr(0,2))&&(a=a.substr(2)),o=parseFloat(a),u in WX&&("autoAlpha"===u&&(1===l&&"hidden"===TW(t,"visibility")&&o&&(l=0),b.push("visibility",0,S.visibility),bW(this,S,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==u&&"transform"!==u&&~(u=WX[u]).indexOf(",")&&(u=u.split(",")[0])),m=u in kX)if(this.styles.save(u),g||((v=t._gsap).renderTransform&&!e.parseTransform||LW(t,e.parseTransform),y=!1!==e.smoothOrigin&&v.smooth,(g=this._pt=new gX(this._pt,S,rW,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===u)this._pt=new gX(this._pt,v,"scaleY",v.scaleY,(f?SH(v.scaleY,f+o):o)-v.scaleY||0,jX),this._pt.u=0,_.push("scaleY",u),u+="X";else{if("transformOrigin"===u){b.push(sW,0,S[sW]),a=EW(a),v.svg?FW(t,a,0,y,0,this):((p=parseFloat(a.split(" ")[2])||0)!==v.zOrigin&&bW(this,v,"zOrigin",v.zOrigin,p),bW(this,S,u,UW(s),UW(a)));continue}if("svgOrigin"===u){FW(t,a,1,y,0,this);continue}if(u in IW){WW(this,v,u,l,f?SH(l,f+a):a);continue}if("smoothOrigin"===u){bW(this,v,"smooth",v.smooth,a);continue}if("force3D"===u){v[u]=a;continue}if("transform"===u){YW(this,a,t);continue}}else u in S||(u=pW(u)||u);if(m||(o||0===o)&&(l||0===l)&&!XX.test(a)&&u in S)o||(o=0),(d=(s+"").substr((l+"").length))!==(p=iV(a)||(u in MG.units?MG.units[u]:d))&&(l=wW(t,u,s,p)),this._pt=new gX(this._pt,m?v:S,u,l,(f?SH(l,f+o):o)-l,m||"px"!==p&&"zIndex"!==u||!1===e.autoRound?jX:KX),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=s,this._pt.r=qX);else if(u in S)MW.call(this,t,u,s,f?f+a:a);else if(u in t)this.add(t,u,s||t[u],f?f+a:a,i,r);else if("parseTransform"!==u){eH();continue}m||(u in S?b.push(u,0,S[u]):b.push(u,1,s||t[u])),_.push(u)}x&&mX(this)},render:function(t,e){if(e.tween._time||!LX())for(var n=e._pt;n;)n.r(t,n.d),n=n._next;else e.styles.revert()},get:TW,aliases:WX,getSetter:function(t,e,n){var i=WX[e];return i&&i.indexOf(",")<0&&(e=i),e in kX&&e!==sW&&(t._gsap.x||TW(t,"x"))?n&&FX===n?"scale"===e?eW:tW:(FX=n||{})&&("scale"===e?nW:iW):t.style&&!kG(t.style[e])?QX:~e.indexOf("-")?$X:oX(t,e)},core:{_removeProperty:xW,_getMatrix:BW}};PX.utils.checkPrefix=pW,PX.core.getStyleSaver=hW,JW=xH((qW="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(KW="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(t){kX[t]=1}),xH(KW,function(t){MG.units[t]="deg",IW[t]=1}),WX[JW[13]]=qW+","+KW,xH("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(t){var e=t.split(":");WX[e[1]]=JW[e[0]]}),xH("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(t){MG.units[t]="px"}),PX.registerPlugin(ZW);var QW=PX.registerPlugin(ZW)||PX;QW.core.Tween;var $W={};
/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */!function(t){!function(){var e=function(){this.init()};e.prototype={init:function(){var t=this||n;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||n;if(t=parseFloat(t),e.ctx||c(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,n.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var r=e._howls[i]._getSoundIds(),s=0;s<r.length;s++){var a=e._howls[i]._soundById(r[s]);a&&a._node&&(a._node.volume=a._volume*t)}return e}return e._volume},mute:function(t){var e=this||n;e.ctx||c(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,n.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var r=e._howls[i]._getSoundIds(),s=0;s<r.length;s++){var a=e._howls[i]._soundById(r[s]);a&&a._node&&(a._node.muted=!!t||a._muted)}return e},stop:function(){for(var t=this||n,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||n,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,c()),t},codecs:function(t){return(this||n)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||n;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(S6){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(S6){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||n,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(c){return t}if(!e||"function"!=typeof e.canPlayType)return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),r=t._navigator?t._navigator.userAgent:"",s=r.match(/OPR\/(\d+)/g),a=s&&parseInt(s[0].split("/")[1],10)<33,o=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),l=r.match(/Version\/(.*?) /),h=o&&l&&parseInt(l[1],10)<15;return t._codecs={mp3:!(a||!i&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(h||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(h||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||n;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(n){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var i=new Audio;i._unlocked=!0,t._releaseHtml5Audio(i)}catch(h){t.noAudio=!0;break}for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var s=t._howls[r]._getSoundIds(),a=0;a<s.length;a++){var o=t._howls[r]._soundById(s[a]);o&&o._node&&!o._node._unlocked&&(o._node._unlocked=!0,o._node.load())}t._autoResume();var l=t.ctx.createBufferSource();l.buffer=t._scratchBuffer,l.connect(t.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),l.onended=function(){l.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var n=0;n<t._howls.length;n++)t._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||n;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch(function(){}),new Audio},_releaseHtml5Audio:function(t){var e=this||n;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&n.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}},3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&n.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var n=new e,i=function(t){t.src&&0!==t.src.length&&this.init(t)};i.prototype={init:function(t){var e=this;return n.ctx||c(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=n.usingWebAudio&&!e._html5,void 0!==n.ctx&&n.ctx&&n.autoUnlock&&n._unlockAudio(),n._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=this,e=null;if(n.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var i=0;i<t._src.length;i++){var s,o;if(t._format&&t._format[i])s=t._format[i];else{if("string"!=typeof(o=t._src[i])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(s=/^data:audio\/([^;,]+);/i.exec(o))||(s=/\.([^.]+)$/.exec(o.split("?",1)[0])),s&&(s=s[1].toLowerCase())}if(s&&n.codecs(s)){e=t._src[i];break}}if(e)return t._src=e,t._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new r(t),t._webAudio&&a(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var i=this,r=null;if("number"==typeof t)r=t,t=null;else{if("string"==typeof t&&"loaded"===i._state&&!i._sprite[t])return null;if(void 0===t&&(t="__default",!i._playLock)){for(var s=0,a=0;a<i._sounds.length;a++)i._sounds[a]._paused&&!i._sounds[a]._ended&&(s++,r=i._sounds[a]._id);1===s?t=null:r=null}}var o=r?i._soundById(r):i._inactiveSound();if(!o)return null;if(r&&!t&&(t=o._sprite||"__default"),"loaded"!==i._state){o._sprite=t,o._ended=!1;var l=o._id;return i._queue.push({event:"play",action:function(){i.play(l)}}),l}if(r&&!o._paused)return e||i._loadQueue("play"),o._id;i._webAudio&&n._autoResume();var h=Math.max(0,o._seek>0?o._seek:i._sprite[t][0]/1e3),c=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-h),u=1e3*c/Math.abs(o._rate),d=i._sprite[t][0]/1e3,p=(i._sprite[t][0]+i._sprite[t][1])/1e3;o._sprite=t,o._ended=!1;var f=function(){o._paused=!1,o._seek=h,o._start=d,o._stop=p,o._loop=!(!o._loop&&!i._sprite[t][2])};if(!(h>=p)){var m=o._node;if(i._webAudio){var g=function(){i._playLock=!1,f(),i._refreshBuffer(o);var t=o._muted||i._muted?0:o._volume;m.gain.setValueAtTime(t,n.ctx.currentTime),o._playStart=n.ctx.currentTime,void 0===m.bufferSource.start?o._loop?m.bufferSource.noteGrainOn(0,h,86400):m.bufferSource.noteGrainOn(0,h,c):o._loop?m.bufferSource.start(0,h,86400):m.bufferSource.start(0,h,c),u!==1/0&&(i._endTimers[o._id]=setTimeout(i._ended.bind(i,o),u)),e||setTimeout(function(){i._emit("play",o._id),i._loadQueue()},0)};"running"===n.state&&"interrupted"!==n.ctx.state?g():(i._playLock=!0,i.once("resume",g),i._clearTimer(o._id))}else{var v=function(){m.currentTime=h,m.muted=o._muted||i._muted||n._muted||m.muted,m.volume=o._volume*n.volume(),m.playbackRate=o._rate;try{var r=m.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(i._playLock=!0,f(),r.then(function(){i._playLock=!1,m._unlocked=!0,e?i._loadQueue():i._emit("play",o._id)}).catch(function(){i._playLock=!1,i._emit("playerror",o._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),o._ended=!0,o._paused=!0})):e||(i._playLock=!1,f(),i._emit("play",o._id)),m.playbackRate=o._rate,m.paused)return void i._emit("playerror",o._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||o._loop?i._endTimers[o._id]=setTimeout(i._ended.bind(i,o),u):(i._endTimers[o._id]=function(){i._ended(o),m.removeEventListener("ended",i._endTimers[o._id],!1)},m.addEventListener("ended",i._endTimers[o._id],!1))}catch(s){i._emit("playerror",o._id,s)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===m.src&&(m.src=i._src,m.load());var y=window&&window.ejecta||!m.readyState&&n._navigator.isCocoonJS;if(m.readyState>=3||y)v();else{i._playLock=!0,i._state="loading";var x=function(){i._state="loaded",v(),m.removeEventListener(n._canPlayEvent,x,!1)};m.addEventListener(n._canPlayEvent,x,!1),i._clearTimer(o._id)}}return o._id}i._ended(o)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var n=e._getSoundIds(t),i=0;i<n.length;i++){e._clearTimer(n[i]);var r=e._soundById(n[i]);if(r&&!r._paused&&(r._seek=e.seek(n[i]),r._rateSeek=0,r._paused=!0,e._stopFade(n[i]),r._node))if(e._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),e._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||e._emit("pause",r?r._id:null)}return e},stop:function(t,e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(t)}}),n;for(var i=n._getSoundIds(t),r=0;r<i.length;r++){n._clearTimer(i[r]);var s=n._soundById(i[r]);s&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,n._stopFade(i[r]),s._node&&(n._webAudio?s._node.bufferSource&&(void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),n._cleanBuffer(s._node)):isNaN(s._node.duration)&&s._node.duration!==1/0||(s._node.currentTime=s._start||0,s._node.pause(),s._node.duration===1/0&&n._clearSound(s._node))),e||n._emit("stop",s._id))}return n},mute:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if(void 0===e){if("boolean"!=typeof t)return i._muted;i._muted=t}for(var r=i._getSoundIds(e),s=0;s<r.length;s++){var a=i._soundById(r[s]);a&&(a._muted=t,a._interval&&i._stopFade(a._id),i._webAudio&&a._node?a._node.gain.setValueAtTime(t?0:a._volume,n.ctx.currentTime):a._node&&(a._node.muted=!!n._muted||t),i._emit("mute",a._id))}return i},volume:function(){var t,e,i,r=this,s=arguments;if(0===s.length)return r._volume;if(1===s.length||2===s.length&&void 0===s[1]?r._getSoundIds().indexOf(s[0])>=0?e=parseInt(s[0],10):t=parseFloat(s[0]):s.length>=2&&(t=parseFloat(s[0]),e=parseInt(s[1],10)),!(void 0!==t&&t>=0&&t<=1))return(i=e?r._soundById(e):r._sounds[0])?i._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,s)}}),r;void 0===e&&(r._volume=t),e=r._getSoundIds(e);for(var a=0;a<e.length;a++)(i=r._soundById(e[a]))&&(i._volume=t,s[2]||r._stopFade(e[a]),r._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(t,n.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=t*n.volume()),r._emit("volume",i._id));return r},fade:function(t,e,i,r){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(t,e,i,r)}}),s;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),i=parseFloat(i),s.volume(t,r);for(var a=s._getSoundIds(r),o=0;o<a.length;o++){var l=s._soundById(a[o]);if(l){if(r||s._stopFade(a[o]),s._webAudio&&!l._muted){var h=n.ctx.currentTime,c=h+i/1e3;l._volume=t,l._node.gain.setValueAtTime(t,h),l._node.gain.linearRampToValueAtTime(e,c)}s._startFadeInterval(l,t,e,i,a[o],void 0===r)}}return s},_startFadeInterval:function(t,e,n,i,r,s){var a=this,o=e,l=n-e,h=Math.abs(l/.01),c=Math.max(4,h>0?i/h:i),u=Date.now();t._fadeTo=n,t._interval=setInterval(function(){var r=(Date.now()-u)/i;u=Date.now(),o+=l*r,o=Math.round(100*o)/100,o=l<0?Math.max(n,o):Math.min(n,o),a._webAudio?t._volume=o:a.volume(o,t._id,!0),s&&(a._volume=o),(n<e&&o<=n||n>e&&o>=n)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,a.volume(n,t._id),a._emit("fade",t._id))},c)},_stopFade:function(t){var e=this,i=e._soundById(t);return i&&i._interval&&(e._webAudio&&i._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(i._interval),i._interval=null,e.volume(i._fadeTo,t),i._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t,e,n,i=this,r=arguments;if(0===r.length)return i._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(n=i._soundById(parseInt(r[0],10)))&&n._loop;t=r[0],i._loop=t}else 2===r.length&&(t=r[0],e=parseInt(r[1],10));for(var s=i._getSoundIds(e),a=0;a<s.length;a++)(n=i._soundById(s[a]))&&(n._loop=t,i._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=t,t&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,i.playing(s[a])&&(i.pause(s[a],!0),i.play(s[a],!0)))));return i},rate:function(){var t,e,i,r=this,s=arguments;if(0===s.length)e=r._sounds[0]._id;else if(1===s.length){r._getSoundIds().indexOf(s[0])>=0?e=parseInt(s[0],10):t=parseFloat(s[0])}else 2===s.length&&(t=parseFloat(s[0]),e=parseInt(s[1],10));if("number"!=typeof t)return(i=r._soundById(e))?i._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,s)}}),r;void 0===e&&(r._rate=t),e=r._getSoundIds(e);for(var a=0;a<e.length;a++)if(i=r._soundById(e[a])){r.playing(e[a])&&(i._rateSeek=r.seek(e[a]),i._playStart=r._webAudio?n.ctx.currentTime:i._playStart),i._rate=t,r._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(t,n.ctx.currentTime):i._node&&(i._node.playbackRate=t);var o=r.seek(e[a]),l=1e3*((r._sprite[i._sprite][0]+r._sprite[i._sprite][1])/1e3-o)/Math.abs(i._rate);!r._endTimers[e[a]]&&i._paused||(r._clearTimer(e[a]),r._endTimers[e[a]]=setTimeout(r._ended.bind(r,i),l)),r._emit("rate",i._id)}return r},seek:function(){var t,e,i=this,r=arguments;if(0===r.length)i._sounds.length&&(e=i._sounds[0]._id);else if(1===r.length){i._getSoundIds().indexOf(r[0])>=0?e=parseInt(r[0],10):i._sounds.length&&(e=i._sounds[0]._id,t=parseFloat(r[0]))}else 2===r.length&&(t=parseFloat(r[0]),e=parseInt(r[1],10));if(void 0===e)return 0;if("number"==typeof t&&("loaded"!==i._state||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,r)}}),i;var s=i._soundById(e);if(s){if(!("number"==typeof t&&t>=0)){if(i._webAudio){var a=i.playing(e)?n.ctx.currentTime-s._playStart:0,o=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(o+a*Math.abs(s._rate))}return s._node.currentTime}var l=i.playing(e);l&&i.pause(e,!0),s._seek=t,s._ended=!1,i._clearTimer(e),i._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=t);var h=function(){l&&i.play(e,!0),i._emit("seek",e)};if(l&&!i._webAudio){var c=function(){i._playLock?setTimeout(c,0):h()};setTimeout(c,0)}else h()}return i},playing:function(t){var e=this;if("number"==typeof t){var n=e._soundById(t);return!!n&&!n._paused}for(var i=0;i<e._sounds.length;i++)if(!e._sounds[i]._paused)return!0;return!1},duration:function(t){var e=this,n=e._duration,i=e._soundById(t);return i&&(n=e._sprite[i._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++)e[i]._paused||t.stop(e[i]._id),t._webAudio||(t._clearSound(e[i]._node),e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(n._canPlayEvent,e[i]._loadFn,!1),e[i]._node.removeEventListener("ended",e[i]._endFn,!1),n._releaseHtml5Audio(e[i]._node)),delete e[i]._node,t._clearTimer(e[i]._id);var r=n._howls.indexOf(t);r>=0&&n._howls.splice(r,1);var a=!0;for(i=0;i<n._howls.length;i++)if(n._howls[i]._src===t._src||t._src.indexOf(n._howls[i]._src)>=0){a=!1;break}return s&&a&&delete s[t._src],n.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,n,i){var r=this["_on"+t];return"function"==typeof e&&r.push(i?{id:n,fn:e,once:i}:{id:n,fn:e}),this},off:function(t,e,n){var i=this,r=i["_on"+t],s=0;if("number"==typeof e&&(n=e,e=null),e||n)for(s=0;s<r.length;s++){var a=n===r[s].id;if(e===r[s].fn&&a||!e&&a){r.splice(s,1);break}}else if(t)i["_on"+t]=[];else{var o=Object.keys(i);for(s=0;s<o.length;s++)0===o[s].indexOf("_on")&&Array.isArray(i[o[s]])&&(i[o[s]]=[])}return i},once:function(t,e,n){return this.on(t,e,n,1),this},_emit:function(t,e,n){for(var i=this,r=i["_on"+t],s=r.length-1;s>=0;s--)r[s].id&&r[s].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,n)}.bind(i,r[s].fn),0),r[s].once&&i.off(t,r[s].fn,r[s].id));return i._loadQueue(t),i},_loadQueue:function(t){var e=this;if(e._queue.length>0){var n=e._queue[0];n.event===t&&(e._queue.shift(),e._loadQueue()),t||n.action()}return e},_ended:function(t){var e=this,i=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var r=!(!t._loop&&!e._sprite[i][2]);if(e._emit("end",t._id),!e._webAudio&&r&&e.stop(t._id,!0).play(t._id),e._webAudio&&r){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=n.ctx.currentTime;var s=1e3*(t._stop-t._start)/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),s)}return e._webAudio&&!r&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),n._autoSuspend()),e._webAudio||r||e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if("function"!=typeof e._endTimers[t])clearTimeout(e._endTimers[t]);else{var n=e._soundById(t);n&&n._node&&n._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,n=0;n<e._sounds.length;n++)if(t===e._sounds[n]._id)return e._sounds[n];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new r(t)},_drain:function(){var t=this,e=t._pool,n=0,i=0;if(!(t._sounds.length<e)){for(i=0;i<t._sounds.length;i++)t._sounds[i]._ended&&n++;for(i=t._sounds.length-1;i>=0;i--){if(n<=e)return;t._sounds[i]._ended&&(t._webAudio&&t._sounds[i]._node&&t._sounds[i]._node.disconnect(0),t._sounds.splice(i,1),n--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],n=0;n<this._sounds.length;n++)e.push(this._sounds[n]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=n.ctx.createBufferSource(),t._node.bufferSource.buffer=s[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,n.ctx.currentTime),this},_cleanBuffer:function(t){var e=n._navigator&&n._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return this;if(n._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=n._scratchBuffer}catch(S6){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(t){this._parent=t,this.init()};r.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++n._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,i=n._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),t._node.gain.setValueAtTime(i,n.ctx.currentTime),t._node.paused=!0,t._node.connect(n.masterGain)):n.noAudio||(t._node=n._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(n._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=!0===e._preload?"auto":e._preload,t._node.volume=i*n.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++n._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(n._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(10*t._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var s={},a=function(t){var e=t._src;if(s[e])return t._duration=s[e].duration,void h(t);if(/^data:[^;]+;base64,/.test(e)){for(var n=atob(e.split(",")[1]),i=new Uint8Array(n.length),r=0;r<n.length;++r)i[r]=n.charCodeAt(r);l(i.buffer,t)}else{var a=new Object;a.open(t._xhr.method,e,!0),a.withCredentials=t._xhr.withCredentials,a.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(e){a.setRequestHeader(e,t._xhr.headers[e])}),a.onload=function(){var e=(a.status+"")[0];"0"===e||"2"===e||"3"===e?l(a.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete s[e],t.load())},o(a)}},o=function(t){try{t.send()}catch(S6){t.onerror()}},l=function(t,e){var i=function(){e._emit("loaderror",null,"Decoding audio data failed.")},r=function(t){t&&e._sounds.length>0?(s[e._src]=t,h(e,t)):i()};"undefined"!=typeof Promise&&1===n.ctx.decodeAudioData.length?n.ctx.decodeAudioData(t).then(r).catch(i):n.ctx.decodeAudioData(t,r,i)},h=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},c=function(){if(n.usingWebAudio){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(S6){n.usingWebAudio=!1}n.ctx||(n.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),e=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=e?parseInt(e[1],10):null;if(t&&i&&i<9){var r=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());n._navigator&&!r&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.setValueAtTime(n._muted?0:n._volume,n.ctx.currentTime),n.masterGain.connect(n.ctx.destination)),n._setup()}};t.Howler=n,t.Howl=i,void 0!==_y?(_y.HowlerGlobal=e,_y.Howler=n,_y.Howl=i,_y.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=n,window.Howl=i,window.Sound=r)}(),
/*!
   *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
   *  
   *  howler.js v2.2.4
   *  howlerjs.com
   *
   *  (c) 2013-2020, James Simpson of GoldFire Studios
   *  goldfirestudios.com
   *
   *  MIT License
   */
function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var e=this;if(!e.ctx||!e.ctx.listener)return e;for(var n=e._howls.length-1;n>=0;n--)e._howls[n].stereo(t);return e},HowlerGlobal.prototype.pos=function(t,e,n){var i=this;return i.ctx&&i.ctx.listener?(e="number"!=typeof e?i._pos[1]:e,n="number"!=typeof n?i._pos[2]:n,"number"!=typeof t?i._pos:(i._pos=[t,e,n],void 0!==i.ctx.listener.positionX?(i.ctx.listener.positionX.setTargetAtTime(i._pos[0],Howler.ctx.currentTime,.1),i.ctx.listener.positionY.setTargetAtTime(i._pos[1],Howler.ctx.currentTime,.1),i.ctx.listener.positionZ.setTargetAtTime(i._pos[2],Howler.ctx.currentTime,.1)):i.ctx.listener.setPosition(i._pos[0],i._pos[1],i._pos[2]),i)):i},HowlerGlobal.prototype.orientation=function(t,e,n,i,r,s){var a=this;if(!a.ctx||!a.ctx.listener)return a;var o=a._orientation;return e="number"!=typeof e?o[1]:e,n="number"!=typeof n?o[2]:n,i="number"!=typeof i?o[3]:i,r="number"!=typeof r?o[4]:r,s="number"!=typeof s?o[5]:s,"number"!=typeof t?o:(a._orientation=[t,e,n,i,r,s],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(s,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(t,e,n,i,r,s),a)},Howl.prototype.init=function(t){return function(e){var n=this;return n._orientation=e.orientation||[1,0,0],n._stereo=e.stereo||null,n._pos=e.pos||null,n._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},n._onstereo=e.onstereo?[{fn:e.onstereo}]:[],n._onpos=e.onpos?[{fn:e.onpos}]:[],n._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,n){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"stereo",action:function(){i.stereo(e,n)}}),i;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return i._stereo;i._stereo=e,i._pos=[e,0,0]}for(var s=i._getSoundIds(n),a=0;a<s.length;a++){var o=i._soundById(s[a]);if(o){if("number"!=typeof e)return o._stereo;o._stereo=e,o._pos=[e,0,0],o._node&&(o._pannerAttr.panningModel="equalpower",o._panner&&o._panner.pan||t(o,r),"spatial"===r?void 0!==o._panner.positionX?(o._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),o._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),o._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):o._panner.setPosition(e,0,0):o._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",o._id)}}return i},Howl.prototype.pos=function(e,n,i,r){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(e,n,i,r)}}),s;if(n="number"!=typeof n?0:n,i="number"!=typeof i?-.5:i,void 0===r){if("number"!=typeof e)return s._pos;s._pos=[e,n,i]}for(var a=s._getSoundIds(r),o=0;o<a.length;o++){var l=s._soundById(a[o]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,n,i],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):l._panner.setPosition(e,n,i)),s._emit("pos",l._id)}}return s},Howl.prototype.orientation=function(e,n,i,r){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(e,n,i,r)}}),s;if(n="number"!=typeof n?s._orientation[1]:n,i="number"!=typeof i?s._orientation[2]:i,void 0===r){if("number"!=typeof e)return s._orientation;s._orientation=[e,n,i]}for(var a=s._getSoundIds(r),o=0;o<a.length;o++){var l=s._soundById(a[o]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,n,i],l._node&&(l._panner||(l._pos||(l._pos=s._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):l._panner.setOrientation(e,n,i)),s._emit("orientation",l._id)}}return s},Howl.prototype.pannerAttr=function(){var e,n,i,r=this,s=arguments;if(!r._webAudio)return r;if(0===s.length)return r._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return(i=r._soundById(parseInt(s[0],10)))?i._pannerAttr:r._pannerAttr;e=s[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:r._panningModel})}else 2===s.length&&(e=s[0],n=parseInt(s[1],10));for(var a=r._getSoundIds(n),o=0;o<a.length;o++)if(i=r._soundById(a[o])){var l=i._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var h=i._panner;h||(i._pos||(i._pos=r._pos||[0,0,-.5]),t(i,"spatial"),h=i._panner),h.coneInnerAngle=l.coneInnerAngle,h.coneOuterAngle=l.coneOuterAngle,h.coneOuterGain=l.coneOuterGain,h.distanceModel=l.distanceModel,h.maxDistance=l.maxDistance,h.refDistance=l.refDistance,h.rolloffFactor=l.rolloffFactor,h.panningModel=l.panningModel}return r},Sound.prototype.init=function(t){return function(){var e=this,n=e._parent;e._orientation=n._orientation,e._stereo=n._stereo,e._pos=n._pos,e._pannerAttr=n._pannerAttr,t.call(this),e._stereo?n.stereo(e._stereo):e._pos&&n.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this,n=e._parent;return e._orientation=n._orientation,e._stereo=n._stereo,e._pos=n._pos,e._pannerAttr=n._pannerAttr,e._stereo?n.stereo(e._stereo):e._pos?n.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,n._refreshBuffer(e)),t.call(this)}}(Sound.prototype.reset);var t=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}()}($W);class tj extends $W.Howl{constructor(t,e=!0,i=.5,r=!0){super({src:[t],loop:e,volume:i}),n(this,"key"),n(this,"canPlayMultipleTimes"),this.canPlayMultipleTimes=r}play(t){return this.playing()&&!this.canPlayMultipleTimes?0:super.play()}stop(){super.stop()}}class ej{constructor(t,e,i=1){n(this,"sound"),n(this,"volume"),n(this,"list",{}),n(this,"playedList",{});let r={};const s=e.spritemap;for(let n in s){let t=s[n],e=1e3*t.start,i=Math.ceil(1e3*t.end-e),a=t.loop;i<.1&&!a&&(i+=.5),r[n]=[e,i,a]}this.list=r,this.sound=new $W.Howl({src:[t],sprite:r,volume:i}),this.volume=i}has(t){return void 0!==this.list[t]}play(t,e=void 0,n=void 0,i=1){if(!this.has(t))return-1;const r=this.sound.play(t);return this.sound.volume(void 0===n?this.volume:n,r),void 0!==e&&this.sound.loop(e,r),this.sound.rate(i,r),this.playedList[t]||(this.playedList[t]=[]),this.playedList[t].push(r),r}stop(t){"string"!=typeof t?this.sound.stop(t):this.playedList[t]&&(this.playedList[t].forEach(t=>{this.sound.stop(t)}),this.playedList[t]=[])}fadeOut(t,e){this.sound.fade(1,0,e,t)}}window.Howler=$W.Howler;const nj=class{static init(){const t=e6.data;if(!t.soundEnabled)return;if(t.musicSrc){const e=new tj(t.musicSrc,!0,t.musicVolume);this.bgMusic=e}t.sfxSrc&&(this.oldSFX=new ej(t.sfxSrc,t.sfxJson,t.sfxVolume));const e={};for(let n in e){let t=e[n];if(!t.src)continue;let i=new Howl({src:[t.src],loop:!1,volume:t.volume??1});this.customSfxList[n]=i}this.initTTS(t.ttsVolume)}static loadSounds(){const t=[],e=app.data.___audioData||{};t.push(...Object.values(e));const n=["bgm","music","bgMusic","backgroundMusic","bg"];t.forEach(t=>{if("sound"===t.type){t.fromDataJs&&!t.src.startsWith("data:")&&(t.src=app.data[t.src]);const e=new tj(t.src,t.loop,1);e.key=t.key,this.musics[t.id]=e,this.bgMusic||!n.includes(t.key)&&!t.isBgMusic||(this.bgMusic=e)}else"audioSprite"===t.type&&(this.sfx=new ej(t.src,t.json,app.data.sfxVolume))})}static initTTS(t=1){const e=e6.data,n=[];for(let i in e)e[i]&&e[i].tts&&n.push(i);for(let i of n){let n=i,r=e[i].tts.data;if(r){let e={sound:new Howl({src:[r],loop:!1,volume:t}),name:i,rawName:n};this.ttsList[n]=e,this.ttsList[i]=e}}}static changeBgMusic(t,e=!1,n=!0,i=1){let r;e&&this.bgMusic&&(r=this.bgMusic.seek(),this.bgMusic.stop());const s=Object.values(this.musics).find(e=>e.key===t);s&&(this.bgMusic=s,this.bgMusic.canPlayMultipleTimes=!1,this.bgMusic.volume(i),this.bgMusic.loop(n),this.bgMusic.play(),r&&this.bgMusic.seek(r))}static playBgMusic(){this.bgMusic&&(this.bgMusic.canPlayMultipleTimes=!1,this.bgMusic.volume(app.data.musicVolume),this.bgMusic.loop(!0),this.bgMusic.play())}static setBgMusicVolume(t){this.bgMusic&&this.bgMusic.volume(t)}static stopBgMusic(){this.bgMusic&&this.bgMusic.stop()}static playSfx(t,e=!1,n=void 0,i=1){return this.playSound(t,e,n,i)}static stopSfx(t){this.stopSound(t)}static isSoundPlaying(t){var e,n;if(this.customSfxList[t])return this.customSfxList[t].playing();if(this.sfx&&this.sfx.has&&this.sfx.has(t)){const n=null==(e=this.sfx.playedList)?void 0:e[t];if(Array.isArray(n)&&n&&n.length>0)return n.some(t=>{var e;return null==(e=this.sfx)?void 0:e.sound.playing(t)})}if(this.oldSFX&&this.oldSFX.has&&this.oldSFX.has(t)){const e=null==(n=this.oldSFX.playedList)?void 0:n[t];if(Array.isArray(e)&&e&&e.length>0)return e.some(t=>{var e;return null==(e=this.oldSFX)?void 0:e.sound.playing(t)})}const i=Object.values(this.musics).find(e=>e.key===t);return!(!i||!i.playing)&&i.playing()}static playSoundInternal(t,e=void 0,n=void 0,i=1){if(!1===app.data.sfxEnabled)return-1;n=n??T.sfxVolume;const r=Object.values(this.musics).find(e=>e.key===t);return r?(r.volume(n),e&&r.loop(e),r.rate(i),r.play()):-1}static playSound(t,e=void 0,n=void 0,i=1){if(app.data.sfxEnabled)return void 0!==n?n*=T.sfxVolume:n=T.sfxVolume,this.customSfxList[t]?this.customSfxList[t].play():this.sfx&&this.sfx.has(t)?this.sfx.play(t,e,n,i):this.oldSFX&&this.oldSFX.has(t)?this.oldSFX.play(t,e,n,i):this.playSoundInternal(t,e,n,i)}static stopSound(t){if(this.customSfxList[t])return this.customSfxList[t].stop();if("string"==typeof t){if(this.sfx&&this.sfx.has(t))return this.sfx.stop(t);if(this.oldSFX&&this.oldSFX.has(t))return this.oldSFX.stop(t);const e=Object.values(this.musics).find(e=>e.key===t);e&&e.stop()}else this.sfx&&this.sfx.stop(t),this.oldSFX&&this.oldSFX.stop(t)}static muteAll(){$W.Howler.mute(!0)}static unmuteAll(){$W.Howler.mute(!1)}};n(nj,"bgMusic",null),n(nj,"oldSFX",null),n(nj,"ttsList",{}),n(nj,"customSfxList",{}),n(nj,"musics",{}),n(nj,"sfx",null),n(nj,"playTTS",(t,e)=>{let n=nj.ttsList[t];if(n){let t=n.name,i=window.app.data[t+"Count"]||1,r=n.sound;return r.play(),r.on("end",()=>{i--,i>0?r.play():e&&e()}),r}e&&e()});let ij=nj;
/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.19.2
 * @author George Michael Brower
 * @license MIT
 */class rj{constructor(t,e,n,i,r="div"){this.parent=t,this.object=e,this.property=n,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(r),this.domElement.classList.add("controller"),this.domElement.classList.add(i),this.$name=document.createElement("div"),this.$name.classList.add("name"),rj.nextNameID=rj.nextNameID||0,this.$name.id="lil-gui-name-"+ ++rj.nextNameID,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",t=>t.stopPropagation()),this.domElement.addEventListener("keyup",t=>t.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(n)}name(t){return this._name=t,this.$name.textContent=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled||(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t)),this}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.getValue()!==t&&(this.object[this.property]=t,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class sj extends rj{constructor(t,e,n){super(t,e,n,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function aj(t){let e,n;return(e=t.match(/(#|0x)?([a-f0-9]{6})/i))?n=e[2]:(e=t.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?n=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=t.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!n&&"#"+n}const oj={isPrimitive:!0,match:t=>"string"==typeof t,fromHexString:aj,toHexString:aj},lj={isPrimitive:!0,match:t=>"number"==typeof t,fromHexString:t=>parseInt(t.substring(1),16),toHexString:t=>"#"+t.toString(16).padStart(6,0)},hj={isPrimitive:!1,match:t=>Array.isArray(t),fromHexString(t,e,n=1){const i=lj.fromHexString(t);e[0]=(i>>16&255)/255*n,e[1]=(i>>8&255)/255*n,e[2]=(255&i)/255*n},toHexString:([t,e,n],i=1)=>lj.toHexString(t*(i=255/i)<<16^e*i<<8^n*i)},cj={isPrimitive:!1,match:t=>Object(t)===t,fromHexString(t,e,n=1){const i=lj.fromHexString(t);e.r=(i>>16&255)/255*n,e.g=(i>>8&255)/255*n,e.b=(255&i)/255*n},toHexString:({r:t,g:e,b:n},i=1)=>lj.toHexString(t*(i=255/i)<<16^e*i<<8^n*i)},uj=[oj,lj,hj,cj];class dj extends rj{constructor(t,e,n,i){var r;super(t,e,n,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(r=this.initialValue,uj.find(t=>t.match(r))),this._rgbScale=i,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const t=aj(this.$text.value);t&&this._setValueFromHexString(t)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class pj extends rj{constructor(t,e,n){super(t,e,n,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",t=>{t.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class fj extends rj{constructor(t,e,n,i,r,s){super(t,e,n,"number"),this._initInput(),this.min(i),this.max(r);const a=void 0!==s;this.step(a?s:this._getImplicitStep(),a),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=100*e+"%"}return this._inputFocused||(this.$input.value=void 0===this._decimals?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id);window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=t=>{const e=parseFloat(this.$input.value);isNaN(e)||(this._snapClampSetValue(e+t),this.$input.value=this.getValue())};let e,n,i,r,s,a=!1;const o=t=>{if(a){const i=t.clientX-e,r=t.clientY-n;Math.abs(r)>5?(t.preventDefault(),this.$input.blur(),a=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(i)>5&&l()}if(!a){const e=t.clientY-i;s-=e*this._step*this._arrowKeyMultiplier(t),r+s>this._max?s=this._max-r:r+s<this._min&&(s=this._min-r),this._snapClampSetValue(r+s)}i=t.clientY},l=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",l)};this.$input.addEventListener("input",()=>{let t=parseFloat(this.$input.value);isNaN(t)||(this._stepExplicit&&(t=this._snap(t)),this.setValue(this._clamp(t)))}),this.$input.addEventListener("keydown",e=>{"Enter"===e.key&&this.$input.blur(),"ArrowUp"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e))),"ArrowDown"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e)*-1))}),this.$input.addEventListener("wheel",e=>{this._inputFocused&&(e.preventDefault(),t(this._step*this._normalizeMouseWheel(e)))},{passive:!1}),this.$input.addEventListener("mousedown",t=>{e=t.clientX,n=i=t.clientY,a=!0,r=this.getValue(),s=0,window.addEventListener("mousemove",o),window.addEventListener("mouseup",l)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=t=>{const e=this.$slider.getBoundingClientRect();let n=((t,e,n,i,r)=>(t-e)/(n-e)*(r-i)+i)(t,e.left,e.right,this._min,this._max);this._snapClampSetValue(n)},e=e=>{t(e.clientX)},n=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)};let i,r,s=!1;const a=e=>{e.preventDefault(),this._setDraggingStyle(!0),t(e.touches[0].clientX),s=!1},o=e=>{if(s){const t=e.touches[0].clientX-i,n=e.touches[0].clientY-r;Math.abs(t)>Math.abs(n)?a(e):(window.removeEventListener("touchmove",o),window.removeEventListener("touchend",l))}else e.preventDefault(),t(e.touches[0].clientX)},l=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",l)},h=this._callOnFinishChange.bind(this);let c;this.$slider.addEventListener("mousedown",i=>{this._setDraggingStyle(!0),t(i.clientX),window.addEventListener("mousemove",e),window.addEventListener("mouseup",n)}),this.$slider.addEventListener("touchstart",t=>{t.touches.length>1||(this._hasScrollBar?(i=t.touches[0].clientX,r=t.touches[0].clientY,s=!0):a(t),window.addEventListener("touchmove",o,{passive:!1}),window.addEventListener("touchend",l))},{passive:!1}),this.$slider.addEventListener("wheel",t=>{if(Math.abs(t.deltaX)<Math.abs(t.deltaY)&&this._hasScrollBar)return;t.preventDefault();const e=this._normalizeMouseWheel(t)*this._step;this._snapClampSetValue(this.getValue()+e),this.$input.value=this.getValue(),clearTimeout(c),c=setTimeout(h,400)},{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:n}=t;Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,n=-t.wheelDelta/120,n*=this._stepExplicit?1:10);return e+-n}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){const e=Math.round(t/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class mj extends rj{constructor(t,e,n,i){super(t,e,n,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(i)}options(t){return this._values=Array.isArray(t)?t:Object.values(t),this._names=Array.isArray(t)?t:Object.keys(t),this.$select.replaceChildren(),this._names.forEach(t=>{const e=document.createElement("option");e.textContent=t,this.$select.appendChild(e)}),this.updateDisplay(),this}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.textContent=-1===e?t:this._names[e],this}}class gj extends rj{constructor(t,e,n){super(t,e,n,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",t=>{"Enter"===t.code&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let vj=!1;class yj{constructor({parent:t,autoPlace:e=void 0===t,container:n,width:i,title:r="Controls",closeFolders:s=!1,injectStyles:a=!0,touchStyles:o=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",t=>{"Enter"!==t.code&&"Space"!==t.code||(t.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(r),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),o&&this.domElement.classList.add("allow-touch-styles"),!vj&&a&&(!function(t){const e=document.createElement("style");e.innerHTML=t;const n=document.querySelector("head link[rel=stylesheet], head style");n?document.head.insertBefore(e,n):document.head.appendChild(e)}('.lil-gui {\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  line-height: 1;\n  font-weight: normal;\n  font-style: normal;\n  text-align: left;\n  color: var(--text-color);\n  user-select: none;\n  -webkit-user-select: none;\n  touch-action: manipulation;\n  --background-color: #1f1f1f;\n  --text-color: #ebebeb;\n  --title-background-color: #111111;\n  --title-text-color: #ebebeb;\n  --widget-color: #424242;\n  --hover-color: #4f4f4f;\n  --focus-color: #595959;\n  --number-color: #2cc9ff;\n  --string-color: #a2db3c;\n  --font-size: 11px;\n  --input-font-size: 11px;\n  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;\n  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;\n  --padding: 4px;\n  --spacing: 4px;\n  --widget-height: 20px;\n  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);\n  --name-width: 45%;\n  --slider-knob-width: 2px;\n  --slider-input-width: 27%;\n  --color-input-width: 27%;\n  --slider-input-min-width: 45px;\n  --color-input-min-width: 45px;\n  --folder-indent: 7px;\n  --widget-padding: 0 0 0 3px;\n  --widget-border-radius: 2px;\n  --checkbox-size: calc(0.75 * var(--widget-height));\n  --scrollbar-width: 5px;\n}\n.lil-gui, .lil-gui * {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.lil-gui.root {\n  width: var(--width, 245px);\n  display: flex;\n  flex-direction: column;\n  background: var(--background-color);\n}\n.lil-gui.root > .title {\n  background: var(--title-background-color);\n  color: var(--title-text-color);\n}\n.lil-gui.root > .children {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.lil-gui.root > .children::-webkit-scrollbar {\n  width: var(--scrollbar-width);\n  height: var(--scrollbar-width);\n  background: var(--background-color);\n}\n.lil-gui.root > .children::-webkit-scrollbar-thumb {\n  border-radius: var(--scrollbar-width);\n  background: var(--focus-color);\n}\n@media (pointer: coarse) {\n  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {\n    --widget-height: 28px;\n    --padding: 6px;\n    --spacing: 6px;\n    --font-size: 13px;\n    --input-font-size: 16px;\n    --folder-indent: 10px;\n    --scrollbar-width: 7px;\n    --slider-input-min-width: 50px;\n    --color-input-min-width: 65px;\n  }\n}\n.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {\n  --widget-height: 28px;\n  --padding: 6px;\n  --spacing: 6px;\n  --font-size: 13px;\n  --input-font-size: 16px;\n  --folder-indent: 10px;\n  --scrollbar-width: 7px;\n  --slider-input-min-width: 50px;\n  --color-input-min-width: 65px;\n}\n.lil-gui.autoPlace {\n  max-height: 100%;\n  position: fixed;\n  top: 0;\n  right: 15px;\n  z-index: 1001;\n}\n\n.lil-gui .controller {\n  display: flex;\n  align-items: center;\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n}\n.lil-gui .controller.disabled {\n  opacity: 0.5;\n}\n.lil-gui .controller.disabled, .lil-gui .controller.disabled * {\n  pointer-events: none !important;\n}\n.lil-gui .controller > .name {\n  min-width: var(--name-width);\n  flex-shrink: 0;\n  white-space: pre;\n  padding-right: var(--spacing);\n  line-height: var(--widget-height);\n}\n.lil-gui .controller .widget {\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  min-height: var(--widget-height);\n}\n.lil-gui .controller.string input {\n  color: var(--string-color);\n}\n.lil-gui .controller.boolean {\n  cursor: pointer;\n}\n.lil-gui .controller.color .display {\n  width: 100%;\n  height: var(--widget-height);\n  border-radius: var(--widget-border-radius);\n  position: relative;\n}\n@media (hover: hover) {\n  .lil-gui .controller.color .display:hover:before {\n    content: " ";\n    display: block;\n    position: absolute;\n    border-radius: var(--widget-border-radius);\n    border: 1px solid #fff9;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n}\n.lil-gui .controller.color input[type=color] {\n  opacity: 0;\n  width: 100%;\n  height: 100%;\n  cursor: pointer;\n}\n.lil-gui .controller.color input[type=text] {\n  margin-left: var(--spacing);\n  font-family: var(--font-family-mono);\n  min-width: var(--color-input-min-width);\n  width: var(--color-input-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.option select {\n  opacity: 0;\n  position: absolute;\n  width: 100%;\n  max-width: 100%;\n}\n.lil-gui .controller.option .display {\n  position: relative;\n  pointer-events: none;\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  line-height: var(--widget-height);\n  max-width: 100%;\n  overflow: hidden;\n  word-break: break-all;\n  padding-left: 0.55em;\n  padding-right: 1.75em;\n  background: var(--widget-color);\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .display.focus {\n    background: var(--focus-color);\n  }\n}\n.lil-gui .controller.option .display.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.option .display:after {\n  font-family: "lil-gui";\n  content: "↕";\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  padding-right: 0.375em;\n}\n.lil-gui .controller.option .widget,\n.lil-gui .controller.option select {\n  cursor: pointer;\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .widget:hover .display {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number input {\n  color: var(--number-color);\n}\n.lil-gui .controller.number.hasSlider input {\n  margin-left: var(--spacing);\n  width: var(--slider-input-width);\n  min-width: var(--slider-input-min-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.number .slider {\n  width: 100%;\n  height: var(--widget-height);\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  padding-right: var(--slider-knob-width);\n  overflow: hidden;\n  cursor: ew-resize;\n  touch-action: pan-y;\n}\n@media (hover: hover) {\n  .lil-gui .controller.number .slider:hover {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number .slider.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.number .slider.active .fill {\n  opacity: 0.95;\n}\n.lil-gui .controller.number .fill {\n  height: 100%;\n  border-right: var(--slider-knob-width) solid var(--number-color);\n  box-sizing: content-box;\n}\n\n.lil-gui-dragging .lil-gui {\n  --hover-color: var(--widget-color);\n}\n.lil-gui-dragging * {\n  cursor: ew-resize !important;\n}\n\n.lil-gui-dragging.lil-gui-vertical * {\n  cursor: ns-resize !important;\n}\n\n.lil-gui .title {\n  height: var(--title-height);\n  line-height: calc(var(--title-height) - 4px);\n  font-weight: 600;\n  padding: 0 var(--padding);\n  -webkit-tap-highlight-color: transparent;\n  cursor: pointer;\n  outline: none;\n  text-decoration-skip: objects;\n}\n.lil-gui .title:before {\n  font-family: "lil-gui";\n  content: "▾";\n  padding-right: 2px;\n  display: inline-block;\n}\n.lil-gui .title:active {\n  background: var(--title-background-color);\n  opacity: 0.75;\n}\n@media (hover: hover) {\n  body:not(.lil-gui-dragging) .lil-gui .title:hover {\n    background: var(--title-background-color);\n    opacity: 0.85;\n  }\n  .lil-gui .title:focus {\n    text-decoration: underline var(--focus-color);\n  }\n}\n.lil-gui.root > .title:focus {\n  text-decoration: none !important;\n}\n.lil-gui.closed > .title:before {\n  content: "▸";\n}\n.lil-gui.closed > .children {\n  transform: translateY(-7px);\n  opacity: 0;\n}\n.lil-gui.closed:not(.transition) > .children {\n  display: none;\n}\n.lil-gui.transition > .children {\n  transition-duration: 300ms;\n  transition-property: height, opacity, transform;\n  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);\n  overflow: hidden;\n  pointer-events: none;\n}\n.lil-gui .children:empty:before {\n  content: "Empty";\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n  display: block;\n  height: var(--widget-height);\n  font-style: italic;\n  line-height: var(--widget-height);\n  opacity: 0.5;\n}\n.lil-gui.root > .children > .lil-gui > .title {\n  border: 0 solid var(--widget-color);\n  border-width: 1px 0;\n  transition: border-color 300ms;\n}\n.lil-gui.root > .children > .lil-gui.closed > .title {\n  border-bottom-color: transparent;\n}\n.lil-gui + .controller {\n  border-top: 1px solid var(--widget-color);\n  margin-top: 0;\n  padding-top: var(--spacing);\n}\n.lil-gui .lil-gui .lil-gui > .title {\n  border: none;\n}\n.lil-gui .lil-gui .lil-gui > .children {\n  border: none;\n  margin-left: var(--folder-indent);\n  border-left: 2px solid var(--widget-color);\n}\n.lil-gui .lil-gui .controller {\n  border: none;\n}\n\n.lil-gui label, .lil-gui input, .lil-gui button {\n  -webkit-tap-highlight-color: transparent;\n}\n.lil-gui input {\n  border: 0;\n  outline: none;\n  font-family: var(--font-family);\n  font-size: var(--input-font-size);\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  background: var(--widget-color);\n  color: var(--text-color);\n  width: 100%;\n}\n@media (hover: hover) {\n  .lil-gui input:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui input:active {\n    background: var(--focus-color);\n  }\n}\n.lil-gui input:disabled {\n  opacity: 1;\n}\n.lil-gui input[type=text],\n.lil-gui input[type=number] {\n  padding: var(--widget-padding);\n  -moz-appearance: textfield;\n}\n.lil-gui input[type=text]:focus,\n.lil-gui input[type=number]:focus {\n  background: var(--focus-color);\n}\n.lil-gui input[type=checkbox] {\n  appearance: none;\n  width: var(--checkbox-size);\n  height: var(--checkbox-size);\n  border-radius: var(--widget-border-radius);\n  text-align: center;\n  cursor: pointer;\n}\n.lil-gui input[type=checkbox]:checked:before {\n  font-family: "lil-gui";\n  content: "✓";\n  font-size: var(--checkbox-size);\n  line-height: var(--checkbox-size);\n}\n@media (hover: hover) {\n  .lil-gui input[type=checkbox]:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button {\n  outline: none;\n  cursor: pointer;\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  color: var(--text-color);\n  width: 100%;\n  height: var(--widget-height);\n  text-transform: none;\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  border: none;\n}\n@media (hover: hover) {\n  .lil-gui button:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui button:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button:active {\n  background: var(--focus-color);\n}\n\n@font-face {\n  font-family: "lil-gui";\n  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");\n}'),vj=!0),n?n.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),i&&this.domElement.style.setProperty("--width",i+"px"),this._closeFolders=s}add(t,e,n,i,r){if(Object(n)===n)return new mj(this,t,e,n);switch(typeof t[e]){case"number":return new fj(this,t,e,n,i,r);case"boolean":return new sj(this,t,e);case"string":return new gj(this,t,e);case"function":return new pj(this,t,e)}}addColor(t,e,n=1){return new dj(this,t,e,n)}addFolder(t){const e=new yj({parent:this,title:t});return this.root._closeFolders&&e.close(),e}load(t,e=!0){return t.controllers&&this.controllers.forEach(e=>{e instanceof pj||e._name in t.controllers&&e.load(t.controllers[e._name])}),e&&t.folders&&this.folders.forEach(e=>{e._title in t.folders&&e.load(t.folders[e._title])}),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach(t=>{if(!(t instanceof pj)){if(t._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);e.controllers[t._name]=t.save()}}),t&&this.folders.forEach(t=>{if(t._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);e.folders[t._title]=t.save()}),e}open(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(t){this._closed!==t&&(this._closed=t,this._callOnOpenClose(this))}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const n=t=>{t.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",n))};this.$children.addEventListener("transitionend",n);const i=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame(()=>{this.$children.style.height=i+"px"})}),this}title(t){return this._title=t,this.$title.textContent=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach(t=>t.reset()),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),void 0!==this._onChange&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onOpenClose(t){return this._onOpenClose=t,this}_callOnOpenClose(t){this.parent&&this.parent._callOnOpenClose(t),void 0!==this._onOpenClose&&this._onOpenClose.call(this,t)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(t=>t.destroy())}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach(e=>{t=t.concat(e.controllersRecursive())}),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach(e=>{t=t.concat(e.foldersRecursive())}),t}}var xj=["Light","Mesh","Object3D"],bj=function(t,e,n,i){var r={};r[n[0]]={r:255*t[n[0]].r,g:255*t[n[0]].g,b:255*t[n[0]].b},e.addColor(r,n[0],n[1]).onChange(function(e){t[n[0]].r=e.r/255,t[n[0]].g=e.g/255,t[n[0]].b=e.b/255,i&&i(e)})},_j=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t&&e.children.length>0){var r=i?n:n.addFolder("children");e.children.forEach(function(t,e){for(var n=0;n<xj.length;n++){var i=xj[n];if(t["is".concat(i)]){var s=t.name?t.name+"-"+e:t.type+"-"+e;r["add".concat(i)](s,t,{recursive:!0});break}}})}},Sj=[["aoMapIntensity",0,1],["bumpScale",0,1],["clearCoat",0,1],["clearCoatRoughness",0,1],["color","color"],["displacementScale",0,10],["emissive","color"],["emissiveIntensity",0,1],["envMapIntensity",0,1],["lightMapIntensity",0,1],["metalness",0,1],["opacity",0,1],["reflectivity",0,1],["refractionRatio",0,1],["roughness",0,1],["shininess",0,1],["specular","color"],["wireframe",!0]],wj=[["angle",0,Math.PI/2],["color","color"],["decay",0,2],["distance",0,1e3],["groundColor","color"],["intensity",0,5],["penumbra",0,1],["power",0,8*Math.PI]],Tj=[["bottom",0],["far",0],["filmGauge",0],["filmOffset",0],["focus",0],["fov",0,180],["left",0],["near",0],["right",0],["top",0],["zoom",0]],Mj=[["background","color"],["fog","fog"],["overrideMaterial","material"]],Aj=[["color","color"],["far",0],["near",0],["density",0]],Ej={addVector:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).step,i=void 0===n?.1:n,r=this.addFolder(t);return Math.abs(e.x)>=0&&r.add(e,"x").step(i),Math.abs(e.y)>=0&&r.add(e,"y").step(i),Math.abs(e.z)>=0&&r.add(e,"z").step(i),Math.abs(e.w)>=0&&r.add(e,"w").step(i),r},addObject3D:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.recursive,r=void 0!==i&&i,s=n.inner,a=void 0!==s&&s,o=n.stepPosition,l=void 0===o?1:o,h=n.stepRotation,c=void 0===h?.02:h,u=n.stepScale,d=void 0===u?.01:u,p=!1===a?this.addFolder(t):this;return p.addVector("position",e.position,l),p.addVector("rotation",e.rotation,c),p.addVector("scale",e.scale,d),_j(r,e,p),p},addMaterial:function(t,e){var n=this.addFolder(t);return Sj.forEach(function(t){e.hasOwnProperty(t[0])&&("color"===t[1]?bj(e,n,t,function(){return e.needsUpdate=!0}):n.add(e,t[0],t[1],t[2]).onChange(function(){return e.needsUpdate=!0}))}),n},addLight:function(t,e){var n=this.addFolder(t);return n.addObject3D(null,e,{inner:!0}),wj.forEach(function(t){e.hasOwnProperty(t[0])&&("color"===t[1]?bj(e,n,t):n.add(e,t[0],t[1],t[2]))}),n},addCamera:function(t,e){var n=this.addFolder(t);return n.addObject3D("object",e,{inner:!0}),Tj.forEach(function(t){e.hasOwnProperty(t[0])&&("color"===t[1]?bj(e,n,t):n.add(e,t[0],t[1],t[2]).onChange(function(){e.updateProjectionMatrix&&e.updateProjectionMatrix()}))}),n},addScene:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).recursive,i=void 0!==n&&n,r=this.addFolder(t);return Mj.forEach(function(t){if(e.hasOwnProperty(t[0])&&null!==e[t[0]])switch(t[1]){case"color":bj(e,r,t,function(){return e.needsUpdate=!0});break;case"fog":r.addFog(t[0],e[t[0]]);break;case"material":r.addMaterial(t[0],e[t[0]]);break;default:r.add(e[t[0]],t[0],t[1],t[2])}}),_j(i,e,r,!0),r},addMesh:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).recursive,i=void 0!==n&&n,r=this.addFolder(t);r.addMaterial("material",e.material),r.addObject3D("object",e,{inner:!0,recursive:i})},addFog:function(t,e){var n=this.addFolder(t);return Aj.forEach(function(t){e.hasOwnProperty(t[0])&&("color"===t[1]?bj(e,n,t):n.add(e,t[0],t[1],t[2],t[3]))}),n}};var Cj,Pj={exports:{}};Pj.exports=(Cj=function(){function t(t){return i.appendChild(t.dom),t}function e(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";n=t}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(t){t.preventDefault(),e(++n%i.children.length)},!1);var r=(performance||Date).now(),s=r,a=0,o=t(new Cj.Panel("FPS","#0ff","#002")),l=t(new Cj.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new Cj.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:i,addPanel:t,showPanel:e,begin:function(){r=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-r,200),t>s+1e3&&(o.update(1e3*a/(t-s),100),s=t,a=0,h)){var e=performance.memory;h.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:i,setMode:e}},Cj.Panel=function(t,e,n){var i=1/0,r=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,l=48*a,h=3*a,c=2*a,u=3*a,d=15*a,p=74*a,f=30*a,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,o,l),g.fillStyle=e,g.fillText(t,h,c),g.fillRect(u,d,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(u,d,p,f),{dom:m,update:function(l,v){i=Math.min(i,l),r=Math.max(r,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,o,d),g.fillStyle=e,g.fillText(s(l)+" "+t+" ("+s(i)+"-"+s(r)+")",h,c),g.drawImage(m,u+a,d,p-a,f,u,d,p-a,f),g.fillRect(u+p-a,d,a,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(u+p-a,d,a,s((1-l/v)*f))}}},Cj);const Rj=Sy(Pj.exports);class Ij{static init({renderer3d:t,scene3d:e}={}){var n;n={GUI:yj}.GUI.prototype,Object.keys(Ej).forEach(function(t){var e=Ej[t];n[t]||(n[t]=e)}),this.gui=new yj({closeFolders:!0,touchStyles:!1}),this.gui.domElement.parentElement.style.zIndex=1e4,this.gui.domElement.style.opacity=.7,this.gui.domElement.style.right=0,this.renderer3d=t||e6.threeMain.renderer,this.scene3d=e||e6.threeScene}static initStats(){this.stats=new Rj,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this.statsEnabled=!0}static addColor(t,e,n){let i={val:"#"+t.getHexString()};return this.gui.addColor(i,"val").onChange(t=>{n&&n(t)}).name(e)}static addLightsGui(t,e){if(t||(t=this.scene3d.dirLight),e||(e=this.scene3d.ambientLight),e){let t=this.gui.addFolder("AmbientLight");t.add(e,"intensity",0,10,.1),e.colorHex="#"+e.color.getHexString(),t.addColor(e,"colorHex").onChange(t=>{e.color.set(t)})}if(t){let e=this.gui.addFolder("DirectionalLight");t.colorHex="#"+t.color.getHexString(),e.add(t,"intensity",0,10,.1),e.addColor(t,"colorHex").onChange(e=>{t.color.set(e)});let n=300;e.add(t.position,"x",-n,n,.5),e.add(t.position,"y",-n,n,.5),e.add(t.position,"z",-n,n,.5)}}static addBackgroundThings(){let t=this.gui.addFolder("backgroundThings"),e={val:this.renderer3d.background||"#ffffff"};t.addColor(e,"val").onChange(t=>{this.scene3d.background=new THREE.Color(t)}),this.scene3d.fog&&this.gui.addFog("fog",this.scene3d.fog);let n={None:THREE.NoToneMapping,Linear:THREE.LinearToneMapping,Reinhard:THREE.ReinhardToneMapping,Cineon:THREE.CineonToneMapping,ACESFilmic:THREE.ACESFilmicToneMapping,AgXToneMapping:THREE.AgXToneMapping,NeutralToneMapping:THREE.NeutralToneMapping,Custom:THREE.CustomToneMapping},i={exposure:1,toneMapping:n.Linear};t.add(i,"toneMapping",Object.keys(n)).onChange(()=>{this.renderer3d.toneMapping=n[i.toneMapping],this.scene3d.traverse(t=>{t.material&&(t.material.needsUpdate=!0)})}),t.add(i,"exposure",0,1,.01).onChange(t=>{this.renderer3d.toneMappingExposure=t,this.scene3d.traverse(t=>{t.material&&(t.material.needsUpdate=!0)})})}static addCameraGui(t){let e=this.gui.addFolder("CamSettings");e.add(t,"fov",10,100,1).onChange(e=>{t.fov=e,t.updateProjectionMatrix()}),e.add(t,"far",0,5e3,.1).onChange(e=>{t.far=e,t.updateProjectionMatrix()}),e.addObject3D("cam",t)}static initOriginBox(){let t=ThreeHelpers.createBox();return t.material.depthTest=!1,t.material.depthWrite=!1,t.material.transparent=!0,t.material.opacity=.2,this.originBox=t,t.visible=!0,t}}const Oj=Xz,Dj=function(t){app.main.gameFinished(t),QW.delayedCall(.2,()=>{if(app.data.endCardFullScreenClick){e6.pixiScene.eventMode="static",e6.pixiScene.hitArea=e6.pixiApp.screen;const t="moloco"===app.type?"pointerup":"pointerdown";e6.pixiScene.on(t,()=>{app.main.gotoLink()})}}),QW.delayedCall(2,()=>{app.data.goToMarketDirectly&&app.main.gotoLink()}),app.data.bannerHideOnEndCard&&e6.topBanner&&e6.topBanner.hide(app.data.bannerHideOnEndCardIsQuick)};ij.playSound.bind(ij),ij.stopSound.bind(ij),ij.playBgMusic.bind(ij),ij.stopBgMusic.bind(ij),ij.setBgMusicVolume.bind(ij);class Bj{constructor(t){this.renderer=t,this.renderer||(this.renderer=e6.threeMain.renderer)}init(t,e){this.composer=new YN(this.renderer),this.composer.addPass(new Mz(t,e)),this.composer.addPass(new Vz(e,new Nz({mode:Az,exposure:1})));const n=e6.data.postprocessData;if(n.fxaa&&this.composer.addPass(new Vz(e,new _z)),n.bloom.enable){const n=new Lz(t,e,{blendFunction:sz.ADD,mipmapBlur:!0,luminanceThreshold:.066,luminanceSmoothing:.09,radius:.32,intensity:.9});n.inverted=!0,n.ignoreBackground=!0,this.composer.addPass(new Vz(e,n))}}registerBloomOptions(t,e){const n=e,i=n.blendMode;let r=Ij.gui;const s={intensity:n.intensity,radius:n.mipmapBlurPass.radius,luminance:{filter:n.luminancePass.enabled,threshold:n.luminanceMaterial.threshold,smoothing:n.luminanceMaterial.smoothing},selection:{inverted:n.inverted,"ignore bg":n.ignoreBackground},opacity:i.opacity.value,"blend mode":i.blendFunction};r.add(s,"intensity",0,10,.01).onChange(t=>{n.intensity=Number(t)}),r.add(s,"radius",0,1,.001).onChange(t=>{n.mipmapBlurPass.radius=Number(t)});let a=r.addFolder("Luminance");a.add(s.luminance,"filter").onChange(t=>{n.luminancePass.enabled=t}),a.add(s.luminance,"threshold",0,1,.001).onChange(t=>{n.luminanceMaterial.threshold=Number(t)}),a.add(s.luminance,"smoothing",0,1,.001).onChange(t=>{n.luminanceMaterial.smoothing=Number(t)}),a.open(),a=r.addFolder("Selection"),a.add(s.selection,"inverted").onChange(t=>{n.inverted=t}),a.add(s.selection,"ignore bg").onChange(t=>{n.ignoreBackground=t}),a.open(),r.add(s,"opacity",0,1,.01).onChange(t=>{i.opacity.value=t}),r.add(s,"blend mode",sz).onChange(t=>{i.setBlendFunction(Number(t))})}resize(t,e){this.composer&&this.composer.setSize(t,e)}render(){this.composer&&this.composer.render()}reset(){this.composer&&this.composer.passes.forEach(t=>{t.camera&&(t.camera=app.main.camera)})}}class Fj extends Ko{constructor(t=!1){super(),n(this,"name","Scene3d"),n(this,"resizeableBg",!1),n(this,"persistent",!1),n(this,"quarksScene"),n(this,"mainCamera"),n(this,"dirLight"),n(this,"ambientLight"),n(this,"postprocess"),this.persistent=t,this.persistent||(this.quarksScene=new FN(this))}get gameObjects(){return BN.getSceneObjects(this)}onSceneInited(t){t&&this.setupScene(t),this.mainCamera=BN.getObjectByType(Vr,this),this.dirLight=BN.getObjectByType(ed,this),this.ambientLight=BN.getObjectByType(nd,this),!this.persistent&&e6.data.postprocessData.enable&&(this.postprocess=new Bj,this.postprocess.init(this,this.mainCamera))}setupScene(t){this.initSceneBg(t),this.initEnvmap(t),this.initFog(t)}async initSceneBg(t){const e=this;"solid"===t.backgroundType?e.background=DN.initSolidTexture(t.backgroundColor1):"gradient"===t.backgroundType?e.background=DN.initGradientTexture(t.backgroundColor1,t.backgroundColor2):"image"===t.backgroundType?(this.resizeableBg=!0,e.background=await DN.getImageBg(t.backgroundImage),this.resize(e6.threeWidth,e6.threeHeight)):"hdr"===t.backgroundType?e.background=await DN.getHdrBg(t.hdrFile):"cubemap"===t.backgroundType?e.background=await DN.getCubeMapBg(t.cubemap):e.background=null}async initEnvmap(t){const e=this;if(t.environment){const n=await DN.getEnvironmentMap(t.environment);n?(n.mapping=tt,n.needsUpdate=!0,e.environment=n,e.environmentIntensity=t.environmentIntensity):e.environment=null}else e.environment=null}initFog(t){const e=this;if(t.fog){let n=null;"linear"===t.fogType?n=new qo(t.fogColor,t.fogNear,t.fogFar):"exp2"===t.fogType&&(n=new Yo(t.fogColor,t.fogDensity)),e.fog=n}else e.fog=null}update(t){var e;this.gameObjects.forEach(e=>{e.components.update(t)}),null==(e=this.quarksScene)||e.update(t)}render(t){this.mainCamera&&(this.postprocess?this.postprocess.render():t.render(this,this.mainCamera))}resize(t,e){var n;this.background&&this.resizeableBg&&DN.resizeTexture(this.background,t,e);const i=t/e;this.gameObjects.forEach(n=>{n instanceof Yr&&(n.aspect=i,n.updateProjectionMatrix()),n.components.resize(t,e)}),null==(n=this.postprocess)||n.resize(t,e)}destroy(){var t;null==(t=this.quarksScene)||t.destroy();for(let e=this.children.length-1;e>=0;e--){this.children[e].destroy()}}}const Lj={},Uj=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let kj=1234567;const Nj=Math.PI/180,zj=180/Math.PI;function Gj(t,e){return(t%e+e)%e}function Hj(t,e,n){return(1-n)*t+n*e}const Vj={DEG2RAD:Nj,RAD2DEG:zj,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Uj[255&t]+Uj[t>>8&255]+Uj[t>>16&255]+Uj[t>>24&255]+"-"+Uj[255&e]+Uj[e>>8&255]+"-"+Uj[e>>16&15|64]+Uj[e>>24&255]+"-"+Uj[63&n|128]+Uj[n>>8&255]+"-"+Uj[n>>16&255]+Uj[n>>24&255]+Uj[255&i]+Uj[i>>8&255]+Uj[i>>16&255]+Uj[i>>24&255]).toLowerCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:Gj,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Hj,damp:function(t,e,n,i){return Hj(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(Gj(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(kj=t);let e=kj+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Nj},radToDeg:function(t){return t*zj},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),h=s((e+i)/2),c=a((e+i)/2),u=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),f=a((i-e)/2);switch(r){case"XYX":t.set(o*c,l*u,l*d,o*h);break;case"YZY":t.set(l*d,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*d,o*c,o*h);break;case"XZX":t.set(o*c,l*f,l*p,o*h);break;case"YXY":t.set(l*p,o*c,l*f,o*h);break;case"ZYZ":t.set(l*f,l*p,o*c,o*h)}},normalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}},denormalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}};let Xj=class{constructor(t){n(this,"node"),this.node=t}update(t){if(!t)return;this.node.position.set(t.position.x,t.position.y,t.position.z),this.node.scale.set(t.scale.x,t.scale.y,t.scale.z);let e=Vj.degToRad(t.rotation.x),n=Vj.degToRad(t.rotation.y),i=Vj.degToRad(t.rotation.z);this.node.rotation.set(e,n,i),this.node.name=t.label,this.node.setVisible(t.visible)}get(){return{type:"node3D",label:this.node.name,visible:this.node.visible,position:{x:this.node.position.x,y:this.node.position.y,z:this.node.position.z,linked:!1},scale:{x:this.node.scale.x,y:this.node.scale.y,z:this.node.scale.z,linked:!0},rotation:{x:this.node.rotation.x,y:this.node.rotation.y,z:this.node.rotation.z,linked:!1},renderOrder:0}}};class Wj{constructor(t){n(this,"node"),n(this,"scripts"),n(this,"inited"),this.node=t,this.scripts=[],this.node.scripts=this.scripts,this.inited=!1}initEditorVariables(){this.inited||this.scripts.forEach(t=>{t._initVariables()})}awake(t){this.inited||this.scripts.forEach(e=>{e.awake(t)})}init(){this.inited||(this.scripts.forEach(t=>{t.init(),t.inited=!0}),this.inited=!0)}add(t,e,n){t._initDefault(this.node,e,n),t.onAdd(),this.scripts.push(t)}remove(t){this.scripts=this.scripts.filter(e=>e!==t),t.onRemove()}update(t){this.inited||this.init(),this.scripts.forEach(e=>{e.inited||(e.init(),e.inited=!0),e.update(t)})}resize(t,e){this.inited&&this.scripts.forEach(n=>{n.resize(t,e)})}destroy(){this.scripts.forEach(t=>{t.onRemove()}),this.scripts=[],this.inited=!1}get(t){return this.scripts.find(e=>e instanceof t)}getByName(t){return this.scripts.find(e=>e._className.toLowerCase()===t.toLowerCase())}}class jj{constructor(t){n(this,"_node"),n(this,"transform"),n(this,"scripts"),n(this,"physics3D"),this._node=t,this.transform=new Xj(t)}get animationManager(){return this.node.animationManager}get node(){return this._node}updateComponents(t){this.transform.update(t.node3D),this.physics3D&&this.physics3D.update(t.physics3D)}update(t){this.scripts&&this.scripts.update(t),this.node.animationManager&&this.node.animationManager.update(t),this.physics3D&&this.physics3D.step()}resize(t,e){this.scripts&&this.scripts.resize(t,e)}add(t){switch(t){case"scripts":return this.scripts||(this.scripts=new Wj(this.node)),this.scripts;case"animationManager":return this.node.animationManager||(this.node.animationManager=new bN(this.node,this.node.animations)),this.node.animationManager;case"physics3D":return this.physics3D=new IN(this.node),this.physics3D}}get(t){var e;switch(t){case"transform":return this.transform.get();case"scripts":return this.scripts;case"animationManager":return this.node.animationManager;case"physics3D":return null==(e=this.physics3D)?void 0:e.get();default:return null}}remove(t){var e,n;switch(t){case"scripts":null==(e=this.scripts)||e.scripts.forEach(t=>{var e;null==(e=this.scripts)||e.remove(t)}),this.scripts=void 0;break;case"physics3D":null==(n=this.physics3D)||n.remove(),this.physics3D=void 0}}removeAll(){this.remove("scripts"),this.remove("physics3D")}getAll(){return{transform:this.transform,scripts:this.scripts,animationManager:this.node.animationManager,physics3D:this.physics3D}}}class Yj{constructor(t,e){n(this,"sceneHelper"),n(this,"objectManager"),this.sceneHelper=t,this.objectManager=e}createEntityWithComponents(t,e){t.components||(t.components=new jj(t));const n=t.components.add("scripts");for(let i=0;i<e.length;i++)n.add(e[i]);return n.awake(),this.objectManager.addObject(t,e6.threeScene),t}createEntityFromData(t,e){let n=Lj[e.id];if(!n)return;if(!1===e.isActive)return;n=n.default||n;const i=new n;t.components.add("scripts").add(i,e.variables,this.objectManager)}awakeAll(t){t?([...t.gameObjects].forEach(t=>{var e;null==(e=t.components.scripts)||e.initEditorVariables()}),[...t.gameObjects].forEach(t=>{var e;null==(e=t.components.scripts)||e.awake()})):(this.sceneHelper.sceneList.forEach(t=>{[...t.gameObjects].forEach(t=>{var e;null==(e=t.components.scripts)||e.initEditorVariables()})}),this.sceneHelper.sceneList.forEach(t=>{[...t.gameObjects].forEach(t=>{var e;null==(e=t.components.scripts)||e.awake()})}))}initAll(t){t?[...t.gameObjects].forEach(t=>{var e;null==(e=t.components.scripts)||e.init()}):this.sceneHelper.sceneList.forEach(t=>{[...t.gameObjects].forEach(t=>{var e;null==(e=t.components.scripts)||e.init()})})}}n(Yj,"script3d"),n(Yj,"script2d");class qj extends Oi{constructor(t,e){super(),this.active=!1,this.orientToMovement=!1,e&&(this.orientToMovement=!0),this.scene=t,this.geometry=null,this.mesh=null,this.nodeCenters=null,this.lastNodeCenter=null,this.currentNodeCenter=null,this.lastOrientationDir=null,this.nodeIDs=null,this.currentLength=0,this.currentEnd=0,this.currentNodeID=0}}var Kj;window.TrailRenderer=qj,qj.prototype.constructor=qj,qj.MaxHeadVertices=128,qj.LocalOrientationTangent=new Pn(1,0,0),qj.LocalOrientationDirection=new Pn(0,0,-1),qj.LocalHeadOrigin=new Pn(0,0,0),qj.PositionComponentCount=3,qj.UVComponentCount=2,qj.IndicesPerFace=3,qj.FacesPerQuad=2,qj.Shader={},qj.Shader.BaseVertexVars=["attribute float nodeID;","attribute float nodeVertexID;","attribute vec3 nodeCenter;","uniform float minID;","uniform float maxID;","uniform float trailLength;","uniform float maxTrailLength;","uniform float verticesPerNode;","uniform vec2 textureTileFactor;","uniform float tailWidth;","uniform vec4 headColor;","uniform vec4 tailColor;","varying vec4 vColor;"].join("\n"),qj.Shader.TexturedVertexVars=[qj.Shader.BaseVertexVars,"varying vec2 vUV;","uniform float dragTexture;"].join("\n"),qj.Shader.BaseFragmentVars=["varying vec4 vColor;","uniform sampler2D tex;"].join("\n"),qj.Shader.TexturedFragmentVars=[qj.Shader.BaseFragmentVars,"varying vec2 vUV;"].join("\n"),qj.Shader.VertexShaderCore=["float fraction = tailWidth *  (( maxID - nodeID ) / ( maxID - minID ));","vColor = ( 1.0 - fraction ) * headColor + fraction * tailColor;","vec4 realPosition = vec4( ( 1.0 - fraction ) * position.xyz + fraction * nodeCenter.xyz, 1.0 ); "].join("\n"),qj.Shader.BaseVertexShader=[qj.Shader.BaseVertexVars,"void main() { ",qj.Shader.VertexShaderCore,"gl_Position = projectionMatrix * viewMatrix * realPosition;","}"].join("\n"),qj.Shader.BaseFragmentShader=[qj.Shader.BaseFragmentVars,"void main() { ","gl_FragColor = vColor;","}"].join("\n"),qj.Shader.TexturedVertexShader=[qj.Shader.TexturedVertexVars,"void main() { ",qj.Shader.VertexShaderCore,"float s = 0.0;","float t = 0.0;","if ( dragTexture == 1.0 ) { ","   s = fraction *  textureTileFactor.s; "," \tt = ( nodeVertexID / verticesPerNode ) * textureTileFactor.t;","} else { ","\ts = nodeID / maxTrailLength * textureTileFactor.s;"," \tt = ( nodeVertexID / verticesPerNode ) * textureTileFactor.t;","}","vUV = vec2( s, t ); ","gl_Position = projectionMatrix * viewMatrix * realPosition;","}"].join("\n"),qj.Shader.TexturedFragmentShader=[qj.Shader.TexturedFragmentVars,"void main() { ","vec4 textureColor = texture2D( tex, vUV );","gl_FragColor = vColor * textureColor;","}"].join("\n"),qj.createMaterial=function(t,e,n){return(n=n||{}).trailLength={type:"f",value:null},n.verticesPerNode={type:"f",value:null},n.minID={type:"f",value:null},n.maxID={type:"f",value:null},n.dragTexture={type:"f",value:null},n.maxTrailLength={type:"f",value:null},n.textureTileFactor={type:"v2",value:null},n.tailWidth={type:"f",value:null},n.headColor={type:"v4",value:new wn},n.tailColor={type:"v4",value:new wn},t=t||qj.Shader.BaseVertexShader,e=e||qj.Shader.BaseFragmentShader,new Hr({uniforms:n,vertexShader:t,fragmentShader:e,transparent:!0,alphaTest:.5,blending:5,blendSrc:k,blendDst:N,blendEquation:I,depthTest:!0,depthWrite:!1,side:2})},qj.createBaseMaterial=function(t){return this.createMaterial(qj.Shader.BaseVertexShader,qj.Shader.BaseFragmentShader,t)},qj.createTexturedMaterial=function(t){return(t={}).tex={type:"t",value:null},this.createMaterial(qj.Shader.TexturedVertexShader,qj.Shader.TexturedFragmentShader,t)},qj.prototype.initialize=function(t,e,n,i,r,s){this.deactivate(),this.destroyMesh(),this.length=e>0?e+1:0,this.dragTexture=n?1:0,this.targetObject=s,this.initializeLocalHeadGeometry(i,r),this.nodeIDs=[],this.nodeCenters=[];for(var a=0;a<this.length;a++)this.nodeIDs[a]=-1,this.nodeCenters[a]=new Pn;this.material=t,this.initializeGeometry(),this.initializeMesh(),this.material.uniforms.trailLength.value=0,this.material.uniforms.minID.value=0,this.material.uniforms.maxID.value=0,this.material.uniforms.dragTexture.value=this.dragTexture,this.material.uniforms.maxTrailLength.value=this.length,this.material.uniforms.verticesPerNode.value=this.VerticesPerNode,this.material.uniforms.textureTileFactor.value=new Qe(1,1),this.material.uniforms.tailWidth.value=1,this.reset()},qj.prototype.initializeLocalHeadGeometry=function(t,e){if(this.localHeadGeometry=[],e){this.VerticesPerNode=0;for(var n=0;n<e.length&&n<qj.MaxHeadVertices;n++){var i=e[n];if(i&&i instanceof Pn){var r=new Pn;r.copy(i),this.localHeadGeometry.push(r),this.VerticesPerNode++}}}else{var s=t||1;s/=2,this.localHeadGeometry.push(new Pn(-s,0,0)),this.localHeadGeometry.push(new Pn(s,0,0)),this.VerticesPerNode=2}this.FacesPerNode=2*(this.VerticesPerNode-1),this.FaceIndicesPerNode=3*this.FacesPerNode},qj.prototype.initializeGeometry=function(){this.vertexCount=this.length*this.VerticesPerNode,this.faceCount=this.length*this.FacesPerNode;var t=new vr,e=new Float32Array(this.vertexCount),n=new Float32Array(this.vertexCount*this.VerticesPerNode),i=new Float32Array(this.vertexCount*qj.PositionComponentCount),r=new Float32Array(this.vertexCount*qj.PositionComponentCount),s=new Float32Array(this.vertexCount*qj.UVComponentCount),a=new Uint32Array(this.faceCount*qj.IndicesPerFace),o=new ar(e,1);o.setUsage(35048),t.setAttribute("nodeID",o);var l=new ar(n,1);l.setUsage(35048),t.setAttribute("nodeVertexID",l);var h=new ar(r,qj.PositionComponentCount);h.setUsage(35048),t.setAttribute("nodeCenter",h);var c=new ar(i,qj.PositionComponentCount);c.setUsage(35048),t.setAttribute("position",c);var u=new ar(s,qj.UVComponentCount);u.setUsage(35048),t.setAttribute("uv",u);var d=new ar(a,1);d.setUsage(35048),t.setIndex(d),this.geometry=t},qj.prototype.zeroVertices=function(){for(var t=this.geometry.getAttribute("position"),e=0;e<this.vertexCount;e++){var n=3*e;t.array[n]=0,t.array[n+1]=0,t.array[n+2]=0}t.needsUpdate=!0,t.addUpdateRange.count=-1},qj.prototype.zeroIndices=function(){for(var t=this.geometry.getIndex(),e=0;e<this.faceCount;e++){var n=3*e;t.array[n]=0,t.array[n+1]=0,t.array[n+2]=0}t.needsUpdate=!0,t.addUpdateRange.count=-1},qj.prototype.formInitialFaces=function(){this.zeroIndices();for(var t=this.geometry.getIndex(),e=0;e<this.length-1;e++)this.connectNodes(e,e+1);t.needsUpdate=!0,t.addUpdateRange.count=-1},qj.prototype.initializeMesh=function(){this.mesh=new Fr(this.geometry,this.material),this.mesh.dynamic=!0,this.mesh.matrixAutoUpdate=!1,this.mesh.frustumCulled=!1},qj.prototype.destroyMesh=function(){this.mesh&&(this.scene.remove(this.mesh),this.mesh=null)},qj.prototype.reset=function(){this.currentLength=0,this.currentEnd=-1,this.lastNodeCenter=null,this.currentNodeCenter=null,this.lastOrientationDir=null,this.currentNodeID=0,this.formInitialFaces(),this.zeroVertices(),this.geometry.setDrawRange(0,0)},qj.prototype.updateUniforms=function(){this.currentLength<this.length?this.material.uniforms.minID.value=0:this.material.uniforms.minID.value=this.currentNodeID-this.length,this.material.uniforms.maxID.value=this.currentNodeID,this.material.uniforms.trailLength.value=this.currentLength,this.material.uniforms.maxTrailLength.value=this.length,this.material.uniforms.verticesPerNode.value=this.VerticesPerNode},qj.prototype.advance=function(){new Pn,new Pn,new Pn;var t=new si;return function(){this.targetObject.updateMatrixWorld(),t.copy(this.targetObject.matrixWorld),this.advanceWithTransform(t),this.updateUniforms()}}(),qj.prototype.advanceWithPositionAndOrientation=function(t,e){this.advanceGeometry({position:t,tangent:e},null)},qj.prototype.advanceWithTransform=function(t){this.advanceGeometry(null,t)},qj.prototype.advanceGeometry=(new Pn,new Pn,function(t,e){var n=this.currentEnd+1>=this.length?0:this.currentEnd+1;if(e?this.updateNodePositionsFromTransformMatrix(n,e):this.updateNodePositionsFromOrientationTangent(n,t.position,t.tangent),this.currentLength>=1&&(this.connectNodes(this.currentEnd,n),this.currentLength>=this.length)){var i=this.currentEnd+1>=this.length?0:this.currentEnd+1;this.disconnectNodes(i)}this.currentLength<this.length&&this.currentLength++,this.currentEnd++,this.currentEnd>=this.length&&(this.currentEnd=0),this.currentLength>=1&&(this.currentLength<this.length?this.geometry.setDrawRange(0,(this.currentLength-1)*this.FaceIndicesPerNode):this.geometry.setDrawRange(0,this.currentLength*this.FaceIndicesPerNode)),this.updateNodeID(this.currentEnd,this.currentNodeID),this.currentNodeID++}),qj.prototype.updateHead=(Kj=new si,function(){this.currentEnd<0||(this.targetObject.updateMatrixWorld(),Kj.copy(this.targetObject.matrixWorld),this.updateNodePositionsFromTransformMatrix(this.currentEnd,Kj))}),qj.prototype.updateNodeID=function(t,e){this.nodeIDs[t]=e;for(var n=this.geometry.getAttribute("nodeID"),i=this.geometry.getAttribute("nodeVertexID"),r=0;r<this.VerticesPerNode;r++){var s=t*this.VerticesPerNode+r;n.array[s]=e,i.array[s]=r}n.needsUpdate=!0,i.needsUpdate=!0,n.addUpdateRange.offset=t*this.VerticesPerNode,n.addUpdateRange.count=this.VerticesPerNode,i.addUpdateRange.offset=t*this.VerticesPerNode,i.addUpdateRange.count=this.VerticesPerNode},qj.prototype.updateNodeCenter=function(t,e){this.lastNodeCenter=this.currentNodeCenter,this.currentNodeCenter=this.nodeCenters[t],this.currentNodeCenter.copy(e);for(var n=this.geometry.getAttribute("nodeCenter"),i=0;i<this.VerticesPerNode;i++){var r=3*(t*this.VerticesPerNode+i);n.array[r]=e.x,n.array[r+1]=e.y,n.array[r+2]=e.z}n.needsUpdate=!0,n.addUpdateRange.offset=t*this.VerticesPerNode*qj.PositionComponentCount,n.addUpdateRange.count=this.VerticesPerNode*qj.PositionComponentCount},qj.prototype.updateNodePositionsFromOrientationTangent=function(){new si;for(var t=new Cn,e=new Pn,n=[],i=0;i<qj.MaxHeadVertices;i++){var r=new Pn;n.push(r)}return function(i,r,s){var a=this.geometry.getAttribute("position");this.updateNodeCenter(i,r),e.copy(r),e.sub(qj.LocalHeadOrigin),t.setFromUnitVectors(qj.LocalOrientationTangent,s);for(var o=0;o<this.localHeadGeometry.length;o++){var l=n[o];l.copy(this.localHeadGeometry[o]),l.applyQuaternion(t),l.add(e)}for(o=0;o<this.localHeadGeometry.length;o++){var h=(this.VerticesPerNode*i+o)*qj.PositionComponentCount,c=n[o];a.array[h]=c.x,a.array[h+1]=c.y,a.array[h+2]=c.z}a.needsUpdate=!0}}(),qj.prototype.updateNodePositionsFromTransformMatrix=function(){new si;for(var t=new $e,e=new Cn,n=new Pn,i=new Pn,r=new Pn,s=new Pn,a=[],o=0;o<qj.MaxHeadVertices;o++){var l=new Pn;a.push(l)}return function(o,l){var h,c,u=this.geometry.getAttribute("position");n.set(0,0,0),n.applyMatrix4(l),this.updateNodeCenter(o,n);for(var d=0;d<this.localHeadGeometry.length;d++){(p=a[d]).copy(this.localHeadGeometry[d])}for(d=0;d<this.localHeadGeometry.length;d++){(p=a[d]).applyMatrix4(l)}if(this.lastNodeCenter&&this.orientToMovement&&(h=t,c=l.elements,h.set(c[0],c[1],c[2],c[4],c[5],c[6],c[8],c[9],c[10]),r.set(0,0,-1),r.applyMatrix3(t),s.copy(this.currentNodeCenter),s.sub(this.lastNodeCenter),s.normalize(),s.lengthSq()<=1e-4&&this.lastOrientationDir&&s.copy(this.lastOrientationDir),s.lengthSq()>1e-4)){this.lastOrientationDir||(this.lastOrientationDir=new Pn),e.setFromUnitVectors(r,s),i.copy(this.currentNodeCenter);for(d=0;d<this.localHeadGeometry.length;d++){var p;(p=a[d]).sub(i),p.applyQuaternion(e),p.add(i)}}for(d=0;d<this.localHeadGeometry.length;d++){var f=(this.VerticesPerNode*o+d)*qj.PositionComponentCount,m=a[d];u.array[f]=m.x,u.array[f+1]=m.y,u.array[f+2]=m.z}u.needsUpdate=!0,u.addUpdateRange.offset=o*this.VerticesPerNode*qj.PositionComponentCount,u.addUpdateRange.count=this.VerticesPerNode*qj.PositionComponentCount}}(),qj.prototype.connectNodes=function(){var t={attribute:null,offset:0,count:-1};return function(e,n){for(var i=this.geometry.getIndex(),r=0;r<this.localHeadGeometry.length-1;r++){var s=this.VerticesPerNode*e+r,a=this.VerticesPerNode*n+r,o=(e*this.FacesPerNode+r*qj.FacesPerQuad)*qj.IndicesPerFace;i.array[o]=s,i.array[o+1]=a,i.array[o+2]=s+1,i.array[o+3]=a,i.array[o+4]=a+1,i.array[o+5]=s+1}return i.needsUpdate=!0,i.addUpdateRange.count=-1,t.attribute=i,t.offset=e*this.FacesPerNode*qj.IndicesPerFace,t.count=this.FacesPerNode*qj.IndicesPerFace,t}}(),qj.prototype.disconnectNodes=function(){var t={attribute:null,offset:0,count:-1};return function(e){for(var n=this.geometry.getIndex(),i=0;i<this.localHeadGeometry.length-1;i++){this.VerticesPerNode;var r=(e*this.FacesPerNode+i*qj.FacesPerQuad)*qj.IndicesPerFace;n.array[r]=0,n.array[r+1]=0,n.array[r+2]=0,n.array[r+3]=0,n.array[r+4]=0,n.array[r+5]=0}return n.needsUpdate=!0,n.addUpdateRange.count=-1,t.attribute=n,t.offset=e*this.FacesPerNode*qj.IndicesPerFace,t.count=this.FacesPerNode*qj.IndicesPerFace,t}}(),qj.prototype.deactivate=function(){this.isActive&&(this.scene.remove(this.mesh),this.isActive=!1)},qj.prototype.activate=function(){this.isActive||(this.scene.add(this.mesh),this.isActive=!0)};var Jj=function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(S6){return!1}};let Zj=class{constructor(t,e){n(this,"config"),n(this,"renderer"),this.config=t,this.renderer=e}setRenderer(t){this.renderer=t}resize(t,e){let n=this.renderer,i=this.renderer.domElement;const r=this.config;let s,a,o=r.resolution||1,l=1/o;if(r.maxDimension&&t*o>r.maxDimension&&e*o>r.maxDimension){var h=r.maxDimension;l=Math.min(t/h,e/h)+.0015,o=1,s=Math.ceil(t/l),a=Math.ceil(e/l)}else s=t*o,a=e*o;i.style.transform="scale("+l+")",i.style.transformOrigin="top left",i.style.left="0px",i.style.top="0px";const c=e6.projectConfig.generalSettings.lockScreen,u=mN();return"landscape"===c?"portrait"===u&&(i.style.transform="scale("+l+") rotate(90deg)",i.style.left=e+"px"):"portrait"===c&&"landscape"===u&&(i.style.transform="scale("+l+") rotate(-90deg)",i.style.left="0px",i.style.top=t+"px"),n.setSize(s,a),{width:s,height:a}}};Oi.prototype.sID="",Oi.prototype.label="",Oi.prototype.isGameObject=!1,Oi.prototype.selected=!1,Oi.prototype.locked=!1,Oi.prototype.destroy=function(){var t,e;null==(t=this.parent)||t.remove(this),this.traverse(t=>{t instanceof Fr&&(t.material.dispose(),BN.removeFromList(t))}),null==(e=this.components)||e.removeAll(),BN.removeFromList(this)},Oi.prototype.setVisible=function(t){this.visible=t},Oi.prototype.initComponentSystem=function(){this.components=new jj(this)},Oi.prototype.updateComponents=function(t){this.components.updateComponents(t)},Oi.prototype.getComponent=function(t){return this.components.get(t)},Oi.prototype.update=function(t){},Gu.prototype.updateComponents=function(t){const e=t.light;e&&(this.color.set(e.color),this.intensity=e.intensity),Oi.prototype.updateComponents.call(this,t)},Oi.prototype.isStudioObject=!1;class Qj{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=$j(),this._delta=0,this._elapsed=0,this._timescale=1,this._usePageVisibilityAPI="undefined"!=typeof document&&void 0!==document.hidden,!0===this._usePageVisibilityAPI&&(this._pageVisibilityHandler=tY.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(t){return this._timescale=t,this}reset(){return this._currentTime=$j()-this._startTime,this}dispose(){return!0===this._usePageVisibilityAPI&&document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this}update(t){return!0===this._usePageVisibilityAPI&&!0===document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==t?t:$j())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function $j(){return("undefined"==typeof performance?Date:performance).now()}function tY(){!1===document.hidden&&this.reset()}const eY={type:"change"},nY={type:"start"},iY={type:"end"},rY=new ri,sY=new es,aY=Math.cos(70*Ze.DEG2RAD);class oY extends ze{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Pn,this.cursor=new Pn,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:A.ROTATE,MIDDLE:A.DOLLY,RIGHT:A.PAN},this.touches={ONE:E.ROTATE,TWO:E.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",Z),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(eY),n.update(),r=i.NONE},this.update=function(){const e=new Pn,c=(new Cn).setFromUnitVectors(t.up,new Pn(0,1,0)),u=c.clone().invert(),d=new Pn,p=new Cn,f=new Pn,m=2*Math.PI;return function(g=null){const v=n.object.position;e.copy(v).sub(n.target),e.applyQuaternion(c),a.setFromVector3(e),n.autoRotate&&r===i.NONE&&C(function(t){return null!==t?2*Math.PI/60*n.autoRotateSpeed*t:2*Math.PI/60/60*n.autoRotateSpeed}(g)),n.enableDamping?(a.theta+=o.theta*n.dampingFactor,a.phi+=o.phi*n.dampingFactor):(a.theta+=o.theta,a.phi+=o.phi);let y=n.minAzimuthAngle,S=n.maxAzimuthAngle;isFinite(y)&&isFinite(S)&&(y<-Math.PI?y+=m:y>Math.PI&&(y-=m),S<-Math.PI?S+=m:S>Math.PI&&(S-=m),a.theta=y<=S?Math.max(y,Math.min(S,a.theta)):a.theta>(y+S)/2?Math.max(y,a.theta):Math.min(S,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),n.target.add(n.cursor);let w=!1;if(n.zoomToCursor&&_||n.object.isOrthographicCamera)a.radius=L(a.radius);else{const t=a.radius;a.radius=L(a.radius*l),w=t!=a.radius}if(e.setFromSpherical(a),e.applyQuaternion(u),v.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(o.theta*=1-n.dampingFactor,o.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(o.set(0,0,0),h.set(0,0,0)),n.zoomToCursor&&_){let i=null;if(n.object.isPerspectiveCamera){const t=e.length();i=L(t*l);const r=t-i;n.object.position.addScaledVector(x,r),n.object.updateMatrixWorld(),w=!!r}else if(n.object.isOrthographicCamera){const t=new Pn(b.x,b.y,0);t.unproject(n.object);const r=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),w=r!==n.object.zoom;const s=new Pn(b.x,b.y,0);s.unproject(n.object),n.object.position.sub(s).add(t),n.object.updateMatrixWorld(),i=e.length()}else n.zoomToCursor=!1;null!==i&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(i).add(n.object.position):(rY.origin.copy(n.object.position),rY.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(rY.direction))<aY?t.lookAt(n.target):(sY.setFromNormalAndCoplanarPoint(n.object.up,n.target),rY.intersectPlane(sY,n.target))))}else if(n.object.isOrthographicCamera){const t=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),t!==n.object.zoom&&(n.object.updateProjectionMatrix(),w=!0)}return l=1,_=!1,!!(w||d.distanceToSquared(n.object.position)>s||8*(1-p.dot(n.object.quaternion))>s||f.distanceToSquared(n.target)>s)&&(n.dispatchEvent(eY),d.copy(n.object.position),p.copy(n.object.quaternion),f.copy(n.target),!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",$),n.domElement.removeEventListener("pointerdown",W),n.domElement.removeEventListener("pointercancel",Y),n.domElement.removeEventListener("wheel",q),n.domElement.removeEventListener("pointermove",j),n.domElement.removeEventListener("pointerup",Y);n.domElement.getRootNode().removeEventListener("keydown",K,{capture:!0}),null!==n._domElementKeyEvents&&(n._domElementKeyEvents.removeEventListener("keydown",Z),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const s=1e-6,a=new Yd,o=new Yd;let l=1;const h=new Pn,c=new Qe,u=new Qe,d=new Qe,p=new Qe,f=new Qe,m=new Qe,g=new Qe,v=new Qe,y=new Qe,x=new Pn,b=new Qe;let _=!1;const S=[],w={};let T=!1;function M(t){const e=Math.abs(.01*t);return Math.pow(.95,n.zoomSpeed*e)}function C(t){o.theta-=t}function P(t){o.phi-=t}const R=function(){const t=new Pn;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),h.add(t)}}(),I=function(){const t=new Pn;return function(e,i){!0===n.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),h.add(t)}}(),O=function(){const t=new Pn;return function(e,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;t.copy(s).sub(n.target);let a=t.length();a*=Math.tan(n.object.fov/2*Math.PI/180),R(2*e*a/r.clientHeight,n.object.matrix),I(2*i*a/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(R(e*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),I(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):n.enablePan=!1}}();function D(t){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l/=t:n.enableZoom=!1}function B(t){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l*=t:n.enableZoom=!1}function F(t,e){if(!n.zoomToCursor)return;_=!0;const i=n.domElement.getBoundingClientRect(),r=t-i.left,s=e-i.top,a=i.width,o=i.height;b.x=r/a*2-1,b.y=-s/o*2+1,x.set(b.x,b.y,1).unproject(n.object).sub(n.object.position).normalize()}function L(t){return Math.max(n.minDistance,Math.min(n.maxDistance,t))}function U(t){c.set(t.clientX,t.clientY)}function k(t){p.set(t.clientX,t.clientY)}function N(t){if(1===S.length)c.set(t.pageX,t.pageY);else{const e=et(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);c.set(n,i)}}function z(t){if(1===S.length)p.set(t.pageX,t.pageY);else{const e=et(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);p.set(n,i)}}function G(t){const e=et(t),n=t.pageX-e.x,i=t.pageY-e.y,r=Math.sqrt(n*n+i*i);g.set(0,r)}function H(t){if(1==S.length)u.set(t.pageX,t.pageY);else{const e=et(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);u.set(n,i)}d.subVectors(u,c).multiplyScalar(n.rotateSpeed);const e=n.domElement;C(2*Math.PI*d.x/e.clientHeight),P(2*Math.PI*d.y/e.clientHeight),c.copy(u)}function V(t){if(1===S.length)f.set(t.pageX,t.pageY);else{const e=et(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);f.set(n,i)}m.subVectors(f,p).multiplyScalar(n.panSpeed),O(m.x,m.y),p.copy(f)}function X(t){const e=et(t),i=t.pageX-e.x,r=t.pageY-e.y,s=Math.sqrt(i*i+r*r);v.set(0,s),y.set(0,Math.pow(v.y/g.y,n.zoomSpeed)),D(y.y),g.copy(v);F(.5*(t.pageX+e.x),.5*(t.pageY+e.y))}function W(t){!1!==n.enabled&&(0===S.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",j),n.domElement.addEventListener("pointerup",Y)),function(t){for(let e=0;e<S.length;e++)if(S[e]==t.pointerId)return!0;return!1}(t)||(function(t){S.push(t.pointerId)}(t),"touch"===t.pointerType?Q(t):function(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case A.DOLLY:if(!1===n.enableZoom)return;!function(t){F(t.clientX,t.clientX),g.set(t.clientX,t.clientY)}(t),r=i.DOLLY;break;case A.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;k(t),r=i.PAN}else{if(!1===n.enableRotate)return;U(t),r=i.ROTATE}break;case A.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;U(t),r=i.ROTATE}else{if(!1===n.enablePan)return;k(t),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(nY)}(t)))}function j(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(tt(t),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;H(t),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;V(t),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&X(t),n.enablePan&&V(t)}(t),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&X(t),n.enableRotate&&H(t)}(t),n.update();break;default:r=i.NONE}}(t):function(t){switch(r){case i.ROTATE:if(!1===n.enableRotate)return;!function(t){u.set(t.clientX,t.clientY),d.subVectors(u,c).multiplyScalar(n.rotateSpeed);const e=n.domElement;C(2*Math.PI*d.x/e.clientHeight),P(2*Math.PI*d.y/e.clientHeight),c.copy(u),n.update()}(t);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(t){v.set(t.clientX,t.clientY),y.subVectors(v,g),y.y>0?D(M(y.y)):y.y<0&&B(M(y.y)),g.copy(v),n.update()}(t);break;case i.PAN:if(!1===n.enablePan)return;!function(t){f.set(t.clientX,t.clientY),m.subVectors(f,p).multiplyScalar(n.panSpeed),O(m.x,m.y),p.copy(f),n.update()}(t)}}(t))}function Y(t){switch(function(t){delete w[t.pointerId];for(let e=0;e<S.length;e++)if(S[e]==t.pointerId)return void S.splice(e,1)}(t),S.length){case 0:n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",j),n.domElement.removeEventListener("pointerup",Y),n.dispatchEvent(iY),r=i.NONE;break;case 1:const e=S[0],s=w[e];Q({pointerId:e,pageX:s.x,pageY:s.y})}}function q(t){!1!==n.enabled&&!1!==n.enableZoom&&r===i.NONE&&(t.preventDefault(),n.dispatchEvent(nY),function(t){F(t.clientX,t.clientY),t.deltaY<0?B(M(t.deltaY)):t.deltaY>0&&D(M(t.deltaY)),n.update()}(function(t){const e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}t.ctrlKey&&!T&&(n.deltaY*=10);return n}(t)),n.dispatchEvent(iY))}function K(t){if("Control"===t.key){T=!0;n.domElement.getRootNode().addEventListener("keyup",J,{passive:!0,capture:!0})}}function J(t){if("Control"===t.key){T=!1;n.domElement.getRootNode().removeEventListener("keyup",J,{passive:!0,capture:!0})}}function Z(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?P(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):O(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?P(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):O(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?C(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):O(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?C(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):O(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function Q(t){switch(tt(t),S.length){case 1:switch(n.touches.ONE){case E.ROTATE:if(!1===n.enableRotate)return;N(t),r=i.TOUCH_ROTATE;break;case E.PAN:if(!1===n.enablePan)return;z(t),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case E.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&G(t),n.enablePan&&z(t)}(t),r=i.TOUCH_DOLLY_PAN;break;case E.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&G(t),n.enableRotate&&N(t)}(t),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(nY)}function $(t){!1!==n.enabled&&t.preventDefault()}function tt(t){let e=w[t.pointerId];void 0===e&&(e=new Qe,w[t.pointerId]=e),e.set(t.pageX,t.pageY)}function et(t){const e=t.pointerId===S[0]?S[1]:S[0];return w[e]}n.domElement.addEventListener("contextmenu",$),n.domElement.addEventListener("pointerdown",W),n.domElement.addEventListener("pointercancel",Y),n.domElement.addEventListener("wheel",q,{passive:!1});n.domElement.getRootNode().addEventListener("keydown",K,{passive:!0,capture:!0}),this.update()}}const lY=1.25,hY=65535,cY=Math.pow(2,-24),uY=Symbol("SKIP_GENERATION");function dY(t){return function(t){return t.index?t.index.count:t.attributes.position.count}(t)/3}function pY(t,e){if(!t.index){const n=t.attributes.position.count,i=function(t,e=ArrayBuffer){return t>65535?new Uint32Array(new e(4*t)):new Uint16Array(new e(2*t))}(n,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);t.setIndex(new ar(i,1));for(let t=0;t<n;t++)i[t]=t}}function fY(t){const e=dY(t),n=t.drawRange,i=n.start/3,r=(n.start+n.count)/3,s=Math.max(0,i),a=Math.min(e,r)-s;return[{offset:Math.floor(s),count:Math.floor(a)}]}function mY(t){if(!t.groups||!t.groups.length)return fY(t);const e=[],n=new Set,i=t.drawRange,r=i.start/3,s=(i.start+i.count)/3;for(const o of t.groups){const t=o.start/3,e=(o.start+o.count)/3;n.add(Math.max(r,t)),n.add(Math.min(s,e))}const a=Array.from(n.values()).sort((t,e)=>t-e);for(let o=0;o<a.length-1;o++){const t=a[o],n=a[o+1];e.push({offset:Math.floor(t),count:Math.floor(n-t)})}return e}function gY(t,e,n,i,r){let s=1/0,a=1/0,o=1/0,l=-1/0,h=-1/0,c=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0;for(let v=6*e,y=6*(e+n);v<y;v+=6){const e=t[v+0],n=t[v+1],i=e-n,r=e+n;i<s&&(s=i),r>l&&(l=r),e<u&&(u=e),e>f&&(f=e);const y=t[v+2],x=t[v+3],b=y-x,_=y+x;b<a&&(a=b),_>h&&(h=_),y<d&&(d=y),y>m&&(m=y);const S=t[v+4],w=t[v+5],T=S-w,M=S+w;T<o&&(o=T),M>c&&(c=M),S<p&&(p=S),S>g&&(g=S)}i[0]=s,i[1]=a,i[2]=o,i[3]=l,i[4]=h,i[5]=c,r[0]=u,r[1]=d,r[2]=p,r[3]=f,r[4]=m,r[5]=g}function vY(t,e,n){return n.min.x=e[t],n.min.y=e[t+1],n.min.z=e[t+2],n.max.x=e[t+3],n.max.y=e[t+4],n.max.z=e[t+5],n}function yY(t){let e=-1,n=-1/0;for(let i=0;i<3;i++){const r=t[i+3]-t[i];r>n&&(n=r,e=i)}return e}function xY(t,e){e.set(t)}function bY(t,e,n){let i,r;for(let s=0;s<3;s++){const a=s+3;i=t[s],r=e[s],n[s]=i<r?i:r,i=t[a],r=e[a],n[a]=i>r?i:r}}function _Y(t,e,n){for(let i=0;i<3;i++){const r=e[t+2*i],s=e[t+2*i+1],a=r-s,o=r+s;a<n[i]&&(n[i]=a),o>n[i+3]&&(n[i+3]=o)}}function SY(t){const e=t[3]-t[0],n=t[4]-t[1],i=t[5]-t[2];return 2*(e*n+n*i+i*e)}const wY=32,TY=(t,e)=>t.candidate-e.candidate,MY=new Array(wY).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),AY=new Float32Array(6);class EY{constructor(){this.boundingData=new Float32Array(6)}}function CY(t,e,n,i,r,s){let a=i,o=i+r-1;const l=s.pos,h=2*s.axis;for(;;){for(;a<=o&&n[6*a+h]<l;)a++;for(;a<=o&&n[6*o+h]>=l;)o--;if(!(a<o))return a;for(let t=0;t<3;t++){let n=e[3*a+t];e[3*a+t]=e[3*o+t],e[3*o+t]=n}for(let t=0;t<6;t++){let e=n[6*a+t];n[6*a+t]=n[6*o+t],n[6*o+t]=e}a++,o--}}function PY(t,e,n,i,r,s){let a=i,o=i+r-1;const l=s.pos,h=2*s.axis;for(;;){for(;a<=o&&n[6*a+h]<l;)a++;for(;a<=o&&n[6*o+h]>=l;)o--;if(!(a<o))return a;{let e=t[a];t[a]=t[o],t[o]=e;for(let t=0;t<6;t++){let e=n[6*a+t];n[6*a+t]=n[6*o+t],n[6*o+t]=e}a++,o--}}}function RY(t,e){return 65535===e[t+15]}function IY(t,e){return e[t+6]}function OY(t,e){return e[t+14]}function DY(t){return t+8}function BY(t,e){return e[t+6]}function FY(t,e){return e[t+7]}function LY(t){return t}let UY,kY,NY,zY;const GY=Math.pow(2,32);function HY(t){return"count"in t?1:1+HY(t.left)+HY(t.right)}function VY(t,e,n){return UY=new Float32Array(n),kY=new Uint32Array(n),NY=new Uint16Array(n),zY=new Uint8Array(n),XY(t,e)}function XY(t,e){const n=t/4,i=t/2,r="count"in e,s=e.boundingData;for(let a=0;a<6;a++)UY[n+a]=s[a];if(r){if(e.buffer){const i=e.buffer;zY.set(new Uint8Array(i),t);for(let e=t,r=t+i.byteLength;e<r;e+=32){RY(e/2,NY)||(kY[e/4+6]+=n)}return t+i.byteLength}{const r=e.offset,s=e.count;return kY[n+6]=r,NY[i+14]=s,NY[i+15]=hY,t+32}}{const i=e.left,r=e.right,s=e.splitAxis;let a;if(a=XY(t+32,i),a/4>GY)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return kY[n+6]=a/4,a=XY(a,r),kY[n+7]=s,a}}function WY(t,e,n,i,r){const{maxDepth:s,verbose:a,maxLeafTris:o,strategy:l,onProgress:h,indirect:c}=r,u=t._indirectBuffer,d=t.geometry,p=d.index?d.index.array:null,f=c?PY:CY,m=dY(d),g=new Float32Array(6);let v=!1;const y=new EY;return gY(e,n,i,y.boundingData,g),function t(n,i,r,a=null,h=0){!v&&h>=s&&(v=!0);if(r<=o||h>=s)return x(i+r),n.offset=i,n.count=r,n;const c=function(t,e,n,i,r,s){let a=-1,o=0;if(0===s)a=yY(e),-1!==a&&(o=(e[a]+e[a+3])/2);else if(1===s)a=yY(t),-1!==a&&(o=function(t,e,n,i){let r=0;for(let s=e,a=e+n;s<a;s++)r+=t[6*s+2*i];return r/n}(n,i,r,a));else if(2===s){const s=SY(t);let l=lY*r;const h=6*i,c=6*(i+r);for(let t=0;t<3;t++){const i=e[t],u=(e[t+3]-i)/wY;if(r<8){const e=[...MY];e.length=r;let i=0;for(let r=h;r<c;r+=6,i++){const s=e[i];s.candidate=n[r+2*t],s.count=0;const{bounds:a,leftCacheBounds:o,rightCacheBounds:l}=s;for(let t=0;t<3;t++)l[t]=1/0,l[t+3]=-1/0,o[t]=1/0,o[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0;_Y(r,n,a)}e.sort(TY);let u=r;for(let t=0;t<u;t++){const n=e[t];for(;t+1<u&&e[t+1].candidate===n.candidate;)e.splice(t+1,1),u--}for(let r=h;r<c;r+=6){const i=n[r+2*t];for(let t=0;t<u;t++){const s=e[t];i>=s.candidate?_Y(r,n,s.rightCacheBounds):(_Y(r,n,s.leftCacheBounds),s.count++)}}for(let n=0;n<u;n++){const i=e[n],h=i.count,c=r-i.count,u=i.leftCacheBounds,d=i.rightCacheBounds;let p=0;0!==h&&(p=SY(u)/s);let f=0;0!==c&&(f=SY(d)/s);const m=1+lY*(p*h+f*c);m<l&&(a=t,l=m,o=i.candidate)}}else{for(let t=0;t<wY;t++){const e=MY[t];e.count=0,e.candidate=i+u+t*u;const n=e.bounds;for(let t=0;t<3;t++)n[t]=1/0,n[t+3]=-1/0}for(let r=h;r<c;r+=6){let e=~~((n[r+2*t]-i)/u);e>=wY&&(e=31);const s=MY[e];s.count++,_Y(r,n,s.bounds)}const e=MY[31];xY(e.bounds,e.rightCacheBounds);for(let t=30;t>=0;t--){const e=MY[t],n=MY[t+1];bY(e.bounds,n.rightCacheBounds,e.rightCacheBounds)}let d=0;for(let n=0;n<31;n++){const e=MY[n],i=e.count,h=e.bounds,c=MY[n+1].rightCacheBounds;0!==i&&(0===d?xY(h,AY):bY(h,AY,AY)),d+=i;let u=0,p=0;0!==d&&(u=SY(AY)/s);const f=r-d;0!==f&&(p=SY(c)/s);const m=1+lY*(u*d+p*f);m<l&&(a=t,l=m,o=e.candidate)}}}}return{axis:a,pos:o}}(n.boundingData,a,e,i,r,l);if(-1===c.axis)return x(i+r),n.offset=i,n.count=r,n;const d=f(u,p,e,i,r,c);if(d===i||d===i+r)x(i+r),n.offset=i,n.count=r;else{n.splitAxis=c.axis;const s=new EY,a=i,o=d-i;n.left=s,gY(e,a,o,s.boundingData,g),t(s,a,o,g,h+1);const l=new EY,u=d,p=r-o;n.right=l,gY(e,u,p,l.boundingData,g),t(l,u,p,g,h+1)}return n}(y,n,i,g),y;function x(t){h&&h(t/m)}}function jY(t,e){const n=t.geometry;e.indirect&&(t._indirectBuffer=function(t,e){const n=(t.index?t.index.count:t.attributes.position.count)/3,i=n>65536,r=i?4:2,s=e?new SharedArrayBuffer(n*r):new ArrayBuffer(n*r),a=i?new Uint32Array(s):new Uint16Array(s);for(let o=0,l=a.length;o<l;o++)a[o]=o;return a}(n,e.useSharedArrayBuffer),function(t){if(0===t.groups.length)return!1;const e=dY(t),n=mY(t).sort((t,e)=>t.offset-e.offset),i=n[n.length-1];i.count=Math.min(e-i.offset,i.count);let r=0;return n.forEach(({count:t})=>r+=t),e!==r}(n)&&e.verbose),t._indirectBuffer||pY(n,e);const i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=function(t,e=null,n=null,i=null){const r=t.attributes.position,s=t.index?t.index.array:null,a=dY(t),o=r.normalized;let l;null===e?(l=new Float32Array(6*a*4),n=0,i=a):(l=e,n=n||0,i=i||a);const h=r.array,c=r.offset||0;let u=3;r.isInterleavedBufferAttribute&&(u=r.data.stride);const d=["getX","getY","getZ"];for(let p=n;p<n+i;p++){const t=3*p,e=6*p;let n=t+0,i=t+1,a=t+2;s&&(n=s[n],i=s[i],a=s[a]),o||(n=n*u+c,i=i*u+c,a=a*u+c);for(let s=0;s<3;s++){let t,c,u;o?(t=r[d[s]](n),c=r[d[s]](i),u=r[d[s]](a)):(t=h[n+s],c=h[i+s],u=h[a+s]);let p=t;c<p&&(p=c),u<p&&(p=u);let f=t;c>f&&(f=c),u>f&&(f=u);const m=(f-p)/2,g=2*s;l[e+g+0]=p+m,l[e+g+1]=m+(Math.abs(p)+m)*cY}}return l}(n),s=e.indirect?fY(n):mY(n);t._roots=s.map(n=>{const s=WY(t,r,n.offset,n.count,e),a=HY(s),o=new i(32*a);return VY(0,s,o),o})}class YY{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,i=-1/0;for(let r=0,s=t.length;r<s;r++){const s=t[r][e];n=s<n?s:n,i=s>i?s:i}this.min=n,this.max=i}setFromPoints(t,e){let n=1/0,i=-1/0;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=t.dot(s);n=a<n?a:n,i=a>i?a:i}this.min=n,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}YY.prototype.setFromBox=function(){const t=new Pn;return function(e,n){const i=n.min,r=n.max;let s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let n=0;n<=1;n++)for(let l=0;l<=1;l++){t.x=i.x*o+r.x*(1-o),t.y=i.y*n+r.y*(1-n),t.z=i.z*l+r.z*(1-l);const h=e.dot(t);s=Math.min(h,s),a=Math.max(h,a)}this.min=s,this.max=a}}();const qY=function(){const t=new Pn,e=new Pn,n=new Pn;return function(i,r,s){const a=i.start,o=t,l=r.start,h=e;n.subVectors(a,l),t.subVectors(i.end,i.start),e.subVectors(r.end,r.start);const c=n.dot(h),u=h.dot(o),d=h.dot(h),p=n.dot(o),f=o.dot(o)*d-u*u;let m,g;m=0!==f?(c*u-p*d)/f:0,g=(c+m*u)/d,s.x=m,s.y=g}}(),KY=function(){const t=new Qe,e=new Pn,n=new Pn;return function(i,r,s,a){qY(i,r,t);let o=t.x,l=t.y;if(o>=0&&o<=1&&l>=0&&l<=1)return i.at(o,s),void r.at(l,a);if(o>=0&&o<=1)return l<0?r.at(0,a):r.at(1,a),void i.closestPointToPoint(a,!0,s);if(l>=0&&l<=1)return o<0?i.at(0,s):i.at(1,s),void r.closestPointToPoint(s,!0,a);{let t,h;t=o<0?i.start:i.end,h=l<0?r.start:r.end;const c=e,u=n;return i.closestPointToPoint(h,!0,e),r.closestPointToPoint(t,!0,n),c.distanceToSquared(h)<=u.distanceToSquared(t)?(s.copy(c),void a.copy(h)):(s.copy(t),void a.copy(u))}}}(),JY=function(){const t=new Pn,e=new Pn,n=new es,i=new Zd;return function(r,s){const{radius:a,center:o}=r,{a:l,b:h,c:c}=s;i.start=l,i.end=h;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=a)return!0;i.start=l,i.end=c;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=a)return!0;i.start=h,i.end=c;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=a)return!0;const u=s.getPlane(n);if(Math.abs(u.distanceToPoint(o))<=a){const t=u.projectPoint(o,e);if(s.containsPoint(t))return!0}return!1}}();function ZY(t){return Math.abs(t)<1e-15}class QY extends Vi{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new Pn),this.satBounds=new Array(4).fill().map(()=>new YY),this.points=[this.a,this.b,this.c],this.sphere=new Jn,this.plane=new es,this.needsUpdate=!0}intersectsSphere(t){return JY(t,this)}update(){const t=this.a,e=this.b,n=this.c,i=this.points,r=this.satAxes,s=this.satBounds,a=r[0],o=s[0];this.getNormal(a),o.setFromPoints(a,i);const l=r[1],h=s[1];l.subVectors(t,e),h.setFromPoints(l,i);const c=r[2],u=s[2];c.subVectors(e,n),u.setFromPoints(c,i);const d=r[3],p=s[3];d.subVectors(n,t),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}}QY.prototype.closestPointToSegment=function(){const t=new Pn,e=new Pn,n=new Zd;return function(i,r=null,s=null){const{start:a,end:o}=i,l=this.points;let h,c=1/0;for(let u=0;u<3;u++){const a=(u+1)%3;n.start.copy(l[u]),n.end.copy(l[a]),KY(n,i,t,e),h=t.distanceToSquared(e),h<c&&(c=h,r&&r.copy(t),s&&s.copy(e))}return this.closestPointToPoint(a,t),h=a.distanceToSquared(t),h<c&&(c=h,r&&r.copy(t),s&&s.copy(a)),this.closestPointToPoint(o,t),h=o.distanceToSquared(t),h<c&&(c=h,r&&r.copy(t),s&&s.copy(o)),Math.sqrt(c)}}(),QY.prototype.intersectsTriangle=function(){const t=new QY,e=new Array(3),n=new Array(3),i=new YY,r=new YY,s=new Pn,a=new Pn,o=new Pn,l=new Pn,h=new Pn,c=new Zd,u=new Zd,d=new Zd,p=new Pn;function f(t,e,n){const i=t.points;let r=0,s=-1;for(let o=0;o<3;o++){const{start:t,end:l}=c;t.copy(i[o]),l.copy(i[(o+1)%3]),c.delta(a);const h=ZY(e.distanceToPoint(t));if(ZY(e.normal.dot(a))&&h){n.copy(c),r=2;break}const u=e.intersectLine(c,p);if(!u&&h&&p.copy(t),(u||h)&&!ZY(p.distanceTo(l))){if(r<=1){(1===r?n.start:n.end).copy(p),h&&(s=r)}else if(r>=2){(1===s?n.start:n.end).copy(p),r=2;break}if(r++,2===r&&-1===s)break}}return r}return function(a,c=null,p=!1){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(t.copy(a),t.update(),a=t);const m=this.plane,g=a.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){const t=this.satBounds,o=this.satAxes;n[0]=a.a,n[1]=a.b,n[2]=a.c;for(let e=0;e<4;e++){const r=t[e],s=o[e];if(i.setFromPoints(s,n),r.isSeparated(i))return!1}const l=a.satBounds,h=a.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let n=0;n<4;n++){const t=l[n],r=h[n];if(i.setFromPoints(r,e),t.isSeparated(i))return!1}for(let a=0;a<4;a++){const t=o[a];for(let a=0;a<4;a++){const o=h[a];if(s.crossVectors(t,o),i.setFromPoints(s,e),r.setFromPoints(s,n),i.isSeparated(r))return!1}}return c&&(c.start.set(0,0,0),c.end.set(0,0,0)),!0}{const t=f(this,g,u);if(1===t&&a.containsPoint(u.end))return c&&(c.start.copy(u.end),c.end.copy(u.end)),!0;if(2!==t)return!1;const e=f(a,m,d);if(1===e&&this.containsPoint(d.end))return c&&(c.start.copy(d.end),c.end.copy(d.end)),!0;if(2!==e)return!1;if(u.delta(o),d.delta(l),o.dot(l)<0){let t=d.start;d.start=d.end,d.end=t}const n=u.start.dot(o),i=u.end.dot(o),r=d.start.dot(o),s=d.end.dot(o);return(n===s||r===i||i<r!==n<s)&&(c&&(h.subVectors(u.start,d.start),h.dot(o)>0?c.start.copy(u.start):c.start.copy(d.start),h.subVectors(u.end,d.end),h.dot(o)<0?c.end.copy(u.end):c.end.copy(d.end)),!0)}}}(),QY.prototype.distanceToPoint=function(){const t=new Pn;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),QY.prototype.distanceToTriangle=function(){const t=new Pn,e=new Pn,n=["a","b","c"],i=new Zd,r=new Zd;return function(s,a=null,o=null){const l=a||o?i:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let h=1/0;for(let e=0;e<3;e++){let i;const r=n[e],l=s[r];this.closestPointToPoint(l,t),i=l.distanceToSquared(t),i<h&&(h=i,a&&a.copy(t),o&&o.copy(l));const c=this[r];s.closestPointToPoint(c,t),i=c.distanceToSquared(t),i<h&&(h=i,a&&a.copy(c),o&&o.copy(t))}for(let c=0;c<3;c++){const l=n[c],u=n[(c+1)%3];i.set(this[l],this[u]);for(let c=0;c<3;c++){const l=n[c],u=n[(c+1)%3];r.set(s[l],s[u]),KY(i,r,t,e);const d=t.distanceToSquared(e);d<h&&(h=d,a&&a.copy(t),o&&o.copy(e))}}return Math.sqrt(h)}}();class $Y{constructor(t,e,n){this.isOrientedBox=!0,this.min=new Pn,this.max=new Pn,this.matrix=new si,this.invMatrix=new si,this.points=new Array(8).fill().map(()=>new Pn),this.satAxes=new Array(3).fill().map(()=>new Pn),this.satBounds=new Array(3).fill().map(()=>new YY),this.alignedSatBounds=new Array(3).fill().map(()=>new YY),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}$Y.prototype.update=function(){return function(){const t=this.matrix,e=this.min,n=this.max,i=this.points;for(let l=0;l<=1;l++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){const a=i[1*l|2*r|4*s];a.x=l?n.x:e.x,a.y=r?n.y:e.y,a.z=s?n.z:e.z,a.applyMatrix4(t)}const r=this.satBounds,s=this.satAxes,a=i[0];for(let l=0;l<3;l++){const t=s[l],e=r[l],n=i[1<<l];t.subVectors(a,n),e.setFromPoints(t,i)}const o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),$Y.prototype.intersectsBox=function(){const t=new YY;return function(e){this.needsUpdate&&this.update();const n=e.min,i=e.max,r=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(t.min=n.x,t.max=i.x,a[0].isSeparated(t))return!1;if(t.min=n.y,t.max=i.y,a[1].isSeparated(t))return!1;if(t.min=n.z,t.max=i.z,a[2].isSeparated(t))return!1;for(let o=0;o<3;o++){const n=s[o],i=r[o];if(t.setFromBox(n,e),i.isSeparated(t))return!1}return!0}}(),$Y.prototype.intersectsTriangle=function(){const t=new QY,e=new Array(3),n=new YY,i=new YY,r=new Pn;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(t.copy(s),t.update(),s=t);const a=this.satBounds,o=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let t=0;t<3;t++){const i=a[t],r=o[t];if(n.setFromPoints(r,e),i.isSeparated(n))return!1}const l=s.satBounds,h=s.satAxes,c=this.points;for(let t=0;t<3;t++){const e=l[t],i=h[t];if(n.setFromPoints(i,c),e.isSeparated(n))return!1}for(let t=0;t<3;t++){const s=o[t];for(let t=0;t<4;t++){const a=h[t];if(r.crossVectors(s,a),n.setFromPoints(r,e),i.setFromPoints(r,c),n.isSeparated(i))return!1}}return!0}}(),$Y.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}(),$Y.prototype.distanceToPoint=function(){const t=new Pn;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),$Y.prototype.distanceToBox=function(){const t=["x","y","z"],e=new Array(12).fill().map(()=>new Zd),n=new Array(12).fill().map(()=>new Zd),i=new Pn,r=new Pn;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(r),this.closestPointToPoint(r,i),s.closestPointToPoint(i,r),o&&o.copy(i),l&&l.copy(r)),0;const h=a*a,c=s.min,u=s.max,d=this.points;let p=1/0;for(let t=0;t<8;t++){const e=d[t];r.copy(e).clamp(c,u);const n=e.distanceToSquared(r);if(n<p&&(p=n,o&&o.copy(e),l&&l.copy(r),n<h))return Math.sqrt(n)}let f=0;for(let i=0;i<3;i++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){const a=(i+1)%3,o=(i+2)%3,l=1<<i|r<<a|s<<o,h=d[r<<a|s<<o],p=d[l];e[f].set(h,p);const m=t[i],g=t[a],v=t[o],y=n[f],x=y.start,b=y.end;x[m]=c[m],x[g]=r?c[g]:u[g],x[v]=s?c[v]:u[g],b[m]=u[m],b[g]=r?c[g]:u[g],b[v]=s?c[v]:u[g],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let n=0;n<=1;n++){r.x=t?u.x:c.x,r.y=e?u.y:c.y,r.z=n?u.z:c.z,this.closestPointToPoint(r,i);const s=r.distanceToSquared(i);if(s<p&&(p=s,o&&o.copy(i),l&&l.copy(r),s<h))return Math.sqrt(s)}for(let t=0;t<12;t++){const s=e[t];for(let t=0;t<12;t++){const e=n[t];KY(s,e,i,r);const a=i.distanceToSquared(r);if(a<p&&(p=a,o&&o.copy(i),l&&l.copy(r),a<h))return Math.sqrt(a)}}return Math.sqrt(p)}}();class tq{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class eq extends tq{constructor(){super(()=>new QY)}}const nq=new eq;const iq=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=n=>{e&&t.push(e),e=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==t.length&&this.setBuffer(t.pop())}}};let rq,sq;const aq=[],oq=new tq(()=>new On);function lq(t,e,n,i,r,s){rq=oq.getPrimitive(),sq=oq.getPrimitive(),aq.push(rq,sq),iq.setBuffer(t._roots[e]);const a=hq(0,t.geometry,n,i,r,s);iq.clearBuffer(),oq.releasePrimitive(rq),oq.releasePrimitive(sq),aq.pop(),aq.pop();const o=aq.length;return o>0&&(sq=aq[o-1],rq=aq[o-2]),a}function hq(t,e,n,i,r=null,s=0,a=0){const{float32Array:o,uint16Array:l,uint32Array:h}=iq;let c=2*t;if(RY(c,l)){const e=IY(t,h),n=OY(c,l);return vY(t,o,rq),i(e,n,!1,a,s+t,rq)}{let c=function(t){const{uint16Array:e,uint32Array:n}=iq;let i=2*t;for(;!RY(i,e);)i=2*(t=DY(t));return IY(t,n)},u=function(t){const{uint16Array:e,uint32Array:n}=iq;let i=2*t;for(;!RY(i,e);)i=2*(t=BY(t,n));return IY(t,n)+OY(i,e)};const d=DY(t),p=BY(t,h);let f,m,g,v,y=d,x=p;if(r&&(g=rq,v=sq,vY(y,o,g),vY(x,o,v),f=r(g),m=r(v),m<f)){y=p,x=d;const t=f;f=m,m=t,g=v}g||(g=rq,vY(y,o,g));const b=n(g,RY(2*y,l),f,a+1,s+y);let _;if(2===b){const t=c(y);_=i(t,u(y)-t,!0,a+1,s+y,g)}else _=b&&hq(y,e,n,i,r,s,a+1);if(_)return!0;v=sq,vY(x,o,v);const S=n(v,RY(2*x,l),m,a+1,s+x);let w;if(2===S){const t=c(x);w=i(t,u(x)-t,!0,a+1,s+x,v)}else w=S&&hq(x,e,n,i,r,s,a+1);return!!w}}const cq=new Pn,uq=new Pn;const dq=new Pn,pq=new Pn,fq=new Pn,mq=new Qe,gq=new Qe,vq=new Qe,yq=new Pn,xq=new Pn,bq=new Pn,_q=new Pn;function Sq(t,e,n,i,r){const s=3*i;let a=s+0,o=s+1,l=s+2;const h=t.index;t.index&&(a=h.getX(a),o=h.getX(o),l=h.getX(l));const{position:c,normal:u,uv:d,uv1:p}=t.attributes,f=function(t,e,n,i,r,s,a,o,l){dq.fromBufferAttribute(e,s),pq.fromBufferAttribute(e,a),fq.fromBufferAttribute(e,o);const h=function(t,e,n,i,r,s){let a;return a=1===s?t.intersectTriangle(i,n,e,!0,r):t.intersectTriangle(e,n,i,2!==s,r),null===a?null:{distance:t.origin.distanceTo(r),point:r.clone()}}(t,dq,pq,fq,_q,l);if(h){i&&(mq.fromBufferAttribute(i,s),gq.fromBufferAttribute(i,a),vq.fromBufferAttribute(i,o),h.uv=Vi.getInterpolation(_q,dq,pq,fq,mq,gq,vq,new Qe)),r&&(mq.fromBufferAttribute(r,s),gq.fromBufferAttribute(r,a),vq.fromBufferAttribute(r,o),h.uv1=Vi.getInterpolation(_q,dq,pq,fq,mq,gq,vq,new Qe)),n&&(yq.fromBufferAttribute(n,s),xq.fromBufferAttribute(n,a),bq.fromBufferAttribute(n,o),h.normal=Vi.getInterpolation(_q,dq,pq,fq,yq,xq,bq,new Pn),h.normal.dot(t.direction)>0&&h.normal.multiplyScalar(-1));const e={a:s,b:a,c:o,normal:new Pn,materialIndex:0};Vi.getNormal(dq,pq,fq,e.normal),h.face=e,h.faceIndex=s}return h}(n,c,u,d,p,a,o,l,e);return f?(f.faceIndex=i,r&&r.push(f),f):null}function wq(t,e,n,i){const r=t.a,s=t.b,a=t.c;let o=e,l=e+1,h=e+2;n&&(o=n.getX(o),l=n.getX(l),h=n.getX(h)),r.x=i.getX(o),r.y=i.getY(o),r.z=i.getZ(o),s.x=i.getX(l),s.y=i.getY(l),s.z=i.getZ(l),a.x=i.getX(h),a.y=i.getY(h),a.z=i.getZ(h)}function Tq(t,e,n,i,r,s,a){const{geometry:o}=n,{index:l}=o,h=o.attributes.position;for(let c=t,u=e+t;c<u;c++){let t;if(t=c,wq(a,3*t,l,h),a.needsUpdate=!0,i(a,t,r,s))return!0}return!1}function Mq(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const n=t.geometry,i=n.index?n.index.array:null,r=n.attributes.position;let s,a,o,l,h=0;const c=t._roots;for(let d=0,p=c.length;d<p;d++)s=c[d],a=new Uint32Array(s),o=new Uint16Array(s),l=new Float32Array(s),u(0,h),h+=s.byteLength;function u(t,n,s=!1){const h=2*t;if(o[h+15]===hY){const e=a[t+6];let n=1/0,s=1/0,c=1/0,u=-1/0,d=-1/0,p=-1/0;for(let t=3*e,a=3*(e+o[h+14]);t<a;t++){let e=i[t];const a=r.getX(e),o=r.getY(e),l=r.getZ(e);a<n&&(n=a),a>u&&(u=a),o<s&&(s=o),o>d&&(d=o),l<c&&(c=l),l>p&&(p=l)}return(l[t+0]!==n||l[t+1]!==s||l[t+2]!==c||l[t+3]!==u||l[t+4]!==d||l[t+5]!==p)&&(l[t+0]=n,l[t+1]=s,l[t+2]=c,l[t+3]=u,l[t+4]=d,l[t+5]=p,!0)}{const i=t+8,r=a[t+6],o=i+n,h=r+n;let c=s,d=!1,p=!1;e?c||(d=e.has(o),p=e.has(h),c=!d&&!p):(d=!0,p=!0);const f=c||p;let m=!1;(c||d)&&(m=u(i,n,c));let g=!1;f&&(g=u(r,n,c));const v=m||g;if(v)for(let e=0;e<3;e++){const n=i+e,s=r+e,a=l[n],o=l[n+3],h=l[s],c=l[s+3];l[t+e]=a<h?a:h,l[t+e+3]=o>c?o:c}return v}}}function Aq(t,e,n){let i,r,s,a,o,l;const h=1/n.direction.x,c=1/n.direction.y,u=1/n.direction.z,d=n.origin.x,p=n.origin.y,f=n.origin.z;let m=e[t],g=e[t+3],v=e[t+1],y=e[t+3+1],x=e[t+2],b=e[t+3+2];return h>=0?(i=(m-d)*h,r=(g-d)*h):(i=(g-d)*h,r=(m-d)*h),c>=0?(s=(v-p)*c,a=(y-p)*c):(s=(y-p)*c,a=(v-p)*c),!(i>a||s>r)&&((s>i||isNaN(i))&&(i=s),(a<r||isNaN(r))&&(r=a),u>=0?(o=(x-f)*u,l=(b-f)*u):(o=(b-f)*u,l=(x-f)*u),!(i>l||o>r)&&((l<r||r!=r)&&(r=l),!(r<0)))}function Eq(t,e,n,i,r,s,a){const{geometry:o}=n,{index:l}=o,h=o.attributes.position;for(let c=t,u=e+t;c<u;c++){let t;if(t=n.resolveTriangleIndex(c),wq(a,3*t,l,h),a.needsUpdate=!0,i(a,t,r,s))return!0}return!1}function Cq(t,e,n,i,r){iq.setBuffer(t._roots[e]),Pq(0,t,n,i,r),iq.clearBuffer()}function Pq(t,e,n,i,r){const{float32Array:s,uint16Array:a,uint32Array:o}=iq,l=2*t;if(RY(l,a)){!function(t,e,n,i,r,s){const{geometry:a,_indirectBuffer:o}=t;for(let l=i,h=i+r;l<h;l++)Sq(a,e,n,l,s)}(e,n,i,IY(t,o),OY(l,a),r)}else{const a=DY(t);Aq(a,s,i)&&Pq(a,e,n,i,r);const l=BY(t,o);Aq(l,s,i)&&Pq(l,e,n,i,r)}}const Rq=["x","y","z"];function Iq(t,e,n,i){iq.setBuffer(t._roots[e]);const r=Oq(0,t,n,i);return iq.clearBuffer(),r}function Oq(t,e,n,i){const{float32Array:r,uint16Array:s,uint32Array:a}=iq;let o=2*t;if(RY(o,s)){return function(t,e,n,i,r){const{geometry:s,_indirectBuffer:a}=t;let o=1/0,l=null;for(let h=i,c=i+r;h<c;h++){let t;t=Sq(s,e,n,h),t&&t.distance<o&&(l=t,o=t.distance)}return l}(e,n,i,IY(t,a),OY(o,s))}{const s=FY(t,a),o=Rq[s],l=i.direction[o]>=0;let h,c;l?(h=DY(t),c=BY(t,a)):(h=BY(t,a),c=DY(t));const u=Aq(h,r,i)?Oq(h,e,n,i):null;if(u){const t=u.point[o];if(l?t<=r[c+s]:t>=r[c+s+3])return u}const d=Aq(c,r,i)?Oq(c,e,n,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const Dq=new On,Bq=new QY,Fq=new QY,Lq=new si,Uq=new $Y,kq=new $Y;function Nq(t,e,n,i){iq.setBuffer(t._roots[e]);const r=zq(0,t,n,i);return iq.clearBuffer(),r}function zq(t,e,n,i,r=null){const{float32Array:s,uint16Array:a,uint32Array:o}=iq;let l=2*t;null===r&&(n.boundingBox||n.computeBoundingBox(),Uq.set(n.boundingBox.min,n.boundingBox.max,i),r=Uq);if(!RY(l,a)){const a=t+8,l=o[t+6];vY(a,s,Dq);if(r.intersectsBox(Dq)&&zq(a,e,n,i,r))return!0;vY(l,s,Dq);return!!(r.intersectsBox(Dq)&&zq(l,e,n,i,r))}{const r=e.geometry,h=r.index,c=r.attributes.position,u=n.index,d=n.attributes.position,p=IY(t,o),f=OY(l,a);if(Lq.copy(i).invert(),n.boundsTree){vY(t,s,kq),kq.matrix.copy(Lq),kq.needsUpdate=!0;return n.boundsTree.shapecast({intersectsBounds:t=>kq.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let e=3*p,n=3*(f+p);e<n;e+=3)if(wq(Fq,e,h,c),Fq.needsUpdate=!0,t.intersectsTriangle(Fq))return!0;return!1}})}for(let t=3*p,e=3*(f+p);t<e;t+=3){wq(Bq,t,h,c),Bq.a.applyMatrix4(Lq),Bq.b.applyMatrix4(Lq),Bq.c.applyMatrix4(Lq),Bq.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(wq(Fq,t,u,d),Fq.needsUpdate=!0,Bq.intersectsTriangle(Fq))return!0}}}const Gq=new si,Hq=new $Y,Vq=new $Y,Xq=new Pn,Wq=new Pn,jq=new Pn,Yq=new Pn;function qq(t,e,n,i={},r={},s=0,a=1/0){e.boundingBox||e.computeBoundingBox(),Hq.set(e.boundingBox.min,e.boundingBox.max,n),Hq.needsUpdate=!0;const o=t.geometry,l=o.attributes.position,h=o.index,c=e.attributes.position,u=e.index,d=nq.getPrimitive(),p=nq.getPrimitive();let f=Xq,m=Wq,g=null,v=null;r&&(g=jq,v=Yq);let y=1/0,x=null,b=null;return Gq.copy(n).invert(),Vq.matrix.copy(Gq),t.shapecast({boundsTraverseOrder:t=>Hq.distanceToBox(t),intersectsBounds:(t,e,n)=>n<y&&n<a&&(e&&(Vq.min.copy(t.min),Vq.max.copy(t.max),Vq.needsUpdate=!0),!0),intersectsRange:(t,i)=>{if(e.boundsTree){return e.boundsTree.shapecast({boundsTraverseOrder:t=>Vq.distanceToBox(t),intersectsBounds:(t,e,n)=>n<y&&n<a,intersectsRange:(e,r)=>{for(let a=e,o=e+r;a<o;a++){wq(p,3*a,u,c),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=t,n=t+i;e<n;e++){wq(d,3*e,h,l),d.needsUpdate=!0;const t=d.distanceToTriangle(p,f,g);if(t<y&&(m.copy(f),v&&v.copy(g),y=t,x=e,b=a),t<s)return!0}}}})}for(let r=0,a=dY(e);r<a;r++){wq(p,3*r,u,c),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=t,n=t+i;e<n;e++){wq(d,3*e,h,l),d.needsUpdate=!0;const t=d.distanceToTriangle(p,f,g);if(t<y&&(m.copy(f),v&&v.copy(g),y=t,x=e,b=r),t<s)return!0}}}}),nq.releasePrimitive(d),nq.releasePrimitive(p),y===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=y,i.faceIndex=x,r&&(r.point?r.point.copy(v):r.point=v.clone(),r.point.applyMatrix4(Gq),m.applyMatrix4(Gq),r.distance=m.sub(r.point).length(),r.faceIndex=b),i)}function Kq(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const n=t.geometry,i=n.index?n.index.array:null,r=n.attributes.position;let s,a,o,l,h=0;const c=t._roots;for(let d=0,p=c.length;d<p;d++)s=c[d],a=new Uint32Array(s),o=new Uint16Array(s),l=new Float32Array(s),u(0,h),h+=s.byteLength;function u(n,s,h=!1){const c=2*n;if(o[c+15]===hY){const e=a[n+6];let s=1/0,h=1/0,u=1/0,d=-1/0,p=-1/0,f=-1/0;for(let n=e,a=e+o[c+14];n<a;n++){const e=3*t.resolveTriangleIndex(n);for(let t=0;t<3;t++){let n=e+t;n=i?i[n]:n;const a=r.getX(n),o=r.getY(n),l=r.getZ(n);a<s&&(s=a),a>d&&(d=a),o<h&&(h=o),o>p&&(p=o),l<u&&(u=l),l>f&&(f=l)}}return(l[n+0]!==s||l[n+1]!==h||l[n+2]!==u||l[n+3]!==d||l[n+4]!==p||l[n+5]!==f)&&(l[n+0]=s,l[n+1]=h,l[n+2]=u,l[n+3]=d,l[n+4]=p,l[n+5]=f,!0)}{const t=n+8,i=a[n+6],r=t+s,o=i+s;let c=h,d=!1,p=!1;e?c||(d=e.has(r),p=e.has(o),c=!d&&!p):(d=!0,p=!0);const f=c||p;let m=!1;(c||d)&&(m=u(t,s,c));let g=!1;f&&(g=u(i,s,c));const v=m||g;if(v)for(let e=0;e<3;e++){const r=t+e,s=i+e,a=l[r],o=l[r+3],h=l[s],c=l[s+3];l[n+e]=a<h?a:h,l[n+e+3]=o>c?o:c}return v}}}function Jq(t,e,n,i,r){iq.setBuffer(t._roots[e]),Zq(0,t,n,i,r),iq.clearBuffer()}function Zq(t,e,n,i,r){const{float32Array:s,uint16Array:a,uint32Array:o}=iq,l=2*t;if(RY(l,a)){!function(t,e,n,i,r,s){const{geometry:a,_indirectBuffer:o}=t;for(let l=i,h=i+r;l<h;l++)Sq(a,e,n,o?o[l]:l,s)}(e,n,i,IY(t,o),OY(l,a),r)}else{const a=DY(t);Aq(a,s,i)&&Zq(a,e,n,i,r);const l=BY(t,o);Aq(l,s,i)&&Zq(l,e,n,i,r)}}const Qq=["x","y","z"];function $q(t,e,n,i){iq.setBuffer(t._roots[e]);const r=tK(0,t,n,i);return iq.clearBuffer(),r}function tK(t,e,n,i){const{float32Array:r,uint16Array:s,uint32Array:a}=iq;let o=2*t;if(RY(o,s)){return function(t,e,n,i,r){const{geometry:s,_indirectBuffer:a}=t;let o=1/0,l=null;for(let h=i,c=i+r;h<c;h++){let t;t=Sq(s,e,n,a?a[h]:h),t&&t.distance<o&&(l=t,o=t.distance)}return l}(e,n,i,IY(t,a),OY(o,s))}{const s=FY(t,a),o=Qq[s],l=i.direction[o]>=0;let h,c;l?(h=DY(t),c=BY(t,a)):(h=BY(t,a),c=DY(t));const u=Aq(h,r,i)?tK(h,e,n,i):null;if(u){const t=u.point[o];if(l?t<=r[c+s]:t>=r[c+s+3])return u}const d=Aq(c,r,i)?tK(c,e,n,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const eK=new On,nK=new QY,iK=new QY,rK=new si,sK=new $Y,aK=new $Y;function oK(t,e,n,i){iq.setBuffer(t._roots[e]);const r=lK(0,t,n,i);return iq.clearBuffer(),r}function lK(t,e,n,i,r=null){const{float32Array:s,uint16Array:a,uint32Array:o}=iq;let l=2*t;null===r&&(n.boundingBox||n.computeBoundingBox(),sK.set(n.boundingBox.min,n.boundingBox.max,i),r=sK);if(!RY(l,a)){const a=t+8,l=o[t+6];vY(a,s,eK);if(r.intersectsBox(eK)&&lK(a,e,n,i,r))return!0;vY(l,s,eK);return!!(r.intersectsBox(eK)&&lK(l,e,n,i,r))}{const r=e.geometry,h=r.index,c=r.attributes.position,u=n.index,d=n.attributes.position,p=IY(t,o),f=OY(l,a);if(rK.copy(i).invert(),n.boundsTree){vY(t,s,aK),aK.matrix.copy(rK),aK.needsUpdate=!0;return n.boundsTree.shapecast({intersectsBounds:t=>aK.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let n=p,i=f+p;n<i;n++)if(wq(iK,3*e.resolveTriangleIndex(n),h,c),iK.needsUpdate=!0,t.intersectsTriangle(iK))return!0;return!1}})}for(let t=p,n=f+p;t<n;t++){const n=e.resolveTriangleIndex(t);wq(nK,3*n,h,c),nK.a.applyMatrix4(rK),nK.b.applyMatrix4(rK),nK.c.applyMatrix4(rK),nK.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(wq(iK,t,u,d),iK.needsUpdate=!0,nK.intersectsTriangle(iK))return!0}}}const hK=new si,cK=new $Y,uK=new $Y,dK=new Pn,pK=new Pn,fK=new Pn,mK=new Pn;function gK(t,e,n,i={},r={},s=0,a=1/0){e.boundingBox||e.computeBoundingBox(),cK.set(e.boundingBox.min,e.boundingBox.max,n),cK.needsUpdate=!0;const o=t.geometry,l=o.attributes.position,h=o.index,c=e.attributes.position,u=e.index,d=nq.getPrimitive(),p=nq.getPrimitive();let f=dK,m=pK,g=null,v=null;r&&(g=fK,v=mK);let y=1/0,x=null,b=null;return hK.copy(n).invert(),uK.matrix.copy(hK),t.shapecast({boundsTraverseOrder:t=>cK.distanceToBox(t),intersectsBounds:(t,e,n)=>n<y&&n<a&&(e&&(uK.min.copy(t.min),uK.max.copy(t.max),uK.needsUpdate=!0),!0),intersectsRange:(i,r)=>{if(e.boundsTree){const o=e.boundsTree;return o.shapecast({boundsTraverseOrder:t=>uK.distanceToBox(t),intersectsBounds:(t,e,n)=>n<y&&n<a,intersectsRange:(e,a)=>{for(let _=e,S=e+a;_<S;_++){const e=o.resolveTriangleIndex(_);wq(p,3*e,u,c),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let n=i,a=i+r;n<a;n++){const e=t.resolveTriangleIndex(n);wq(d,3*e,h,l),d.needsUpdate=!0;const i=d.distanceToTriangle(p,f,g);if(i<y&&(m.copy(f),v&&v.copy(g),y=i,x=n,b=_),i<s)return!0}}}})}for(let a=0,o=dY(e);a<o;a++){wq(p,3*a,u,c),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=i,n=i+r;e<n;e++){const n=t.resolveTriangleIndex(e);wq(d,3*n,h,l),d.needsUpdate=!0;const i=d.distanceToTriangle(p,f,g);if(i<y&&(m.copy(f),v&&v.copy(g),y=i,x=e,b=a),i<s)return!0}}}}),nq.releasePrimitive(d),nq.releasePrimitive(p),y===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=y,i.faceIndex=x,r&&(r.point?r.point.copy(v):r.point=v.clone(),r.point.applyMatrix4(hK),m.applyMatrix4(hK),r.distance=m.sub(r.point).length(),r.faceIndex=b),i)}const vK=new iq.constructor,yK=new iq.constructor,xK=new tq(()=>new On),bK=new On,_K=new On,SK=new On,wK=new On;let TK=!1;function MK(t,e,n,i,r,s=0,a=0,o=0,l=0,h=null,c=!1){let u,d;c?(u=yK,d=vK):(u=vK,d=yK);const p=u.float32Array,f=u.uint32Array,m=u.uint16Array,g=d.float32Array,v=d.uint32Array,y=d.uint16Array,x=2*e,b=RY(2*t,m),_=RY(x,y);let S=!1;if(_&&b)S=c?r(IY(e,v),OY(2*e,y),IY(t,f),OY(2*t,m),l,a+e,o,s+t):r(IY(t,f),OY(2*t,m),IY(e,v),OY(2*e,y),o,s+t,l,a+e);else if(_){const h=xK.getPrimitive();vY(e,g,h),h.applyMatrix4(n);const u=DY(t),d=BY(t,f);vY(u,p,bK),vY(d,p,_K);const m=h.intersectsBox(bK),v=h.intersectsBox(_K);S=m&&MK(e,u,i,n,r,a,s,l,o+1,h,!c)||v&&MK(e,d,i,n,r,a,s,l,o+1,h,!c),xK.releasePrimitive(h)}else{const u=DY(e),d=BY(e,v);vY(u,g,SK),vY(d,g,wK);const m=h.intersectsBox(SK),y=h.intersectsBox(wK);if(m&&y)S=MK(t,u,n,i,r,s,a,o,l+1,h,c)||MK(t,d,n,i,r,s,a,o,l+1,h,c);else if(m)if(b)S=MK(t,u,n,i,r,s,a,o,l+1,h,c);else{const e=xK.getPrimitive();e.copy(SK).applyMatrix4(n);const h=DY(t),d=BY(t,f);vY(h,p,bK),vY(d,p,_K);const m=e.intersectsBox(bK),g=e.intersectsBox(_K);S=m&&MK(u,h,i,n,r,a,s,l,o+1,e,!c)||g&&MK(u,d,i,n,r,a,s,l,o+1,e,!c),xK.releasePrimitive(e)}else if(y)if(b)S=MK(t,d,n,i,r,s,a,o,l+1,h,c);else{const e=xK.getPrimitive();e.copy(wK).applyMatrix4(n);const h=DY(t),u=BY(t,f);vY(h,p,bK),vY(u,p,_K);const m=e.intersectsBox(bK),g=e.intersectsBox(_K);S=m&&MK(d,h,i,n,r,a,s,l,o+1,e,!c)||g&&MK(d,u,i,n,r,a,s,l,o+1,e,!c),xK.releasePrimitive(e)}}return S}const AK=new $Y,EK=new On,CK={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class PK{static serialize(t,e={}){e={cloneBuffers:!0,...e};const n=t.geometry,i=t._roots,r=t._indirectBuffer,s=n.getIndex();let a;return a=e.cloneBuffers?{roots:i.map(t=>t.slice()),index:s?s.array.slice():null,indirectBuffer:r?r.slice():null}:{roots:i,index:s?s.array:null,indirectBuffer:r},a}static deserialize(t,e,n={}){n={setIndex:!0,indirect:Boolean(t.indirectBuffer),...n};const{index:i,roots:r,indirectBuffer:s}=t,a=new PK(e,{...n,[uY]:!0});if(a._roots=r,a._indirectBuffer=s||null,n.setIndex){const n=e.getIndex();if(null===n){const n=new ar(t.index,1,!1);e.setIndex(n)}else n.array!==i&&(n.array.set(i),n.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({...CK,[uY]:!1},e)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[uY]||(jY(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new On)));const{_indirectBuffer:n}=this;this.resolveTriangleIndex=e.indirect?t=>n[t]:t=>t}refit(t=null){return(this.indirect?Kq:Mq)(this,t)}traverse(t,e=0){const n=this._roots[e],i=new Uint32Array(n),r=new Uint16Array(n);!function e(s,a=0){const o=2*s,l=r[o+15]===hY;if(l){const e=i[s+6],h=r[o+14];t(a,l,new Float32Array(n,4*s,6),e,h)}else{const r=s+8,o=i[s+6],h=i[s+7];t(a,l,new Float32Array(n,4*s,6),h)||(e(r,a+1),e(o,a+1))}}(0)}raycast(t,e=0){const n=this._roots,i=this.geometry,r=[],s=e.isMaterial,a=Array.isArray(e),o=i.groups,l=s?e.side:e,h=this.indirect?Jq:Cq;for(let c=0,u=n.length;c<u;c++){const n=a?e[o[c].materialIndex].side:l,i=r.length;if(h(this,c,n,t,r),a){const t=o[c].materialIndex;for(let e=i,n=r.length;e<n;e++)r[e].face.materialIndex=t}}return r}raycastFirst(t,e=0){const n=this._roots,i=this.geometry,r=e.isMaterial,s=Array.isArray(e);let a=null;const o=i.groups,l=r?e.side:e,h=this.indirect?$q:Iq;for(let c=0,u=n.length;c<u;c++){const n=h(this,c,s?e[o[c].materialIndex].side:l,t);null!=n&&(null==a||n.distance<a.distance)&&(a=n,s&&(n.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(t,e){let n=!1;const i=this._roots,r=this.indirect?oK:Nq;for(let s=0,a=i.length;s<a&&(n=r(this,s,t,e),!n);s++);return n}shapecast(t){const e=nq.getPrimitive(),n=this.indirect?Eq:Tq;let{boundsTraverseOrder:i,intersectsBounds:r,intersectsRange:s,intersectsTriangle:a}=t;if(s&&a){const t=s;s=(i,r,s,o,l)=>!!t(i,r,s,o,l)||n(i,r,this,a,s,o,e)}else s||(s=a?(t,i,r,s)=>n(t,i,this,a,r,s,e):(t,e,n)=>n);let o=!1,l=0;const h=this._roots;for(let c=0,u=h.length;c<u;c++){const t=h[c];if(o=lq(this,c,r,s,i,l),o)break;l+=t.byteLength}return nq.releasePrimitive(e),o}bvhcast(t,e,n){let{intersectsRanges:i,intersectsTriangles:r}=n;const s=nq.getPrimitive(),a=this.geometry.index,o=this.geometry.attributes.position,l=this.indirect?t=>{const e=this.resolveTriangleIndex(t);wq(s,3*e,a,o)}:t=>{wq(s,3*t,a,o)},h=nq.getPrimitive(),c=t.geometry.index,u=t.geometry.attributes.position,d=t.indirect?e=>{const n=t.resolveTriangleIndex(e);wq(h,3*n,c,u)}:t=>{wq(h,3*t,c,u)};if(r){const t=(t,n,i,a,o,c,u,p)=>{for(let f=i,m=i+a;f<m;f++){d(f),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let e=t,i=t+n;e<i;e++)if(l(e),s.needsUpdate=!0,r(s,h,e,f,o,c,u,p))return!0}return!1};if(i){const e=i;i=function(n,i,r,s,a,o,l,h){return!!e(n,i,r,s,a,o,l,h)||t(n,i,r,s,a,o,l,h)}}else i=t}return function(t,e,n,i){if(TK)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");TK=!0;const r=t._roots,s=e._roots;let a,o=0,l=0;const h=(new si).copy(n).invert();for(let c=0,u=r.length;c<u;c++){vK.setBuffer(r[c]),l=0;const t=xK.getPrimitive();vY(LY(0),vK.float32Array,t),t.applyMatrix4(h);for(let e=0,r=s.length;e<r&&(yK.setBuffer(s[c]),a=MK(0,0,n,h,i,o,l,0,0,t),yK.clearBuffer(),l+=s[e].length,!a);e++);if(xK.releasePrimitive(t),vK.clearBuffer(),o+=r[c].length,a)break}return TK=!1,a}(this,t,e,i)}intersectsBox(t,e){return AK.set(t.min,t.max,e),AK.needsUpdate=!0,this.shapecast({intersectsBounds:t=>AK.intersectsBox(t),intersectsTriangle:t=>AK.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,n={},i={},r=0,s=1/0){return(this.indirect?gK:qq)(this,t,e,n,i,r,s)}closestPointToPoint(t,e={},n=0,i=1/0){return function(t,e,n={},i=0,r=1/0){const s=i*i,a=r*r;let o=1/0,l=null;if(t.shapecast({boundsTraverseOrder:t=>(cq.copy(e).clamp(t.min,t.max),cq.distanceToSquared(e)),intersectsBounds:(t,e,n)=>n<o&&n<a,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,cq);const i=e.distanceToSquared(cq);return i<o&&(uq.copy(cq),o=i,l=n),i<s}}),o===1/0)return null;const h=Math.sqrt(o);return n.point?n.point.copy(uq):n.point=uq.clone(),n.distance=h,n.faceIndex=l,n}(this,t,e,n,i)}getBoundingBox(t){t.makeEmpty();return this._roots.forEach(e=>{vY(0,new Float32Array(e),EK),t.union(EK)}),t}}function RK(t,e,n){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(n.ray.origin),t.object=e,t.distance<n.near||t.distance>n.far?null:t)}const IK=new ri,OK=new si,DK=Fr.prototype.raycast;function BK(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;OK.copy(this.matrixWorld).invert(),IK.copy(t.ray).applyMatrix4(OK);const n=this.geometry.boundsTree;if(!0===t.firstHitOnly){const i=RK(n.raycastFirst(IK,this.material),this,t);i&&e.push(i)}else{const i=n.raycast(IK,this.material);for(let n=0,r=i.length;n<r;n++){const r=RK(i[n],this,t);r&&e.push(r)}}}else DK.call(this,t,e)}function FK(t){return this.boundsTree=new PK(this,t),this.boundsTree}function LK(){this.boundsTree=null}const UK={};class kK{static init(){this.initParticles()}static initParticles(){}static attachTo(t,e,{offset:n={x:0,y:0,z:0},scale:i=1,force:r=0}={}){const s=this.getParticle(t);if(!s)return;const a=s.particle;a.position.set(0,0,0),a.scale.setScalar(1),a.rotation.set(0,0,0);let o=i;return a.multiplyParticleScale(o),r&&a.changeForce(r),e.add(a),n&&a.position.copy(n),a.restart(),a}static spawnAt(t,e,n=.5,i){const r=this.getParticle(t);if(!r)return;const s=r.particle;return s.multiplyParticleScale(n),s.position.copy(e),s.restart(),i||(i=e6.threeScene),s.addToScene(i),s}static stop(t,e){t.pool[e].stop()}static getParticle(t){return cy.getQuarks(t)}}n(kK,"list",{}),Lu.prototype.load=class extends Du{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ru.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;if(void 0!==UK[t])return void UK[t].push({onLoad:e,onProgress:n,onError:i});const a=t.match(/^data:(.*?)(;base64)?,(.*)$/);let o;if(a){const n=a[1],s=!!a[2];let o=a[3];o=decodeURIComponent(o),s&&(o=atob(o));try{let i;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(o.length);for(let n=0;n<o.length;n++)t[n]=o.charCodeAt(n);i="blob"===s?new Blob([t.buffer],{type:n}):t.buffer;break;case"document":const e=new DOMParser;i=e.parseFromString(o,n);break;case"json":i=JSON.parse(o);break;default:i=o}setTimeout(function(){e&&e(i),r.manager.itemEnd(t)},0)}catch(l){setTimeout(function(){i&&i(l),r.manager.itemError(t),r.manager.itemEnd(t)},0)}}else{UK[t]=[],UK[t].push({onLoad:e,onProgress:n,onError:i}),o=new Object,o.open("GET",t,!0),o.addEventListener("load",function(e){const n=this.response,i=UK[t];if(delete UK[t],200===this.status||0===this.status){this.status,Ru.add(t,n);for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onLoad&&e.onLoad(n)}r.manager.itemEnd(t)}else{for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}},!1),o.addEventListener("progress",function(e){const n=UK[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onProgress&&i.onProgress(e)}},!1),o.addEventListener("error",function(e){const n=UK[t];delete UK[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),o.addEventListener("abort",function(e){const n=UK[t];delete UK[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)o.setRequestHeader(t,this.requestHeader[t]);o.send(null)}return r.manager.itemStart(t),o}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}.prototype.load;class NK{constructor(t){n(this,"renderer"),n(this,"responsive"),n(this,"inited",!1),n(this,"timer",new Qj),n(this,"scriptSystem"),n(this,"sceneHelper"),n(this,"orbitControls"),n(this,"controls",{isDown:!1,downX:0,downY:0,mouseX:0,mouseY:0,prevX:0,prevY:0}),n(this,"timeAccumulator",0),n(this,"totalElapsed",0),n(this,"fixedTimeStep",1/60),this.sceneHelper=WK,this.renderer=t;const e={maxDimension:1e3,resolution:gv.getRendererConfig().resolution};this.scriptSystem=new Yj(WK,BN),Yj.script3d=this.scriptSystem,this.responsive=new Zj(e,t)}onAllReady(){if(vr.prototype.computeBoundsTree=FK,vr.prototype.disposeBoundsTree=LK,Fr.prototype.raycast=BK,e6.data.editableBg){const t=["solid","gradient","image"];gv.getScenes().forEach(e=>{e.settings.backgroundType=t[e6.data.backgroundType],e.settings.backgroundColor1=e6.data.backgroundType?e6.data.bgGradientTop:e6.data.backgroundColor,e.settings.backgroundColor2=e6.data.bgGradientBottom,e.settings.backgroundImage="bg3d"})}$v.initFromTemplate(gv.getMaterials()),WK.init(),kK.init(),this.initOrbitControls(),this.initGlobalControls();RN.setPhysicsType("none"),setTimeout(()=>{RN.setScene(WK.currentScene),RN.setDebugEnabled(e6.showPhyiscsDebug)},100)}physicsUpdate(t){RN.step(t)}onBeforeUpdate(){this.inited=!0}update(t){this.inited&&(this.physicsUpdate(t),WK.sceneList.forEach(e=>{e.update(t)}),this.orbitControls&&this.orbitControls.update())}fixedUpdate(t){if(this.inited)for(this.timeAccumulator+=t,this.totalElapsed+=t;this.timeAccumulator>=this.fixedTimeStep;)this.update(this.fixedTimeStep),this.timeAccumulator-=this.fixedTimeStep}render(){this.inited&&WK.sceneList.forEach(t=>{t.render(this.renderer)})}resize(t,e){const n=this.responsive.resize(t,e);e6.threeWidth=n.width,e6.threeHeight=n.height,WK.sceneList.forEach(t=>{t.resize(n.width,n.height)}),e6.game.resize3D(n.width,n.height)}initOrbitControls(){const t=()=>{const t=WK.currentScene.mainCamera;if(!t)return;this.orbitControls&&this.orbitControls.dispose();const e=new oY(t,document.body);e.enableDamping=!0,e.dampingFactor=.25,e.enableZoom=!0,e.enablePan=!0,e.screenSpacePanning=!1,e.minDistance=1,e.maxDistance=1e3,e.panSpeed=1,e.update(),this.orbitControls=e};window.onkeydown=e=>{var n,i;"a"!==e.key||this.orbitControls||(t(),null==(n=this.orbitControls)||n.listenToKeyEvents(window)),"s"===e.key&&(null==(i=this.orbitControls)||i.dispose(),this.orbitControls=void 0),"Shift"===e.key&&this.orbitControls&&(this.orbitControls.touches={ONE:E.PAN})},window.onkeyup=t=>{this.orbitControls&&"Shift"===t.key&&(this.orbitControls.touches={ONE:E.ROTATE})}}initGlobalControls(){let t={isDown:!1,downX:0,downY:0,mouseX:0,mouseY:0,prevX:0,prevY:0};const e=document.body;function n(e){t.prevX=t.mouseX,t.prevY=t.mouseY,t.mouseX=e.pageX,t.mouseY=e.pageY}function i(r){t.isDown=!1,e.removeEventListener("mouseup",i),e.removeEventListener("mousemove",n)}function r(e){t.prevX=t.mouseX,t.prevY=t.mouseY,t.mouseX=e.touches[0].pageX,t.mouseY=e.touches[0].pageY}function s(n){t.isDown=!1,e.removeEventListener("touchend",s),e.removeEventListener("touchmove",r)}return e.addEventListener("mousedown",function(r){t.downX=r.pageX,t.downY=r.pageY,t.mouseX=r.pageX,t.mouseY=r.pageY,t.prevX=r.pageX,t.prevY=r.pageY,t.isDown=!0,e.addEventListener("mouseup",i),e.addEventListener("mousemove",n)}),e.addEventListener("touchstart",function(n){t.downX=n.touches[0].pageX,t.downY=n.touches[0].pageY,t.mouseX=n.touches[0].pageX,t.mouseY=n.touches[0].pageY,t.prevX=n.touches[0].pageX,t.prevY=n.touches[0].pageY,t.isDown=!0,e.addEventListener("touchend",s),e.addEventListener("touchmove",r)}),this.controls=t,e6.controls=t,t}}let zK,GK="waiting";async function HK(t=[],e){var n;await async function(){return new Promise((t,e)=>{!function e(){Jj()?t(!0):setTimeout(e,100)}()})}();const i=Object.assign({antialias:!1,alpha:!1,powerPreference:"high-performance"},gv.getRendererConfig());i.logarithmicDepthBuffer=!1,e6.data.postprocessData.enable&&(i.antialias=!1,i.toneMapping="NoToneMapping"),(null==(n=null==window?void 0:window.editorMeta)?void 0:n.isEditing)&&(i.preserveDrawingBuffer=!0,window.pfTakeSnapshotThree=()=>r.domElement.toDataURL("image/jpeg",.7));const r=new jo(i);return r.outputColorSpace=_p[i.outputColorSpace],r.shadowMap.enabled=i.shadowMapEnabled,r.shadowMap.type=_p[i.shadowMapType],r.toneMapping=_p[i.toneMapping],r.toneMappingExposure=i.toneMappingExposure,document.body.appendChild(r.domElement),GK="loading",zK=new NK(r),GK="ready",e&&e(zK.renderer),await async function(t=[]){gv.addStuffsAssets(),gv.addOptionalAssets();const e=gv.getAssetsToLoad().concat(t),n=await cy.load(e);gv.setLoadedAssets(n),GK="ready"}(t),zK}function VK(t,e){if("ready"!==GK)return;t&&e||(t=e6.threeWidth,e=e6.threeHeight);const n=e6.projectConfig.generalSettings.lockScreen;let i=t,r=e;"landscape"===n?t<e&&(i=e,r=t):"portrait"===n&&t>e&&(i=e,r=t),zK.resize(i,r)}const XK=class t{static init(){}static initPersistentScene(){this.persistentScene=this.initScene({name:"persistentScene",id:"persistentScene",persistent:!0,root:{children:[]}},!1,!1),this.persistentScene.persistent=!0}static initSceneByIndex(t,e=!0,n=!1){const i=gv.getSceneDataByIndex(t);this.currentScene=this.initScene(i,e,n)}static initSceneByName(t,e=!0,n=!1){const i=gv.getSceneDataByName(t);this.currentScene=this.initScene(i,e,n)}static initScene(t,e=!0,n=!1){e&&this.removeActiveScenes();const i=t.persistent,r=new Fj(i);return r.name=t.name,r.sID=t.id,BN.objectByScene.set(r,[]),this.currentScene=r,t.root.children.forEach(t=>{this.addObjects(t,r,r)}),t.root.children.forEach(t=>{BN.getObjectById(t.id).updateComponents(t.components)}),this.sceneList.set(r.sID,r),r.onSceneInited(t.settings),VK(),this.persistentScene&&(this.sceneList.delete(this.persistentScene.sID),this.sceneList.set(this.persistentScene.sID,this.persistentScene)),(this.sceneList.size>2||n)&&(Yj.script3d.awakeAll(r),Yj.script3d.initAll(r)),r}static getSceneByName(t){for(const e of this.sceneList.values())if(e.name===t)return e;return null}static removeScene(t){t.destroy()}static removeSceneByName(t){const e=this.getSceneByName(t);e&&this.removeScene(e)}static removeActiveScenes(){[...this.sceneList.keys()].forEach(t=>{const e=this.sceneList.get(t);e&&e!==this.persistentScene&&this.removeScene(e)}),this.sceneList.clear()}static buildInlineModelCacheMap(t,e=null,n=new Map){var i,r;let s=e;if(t.type===aN.INLINE_MODEL){const e=(null==(i=t.components.inlineModel)?void 0:i.modelUUID)??"";s=cy.getModel(e),n.set(t.id,s)}else if(t.type===aN.MESH&&(null==(r=t.components.mesh)?void 0:r.parentUUID)){const e=cy.getModel(t.components.mesh.parentUUID);n.set(t.id,e)}else n.set(t.id,s);for(const a of t.children??[])this.buildInlineModelCacheMap(a,s,n);return n}static addObjects(e,n,i){const r=t.buildInlineModelCacheMap(e);return t.addGameObject(e,n,i,r)}static addGameObject(t,e,n,i){let r;if(i){const e=i.get(t.id);r=ON.add(t,e)}else r=ON.add(t);if(r){if(r.sID=t.id,r.name=t.name,e.add(r),r.updateComponents(t.components),t.components.scripts){r.components.add("scripts");const e=t.components.scripts.scripts,n=Object.values(e);n.sort((t,e)=>t.order-e.order);for(const t of n)Yj.script3d.createEntityFromData(r,t)}return t.type===aN.QUARKS_PARTICLE&&n.quarksScene&&n.quarksScene.add(r),BN.addObject(r,n),t.children&&t.children.forEach(t=>{this.addGameObject(t,r,n,i)}),r}}static addPersistentGameObject(t){BN.addObject(t,this.persistentScene),this.persistentScene.add(t)}};n(XK,"list",{}),n(XK,"currentScene"),n(XK,"sceneList",new Map),n(XK,"persistentScene");const WK=XK,jK=class t{static init(e,n){t.renderer2d=e,t.renderer3d=n}static restartScene(){this.renderer3d&&this.goToScene(this.renderer3d.sceneHelper.currentScene.name)}static goToScene(e,n=0){window.app.cannonPhysics&&window.app.cannonPhysics.clear(),window.app.rapierPhysics&&window.app.rapierPhysics.clear(),QW.globalTimeline.getChildren(!0,!0,!0).forEach(t=>{t.kill()}),QW.globalTimeline.clear(!0),e6.eventEmitter.removeAllListeners(),"number"==typeof e?this.renderer3d.sceneHelper.initSceneByIndex(e):this.renderer3d.sceneHelper.initSceneByName(e),this.renderer2d.sceneHelper.initSceneByIndex(n),window.app.resizeNow(),t.start()}static start(){this.renderer3d.scriptSystem.awakeAll(),this.renderer2d.scriptSystem.awakeAll(),this.renderer3d.scriptSystem.initAll(),this.renderer2d.scriptSystem.initAll(),this.renderer3d.onBeforeUpdate(),this.renderer2d.onBeforeUpdate()}};n(jK,"renderer3d"),n(jK,"renderer2d");let YK=jK;const qK=function(){return zK},KK=function(){var t;return null==(t=WK.currentScene)?void 0:t.mainCamera},JK=function(t,e=!1){return WK.initSceneByIndex(t,e,!0)},ZK=function(){return WK.currentScene};if(new Fb,"undefined"!=typeof window&&window.PIXI){const t=window.require;window.require=e=>t?t(e):e.startsWith("@pixi/")||e.startsWith("pixi.js")?window.PIXI:void 0}class QK{constructor(){n(this,"entries",{}),n(this,"size",0)}add(t){let e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){let e=this.size;for(var n=0,i=t.length;n<i;n++)this.add(t[n]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}const $K=class t{constructor(t=0,e=0,i=0,r=0){n(this,"r"),n(this,"g"),n(this,"b"),n(this,"a"),this.r=t,this.g=e,this.b=i,this.a=r}set(t,e,n,i){return this.r=t,this.g=e,this.b=n,this.a=i,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,n,i){return this.r+=t,this.g+=e,this.b+=n,this.a+=i,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}toRgb888(){const t=t=>("0"+(255*t).toString(16)).slice(-2);return Number("0x"+t(this.r)+t(this.g)+t(this.b))}static fromString(e){return(new t).setFromString(e)}};n($K,"WHITE",new $K(1,1,1,1)),n($K,"RED",new $K(1,0,0,1)),n($K,"GREEN",new $K(0,1,0,1)),n($K,"BLUE",new $K(0,0,1,1)),n($K,"MAGENTA",new $K(1,0,1,1));let tJ=$K;const eJ=class t{static clamp(t,e,n){return t<e?e:t>n?n:t}static cosDeg(e){return Math.cos(e*t.degRad)}static sinDeg(e){return Math.sin(e*t.degRad)}static atan2Deg(e,n){return Math.atan2(e,n)*t.degRad}static signum(t){return t>0?1:t<0?-1:0}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){let e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(e,n){return t.randomTriangularWith(e,n,.5*(e+n))}static randomTriangularWith(t,e,n){let i=Math.random(),r=e-t;return i<=(n-t)/r?t+Math.sqrt(i*r*(n-t)):e-Math.sqrt((1-i)*r*(e-n))}static isPowerOfTwo(t){return t&&!(t&t-1)}};n(eJ,"PI",3.1415927),n(eJ,"PI2",2*eJ.PI),n(eJ,"invPI2",1/eJ.PI2),n(eJ,"radiansToDegrees",180/eJ.PI),n(eJ,"radDeg",eJ.radiansToDegrees),n(eJ,"degreesToRadians",eJ.PI/180),n(eJ,"degRad",eJ.degreesToRadians);let nJ=eJ;const iJ=class t{static arrayCopy(t,e,n,i,r){for(let s=e,a=i;s<e+r;s++,a++)n[a]=t[s]}static arrayFill(t,e,n,i){for(let r=e;r<n;r++)t[r]=i}static setArraySize(t,e,n=0){let i=t.length;if(i==e)return t;if(t.length=e,i<e)for(let r=i;r<e;r++)t[r]=n;return t}static ensureArrayCapacity(e,n,i=0){return e.length>=n?e:t.setArraySize(e,n,i)}static newArray(t,e){let n=new Array(t);for(let i=0;i<t;i++)n[i]=e;return n}static newFloatArray(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);{let t=new Array(e);for(let e=0;e<t.length;e++)t[e]=0;return t}}static newShortArray(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);{let t=new Array(e);for(let e=0;e<t.length;e++)t[e]=0;return t}}static toFloatArray(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e}static toSinglePrecision(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e}static webkit602BugfixHelper(t,e){}static contains(t,e,n=!0){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}};n(iJ,"SUPPORTS_TYPED_ARRAYS","undefined"!=typeof Float32Array);let rJ=iJ;class sJ{constructor(t){n(this,"items",new Array),n(this,"instantiator"),this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class aJ{constructor(t=0,e=0){n(this,"x"),n(this,"y"),this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){let t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){let t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class oJ{constructor(t){if(n(this,"name"),!t)throw new Error("name cannot be null.");this.name=t}}const lJ=class t extends oJ{constructor(e){super(e),n(this,"id",t.nextID++),n(this,"bones",null),n(this,"vertices",[]),n(this,"worldVerticesLength",0),n(this,"timelineAttachment",this)}computeWorldVertices(t,e,n,i,r,s){n=r+(n>>1)*s;let a=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(!h){o.length>0&&(l=o);let a=t.bone,h=a.worldX,c=a.worldY,u=a.a,d=a.b,p=a.c,f=a.d;for(let t=e,o=r;o<n;t+=2,o+=s){let e=l[t],n=l[t+1];i[o]=e*u+n*d+h,i[o+1]=e*p+n*f+c}return}let c=0,u=0;for(let p=0;p<e;p+=2){let t=h[c];c+=t+1,u+=t}let d=a.bones;if(0==o.length)for(let p=r,f=3*u;p<n;p+=s){let t=0,e=0,n=h[c++];for(n+=c;c<n;c++,f+=3){let n=d[h[c]],i=l[f],r=l[f+1],s=l[f+2];t+=(i*n.a+r*n.b+n.worldX)*s,e+=(i*n.c+r*n.d+n.worldY)*s}i[p]=t,i[p+1]=e}else{let t=o;for(let e=r,a=3*u,o=u<<1;e<n;e+=s){let n=0,r=0,s=h[c++];for(s+=c;c<s;c++,a+=3,o+=2){let e=d[h[c]],i=l[a]+t[o],s=l[a+1]+t[o+1],u=l[a+2];n+=(i*e.a+s*e.b+e.worldX)*u,r+=(i*e.c+s*e.d+e.worldY)*u}i[e]=n,i[e+1]=r}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),rJ.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=rJ.newFloatArray(this.vertices.length),rJ.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}};n(lJ,"nextID",0);let hJ=lJ;const cJ=class t{constructor(e){n(this,"id",t.nextID()),n(this,"regions"),n(this,"start",0),n(this,"digits",0),n(this,"setupIndex",0),this.regions=new Array(e)}copy(){let e=new t(this.regions.length);return rJ.arrayCopy(this.regions,0,e.regions,0,this.regions.length),e.start=this.start,e.digits=this.digits,e.setupIndex=this.setupIndex,e}apply(t,e){let n=t.sequenceIndex;-1==n&&(n=this.setupIndex),n>=this.regions.length&&(n=this.regions.length-1);let i=this.regions[n];e.region!=i&&(e.region=i,e.updateRegion())}getPath(t,e){let n=t,i=(this.start+e).toString();for(let r=this.digits-i.length;r>0;r--)n+="0";return n+=i,n}static nextID(){return t._nextID++}};n(cJ,"_nextID",0);let uJ=cJ;var dJ,pJ;(pJ=dJ||(dJ={}))[pJ.hold=0]="hold",pJ[pJ.once=1]="once",pJ[pJ.loop=2]="loop",pJ[pJ.pingpong=3]="pingpong",pJ[pJ.onceReverse=4]="onceReverse",pJ[pJ.loopReverse=5]="loopReverse",pJ[pJ.pingpongReverse=6]="pingpongReverse";const fJ=[dJ.hold,dJ.once,dJ.loop,dJ.pingpong,dJ.onceReverse,dJ.loopReverse,dJ.pingpongReverse];class mJ{constructor(t,e,i){if(n(this,"name"),n(this,"timelines",[]),n(this,"timelineIds",new QK),n(this,"duration"),!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=i}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(var e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,n,i,r,s,a,o){if(!t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));let l=this.timelines;for(let h=0,c=l.length;h<c;h++)l[h].apply(t,e,n,r,s,a,o)}}var gJ,vJ,yJ,xJ;(vJ=gJ||(gJ={}))[vJ.setup=0]="setup",vJ[vJ.first=1]="first",vJ[vJ.replace=2]="replace",vJ[vJ.add=3]="add",(xJ=yJ||(yJ={}))[xJ.mixIn=0]="mixIn",xJ[xJ.mixOut=1]="mixOut";const bJ={rotate:0,x:1,y:2,scaleX:3,scaleY:4,shearX:5,shearY:6,inherit:7,rgb:8,alpha:9,rgb2:10,attachment:11,deform:12,event:13,drawOrder:14,ikConstraint:15,transformConstraint:16,pathConstraintPosition:17,pathConstraintSpacing:18,pathConstraintMix:19,physicsConstraintInertia:20,physicsConstraintStrength:21,physicsConstraintDamping:22,physicsConstraintMass:23,physicsConstraintWind:24,physicsConstraintGravity:25,physicsConstraintMix:26,physicsConstraintReset:27,sequence:28};class _J{constructor(t,e){n(this,"propertyIds"),n(this,"frames"),this.propertyIds=e,this.frames=rJ.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){let n=t.length;for(let i=1;i<n;i++)if(t[i]>e)return i-1;return n-1}static search(t,e,n){let i=t.length;for(let r=n;r<i;r+=n)if(t[r]>e)return r-n;return i-n}}class SJ extends _J{constructor(t,e,i){super(t,i),n(this,"curves"),this.curves=rJ.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){let e=this.getFrameCount()+18*t;if(this.curves.length>e){let t=rJ.newFloatArray(e);rJ.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,n,i,r,s,a,o,l,h,c){let u=this.curves,d=this.getFrameCount()+18*t;0==n&&(u[e]=2+d);let p=.03*(i-2*s+o),f=.03*(r-2*a+l),m=.006*(3*(s-o)-i+h),g=.006*(3*(a-l)-r+c),v=2*p+m,y=2*f+g,x=.3*(s-i)+p+.16666667*m,b=.3*(a-r)+f+.16666667*g,_=i+x,S=r+b;for(let w=d+18;d<w;d+=2)u[d]=_,u[d+1]=S,x+=v,b+=y,v+=m,y+=g,_+=x,S+=b}getBezierValue(t,e,n,i){let r=this.curves;if(r[i]>t){let s=this.frames[e],a=this.frames[e+n];return a+(t-s)/(r[i]-s)*(r[i+1]-a)}let s=i+18;for(i+=2;i<s;i+=2)if(r[i]>=t){let e=r[i-2],n=r[i-1];return n+(t-e)/(r[i]-e)*(r[i+1]-n)}e+=this.getFrameEntries();let a=r[s-2],o=r[s-1];return o+(t-a)/(this.frames[e]-a)*(this.frames[e+n]-o)}}class wJ extends SJ{constructor(t,e,n){super(t,e,[n])}getFrameEntries(){return 2}setFrame(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+1]=n}getCurveValue(t){let e=this.frames,n=e.length-2;for(let r=2;r<=n;r+=2)if(e[r]>t){n=r-2;break}let i=this.curves[n>>1];switch(i){case 0:let i=e[n],r=e[n+1];return r+(t-i)/(e[n+2]-i)*(e[n+2+1]-r);case 1:return e[n+1]}return this.getBezierValue(t,n,1,i-2)}getRelativeValue(t,e,n,i,r){if(t<this.frames[0]){switch(n){case gJ.setup:return r;case gJ.first:return i+(r-i)*e}return i}let s=this.getCurveValue(t);switch(n){case gJ.setup:return r+s*e;case gJ.first:case gJ.replace:s+=r-i}return i+s*e}getAbsoluteValue(t,e,n,i,r){if(t<this.frames[0]){switch(n){case gJ.setup:return r;case gJ.first:return i+(r-i)*e}return i}let s=this.getCurveValue(t);return n==gJ.setup?r+(s-r)*e:i+(s-i)*e}getAbsoluteValue2(t,e,n,i,r,s){if(t<this.frames[0]){switch(n){case gJ.setup:return r;case gJ.first:return i+(r-i)*e}return i}return n==gJ.setup?r+(s-r)*e:i+(s-i)*e}getScaleValue(t,e,n,i,r,s){if(t<this.frames[0]){switch(n){case gJ.setup:return s;case gJ.first:return r+(s-r)*e}return r}let a=this.getCurveValue(t)*s;if(1==e)return n==gJ.add?r+a-s:a;if(i==yJ.mixOut)switch(n){case gJ.setup:return s+(Math.abs(a)*nJ.signum(s)-s)*e;case gJ.first:case gJ.replace:return r+(Math.abs(a)*nJ.signum(r)-r)*e}else{let t=0;switch(n){case gJ.setup:return t=Math.abs(s)*nJ.signum(a),t+(a-t)*e;case gJ.first:case gJ.replace:return t=Math.abs(r)*nJ.signum(a),t+(a-t)*e}}return r+(a-s)*e}}class TJ extends SJ{constructor(t,e,n,i){super(t,e,[n,i])}getFrameEntries(){return 3}setFrame(t,e,n,i){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i}}class MJ extends wJ{constructor(t,e,i){super(t,e,bJ.rotate+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];o.active&&(o.rotation=this.getRelativeValue(n,r,s,o.rotation,o.data.rotation))}}class AJ extends TJ{constructor(t,e,i){super(t,e,bJ.x+"|"+i,bJ.y+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];if(!o.active)return;let l=this.frames;if(n<l[0]){switch(s){case gJ.setup:return o.x=o.data.x,void(o.y=o.data.y);case gJ.first:o.x+=(o.data.x-o.x)*r,o.y+=(o.data.y-o.y)*r}return}let h=0,c=0,u=_J.search(l,n,3),d=this.curves[u/3];switch(d){case 0:let t=l[u];h=l[u+1],c=l[u+2];let e=(n-t)/(l[u+3]-t);h+=(l[u+3+1]-h)*e,c+=(l[u+3+2]-c)*e;break;case 1:h=l[u+1],c=l[u+2];break;default:h=this.getBezierValue(n,u,1,d-2),c=this.getBezierValue(n,u,2,d+18-2)}switch(s){case gJ.setup:o.x=o.data.x+h*r,o.y=o.data.y+c*r;break;case gJ.first:case gJ.replace:o.x+=(o.data.x+h-o.x)*r,o.y+=(o.data.y+c-o.y)*r;break;case gJ.add:o.x+=h*r,o.y+=c*r}}}class EJ extends wJ{constructor(t,e,i){super(t,e,bJ.x+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];o.active&&(o.x=this.getRelativeValue(n,r,s,o.x,o.data.x))}}class CJ extends wJ{constructor(t,e,i){super(t,e,bJ.y+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];o.active&&(o.y=this.getRelativeValue(n,r,s,o.y,o.data.y))}}class PJ extends TJ{constructor(t,e,i){super(t,e,bJ.scaleX+"|"+i,bJ.scaleY+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];if(!o.active)return;let l,h,c=this.frames;if(n<c[0]){switch(s){case gJ.setup:return o.scaleX=o.data.scaleX,void(o.scaleY=o.data.scaleY);case gJ.first:o.scaleX+=(o.data.scaleX-o.scaleX)*r,o.scaleY+=(o.data.scaleY-o.scaleY)*r}return}let u=_J.search(c,n,3),d=this.curves[u/3];switch(d){case 0:let t=c[u];l=c[u+1],h=c[u+2];let e=(n-t)/(c[u+3]-t);l+=(c[u+3+1]-l)*e,h+=(c[u+3+2]-h)*e;break;case 1:l=c[u+1],h=c[u+2];break;default:l=this.getBezierValue(n,u,1,d-2),h=this.getBezierValue(n,u,2,d+18-2)}if(l*=o.data.scaleX,h*=o.data.scaleY,1==r)s==gJ.add?(o.scaleX+=l-o.data.scaleX,o.scaleY+=h-o.data.scaleY):(o.scaleX=l,o.scaleY=h);else{let t=0,e=0;if(a==yJ.mixOut)switch(s){case gJ.setup:t=o.data.scaleX,e=o.data.scaleY,o.scaleX=t+(Math.abs(l)*nJ.signum(t)-t)*r,o.scaleY=e+(Math.abs(h)*nJ.signum(e)-e)*r;break;case gJ.first:case gJ.replace:t=o.scaleX,e=o.scaleY,o.scaleX=t+(Math.abs(l)*nJ.signum(t)-t)*r,o.scaleY=e+(Math.abs(h)*nJ.signum(e)-e)*r;break;case gJ.add:o.scaleX+=(l-o.data.scaleX)*r,o.scaleY+=(h-o.data.scaleY)*r}else switch(s){case gJ.setup:t=Math.abs(o.data.scaleX)*nJ.signum(l),e=Math.abs(o.data.scaleY)*nJ.signum(h),o.scaleX=t+(l-t)*r,o.scaleY=e+(h-e)*r;break;case gJ.first:case gJ.replace:t=Math.abs(o.scaleX)*nJ.signum(l),e=Math.abs(o.scaleY)*nJ.signum(h),o.scaleX=t+(l-t)*r,o.scaleY=e+(h-e)*r;break;case gJ.add:o.scaleX+=(l-o.data.scaleX)*r,o.scaleY+=(h-o.data.scaleY)*r}}}}class RJ extends wJ{constructor(t,e,i){super(t,e,bJ.scaleX+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];o.active&&(o.scaleX=this.getScaleValue(n,r,s,a,o.scaleX,o.data.scaleX))}}class IJ extends wJ{constructor(t,e,i){super(t,e,bJ.scaleY+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];o.active&&(o.scaleY=this.getScaleValue(n,r,s,a,o.scaleY,o.data.scaleY))}}class OJ extends TJ{constructor(t,e,i){super(t,e,bJ.shearX+"|"+i,bJ.shearY+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];if(!o.active)return;let l=this.frames;if(n<l[0]){switch(s){case gJ.setup:return o.shearX=o.data.shearX,void(o.shearY=o.data.shearY);case gJ.first:o.shearX+=(o.data.shearX-o.shearX)*r,o.shearY+=(o.data.shearY-o.shearY)*r}return}let h=0,c=0,u=_J.search(l,n,3),d=this.curves[u/3];switch(d){case 0:let t=l[u];h=l[u+1],c=l[u+2];let e=(n-t)/(l[u+3]-t);h+=(l[u+3+1]-h)*e,c+=(l[u+3+2]-c)*e;break;case 1:h=l[u+1],c=l[u+2];break;default:h=this.getBezierValue(n,u,1,d-2),c=this.getBezierValue(n,u,2,d+18-2)}switch(s){case gJ.setup:o.shearX=o.data.shearX+h*r,o.shearY=o.data.shearY+c*r;break;case gJ.first:case gJ.replace:o.shearX+=(o.data.shearX+h-o.shearX)*r,o.shearY+=(o.data.shearY+c-o.shearY)*r;break;case gJ.add:o.shearX+=h*r,o.shearY+=c*r}}}class DJ extends wJ{constructor(t,e,i){super(t,e,bJ.shearX+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];o.active&&(o.shearX=this.getRelativeValue(n,r,s,o.shearX,o.data.shearX))}}class BJ extends wJ{constructor(t,e,i){super(t,e,bJ.shearY+"|"+i),n(this,"boneIndex",0),this.boneIndex=i}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];o.active&&(o.shearY=this.getRelativeValue(n,r,s,o.shearY,o.data.shearY))}}class FJ extends _J{constructor(t,e){super(t,[bJ.inherit+"|"+e]),n(this,"boneIndex",0),this.boneIndex=e}getFrameEntries(){return 2}setFrame(t,e,n){t*=2,this.frames[t]=e,this.frames[t+1]=n}apply(t,e,n,i,r,s,a){let o=t.bones[this.boneIndex];if(!o.active)return;if(a==yJ.mixOut)return void(s==gJ.setup&&(o.inherit=o.data.inherit));let l=this.frames;n<l[0]?s!=gJ.setup&&s!=gJ.first||(o.inherit=o.data.inherit):o.inherit=this.frames[_J.search(l,n,2)+1]}}class LJ extends SJ{constructor(t,e,i){super(t,e,[bJ.rgb+"|"+i,bJ.alpha+"|"+i]),n(this,"slotIndex",0),this.slotIndex=i}getFrameEntries(){return 5}setFrame(t,e,n,i,r,s){t*=5,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=s}apply(t,e,n,i,r,s,a){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color;if(n<l[0]){let t=o.data.color;switch(s){case gJ.setup:return void h.setFromColor(t);case gJ.first:h.add((t.r-h.r)*r,(t.g-h.g)*r,(t.b-h.b)*r,(t.a-h.a)*r)}return}let c=0,u=0,d=0,p=0,f=_J.search(l,n,5),m=this.curves[f/5];switch(m){case 0:let t=l[f];c=l[f+1],u=l[f+2],d=l[f+3],p=l[f+4];let e=(n-t)/(l[f+5]-t);c+=(l[f+5+1]-c)*e,u+=(l[f+5+2]-u)*e,d+=(l[f+5+3]-d)*e,p+=(l[f+5+4]-p)*e;break;case 1:c=l[f+1],u=l[f+2],d=l[f+3],p=l[f+4];break;default:c=this.getBezierValue(n,f,1,m-2),u=this.getBezierValue(n,f,2,m+18-2),d=this.getBezierValue(n,f,3,m+36-2),p=this.getBezierValue(n,f,4,m+54-2)}1==r?h.set(c,u,d,p):(s==gJ.setup&&h.setFromColor(o.data.color),h.add((c-h.r)*r,(u-h.g)*r,(d-h.b)*r,(p-h.a)*r))}}class UJ extends SJ{constructor(t,e,i){super(t,e,[bJ.rgb+"|"+i]),n(this,"slotIndex",0),this.slotIndex=i}getFrameEntries(){return 4}setFrame(t,e,n,i,r){t<<=2,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i,this.frames[t+3]=r}apply(t,e,n,i,r,s,a){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color;if(n<l[0]){let t=o.data.color;switch(s){case gJ.setup:return h.r=t.r,h.g=t.g,void(h.b=t.b);case gJ.first:h.r+=(t.r-h.r)*r,h.g+=(t.g-h.g)*r,h.b+=(t.b-h.b)*r}return}let c=0,u=0,d=0,p=_J.search(l,n,4),f=this.curves[p>>2];switch(f){case 0:let t=l[p];c=l[p+1],u=l[p+2],d=l[p+3];let e=(n-t)/(l[p+4]-t);c+=(l[p+4+1]-c)*e,u+=(l[p+4+2]-u)*e,d+=(l[p+4+3]-d)*e;break;case 1:c=l[p+1],u=l[p+2],d=l[p+3];break;default:c=this.getBezierValue(n,p,1,f-2),u=this.getBezierValue(n,p,2,f+18-2),d=this.getBezierValue(n,p,3,f+36-2)}if(1==r)h.r=c,h.g=u,h.b=d;else{if(s==gJ.setup){let t=o.data.color;h.r=t.r,h.g=t.g,h.b=t.b}h.r+=(c-h.r)*r,h.g+=(u-h.g)*r,h.b+=(d-h.b)*r}}}class kJ extends wJ{constructor(t,e,i){super(t,e,bJ.alpha+"|"+i),n(this,"slotIndex",0),this.slotIndex=i}apply(t,e,n,i,r,s,a){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=o.color;if(n<this.frames[0]){let t=o.data.color;switch(s){case gJ.setup:return void(l.a=t.a);case gJ.first:l.a+=(t.a-l.a)*r}return}let h=this.getCurveValue(n);1==r?l.a=h:(s==gJ.setup&&(l.a=o.data.color.a),l.a+=(h-l.a)*r)}}class NJ extends SJ{constructor(t,e,i){super(t,e,[bJ.rgb+"|"+i,bJ.alpha+"|"+i,bJ.rgb2+"|"+i]),n(this,"slotIndex",0),this.slotIndex=i}getFrameEntries(){return 8}setFrame(t,e,n,i,r,s,a,o,l){t<<=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=s,this.frames[t+5]=a,this.frames[t+6]=o,this.frames[t+7]=l}apply(t,e,n,i,r,s,a){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color,c=o.darkColor;if(n<l[0]){let t=o.data.color,e=o.data.darkColor;switch(s){case gJ.setup:return h.setFromColor(t),c.r=e.r,c.g=e.g,void(c.b=e.b);case gJ.first:h.add((t.r-h.r)*r,(t.g-h.g)*r,(t.b-h.b)*r,(t.a-h.a)*r),c.r+=(e.r-c.r)*r,c.g+=(e.g-c.g)*r,c.b+=(e.b-c.b)*r}return}let u=0,d=0,p=0,f=0,m=0,g=0,v=0,y=_J.search(l,n,8),x=this.curves[y>>3];switch(x){case 0:let t=l[y];u=l[y+1],d=l[y+2],p=l[y+3],f=l[y+4],m=l[y+5],g=l[y+6],v=l[y+7];let e=(n-t)/(l[y+8]-t);u+=(l[y+8+1]-u)*e,d+=(l[y+8+2]-d)*e,p+=(l[y+8+3]-p)*e,f+=(l[y+8+4]-f)*e,m+=(l[y+8+5]-m)*e,g+=(l[y+8+6]-g)*e,v+=(l[y+8+7]-v)*e;break;case 1:u=l[y+1],d=l[y+2],p=l[y+3],f=l[y+4],m=l[y+5],g=l[y+6],v=l[y+7];break;default:u=this.getBezierValue(n,y,1,x-2),d=this.getBezierValue(n,y,2,x+18-2),p=this.getBezierValue(n,y,3,x+36-2),f=this.getBezierValue(n,y,4,x+54-2),m=this.getBezierValue(n,y,5,x+72-2),g=this.getBezierValue(n,y,6,x+90-2),v=this.getBezierValue(n,y,7,x+108-2)}if(1==r)h.set(u,d,p,f),c.r=m,c.g=g,c.b=v;else{if(s==gJ.setup){h.setFromColor(o.data.color);let t=o.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b}h.add((u-h.r)*r,(d-h.g)*r,(p-h.b)*r,(f-h.a)*r),c.r+=(m-c.r)*r,c.g+=(g-c.g)*r,c.b+=(v-c.b)*r}}}class zJ extends SJ{constructor(t,e,i){super(t,e,[bJ.rgb+"|"+i,bJ.rgb2+"|"+i]),n(this,"slotIndex",0),this.slotIndex=i}getFrameEntries(){return 7}setFrame(t,e,n,i,r,s,a,o){t*=7,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=s,this.frames[t+5]=a,this.frames[t+6]=o}apply(t,e,n,i,r,s,a){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color,c=o.darkColor;if(n<l[0]){let t=o.data.color,e=o.data.darkColor;switch(s){case gJ.setup:return h.r=t.r,h.g=t.g,h.b=t.b,c.r=e.r,c.g=e.g,void(c.b=e.b);case gJ.first:h.r+=(t.r-h.r)*r,h.g+=(t.g-h.g)*r,h.b+=(t.b-h.b)*r,c.r+=(e.r-c.r)*r,c.g+=(e.g-c.g)*r,c.b+=(e.b-c.b)*r}return}let u=0,d=0,p=0,f=0,m=0,g=0,v=_J.search(l,n,7),y=this.curves[v/7];switch(y){case 0:let t=l[v];u=l[v+1],d=l[v+2],p=l[v+3],f=l[v+4],m=l[v+5],g=l[v+6];let e=(n-t)/(l[v+7]-t);u+=(l[v+7+1]-u)*e,d+=(l[v+7+2]-d)*e,p+=(l[v+7+3]-p)*e,f+=(l[v+7+4]-f)*e,m+=(l[v+7+5]-m)*e,g+=(l[v+7+6]-g)*e;break;case 1:u=l[v+1],d=l[v+2],p=l[v+3],f=l[v+4],m=l[v+5],g=l[v+6];break;default:u=this.getBezierValue(n,v,1,y-2),d=this.getBezierValue(n,v,2,y+18-2),p=this.getBezierValue(n,v,3,y+36-2),f=this.getBezierValue(n,v,4,y+54-2),m=this.getBezierValue(n,v,5,y+72-2),g=this.getBezierValue(n,v,6,y+90-2)}if(1==r)h.r=u,h.g=d,h.b=p,c.r=f,c.g=m,c.b=g;else{if(s==gJ.setup){let t=o.data.color,e=o.data.darkColor;h.r=t.r,h.g=t.g,h.b=t.b,c.r=e.r,c.g=e.g,c.b=e.b}h.r+=(u-h.r)*r,h.g+=(d-h.g)*r,h.b+=(p-h.b)*r,c.r+=(f-c.r)*r,c.g+=(m-c.g)*r,c.b+=(g-c.b)*r}}}class GJ extends _J{constructor(t,e){super(t,[bJ.attachment+"|"+e]),n(this,"slotIndex",0),n(this,"attachmentNames"),this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n}apply(t,e,n,i,r,s,a){let o=t.slots[this.slotIndex];o.bone.active&&(a!=yJ.mixOut?n<this.frames[0]?s!=gJ.setup&&s!=gJ.first||this.setAttachment(t,o,o.data.attachmentName):this.setAttachment(t,o,this.attachmentNames[_J.search1(this.frames,n)]):s==gJ.setup&&this.setAttachment(t,o,o.data.attachmentName))}setAttachment(t,e,n){e.setAttachment(n?t.getAttachment(this.slotIndex,n):null)}}class HJ extends SJ{constructor(t,e,i,r){super(t,e,[bJ.deform+"|"+i+"|"+r.id]),n(this,"slotIndex",0),n(this,"attachment"),n(this,"vertices"),this.slotIndex=i,this.attachment=r,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.vertices[t]=n}setBezier(t,e,n,i,r,s,a,o,l,h,c){let u=this.curves,d=this.getFrameCount()+18*t;0==n&&(u[e]=2+d);let p=.03*(i-2*s+o),f=.03*l-.06*a,m=.006*(3*(s-o)-i+h),g=.018*(a-l+.33333333),v=2*p+m,y=2*f+g,x=.3*(s-i)+p+.16666667*m,b=.3*a+f+.16666667*g,_=i+x,S=b;for(let w=d+18;d<w;d+=2)u[d]=_,u[d+1]=S,x+=v,b+=y,v+=m,y+=g,_+=x,S+=b}getCurvePercent(t,e){let n=this.curves,i=n[e];switch(i){case 0:let n=this.frames[e];return(t-n)/(this.frames[e+this.getFrameEntries()]-n);case 1:return 0}if(i-=2,n[i]>t){let r=this.frames[e];return n[i+1]*(t-r)/(n[i]-r)}let r=i+18;for(i+=2;i<r;i+=2)if(n[i]>=t){let e=n[i-2],r=n[i-1];return r+(t-e)/(n[i]-e)*(n[i+1]-r)}let s=n[r-2],a=n[r-1];return a+(1-a)*(t-s)/(this.frames[e+this.getFrameEntries()]-s)}apply(t,e,n,i,r,s,a){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=o.getAttachment();if(!l)return;if(!(l instanceof hJ)||l.timelineAttachment!=this.attachment)return;let h=o.deform;0==h.length&&(s=gJ.setup);let c=this.vertices,u=c[0].length,d=this.frames;if(n<d[0]){switch(s){case gJ.setup:return void(h.length=0);case gJ.first:if(1==r)return void(h.length=0);h.length=u;let t=l;if(t.bones){r=1-r;for(p=0;p<u;p++)h[p]*=r}else{let e=t.vertices;for(var p=0;p<u;p++)h[p]+=(e[p]-h[p])*r}}return}if(h.length=u,n>=d[d.length-1]){let t=c[d.length-1];if(1==r)if(s==gJ.add){let e=l;if(e.bones)for(let n=0;n<u;n++)h[n]+=t[n];else{let n=e.vertices;for(let e=0;e<u;e++)h[e]+=t[e]-n[e]}}else rJ.arrayCopy(t,0,h,0,u);else switch(s){case gJ.setup:{let e=l;if(e.bones)for(let n=0;n<u;n++)h[n]=t[n]*r;else{let n=e.vertices;for(let e=0;e<u;e++){let i=n[e];h[e]=i+(t[e]-i)*r}}break}case gJ.first:case gJ.replace:for(let n=0;n<u;n++)h[n]+=(t[n]-h[n])*r;break;case gJ.add:let e=l;if(e.bones)for(let n=0;n<u;n++)h[n]+=t[n]*r;else{let n=e.vertices;for(let e=0;e<u;e++)h[e]+=(t[e]-n[e])*r}}return}let f=_J.search1(d,n),m=this.getCurvePercent(n,f),g=c[f],v=c[f+1];if(1==r)if(s==gJ.add){let t=l;if(t.bones)for(let e=0;e<u;e++){let t=g[e];h[e]+=t+(v[e]-t)*m}else{let e=t.vertices;for(let t=0;t<u;t++){let n=g[t];h[t]+=n+(v[t]-n)*m-e[t]}}}else for(let y=0;y<u;y++){let t=g[y];h[y]=t+(v[y]-t)*m}else switch(s){case gJ.setup:{let t=l;if(t.bones)for(let e=0;e<u;e++){let t=g[e];h[e]=(t+(v[e]-t)*m)*r}else{let e=t.vertices;for(let t=0;t<u;t++){let n=g[t],i=e[t];h[t]=i+(n+(v[t]-n)*m-i)*r}}break}case gJ.first:case gJ.replace:for(let e=0;e<u;e++){let t=g[e];h[e]+=(t+(v[e]-t)*m-h[e])*r}break;case gJ.add:let t=l;if(t.bones)for(let e=0;e<u;e++){let t=g[e];h[e]+=(t+(v[e]-t)*m)*r}else{let e=t.vertices;for(let t=0;t<u;t++){let n=g[t];h[t]+=(n+(v[t]-n)*m-e[t])*r}}}}}const VJ=class t extends _J{constructor(e){super(e,t.propertyIds),n(this,"events"),this.events=new Array(e)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,n,i,r,s,a){if(!i)return;let o=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,i,r,s,a),e=-1;else if(e>=o[l-1])return;if(n<o[0])return;let h=0;if(e<o[0])h=0;else{h=_J.search1(o,e)+1;let t=o[h];for(;h>0&&o[h-1]==t;)h--}for(;h<l&&n>=o[h];h++)i.push(this.events[h])}};n(VJ,"propertyIds",[""+bJ.event]);let XJ=VJ;const WJ=class t extends _J{constructor(e){super(e,t.propertyIds),n(this,"drawOrders"),this.drawOrders=new Array(e)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.drawOrders[t]=n}apply(t,e,n,i,r,s,a){if(a==yJ.mixOut)return void(s==gJ.setup&&rJ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(n<this.frames[0])return void(s!=gJ.setup&&s!=gJ.first||rJ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let o=_J.search1(this.frames,n),l=this.drawOrders[o];if(l){let e=t.drawOrder,n=t.slots;for(let t=0,i=l.length;t<i;t++)e[t]=n[l[t]]}else rJ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}};n(WJ,"propertyIds",[""+bJ.drawOrder]);let jJ=WJ;class YJ extends SJ{constructor(t,e,i){super(t,e,[bJ.ikConstraint+"|"+i]),n(this,"constraintIndex",0),this.constraintIndex=i}getFrameEntries(){return 6}setFrame(t,e,n,i,r,s,a){t*=6,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=s?1:0,this.frames[t+5]=a?1:0}apply(t,e,n,i,r,s,a){let o=t.ikConstraints[this.constraintIndex];if(!o.active)return;let l=this.frames;if(n<l[0]){switch(s){case gJ.setup:return o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,void(o.stretch=o.data.stretch);case gJ.first:o.mix+=(o.data.mix-o.mix)*r,o.softness+=(o.data.softness-o.softness)*r,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}return}let h=0,c=0,u=_J.search(l,n,6),d=this.curves[u/6];switch(d){case 0:let t=l[u];h=l[u+1],c=l[u+2];let e=(n-t)/(l[u+6]-t);h+=(l[u+6+1]-h)*e,c+=(l[u+6+2]-c)*e;break;case 1:h=l[u+1],c=l[u+2];break;default:h=this.getBezierValue(n,u,1,d-2),c=this.getBezierValue(n,u,2,d+18-2)}s==gJ.setup?(o.mix=o.data.mix+(h-o.data.mix)*r,o.softness=o.data.softness+(c-o.data.softness)*r,a==yJ.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=l[u+3],o.compress=0!=l[u+4],o.stretch=0!=l[u+5])):(o.mix+=(h-o.mix)*r,o.softness+=(c-o.softness)*r,a==yJ.mixIn&&(o.bendDirection=l[u+3],o.compress=0!=l[u+4],o.stretch=0!=l[u+5]))}}class qJ extends SJ{constructor(t,e,i){super(t,e,[bJ.transformConstraint+"|"+i]),n(this,"constraintIndex",0),this.constraintIndex=i}getFrameEntries(){return 7}setFrame(t,e,n,i,r,s,a,o){let l=this.frames;l[t*=7]=e,l[t+1]=n,l[t+2]=i,l[t+3]=r,l[t+4]=s,l[t+5]=a,l[t+6]=o}apply(t,e,n,i,r,s,a){let o=t.transformConstraints[this.constraintIndex];if(!o.active)return;let l,h,c,u,d,p,f=this.frames;if(n<f[0]){let t=o.data;switch(s){case gJ.setup:return o.mixRotate=t.mixRotate,o.mixX=t.mixX,o.mixY=t.mixY,o.mixScaleX=t.mixScaleX,o.mixScaleY=t.mixScaleY,void(o.mixShearY=t.mixShearY);case gJ.first:o.mixRotate+=(t.mixRotate-o.mixRotate)*r,o.mixX+=(t.mixX-o.mixX)*r,o.mixY+=(t.mixY-o.mixY)*r,o.mixScaleX+=(t.mixScaleX-o.mixScaleX)*r,o.mixScaleY+=(t.mixScaleY-o.mixScaleY)*r,o.mixShearY+=(t.mixShearY-o.mixShearY)*r}return}let m=_J.search(f,n,7),g=this.curves[m/7];switch(g){case 0:let t=f[m];l=f[m+1],h=f[m+2],c=f[m+3],u=f[m+4],d=f[m+5],p=f[m+6];let e=(n-t)/(f[m+7]-t);l+=(f[m+7+1]-l)*e,h+=(f[m+7+2]-h)*e,c+=(f[m+7+3]-c)*e,u+=(f[m+7+4]-u)*e,d+=(f[m+7+5]-d)*e,p+=(f[m+7+6]-p)*e;break;case 1:l=f[m+1],h=f[m+2],c=f[m+3],u=f[m+4],d=f[m+5],p=f[m+6];break;default:l=this.getBezierValue(n,m,1,g-2),h=this.getBezierValue(n,m,2,g+18-2),c=this.getBezierValue(n,m,3,g+36-2),u=this.getBezierValue(n,m,4,g+54-2),d=this.getBezierValue(n,m,5,g+72-2),p=this.getBezierValue(n,m,6,g+90-2)}if(s==gJ.setup){let t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*r,o.mixX=t.mixX+(h-t.mixX)*r,o.mixY=t.mixY+(c-t.mixY)*r,o.mixScaleX=t.mixScaleX+(u-t.mixScaleX)*r,o.mixScaleY=t.mixScaleY+(d-t.mixScaleY)*r,o.mixShearY=t.mixShearY+(p-t.mixShearY)*r}else o.mixRotate+=(l-o.mixRotate)*r,o.mixX+=(h-o.mixX)*r,o.mixY+=(c-o.mixY)*r,o.mixScaleX+=(u-o.mixScaleX)*r,o.mixScaleY+=(d-o.mixScaleY)*r,o.mixShearY+=(p-o.mixShearY)*r}}class KJ extends wJ{constructor(t,e,i){super(t,e,bJ.pathConstraintPosition+"|"+i),n(this,"constraintIndex",0),this.constraintIndex=i}apply(t,e,n,i,r,s,a){let o=t.pathConstraints[this.constraintIndex];o.active&&(o.position=this.getAbsoluteValue(n,r,s,o.position,o.data.position))}}class JJ extends wJ{constructor(t,e,i){super(t,e,bJ.pathConstraintSpacing+"|"+i),n(this,"constraintIndex",0),this.constraintIndex=i}apply(t,e,n,i,r,s,a){let o=t.pathConstraints[this.constraintIndex];o.active&&(o.spacing=this.getAbsoluteValue(n,r,s,o.spacing,o.data.spacing))}}class ZJ extends SJ{constructor(t,e,i){super(t,e,[bJ.pathConstraintMix+"|"+i]),n(this,"constraintIndex",0),this.constraintIndex=i}getFrameEntries(){return 4}setFrame(t,e,n,i,r){let s=this.frames;s[t<<=2]=e,s[t+1]=n,s[t+2]=i,s[t+3]=r}apply(t,e,n,i,r,s,a){let o=t.pathConstraints[this.constraintIndex];if(!o.active)return;let l,h,c,u=this.frames;if(n<u[0]){switch(s){case gJ.setup:return o.mixRotate=o.data.mixRotate,o.mixX=o.data.mixX,void(o.mixY=o.data.mixY);case gJ.first:o.mixRotate+=(o.data.mixRotate-o.mixRotate)*r,o.mixX+=(o.data.mixX-o.mixX)*r,o.mixY+=(o.data.mixY-o.mixY)*r}return}let d=_J.search(u,n,4),p=this.curves[d>>2];switch(p){case 0:let t=u[d];l=u[d+1],h=u[d+2],c=u[d+3];let e=(n-t)/(u[d+4]-t);l+=(u[d+4+1]-l)*e,h+=(u[d+4+2]-h)*e,c+=(u[d+4+3]-c)*e;break;case 1:l=u[d+1],h=u[d+2],c=u[d+3];break;default:l=this.getBezierValue(n,d,1,p-2),h=this.getBezierValue(n,d,2,p+18-2),c=this.getBezierValue(n,d,3,p+36-2)}if(s==gJ.setup){let t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*r,o.mixX=t.mixX+(h-t.mixX)*r,o.mixY=t.mixY+(c-t.mixY)*r}else o.mixRotate+=(l-o.mixRotate)*r,o.mixX+=(h-o.mixX)*r,o.mixY+=(c-o.mixY)*r}}class QJ extends wJ{constructor(t,e,i,r){super(t,e,r+"|"+i),n(this,"constraintIndex",0),this.constraintIndex=i}apply(t,e,n,i,r,s,a){let o;if(-1==this.constraintIndex){const e=n>=this.frames[0]?this.getCurveValue(n):0;for(const i of t.physicsConstraints)i.active&&this.global(i.data)&&this.set(i,this.getAbsoluteValue2(n,r,s,this.get(i),this.setup(i),e))}else o=t.physicsConstraints[this.constraintIndex],o.active&&this.set(o,this.getAbsoluteValue(n,r,s,this.get(o),this.setup(o)))}}class $J extends QJ{constructor(t,e,n){super(t,e,n,bJ.physicsConstraintInertia)}setup(t){return t.data.inertia}get(t){return t.inertia}set(t,e){t.inertia=e}global(t){return t.inertiaGlobal}}class tZ extends QJ{constructor(t,e,n){super(t,e,n,bJ.physicsConstraintStrength)}setup(t){return t.data.strength}get(t){return t.strength}set(t,e){t.strength=e}global(t){return t.strengthGlobal}}class eZ extends QJ{constructor(t,e,n){super(t,e,n,bJ.physicsConstraintDamping)}setup(t){return t.data.damping}get(t){return t.damping}set(t,e){t.damping=e}global(t){return t.dampingGlobal}}class nZ extends QJ{constructor(t,e,n){super(t,e,n,bJ.physicsConstraintMass)}setup(t){return 1/t.data.massInverse}get(t){return 1/t.massInverse}set(t,e){t.massInverse=1/e}global(t){return t.massGlobal}}class iZ extends QJ{constructor(t,e,n){super(t,e,n,bJ.physicsConstraintWind)}setup(t){return t.data.wind}get(t){return t.wind}set(t,e){t.wind=e}global(t){return t.windGlobal}}class rZ extends QJ{constructor(t,e,n){super(t,e,n,bJ.physicsConstraintGravity)}setup(t){return t.data.gravity}get(t){return t.gravity}set(t,e){t.gravity=e}global(t){return t.gravityGlobal}}class sZ extends QJ{constructor(t,e,n){super(t,e,n,bJ.physicsConstraintMix)}setup(t){return t.data.mix}get(t){return t.mix}set(t,e){t.mix=e}global(t){return t.mixGlobal}}const aZ=class t extends _J{constructor(e,i){super(e,t.propertyIds),n(this,"constraintIndex"),this.constraintIndex=i}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e}apply(t,e,n,i,r,s,a){let o;if(-1!=this.constraintIndex&&(o=t.physicsConstraints[this.constraintIndex],!o.active))return;const l=this.frames;if(e>n)this.apply(t,e,Number.MAX_VALUE,[],r,s,a),e=-1;else if(e>=l[l.length-1])return;if(!(n<l[0])&&(e<l[0]||n>=l[_J.search1(l,e)+1]))if(null!=o)o.reset();else for(const h of t.physicsConstraints)h.active&&h.reset()}};n(aZ,"propertyIds",[bJ.physicsConstraintReset.toString()]);let oZ=aZ;const lZ=class t extends _J{constructor(t,e,i){super(t,[bJ.sequence+"|"+e+"|"+i.sequence.id]),n(this,"slotIndex"),n(this,"attachment"),this.slotIndex=e,this.attachment=i}getFrameEntries(){return t.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(e,n,i,r,s){let a=this.frames;a[e*=t.ENTRIES]=n,a[e+t.MODE]=i|r<<4,a[e+t.DELAY]=s}apply(e,n,i,r,s,a,o){let l=e.slots[this.slotIndex];if(!l.bone.active)return;let h=l.attachment,c=this.attachment;if(!(h==c||h instanceof hJ&&h.timelineAttachment==c))return;let u=this.frames;if(i<u[0])return void(a!=gJ.setup&&a!=gJ.first||(l.sequenceIndex=-1));let d=_J.search(u,i,t.ENTRIES),p=u[d],f=u[d+t.MODE],m=u[d+t.DELAY];if(!this.attachment.sequence)return;let g=f>>4,v=this.attachment.sequence.regions.length,y=fJ[15&f];if(y!=dJ.hold)switch(g+=(i-p)/m+1e-5|0,y){case dJ.once:g=Math.min(v-1,g);break;case dJ.loop:g%=v;break;case dJ.pingpong:{let t=(v<<1)-2;g=0==t?0:g%t,g>=v&&(g=t-g);break}case dJ.onceReverse:g=Math.max(v-1-g,0);break;case dJ.loopReverse:g=v-1-g%v;break;case dJ.pingpongReverse:{let t=(v<<1)-2;g=0==t?0:(g+v-1)%t,g>=v&&(g=t-g)}}l.sequenceIndex=g}};n(lZ,"ENTRIES",3),n(lZ,"MODE",1),n(lZ,"DELAY",2);let hZ=lZ;const cZ=class t{constructor(t){n(this,"data"),n(this,"tracks",new Array),n(this,"timeScale",1),n(this,"unkeyedState",0),n(this,"events",new Array),n(this,"listeners",new Array),n(this,"queue",new pZ(this)),n(this,"propertyIDs",new QK),n(this,"animationsChanged",!1),n(this,"trackEntryPool",new sJ(()=>new dZ)),this.data=t}static emptyAnimation(){return t._emptyAnimation}update(t){t*=this.timeScale;let e=this.tracks;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(!i)continue;i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;let r=t*i.timeScale;if(i.delay>0){if(i.delay-=r,i.delay>0)continue;r=-i.delay,i.delay=0}let s=i.next;if(s){let e=i.trackLast-s.delay;if(e>=0){for(s.delay=0,s.trackTime+=0==i.timeScale?0:(e/i.timeScale+t)*s.timeScale,i.trackTime+=r,this.setCurrent(n,s,!0);s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&!i.mixingFrom){e[n]=null,this.queue.end(i),this.clearNext(i);continue}if(i.mixingFrom&&this.updateMixingFrom(i,t)){let t=i.mixingFrom;for(i.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}i.trackTime+=r}this.queue.drain()}updateMixingFrom(t,e){let n=t.mixingFrom;if(!n)return!0;let i=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),i):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();let e=this.events,n=this.tracks,i=!1;for(let u=0,d=n.length;u<d;u++){let s=n[u];if(!s||s.delay>0)continue;i=!0;let a=0==u?gJ.first:s.mixBlend,o=s.alpha;s.mixingFrom?o*=this.applyMixingFrom(s,t,a):s.trackTime>=s.trackEnd&&!s.next&&(o=0);let l=o>=s.alphaAttachmentThreshold,h=s.animationLast,c=s.getAnimationTime(),d=c,p=e;s.reverse&&(d=s.animation.duration-d,p=null);let f=s.animation.timelines,m=f.length;if(0==u&&1==o||a==gJ.add){0==u&&(l=!0);for(let e=0;e<m;e++){var r=f[e];r instanceof GJ?this.applyAttachmentTimeline(r,t,d,a,l):r.apply(t,h,d,p,o,a,yJ.mixIn)}}else{let e=s.timelineMode,n=s.shortestRotation,i=!n&&s.timelinesRotation.length!=m<<1;i&&(s.timelinesRotation.length=m<<1);for(let r=0;r<m;r++){let c=f[r],u=e[r]==gZ?a:gJ.setup;!n&&c instanceof MJ?this.applyRotateTimeline(c,t,d,o,u,s.timelinesRotation,r<<1,i):c instanceof GJ?this.applyAttachmentTimeline(c,t,d,a,l):c.apply(t,h,d,p,o,u,yJ.mixIn)}}this.queueEvents(s,c),e.length=0,s.nextAnimationLast=c,s.nextTrackLast=s.trackTime}for(var s=this.unkeyedState+_Z,a=t.slots,o=0,l=t.slots.length;o<l;o++){var h=a[o];if(h.attachmentState==s){var c=h.data.attachmentName;h.setAttachment(c?t.getAttachment(h.data.index,c):null)}}return this.unkeyedState+=2,this.queue.drain(),i}applyMixingFrom(t,e,n){let i=t.mixingFrom;i.mixingFrom&&this.applyMixingFrom(i,e,n);let r=0;0==t.mixDuration?(r=1,n==gJ.first&&(n=gJ.setup)):(r=t.mixTime/t.mixDuration,r>1&&(r=1),n!=gJ.first&&(n=i.mixBlend));let s=r<i.mixAttachmentThreshold,a=r<i.mixDrawOrderThreshold,o=i.animation.timelines,l=o.length,h=i.alpha*t.interruptAlpha,c=h*(1-r),u=i.animationLast,d=i.getAnimationTime(),p=d,f=null;if(i.reverse?p=i.animation.duration-p:r<i.eventThreshold&&(f=this.events),n==gJ.add)for(let m=0;m<l;m++)o[m].apply(e,u,p,f,c,n,yJ.mixOut);else{let t=i.timelineMode,r=i.timelineHoldMix,d=i.shortestRotation,m=!d&&i.timelinesRotation.length!=l<<1;m&&(i.timelinesRotation.length=l<<1),i.totalAlpha=0;for(let g=0;g<l;g++){let l,v=o[g],y=yJ.mixOut,x=0;switch(t[g]){case gZ:if(!a&&v instanceof jJ)continue;l=n,x=c;break;case vZ:l=gJ.setup,x=c;break;case yZ:l=n,x=h;break;case xZ:l=gJ.setup,x=h;break;default:l=gJ.setup;let t=r[g];x=h*Math.max(0,1-t.mixTime/t.mixDuration)}i.totalAlpha+=x,!d&&v instanceof MJ?this.applyRotateTimeline(v,e,p,x,l,i.timelinesRotation,g<<1,m):v instanceof GJ?this.applyAttachmentTimeline(v,e,p,l,s&&x>=i.alphaAttachmentThreshold):(a&&v instanceof jJ&&l==gJ.setup&&(y=yJ.mixIn),v.apply(e,u,p,f,x,l,y))}}return t.mixDuration>0&&this.queueEvents(i,d),this.events.length=0,i.nextAnimationLast=d,i.nextTrackLast=i.trackTime,r}applyAttachmentTimeline(t,e,n,i,r){var s=e.slots[t.slotIndex];s.bone.active&&(n<t.frames[0]?i!=gJ.setup&&i!=gJ.first||this.setAttachment(e,s,s.data.attachmentName,r):this.setAttachment(e,s,t.attachmentNames[_J.search1(t.frames,n)],r),s.attachmentState<=this.unkeyedState&&(s.attachmentState=this.unkeyedState+_Z))}setAttachment(t,e,n,i){e.setAttachment(n?t.getAttachment(e.data.index,n):null),i&&(e.attachmentState=this.unkeyedState+SZ)}applyRotateTimeline(t,e,n,i,r,s,a,o){if(o&&(s[a]=0),1==i)return void t.apply(e,0,n,null,1,r,yJ.mixIn);let l=e.bones[t.boneIndex];if(!l.active)return;let h=0,c=0;if(n<t.frames[0])switch(r){case gJ.setup:l.rotation=l.data.rotation;default:return;case gJ.first:h=l.rotation,c=l.data.rotation}else h=r==gJ.setup?l.data.rotation:l.rotation,c=l.data.rotation+t.getCurveValue(n);let u=0,d=c-h;if(d-=360*Math.ceil(d/360-.5),0==d)u=s[a];else{let t=0,e=0;o?(t=0,e=d):(t=s[a],e=s[a+1]);let n=t-t%360;u=d+n;let i=d>=0,r=t>=0;Math.abs(e)<=90&&nJ.signum(e)!=nJ.signum(d)&&(Math.abs(t-n)>180?(u+=360*nJ.signum(t),r=i):0!=n?u-=360*nJ.signum(t):r=i),r!=i&&(u+=360*nJ.signum(t)),s[a]=u}s[a+1]=d,l.rotation=h+u*i}queueEvents(t,e){let n=t.animationStart,i=t.animationEnd,r=i-n,s=t.trackLast%r,a=this.events,o=0,l=a.length;for(;o<l;o++){let e=a[o];if(e.time<s)break;e.time>i||this.queue.event(t,e)}let h=!1;if(t.loop)if(0==r)h=!0;else{const e=Math.floor(t.trackTime/r);h=e>0&&e>Math.floor(t.trackLast/r)}else h=e>=i&&t.animationLast<i;for(h&&this.queue.complete(t);o<l;o++){let e=a[o];e.time<n||this.queue.event(t,e)}}clearTracks(){let t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;let e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let n=e;for(;;){let t=n.mixingFrom;if(!t)break;this.queue.end(t),n.mixingFrom=null,n.mixingTo=null,n=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,n){let i=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,i&&(n&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,n=!1){let i=this.data.skeletonData.findAnimation(e);if(!i)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,i,n)}setAnimationWith(t,e,n=!1){if(!e)throw new Error("animation cannot be null.");let i=!0,r=this.expandToIndex(t);r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.clearNext(r),r=r.mixingFrom,i=!1):this.clearNext(r));let s=this.trackEntry(t,e,n,r);return this.setCurrent(t,s,i),this.queue.drain(),s}addAnimation(t,e,n=!1,i=0){let r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,n,i)}addAnimationWith(t,e,n=!1,i=0){if(!e)throw new Error("animation cannot be null.");let r=this.expandToIndex(t);if(r)for(;r.next;)r=r.next;let s=this.trackEntry(t,e,n,r);return r?(r.next=s,s.previous=r,i<=0&&(i+=r.getTrackComplete()-s.mixDuration)):(this.setCurrent(t,s,!0),this.queue.drain()),s.delay=i,s}setEmptyAnimation(e,n=0){let i=this.setAnimationWith(e,t.emptyAnimation(),!1);return i.mixDuration=n,i.trackEnd=n,i}addEmptyAnimation(e,n=0,i=0){let r=this.addAnimationWith(e,t.emptyAnimation(),!1,i);return i<=0&&(r.delay+=r.mixDuration-n),r.mixDuration=n,r.trackEnd=n,r}setEmptyAnimations(t=0){let e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let n=0,i=this.tracks.length;n<i;n++){let e=this.tracks[n];e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(rJ.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,n,i){let r=this.trackEntryPool.obtain();return r.reset(),r.trackIndex=t,r.animation=e,r.loop=n,r.holdPrevious=!1,r.reverse=!1,r.shortestRotation=!1,r.eventThreshold=0,r.alphaAttachmentThreshold=0,r.mixAttachmentThreshold=0,r.mixDrawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.mixTime=0,r.mixDuration=i?this.data.getMix(i.animation,e):0,r.interruptAlpha=1,r.totalAlpha=0,r.mixBlend=gJ.replace,r}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();let t=this.tracks;for(let e=0,n=t.length;e<n;e++){let n=t[e];if(n){for(;n.mixingFrom;)n=n.mixingFrom;do{n.mixingTo&&n.mixBlend==gJ.add||this.computeHold(n),n=n.mixingTo}while(n)}}}computeHold(t){let e=t.mixingTo,n=t.animation.timelines,i=t.animation.timelines.length,r=t.timelineMode;r.length=i;let s=t.timelineHoldMix;s.length=0;let a=this.propertyIDs;if(e&&e.holdPrevious)for(let o=0;o<i;o++)r[o]=a.addAll(n[o].getPropertyIds())?xZ:yZ;else t:for(let o=0;o<i;o++){let i=n[o],l=i.getPropertyIds();if(a.addAll(l))if(!e||i instanceof GJ||i instanceof jJ||i instanceof XJ||!e.animation.hasTimeline(l))r[o]=vZ;else{for(let n=e.mixingTo;n;n=n.mixingTo)if(!n.animation.hasTimeline(l)){if(t.mixDuration>0){r[o]=bZ,s[o]=n;continue t}break}r[o]=xZ}else r[o]=gZ}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}};n(cZ,"_emptyAnimation",new mJ("<empty>",[],0));let uZ=cZ;class dZ{constructor(){n(this,"animation",null),n(this,"previous",null),n(this,"next",null),n(this,"mixingFrom",null),n(this,"mixingTo",null),n(this,"listener",null),n(this,"trackIndex",0),n(this,"loop",!1),n(this,"holdPrevious",!1),n(this,"reverse",!1),n(this,"shortestRotation",!1),n(this,"eventThreshold",0),n(this,"mixAttachmentThreshold",0),n(this,"alphaAttachmentThreshold",0),n(this,"mixDrawOrderThreshold",0),n(this,"animationStart",0),n(this,"animationEnd",0),n(this,"animationLast",0),n(this,"nextAnimationLast",0),n(this,"delay",0),n(this,"trackTime",0),n(this,"trackLast",0),n(this,"nextTrackLast",0),n(this,"trackEnd",0),n(this,"timeScale",0),n(this,"alpha",0),n(this,"mixTime",0),n(this,"_mixDuration",0),n(this,"interruptAlpha",0),n(this,"totalAlpha",0),n(this,"mixBlend",gJ.replace),n(this,"timelineMode",new Array),n(this,"timelineHoldMix",new Array),n(this,"timelinesRotation",new Array)}get mixDuration(){return this._mixDuration}set mixDuration(t){this._mixDuration=t}setMixDurationWithDelay(t,e){this._mixDuration=t,null!=this.previous&&e<=0&&(e+=this.previous.getTrackComplete()-t),this.delay=e}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){let t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){let t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}wasApplied(){return-1!=this.nextTrackLast}isNextReady(){return null!=this.next&&this.nextTrackLast-this.next.delay>=0}}class pZ{constructor(t){n(this,"objects",[]),n(this,"drainDisabled",!1),n(this,"animState"),this.animState=t}start(t){this.objects.push(fZ.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(fZ.interrupt),this.objects.push(t)}end(t){this.objects.push(fZ.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(fZ.dispose),this.objects.push(t)}complete(t){this.objects.push(fZ.complete),this.objects.push(t)}event(t,e){this.objects.push(fZ.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;let t=this.objects,e=this.animState.listeners;for(let n=0;n<t.length;n+=2){let i=t[n],r=t[n+1];switch(i){case fZ.start:r.listener&&r.listener.start&&r.listener.start(r);for(let t=0;t<e.length;t++){let n=e[t];n.start&&n.start(r)}break;case fZ.interrupt:r.listener&&r.listener.interrupt&&r.listener.interrupt(r);for(let t=0;t<e.length;t++){let n=e[t];n.interrupt&&n.interrupt(r)}break;case fZ.end:r.listener&&r.listener.end&&r.listener.end(r);for(let t=0;t<e.length;t++){let n=e[t];n.end&&n.end(r)}case fZ.dispose:r.listener&&r.listener.dispose&&r.listener.dispose(r);for(let t=0;t<e.length;t++){let n=e[t];n.dispose&&n.dispose(r)}this.animState.trackEntryPool.free(r);break;case fZ.complete:r.listener&&r.listener.complete&&r.listener.complete(r);for(let t=0;t<e.length;t++){let n=e[t];n.complete&&n.complete(r)}break;case fZ.event:let i=t[2+n++];r.listener&&r.listener.event&&r.listener.event(r,i);for(let t=0;t<e.length;t++){let n=e[t];n.event&&n.event(r,i)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var fZ,mZ;(mZ=fZ||(fZ={}))[mZ.start=0]="start",mZ[mZ.interrupt=1]="interrupt",mZ[mZ.end=2]="end",mZ[mZ.dispose=3]="dispose",mZ[mZ.complete=4]="complete",mZ[mZ.event=5]="event";const gZ=0,vZ=1,yZ=2,xZ=3,bZ=4,_Z=1,SZ=2;class wZ{constructor(t){if(n(this,"skeletonData"),n(this,"animationToMixTime",{}),n(this,"defaultMix",0),!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,n){let i=this.skeletonData.findAnimation(t);if(!i)throw new Error("Animation not found: "+t);let r=this.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);this.setMixWith(i,r,n)}setMixWith(t,e,n){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");let i=t.name+"."+e.name;this.animationToMixTime[i]=n}getMix(t,e){let n=t.name+"."+e.name,i=this.animationToMixTime[n];return void 0===i?this.defaultMix:i}}class TZ extends hJ{constructor(t){super(t),n(this,"color",new tJ(1,1,1,1))}copy(){let t=new TZ(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class MZ extends hJ{constructor(t){super(t),n(this,"endSlot",null),n(this,"color",new tJ(.2275,.2275,.8078,1))}copy(){let t=new MZ(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}let AZ=class{constructor(t){n(this,"_image"),this._image=t}getImage(){return this._image}};var EZ,CZ,PZ,RZ;(CZ=EZ||(EZ={}))[CZ.Nearest=9728]="Nearest",CZ[CZ.Linear=9729]="Linear",CZ[CZ.MipMap=9987]="MipMap",CZ[CZ.MipMapNearestNearest=9984]="MipMapNearestNearest",CZ[CZ.MipMapLinearNearest=9985]="MipMapLinearNearest",CZ[CZ.MipMapNearestLinear=9986]="MipMapNearestLinear",CZ[CZ.MipMapLinearLinear=9987]="MipMapLinearLinear",(RZ=PZ||(PZ={}))[RZ.MirroredRepeat=33648]="MirroredRepeat",RZ[RZ.ClampToEdge=33071]="ClampToEdge",RZ[RZ.Repeat=10497]="Repeat";class IZ{constructor(){n(this,"texture"),n(this,"u",0),n(this,"v",0),n(this,"u2",0),n(this,"v2",0),n(this,"width",0),n(this,"height",0),n(this,"degrees",0),n(this,"offsetX",0),n(this,"offsetY",0),n(this,"originalWidth",0),n(this,"originalHeight",0)}}class OZ{constructor(t){n(this,"pages",new Array),n(this,"regions",new Array);let e=new DZ(t),i=new Array(4),r={size:t=>{t.width=parseInt(i[1]),t.height=parseInt(i[2])},format:()=>{},filter:t=>{t.minFilter=rJ.enumValue(EZ,i[1]),t.magFilter=rJ.enumValue(EZ,i[2])},repeat:t=>{-1!=i[1].indexOf("x")&&(t.uWrap=PZ.Repeat),-1!=i[1].indexOf("y")&&(t.vWrap=PZ.Repeat)},pma:t=>{t.pma="true"==i[1]}};var s={xy:t=>{t.x=parseInt(i[1]),t.y=parseInt(i[2])},size:t=>{t.width=parseInt(i[1]),t.height=parseInt(i[2])},bounds:t=>{t.x=parseInt(i[1]),t.y=parseInt(i[2]),t.width=parseInt(i[3]),t.height=parseInt(i[4])},offset:t=>{t.offsetX=parseInt(i[1]),t.offsetY=parseInt(i[2])},orig:t=>{t.originalWidth=parseInt(i[1]),t.originalHeight=parseInt(i[2])},offsets:t=>{t.offsetX=parseInt(i[1]),t.offsetY=parseInt(i[2]),t.originalWidth=parseInt(i[3]),t.originalHeight=parseInt(i[4])},rotate:t=>{let e=i[1];"true"==e?t.degrees=90:"false"!=e&&(t.degrees=parseInt(e))},index:t=>{t.index=parseInt(i[1])}};let a=e.readLine();for(;a&&0==a.trim().length;)a=e.readLine();for(;a&&0!=a.trim().length&&0!=e.readEntry(i,a);)a=e.readLine();let o=null,l=null,h=null;for(;null!==a;)if(0==a.trim().length)o=null,a=e.readLine();else if(o){let t=new FZ(o,a);for(;;){let n=e.readEntry(i,a=e.readLine());if(0==n)break;let r=s[i[0]];if(r)r(t);else{l||(l=[]),h||(h=[]),l.push(i[0]);let t=[];for(let e=0;e<n;e++)t.push(parseInt(i[e+1]));h.push(t)}}0==t.originalWidth&&0==t.originalHeight&&(t.originalWidth=t.width,t.originalHeight=t.height),l&&l.length>0&&h&&h.length>0&&(t.names=l,t.values=h,l=null,h=null),t.u=t.x/o.width,t.v=t.y/o.height,90==t.degrees?(t.u2=(t.x+t.height)/o.width,t.v2=(t.y+t.width)/o.height):(t.u2=(t.x+t.width)/o.width,t.v2=(t.y+t.height)/o.height),this.regions.push(t)}else{for(o=new BZ(a.trim());0!=e.readEntry(i,a=e.readLine());){let t=r[i[0]];t&&t(o)}this.pages.push(o)}}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}setTextures(t,e=""){for(let n of this.pages)n.setTexture(t.get(e+n.name))}dispose(){var t;for(let e=0;e<this.pages.length;e++)null==(t=this.pages[e].texture)||t.dispose()}}class DZ{constructor(t){n(this,"lines"),n(this,"index",0),this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(!e)return 0;if(0==(e=e.trim()).length)return 0;let n=e.indexOf(":");if(-1==n)return 0;t[0]=e.substr(0,n).trim();for(let i=1,r=n+1;;i++){let n=e.indexOf(",",r);if(-1==n)return t[i]=e.substr(r).trim(),i;if(t[i]=e.substr(r,n-r).trim(),r=n+1,4==i)return 4}}}class BZ{constructor(t){n(this,"name"),n(this,"minFilter",EZ.Nearest),n(this,"magFilter",EZ.Nearest),n(this,"uWrap",PZ.ClampToEdge),n(this,"vWrap",PZ.ClampToEdge),n(this,"texture",null),n(this,"width",0),n(this,"height",0),n(this,"pma",!1),n(this,"regions",new Array),this.name=t}setTexture(t){this.texture=t,t.setFilters(this.minFilter,this.magFilter),t.setWraps(this.uWrap,this.vWrap);for(let e of this.regions)e.texture=t}}class FZ extends IZ{constructor(t,e){super(),n(this,"page"),n(this,"name"),n(this,"x",0),n(this,"y",0),n(this,"offsetX",0),n(this,"offsetY",0),n(this,"originalWidth",0),n(this,"originalHeight",0),n(this,"index",0),n(this,"degrees",0),n(this,"names",null),n(this,"values",null),this.page=t,this.name=e,t.regions.push(this)}}class LZ extends hJ{constructor(t,e){super(t),n(this,"region",null),n(this,"path"),n(this,"regionUVs",[]),n(this,"uvs",[]),n(this,"triangles",[]),n(this,"color",new tJ(1,1,1,1)),n(this,"width",0),n(this,"height",0),n(this,"hullLength",0),n(this,"edges",[]),n(this,"parentMesh",null),n(this,"sequence",null),n(this,"tempColor",new tJ(0,0,0,0)),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");let t=this.regionUVs;this.uvs&&this.uvs.length==t.length||(this.uvs=rJ.newFloatArray(t.length));let e=this.uvs,n=this.uvs.length,i=this.region.u,r=this.region.v,s=0,a=0;if(this.region instanceof FZ){let o=this.region,l=o.page,h=l.width,c=l.height;switch(o.degrees){case 90:i-=(o.originalHeight-o.offsetY-o.height)/h,r-=(o.originalWidth-o.offsetX-o.width)/c,s=o.originalHeight/h,a=o.originalWidth/c;for(let o=0;o<n;o+=2)e[o]=i+t[o+1]*s,e[o+1]=r+(1-t[o])*a;return;case 180:i-=(o.originalWidth-o.offsetX-o.width)/h,r-=o.offsetY/c,s=o.originalWidth/h,a=o.originalHeight/c;for(let o=0;o<n;o+=2)e[o]=i+(1-t[o])*s,e[o+1]=r+(1-t[o+1])*a;return;case 270:i-=o.offsetY/h,r-=o.offsetX/c,s=o.originalHeight/h,a=o.originalWidth/c;for(let o=0;o<n;o+=2)e[o]=i+(1-t[o+1])*s,e[o+1]=r+t[o]*a;return}i-=o.offsetX/h,r-=(o.originalHeight-o.offsetY-o.height)/c,s=o.originalWidth/h,a=o.originalHeight/c}else this.region?(s=this.region.u2-i,a=this.region.v2-r):(i=r=0,s=a=1);for(let o=0;o<n;o+=2)e[o]=i+t[o]*s,e[o+1]=r+t[o+1]*a}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();let t=new LZ(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),rJ.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),rJ.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),rJ.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),rJ.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,n,i,r,s){null!=this.sequence&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,n,i,r,s)}newLinkedMesh(){let t=new LZ(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),null!=t.region&&t.updateRegion(),t}}class UZ extends hJ{constructor(t){super(t),n(this,"lengths",[]),n(this,"closed",!1),n(this,"constantSpeed",!1),n(this,"color",new tJ(1,1,1,1))}copy(){let t=new UZ(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),rJ.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class kZ extends hJ{constructor(t){super(t),n(this,"x",0),n(this,"y",0),n(this,"rotation",0),n(this,"color",new tJ(.38,.94,0,1))}computeWorldPosition(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}computeWorldRotation(t){const e=this.rotation*nJ.degRad,n=Math.cos(e),i=Math.sin(e),r=n*t.a+i*t.b,s=n*t.c+i*t.d;return nJ.atan2Deg(s,r)}copy(){let t=new kZ(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}const NZ=class t extends oJ{constructor(t,e){super(t),n(this,"x",0),n(this,"y",0),n(this,"scaleX",1),n(this,"scaleY",1),n(this,"rotation",0),n(this,"width",0),n(this,"height",0),n(this,"color",new tJ(1,1,1,1)),n(this,"path"),n(this,"region",null),n(this,"sequence",null),n(this,"offset",rJ.newFloatArray(8)),n(this,"uvs",rJ.newFloatArray(8)),n(this,"tempColor",new tJ(1,1,1,1)),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");let t=this.region,e=this.uvs;if(null==t)return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=1,e[5]=1,e[6]=1,void(e[7]=0);let n=this.width/this.region.originalWidth*this.scaleX,i=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*n,s=-this.height/2*this.scaleY+this.region.offsetY*i,a=r+this.region.width*n,o=s+this.region.height*i,l=this.rotation*nJ.degRad,h=Math.cos(l),c=Math.sin(l),u=this.x,d=this.y,p=r*h+u,f=r*c,m=s*h+d,g=s*c,v=a*h+u,y=a*c,x=o*h+d,b=o*c,_=this.offset;_[0]=p-g,_[1]=m+f,_[2]=p-b,_[3]=x+f,_[4]=v-b,_[5]=x+y,_[6]=v-g,_[7]=m+y,90==t.degrees?(e[0]=t.u2,e[1]=t.v2,e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,n,i){null!=this.sequence&&this.sequence.apply(t,this);let r=t.bone,s=this.offset,a=r.worldX,o=r.worldY,l=r.a,h=r.b,c=r.c,u=r.d,d=0,p=0;d=s[0],p=s[1],e[n]=d*l+p*h+a,e[n+1]=d*c+p*u+o,n+=i,d=s[2],p=s[3],e[n]=d*l+p*h+a,e[n+1]=d*c+p*u+o,n+=i,d=s[4],p=s[5],e[n]=d*l+p*h+a,e[n+1]=d*c+p*u+o,n+=i,d=s[6],p=s[7],e[n]=d*l+p*h+a,e[n+1]=d*c+p*u+o}copy(){let e=new t(this.name,this.path);return e.region=this.region,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,rJ.arrayCopy(this.uvs,0,e.uvs,0,8),rJ.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e.sequence=null!=this.sequence?this.sequence.copy():null,e}};n(NZ,"X1",0),n(NZ,"Y1",1),n(NZ,"C1R",2),n(NZ,"C1G",3),n(NZ,"C1B",4),n(NZ,"C1A",5),n(NZ,"U1",6),n(NZ,"V1",7),n(NZ,"X2",8),n(NZ,"Y2",9),n(NZ,"C2R",10),n(NZ,"C2G",11),n(NZ,"C2B",12),n(NZ,"C2A",13),n(NZ,"U2",14),n(NZ,"V2",15),n(NZ,"X3",16),n(NZ,"Y3",17),n(NZ,"C3R",18),n(NZ,"C3G",19),n(NZ,"C3B",20),n(NZ,"C3A",21),n(NZ,"U3",22),n(NZ,"V3",23),n(NZ,"X4",24),n(NZ,"Y4",25),n(NZ,"C4R",26),n(NZ,"C4G",27),n(NZ,"C4B",28),n(NZ,"C4A",29),n(NZ,"U4",30),n(NZ,"V4",31);let zZ=NZ;class GZ{constructor(t){n(this,"atlas"),this.atlas=t}loadSequence(t,e,n){let i=n.regions;for(let r=0,s=i.length;r<s;r++){let s=n.getPath(e,r),a=this.atlas.findRegion(s);if(null==a)throw new Error("Region not found in atlas: "+s+" (sequence: "+t+")");i[r]=a}}newRegionAttachment(t,e,n,i){let r=new zZ(e,n);if(null!=i)this.loadSequence(e,n,i);else{let t=this.atlas.findRegion(n);if(!t)throw new Error("Region not found in atlas: "+n+" (region attachment: "+e+")");r.region=t}return r}newMeshAttachment(t,e,n,i){let r=new LZ(e,n);if(null!=i)this.loadSequence(e,n,i);else{let t=this.atlas.findRegion(n);if(!t)throw new Error("Region not found in atlas: "+n+" (mesh attachment: "+e+")");r.region=t}return r}newBoundingBoxAttachment(t,e){return new TZ(e)}newPathAttachment(t,e){return new UZ(e)}newPointAttachment(t,e){return new kZ(e)}newClippingAttachment(t,e){return new MZ(e)}}class HZ{constructor(t,e,i){if(n(this,"index",0),n(this,"name"),n(this,"parent",null),n(this,"length",0),n(this,"x",0),n(this,"y",0),n(this,"rotation",0),n(this,"scaleX",1),n(this,"scaleY",1),n(this,"shearX",0),n(this,"shearY",0),n(this,"inherit",VZ.Normal),n(this,"skinRequired",!1),n(this,"color",new tJ),n(this,"icon"),n(this,"visible",!1),t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=i}}var VZ,XZ;(XZ=VZ||(VZ={}))[XZ.Normal=0]="Normal",XZ[XZ.OnlyTranslation=1]="OnlyTranslation",XZ[XZ.NoRotationOrReflection=2]="NoRotationOrReflection",XZ[XZ.NoScale=3]="NoScale",XZ[XZ.NoScaleOrReflection=4]="NoScaleOrReflection";class WZ{constructor(t,e,i){if(n(this,"data"),n(this,"skeleton"),n(this,"parent",null),n(this,"children",new Array),n(this,"x",0),n(this,"y",0),n(this,"rotation",0),n(this,"scaleX",0),n(this,"scaleY",0),n(this,"shearX",0),n(this,"shearY",0),n(this,"ax",0),n(this,"ay",0),n(this,"arotation",0),n(this,"ascaleX",0),n(this,"ascaleY",0),n(this,"ashearX",0),n(this,"ashearY",0),n(this,"a",0),n(this,"b",0),n(this,"c",0),n(this,"d",0),n(this,"worldY",0),n(this,"worldX",0),n(this,"inherit",VZ.Normal),n(this,"sorted",!1),n(this,"active",!1),!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}isActive(){return this.active}update(t){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,n,i,r,s,a){this.ax=t,this.ay=e,this.arotation=n,this.ascaleX=i,this.ascaleY=r,this.ashearX=s,this.ashearY=a;let o=this.parent;if(!o){let o=this.skeleton;const l=o.scaleX,h=o.scaleY,c=(n+s)*nJ.degRad,u=(n+90+a)*nJ.degRad;return this.a=Math.cos(c)*i*l,this.b=Math.cos(u)*r*l,this.c=Math.sin(c)*i*h,this.d=Math.sin(u)*r*h,this.worldX=t*l+o.x,void(this.worldY=e*h+o.y)}let l=o.a,h=o.b,c=o.c,u=o.d;switch(this.worldX=l*t+h*e+o.worldX,this.worldY=c*t+u*e+o.worldY,this.inherit){case VZ.Normal:{const t=(n+s)*nJ.degRad,e=(n+90+a)*nJ.degRad,o=Math.cos(t)*i,d=Math.cos(e)*r,p=Math.sin(t)*i,f=Math.sin(e)*r;return this.a=l*o+h*p,this.b=l*d+h*f,this.c=c*o+u*p,void(this.d=c*d+u*f)}case VZ.OnlyTranslation:{const t=(n+s)*nJ.degRad,e=(n+90+a)*nJ.degRad;this.a=Math.cos(t)*i,this.b=Math.cos(e)*r,this.c=Math.sin(t)*i,this.d=Math.sin(e)*r;break}case VZ.NoRotationOrReflection:{let t=1/this.skeleton.scaleX,e=1/this.skeleton.scaleY;l*=t,c*=e;let o=l*l+c*c,d=0;o>1e-4?(o=Math.abs(l*u*e-h*t*c)/o,h=c*o,u=l*o,d=Math.atan2(c,l)*nJ.radDeg):(l=0,c=0,d=90-Math.atan2(u,h)*nJ.radDeg);const p=(n+s-d)*nJ.degRad,f=(n+a-d+90)*nJ.degRad,m=Math.cos(p)*i,g=Math.cos(f)*r,v=Math.sin(p)*i,y=Math.sin(f)*r;this.a=l*m-h*v,this.b=l*g-h*y,this.c=c*m+u*v,this.d=c*g+u*y;break}case VZ.NoScale:case VZ.NoScaleOrReflection:{n*=nJ.degRad;const t=Math.cos(n),e=Math.sin(n);let o=(l*t+h*e)/this.skeleton.scaleX,d=(c*t+u*e)/this.skeleton.scaleY,p=Math.sqrt(o*o+d*d);p>1e-5&&(p=1/p),o*=p,d*=p,p=Math.sqrt(o*o+d*d),this.inherit==VZ.NoScale&&l*u-h*c<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(p=-p),n=Math.PI/2+Math.atan2(d,o);const f=Math.cos(n)*p,m=Math.sin(n)*p;s*=nJ.degRad,a=(90+a)*nJ.degRad;const g=Math.cos(s)*i,v=Math.cos(a)*r,y=Math.sin(s)*i,x=Math.sin(a)*r;this.a=o*g+f*y,this.b=o*v+f*x,this.c=d*g+m*y,this.d=d*v+m*x;break}}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}setToSetupPose(){let t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY,this.inherit=t.inherit}updateAppliedTransform(){let t=this.parent;if(!t)return this.ax=this.worldX-this.skeleton.x,this.ay=this.worldY-this.skeleton.y,this.arotation=Math.atan2(this.c,this.a)*nJ.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*nJ.radDeg);let e,n,i,r,s=t.a,a=t.b,o=t.c,l=t.d,h=1/(s*l-a*o),c=l*h,u=a*h,d=o*h,p=s*h,f=this.worldX-t.worldX,m=this.worldY-t.worldY;if(this.ax=f*c-m*u,this.ay=m*p-f*d,this.inherit==VZ.OnlyTranslation)e=this.a,n=this.b,i=this.c,r=this.d;else{switch(this.inherit){case VZ.NoRotationOrReflection:{let t=Math.abs(s*l-a*o)/(s*s+o*o);a=-o*this.skeleton.scaleX*t/this.skeleton.scaleY,l=s*this.skeleton.scaleY*t/this.skeleton.scaleX,h=1/(s*l-a*o),c=l*h,u=a*h;break}case VZ.NoScale:case VZ.NoScaleOrReflection:let t=nJ.cosDeg(this.rotation),e=nJ.sinDeg(this.rotation);s=(s*t+a*e)/this.skeleton.scaleX,o=(o*t+l*e)/this.skeleton.scaleY;let n=Math.sqrt(s*s+o*o);n>1e-5&&(n=1/n),s*=n,o*=n,n=Math.sqrt(s*s+o*o),this.inherit==VZ.NoScale&&h<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(n=-n);let i=nJ.PI/2+Math.atan2(o,s);a=Math.cos(i)*n,l=Math.sin(i)*n,h=1/(s*l-a*o),c=l*h,u=a*h,d=o*h,p=s*h}e=c*this.a-u*this.c,n=c*this.b-u*this.d,i=p*this.c-d*this.a,r=p*this.d-d*this.b}if(this.ashearX=0,this.ascaleX=Math.sqrt(e*e+i*i),this.ascaleX>1e-4){let t=e*r-n*i;this.ascaleY=t/this.ascaleX,this.ashearY=-Math.atan2(e*n+i*r,t)*nJ.radDeg,this.arotation=Math.atan2(i,e)*nJ.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(n*n+r*r),this.ashearY=0,this.arotation=90-Math.atan2(r,n)*nJ.radDeg}getWorldRotationX(){return Math.atan2(this.c,this.a)*nJ.radDeg}getWorldRotationY(){return Math.atan2(this.d,this.b)*nJ.radDeg}getWorldScaleX(){return Math.sqrt(this.a*this.a+this.c*this.c)}getWorldScaleY(){return Math.sqrt(this.b*this.b+this.d*this.d)}worldToLocal(t){let e=1/(this.a*this.d-this.b*this.c),n=t.x-this.worldX,i=t.y-this.worldY;return t.x=n*this.d*e-i*this.b*e,t.y=i*this.a*e-n*this.c*e,t}localToWorld(t){let e=t.x,n=t.y;return t.x=e*this.a+n*this.b+this.worldX,t.y=e*this.c+n*this.d+this.worldY,t}worldToParent(t){if(null==t)throw new Error("world cannot be null.");return null==this.parent?t:this.parent.worldToLocal(t)}parentToWorld(t){if(null==t)throw new Error("world cannot be null.");return null==this.parent?t:this.parent.localToWorld(t)}worldToLocalRotation(t){let e=nJ.sinDeg(t),n=nJ.cosDeg(t);return Math.atan2(this.a*e-this.c*n,this.d*n-this.b*e)*nJ.radDeg+this.rotation-this.shearX}localToWorldRotation(t){t-=this.rotation-this.shearX;let e=nJ.sinDeg(t),n=nJ.cosDeg(t);return Math.atan2(n*this.c+e*this.d,n*this.a+e*this.b)*nJ.radDeg}rotateWorld(t){t*=nJ.degRad;const e=Math.sin(t),n=Math.cos(t),i=this.a,r=this.b;this.a=n*i-e*this.c,this.b=n*r-e*this.d,this.c=e*i+n*this.c,this.d=e*r+n*this.d}}class jZ{constructor(t,e,i){n(this,"name"),n(this,"order"),n(this,"skinRequired"),this.name=t,this.order=e,this.skinRequired=i}}let YZ=class{constructor(t,e){if(n(this,"data"),n(this,"intValue",0),n(this,"floatValue",0),n(this,"stringValue",null),n(this,"time",0),n(this,"volume",0),n(this,"balance",0),!e)throw new Error("data cannot be null.");this.time=t,this.data=e}};class qZ{constructor(t){n(this,"name"),n(this,"intValue",0),n(this,"floatValue",0),n(this,"stringValue",null),n(this,"audioPath",null),n(this,"volume",0),n(this,"balance",0),this.name=t}}class KZ{constructor(t,e){if(n(this,"data"),n(this,"bones"),n(this,"target"),n(this,"bendDirection",0),n(this,"compress",!1),n(this,"stretch",!1),n(this,"mix",1),n(this,"softness",0),n(this,"active",!1),!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let n=0;n<t.bones.length;n++){let i=e.findBone(t.bones[n].name);if(!i)throw new Error(`Couldn't find bone ${t.bones[n].name}`);this.bones.push(i)}let i=e.findBone(t.target.name);if(!i)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=i,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch}isActive(){return this.active}setToSetupPose(){const t=this.data;this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch}update(t){if(0==this.mix)return;let e=this.target,n=this.bones;switch(n.length){case 1:this.apply1(n[0],e.worldX,e.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(n[0],n[1],e.worldX,e.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,n,i,r,s,a){let o=t.parent;if(!o)throw new Error("IK bone must have parent.");let l=o.a,h=o.b,c=o.c,u=o.d,d=-t.ashearX-t.arotation,p=0,f=0;switch(t.inherit){case VZ.OnlyTranslation:p=(e-t.worldX)*nJ.signum(t.skeleton.scaleX),f=(n-t.worldY)*nJ.signum(t.skeleton.scaleY);break;case VZ.NoRotationOrReflection:let i=Math.abs(l*u-h*c)/Math.max(1e-4,l*l+c*c),r=l/t.skeleton.scaleX,s=c/t.skeleton.scaleY;h=-s*i*t.skeleton.scaleX,u=r*i*t.skeleton.scaleY,d+=Math.atan2(s,r)*nJ.radDeg;default:let a=e-o.worldX,m=n-o.worldY,g=l*u-h*c;Math.abs(g)<=1e-4?(p=0,f=0):(p=(a*u-m*h)/g-t.ax,f=(m*l-a*c)/g-t.ay)}d+=Math.atan2(f,p)*nJ.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let m=t.ascaleX,g=t.ascaleY;if(i||r){switch(t.inherit){case VZ.NoScale:case VZ.NoScaleOrReflection:p=e-t.worldX,f=n-t.worldY}const o=t.data.length*m;if(o>1e-4){const t=p*p+f*f;if(i&&t<o*o||r&&t>o*o){const e=(Math.sqrt(t)/o-1)*a+1;m*=e,s&&(g*=e)}}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*a,m,g,t.ashearX,t.ashearY)}apply2(t,e,n,i,r,s,a,o,l){if(t.inherit!=VZ.Normal||e.inherit!=VZ.Normal)return;let h=t.ax,c=t.ay,u=t.ascaleX,d=t.ascaleY,p=u,f=d,m=e.ascaleX,g=0,v=0,y=0;u<0?(u=-u,g=180,y=-1):(g=0,y=1),d<0&&(d=-d,y=-y),m<0?(m=-m,v=180):v=0;let x=e.ax,b=0,_=0,S=0,w=t.a,T=t.b,M=t.c,A=t.d,E=Math.abs(u-d)<=1e-4;!E||s?(b=0,_=w*x+t.worldX,S=M*x+t.worldY):(b=e.ay,_=w*x+T*b+t.worldX,S=M*x+A*b+t.worldY);let C=t.parent;if(!C)throw new Error("IK parent must itself have a parent.");w=C.a,T=C.b,M=C.c,A=C.d;let P=w*A-T*M,R=_-C.worldX,I=S-C.worldY;P=Math.abs(P)<=1e-4?0:1/P;let O,D,B=(R*A-I*T)*P-h,F=(I*w-R*M)*P-c,L=Math.sqrt(B*B+F*F),U=e.data.length*m;if(L<1e-4)return this.apply1(t,n,i,!1,s,!1,l),void e.updateWorldTransformWith(x,b,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);R=n-C.worldX,I=i-C.worldY;let k=(R*A-I*T)*P-h,N=(I*w-R*M)*P-c,z=k*k+N*N;if(0!=o){o*=u*(m+1)*.5;let t=Math.sqrt(z),e=t-L-U*u+o;if(e>0){let n=Math.min(1,e/(2*o))-1;n=(e-o*(1-n*n))/t,k-=n*k,N-=n*N,z=k*k+N*N}}t:if(E){U*=u;let t=(z-L*L-U*U)/(2*L*U);t<-1?(t=-1,D=Math.PI*r):t>1?(t=1,D=0,s&&(w=(Math.sqrt(z)/(L+U)-1)*l+1,p*=w,a&&(f*=w))):D=Math.acos(t)*r,w=L+U*t,T=U*Math.sin(D),O=Math.atan2(N*w-k*T,k*w+N*T)}else{w=u*U,T=d*U;let t=w*w,e=T*T,n=Math.atan2(N,k);M=e*L*L+t*z-t*e;let i=-2*e*L,s=e-t;if(A=i*i-4*s*M,A>=0){let t=Math.sqrt(A);i<0&&(t=-t),t=.5*-(i+t);let e=t/s,a=M/t,o=Math.abs(e)<Math.abs(a)?e:a;if(e=z-o*o,e>=0){I=Math.sqrt(e)*r,O=n-Math.atan2(I,o),D=Math.atan2(I/d,(o-L)/u);break t}}let a=nJ.PI,o=L-w,l=o*o,h=0,c=0,p=L+w,f=p*p,m=0;M=-w*L/(t-e),M>=-1&&M<=1&&(M=Math.acos(M),R=w*Math.cos(M)+L,I=T*Math.sin(M),A=R*R+I*I,A<l&&(a=M,l=A,o=R,h=I),A>f&&(c=M,f=A,p=R,m=I)),z<=.5*(l+f)?(O=n-Math.atan2(h*r,o),D=a*r):(O=n-Math.atan2(m*r,p),D=c*r)}let G=Math.atan2(b,x)*y,H=t.arotation;O=(O-G)*nJ.radDeg+g-H,O>180?O-=360:O<-180&&(O+=360),t.updateWorldTransformWith(h,c,H+O*l,p,f,0,0),H=e.arotation,D=((D+G)*nJ.radDeg-e.ashearX)*y+v-H,D>180?D-=360:D<-180&&(D+=360),e.updateWorldTransformWith(x,b,H+D*l,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class JZ extends jZ{constructor(t){super(t,0,!1),n(this,"bones",new Array),n(this,"_target",null),n(this,"bendDirection",0),n(this,"compress",!1),n(this,"stretch",!1),n(this,"uniform",!1),n(this,"mix",0),n(this,"softness",0)}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class ZZ extends jZ{constructor(t){super(t,0,!1),n(this,"bones",new Array),n(this,"_target",null),n(this,"positionMode",QZ.Fixed),n(this,"spacingMode",tQ.Fixed),n(this,"rotateMode",nQ.Chain),n(this,"offsetRotation",0),n(this,"position",0),n(this,"spacing",0),n(this,"mixRotate",0),n(this,"mixX",0),n(this,"mixY",0)}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}}var QZ,$Z,tQ,eQ,nQ,iQ;($Z=QZ||(QZ={}))[$Z.Fixed=0]="Fixed",$Z[$Z.Percent=1]="Percent",(eQ=tQ||(tQ={}))[eQ.Length=0]="Length",eQ[eQ.Fixed=1]="Fixed",eQ[eQ.Percent=2]="Percent",eQ[eQ.Proportional=3]="Proportional",(iQ=nQ||(nQ={}))[iQ.Tangent=0]="Tangent",iQ[iQ.Chain=1]="Chain",iQ[iQ.ChainScale=2]="ChainScale";const rQ=class t{constructor(t,e){if(n(this,"data"),n(this,"bones"),n(this,"target"),n(this,"position",0),n(this,"spacing",0),n(this,"mixRotate",0),n(this,"mixX",0),n(this,"mixY",0),n(this,"spaces",new Array),n(this,"positions",new Array),n(this,"world",new Array),n(this,"curves",new Array),n(this,"lengths",new Array),n(this,"segments",new Array),n(this,"active",!1),!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let n=0,r=t.bones.length;n<r;n++){let i=e.findBone(t.bones[n].name);if(!i)throw new Error(`Couldn't find bone ${t.bones[n].name}.`);this.bones.push(i)}let i=e.findSlot(t.target.name);if(!i)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=i,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}setToSetupPose(){const t=this.data;this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}update(e){let n=this.target.getAttachment();if(!(n instanceof UZ))return;let i=this.mixRotate,r=this.mixX,s=this.mixY;if(0==i&&0==r&&0==s)return;let a=this.data,o=a.rotateMode==nQ.Tangent,l=a.rotateMode==nQ.ChainScale,h=this.bones,c=h.length,u=o?c:c+1,d=rJ.setArraySize(this.spaces,u),p=l?this.lengths=rJ.setArraySize(this.lengths,c):[],f=this.spacing;switch(a.spacingMode){case tQ.Percent:if(l)for(let t=0,i=u-1;t<i;t++){let e=h[t],n=e.data.length,i=n*e.a,r=n*e.c;p[t]=Math.sqrt(i*i+r*r)}rJ.arrayFill(d,1,u,f);break;case tQ.Proportional:let e=0;for(let i=0,r=u-1;i<r;){let n=h[i],r=n.data.length;if(r<t.epsilon)l&&(p[i]=0),d[++i]=f;else{let t=r*n.a,s=r*n.c,a=Math.sqrt(t*t+s*s);l&&(p[i]=a),d[++i]=a,e+=a}}if(e>0){e=u/e*f;for(let t=1;t<u;t++)d[t]*=e}break;default:let n=a.spacingMode==tQ.Length;for(let i=0,r=u-1;i<r;){let e=h[i],r=e.data.length;if(r<t.epsilon)l&&(p[i]=0),d[++i]=f;else{let t=r*e.a,s=r*e.c,a=Math.sqrt(t*t+s*s);l&&(p[i]=a),d[++i]=(n?r+f:f)*a/r}}}let m=this.computeWorldPositions(n,u,o),g=m[0],v=m[1],y=a.offsetRotation,x=!1;if(0==y)x=a.rotateMode==nQ.Chain;else{x=!1;let t=this.target.bone;y*=t.a*t.d-t.b*t.c>0?nJ.degRad:-nJ.degRad}for(let t=0,b=3;t<c;t++,b+=3){let e=h[t];e.worldX+=(g-e.worldX)*r,e.worldY+=(v-e.worldY)*s;let n=m[b],a=m[b+1],c=n-g,u=a-v;if(l){let n=p[t];if(0!=n){let t=(Math.sqrt(c*c+u*u)/n-1)*i+1;e.a*=t,e.c*=t}}if(g=n,v=a,i>0){let n=e.a,r=e.b,s=e.c,a=e.d,l=0,h=0,p=0;if(l=o?m[b-1]:0==d[t+1]?m[b+2]:Math.atan2(u,c),l-=Math.atan2(s,n),x){h=Math.cos(l),p=Math.sin(l);let t=e.data.length;g+=(t*(h*n-p*s)-c)*i,v+=(t*(p*n+h*s)-u)*i}else l+=y;l>nJ.PI?l-=nJ.PI2:l<-nJ.PI&&(l+=nJ.PI2),l*=i,h=Math.cos(l),p=Math.sin(l),e.a=h*n-p*s,e.b=h*r-p*a,e.c=p*n+h*s,e.d=p*r+h*a}e.updateAppliedTransform()}}computeWorldPositions(e,n,i){let r=this.target,s=this.position,a=this.spaces,o=rJ.setArraySize(this.positions,3*n+2),l=this.world,h=e.closed,c=e.worldVerticesLength,u=c/6,d=t.NONE;if(!e.constantSpeed){let p=e.lengths;u-=h?1:2;let f,m=p[u];switch(this.data.positionMode==QZ.Percent&&(s*=m),this.data.spacingMode){case tQ.Percent:f=m;break;case tQ.Proportional:f=m/n;break;default:f=1}l=rJ.setArraySize(this.world,8);for(let g=0,v=0,y=0;g<n;g++,v+=3){let n=a[g]*f;s+=n;let x=s;if(h)x%=m,x<0&&(x+=m),y=0;else{if(x<0){d!=t.BEFORE&&(d=t.BEFORE,e.computeWorldVertices(r,2,4,l,0,2)),this.addBeforePosition(x,l,0,o,v);continue}if(x>m){d!=t.AFTER&&(d=t.AFTER,e.computeWorldVertices(r,c-6,4,l,0,2)),this.addAfterPosition(x-m,l,0,o,v);continue}}for(;;y++){let t=p[y];if(!(x>t)){if(0==y)x/=t;else{let e=p[y-1];x=(x-e)/(t-e)}break}}y!=d&&(d=y,h&&y==u?(e.computeWorldVertices(r,c-4,4,l,0,2),e.computeWorldVertices(r,0,4,l,4,2)):e.computeWorldVertices(r,6*y+2,8,l,0,2)),this.addCurvePosition(x,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],o,v,i||g>0&&0==n)}return o}h?(c+=2,l=rJ.setArraySize(this.world,c),e.computeWorldVertices(r,2,c-4,l,0,2),e.computeWorldVertices(r,0,2,l,c-4,2),l[c-2]=l[0],l[c-1]=l[1]):(u--,c-=4,l=rJ.setArraySize(this.world,c),e.computeWorldVertices(r,2,c,l,0,2));let p,f=rJ.setArraySize(this.curves,u),m=0,g=l[0],v=l[1],y=0,x=0,b=0,_=0,S=0,w=0,T=0,M=0,A=0,E=0,C=0,P=0,R=0,I=0;for(let t=0,B=2;t<u;t++,B+=6)y=l[B],x=l[B+1],b=l[B+2],_=l[B+3],S=l[B+4],w=l[B+5],T=.1875*(g-2*y+b),M=.1875*(v-2*x+_),A=.09375*(3*(y-b)-g+S),E=.09375*(3*(x-_)-v+w),C=2*T+A,P=2*M+E,R=.75*(y-g)+T+.16666667*A,I=.75*(x-v)+M+.16666667*E,m+=Math.sqrt(R*R+I*I),R+=C,I+=P,C+=A,P+=E,m+=Math.sqrt(R*R+I*I),R+=C,I+=P,m+=Math.sqrt(R*R+I*I),R+=C+A,I+=P+E,m+=Math.sqrt(R*R+I*I),f[t]=m,g=S,v=w;switch(this.data.positionMode==QZ.Percent&&(s*=m),this.data.spacingMode){case tQ.Percent:p=m;break;case tQ.Proportional:p=m/n;break;default:p=1}let O=this.segments,D=0;for(let t=0,B=0,F=0,L=0;t<n;t++,B+=3){let e=a[t]*p;s+=e;let n=s;if(h)n%=m,n<0&&(n+=m),F=0;else{if(n<0){this.addBeforePosition(n,l,0,o,B);continue}if(n>m){this.addAfterPosition(n-m,l,c-4,o,B);continue}}for(;;F++){let t=f[F];if(!(n>t)){if(0==F)n/=t;else{let e=f[F-1];n=(n-e)/(t-e)}break}}if(F!=d){d=F;let t=6*F;for(g=l[t],v=l[t+1],y=l[t+2],x=l[t+3],b=l[t+4],_=l[t+5],S=l[t+6],w=l[t+7],T=.03*(g-2*y+b),M=.03*(v-2*x+_),A=.006*(3*(y-b)-g+S),E=.006*(3*(x-_)-v+w),C=2*T+A,P=2*M+E,R=.3*(y-g)+T+.16666667*A,I=.3*(x-v)+M+.16666667*E,D=Math.sqrt(R*R+I*I),O[0]=D,t=1;t<8;t++)R+=C,I+=P,C+=A,P+=E,D+=Math.sqrt(R*R+I*I),O[t]=D;R+=C,I+=P,D+=Math.sqrt(R*R+I*I),O[8]=D,R+=C+A,I+=P+E,D+=Math.sqrt(R*R+I*I),O[9]=D,L=0}for(n*=D;;L++){let t=O[L];if(!(n>t)){if(0==L)n/=t;else{let e=O[L-1];n=L+(n-e)/(t-e)}break}}this.addCurvePosition(.1*n,g,v,y,x,b,_,S,w,o,B,i||t>0&&0==e)}return o}addBeforePosition(t,e,n,i,r){let s=e[n],a=e[n+1],o=e[n+2]-s,l=e[n+3]-a,h=Math.atan2(l,o);i[r]=s+t*Math.cos(h),i[r+1]=a+t*Math.sin(h),i[r+2]=h}addAfterPosition(t,e,n,i,r){let s=e[n+2],a=e[n+3],o=s-e[n],l=a-e[n+1],h=Math.atan2(l,o);i[r]=s+t*Math.cos(h),i[r+1]=a+t*Math.sin(h),i[r+2]=h}addCurvePosition(t,e,n,i,r,s,a,o,l,h,c,u){if(0==t||isNaN(t))return h[c]=e,h[c+1]=n,void(h[c+2]=Math.atan2(r-n,i-e));let d=t*t,p=d*t,f=1-t,m=f*f,g=m*f,v=f*t,y=3*v,x=f*y,b=y*t,_=e*g+i*x+s*b+o*p,S=n*g+r*x+a*b+l*p;h[c]=_,h[c+1]=S,u&&(h[c+2]=t<.001?Math.atan2(r-n,i-e):Math.atan2(S-(n*m+r*v*2+a*d),_-(e*m+i*v*2+s*d)))}};n(rQ,"NONE",-1),n(rQ,"BEFORE",-2),n(rQ,"AFTER",-3),n(rQ,"epsilon",1e-5);let sQ=rQ;class aQ{constructor(t,e){n(this,"data"),n(this,"_bone",null),n(this,"inertia",0),n(this,"strength",0),n(this,"damping",0),n(this,"massInverse",0),n(this,"wind",0),n(this,"gravity",0),n(this,"mix",0),n(this,"_reset",!0),n(this,"ux",0),n(this,"uy",0),n(this,"cx",0),n(this,"cy",0),n(this,"tx",0),n(this,"ty",0),n(this,"xOffset",0),n(this,"xVelocity",0),n(this,"yOffset",0),n(this,"yVelocity",0),n(this,"rotateOffset",0),n(this,"rotateVelocity",0),n(this,"scaleOffset",0),n(this,"scaleVelocity",0),n(this,"active",!1),n(this,"skeleton"),n(this,"remaining",0),n(this,"lastTime",0),this.data=t,this.skeleton=e,this.bone=e.bones[t.bone.index],this.inertia=t.inertia,this.strength=t.strength,this.damping=t.damping,this.massInverse=t.massInverse,this.wind=t.wind,this.gravity=t.gravity,this.mix=t.mix}set bone(t){this._bone=t}get bone(){if(this._bone)return this._bone;throw new Error("Bone not set.")}reset(){this.remaining=0,this.lastTime=this.skeleton.time,this._reset=!0,this.xOffset=0,this.xVelocity=0,this.yOffset=0,this.yVelocity=0,this.rotateOffset=0,this.rotateVelocity=0,this.scaleOffset=0,this.scaleVelocity=0}setToSetupPose(){const t=this.data;this.inertia=t.inertia,this.strength=t.strength,this.damping=t.damping,this.massInverse=t.massInverse,this.wind=t.wind,this.gravity=t.gravity,this.mix=t.mix}isActive(){return this.active}update(t){const e=this.mix;if(0==e)return;const n=this.data.x>0,i=this.data.y>0,r=this.data.rotate>0||this.data.shearX>0,s=this.data.scaleX>0,a=this.bone,o=a.data.length;switch(t){case uQ.none:return;case uQ.reset:this.reset();case uQ.update:const t=this.skeleton,l=Math.max(this.skeleton.time-this.lastTime,0);this.remaining+=l,this.lastTime=t.time;const h=a.worldX,c=a.worldY;if(this._reset)this._reset=!1,this.ux=h,this.uy=c;else{let u=this.remaining,d=this.inertia,p=this.data.step,f=this.skeleton.data.referenceScale,m=-1,g=this.data.limit*l,v=g*Math.abs(t.scaleY);if(g*=Math.abs(t.scaleX),n||i){if(n){const t=(this.ux-h)*d;this.xOffset+=t>g?g:t<-g?-g:t,this.ux=h}if(i){const t=(this.uy-c)*d;this.yOffset+=t>v?v:t<-v?-v:t,this.uy=c}if(u>=p){m=Math.pow(this.damping,60*p);const t=this.massInverse*p,e=this.strength,r=this.wind*f,s=(cQ.yDown?-this.gravity:this.gravity)*f;do{n&&(this.xVelocity+=(r-this.xOffset*e)*t,this.xOffset+=this.xVelocity*p,this.xVelocity*=m),i&&(this.yVelocity-=(s+this.yOffset*e)*t,this.yOffset+=this.yVelocity*p,this.yVelocity*=m),u-=p}while(u>=p)}n&&(a.worldX+=this.xOffset*e*this.data.x),i&&(a.worldY+=this.yOffset*e*this.data.y)}if(r||s){let t=Math.atan2(a.c,a.a),n=0,i=0,l=0,h=this.cx-a.worldX,c=this.cy-a.worldY;if(h>g?h=g:h<-g&&(h=-g),c>v?c=v:c<-v&&(c=-v),r){l=(this.data.rotate+this.data.shearX)*e;let r=Math.atan2(c+this.ty,h+this.tx)-t-this.rotateOffset*l;this.rotateOffset+=(r-Math.ceil(r*nJ.invPI2-.5)*nJ.PI2)*d,r=this.rotateOffset*l+t,n=Math.cos(r),i=Math.sin(r),s&&(r=o*a.getWorldScaleX(),r>0&&(this.scaleOffset+=(h*n+c*i)*d/r))}else{n=Math.cos(t),i=Math.sin(t);const e=o*a.getWorldScaleX();e>0&&(this.scaleOffset+=(h*n+c*i)*d/e)}if(u=this.remaining,u>=p){-1==m&&(m=Math.pow(this.damping,60*p));const e=this.massInverse*p,a=this.strength,h=this.wind,c=cQ.yDown?-this.gravity:this.gravity,d=o/f;for(;;)if(u-=p,s&&(this.scaleVelocity+=(h*n-c*i-this.scaleOffset*a)*e,this.scaleOffset+=this.scaleVelocity*p,this.scaleVelocity*=m),r){if(this.rotateVelocity-=((h*i+c*n)*d+this.rotateOffset*a)*e,this.rotateOffset+=this.rotateVelocity*p,this.rotateVelocity*=m,u<p)break;const r=this.rotateOffset*l+t;n=Math.cos(r),i=Math.sin(r)}else if(u<p)break}}this.remaining=u}this.cx=a.worldX,this.cy=a.worldY;break;case uQ.pose:n&&(a.worldX+=this.xOffset*e*this.data.x),i&&(a.worldY+=this.yOffset*e*this.data.y)}if(r){let t=this.rotateOffset*e,n=0,i=0,r=0;if(this.data.shearX>0){let e=0;this.data.rotate>0&&(e=t*this.data.rotate,n=Math.sin(e),i=Math.cos(e),r=a.b,a.b=i*r-n*a.d,a.d=n*r+i*a.d),e+=t*this.data.shearX,n=Math.sin(e),i=Math.cos(e),r=a.a,a.a=i*r-n*a.c,a.c=n*r+i*a.c}else t*=this.data.rotate,n=Math.sin(t),i=Math.cos(t),r=a.a,a.a=i*r-n*a.c,a.c=n*r+i*a.c,r=a.b,a.b=i*r-n*a.d,a.d=n*r+i*a.d}if(s){const t=1+this.scaleOffset*e*this.data.scaleX;a.a*=t,a.c*=t}t!=uQ.pose&&(this.tx=o*a.a,this.ty=o*a.c),a.updateAppliedTransform()}translate(t,e){this.ux-=t,this.uy-=e,this.cx-=t,this.cy-=e}rotate(t,e,n){const i=n*nJ.degRad,r=Math.cos(i),s=Math.sin(i),a=this.cx-t,o=this.cy-e;this.translate(a*r-o*s-a,a*s+o*r-o)}}class oQ{constructor(t,e){if(n(this,"data"),n(this,"bone"),n(this,"color"),n(this,"darkColor",null),n(this,"attachment",null),n(this,"attachmentState",0),n(this,"sequenceIndex",-1),n(this,"deform",new Array),!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new tJ,this.darkColor=t.darkColor?new tJ:null,this.setToSetupPose()}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof hJ&&this.attachment instanceof hJ&&t.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class lQ{constructor(t,e){if(n(this,"data"),n(this,"bones"),n(this,"target"),n(this,"mixRotate",0),n(this,"mixX",0),n(this,"mixY",0),n(this,"mixScaleX",0),n(this,"mixScaleY",0),n(this,"mixShearY",0),n(this,"temp",new aJ),n(this,"active",!1),!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let n=0;n<t.bones.length;n++){let i=e.findBone(t.bones[n].name);if(!i)throw new Error(`Couldn't find bone ${t.bones[n].name}.`);this.bones.push(i)}let i=e.findBone(t.target.name);if(!i)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=i,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY}isActive(){return this.active}setToSetupPose(){const t=this.data;this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY}update(t){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleY&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){let t=this.mixRotate,e=this.mixX,n=this.mixY,i=this.mixScaleX,r=this.mixScaleY,s=this.mixShearY,a=0!=e||0!=n,o=this.target,l=o.a,h=o.b,c=o.c,u=o.d,d=l*u-h*c>0?nJ.degRad:-nJ.degRad,p=this.data.offsetRotation*d,f=this.data.offsetShearY*d,m=this.bones;for(let g=0,v=m.length;g<v;g++){let d=m[g];if(0!=t){let e=d.a,n=d.b,i=d.c,r=d.d,s=Math.atan2(c,l)-Math.atan2(i,e)+p;s>nJ.PI?s-=nJ.PI2:s<-nJ.PI&&(s+=nJ.PI2),s*=t;let a=Math.cos(s),o=Math.sin(s);d.a=a*e-o*i,d.b=a*n-o*r,d.c=o*e+a*i,d.d=o*n+a*r}if(a){let t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),d.worldX+=(t.x-d.worldX)*e,d.worldY+=(t.y-d.worldY)*n}if(0!=i){let t=Math.sqrt(d.a*d.a+d.c*d.c);0!=t&&(t=(t+(Math.sqrt(l*l+c*c)-t+this.data.offsetScaleX)*i)/t),d.a*=t,d.c*=t}if(0!=r){let t=Math.sqrt(d.b*d.b+d.d*d.d);0!=t&&(t=(t+(Math.sqrt(h*h+u*u)-t+this.data.offsetScaleY)*r)/t),d.b*=t,d.d*=t}if(s>0){let t=d.b,e=d.d,n=Math.atan2(e,t),i=Math.atan2(u,h)-Math.atan2(c,l)-(n-Math.atan2(d.c,d.a));i>nJ.PI?i-=nJ.PI2:i<-nJ.PI&&(i+=nJ.PI2),i=n+(i+f)*s;let r=Math.sqrt(t*t+e*e);d.b=Math.cos(i)*r,d.d=Math.sin(i)*r}d.updateAppliedTransform()}}applyRelativeWorld(){let t=this.mixRotate,e=this.mixX,n=this.mixY,i=this.mixScaleX,r=this.mixScaleY,s=this.mixShearY,a=0!=e||0!=n,o=this.target,l=o.a,h=o.b,c=o.c,u=o.d,d=l*u-h*c>0?nJ.degRad:-nJ.degRad,p=this.data.offsetRotation*d,f=this.data.offsetShearY*d,m=this.bones;for(let g=0,v=m.length;g<v;g++){let d=m[g];if(0!=t){let e=d.a,n=d.b,i=d.c,r=d.d,s=Math.atan2(c,l)+p;s>nJ.PI?s-=nJ.PI2:s<-nJ.PI&&(s+=nJ.PI2),s*=t;let a=Math.cos(s),o=Math.sin(s);d.a=a*e-o*i,d.b=a*n-o*r,d.c=o*e+a*i,d.d=o*n+a*r}if(a){let t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),d.worldX+=t.x*e,d.worldY+=t.y*n}if(0!=i){let t=(Math.sqrt(l*l+c*c)-1+this.data.offsetScaleX)*i+1;d.a*=t,d.c*=t}if(0!=r){let t=(Math.sqrt(h*h+u*u)-1+this.data.offsetScaleY)*r+1;d.b*=t,d.d*=t}if(s>0){let t=Math.atan2(u,h)-Math.atan2(c,l);t>nJ.PI?t-=nJ.PI2:t<-nJ.PI&&(t+=nJ.PI2);let e=d.b,n=d.d;t=Math.atan2(n,e)+(t-nJ.PI/2+f)*s;let i=Math.sqrt(e*e+n*n);d.b=Math.cos(t)*i,d.d=Math.sin(t)*i}d.updateAppliedTransform()}}applyAbsoluteLocal(){let t=this.mixRotate,e=this.mixX,n=this.mixY,i=this.mixScaleX,r=this.mixScaleY,s=this.mixShearY,a=this.target,o=this.bones;for(let l=0,h=o.length;l<h;l++){let h=o[l],c=h.arotation;0!=t&&(c+=(a.arotation-c+this.data.offsetRotation)*t);let u=h.ax,d=h.ay;u+=(a.ax-u+this.data.offsetX)*e,d+=(a.ay-d+this.data.offsetY)*n;let p=h.ascaleX,f=h.ascaleY;0!=i&&0!=p&&(p=(p+(a.ascaleX-p+this.data.offsetScaleX)*i)/p),0!=r&&0!=f&&(f=(f+(a.ascaleY-f+this.data.offsetScaleY)*r)/f);let m=h.ashearY;0!=s&&(m+=(a.ashearY-m+this.data.offsetShearY)*s),h.updateWorldTransformWith(u,d,c,p,f,h.ashearX,m)}}applyRelativeLocal(){let t=this.mixRotate,e=this.mixX,n=this.mixY,i=this.mixScaleX,r=this.mixScaleY,s=this.mixShearY,a=this.target,o=this.bones;for(let l=0,h=o.length;l<h;l++){let h=o[l],c=h.arotation+(a.arotation+this.data.offsetRotation)*t,u=h.ax+(a.ax+this.data.offsetX)*e,d=h.ay+(a.ay+this.data.offsetY)*n,p=h.ascaleX*((a.ascaleX-1+this.data.offsetScaleX)*i+1),f=h.ascaleY*((a.ascaleY-1+this.data.offsetScaleY)*r+1),m=h.ashearY+(a.ashearY+this.data.offsetShearY)*s;h.updateWorldTransformWith(u,d,c,p,f,h.ashearX,m)}}}const hQ=class t{constructor(t){if(n(this,"data"),n(this,"bones"),n(this,"slots"),n(this,"drawOrder"),n(this,"ikConstraints"),n(this,"transformConstraints"),n(this,"pathConstraints"),n(this,"physicsConstraints"),n(this,"_updateCache",new Array),n(this,"skin",null),n(this,"color"),n(this,"scaleX",1),n(this,"_scaleY",1),n(this,"x",0),n(this,"y",0),n(this,"time",0),!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){let n,i=t.bones[e];if(i.parent){let t=this.bones[i.parent.index];n=new WZ(i,this,t),t.children.push(n)}else n=new WZ(i,this,null);this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){let n=t.slots[e],i=this.bones[n.boneData.index],r=new oQ(n,i);this.slots.push(r),this.drawOrder.push(r)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){let n=t.ikConstraints[e];this.ikConstraints.push(new KZ(n,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){let n=t.transformConstraints[e];this.transformConstraints.push(new lQ(n,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){let n=t.pathConstraints[e];this.pathConstraints.push(new sQ(n,this))}this.physicsConstraints=new Array;for(let e=0;e<t.physicsConstraints.length;e++){let n=t.physicsConstraints[e];this.physicsConstraints.push(new aQ(n,this))}this.color=new tJ(1,1,1,1),this.updateCache()}get scaleY(){return t.yDown?-this._scaleY:this._scaleY}set scaleY(t){this._scaleY=t}updateCache(){this._updateCache.length=0;let t=this.bones;for(let c=0,u=t.length;c<u;c++){let e=t[c];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(this.skin){let t=this.skin.bones;for(let e=0,n=this.skin.bones.length;e<n;e++){let n=this.bones[t[e].index];do{n.sorted=!1,n.active=!0,n=n.parent}while(n)}}let e=this.ikConstraints,n=this.transformConstraints,i=this.pathConstraints,r=this.physicsConstraints,s=e.length,a=n.length,o=i.length,l=this.physicsConstraints.length,h=s+a+o+l;t:for(let c=0;c<h;c++){for(let t=0;t<s;t++){let n=e[t];if(n.data.order==c){this.sortIkConstraint(n);continue t}}for(let t=0;t<a;t++){let e=n[t];if(e.data.order==c){this.sortTransformConstraint(e);continue t}}for(let t=0;t<o;t++){let e=i[t];if(e.data.order==c){this.sortPathConstraint(e);continue t}}for(let t=0;t<l;t++){const e=r[t];if(e.data.order==c){this.sortPhysicsConstraint(e);continue t}}}for(let c=0,u=t.length;c<u;c++)this.sortBone(t[c])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&rJ.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target;this.sortBone(e);let n=t.bones,i=n[0];if(this.sortBone(i),1==n.length)this._updateCache.push(t),this.sortReset(i.children);else{let e=n[n.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(i.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&rJ.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target,n=e.data.index,i=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,n,i),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,i);for(let o=0,l=this.data.skins.length;o<l;o++)this.sortPathConstraintAttachment(this.data.skins[o],n,i);let r=e.getAttachment();r instanceof UZ&&this.sortPathConstraintAttachmentWith(r,i);let s=t.bones,a=s.length;for(let o=0;o<a;o++)this.sortBone(s[o]);this._updateCache.push(t);for(let o=0;o<a;o++)this.sortReset(s[o].children);for(let o=0;o<a;o++)s[o].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&rJ.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);let e=t.bones,n=e.length;if(t.data.local)for(let i=0;i<n;i++){let t=e[i];this.sortBone(t.parent),this.sortBone(t)}else for(let i=0;i<n;i++)this.sortBone(e[i]);this._updateCache.push(t);for(let i=0;i<n;i++)this.sortReset(e[i].children);for(let i=0;i<n;i++)e[i].sorted=!0}sortPathConstraintAttachment(t,e,n){let i=t.attachments[e];if(i)for(let r in i)this.sortPathConstraintAttachmentWith(i[r],n)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof UZ))return;let n=t.bones;if(n){let t=this.bones;for(let e=0,i=n.length;e<i;){let i=n[e++];for(i+=e;e<i;)this.sortBone(t[n[e++]])}}else this.sortBone(e)}sortPhysicsConstraint(t){const e=t.bone;t.active=e.active&&(!t.data.skinRequired||null!=this.skin&&rJ.contains(this.skin.constraints,t.data,!0)),t.active&&(this.sortBone(e),this._updateCache.push(t),this.sortReset(e.children),e.sorted=!0)}sortBone(t){if(!t)return;if(t.sorted)return;let e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,n=t.length;e<n;e++){let n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}updateWorldTransform(t){if(null==t)throw new Error("physics is undefined");let e=this.bones;for(let i=0,r=e.length;i<r;i++){let t=e[i];t.ax=t.x,t.ay=t.y,t.arotation=t.rotation,t.ascaleX=t.scaleX,t.ascaleY=t.scaleY,t.ashearX=t.shearX,t.ashearY=t.shearY}let n=this._updateCache;for(let i=0,r=n.length;i<r;i++)n[i].update(t)}updateWorldTransformWith(t,e){let n=this.getRootBone();if(!n)throw new Error("Root bone must not be null.");let i=e.a,r=e.b,s=e.c,a=e.d;n.worldX=i*this.x+r*this.y+e.worldX,n.worldY=s*this.x+a*this.y+e.worldY;const o=(n.rotation+n.shearX)*nJ.degRad,l=(n.rotation+90+n.shearY)*nJ.degRad,h=Math.cos(o)*n.scaleX,c=Math.cos(l)*n.scaleY,u=Math.sin(o)*n.scaleX,d=Math.sin(l)*n.scaleY;n.a=(i*h+r*u)*this.scaleX,n.b=(i*c+r*d)*this.scaleX,n.c=(s*h+a*u)*this.scaleY,n.d=(s*c+a*d)*this.scaleY;let p=this._updateCache;for(let f=0,m=p.length;f<m;f++){let e=p[f];e!=n&&e.update(t)}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){for(const t of this.bones)t.setToSetupPose();for(const t of this.ikConstraints)t.setToSetupPose();for(const t of this.transformConstraints)t.setToSetupPose();for(const t of this.pathConstraints)t.setToSetupPose();for(const t of this.physicsConstraints)t.setToSetupPose()}setSlotsToSetupPose(){let t=this.slots;rJ.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,n=t.length;e<n;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(i.data.name==t)return i}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(i.data.name==t)return i}return null}setSkinByName(t){let e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{let e=this.slots;for(let n=0,i=e.length;n<i;n++){let i=e[n],r=i.data.attachmentName;if(r){let e=t.getAttachment(n,r);e&&i.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){let n=this.data.findSlot(t);if(!n)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(n.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){let n=this.skin.getAttachment(t,e);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");let n=this.slots;for(let i=0,r=n.length;i<r;i++){let r=n[i];if(r.data.name==t){let n=null;if(e&&(n=this.getAttachment(i,e),!n))throw new Error("Attachment not found: "+e+", for slot: "+t);return void r.setAttachment(n)}}throw new Error("Slot not found: "+t)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");return this.ikConstraints.find(e=>e.data.name==t)??null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");return this.transformConstraints.find(e=>e.data.name==t)??null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");return this.pathConstraints.find(e=>e.data.name==t)??null}findPhysicsConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");return this.physicsConstraints.find(e=>e.data.name==t)??null}getBoundsRect(){let t=new aJ,e=new aJ;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(e,n,i=new Array(2),r=null){if(!e)throw new Error("offset cannot be null.");if(!n)throw new Error("size cannot be null.");let s=this.drawOrder,a=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(let c=0,u=s.length;c<u;c++){let e=s[c];if(!e.bone.active)continue;let n=0,u=null,d=null,p=e.getAttachment();if(p instanceof zZ)n=8,u=rJ.setArraySize(i,n,0),p.computeWorldVertices(e,u,0,2),d=t.quadTriangles;else if(p instanceof LZ){let t=p;n=t.worldVerticesLength,u=rJ.setArraySize(i,n,0),t.computeWorldVertices(e,0,n,u,0,2),d=t.triangles}else if(p instanceof MZ&&null!=r){r.clipStart(e,p);continue}if(u&&d){null!=r&&r.isClipping()&&(r.clipTriangles(u,d,d.length),u=r.clippedVertices,n=r.clippedVertices.length);for(let t=0,e=u.length;t<e;t+=2){let e=u[t],n=u[t+1];a=Math.min(a,e),o=Math.min(o,n),l=Math.max(l,e),h=Math.max(h,n)}}null!=r&&r.clipEndWithSlot(e)}null!=r&&r.clipEnd(),e.set(a,o),n.set(l-a,h-o)}update(t){this.time+=t}physicsTranslate(t,e){const n=this.physicsConstraints;for(let i=0,r=n.length;i<r;i++)n[i].translate(t,e)}physicsRotate(t,e,n){const i=this.physicsConstraints;for(let r=0,s=i.length;r<s;r++)i[r].rotate(t,e,n)}};n(hQ,"quadTriangles",[0,1,2,2,3,0]),n(hQ,"yDown",!1);let cQ=hQ;var uQ,dQ,pQ,fQ;(dQ=uQ||(uQ={}))[dQ.none=0]="none",dQ[dQ.reset=1]="reset",dQ[dQ.update=2]="update",dQ[dQ.pose=3]="pose";class mQ extends jZ{constructor(t){super(t,0,!1),n(this,"_bone",null),n(this,"x",0),n(this,"y",0),n(this,"rotate",0),n(this,"scaleX",0),n(this,"shearX",0),n(this,"limit",0),n(this,"step",0),n(this,"inertia",0),n(this,"strength",0),n(this,"damping",0),n(this,"massInverse",0),n(this,"wind",0),n(this,"gravity",0),n(this,"mix",0),n(this,"inertiaGlobal",!1),n(this,"strengthGlobal",!1),n(this,"dampingGlobal",!1),n(this,"massGlobal",!1),n(this,"windGlobal",!1),n(this,"gravityGlobal",!1),n(this,"mixGlobal",!1)}set bone(t){this._bone=t}get bone(){if(this._bone)return this._bone;throw new Error("BoneData not set.")}}class gQ{constructor(){n(this,"name",null),n(this,"bones",new Array),n(this,"slots",new Array),n(this,"skins",new Array),n(this,"defaultSkin",null),n(this,"events",new Array),n(this,"animations",new Array),n(this,"ikConstraints",new Array),n(this,"transformConstraints",new Array),n(this,"pathConstraints",new Array),n(this,"physicsConstraints",new Array),n(this,"x",0),n(this,"y",0),n(this,"width",0),n(this,"height",0),n(this,"referenceScale",100),n(this,"version",null),n(this,"hash",null),n(this,"fps",0),n(this,"imagesPath",null),n(this,"audioPath",null)}findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(i.name==t)return i}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(i.name==t)return i}return null}findSkin(t){if(!t)throw new Error("skinName cannot be null.");let e=this.skins;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(i.name==t)return i}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");let e=this.events;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(i.name==t)return i}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");let e=this.animations;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(i.name==t)return i}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(i.name==t)return i}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(i.name==t)return i}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(i.name==t)return i}return null}findPhysicsConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.physicsConstraints;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(i.name==t)return i}return null}}class vQ{constructor(t=0,e,i){n(this,"slotIndex"),n(this,"name"),n(this,"attachment"),this.slotIndex=t,this.name=e,this.attachment=i}}class yQ{constructor(t){if(n(this,"name"),n(this,"attachments",new Array),n(this,"bones",Array()),n(this,"constraints",new Array),n(this,"color",new tJ(.99607843,.61960787,.30980393,1)),!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,n){if(!n)throw new Error("attachment cannot be null.");let i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=n}addSkin(t){for(let i=0;i<t.bones.length;i++){let e=t.bones[i],n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){n=!0;break}n||this.bones.push(e)}for(let i=0;i<t.constraints.length;i++){let e=t.constraints[i],n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){n=!0;break}n||this.constraints.push(e)}let e=t.getAttachments();for(let i=0;i<e.length;i++){var n=e[i];this.setAttachment(n.slotIndex,n.name,n.attachment)}}copySkin(t){for(let i=0;i<t.bones.length;i++){let e=t.bones[i],n=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){n=!0;break}n||this.bones.push(e)}for(let i=0;i<t.constraints.length;i++){let e=t.constraints[i],n=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){n=!0;break}n||this.constraints.push(e)}let e=t.getAttachments();for(let i=0;i<e.length;i++){var n=e[i];n.attachment&&(n.attachment instanceof LZ?(n.attachment=n.attachment.newLinkedMesh(),this.setAttachment(n.slotIndex,n.name,n.attachment)):(n.attachment=n.attachment.copy(),this.setAttachment(n.slotIndex,n.name,n.attachment)))}}getAttachment(t,e){let n=this.attachments[t];return n?n[e]:null}removeAttachment(t,e){let n=this.attachments[t];n&&delete n[e]}getAttachments(){let t=new Array;for(var e=0;e<this.attachments.length;e++){let n=this.attachments[e];if(n)for(let i in n){let r=n[i];r&&t.push(new vQ(e,i,r))}}return t}getAttachmentsForSlot(t,e){let n=this.attachments[t];if(n)for(let i in n){let r=n[i];r&&e.push(new vQ(t,i,r))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let n=0;for(let i=0;i<t.slots.length;i++){let r=t.slots[i],s=r.getAttachment();if(s&&n<e.attachments.length){let t=e.attachments[n];for(let e in t){if(s==t[e]){let t=this.getAttachment(n,e);t&&r.setAttachment(t);break}}}n++}}}class xQ{constructor(t,e,i){if(n(this,"index",0),n(this,"name"),n(this,"boneData"),n(this,"color",new tJ(1,1,1,1)),n(this,"darkColor",null),n(this,"attachmentName",null),n(this,"blendMode",pQ.Normal),n(this,"visible",!0),t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!i)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=i}}(fQ=pQ||(pQ={}))[fQ.Normal=0]="Normal",fQ[fQ.Additive=1]="Additive",fQ[fQ.Multiply=2]="Multiply",fQ[fQ.Screen=3]="Screen";class bQ extends jZ{constructor(t){super(t,0,!1),n(this,"bones",new Array),n(this,"_target",null),n(this,"mixRotate",0),n(this,"mixX",0),n(this,"mixY",0),n(this,"mixScaleX",0),n(this,"mixScaleY",0),n(this,"mixShearY",0),n(this,"offsetRotation",0),n(this,"offsetX",0),n(this,"offsetY",0),n(this,"offsetScaleX",0),n(this,"offsetScaleY",0),n(this,"offsetShearY",0),n(this,"relative",!1),n(this,"local",!1)}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class _Q{constructor(t){n(this,"scale",1),n(this,"attachmentLoader"),n(this,"linkedMeshes",new Array),this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,n=new gQ;n.name="";let i=new SQ(t),r=i.readInt32(),s=i.readInt32();n.hash=0==s&&0==r?null:s.toString(16)+r.toString(16),n.version=i.readString(),n.x=i.readFloat(),n.y=i.readFloat(),n.width=i.readFloat(),n.height=i.readFloat(),n.referenceScale=i.readFloat()*e;let a=i.readBoolean();a&&(n.fps=i.readFloat(),n.imagesPath=i.readString(),n.audioPath=i.readString());let o=0;o=i.readInt(!0);for(let h=0;h<o;h++){let t=i.readString();if(!t)throw new Error("String in string table must not be null.");i.strings.push(t)}o=i.readInt(!0);for(let h=0;h<o;h++){let t=i.readString();if(!t)throw new Error("Bone name must not be null.");let r=0==h?null:n.bones[i.readInt(!0)],s=new HZ(h,t,r);s.rotation=i.readFloat(),s.x=i.readFloat()*e,s.y=i.readFloat()*e,s.scaleX=i.readFloat(),s.scaleY=i.readFloat(),s.shearX=i.readFloat(),s.shearY=i.readFloat(),s.length=i.readFloat()*e,s.inherit=i.readByte(),s.skinRequired=i.readBoolean(),a&&(tJ.rgba8888ToColor(s.color,i.readInt32()),s.icon=i.readString()??void 0,s.visible=i.readBoolean()),n.bones.push(s)}o=i.readInt(!0);for(let h=0;h<o;h++){let t=i.readString();if(!t)throw new Error("Slot name must not be null.");let e=n.bones[i.readInt(!0)],r=new xQ(h,t,e);tJ.rgba8888ToColor(r.color,i.readInt32());let s=i.readInt32();-1!=s&&tJ.rgb888ToColor(r.darkColor=new tJ,s),r.attachmentName=i.readStringRef(),r.blendMode=i.readInt(!0),a&&(r.visible=i.readBoolean()),n.slots.push(r)}o=i.readInt(!0);for(let h,c=0;c<o;c++){let t=i.readString();if(!t)throw new Error("IK constraint data name must not be null.");let r=new JZ(t);r.order=i.readInt(!0),h=i.readInt(!0);for(let e=0;e<h;e++)r.bones.push(n.bones[i.readInt(!0)]);r.target=n.bones[i.readInt(!0)];let s=i.readByte();r.skinRequired=!!(1&s),r.bendDirection=2&s?1:-1,r.compress=!!(4&s),r.stretch=!!(8&s),r.uniform=!!(16&s),32&s&&(r.mix=64&s?i.readFloat():1),128&s&&(r.softness=i.readFloat()*e),n.ikConstraints.push(r)}o=i.readInt(!0);for(let h,c=0;c<o;c++){let t=i.readString();if(!t)throw new Error("Transform constraint data name must not be null.");let r=new bQ(t);r.order=i.readInt(!0),h=i.readInt(!0);for(let e=0;e<h;e++)r.bones.push(n.bones[i.readInt(!0)]);r.target=n.bones[i.readInt(!0)];let s=i.readByte();r.skinRequired=!!(1&s),r.local=!!(2&s),r.relative=!!(4&s),8&s&&(r.offsetRotation=i.readFloat()),16&s&&(r.offsetX=i.readFloat()*e),32&s&&(r.offsetY=i.readFloat()*e),64&s&&(r.offsetScaleX=i.readFloat()),128&s&&(r.offsetScaleY=i.readFloat()),s=i.readByte(),1&s&&(r.offsetShearY=i.readFloat()),2&s&&(r.mixRotate=i.readFloat()),4&s&&(r.mixX=i.readFloat()),8&s&&(r.mixY=i.readFloat()),16&s&&(r.mixScaleX=i.readFloat()),32&s&&(r.mixScaleY=i.readFloat()),64&s&&(r.mixShearY=i.readFloat()),n.transformConstraints.push(r)}o=i.readInt(!0);for(let h,c=0;c<o;c++){let t=i.readString();if(!t)throw new Error("Path constraint data name must not be null.");let r=new ZZ(t);r.order=i.readInt(!0),r.skinRequired=i.readBoolean(),h=i.readInt(!0);for(let e=0;e<h;e++)r.bones.push(n.bones[i.readInt(!0)]);r.target=n.slots[i.readInt(!0)];const s=i.readByte();r.positionMode=1&s,r.spacingMode=s>>1&3,r.rotateMode=s>>3&3,128&s&&(r.offsetRotation=i.readFloat()),r.position=i.readFloat(),r.positionMode==QZ.Fixed&&(r.position*=e),r.spacing=i.readFloat(),r.spacingMode!=tQ.Length&&r.spacingMode!=tQ.Fixed||(r.spacing*=e),r.mixRotate=i.readFloat(),r.mixX=i.readFloat(),r.mixY=i.readFloat(),n.pathConstraints.push(r)}o=i.readInt(!0);for(let h=0;h<o;h++){const t=i.readString();if(!t)throw new Error("Physics constraint data name must not be null.");const r=new mQ(t);r.order=i.readInt(!0),r.bone=n.bones[i.readInt(!0)];let s=i.readByte();r.skinRequired=!!(1&s),2&s&&(r.x=i.readFloat()),4&s&&(r.y=i.readFloat()),8&s&&(r.rotate=i.readFloat()),16&s&&(r.scaleX=i.readFloat()),32&s&&(r.shearX=i.readFloat()),r.limit=(64&s?i.readFloat():5e3)*e,r.step=1/i.readUnsignedByte(),r.inertia=i.readFloat(),r.strength=i.readFloat(),r.damping=i.readFloat(),r.massInverse=128&s?i.readFloat():1,r.wind=i.readFloat(),r.gravity=i.readFloat(),s=i.readByte(),1&s&&(r.inertiaGlobal=!0),2&s&&(r.strengthGlobal=!0),4&s&&(r.dampingGlobal=!0),8&s&&(r.massGlobal=!0),16&s&&(r.windGlobal=!0),32&s&&(r.gravityGlobal=!0),64&s&&(r.mixGlobal=!0),r.mix=128&s?i.readFloat():1,n.physicsConstraints.push(r)}let l=this.readSkin(i,n,!0,a);l&&(n.defaultSkin=l,n.skins.push(l));{let t=n.skins.length;for(rJ.setArraySize(n.skins,o=t+i.readInt(!0));t<o;t++){let e=this.readSkin(i,n,!1,a);if(!e)throw new Error("readSkin() should not have returned null.");n.skins[t]=e}}o=this.linkedMeshes.length;for(let h=0;h<o;h++){let t=this.linkedMeshes[h];const e=n.skins[t.skinIndex];if(!t.parent)throw new Error("Linked mesh parent must not be null");let i=e.getAttachment(t.slotIndex,t.parent);if(!i)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?i:t.mesh,t.mesh.setParentMesh(i),null!=t.mesh.region&&t.mesh.updateRegion()}this.linkedMeshes.length=0,o=i.readInt(!0);for(let h=0;h<o;h++){let t=i.readString();if(!t)throw new Error("Event data name must not be null");let e=new qZ(t);e.intValue=i.readInt(!1),e.floatValue=i.readFloat(),e.stringValue=i.readString(),e.audioPath=i.readString(),e.audioPath&&(e.volume=i.readFloat(),e.balance=i.readFloat()),n.events.push(e)}o=i.readInt(!0);for(let h=0;h<o;h++){let t=i.readString();if(!t)throw new Error("Animatio name must not be null.");n.animations.push(this.readAnimation(i,t,n))}return n}readSkin(t,e,n,i){let r=null,s=0;if(n){if(s=t.readInt(!0),0==s)return null;r=new yQ("default")}else{let n=t.readString();if(!n)throw new Error("Skin name must not be null.");r=new yQ(n),i&&tJ.rgba8888ToColor(r.color,t.readInt32()),r.bones.length=t.readInt(!0);for(let i=0,s=r.bones.length;i<s;i++)r.bones[i]=e.bones[t.readInt(!0)];for(let i=0,s=t.readInt(!0);i<s;i++)r.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let i=0,s=t.readInt(!0);i<s;i++)r.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let i=0,s=t.readInt(!0);i<s;i++)r.constraints.push(e.pathConstraints[t.readInt(!0)]);for(let i=0,s=t.readInt(!0);i<s;i++)r.constraints.push(e.physicsConstraints[t.readInt(!0)]);s=t.readInt(!0)}for(let a=0;a<s;a++){let n=t.readInt(!0);for(let s=0,a=t.readInt(!0);s<a;s++){let s=t.readStringRef();if(!s)throw new Error("Attachment name must not be null");let a=this.readAttachment(t,e,r,n,s,i);a&&r.setAttachment(n,s,a)}}return r}readAttachment(t,e,n,i,r,s){let a=this.scale,o=t.readByte();const l=8&o?t.readStringRef():r;if(!l)throw new Error("Attachment name must not be null");switch(7&o){case MQ.Region:{let e=16&o?t.readStringRef():null;const i=32&o?t.readInt32():4294967295,r=64&o?this.readSequence(t):null;let s=128&o?t.readFloat():0,h=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readFloat(),p=t.readFloat(),f=t.readFloat();e||(e=l);let m=this.attachmentLoader.newRegionAttachment(n,l,e,r);return m?(m.path=e,m.x=h*a,m.y=c*a,m.scaleX=u,m.scaleY=d,m.rotation=s,m.width=p*a,m.height=f*a,tJ.rgba8888ToColor(m.color,i),m.sequence=r,null==r&&m.updateRegion(),m):null}case MQ.BoundingBox:{let e=this.readVertices(t,!!(16&o)),i=s?t.readInt32():0,r=this.attachmentLoader.newBoundingBoxAttachment(n,l);return r?(r.worldVerticesLength=e.length,r.vertices=e.vertices,r.bones=e.bones,s&&tJ.rgba8888ToColor(r.color,i),r):null}case MQ.Mesh:{let e=16&o?t.readStringRef():l;const i=32&o?t.readInt32():4294967295,r=64&o?this.readSequence(t):null,h=t.readInt(!0),c=this.readVertices(t,!!(128&o)),u=this.readFloatArray(t,c.length,1),d=this.readShortArray(t,3*(c.length-h-2));let p=[],f=0,m=0;s&&(p=this.readShortArray(t,t.readInt(!0)),f=t.readFloat(),m=t.readFloat()),e||(e=l);let g=this.attachmentLoader.newMeshAttachment(n,l,e,r);return g?(g.path=e,tJ.rgba8888ToColor(g.color,i),g.bones=c.bones,g.vertices=c.vertices,g.worldVerticesLength=c.length,g.triangles=d,g.regionUVs=u,null==r&&g.updateRegion(),g.hullLength=h<<1,g.sequence=r,s&&(g.edges=p,g.width=f*a,g.height=m*a),g):null}case MQ.LinkedMesh:{const e=16&o?t.readStringRef():l;if(null==e)throw new Error("Path of linked mesh must not be null");const r=32&o?t.readInt32():4294967295,h=64&o?this.readSequence(t):null,c=!!(128&o),u=t.readInt(!0),d=t.readStringRef();let p=0,f=0;s&&(p=t.readFloat(),f=t.readFloat());let m=this.attachmentLoader.newMeshAttachment(n,l,e,h);return m?(m.path=e,tJ.rgba8888ToColor(m.color,r),m.sequence=h,s&&(m.width=p*a,m.height=f*a),this.linkedMeshes.push(new wQ(m,u,i,d,c)),m):null}case MQ.Path:{const e=!!(16&o),i=!!(32&o),r=this.readVertices(t,!!(64&o)),h=rJ.newArray(r.length/6,0);for(let n=0,s=h.length;n<s;n++)h[n]=t.readFloat()*a;const c=s?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(n,l);return u?(u.closed=e,u.constantSpeed=i,u.worldVerticesLength=r.length,u.vertices=r.vertices,u.bones=r.bones,u.lengths=h,s&&tJ.rgba8888ToColor(u.color,c),u):null}case MQ.Point:{const e=t.readFloat(),i=t.readFloat(),r=t.readFloat(),o=s?t.readInt32():0,h=this.attachmentLoader.newPointAttachment(n,l);return h?(h.x=i*a,h.y=r*a,h.rotation=e,s&&tJ.rgba8888ToColor(h.color,o),h):null}case MQ.Clipping:{const i=t.readInt(!0),r=this.readVertices(t,!!(16&o));let a=s?t.readInt32():0,h=this.attachmentLoader.newClippingAttachment(n,l);return h?(h.endSlot=e.slots[i],h.worldVerticesLength=r.length,h.vertices=r.vertices,h.bones=r.bones,s&&tJ.rgba8888ToColor(h.color,a),h):null}}return null}readSequence(t){let e=new uJ(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readVertices(t,e){const n=this.scale,i=t.readInt(!0),r=new TQ;if(r.length=i<<1,!e)return r.vertices=this.readFloatArray(t,r.length,n),r;let s=new Array,a=new Array;for(let o=0;o<i;o++){let e=t.readInt(!0);a.push(e);for(let i=0;i<e;i++)a.push(t.readInt(!0)),s.push(t.readFloat()*n),s.push(t.readFloat()*n),s.push(t.readFloat())}return r.vertices=rJ.toFloatArray(s),r.bones=a,r}readFloatArray(t,e,n){let i=new Array(e);if(1==n)for(let r=0;r<e;r++)i[r]=t.readFloat();else for(let r=0;r<e;r++)i[r]=t.readFloat()*n;return i}readShortArray(t,e){let n=new Array(e);for(let i=0;i<e;i++)n[i]=t.readInt(!0);return n}readAnimation(t,e,n){t.readInt(!0);let i=new Array,r=this.scale;for(let l=0,h=t.readInt(!0);l<h;l++){let e=t.readInt(!0);for(let n=0,r=t.readInt(!0);n<r;n++){let n=t.readByte(),r=t.readInt(!0),s=r-1;switch(n){case GQ:{let n=new GJ(r,e);for(let e=0;e<r;e++)n.setFrame(e,t.readFloat(),t.readStringRef());i.push(n);break}case HQ:{let n=t.readInt(!0),a=new LJ(r,n,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;for(let e=0,i=0;a.setFrame(e,o,l,h,c,u),e!=s;e++){let n=t.readFloat(),r=t.readUnsignedByte()/255,s=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255;switch(t.readByte()){case a$:a.setStepped(e);break;case o$:PQ(t,a,i++,e,0,o,n,l,r,1),PQ(t,a,i++,e,1,o,n,h,s,1),PQ(t,a,i++,e,2,o,n,c,d,1),PQ(t,a,i++,e,3,o,n,u,p,1)}o=n,l=r,h=s,c=d,u=p}i.push(a);break}case VQ:{let n=t.readInt(!0),a=new UJ(r,n,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255;for(let e=0,i=0;a.setFrame(e,o,l,h,c),e!=s;e++){let n=t.readFloat(),r=t.readUnsignedByte()/255,s=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;switch(t.readByte()){case a$:a.setStepped(e);break;case o$:PQ(t,a,i++,e,0,o,n,l,r,1),PQ(t,a,i++,e,1,o,n,h,s,1),PQ(t,a,i++,e,2,o,n,c,u,1)}o=n,l=r,h=s,c=u}i.push(a);break}case XQ:{let n=t.readInt(!0),a=new NJ(r,n,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;for(let e=0,i=0;a.setFrame(e,o,l,h,c,u,d,p,f),e!=s;e++){let n=t.readFloat(),r=t.readUnsignedByte()/255,s=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255;switch(t.readByte()){case a$:a.setStepped(e);break;case o$:PQ(t,a,i++,e,0,o,n,l,r,1),PQ(t,a,i++,e,1,o,n,h,s,1),PQ(t,a,i++,e,2,o,n,c,m,1),PQ(t,a,i++,e,3,o,n,u,g,1),PQ(t,a,i++,e,4,o,n,d,v,1),PQ(t,a,i++,e,5,o,n,p,y,1),PQ(t,a,i++,e,6,o,n,f,x,1)}o=n,l=r,h=s,c=m,u=g,d=v,p=y,f=x}i.push(a);break}case WQ:{let n=t.readInt(!0),a=new zJ(r,n,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255;for(let e=0,i=0;a.setFrame(e,o,l,h,c,u,d,p),e!=s;e++){let n=t.readFloat(),r=t.readUnsignedByte()/255,s=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255;switch(t.readByte()){case a$:a.setStepped(e);break;case o$:PQ(t,a,i++,e,0,o,n,l,r,1),PQ(t,a,i++,e,1,o,n,h,s,1),PQ(t,a,i++,e,2,o,n,c,f,1),PQ(t,a,i++,e,3,o,n,u,m,1),PQ(t,a,i++,e,4,o,n,d,g,1),PQ(t,a,i++,e,5,o,n,p,v,1)}o=n,l=r,h=s,c=f,u=m,d=g,p=v}i.push(a);break}case jQ:{let n=new kJ(r,t.readInt(!0),e),a=t.readFloat(),o=t.readUnsignedByte()/255;for(let e=0,i=0;n.setFrame(e,a,o),e!=s;e++){let r=t.readFloat(),s=t.readUnsignedByte()/255;switch(t.readByte()){case a$:n.setStepped(e);break;case o$:PQ(t,n,i++,e,0,a,r,o,s,1)}a=r,o=s}i.push(n)}}}}for(let l=0,h=t.readInt(!0);l<h;l++){let e=t.readInt(!0);for(let n=0,s=t.readInt(!0);n<s;n++){let n=t.readByte(),s=t.readInt(!0);if(n==zQ){let n=new FJ(s,e);for(let e=0;e<s;e++)n.setFrame(e,t.readFloat(),t.readByte());i.push(n);continue}let a=t.readInt(!0);switch(n){case RQ:i.push(EQ(t,new MJ(s,a,e),1));break;case IQ:i.push(CQ(t,new AJ(s,a,e),r));break;case OQ:i.push(EQ(t,new EJ(s,a,e),r));break;case DQ:i.push(EQ(t,new CJ(s,a,e),r));break;case BQ:i.push(CQ(t,new PJ(s,a,e),1));break;case FQ:i.push(EQ(t,new RJ(s,a,e),1));break;case LQ:i.push(EQ(t,new IJ(s,a,e),1));break;case UQ:i.push(CQ(t,new OJ(s,a,e),1));break;case kQ:i.push(EQ(t,new DJ(s,a,e),1));break;case NQ:i.push(EQ(t,new BJ(s,a,e),1))}}}for(let l=0,h=t.readInt(!0);l<h;l++){let e=t.readInt(!0),n=t.readInt(!0),s=n-1,a=new YJ(n,t.readInt(!0),e),o=t.readByte(),l=t.readFloat(),h=1&o?2&o?t.readFloat():1:0,c=4&o?t.readFloat()*r:0;for(let i=0,u=0;a.setFrame(i,l,h,c,8&o?1:-1,!!(16&o),!!(32&o)),i!=s;i++){o=t.readByte();const e=t.readFloat(),n=1&o?2&o?t.readFloat():1:0,s=4&o?t.readFloat()*r:0;64&o?a.setStepped(i):128&o&&(PQ(t,a,u++,i,0,l,e,h,n,1),PQ(t,a,u++,i,1,l,e,c,s,r)),l=e,h=n,c=s}i.push(a)}for(let l=0,h=t.readInt(!0);l<h;l++){let e=t.readInt(!0),n=t.readInt(!0),r=n-1,s=new qJ(n,t.readInt(!0),e),a=t.readFloat(),o=t.readFloat(),l=t.readFloat(),h=t.readFloat(),c=t.readFloat(),u=t.readFloat(),d=t.readFloat();for(let i=0,p=0;s.setFrame(i,a,o,l,h,c,u,d),i!=r;i++){let e=t.readFloat(),n=t.readFloat(),r=t.readFloat(),f=t.readFloat(),m=t.readFloat(),g=t.readFloat(),v=t.readFloat();switch(t.readByte()){case a$:s.setStepped(i);break;case o$:PQ(t,s,p++,i,0,a,e,o,n,1),PQ(t,s,p++,i,1,a,e,l,r,1),PQ(t,s,p++,i,2,a,e,h,f,1),PQ(t,s,p++,i,3,a,e,c,m,1),PQ(t,s,p++,i,4,a,e,u,g,1),PQ(t,s,p++,i,5,a,e,d,v,1)}a=e,o=n,l=r,h=f,c=m,u=g,d=v}i.push(s)}for(let l=0,h=t.readInt(!0);l<h;l++){let e=t.readInt(!0),s=n.pathConstraints[e];for(let n=0,a=t.readInt(!0);n<a;n++){const n=t.readByte(),a=t.readInt(!0),o=t.readInt(!0);switch(n){case KQ:i.push(EQ(t,new KJ(a,o,e),s.positionMode==QZ.Fixed?r:1));break;case JQ:i.push(EQ(t,new JJ(a,o,e),s.spacingMode==tQ.Length||s.spacingMode==tQ.Fixed?r:1));break;case ZQ:let n=new ZJ(a,o,e),l=t.readFloat(),h=t.readFloat(),c=t.readFloat(),u=t.readFloat();for(let e=0,i=0,r=n.getFrameCount()-1;n.setFrame(e,l,h,c,u),e!=r;e++){let r=t.readFloat(),s=t.readFloat(),a=t.readFloat(),o=t.readFloat();switch(t.readByte()){case a$:n.setStepped(e);break;case o$:PQ(t,n,i++,e,0,l,r,h,s,1),PQ(t,n,i++,e,1,l,r,c,a,1),PQ(t,n,i++,e,2,l,r,u,o,1)}l=r,h=s,c=a,u=o}i.push(n)}}}for(let l=0,h=t.readInt(!0);l<h;l++){const e=t.readInt(!0)-1;for(let n=0,r=t.readInt(!0);n<r;n++){const n=t.readByte(),r=t.readInt(!0);if(n==s$){const n=new oZ(r,e);for(let e=0;e<r;e++)n.setFrame(e,t.readFloat());i.push(n);continue}const s=t.readInt(!0);switch(n){case QQ:i.push(EQ(t,new $J(r,s,e),1));break;case $Q:i.push(EQ(t,new tZ(r,s,e),1));break;case t$:i.push(EQ(t,new eZ(r,s,e),1));break;case e$:i.push(EQ(t,new nZ(r,s,e),1));break;case n$:i.push(EQ(t,new iZ(r,s,e),1));break;case i$:i.push(EQ(t,new rZ(r,s,e),1));break;case r$:i.push(EQ(t,new sZ(r,s,e),1))}}}for(let l=0,h=t.readInt(!0);l<h;l++){let e=n.skins[t.readInt(!0)];for(let n=0,s=t.readInt(!0);n<s;n++){let n=t.readInt(!0);for(let s=0,a=t.readInt(!0);s<a;s++){let s=t.readStringRef();if(!s)throw new Error("attachmentName must not be null.");let a=e.getAttachment(n,s),o=t.readByte(),l=t.readInt(!0),h=l-1;switch(o){case YQ:{let e=a,s=e.bones,o=e.vertices,c=s?o.length/3*2:o.length,u=t.readInt(!0),d=new HJ(l,u,n,e),p=t.readFloat();for(let n=0,i=0;;n++){let e,a=t.readInt(!0);if(0==a)e=s?rJ.newFloatArray(c):o;else{e=rJ.newFloatArray(c);let n=t.readInt(!0);if(a+=n,1==r)for(let i=n;i<a;i++)e[i]=t.readFloat();else for(let i=n;i<a;i++)e[i]=t.readFloat()*r;if(!s)for(let t=0,i=e.length;t<i;t++)e[t]+=o[t]}if(d.setFrame(n,p,e),n==h)break;let l=t.readFloat();switch(t.readByte()){case a$:d.setStepped(n);break;case o$:PQ(t,d,i++,n,0,p,l,0,1,1)}p=l}i.push(d);break}case qQ:{let e=new hZ(l,n,a);for(let n=0;n<l;n++){let i=t.readFloat(),r=t.readInt32();e.setFrame(n,i,fJ[15&r],r>>4,t.readFloat())}i.push(e);break}}}}}let s=t.readInt(!0);if(s>0){let e=new jJ(s),r=n.slots.length;for(let n=0;n<s;n++){let i=t.readFloat(),s=t.readInt(!0),a=rJ.newArray(r,0);for(let t=r-1;t>=0;t--)a[t]=-1;let o=rJ.newArray(r-s,0),l=0,h=0;for(let e=0;e<s;e++){let e=t.readInt(!0);for(;l!=e;)o[h++]=l++;a[l+t.readInt(!0)]=l++}for(;l<r;)o[h++]=l++;for(let t=r-1;t>=0;t--)-1==a[t]&&(a[t]=o[--h]);e.setFrame(n,i,a)}i.push(e)}let a=t.readInt(!0);if(a>0){let e=new XJ(a);for(let i=0;i<a;i++){let r=t.readFloat(),s=n.events[t.readInt(!0)],a=new YZ(r,s);a.intValue=t.readInt(!1),a.floatValue=t.readFloat(),a.stringValue=t.readString(),null==a.stringValue&&(a.stringValue=s.stringValue),a.data.audioPath&&(a.volume=t.readFloat(),a.balance=t.readFloat()),e.setFrame(i,a)}i.push(e)}let o=0;for(let l=0,h=i.length;l<h;l++)o=Math.max(o,i[l].getDuration());return new mJ(e,i,o)}}class SQ{constructor(t,e=new Array,i=0,r=new DataView(t instanceof ArrayBuffer?t:t.buffer)){n(this,"strings"),n(this,"index"),n(this,"buffer"),this.strings=e,this.index=i,this.buffer=r}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){let t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){let t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),n=127&e;return 128&e&&(e=this.readByte(),n|=(127&e)<<7,128&e&&(e=this.readByte(),n|=(127&e)<<14,128&e&&(e=this.readByte(),n|=(127&e)<<21,128&e&&(e=this.readByte(),n|=(127&e)<<28)))),t?n:n>>>1^-(1&n)}readStringRef(){let t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let n=0;n<t;){let t=this.readUnsignedByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),n+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),n+=3;break;default:e+=String.fromCharCode(t),n++}}return e}readFloat(){let t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}let wQ=class{constructor(t,e,i,r,s){n(this,"parent"),n(this,"skinIndex"),n(this,"slotIndex"),n(this,"mesh"),n(this,"inheritTimeline"),this.mesh=t,this.skinIndex=e,this.slotIndex=i,this.parent=r,this.inheritTimeline=s}};class TQ{constructor(t=null,e=null,i=0){n(this,"bones"),n(this,"vertices"),n(this,"length"),this.bones=t,this.vertices=e,this.length=i}}var MQ,AQ;function EQ(t,e,n){let i=t.readFloat(),r=t.readFloat()*n;for(let s=0,a=0,o=e.getFrameCount()-1;e.setFrame(s,i,r),s!=o;s++){let o=t.readFloat(),l=t.readFloat()*n;switch(t.readByte()){case a$:e.setStepped(s);break;case o$:PQ(t,e,a++,s,0,i,o,r,l,n)}i=o,r=l}return e}function CQ(t,e,n){let i=t.readFloat(),r=t.readFloat()*n,s=t.readFloat()*n;for(let a=0,o=0,l=e.getFrameCount()-1;e.setFrame(a,i,r,s),a!=l;a++){let l=t.readFloat(),h=t.readFloat()*n,c=t.readFloat()*n;switch(t.readByte()){case a$:e.setStepped(a);break;case o$:PQ(t,e,o++,a,0,i,l,r,h,n),PQ(t,e,o++,a,1,i,l,s,c,n)}i=l,r=h,s=c}return e}function PQ(t,e,n,i,r,s,a,o,l,h){e.setBezier(n,i,r,s,o,t.readFloat(),t.readFloat()*h,t.readFloat(),t.readFloat()*h,a,l)}(AQ=MQ||(MQ={}))[AQ.Region=0]="Region",AQ[AQ.BoundingBox=1]="BoundingBox",AQ[AQ.Mesh=2]="Mesh",AQ[AQ.LinkedMesh=3]="LinkedMesh",AQ[AQ.Path=4]="Path",AQ[AQ.Point=5]="Point",AQ[AQ.Clipping=6]="Clipping";const RQ=0,IQ=1,OQ=2,DQ=3,BQ=4,FQ=5,LQ=6,UQ=7,kQ=8,NQ=9,zQ=10,GQ=0,HQ=1,VQ=2,XQ=3,WQ=4,jQ=5,YQ=0,qQ=1,KQ=0,JQ=1,ZQ=2,QQ=0,$Q=1,t$=2,e$=4,n$=5,i$=6,r$=7,s$=8,a$=1,o$=2;class l${constructor(){n(this,"minX",0),n(this,"minY",0),n(this,"maxX",0),n(this,"maxY",0),n(this,"boundingBoxes",new Array),n(this,"polygons",new Array),n(this,"polygonPool",new sJ(()=>rJ.newFloatArray(16)))}update(t,e){if(!t)throw new Error("skeleton cannot be null.");let n=this.boundingBoxes,i=this.polygons,r=this.polygonPool,s=t.slots,a=s.length;n.length=0,r.freeAll(i),i.length=0;for(let o=0;o<a;o++){let t=s[o];if(!t.bone.active)continue;let e=t.getAttachment();if(e instanceof TZ){let s=e;n.push(s);let a=r.obtain();a.length!=s.worldVerticesLength&&(a=rJ.newFloatArray(s.worldVerticesLength)),i.push(a),s.computeWorldVertices(t,0,s.worldVerticesLength,a,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=this.polygons;for(let s=0,a=r.length;s<a;s++){let a=r[s],o=a;for(let r=0,s=a.length;r<s;r+=2){let s=o[r],a=o[r+1];t=Math.min(t,s),e=Math.min(e,a),n=Math.max(n,s),i=Math.max(i,a)}}this.minX=t,this.minY=e,this.maxX=n,this.maxY=i}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,n,i){let r=this.minX,s=this.minY,a=this.maxX,o=this.maxY;if(t<=r&&n<=r||e<=s&&i<=s||t>=a&&n>=a||e>=o&&i>=o)return!1;let l=(i-e)/(n-t),h=l*(r-t)+e;if(h>s&&h<o)return!0;if(h=l*(a-t)+e,h>s&&h<o)return!0;let c=(s-e)/l+t;return c>r&&c<a||(c=(o-e)/l+t,c>r&&c<a)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){let n=this.polygons;for(let i=0,r=n.length;i<r;i++)if(this.containsPointPolygon(n[i],t,e))return this.boundingBoxes[i];return null}containsPointPolygon(t,e,n){let i=t,r=t.length,s=r-2,a=!1;for(let o=0;o<r;o+=2){let t=i[o+1],r=i[s+1];if(t<n&&r>=n||r<n&&t>=n){let l=i[o];l+(n-t)/(r-t)*(i[s]-l)<e&&(a=!a)}s=o}return a}intersectsSegment(t,e,n,i){let r=this.polygons;for(let s=0,a=r.length;s<a;s++)if(this.intersectsSegmentPolygon(r[s],t,e,n,i))return this.boundingBoxes[s];return null}intersectsSegmentPolygon(t,e,n,i,r){let s=t,a=t.length,o=e-i,l=n-r,h=e*r-n*i,c=s[a-2],u=s[a-1];for(let d=0;d<a;d+=2){let t=s[d],a=s[d+1],p=c*a-u*t,f=c-t,m=u-a,g=o*m-l*f,v=(h*f-o*p)/g;if((v>=c&&v<=t||v>=t&&v<=c)&&(v>=e&&v<=i||v>=i&&v<=e)){let t=(h*m-l*p)/g;if((t>=u&&t<=a||t>=a&&t<=u)&&(t>=n&&t<=r||t>=r&&t<=n))return!0}c=t,u=a}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");let e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}class h${constructor(){n(this,"convexPolygons",new Array),n(this,"convexPolygonsIndices",new Array),n(this,"indicesArray",new Array),n(this,"isConcaveArray",new Array),n(this,"triangles",new Array),n(this,"polygonPool",new sJ(()=>new Array)),n(this,"polygonIndicesPool",new sJ(()=>new Array))}triangulate(t){let e=t,n=t.length>>1,i=this.indicesArray;i.length=0;for(let a=0;a<n;a++)i[a]=a;let r=this.isConcaveArray;r.length=0;for(let a=0,o=n;a<o;++a)r[a]=h$.isConcave(a,n,e,i);let s=this.triangles;for(s.length=0;n>3;){let t=n-1,a=0,o=1;for(;;){t:if(!r[a]){let s=i[t]<<1,l=i[a]<<1,h=i[o]<<1,c=e[s],u=e[s+1],d=e[l],p=e[l+1],f=e[h],m=e[h+1];for(let a=(o+1)%n;a!=t;a=(a+1)%n){if(!r[a])continue;let t=i[a]<<1,n=e[t],s=e[t+1];if(h$.positiveArea(f,m,c,u,n,s)&&h$.positiveArea(c,u,d,p,n,s)&&h$.positiveArea(d,p,f,m,n,s))break t}break}if(0==o){do{if(!r[a])break;a--}while(a>0);break}t=a,a=o,o=(o+1)%n}s.push(i[(n+a-1)%n]),s.push(i[a]),s.push(i[(a+1)%n]),i.splice(a,1),r.splice(a,1),n--;let l=(n+a-1)%n,h=a==n?0:a;r[l]=h$.isConcave(l,n,e,i),r[h]=h$.isConcave(h,n,e,i)}return 3==n&&(s.push(i[2]),s.push(i[0]),s.push(i[1])),s}decompose(t,e){let n=t,i=this.convexPolygons;this.polygonPool.freeAll(i),i.length=0;let r=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(r),r.length=0;let s=this.polygonIndicesPool.obtain();s.length=0;let a=this.polygonPool.obtain();a.length=0;let o=-1,l=0;for(let h=0,c=e.length;h<c;h+=3){let t=e[h]<<1,c=e[h+1]<<1,u=e[h+2]<<1,d=n[t],p=n[t+1],f=n[c],m=n[c+1],g=n[u],v=n[u+1],y=!1;if(o==t){let t=a.length-4,e=h$.winding(a[t],a[t+1],a[t+2],a[t+3],g,v),n=h$.winding(g,v,a[0],a[1],a[2],a[3]);e==l&&n==l&&(a.push(g),a.push(v),s.push(u),y=!0)}y||(a.length>0?(i.push(a),r.push(s)):(this.polygonPool.free(a),this.polygonIndicesPool.free(s)),a=this.polygonPool.obtain(),a.length=0,a.push(d),a.push(p),a.push(f),a.push(m),a.push(g),a.push(v),s=this.polygonIndicesPool.obtain(),s.length=0,s.push(t),s.push(c),s.push(u),l=h$.winding(d,p,f,m,g,v),o=t)}a.length>0&&(i.push(a),r.push(s));for(let h=0,c=i.length;h<c;h++){if(s=r[h],0==s.length)continue;let t=s[0],e=s[s.length-1];a=i[h];let n=a.length-4,o=a[n],l=a[n+1],u=a[n+2],d=a[n+3],p=a[0],f=a[1],m=a[2],g=a[3],v=h$.winding(o,l,u,d,p,f);for(let y=0;y<c;y++){if(y==h)continue;let n=r[y];if(3!=n.length)continue;let c=n[0],x=n[1],b=n[2],_=i[y],S=_[_.length-2],w=_[_.length-1];if(c!=t||x!=e)continue;let T=h$.winding(o,l,u,d,S,w),M=h$.winding(S,w,p,f,m,g);T==v&&M==v&&(_.length=0,n.length=0,a.push(S),a.push(w),s.push(b),o=u,l=d,u=S,d=w,y=0)}}for(let h=i.length-1;h>=0;h--)a=i[h],0==a.length&&(i.splice(h,1),this.polygonPool.free(a),s=r[h],r.splice(h,1),this.polygonIndicesPool.free(s));return i}static isConcave(t,e,n,i){let r=i[(e+t-1)%e]<<1,s=i[t]<<1,a=i[(t+1)%e]<<1;return!this.positiveArea(n[r],n[r+1],n[s],n[s+1],n[a],n[a+1])}static positiveArea(t,e,n,i,r,s){return t*(s-i)+n*(e-s)+r*(i-e)>=0}static winding(t,e,n,i,r,s){let a=n-t,o=i-e;return r*o-s*a+a*e-t*o>=0?1:-1}}class c${constructor(){n(this,"triangulator",new h$),n(this,"clippingPolygon",new Array),n(this,"clipOutput",new Array),n(this,"clippedVertices",new Array),n(this,"clippedUVs",new Array),n(this,"clippedTriangles",new Array),n(this,"scratch",new Array),n(this,"clipAttachment",null),n(this,"clippingPolygons",null)}clipStart(t,e){if(this.clipAttachment)return 0;this.clipAttachment=e;let n=e.worldVerticesLength,i=rJ.setArraySize(this.clippingPolygon,n);e.computeWorldVertices(t,0,n,i,0,2);let r=this.clippingPolygon;c$.makeClockwise(r);let s=this.clippingPolygons=this.triangulator.decompose(r,this.triangulator.triangulate(r));for(let a=0,o=s.length;a<o;a++){let t=s[a];c$.makeClockwise(t),t.push(t[0]),t.push(t[1])}return s.length}clipEndWithSlot(t){this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()}clipEnd(){this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}isClipping(){return null!=this.clipAttachment}clipTriangles(t,e,n,i,r,s,a,o){let l,h,c,u,d,p;"number"==typeof e?(l=n,h=i,c=r,u=s,d=a,p=o):(l=e,h=n,c=i,u=r,d=s,p=a),c&&u&&d&&"boolean"==typeof p?this.clipTrianglesRender(t,l,h,c,u,d,p):this.clipTrianglesNoRender(t,l,h)}clipTrianglesNoRender(t,e,n){let i=this.clipOutput,r=this.clippedVertices,s=this.clippedTriangles,a=this.clippingPolygons,o=a.length,l=0;r.length=0,s.length=0;for(let h=0;h<n;h+=3){let n=e[h]<<1,c=t[n],u=t[n+1];n=e[h+1]<<1;let d=t[n],p=t[n+1];n=e[h+2]<<1;let f=t[n],m=t[n+1];for(let t=0;t<o;t++){let e=r.length;if(!this.clip(c,u,d,p,f,m,a[t],i)){let t=rJ.setArraySize(r,e+6);t[e]=c,t[e+1]=u,t[e+2]=d,t[e+3]=p,t[e+4]=f,t[e+5]=m,e=s.length;let n=rJ.setArraySize(s,e+3);n[e]=l,n[e+1]=l+1,n[e+2]=l+2,l+=3;break}{let t=i.length;if(0==t)continue;let n=t>>1,a=this.clipOutput,o=rJ.setArraySize(r,e+2*n);for(let i=0;i<t;i+=2,e+=2){let t=a[i],n=a[i+1];o[e]=t,o[e+1]=n}e=s.length;let h=rJ.setArraySize(s,e+3*(n-2));n--;for(let i=1;i<n;i++,e+=3)h[e]=l,h[e+1]=l+i,h[e+2]=l+i+1;l+=n+1}}}}clipTrianglesRender(t,e,n,i,r,s,a){let o=this.clipOutput,l=this.clippedVertices,h=this.clippedTriangles,c=this.clippingPolygons,u=c.length,d=a?12:8,p=0;l.length=0,h.length=0;for(let f=0;f<n;f+=3){let n=e[f]<<1,m=t[n],g=t[n+1],v=i[n],y=i[n+1];n=e[f+1]<<1;let x=t[n],b=t[n+1],_=i[n],S=i[n+1];n=e[f+2]<<1;let w=t[n],T=t[n+1],M=i[n],A=i[n+1];for(let t=0;t<u;t++){let e=l.length;if(!this.clip(m,g,x,b,w,T,c[t],o)){let t=rJ.setArraySize(l,e+3*d);t[e]=m,t[e+1]=g,t[e+2]=r.r,t[e+3]=r.g,t[e+4]=r.b,t[e+5]=r.a,a?(t[e+6]=v,t[e+7]=y,t[e+8]=s.r,t[e+9]=s.g,t[e+10]=s.b,t[e+11]=s.a,t[e+12]=x,t[e+13]=b,t[e+14]=r.r,t[e+15]=r.g,t[e+16]=r.b,t[e+17]=r.a,t[e+18]=_,t[e+19]=S,t[e+20]=s.r,t[e+21]=s.g,t[e+22]=s.b,t[e+23]=s.a,t[e+24]=w,t[e+25]=T,t[e+26]=r.r,t[e+27]=r.g,t[e+28]=r.b,t[e+29]=r.a,t[e+30]=M,t[e+31]=A,t[e+32]=s.r,t[e+33]=s.g,t[e+34]=s.b,t[e+35]=s.a):(t[e+6]=v,t[e+7]=y,t[e+8]=x,t[e+9]=b,t[e+10]=r.r,t[e+11]=r.g,t[e+12]=r.b,t[e+13]=r.a,t[e+14]=_,t[e+15]=S,t[e+16]=w,t[e+17]=T,t[e+18]=r.r,t[e+19]=r.g,t[e+20]=r.b,t[e+21]=r.a,t[e+22]=M,t[e+23]=A),e=h.length;let n=rJ.setArraySize(h,e+3);n[e]=p,n[e+1]=p+1,n[e+2]=p+2,p+=3;break}{let t=o.length;if(0==t)continue;let n=b-T,i=w-x,c=m-w,u=T-g,f=1/(n*c+i*(g-T)),E=t>>1,C=this.clipOutput,P=rJ.setArraySize(l,e+E*d);for(let o=0;o<t;o+=2,e+=d){let t=C[o],l=C[o+1];P[e]=t,P[e+1]=l,P[e+2]=r.r,P[e+3]=r.g,P[e+4]=r.b,P[e+5]=r.a;let h=t-w,d=l-T,p=(n*h+i*d)*f,m=(u*h+c*d)*f,g=1-p-m;P[e+6]=v*p+_*m+M*g,P[e+7]=y*p+S*m+A*g,a&&(P[e+8]=s.r,P[e+9]=s.g,P[e+10]=s.b,P[e+11]=s.a)}e=h.length;let R=rJ.setArraySize(h,e+3*(E-2));E--;for(let r=1;r<E;r++,e+=3)R[e]=p,R[e+1]=p+r,R[e+2]=p+r+1;p+=E+1}}}}clipTrianglesUnpacked(t,e,n,i){let r=this.clipOutput,s=this.clippedVertices,a=this.clippedUVs,o=this.clippedTriangles,l=this.clippingPolygons,h=l.length,c=0;s.length=0,a.length=0,o.length=0;for(let u=0;u<n;u+=3){let n=e[u]<<1,d=t[n],p=t[n+1],f=i[n],m=i[n+1];n=e[u+1]<<1;let g=t[n],v=t[n+1],y=i[n],x=i[n+1];n=e[u+2]<<1;let b=t[n],_=t[n+1],S=i[n],w=i[n+1];for(let t=0;t<h;t++){let e=s.length;if(!this.clip(d,p,g,v,b,_,l[t],r)){let t=rJ.setArraySize(s,e+6);t[e]=d,t[e+1]=p,t[e+2]=g,t[e+3]=v,t[e+4]=b,t[e+5]=_;let n=rJ.setArraySize(a,e+6);n[e]=f,n[e+1]=m,n[e+2]=y,n[e+3]=x,n[e+4]=S,n[e+5]=w,e=o.length;let i=rJ.setArraySize(o,e+3);i[e]=c,i[e+1]=c+1,i[e+2]=c+2,c+=3;break}{let t=r.length;if(0==t)continue;let n=v-_,i=b-g,l=d-b,h=_-p,u=1/(n*l+i*(p-_)),T=t>>1,M=this.clipOutput,A=rJ.setArraySize(s,e+2*T),E=rJ.setArraySize(a,e+2*T);for(let r=0;r<t;r+=2,e+=2){let t=M[r],s=M[r+1];A[e]=t,A[e+1]=s;let a=t-b,o=s-_,c=(n*a+i*o)*u,d=(h*a+l*o)*u,p=1-c-d;E[e]=f*c+y*d+S*p,E[e+1]=m*c+x*d+w*p}e=o.length;let C=rJ.setArraySize(o,e+3*(T-2));T--;for(let r=1;r<T;r++,e+=3)C[e]=c,C[e+1]=c+r,C[e+2]=c+r+1;c+=T+1}}}}clip(t,e,n,i,r,s,a,o){let l,h=o,c=!1;a.length%4>=2?(l=o,o=this.scratch):l=this.scratch,l.length=0,l.push(t),l.push(e),l.push(n),l.push(i),l.push(r),l.push(s),l.push(t),l.push(e),o.length=0;let u=a.length-4,d=a;for(let p=0;;p+=2){let t=d[p],e=d[p+1],n=t-d[p+2],i=e-d[p+3],r=o.length,s=l;for(let h=0,u=l.length-2;h<u;){let r=s[h],a=s[h+1];h+=2;let l=s[h],u=s[h+1],d=i*(t-l)>n*(e-u),p=i*(t-r)-n*(e-a);if(p>0){if(d){o.push(l),o.push(u);continue}let t=l-r,e=u-a,s=p/(t*i-e*n);if(!(s>=0&&s<=1)){o.push(l),o.push(u);continue}o.push(r+t*s),o.push(a+e*s)}else if(d){let t=l-r,e=u-a,s=p/(t*i-e*n);if(!(s>=0&&s<=1)){o.push(l),o.push(u);continue}o.push(r+t*s),o.push(a+e*s),o.push(l),o.push(u)}c=!0}if(r==o.length)return h.length=0,!0;if(o.push(o[0]),o.push(o[1]),p==u)break;let a=o;(o=l).length=0,l=a}if(h!=o){h.length=0;for(let t=0,e=o.length-2;t<e;t++)h[t]=o[t]}else h.length=h.length-2;return c}static makeClockwise(t){let e=t,n=t.length,i=e[n-2]*e[1]-e[0]*e[n-1],r=0,s=0,a=0,o=0;for(let l=0,h=n-3;l<h;l+=2)r=e[l],s=e[l+1],a=e[l+2],o=e[l+3],i+=r*o-a*s;if(!(i<0))for(let l=0,h=n-2,c=n>>1;l<c;l+=2){let t=e[l],n=e[l+1],i=h-l;e[l]=e[i],e[l+1]=e[i+1],e[i]=t,e[i+1]=n}}}class u${constructor(t){n(this,"attachmentLoader"),n(this,"scale",1),n(this,"linkedMeshes",new Array),this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,n=new gQ,i="string"==typeof t?JSON.parse(t):t,r=i.skeleton;if(r&&(n.hash=r.hash,n.version=r.spine,n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height,n.referenceScale=g$(r,"referenceScale",100)*e,n.fps=r.fps,n.imagesPath=r.images??null,n.audioPath=r.audio??null),i.bones)for(let s=0;s<i.bones.length;s++){let t=i.bones[s],r=null,a=g$(t,"parent",null);a&&(r=n.findBone(a));let o=new HZ(n.bones.length,t.name,r);o.length=g$(t,"length",0)*e,o.x=g$(t,"x",0)*e,o.y=g$(t,"y",0)*e,o.rotation=g$(t,"rotation",0),o.scaleX=g$(t,"scaleX",1),o.scaleY=g$(t,"scaleY",1),o.shearX=g$(t,"shearX",0),o.shearY=g$(t,"shearY",0),o.inherit=rJ.enumValue(VZ,g$(t,"inherit","Normal")),o.skinRequired=g$(t,"skin",!1);let l=g$(t,"color",null);l&&o.color.setFromString(l),n.bones.push(o)}if(i.slots)for(let s=0;s<i.slots.length;s++){let t=i.slots[s],e=t.name,r=n.findBone(t.bone);if(!r)throw new Error(`Couldn't find bone ${t.bone} for slot ${e}`);let a=new xQ(n.slots.length,e,r),o=g$(t,"color",null);o&&a.color.setFromString(o);let l=g$(t,"dark",null);l&&(a.darkColor=tJ.fromString(l)),a.attachmentName=g$(t,"attachment",null),a.blendMode=rJ.enumValue(pQ,g$(t,"blend","normal")),a.visible=g$(t,"visible",!0),n.slots.push(a)}if(i.ik)for(let s=0;s<i.ik.length;s++){let t=i.ik[s],r=new JZ(t.name);r.order=g$(t,"order",0),r.skinRequired=g$(t,"skin",!1);for(let e=0;e<t.bones.length;e++){let i=n.findBone(t.bones[e]);if(!i)throw new Error(`Couldn't find bone ${t.bones[e]} for IK constraint ${t.name}.`);r.bones.push(i)}let a=n.findBone(t.target);if(!a)throw new Error(`Couldn't find target bone ${t.target} for IK constraint ${t.name}.`);r.target=a,r.mix=g$(t,"mix",1),r.softness=g$(t,"softness",0)*e,r.bendDirection=g$(t,"bendPositive",!0)?1:-1,r.compress=g$(t,"compress",!1),r.stretch=g$(t,"stretch",!1),r.uniform=g$(t,"uniform",!1),n.ikConstraints.push(r)}if(i.transform)for(let s=0;s<i.transform.length;s++){let t=i.transform[s],r=new bQ(t.name);r.order=g$(t,"order",0),r.skinRequired=g$(t,"skin",!1);for(let e=0;e<t.bones.length;e++){let i=t.bones[e],s=n.findBone(i);if(!s)throw new Error(`Couldn't find bone ${i} for transform constraint ${t.name}.`);r.bones.push(s)}let a=t.target,o=n.findBone(a);if(!o)throw new Error(`Couldn't find target bone ${a} for transform constraint ${t.name}.`);r.target=o,r.local=g$(t,"local",!1),r.relative=g$(t,"relative",!1),r.offsetRotation=g$(t,"rotation",0),r.offsetX=g$(t,"x",0)*e,r.offsetY=g$(t,"y",0)*e,r.offsetScaleX=g$(t,"scaleX",0),r.offsetScaleY=g$(t,"scaleY",0),r.offsetShearY=g$(t,"shearY",0),r.mixRotate=g$(t,"mixRotate",1),r.mixX=g$(t,"mixX",1),r.mixY=g$(t,"mixY",r.mixX),r.mixScaleX=g$(t,"mixScaleX",1),r.mixScaleY=g$(t,"mixScaleY",r.mixScaleX),r.mixShearY=g$(t,"mixShearY",1),n.transformConstraints.push(r)}if(i.path)for(let s=0;s<i.path.length;s++){let t=i.path[s],r=new ZZ(t.name);r.order=g$(t,"order",0),r.skinRequired=g$(t,"skin",!1);for(let e=0;e<t.bones.length;e++){let i=t.bones[e],s=n.findBone(i);if(!s)throw new Error(`Couldn't find bone ${i} for path constraint ${t.name}.`);r.bones.push(s)}let a=t.target,o=n.findSlot(a);if(!o)throw new Error(`Couldn't find target slot ${a} for path constraint ${t.name}.`);r.target=o,r.positionMode=rJ.enumValue(QZ,g$(t,"positionMode","Percent")),r.spacingMode=rJ.enumValue(tQ,g$(t,"spacingMode","Length")),r.rotateMode=rJ.enumValue(nQ,g$(t,"rotateMode","Tangent")),r.offsetRotation=g$(t,"rotation",0),r.position=g$(t,"position",0),r.positionMode==QZ.Fixed&&(r.position*=e),r.spacing=g$(t,"spacing",0),r.spacingMode!=tQ.Length&&r.spacingMode!=tQ.Fixed||(r.spacing*=e),r.mixRotate=g$(t,"mixRotate",1),r.mixX=g$(t,"mixX",1),r.mixY=g$(t,"mixY",r.mixX),n.pathConstraints.push(r)}if(i.physics)for(let s=0;s<i.physics.length;s++){const t=i.physics[s],r=new mQ(t.name);r.order=g$(t,"order",0),r.skinRequired=g$(t,"skin",!1);const a=t.bone,o=n.findBone(a);if(null==o)throw new Error("Physics bone not found: "+a);r.bone=o,r.x=g$(t,"x",0),r.y=g$(t,"y",0),r.rotate=g$(t,"rotate",0),r.scaleX=g$(t,"scaleX",0),r.shearX=g$(t,"shearX",0),r.limit=g$(t,"limit",5e3)*e,r.step=1/g$(t,"fps",60),r.inertia=g$(t,"inertia",1),r.strength=g$(t,"strength",100),r.damping=g$(t,"damping",1),r.massInverse=1/g$(t,"mass",1),r.wind=g$(t,"wind",0),r.gravity=g$(t,"gravity",0),r.mix=g$(t,"mix",1),r.inertiaGlobal=g$(t,"inertiaGlobal",!1),r.strengthGlobal=g$(t,"strengthGlobal",!1),r.dampingGlobal=g$(t,"dampingGlobal",!1),r.massGlobal=g$(t,"massGlobal",!1),r.windGlobal=g$(t,"windGlobal",!1),r.gravityGlobal=g$(t,"gravityGlobal",!1),r.mixGlobal=g$(t,"mixGlobal",!1),n.physicsConstraints.push(r)}if(i.skins)for(let s=0;s<i.skins.length;s++){let t=i.skins[s],e=new yQ(t.name);if(t.bones)for(let i=0;i<t.bones.length;i++){let r=t.bones[i],s=n.findBone(r);if(!s)throw new Error(`Couldn't find bone ${r} for skin ${t.name}.`);e.bones.push(s)}if(t.ik)for(let i=0;i<t.ik.length;i++){let r=t.ik[i],s=n.findIkConstraint(r);if(!s)throw new Error(`Couldn't find IK constraint ${r} for skin ${t.name}.`);e.constraints.push(s)}if(t.transform)for(let i=0;i<t.transform.length;i++){let r=t.transform[i],s=n.findTransformConstraint(r);if(!s)throw new Error(`Couldn't find transform constraint ${r} for skin ${t.name}.`);e.constraints.push(s)}if(t.path)for(let i=0;i<t.path.length;i++){let r=t.path[i],s=n.findPathConstraint(r);if(!s)throw new Error(`Couldn't find path constraint ${r} for skin ${t.name}.`);e.constraints.push(s)}if(t.physics)for(let i=0;i<t.physics.length;i++){let r=t.physics[i],s=n.findPhysicsConstraint(r);if(!s)throw new Error(`Couldn't find physics constraint ${r} for skin ${t.name}.`);e.constraints.push(s)}for(let i in t.attachments){let r=n.findSlot(i);if(!r)throw new Error(`Couldn't find slot ${i} for skin ${t.name}.`);let s=t.attachments[i];for(let t in s){let i=this.readAttachment(s[t],e,r.index,t,n);i&&e.setAttachment(r.index,t,i)}}n.skins.push(e),"default"==e.name&&(n.defaultSkin=e)}for(let s=0,a=this.linkedMeshes.length;s<a;s++){let t=this.linkedMeshes[s],e=t.skin?n.findSkin(t.skin):n.defaultSkin;if(!e)throw new Error(`Skin not found: ${t.skin}`);let i=e.getAttachment(t.slotIndex,t.parent);if(!i)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?i:t.mesh,t.mesh.setParentMesh(i),null!=t.mesh.region&&t.mesh.updateRegion()}if(this.linkedMeshes.length=0,i.events)for(let s in i.events){let t=i.events[s],e=new qZ(s);e.intValue=g$(t,"int",0),e.floatValue=g$(t,"float",0),e.stringValue=g$(t,"string",""),e.audioPath=g$(t,"audio",null),e.audioPath&&(e.volume=g$(t,"volume",1),e.balance=g$(t,"balance",0)),n.events.push(e)}if(i.animations)for(let s in i.animations){let t=i.animations[s];this.readAnimation(t,s,n)}return n}readAttachment(t,e,n,i,r){let s=this.scale;switch(i=g$(t,"name",i),g$(t,"type","region")){case"region":{let n=g$(t,"path",i),r=this.readSequence(g$(t,"sequence",null)),a=this.attachmentLoader.newRegionAttachment(e,i,n,r);if(!a)return null;a.path=n,a.x=g$(t,"x",0)*s,a.y=g$(t,"y",0)*s,a.scaleX=g$(t,"scaleX",1),a.scaleY=g$(t,"scaleY",1),a.rotation=g$(t,"rotation",0),a.width=t.width*s,a.height=t.height*s,a.sequence=r;let o=g$(t,"color",null);return o&&a.color.setFromString(o),null!=a.region&&a.updateRegion(),a}case"boundingbox":{let n=this.attachmentLoader.newBoundingBoxAttachment(e,i);if(!n)return null;this.readVertices(t,n,t.vertexCount<<1);let r=g$(t,"color",null);return r&&n.color.setFromString(r),n}case"mesh":case"linkedmesh":{let r=g$(t,"path",i),a=this.readSequence(g$(t,"sequence",null)),o=this.attachmentLoader.newMeshAttachment(e,i,r,a);if(!o)return null;o.path=r;let l=g$(t,"color",null);l&&o.color.setFromString(l),o.width=g$(t,"width",0)*s,o.height=g$(t,"height",0)*s,o.sequence=a;let h=g$(t,"parent",null);if(h)return this.linkedMeshes.push(new d$(o,g$(t,"skin",null),n,h,g$(t,"timelines",!0))),o;let c=t.uvs;return this.readVertices(t,o,c.length),o.triangles=t.triangles,o.regionUVs=c,null!=o.region&&o.updateRegion(),o.edges=g$(t,"edges",null),o.hullLength=2*g$(t,"hull",0),o}case"path":{let n=this.attachmentLoader.newPathAttachment(e,i);if(!n)return null;n.closed=g$(t,"closed",!1),n.constantSpeed=g$(t,"constantSpeed",!0);let r=t.vertexCount;this.readVertices(t,n,r<<1);let a=rJ.newArray(r/3,0);for(let e=0;e<t.lengths.length;e++)a[e]=t.lengths[e]*s;n.lengths=a;let o=g$(t,"color",null);return o&&n.color.setFromString(o),n}case"point":{let n=this.attachmentLoader.newPointAttachment(e,i);if(!n)return null;n.x=g$(t,"x",0)*s,n.y=g$(t,"y",0)*s,n.rotation=g$(t,"rotation",0);let r=g$(t,"color",null);return r&&n.color.setFromString(r),n}case"clipping":{let n=this.attachmentLoader.newClippingAttachment(e,i);if(!n)return null;let s=g$(t,"end",null);s&&(n.endSlot=r.findSlot(s));let a=t.vertexCount;this.readVertices(t,n,a<<1);let o=g$(t,"color",null);return o&&n.color.setFromString(o),n}}return null}readSequence(t){if(null==t)return null;let e=new uJ(g$(t,"count",0));return e.start=g$(t,"start",1),e.digits=g$(t,"digits",0),e.setupIndex=g$(t,"setup",0),e}readVertices(t,e,n){let i=this.scale;e.worldVerticesLength=n;let r=t.vertices;if(n==r.length){let t=rJ.toFloatArray(r);if(1!=i)for(let e=0,n=r.length;e<n;e++)t[e]*=i;return void(e.vertices=t)}let s=new Array,a=new Array;for(let o=0,l=r.length;o<l;){let t=r[o++];a.push(t);for(let e=o+4*t;o<e;o+=4)a.push(r[o]),s.push(r[o+1]*i),s.push(r[o+2]*i),s.push(r[o+3])}e.bones=a,e.vertices=rJ.toFloatArray(s)}readAnimation(t,e,n){let i=this.scale,r=new Array;if(t.slots)for(let a in t.slots){let e=t.slots[a],i=n.findSlot(a);if(!i)throw new Error("Slot not found: "+a);let s=i.index;for(let t in e){let n=e[t];if(!n)continue;let i=n.length;if("attachment"==t){let t=new GJ(i,s);for(let e=0;e<i;e++){let i=n[e];t.setFrame(e,g$(i,"time",0),g$(i,"name",null))}r.push(t)}else if("rgba"==t){let t=new LJ(i,i<<2,s),e=n[0],a=g$(e,"time",0),o=tJ.fromString(e.color);for(let i=0,r=0;;i++){t.setFrame(i,a,o.r,o.g,o.b,o.a);let s=n[i+1];if(!s){t.shrink(r);break}let l=g$(s,"time",0),h=tJ.fromString(s.color),c=e.curve;c&&(r=m$(c,t,r,i,0,a,l,o.r,h.r,1),r=m$(c,t,r,i,1,a,l,o.g,h.g,1),r=m$(c,t,r,i,2,a,l,o.b,h.b,1),r=m$(c,t,r,i,3,a,l,o.a,h.a,1)),a=l,o=h,e=s}r.push(t)}else if("rgb"==t){let t=new UJ(i,3*i,s),e=n[0],a=g$(e,"time",0),o=tJ.fromString(e.color);for(let i=0,r=0;;i++){t.setFrame(i,a,o.r,o.g,o.b);let s=n[i+1];if(!s){t.shrink(r);break}let l=g$(s,"time",0),h=tJ.fromString(s.color),c=e.curve;c&&(r=m$(c,t,r,i,0,a,l,o.r,h.r,1),r=m$(c,t,r,i,1,a,l,o.g,h.g,1),r=m$(c,t,r,i,2,a,l,o.b,h.b,1)),a=l,o=h,e=s}r.push(t)}else if("alpha"==t)r.push(p$(n,new kJ(i,i,s),0,1));else if("rgba2"==t){let t=new NJ(i,7*i,s),e=n[0],a=g$(e,"time",0),o=tJ.fromString(e.light),l=tJ.fromString(e.dark);for(let i=0,r=0;;i++){t.setFrame(i,a,o.r,o.g,o.b,o.a,l.r,l.g,l.b);let s=n[i+1];if(!s){t.shrink(r);break}let h=g$(s,"time",0),c=tJ.fromString(s.light),u=tJ.fromString(s.dark),d=e.curve;d&&(r=m$(d,t,r,i,0,a,h,o.r,c.r,1),r=m$(d,t,r,i,1,a,h,o.g,c.g,1),r=m$(d,t,r,i,2,a,h,o.b,c.b,1),r=m$(d,t,r,i,3,a,h,o.a,c.a,1),r=m$(d,t,r,i,4,a,h,l.r,u.r,1),r=m$(d,t,r,i,5,a,h,l.g,u.g,1),r=m$(d,t,r,i,6,a,h,l.b,u.b,1)),a=h,o=c,l=u,e=s}r.push(t)}else if("rgb2"==t){let t=new zJ(i,6*i,s),e=n[0],a=g$(e,"time",0),o=tJ.fromString(e.light),l=tJ.fromString(e.dark);for(let i=0,r=0;;i++){t.setFrame(i,a,o.r,o.g,o.b,l.r,l.g,l.b);let s=n[i+1];if(!s){t.shrink(r);break}let h=g$(s,"time",0),c=tJ.fromString(s.light),u=tJ.fromString(s.dark),d=e.curve;d&&(r=m$(d,t,r,i,0,a,h,o.r,c.r,1),r=m$(d,t,r,i,1,a,h,o.g,c.g,1),r=m$(d,t,r,i,2,a,h,o.b,c.b,1),r=m$(d,t,r,i,3,a,h,l.r,u.r,1),r=m$(d,t,r,i,4,a,h,l.g,u.g,1),r=m$(d,t,r,i,5,a,h,l.b,u.b,1)),a=h,o=c,l=u,e=s}r.push(t)}}}if(t.bones)for(let a in t.bones){let e=t.bones[a],s=n.findBone(a);if(!s)throw new Error("Bone not found: "+a);let o=s.index;for(let t in e){let n=e[t],a=n.length;if(0!=a)if("rotate"===t)r.push(p$(n,new MJ(a,a,o),0,1));else if("translate"===t){let t=new AJ(a,a<<1,o);r.push(f$(n,t,"x","y",0,i))}else if("translatex"===t){let t=new EJ(a,a,o);r.push(p$(n,t,0,i))}else if("translatey"===t){let t=new CJ(a,a,o);r.push(p$(n,t,0,i))}else if("scale"===t){let t=new PJ(a,a<<1,o);r.push(f$(n,t,"x","y",1,1))}else if("scalex"===t){let t=new RJ(a,a,o);r.push(p$(n,t,1,1))}else if("scaley"===t){let t=new IJ(a,a,o);r.push(p$(n,t,1,1))}else if("shear"===t){let t=new OJ(a,a<<1,o);r.push(f$(n,t,"x","y",0,1))}else if("shearx"===t){let t=new DJ(a,a,o);r.push(p$(n,t,0,1))}else if("sheary"===t){let t=new BJ(a,a,o);r.push(p$(n,t,0,1))}else if("inherit"===t){let t=new FJ(a,s.index);for(let e=0;e<n.length;e++){let i=n[e];t.setFrame(e,g$(i,"time",0),rJ.enumValue(VZ,g$(i,"inherit","Normal")))}r.push(t)}}}if(t.ik)for(let a in t.ik){let e=t.ik[a],s=e[0];if(!s)continue;let o=n.findIkConstraint(a);if(!o)throw new Error("IK Constraint not found: "+a);let l=n.ikConstraints.indexOf(o),h=new YJ(e.length,e.length<<1,l),c=g$(s,"time",0),u=g$(s,"mix",1),d=g$(s,"softness",0)*i;for(let t=0,n=0;;t++){h.setFrame(t,c,u,d,g$(s,"bendPositive",!0)?1:-1,g$(s,"compress",!1),g$(s,"stretch",!1));let r=e[t+1];if(!r){h.shrink(n);break}let a=g$(r,"time",0),o=g$(r,"mix",1),l=g$(r,"softness",0)*i,p=s.curve;p&&(n=m$(p,h,n,t,0,c,a,u,o,1),n=m$(p,h,n,t,1,c,a,d,l,i)),c=a,u=o,d=l,s=r}r.push(h)}if(t.transform)for(let a in t.transform){let e=t.transform[a],i=e[0];if(!i)continue;let s=n.findTransformConstraint(a);if(!s)throw new Error("Transform constraint not found: "+a);let o=n.transformConstraints.indexOf(s),l=new qJ(e.length,6*e.length,o),h=g$(i,"time",0),c=g$(i,"mixRotate",1),u=g$(i,"mixX",1),d=g$(i,"mixY",u),p=g$(i,"mixScaleX",1),f=g$(i,"mixScaleY",p),m=g$(i,"mixShearY",1);for(let t=0,n=0;;t++){l.setFrame(t,h,c,u,d,p,f,m);let r=e[t+1];if(!r){l.shrink(n);break}let s=g$(r,"time",0),a=g$(r,"mixRotate",1),o=g$(r,"mixX",1),g=g$(r,"mixY",o),v=g$(r,"mixScaleX",1),y=g$(r,"mixScaleY",v),x=g$(r,"mixShearY",1),b=i.curve;b&&(n=m$(b,l,n,t,0,h,s,c,a,1),n=m$(b,l,n,t,1,h,s,u,o,1),n=m$(b,l,n,t,2,h,s,d,g,1),n=m$(b,l,n,t,3,h,s,p,v,1),n=m$(b,l,n,t,4,h,s,f,y,1),n=m$(b,l,n,t,5,h,s,m,x,1)),h=s,c=a,u=o,d=g,p=v,f=y,p=v,i=r}r.push(l)}if(t.path)for(let a in t.path){let e=t.path[a],s=n.findPathConstraint(a);if(!s)throw new Error("Path constraint not found: "+a);let o=n.pathConstraints.indexOf(s);for(let t in e){let n=e[t],a=n[0];if(!a)continue;let l=n.length;if("position"===t){let t=new KJ(l,l,o);r.push(p$(n,t,0,s.positionMode==QZ.Fixed?i:1))}else if("spacing"===t){let t=new JJ(l,l,o);r.push(p$(n,t,0,s.spacingMode==tQ.Length||s.spacingMode==tQ.Fixed?i:1))}else if("mix"===t){let t=new ZJ(l,3*l,o),e=g$(a,"time",0),i=g$(a,"mixRotate",1),s=g$(a,"mixX",1),h=g$(a,"mixY",s);for(let r=0,o=0;;r++){t.setFrame(r,e,i,s,h);let l=n[r+1];if(!l){t.shrink(o);break}let c=g$(l,"time",0),u=g$(l,"mixRotate",1),d=g$(l,"mixX",1),p=g$(l,"mixY",d),f=a.curve;f&&(o=m$(f,t,o,r,0,e,c,i,u,1),o=m$(f,t,o,r,1,e,c,s,d,1),o=m$(f,t,o,r,2,e,c,h,p,1)),e=c,i=u,s=d,h=p,a=l}r.push(t)}}}if(t.physics)for(let a in t.physics){let e=t.physics[a],i=-1;if(a.length>0){let t=n.findPhysicsConstraint(a);if(!t)throw new Error("Physics constraint not found: "+a);i=n.physicsConstraints.indexOf(t)}for(let t in e){let n=e[t],s=n[0];if(!s)continue;let a,o=n.length;if("reset"==t){const t=new oZ(o,i);for(let e=0;null!=s;s=n[e+1],e++)t.setFrame(e,g$(s,"time",0));r.push(t);continue}if("inertia"==t)a=new $J(o,o,i);else if("strength"==t)a=new tZ(o,o,i);else if("damping"==t)a=new eZ(o,o,i);else if("mass"==t)a=new nZ(o,o,i);else if("wind"==t)a=new iZ(o,o,i);else if("gravity"==t)a=new rZ(o,o,i);else{if("mix"!=t)continue;a=new sZ(o,o,i)}r.push(p$(n,a,0,1))}}if(t.attachments)for(let a in t.attachments){let e=t.attachments[a],s=n.findSkin(a);if(!s)throw new Error("Skin not found: "+a);for(let t in e){let a=e[t],o=n.findSlot(t);if(!o)throw new Error("Slot not found: "+t);let l=o.index;for(let t in a){let e=a[t],n=s.getAttachment(l,t);for(let t in e){let s=e[t],a=s[0];if(a)if("deform"==t){let t=n.bones,e=n.vertices,o=t?e.length/3*2:e.length,h=new HJ(s.length,s.length,l,n),c=g$(a,"time",0);for(let n=0,r=0;;n++){let l,u=g$(a,"vertices",null);if(u){l=rJ.newFloatArray(o);let n=g$(a,"offset",0);if(rJ.arrayCopy(u,0,l,n,u.length),1!=i)for(let t=n,e=t+u.length;t<e;t++)l[t]*=i;if(!t)for(let t=0;t<o;t++)l[t]+=e[t]}else l=t?rJ.newFloatArray(o):e;h.setFrame(n,c,l);let d=s[n+1];if(!d){h.shrink(r);break}let p=g$(d,"time",0),f=a.curve;f&&(r=m$(f,h,r,n,0,c,p,0,1,1)),c=p,a=d}r.push(h)}else if("sequence"==t){let t=new hZ(s.length,l,n),e=0;for(let n=0;n<s.length;n++){let i=g$(a,"delay",e),r=g$(a,"time",0),o=dJ[g$(a,"mode","hold")],l=g$(a,"index",0);t.setFrame(n,r,o,l,i),e=i,a=s[n+1]}r.push(t)}}}}}if(t.drawOrder){let e=new jJ(t.drawOrder.length),i=n.slots.length,s=0;for(let r=0;r<t.drawOrder.length;r++,s++){let a=t.drawOrder[r],o=null,l=g$(a,"offsets",null);if(l){o=rJ.newArray(i,-1);let t=rJ.newArray(i-l.length,0),e=0,r=0;for(let i=0;i<l.length;i++){let s=l[i],a=n.findSlot(s.slot);if(!a)throw new Error("Slot not found: "+a);let h=a.index;for(;e!=h;)t[r++]=e++;o[e+s.offset]=e++}for(;e<i;)t[r++]=e++;for(let n=i-1;n>=0;n--)-1==o[n]&&(o[n]=t[--r])}e.setFrame(s,g$(a,"time",0),o)}r.push(e)}if(t.events){let e=new XJ(t.events.length),i=0;for(let r=0;r<t.events.length;r++,i++){let s=t.events[r],a=n.findEvent(s.name);if(!a)throw new Error("Event not found: "+s.name);let o=new YZ(rJ.toSinglePrecision(g$(s,"time",0)),a);o.intValue=g$(s,"int",a.intValue),o.floatValue=g$(s,"float",a.floatValue),o.stringValue=g$(s,"string",a.stringValue),o.data.audioPath&&(o.volume=g$(s,"volume",1),o.balance=g$(s,"balance",0)),e.setFrame(i,o)}r.push(e)}let s=0;for(let a=0,o=r.length;a<o;a++)s=Math.max(s,r[a].getDuration());n.animations.push(new mJ(e,r,s))}}class d${constructor(t,e,i,r,s){n(this,"parent"),n(this,"skin"),n(this,"slotIndex"),n(this,"mesh"),n(this,"inheritTimeline"),this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritTimeline=s}}function p$(t,e,n,i){let r=t[0],s=g$(r,"time",0),a=g$(r,"value",n)*i,o=0;for(let l=0;;l++){e.setFrame(l,s,a);let h=t[l+1];if(!h)return e.shrink(o),e;let c=g$(h,"time",0),u=g$(h,"value",n)*i;r.curve&&(o=m$(r.curve,e,o,l,0,s,c,a,u,i)),s=c,a=u,r=h}}function f$(t,e,n,i,r,s){let a=t[0],o=g$(a,"time",0),l=g$(a,n,r)*s,h=g$(a,i,r)*s,c=0;for(let u=0;;u++){e.setFrame(u,o,l,h);let d=t[u+1];if(!d)return e.shrink(c),e;let p=g$(d,"time",0),f=g$(d,n,r)*s,m=g$(d,i,r)*s,g=a.curve;g&&(c=m$(g,e,c,u,0,o,p,l,f,s),c=m$(g,e,c,u,1,o,p,h,m,s)),o=p,l=f,h=m,a=d}}function m$(t,e,n,i,r,s,a,o,l,h){if("stepped"==t)return e.setStepped(i),n;let c=r<<2,u=t[c],d=t[c+1]*h,p=t[c+2],f=t[c+3]*h;return e.setBezier(n,i,r,s,o,u,d,p,f,a,l),n+1}function g$(t,e,n){return void 0!==t[e]?t[e]:n}void 0===Math.fround&&(Math.fround=function(t){return function(e){return t[0]=e,t[0]}}(new Float32Array(1)));var v$=Object.defineProperty,y$=(t,e,n)=>(((t,e,n)=>{e in t?v$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const x$=class t extends AZ{constructor(t){super(t.resource),y$(this,"texture"),this.texture=ox.from(t)}static from(e){return t.textureMap.has(e)?t.textureMap.get(e):new t(e)}setFilters(e,n){const i=this.texture.source.style;i.minFilter=t.toPixiTextureFilter(e),i.magFilter=t.toPixiTextureFilter(n),this.texture.source.autoGenerateMipmaps=t.toPixiMipMap(e),this.texture.source.updateMipmaps()}setWraps(e,n){const i=this.texture.source.style;i.addressModeU=t.toPixiTextureWrap(e),i.addressModeV=t.toPixiTextureWrap(n)}dispose(){this.texture.destroy()}static toPixiMipMap(t){switch(t){case EZ.Nearest:case EZ.Linear:return!1;case EZ.MipMapNearestLinear:case EZ.MipMapNearestNearest:case EZ.MipMapLinearLinear:case EZ.MipMapLinearNearest:return!0;default:throw new Error(`Unknown texture filter: ${String(t)}`)}}static toPixiTextureFilter(t){switch(t){case EZ.Nearest:case EZ.MipMapNearestLinear:case EZ.MipMapNearestNearest:return"nearest";case EZ.Linear:case EZ.MipMapLinearLinear:case EZ.MipMapLinearNearest:return"linear";default:throw new Error(`Unknown texture filter: ${String(t)}`)}}static toPixiTextureWrap(t){switch(t){case PZ.ClampToEdge:return"clamp-to-edge";case PZ.MirroredRepeat:return"mirror-repeat";case PZ.Repeat:return"repeat";default:throw new Error(`Unknown texture wrap: ${String(t)}`)}}static toPixiBlending(t){switch(t){case pQ.Normal:return"normal";case pQ.Additive:return"add";case pQ.Multiply:return"multiply";case pQ.Screen:return"screen";default:throw new Error(`Unknown blendMode: ${String(t)}`)}}};y$(x$,"textureMap",new Map);let b$=x$;const _$={extension:fy.Asset,loader:{extension:{type:fy.LoadParser,priority:l_.Normal,name:"spineTextureAtlasLoader"},test:t=>VE(t,".atlas"),async load(t){const e=await Wb.get().fetch(t);return await e.text()},testParse(t,e){const n=VE(e.src,".atlas"),i="string"==typeof t;return Promise.resolve(n&&i)},unload(t){t.dispose()},async parse(t,e,n){const i=e.data||{};let r=u_.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");const s=new OZ(t);if(i.images instanceof ix||"string"==typeof i.images){const t=i.images;i.images={},i.images[s.pages[0].name]=t}const a=[];for(const o of s.pages){const t=o.name,e=(null==i?void 0:i.images)?i.images[t]:void 0;if(e instanceof ix)o.setTexture(b$.from(e));else{const s={src:e??u_.normalize([...r.split(u_.sep),t].join(u_.sep)),data:{...i.imageMetadata,alphaMode:o.pma?"premultiplied-alpha":"premultiply-alpha-on-upload"}},l=n.load(s).then(t=>{o.setTexture(b$.from(t.source))});a.push(l)}}return await Promise.all(a),s}}};vy.add(_$);const S$={extension:fy.Asset,loader:{extension:{type:fy.LoadParser,priority:l_.Normal,name:"spineSkeletonLoader"},test:t=>VE(t,".skel"),async load(t){const e=await Wb.get().fetch(t);return new Uint8Array(await e.arrayBuffer())},testParse(t,e){const n=VE(e.src,".json")&&(i=t,Object.prototype.hasOwnProperty.call(i,"bones"));var i;const r=VE(e.src,".skel")&&function(t){return t instanceof Uint8Array}(t);return Promise.resolve(n||r)}}};vy.add(S$);const w$=new Float32Array(1),T$=new Uint32Array(1);class M$ extends QT{constructor(){const t=new KT({data:w$,label:"attribute-batch-buffer",usage:qT.VERTEX|qT.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:28,offset:0},aUV:{buffer:t,format:"float32x2",stride:28,offset:8},aColor:{buffer:t,format:"unorm8x4",stride:28,offset:16},aDarkColor:{buffer:t,format:"unorm8x4",stride:28,offset:20},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:28,offset:24}},indexBuffer:new KT({data:T$,label:"index-batch-buffer",usage:qT.INDEX|qT.COPY_DST,shrinkToFit:!1})})}}const A$={name:"color-bit",vertex:{header:"\n            @in aDarkColor: vec4<f32>;\n            @out vDarkColor: vec4<f32>;\n        ",main:"\n        vDarkColor = aDarkColor;\n        "},fragment:{header:"\n            @in vDarkColor: vec4<f32>;\n        ",end:"\n            \n        let alpha = outColor.a * vColor.a;\n        let rgb = ((outColor.a - 1.0) * vDarkColor.a + 1.0 - outColor.rgb) * vDarkColor.rgb + outColor.rgb * vColor.rgb;\n\n        finalColor = vec4<f32>(rgb, alpha);\n\n        "}},E$={name:"color-bit",vertex:{header:"\n            in vec4 aDarkColor;\n            out vec4 vDarkColor;\n        ",main:"\n            vDarkColor = aDarkColor;\n        "},fragment:{header:"\n            in vec4 vDarkColor;\n        ",end:"\n            \n        finalColor.a = outColor.a * vColor.a;\n        finalColor.rgb = ((outColor.a - 1.0) * vDarkColor.a + 1.0 - outColor.rgb) * vDarkColor.rgb + outColor.rgb * vColor.rgb;\n        "}};class C$ extends ES{constructor(t){super({glProgram:MM({name:"dark-tint-batch",bits:[EM,E$,BM(t),LM]}),gpuProgram:TM({name:"dark-tint-batch",bits:[AM,A$,IM(t),FM]}),resources:{batchSamplers:kM(t)}})}}var P$=Object.defineProperty,R$=(t,e,n)=>(((t,e,n)=>{e in t?P$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);let I$=null;const O$=class t extends YT{constructor(){super(...arguments),R$(this,"geometry",new M$),R$(this,"shader",I$||(I$=new C$(this.maxTextures))),R$(this,"name",t.extension.name),R$(this,"vertexSize",7)}packAttributes(t,e,n,i,r){const s=r<<16|65535&t.roundPixels,a=t.transform,o=a.a,l=a.b,h=a.c,c=a.d,u=a.tx,d=a.ty,{positions:p,uvs:f}=t,m=t.color,g=(m>>24&255)/255,v=zx.shared.setValue(t.darkColor).premultiply(g,!0).toPremultiplied(1,!1),y=t.attributeOffset,x=y+t.attributeSize;for(let b=y;b<x;b++){const t=2*b,r=p[t],a=p[t+1];e[i++]=o*r+h*a+u,e[i++]=c*a+l*r+d,e[i++]=f[t],e[i++]=f[t+1],n[i++]=m,n[i++]=v,n[i++]=s}}packQuadAttributes(t,e,n,i,r){const s=t.texture,a=t.transform,o=a.a,l=a.b,h=a.c,c=a.d,u=a.tx,d=a.ty,p=t.bounds,f=p.maxX,m=p.minX,g=p.maxY,v=p.minY,y=s.uvs,x=t.color,b=t.darkColor,_=r<<16|65535&t.roundPixels;e[i+0]=o*m+h*v+u,e[i+1]=c*v+l*m+d,e[i+2]=y.x0,e[i+3]=y.y0,n[i+4]=x,n[i+5]=b,n[i+6]=_,e[i+7]=o*f+h*v+u,e[i+8]=c*v+l*f+d,e[i+9]=y.x1,e[i+10]=y.y1,n[i+11]=x,n[i+12]=b,n[i+13]=_,e[i+14]=o*f+h*g+u,e[i+15]=c*g+l*f+d,e[i+16]=y.x2,e[i+17]=y.y2,n[i+18]=x,n[i+19]=b,n[i+20]=_,e[i+21]=o*m+h*g+u,e[i+22]=c*g+l*m+d,e[i+23]=y.x3,e[i+24]=y.y3,n[i+25]=x,n[i+26]=b,n[i+27]=_}};R$(O$,"extension",{type:[fy.Batcher],name:"darkTint"});let D$=O$;vy.add(D$);var B$=Object.defineProperty,F$=(t,e,n)=>(((t,e,n)=>{e in t?B$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);class L${constructor(){F$(this,"indexOffset",0),F$(this,"attributeOffset",0),F$(this,"indexSize"),F$(this,"attributeSize"),F$(this,"batcherName","darkTint"),F$(this,"packAsQuad",!1),F$(this,"renderable"),F$(this,"positions"),F$(this,"indices"),F$(this,"uvs"),F$(this,"roundPixels"),F$(this,"data"),F$(this,"blendMode"),F$(this,"darkTint"),F$(this,"texture"),F$(this,"transform"),F$(this,"_textureId"),F$(this,"_attributeStart"),F$(this,"_indexStart"),F$(this,"_batcher"),F$(this,"_batch")}get color(){const t=this.data.color,e=this.renderable.groupColor,n=this.renderable.groupAlpha;let i;const r=t.a*n*255;if(16777215!==e){const n=e>>16&255,s=e>>8&255,a=255&e,o=t.r*a,l=t.g*s;i=r<<24|t.b*n<<16|l<<8|o}else i=r<<24|255*t.b<<16|255*t.g<<8|255*t.r;return i}get darkColor(){const t=this.data.darkColor;return 255*t.b<<16|255*t.g<<8|255*t.r}get groupTransform(){return this.renderable.groupTransform}setData(t,e,n,i){if(this.renderable=t,this.transform=t.groupTransform,this.data=e,e.clipped){const t=e.clippedData;this.indexSize=t.indicesCount,this.attributeSize=t.vertexCount,this.positions=t.vertices,this.indices=t.indices,this.uvs=t.uvs}else this.indexSize=e.indices.length,this.attributeSize=e.vertices.length/2,this.positions=e.vertices,this.indices=e.indices,this.uvs=e.uvs;this.texture=e.texture,this.roundPixels=i,this.blendMode=n,this.batcherName=e.darkTint?"darkTint":"default"}}var U$=Object.defineProperty,k$=(t,e,n)=>(((t,e,n)=>{e in t?U$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const N$=new c$,z$={0:"normal",1:"add",2:"multiply",3:"screen"};class G${constructor(t){k$(this,"renderer"),k$(this,"gpuSpineData",{}),this.renderer=t}validateRenderable(t){if(t._applyState(),t.spineAttachmentsDirty)return!0;if(t.spineTexturesDirty){const e=t.skeleton.drawOrder,n=this.gpuSpineData[t.uid];for(let i=0,r=e.length;i<r;i++){const r=e[i],s=r.getAttachment();if(s instanceof zZ||s instanceof LZ){const e=t._getCachedData(r,s),i=n.slotBatches[e.id],a=e.texture;if(a!==i.texture&&!i._batcher.checkAndUpdateTexture(i,a))return!0}}}return!1}addRenderable(t,e){var n,i,r,s;const a=(n=this.gpuSpineData)[i=t.uid]||(n[i]={slotBatches:{}}),o=this.renderer.renderPipes.batch,l=t.skeleton.drawOrder,h=this.renderer._roundPixels|t._roundPixels;t._applyState();for(let c=0,u=l.length;c<u;c++){const n=l[c],i=n.getAttachment(),u=z$[n.data.blendMode];if(i instanceof zZ||i instanceof LZ){const l=t._getCachedData(n,i),c=(r=a.slotBatches)[s=l.id]||(r[s]=new L$);c.setData(t,l,u,h),l.skipRender||o.addToBatch(c,e)}const d=t._slotsObject[n.data.name];if(d){const t=d.container;t.includeInBuild=!0,WL(t,e,this.renderer),t.includeInBuild=!1}}N$.clipEnd()}updateRenderable(t){var e;const n=this.gpuSpineData[t.uid];t._applyState();const i=t.skeleton.drawOrder;for(let r=0,s=i.length;r<s;r++){const s=i[r],a=s.getAttachment();if(a instanceof zZ||a instanceof LZ){if(!t._getCachedData(s,a).skipRender){const i=n.slotBatches[t._getCachedData(s,a).id];null==(e=i._batcher)||e.updateElement(i)}}}}destroyRenderable(t){this.gpuSpineData[t.uid]=null}destroy(){this.gpuSpineData=null,this.renderer=null}}k$(G$,"extension",{type:[fy.WebGLPipes,fy.WebGPUPipes,fy.CanvasPipes],name:"spine"}),vy.add(G$);var H$=Object.defineProperty,V$=(t,e,n)=>(((t,e,n)=>{e in t?H$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const X$=new aJ,W$=new tJ,j$=new tJ;cQ.yDown=!0;const Y$=new c$;let q$=class t extends Bb{constructor(t){t instanceof gQ&&(t={skeletonData:t}),super(),V$(this,"batched",!0),V$(this,"buildId",0),V$(this,"renderPipeId","spine"),V$(this,"_didSpineUpdate",!1),V$(this,"beforeUpdateWorldTransforms",()=>{}),V$(this,"afterUpdateWorldTransforms",()=>{}),V$(this,"skeleton"),V$(this,"state"),V$(this,"skeletonBounds"),V$(this,"_debug"),V$(this,"_slotsObject",Object.create(null)),V$(this,"spineAttachmentsDirty",!0),V$(this,"spineTexturesDirty",!0),V$(this,"_lastAttachments"),V$(this,"_stateChanged",!0),V$(this,"attachmentCacheData",[]),V$(this,"autoUpdateWarned",!1),V$(this,"_autoUpdate",!0);const e=t instanceof gQ?t:t.skeletonData;this.skeleton=new cQ(e),this.state=new uZ(new wZ(e)),this.autoUpdate=(null==t?void 0:t.autoUpdate)??!0;const n=this.skeleton.slots;for(let i=0;i<n.length;i++)this.attachmentCacheData[i]=Object.create(null);this._updateState(0)}getSlotFromRef(t){let e;if(e="number"==typeof t?this.skeleton.slots[t]:"string"==typeof t?this.skeleton.findSlot(t):t,!e)throw new Error(`No slot found with the given slot reference: ${t}`);return e}get debug(){return this._debug}set debug(t){this._debug&&this._debug.unregisterSpine(this),t&&t.registerSpine(this),this._debug=t}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t?(Qb.shared.add(this.internalUpdate,this),this.autoUpdateWarned=!1):Qb.shared.remove(this.internalUpdate,this),this._autoUpdate=t}update(t){this.autoUpdate&&!this.autoUpdateWarned&&(this.autoUpdateWarned=!0),this.internalUpdate(0,t)}internalUpdate(t,e){this._updateState(e??Qb.shared.deltaMS/1e3)}get bounds(){return this._boundsDirty&&this.updateBounds(),this._bounds}setBonePosition(t,e){const n=t;if("string"==typeof t&&(t=this.skeleton.findBone(t)),!t)throw Error(`Cant set bone position, bone ${String(n)} not found`);if(X$.set(e.x,e.y),t.parent){const e=t.parent.worldToLocal(X$);t.x=e.x,t.y=-e.y}else t.x=X$.x,t.y=X$.y}getBonePosition(t,e){return"string"==typeof t&&(t=this.skeleton.findBone(t)),t?(e||(e={x:0,y:0}),e.x=t.worldX,e.y=t.worldY,e):e}_updateState(t){this.state.update(t),this.skeleton.update(t),this._stateChanged=!0,this._boundsDirty=!0,this.onViewUpdate()}_applyState(){if(!this._stateChanged)return;this._stateChanged=!1;const{skeleton:t}=this;this.state.apply(t),this.beforeUpdateWorldTransforms(this),t.updateWorldTransform(uQ.update),this.afterUpdateWorldTransforms(this),this.validateAttachments(),this.transformAttachments(),this.updateSlotObjects()}validateAttachments(){const t=this.skeleton.drawOrder,e=this._lastAttachments||(this._lastAttachments=[]);let n=0,i=!1;for(let r=0;r<t.length;r++){const s=t[r].getAttachment();s&&(s!==e[n]&&(i=!0,e[n]=s),n++)}n!==e.length&&(i=!0,e.length=n),this.spineAttachmentsDirty=i}transformAttachments(){var t;const e=this.skeleton.drawOrder;for(let n=0;n<e.length;n++){const i=e[n],r=i.getAttachment();if(r)if(r instanceof LZ||r instanceof zZ){const e=this._getCachedData(i,r);r instanceof zZ?r.computeWorldVertices(i,e.vertices,0,2):r.computeWorldVertices(i,0,r.worldVerticesLength,e.vertices,0,2),e.uvs=r.uvs;const n=i.bone.skeleton.color,s=i.color,a=r.color;e.color.set(n.r*s.r*a.r,n.g*s.g*a.g,n.b*s.b*a.b,n.a*s.a*a.a),e.darkTint=!!i.darkColor,i.darkColor&&e.darkColor.setFromColor(i.darkColor),e.skipRender=e.clipped=!1;const o=(null==(t=r.region)?void 0:t.texture.texture)||ox.EMPTY;e.texture!==o&&(e.texture=o,this.spineTexturesDirty=!0),Y$.isClipping()&&this.updateClippingData(e)}else if(r instanceof MZ){Y$.clipStart(i,r);continue}Y$.clipEndWithSlot(i)}Y$.clipEnd()}updateClippingData(t){t.clipped=!0,Y$.clipTriangles(t.vertices,t.vertices.length,t.indices,t.indices.length,t.uvs,W$,j$,!1);const{clippedVertices:e,clippedTriangles:n}=Y$,i=e.length/8,r=n.length;t.clippedData||(t.clippedData={vertices:new Float32Array(2*i),uvs:new Float32Array(2*i),vertexCount:i,indices:new Uint16Array(r),indicesCount:r},this.spineAttachmentsDirty=!0);const s=t.clippedData,a=s.vertexCount!==i||r!==s.indicesCount;t.skipRender=0===i,a&&(this.spineAttachmentsDirty=!0,s.vertexCount<i&&(s.vertices=new Float32Array(2*i),s.uvs=new Float32Array(2*i)),s.indices.length<r&&(s.indices=new Uint16Array(r)));const{vertices:o,uvs:l,indices:h}=s;for(let c=0;c<i;c++)o[2*c]=e[8*c],o[2*c+1]=e[8*c+1],l[2*c]=e[8*c+6],l[2*c+1]=e[8*c+7];s.vertexCount=i;for(let c=0;c<h.length;c++)h[c]=n[c];s.indicesCount=r}updateSlotObjects(){for(const t in this._slotsObject){const e=this._slotsObject[t];e&&this.updateSlotObject(e)}}updateSlotObject(t){const{slot:e,container:n}=t;if(n.visible=this.skeleton.drawOrder.includes(e),n.visible){const t=e.bone;n.position.set(t.worldX,t.worldY),n.scale.x=t.getWorldScaleX(),n.scale.y=t.getWorldScaleY(),n.rotation=t.getWorldRotationX()*Ey}}_getCachedData(t,e){return this.attachmentCacheData[t.data.index][e.name]||this.initCachedData(t,e)}initCachedData(t,e){var n,i;let r;return e instanceof zZ?(r=new Float32Array(8),this.attachmentCacheData[t.data.index][e.name]={id:`${t.data.index}-${e.name}`,vertices:r,clipped:!1,indices:[0,1,2,0,2,3],uvs:e.uvs,color:new tJ(1,1,1,1),darkColor:new tJ(0,0,0,0),darkTint:!1,skipRender:!1,texture:null==(n=e.region)?void 0:n.texture.texture}):(r=new Float32Array(e.worldVerticesLength),this.attachmentCacheData[t.data.index][e.name]={id:`${t.data.index}-${e.name}`,vertices:r,clipped:!1,indices:e.triangles,uvs:e.uvs,color:new tJ(1,1,1,1),darkColor:new tJ(0,0,0,0),darkTint:!1,skipRender:!1,texture:null==(i=e.region)?void 0:i.texture.texture}),this.attachmentCacheData[t.data.index][e.name]}onViewUpdate(){var t;if(this._didChangeId+=4096,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const e=this.renderGroup||this.parentRenderGroup;e&&e.onChildViewUpdate(this),null==(t=this.debug)||t.renderDebug(this)}addSlotObject(t,e){var n;t=this.getSlotFromRef(t);for(const i in this._slotsObject)(null==(n=this._slotsObject[i])?void 0:n.container)===e&&this.removeSlotObject(this._slotsObject[i].slot);this.removeSlotObject(t),e.includeInBuild=!1,this.addChild(e),this._slotsObject[t.data.name]={container:e,slot:t},this.updateSlotObject(this._slotsObject[t.data.name])}removeSlotObject(t){var e,n;let i;if(t instanceof Db){for(const r in this._slotsObject)if((null==(e=this._slotsObject[r])?void 0:e.container)===t){this._slotsObject[r]=null,i=t;break}}else{const e=this.getSlotFromRef(t);i=null==(n=this._slotsObject[e.data.name])?void 0:n.container,this._slotsObject[e.data.name]=null}i&&(this.removeChild(i),i.includeInBuild=!0)}getSlotObject(t){return t=this.getSlotFromRef(t),this._slotsObject[t.data.name].container}updateBounds(){this._boundsDirty=!1,this.skeletonBounds||(this.skeletonBounds=new l$);const t=this.skeletonBounds;if(t.update(this.skeleton,!0),t.minX===1/0){this._applyState();const t=this.skeleton.drawOrder,e=this._bounds;e.clear();for(let n=0;n<t.length;n++){const i=t[n],r=i.getAttachment();if(r&&(r instanceof zZ||r instanceof LZ)){const t=this._getCachedData(i,r);e.addVertexData(t.vertices,0,t.vertices.length)}}}else this._bounds.minX=t.minX,this._bounds.minY=t.minY,this._bounds.maxX=t.maxX,this._bounds.maxY=t.maxY}addBounds(t){t.addBounds(this.bounds)}destroy(t=!1){super.destroy(t),Qb.shared.remove(this.internalUpdate,this),this.state.clearListeners(),this.debug=void 0,this.skeleton=null,this.state=null,this._slotsObject=null,this._lastAttachments=null,this.attachmentCacheData=null}skeletonToPixiWorldCoordinates(t){this.worldTransform.apply(t,t)}pixiWorldCoordinatesToSkeleton(t){this.worldTransform.applyInverse(t,t)}pixiWorldCoordinatesToBone(t,e){this.pixiWorldCoordinatesToSkeleton(t),e.parent?e.parent.worldToLocal(t):e.worldToLocal(t)}static from({skeleton:e,atlas:n,scale:i=1}){const r=`${e}-${n}-${i}`;if(i_.has(r))return new t(i_.get(r));const s=wC.get(e),a=wC.get(n),o=new GZ(a),l=s instanceof Uint8Array?new _Q(o):new u$(o);l.scale=i;const h=l.readSkeletonData(s);return i_.set(r,h),new t({skeletonData:h})}};const K$={image:{},animation:{},spine:{},atlas:{},lottie:{},video:{},uploadableImages:[],uploadableImagePlaceholders:{},optionals:{image:{},animation:{},spine:{},lottie:{},video:{}}},J$=[{name:"Main Scene",id:"be75e770-4268-4439-97a9-ae9d6051dd88",type:"2D",root:{id:"ROOT",name:"ROOT",children:[],type:"root",components:{}},settings:{physicsWorld2D:"",enablePhysics2D:!1}}],Z$={image:{},animation:{},spine:{},lottie:{},video:{}},Q$={image:[],animation:[],spine:[]},$$=[],t0={assets:K$,scenes:J$,objectMap:Z$,stuffs:Q$,prefabs:$$},e0=Object.freeze(Object.defineProperty({__proto__:null,assets:K$,default:t0,objectMap:Z$,prefabs:$$,scenes:J$,stuffs:Q$},Symbol.toStringTag,{value:"Module"})),n0=[],i0=Object.freeze(Object.defineProperty({__proto__:null,default:n0},Symbol.toStringTag,{value:"Module"})),r0=t0||e0;let s0=[];let a0=n0||i0;a0=a0.default||a0,a0.forEach(t=>{"spine"!==t.type&&"spritesheet"!==t.type&&"atlas"!==t.type||(t.json=JSON.parse(t.json))}),s0.push(...a0);let o0=o||l;o0=o0.default||o0,o0.forEach(t=>{"font"===t.type&&s0.push(t)});class l0{static addStuffsAssets(){if(r0.assets&&r0.assets.uploadableImages&&r0.assets.uploadableImages.forEach(t=>{const e=(null==t?void 0:t.uploadId)||t,n=window.app.data[e],i="___uploaded_"+e;n&&s0.push({type:"image",key:i,src:n})}),r0.assets&&r0.assets.uploadableVideos&&r0.assets.uploadableVideos.forEach(t=>{const e=(null==t?void 0:t.uploadId)||t,n=window.app.data[e],i="___uploaded_"+e;n&&s0.push({type:"video",key:i,src:n})}),window.app&&window.app.data.stuffsLoadList){const{image:t,animation:e,spine:n,lottie:i,video:r}=window.app.data.stuffsLoadList;!function(t,e,n,i,r){for(let s in t)t.hasOwnProperty(s)&&t[s]&&s0.push({type:"image",key:s,src:t[s]});for(let s in e){if(!e.hasOwnProperty(s))continue;if(!e[s])continue;const{imagePath:t,jsonPath:n}=e[s];s0.push({type:"spritesheet",key:s,src:t,json:n})}for(let s in n){if(!n.hasOwnProperty(s))continue;if(!n[s])continue;const{imagePath:t,jsonPath:e,atlasPath:i}=n[s];s0.push({type:"spine",key:s,src:t,json:e,atlas:i})}if(i)for(let s in i)i.hasOwnProperty(s)&&i[s]&&s0.push({type:"lottie",key:s,src:i[s]});if(r)for(let s in r)r.hasOwnProperty(s)&&r[s]&&s0.push({type:"video",key:s,src:r[s]})}(t,e,n,i,r)}}static addOptionalAssets(){if(window.app&&window.app.data.__optionalAssets){const{image:t,animation:e,spine:n}=window.app.data.__optionalAssets;for(let i in t)t[i]&&s0.push({type:"image",key:i,src:t[i]});for(let i in e){if(!e[i])continue;const{imagePath:t,jsonPath:n}=e[i];s0.push({type:"spritesheet",key:i,src:t,json:n})}for(let i in n){if(!n[i])continue;const{imagePath:t,jsonPath:e,atlasPath:r}=n[i];s0.push({type:"spine",key:i,src:t,json:e,atlas:r})}}}static getAssetsToLoad(){return s0}static getMappedAsset(t,e){var n;return r0.objectMap[t][e]||(null==(n=app.data.__stuffsExportMap)?void 0:n[e])}static getScenes(){return r0.scenes}static getSceneDataById(t){return r0.scenes.find(e=>e.id===t)}static getSceneDataByIndex(t){return r0.scenes[t]}static getSceneDataByName(t){return r0.scenes.find(e=>e.name===t)}static setLoadedAssets(t){this.assets=t}static getAssetById(t){return this.assets[t]}static getPrefab(t){let e=r0.prefabs.find(e=>e.id===t);return e||(e=r0.prefabs.find(e=>e.exportId===t)),e||(e=r0.prefabs.find(e=>e.name===t)),e}}n(l0,"assets");class h0{static decodeToBase64(t){t.startsWith("___base122___")&&(t=t.slice(13));var e=[0,10,13,34,38,92],n=new Uint8Array(1.75*t.length|0),i=0,r=0,s=0;function a(t){r|=(t<<=1)>>>s,(s+=7)>=8&&(n[i++]=r,r=t<<7-(s-=8)&255)}for(var o=0;o<t.length;o++){var l=t.charCodeAt(o);if(l>127){var h=l>>>8&7;7!=h&&a(e[h]),a(127&l)}else a(l)}s>0&&(n[i++]=r);var c=new Uint8Array(i);for(o=0;o<i;o++)c[o]=n[o];return function(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,r=0;r<i;r++)e+=String.fromCharCode(n[r]);return window.btoa(e)}(c.buffer)}static decode(t,e){return"data:"+e+";base64,"+this.decodeToBase64(t)}}"fb"===window.type&&wC.setPreferences({preferWorkers:!1});const c0={};class u0{static get(t){return c0[t]}static hasTexture(t){return void 0!==c0[t]||void 0!==c0[l0.getMappedAsset("image",t)]}static getTexture(t,e){let n=c0[t];if(!n){const e=l0.getMappedAsset("image",t);n=c0[e]}return n||ox.WHITE}static async getItemPath(t,e){return("image"===e||"animation"===e||"spine"===e)&&await wC.get(t),await wC.get(t)}static getTextureFromStuffs(t,e){let n=c0[t];if(!n){const e=l0.getMappedAsset("image",t);if(!e)return ox.EMPTY;n=c0[e]}return n}static getAnimation(t,e){let n=c0[t];if(!n){const e=l0.getMappedAsset("animation",t);n=c0[e]}return n}static getSpine(t,e){let n=c0[t];if(!n){const e=l0.getMappedAsset("spine",t);n=c0[e]}return n}static getLottie(t,e){let n=c0[t];if(!n){const e=l0.getMappedAsset("lottie",t);n=c0[e]}return n}static async getVideo(t,e,n,i){const r=t!==e;let s=c0[e];if(!s){const a=l0.getMappedAsset("video",e);s=c0[a]}if(r&&!s){let o=c0[t];if(!o){const c=l0.getMappedAsset("video",t);o=c0[c]}async function l(t){const e=await fetch(t),n=await e.blob();return URL.createObjectURL(n)}const h=await l(o.videoSrc);s=await u0.loadVideo(e,h)}return s}static load(t){return new Promise((e,n)=>{0===t.length&&e({});const i=t.length;let r=0;const s={},a=(t,n)=>{r++,s[t]=n,c0[t]=n,r===i&&e(s)};t.forEach(t=>{switch("base122"===t.encoding&&(t.src=h0.decode(t.src,t.mimeType)),t.type){case"image":this.loadImage(t.key,t.src).then(e=>{a(t.key,e)});break;case"spritesheet":this.loadAtlas(t.key,t.src,t.json,!0).then(e=>{a(t.key,e)});break;case"atlas":this.loadAtlas(t.key,t.src,t.json).then(e=>{a(t.key,e)});break;case"spine":this.loadSpine(t.key,t.src,t.json,t.atlas,t.additionalImages||[]).then(e=>{a(t.key,e)});break;case"lottie":this.loadLottie(t.key,t.src).then(e=>{a(t.key,e)});break;case"video":this.loadVideo(t.key,t.src).then(e=>{a(t.key,e)});break;case"font":this.loadFont(t.key,t.src).then(e=>{a(t.key,e)})}})})}static async loadImage(t,e){wC.add({alias:t,src:e});return await wC.load(t)}static async loadFont(t,e){return await wC.load({alias:"font",src:e,data:{family:t,weights:["normal","bold"]}})}static async loadVideo(t,e){return new Promise(async(n,i)=>{var r=document.createElement("video");/iPad|iPhone|iPod/.test(navigator.userAgent)&&(r.autoplay=!0),r.setAttribute("playsinline","playsinline"),r.addEventListener("canplay",async function(){wC.add({alias:t,src:e,loadParser:"loadVideo"});const i=await wC.load(t);i.videoSrc=e,n(i)}),r.src=e,r.muted=!0})}static async loadAtlas(t,e,n,i=!1){return new Promise(async(r,s)=>{if("string"==typeof n){wC.add({alias:t,src:n});const e=await wC.load(t);return void r(e)}wC.add({alias:`${t}_image`,src:e});const a=await wC.load(`${t}_image`);n.meta.image=e;const o=JSON.stringify(n),l=`data:application/json;base64,${btoa(o)}`;wC.add({alias:`${t}_json`,src:l});const h=await wC.load(l);h.textures&&(h.frames=h.textures[0].frames,h.textures=null);const c=new x_(a,h);c.parse().then(()=>{i?e6.spritesheets[t]=c:Object.values(c.textures).forEach(t=>{wC.cache.set(t.label,t),c0[t.label]=t}),r(c)})})}static async loadSpine(t,e,n,i,r){return new Promise(async(s,a)=>{var o;const l=`${t}Data`,h=`${t}Atlas`;if("string"==typeof n)return wC.add({alias:l,src:n}),wC.add({alias:h,src:i}),await wC.load([l,h]),void s({skeleton:l,atlas:h});wC.add({alias:`${t}`,src:e});const c=[t];null==r||r.forEach((e,n)=>{const i=`${t}_texture_${n+1}`;wC.add({alias:i,src:e}),c.push(i)}),await wC.load(c);const u=new Map,d=wC.cache.get(t),p=b$.from(d.source),f=null==(o=e.split("/").pop())?void 0:o.split(".")[0];f&&u.set(f,p),null==r||r.forEach((e,n)=>{var i,r;const s=`${t}_texture_${n+1}`,a=wC.cache.get(s),o=b$.from(a.source);let l;l="string"==typeof e?null==(i=e.split("/").pop())?void 0:i.split(".")[0]:e&&"object"==typeof e&&"name"in e?null==(r=e.name)?void 0:r.split(".")[0]:`texture_${n+1}`,l&&u.set(l,o)});const m=new OZ(i);m.regions.forEach(t=>{const e=t.page.name;if(e){const n=e.split(".")[0],i=u.get(n);if(i)t.texture=i,t.page.texture=i;else{const e=u.values().next().value;t.texture=e,t.page.texture=e}}else{const e=u.values().next().value;t.texture=e,t.page.texture=e}}),wC.cache.set(l,n),wC.cache.set(h,m),s({skeleton:l,atlas:h})})}static async loadLottie(t,e){return new Promise(async(t,n)=>{let i;e.startsWith("data:")&&(i=e),t(i)})}}class d0{static setMaskObjects(t){t.forEach(t=>{-1===this.maskObjects.indexOf(t)&&this.maskObjects.push(t)})}static addObject(t,e){const{id:n}=t;if(!n)throw new Error("Object ID is not set");this.objects.set(n,t),this.objectByScene.has(e)||this.objectByScene.set(e,[]),this.objectByScene.get(e).push(t),t.parentScene=e}static removeObject(t){if(!t)return;const e=this.objects.delete(t.id);if(e){const e=t.parentScene;this.objectByScene.get(e).splice(this.objectByScene.get(e).indexOf(t),1),t.parentScene=null,t.components.removeAll(),t.children&&t.children.forEach(t=>{this.removeObject(t)})}return e}static removeObjectById(t){this.removeObject(this.objects.get(t))}static getObjectById(t){return this.objects.get(t)}static getNodeByLabel(t,e){return this.getObjectByName(t,e)}static getNodesByLabel(t,e){let n=[];return n=e?this.objectByScene.get(e):Array.from(this.objects.values()),n.filter(e=>e.label===t)}static getObjectByName(t,e){if(e){const n=this.objectByScene.get(e);if(n)for(const e of n)if(e.label===t)return e}let n;return this.objects.forEach(e=>{e.label===t&&(n=e)}),n}static getObjectByType(t){for(const e of this.objects.values())if(e instanceof t)return e}static getObjectsByType(t){const e=[];for(const n of this.objects.values())n instanceof t&&e.push(n);return e}static getSceneObjects(t){return this.objectByScene.get(t)}static maskOfXObject(t){let e=0;return this.objects.forEach(n=>{n.mask&&n.mask===t&&e++}),e}static removeMaskObject(t){const e=this.maskObjects.indexOf(t);e>-1&&this.maskObjects.splice(e,1)}static getNodeById(t){return this.objects.get(t)}static getObjects(){return this.objects}static getMaskObjects(){return this.maskObjects}static resizeAll(){this.objects.forEach(t=>{if(t.components.responsive&&t.components.responsive.update(),"layout2D"===t.type){const e=t;e.updateLayoutComponent(e.getLayoutComponent())}})}static resizeDependents(t){const e=(this.objects instanceof Map?Array.from(this.objects.values()):Object.values(this.objects)).filter(e=>{if(!e.components.responsive)return!1;const n=e.components.responsive.componentData;if(n){const e=Object.values(n.resizes).find(t=>t.isActive);if(!e)return!1;const i=e[e.selected],{referenceBottom:r,referenceTop:s,referenceLeft:a,referenceRight:o}=i;if([r,s,a,o].includes(t))return!0}return!1});e&&0!==e.length&&e.forEach(t=>{t.components.responsive&&t.components.responsive.update(t.components.responsive.componentData)})}static update(t){this.objects.forEach(e=>{var n;null==(n=e.customUpdate)||n.call(e,t)})}}n(d0,"objects",new Map),n(d0,"maskObjects",[]),n(d0,"rootScene",null),n(d0,"objectByScene",new Map);let p0=class extends Fb{constructor({x:t=0,y:e=0,texture:i=""}){super({texture:u0.getTexture(i,t=>{this._setTextureFrame(t)}),x:t,y:e}),n(this,"type","sprite"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"textureData",{type:"texture",path:"",uploadId:"",stuffs:null,stuffsDataId:"",localPath:""}),n(this,"textureDataLandscape",{type:"texture",path:"",uploadId:"",stuffs:null,stuffsDataId:"",localPath:""}),n(this,"lanscapeEnabled",!1),this.initComponentSystem()}updateSpriteComponent(t){this.updateTextureData(t)}getSpriteComponent(){return{type:"sprite",texture:this.textureData,landscapeTexture:this.textureDataLandscape,landscape:this.lanscapeEnabled,tint:this.tint.toString(16)}}updateComponents(t){const e=t.sprite;e&&this.updateSpriteComponent(e),super.updateComponents(t)}preResize(){this.updateSpriteComponent(this.getSpriteComponent())}},f0=class extends Db{constructor(t=0,e=0){super({x:t,y:e}),n(this,"id",""),n(this,"type","container"),n(this,"debugRect",new MO),n(this,"selected",!1),n(this,"locked",!1),n(this,"containerComponent",{type:"container",debug:!1,width:0,height:0,landscape:!1,landscapeWidth:0,landscapeHeight:0}),n(this,"transformComponent",{}),this.initComponentSystem()}updateDebug(){}updateContainerComponent(t){this.transformComponent=this.components.get("transform");const{width:e,height:n,landscape:i,landscapeWidth:r,landscapeHeight:s}=t;this.containerComponent=t;const a=mN();i&&"landscape"===a?(this.baseWidth=r||e,this.baseHeight=s||n):(this.baseWidth=e,this.baseHeight=n),this.pivot.set(this.baseWidth*this.transformComponent.origin.x,this.baseHeight*this.transformComponent.origin.y),this.setOrigin(this.transformComponent.origin.x,this.transformComponent.origin.y),i&&this.children.forEach(t=>{t.components&&t.components.responsive&&t.components.responsive.update()}),this.updateDebug()}updateComponents(t){const e=t.container;e&&this.updateContainerComponent(e),super.updateComponents(t)}getContainerComponent(){return this.containerComponent}getGlobalScale(){let t={x:this.scale.x,y:this.scale.y},e=this.parent;for(;e;)t.x*=e.scale.x,t.y*=e.scale.y,e=e.parent;return t}getLocalScale(t){let e=this.getGlobalScale(),n={x:e.x,y:e.y},i=t;for(;i;)n.x/=i.scale.x,n.y/=i.scale.y,i=i.parent;return{x:n.x,y:n.y}}};class m0 extends PO{constructor(t,e="",i=!0,r=!1){const s=u0.getAnimation(t,t=>{this.changeAnimationTexture(t)});let a;if(s){const[t]=e?[e]:Object.keys(s.animations);a=s.animations[t]}else a=[ox.EMPTY];super(a),n(this,"type","animatedSprite"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"animationKey"),n(this,"animationTexture"),n(this,"autoplay"),n(this,"isAnimatedSprite",!0),this.initComponentSystem(),this.autoplay=i,this.loop=r,this.animationKey=e,this.animationTexture=t}changeAnimationTexture(t){const[e]=this.animationKey?[this.animationKey]:Object.keys(t.animations);this.textures=t.animations[e],this.baseWidth=this.texture.orig.width,this.baseHeight=this.texture.orig.height,this.components.responsive&&this.components.responsive.update()}playAnim(t,e=!1){e&&this.gotoAndStop(this.totalFrames-1),this.animationSpeed=(e?-1:1)*Math.abs(this.animationSpeed),t===this.animationKey?this.play():this.changeTextureAndPlay(this.animationTexture,t)}changeTextureAndPlay(t,e){this.animationKey=e;const n=()=>{this.autoplay?(this.gotoAndPlay(0),this.playAnim(this.animationKey)):this.stop()},i=u0.getAnimation(t,t=>{this.changeAnimationTexture(t),n()});i&&(this.changeAnimationTexture(i),n())}updateAnimatedSpriteComponent(t){this.animationSpeed=t.animationSpeed,this.loop=t.loop,this.autoplay=t.autoplay,this.changeTextureAndPlay(t.animationTexture,t.animation),this.tint=t.tint}getAnimatedSpriteComponent(){return{type:"animatedSprite",animationSpeed:this.animationSpeed,loop:this.loop,autoplay:this.autoplay,animation:this.animationKey,animationTexture:this.animationTexture,tint:"#FFFFFF"}}updateComponents(t){const e=t.animatedSprite;e&&this.updateAnimatedSpriteComponent(e),super.updateComponents(t)}}const g0={type:"texture",path:"",uploadId:"",stuffs:null,stuffsDataId:"",localPath:""};class v0 extends Db{constructor(t,e,i,r="",s=!0,a=!1){super({x:t,y:e}),n(this,"type","spine"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"spineTexture",""),n(this,"animation"),n(this,"animationSpeed",1),n(this,"autoplay"),n(this,"loop"),n(this,"spineObj"),this.initComponentSystem(),this.autoplay=s,this.loop=a,this.animation=r}updateSpineComponent(t){var e,n,i,r;if(this.animation=t.animation,this.timescale=t.animationSpeed,this.autoplay=t.autoplay,this.loop=t.loop,this.tint=t.tint||"#FFFFFF",!t.spineTexture)return this.spineTexture="",void(this.spineObj&&this.removeChild(this.spineObj));const s=t.skin||(null==(n=null==(e=this.spineObj)?void 0:e.skeleton.skin)?void 0:n.name)||(null==(r=null==(i=this.spineObj)?void 0:i.skeleton.data.skins[0])?void 0:r.name)||"";this.spineObj||this.setSpineData(t.spineTexture,e=>(this.setSkinByName(s),t.autoplay&&this.play(this.animation,this.loop),this.setTimeScale(t.animationSpeed),this))}updateHitArea(){var t;const e=null==(t=this.spineObj)?void 0:t.skeleton.data;this.hitArea=new Hy(null==e?void 0:e.x,-((null==e?void 0:e.y)??0)-((null==e?void 0:e.height)??0),(null==e?void 0:e.width)??0,(null==e?void 0:e.height)??0)}addSpineObj(t){this.spineObj&&this.removeChild(this.spineObj),this.spineObj=q$.from(t),this.addChild(this.spineObj),this.spineObj.state.data.defaultMix=.3,this.updateHitArea()}async loadSpineTexture(t){return new Promise(e=>{t===this.spineTexture&&e(!0),this.spineTexture=t,this.setSpineData(t,t=>{e(!0)})})}setSpineData(t,e){const n=u0.getSpine(t,t=>{this.addSpineObj(t),e(n)});n&&(this.addSpineObj(n),e(n))}getSpriteComponent(){return{type:"spine",spineTexture:this.spineTexture,skin:this.skin,animation:this.animation,animationSpeed:this.animationSpeed,loop:this.loop,autoplay:this.autoplay,tint:"#FFFFFF"}}updateComponents(t){const e=t.spine;e&&this.updateSpineComponent(e),super.updateComponents(t)}setSkinByName(t){var e;if(!this.spineObj)return;if(!t&&!(t=(null==(e=this.spineObj.skeleton.data.skins[0])?void 0:e.name)||""))return;this.spineObj.skeleton.setSkinByName(t),this.spineObj.skeleton.setSlotsToSetupPose();const n=this.spineObj.getLocalBounds().rectangle;return this.baseWidth=n.width,this.baseHeight=n.height,this}set skin(t){this.setSkinByName(t)}get skin(){var t,e;return(null==(e=null==(t=this.spineObj)?void 0:t.skeleton.skin)?void 0:e.name)||""}play(t,e,n=null,i){if(this.spineObj&&t){if(this.hasAnimation(t)){if(i){const e=this.spineObj.state.data.skeletonData.findAnimation(t);if(!e)return;{const n=(null==e?void 0:e.originalDuration)||(null==e?void 0:e.duration);if(!n)return;e.originalDuration=n,e.duration=n*i,this.spineObj.state.addListener({end:n=>{n.animation.name===t&&(e.duration=e.originalDuration)}})}}return this.spineObj.state.setAnimation(0,t,e),this.spineObj.state.tracks[0]&&n&&(this.spineObj.state.tracks[0].listener={complete:n}),this.loop=e,this}this.resetAnimation()}}playAnimation(t,e,n=null,i){return this.play(t,e,n,i)}addAnimation(t,e,n=null){if(this.spineObj&&t){if(this.hasAnimation(t))return this.spineObj.state.addAnimation(0,t,e,0),this.spineObj.state.tracks[0]&&n&&(this.spineObj.state.tracks[0].listener={complete:n}),this.loop=e,this;this.resetAnimation()}}resetAnimation(){this.spineObj&&(this.spineObj.state.clearTracks(),this.spineObj.state.setEmptyAnimation(0,0))}set timescale(t){this.spineObj&&(this.spineObj.state.timeScale=t)}get timescale(){var t;return(null==(t=this.spineObj)?void 0:t.state.timeScale)||1}setTimeScale(t){if(this.spineObj)return this.spineObj.state.timeScale=t,this}getAnimationList(){var t;return(null==(t=this.spineObj)?void 0:t.state.data.skeletonData.animations.map(t=>t.name))||[]}hasAnimation(t){return this.getAnimationList().includes(t)}replaceSlotTexture(t,e){if(!this.spineObj)return;const n=this.spineObj.skeleton.findSlot(t);if(!n)return;const i=n.getAttachment();if(!i)return;const r=b$.from(e.source),s=this._createTextureRegion(r,e),a=this._getAttachmentUpdateHandler(i);a&&(a(i,s,e),this.spineObj.skeleton.setSlotsToSetupPose())}_createTextureRegion(t,e){const n=new IZ;return n.texture=t,n.u=0,n.v=0,n.u2=1,n.v2=1,n.width=e.width,n.height=e.height,n.originalWidth=e.width,n.originalHeight=e.height,n.offsetX=0,n.offsetY=0,n}_getAttachmentUpdateHandler(t){return t instanceof zZ?this._updateRegionAttachment:t instanceof LZ?this._updateMeshAttachment:null}_updateRegionAttachment(t,e,n){t.region=e,t.width=n.width,t.height=n.height,t.updateRegion()}_updateMeshAttachment(t,e,n){t.region=e,t.updateRegion()}}let y0=class extends HO{constructor(t,e,i){super({}),n(this,"type","text"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"fontFamily","Arial"),n(this,"align","left"),n(this,"fontSize",26),n(this,"fill","#ffffff"),n(this,"lineHeight",0),n(this,"leading",0),n(this,"letterSpacing",0),n(this,"padding",0),n(this,"strokeColor","#000000"),n(this,"strokeThickness",0),n(this,"shadow",{enabled:!1,alpha:1,color:"#000000",blur:0,angle:0,distance:5}),n(this,"wordWrap",!1),n(this,"wordWrapWidth",100),n(this,"breakWords",!0),n(this,"autofit",!1),n(this,"autofitMultiline",!1),n(this,"autofitMaxFontSize",60),n(this,"autofitWidthRatio",80),n(this,"autofitHeightRatio",80),n(this,"gradientBoxDataObject",null),this.initComponentSystem(),this.text=i,this.x=t,this.y=e}setText(t){"string"==typeof t?this.text=t:(this.text=t.text,this.setTextStyles(t));const e=this.getLocalBounds();this.baseWidth=e.width,this.baseHeight=e.height,this.components.responsive&&this.components.responsive.update(this.components.get("responsive").data)}setFont(t){if("string"==typeof t){r6(window.app.data)[t]&&(this.style.fontFamily=t)}}updatePixiObject(){let{fontFamily:t}=this;"__global__"===t&&(t=xN());const e={fontFamily:t||"Arial",fontSize:this.fontSize,fill:"#ffffff  ",align:this.align,lineHeight:this.lineHeight,leading:this.leading,letterSpacing:this.letterSpacing,padding:this.padding,stroke:{width:this.strokeThickness,color:new zx(+this.strokeColor.replace("#","0x")),join:"round"},dropShadow:{alpha:this.shadow.alpha,color:new zx(+this.shadow.color.replace("#","0x")),blur:this.shadow.blur,angle:this.shadow.angle,distance:this.shadow.distance},wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,breakWords:this.breakWords};e.fill=this.convertToFillStyle(this.fill,this.fontSize,this.gradientBoxDataObject),this.shadow.enabled||delete e.dropShadow,this.style=new uE(e);const n=this.getLocalBounds();this.baseWidth=n.width,this.baseHeight=n.height,this.autofit&&this.fitText(),this.components.responsive&&this.components.responsive.update()}fitText(){if(this.scale.set(1),this.style.fontSize=this.autofitMaxFontSize,this.style.wordWrap=this.autofitMultiline,this.parent){const t=this.parent.baseWidth*(this.autofitWidthRatio/100),e=this.parent.baseHeight*(this.autofitHeightRatio/100);this.style.wordWrapWidth=t*(this.autofitWidthRatio/100);let n=this.autofitMaxFontSize;for(;n>10&&(this.style.fontSize=n,!(this.width<t&&this.height<e));)n-=2}}updateTextComponent(t){if(this.fontFamily=t.fontFamily,this.resolution=t.resolution,this.text=t.text,this.align=t.align,this.fontSize=t.fontSize,this.fill=t.fill,this.lineHeight=t.lineHeight,this.leading=t.leading,this.letterSpacing=t.letterSpacing,this.padding=t.padding,this.strokeColor=t.strokeColor,this.strokeThickness=t.strokeThickness,this.shadow=t.shadow,this.wordWrap=t.wordWrap,this.wordWrapWidth=t.wordWrapWidth,this.breakWords=t.breakWords,this.autofit=t.autofit,this.autofitMultiline=t.autofitMultiline,this.autofitMaxFontSize=t.autofitMaxFontSize,this.autofitWidthRatio=t.autofitWidthRatio,this.autofitHeightRatio=t.autofitHeightRatio,this.gradientBoxDataObject=t.gradientBoxDataObject,t.datajsID&&window.app.data[t.datajsID]){const e=window.app.data[t.datajsID];this.text=e.text,t.datajsColor&&(this.fill=e.color),t.datajsStroke&&(this.strokeColor=e.stroke.color,this.strokeThickness=e.stroke.thickness),t.datajsShadow&&(this.shadow={...this.shadow,...e.shadow}),t.datajsMultiline&&(this.lineHeight=e.multiline.lineHeight)}this.updatePixiObject()}getTextComponent(){return{type:"text",fontFamily:this.fontFamily,resolution:this.resolution,text:this.text,align:this.align,fontSize:this.fontSize,fill:this.fill,lineHeight:this.lineHeight,leading:this.leading,letterSpacing:this.letterSpacing,padding:this.padding,strokeColor:this.strokeColor,strokeThickness:this.strokeThickness,shadow:this.shadow,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,breakWords:this.breakWords,autofit:this.autofit,autofitMultiline:this.autofitMultiline,autofitMaxFontSize:this.autofitMaxFontSize,autofitWidthRatio:this.autofitWidthRatio,autofitHeightRatio:this.autofitHeightRatio,gradientBoxDataObject:this.gradientBoxDataObject}}updateComponents(t){const e=t.text;e&&this.updateTextComponent(e),super.updateComponents(t)}setTextStyles(t){let e={text:"text",color:"#ffffff",multiline:{enabled:!1,lineHeight:1.2},stroke:{color:"#000000",thickness:0},shadow:{color:"#000000",distance:0,blur:0,angle:0,alpha:0}};t&&(e={...e,...t});const n=this.style;n.fill=e.color,e.stroke&&(n.stroke={color:e.stroke.color,width:e.stroke.thickness,join:"round"}),e.shadow&&e.shadow.distance?(e.shadow.angle=e.shadow.angle*(180/Math.PI),n.dropShadow={...e.shadow}):n.dropShadow=!1,e.multiline&&e.multiline.enabled&&(n.lineHeight=e.multiline.lineHeight*n.fontSize),this.style=n}};class x0{constructor(t){n(this,"node"),n(this,"defaults",null),n(this,"enableMarketRedirection",!1),n(this,"dynamicResize",!1),n(this,"dynamicResizeName",""),n(this,"dynamicResizeInited",!1),n(this,"dynamicOffset",!1),n(this,"dynamicOffsetName",""),n(this,"dynamicOffsetInited",!1),n(this,"baseValues",{x:0,y:0,scaleX:1,scaleY:1}),this.node=t}redirectMarket(t){var e,n;null==(e=null==window?void 0:window.app)||e.main.gotoLink(),null==(n=null==t?void 0:t.stopPropagation)||n.call(t)}update(t){var e,n,i,r,s,a,o,l;if(t){if(this.node.x=(null==(e=null==t?void 0:t.position)?void 0:e.x)??0,this.node.y=(null==(n=null==t?void 0:t.position)?void 0:n.y)??0,this.node.setScale((null==(i=t.scale)?void 0:i.x)??1,(null==(r=t.scale)?void 0:r.y)??1),this.node.visible=!!t.visible,this.node.alpha=t.alpha??1,this.node.angle=t.angle??0,this.node.setOrigin((null==(s=t.origin)?void 0:s.x)??0,(null==(a=t.origin)?void 0:a.y)??0),this.node.setSkew((null==(o=t.skew)?void 0:o.x)??0,(null==(l=t.skew)?void 0:l.y)??0),this.node.zIndex=t.zIndex??0,this.node.label=t.label??"",this.node.blendMode=t.blendMode||"inherit",this.node.eventMode=t.eventMode||"passive",this.enableMarketRedirection=t.enableMarketRedirection||!1,this.updateBaseValues(),this.dynamicResize=t.dynamicResize||!1,this.dynamicResizeName=t.dynamicResizeName||"",this.dynamicOffset=t.dynamicOffset||!1,t.enableMarketRedirection){this.node.interactive=!0;const t="moloco"===(null==app?void 0:app.type)?"pointerup":"pointerdown";this.node.off(t,this.redirectMarket),this.node.on(t,this.redirectMarket)}this.defaults||(this.defaults=this.get())}}updateBaseValues(){this.baseValues={x:this.node.x,y:this.node.y,scaleX:this.node.scale.x,scaleY:this.node.scale.y}}get(){return{type:"node2D",label:this.node.label,visible:this.node.visible,alpha:this.node.alpha,position:{x:this.node.x,y:this.node.y},scale:{x:this.node.scale.x,y:this.node.scale.y},angle:this.node.angle,origin:{x:this.node.originX,y:this.node.originY},skew:{x:this.node.skewX,y:this.node.skewY},zIndex:this.node.zIndex,mask:null,invertAlpha:!1,eventMode:this.node.eventMode||"passive",blendMode:this.node.blendMode||"inherit",enableMarketRedirection:this.enableMarketRedirection||!1}}applyDynamicPosition(){if(this.dynamicResize&&!this.dynamicResizeInited){this.dynamicResizeInited=!0;["Enabled","PortraitEnabled","LandscapeEnabled","PortraitX","PortraitY","PortraitW","PortraitH","LandscapeX","LandscapeY","LandscapeW","LandscapeH"].forEach(t=>{const e=this.node.id+"_dynamic_"+t;window.addEventListener("pf_"+e,async n=>{app.data[e]=n.detail.value;const i={width:fN.width||app.globals.pixiWidth,height:fN.height||app.globals.pixiHeight};this.updateDynamicPosition(i.width,i.height),"Enabled"!==t||n.detail.value||this.node.components.resize(this.node.parent.baseWidth,this.node.parent.baseHeight)})})}}updateDynamicPosition(t,e){const n=this.node.id+"_dynamic_";if(app.data[n+"Enabled"]){const i=app.data[n+"LandscapeEnabled"],r=app.data[n+"PortraitX"],s=app.data[n+"PortraitY"],a=app.data[n+"PortraitW"],o=app.data[n+"PortraitH"],l=app.data[n+"LandscapeX"],h=app.data[n+"LandscapeY"],c=app.data[n+"LandscapeW"],u=app.data[n+"LandscapeH"];let d=r,p=s,f=a,m=o;t>e&&i&&(d=l,p=h,f=c,m=u);const g=f/100,v=m/100,y=Math.min(t*g/this.node.baseWidth,e*v/this.node.baseHeight);this.node.scale.set(y);const x=this.node.baseWidth*y,b=this.node.baseHeight*y;if(this.node.x=t*(d/100),d<50){const e=x*this.node.originX,n=.5*t;this.node.x=e+d/50*(n-e)}else{const e=.5*t,n=t-x*(1-this.node.originX);this.node.x=e+(d-50)/50*(n-e)}if(this.node.y=e*(p/100),p<50){const t=b*this.node.originY,n=.5*e;this.node.y=t+p/50*(n-t)}else{const t=.5*e,n=e-b*(1-this.node.originY);this.node.y=t+(p-50)/50*(n-t)}}}applyDynamicOffset(t,e){if(this.dynamicOffset&&(setTimeout(()=>{this.updateDynamicOffset(t,e)},1),!this.dynamicOffsetInited)){this.dynamicOffsetInited=!0;["LandscapeEnabled","PortraitX","PortraitY","PortraitScale","LandscapeX","LandscapeY","LandscapeScale"].forEach(t=>{const e=this.node.id+"_offset_"+t;window.addEventListener("pf_"+e,async t=>{var n,i;app.data[e]=t.detail.value,null==(i=(n=this.node).forceResize)||i.call(n)})})}}updateDynamicOffset(t,e){if(!this.dynamicOffset)return;this.dynamicOffsetInited||this.applyDynamicOffset(t,e);const{node:n}=this,i=this.node.id+"_offset_",r=app.data[i+"LandscapeEnabled"],s=app.data[i+"PortraitX"],a=app.data[i+"PortraitY"],o=app.data[i+"PortraitScale"],l=app.data[i+"LandscapeX"],h=app.data[i+"LandscapeY"],c=app.data[i+"LandscapeScale"];let u=s,d=a,p=o;t>e&&r&&(u=l,d=h,p=c),u=u||0,d=d||0,p=p||1,n.scaleX=this.baseValues.scaleX*p,n.scaleY=this.baseValues.scaleY*p,n.x=this.baseValues.x+n.baseWidth*n.scale.x*(u/100),n.y=this.baseValues.y+n.baseHeight*n.scale.y*(d/100)}}let b0=class{constructor(t){n(this,"node"),n(this,"componentData"),n(this,"defaults",null),this.node=t}update(t=this.componentData,e=!1){if(!t)return;if(this.componentData=t,!this.node.parent)return;this.defaults||(this.defaults=this.get().data||null);let n=null;if(t.resizes){let e=null;for(const n in t.resizes)if(Object.prototype.hasOwnProperty.call(t.resizes,n)){if(t.resizes[n].isActive){e=n;break}}n=t.resizes[e||Object.keys(t.resizes)[0]]}else n=t;const i=new Hy(0,0,this.node.baseWidth,this.node.baseHeight),r="landscape"===function(){const t=app.globals.projectConfig.generalSettings.lockScreen;return"portrait"===t||"landscape"===t?t:hN}()&&n.landscape.enabled?null==n?void 0:n.landscape:null==n?void 0:n.portrait;let s=0,a=0,o=1,l=1;if(r){const{fitType:t,height:h,horizontalSpace:c,horizontalSpaceUnit:u,origin:d,referenceBottom:p,referenceLeft:f,referenceRight:m,referenceTop:g,verticalSpace:v,verticalSpaceUnit:y,width:x}=r;let b=0,_=0,S=0,w=0;if(this.node.parent)if("root"===this.node.parent.label||this.node.parent.isScene){const t=this.node.parent;S=t.baseWidth,w=t.baseHeight}else if("editor_viewport"===this.node.parent.label){const t=this.node.parent;"portrait"===t.border.orientation?(S=t.border.device.width,w=t.border.device.height):(S=t.border.device.height,w=t.border.device.width)}else S=this.node.parent.baseWidth,w=this.node.parent.baseHeight;if(g){const t=d0.getNodeById(g);if(t){let{y:e}=t;if(null==t?void 0:t.components.responsive){const n=t.components.responsive.update(t.components.get("responsive").data,!0);n&&(e=n.y)}const n=new Hy(0,0,t.baseWidth,t.baseHeight);b=e+(1-t.originY)*n.height*t.scale.y}}if(p){const t=d0.getNodeById(p);if(t){let{y:e}=t;if(null==t?void 0:t.components.responsive){const n=t.components.responsive.update(t.components.get("responsive").data,!0);n&&(e=n.y)}const n=new Hy(0,0,t.baseWidth,t.baseHeight);w=e-t.originY*n.height*t.scale.y}}if(f){const t=d0.getNodeById(f);if(t){let{x:e}=t;if(null==t?void 0:t.components.responsive){const n=t.components.responsive.update(t.components.get("responsive").data,!0);n&&(e=n.x)}const n=new Hy(0,0,t.baseWidth,t.baseHeight);_=e+(1-t.originX)*n.width*t.scale.x}}if(m){const t=d0.getNodeById(m);if(t){let{x:e}=t;if(null==t?void 0:t.components.responsive){const n=t.components.responsive.update(t.components.get("responsive").data,!0);n&&(e=n.x)}const n=new Hy(0,0,t.baseWidth,t.baseHeight);S=e-t.originX*n.width*t.scale.x}}const T=S-_,M=w-b;let A=0,E=0;if("min"===t){const t=Math.min(T*x/100/i.width,M*h/100/i.height);A=t,E=t}else if("max"===t){const t=Math.max(T*x/100/i.width,M*h/100/i.height);A=t,E=t}else"stretch"===t&&(A=T*x/100/i.width,E=M*h/100/i.height);o=A,l=E,e||n.settings&&!n.settings.enableScale||this.node.scale.set(o,l);const C={"top-left":{x:0,y:0},"top-right":{x:T,y:0},top:{x:.5*T,y:0},"bottom-left":{x:0,y:M},"bottom-right":{x:T,y:M},bottom:{x:.5*T,y:M},left:{x:0,y:.5*M},right:{x:T,y:.5*M},center:{x:.5*T,y:.5*M}},{x:P,y:R}=C[d];s=P,a=R,s+=_,a+=b;let I=0,O=0;"%"===u?I=T*c*.01:"px"===u?I=c:"self"===u&&(I=i.width*c*.01*this.node.scale.x),s+=I,"%"===y?O=M*v*.01:"px"===y?O=v:"self"===y&&(O=i.height*v*.01*this.node.scale.y),a+=O}return e||(n.settings&&!n.settings.enablePosition||(this.node.x=s,this.node.y=a),this.node.components.transitionFX&&this.node.components.transitionFX.transitionFXs.forEach(t=>{t.getStart(),t.invalidate()}),this.node.id&&d0.resizeDependents(this.node.id)),{x:s,y:a,scale:{x:o,y:l}}}get(){return{type:"reponsive2D",label:this.node.label,data:this.componentData}}changeResizeByIndex(t,e={duration:.6,ease:"sine.inOut",onComplete:()=>{},onUpdate:()=>{},delay:0,repeat:0,yoyo:!1,repeatDelay:0}){if(!this.componentData)return;const{resizes:n}=this.get().data;if(!n)return;const i=Object.keys(n)[t];if(!i)return;const r=Object.values(n).find(t=>t.isActive);r&&(r.isActive=!1);const s=n[i];s&&(s.isActive=!0),this.componentData={...this.componentData,resizes:n};const a=()=>this.update(this.componentData,!0);let o=a(),l=null;o&&(l=QW.to(this.node,{x:()=>a().x,y:()=>a().y,scaleX:()=>a().scale.x,scaleY:()=>a().scale.y,duration:e.duration||.6,ease:e.ease||"sine.inOut",delay:e.delay||0,repeat:e.repeat||0,yoyo:e.yoyo||!1,repeatDelay:e.repeatDelay||0,onUpdate:()=>{this.node.id&&d0.resizeDependents(this.node.id),e.onUpdate&&e.onUpdate()},onComplete:()=>{l=null,e.onComplete&&e.onComplete()}}),this.node.onResizeCallback=()=>{l&&(r.isActive=!0,s.isActive=!1,o=a(),o&&(this.node.x=o.x,this.node.y=o.y,this.node.scale.set(o.scale.x,o.scale.y)),r.isActive=!1,s.isActive=!0,l.invalidate())})}setResizePropertiesByIndex(t,e,n,i=!1){if(!this.componentData)return;const{resizes:r}=this.componentData,s=Object.keys(r);if(t<0||t>=s.length)return;const a=r[s[t]][e];Object.assign(a,n),this.componentData={...this.componentData,resizes:r},i?this.changeResizeByIndex(t):this.update(this.componentData)}};class _0{constructor(t){n(this,"node"),n(this,"componentData"),n(this,"defaults",null),this.node=t}update(t){t&&(this.componentData=t,this.defaults||(this.defaults=this.get().data||null),this.node.body?this.node.body.updateBody(this.node,t):this.node.body=new Box2DBody({...t,node:this.node},!0))}get(){return{type:"physics",data:this.componentData}}}function S0(t){let e=t.scale.x,n=t.scale.y;const i=[];let r=t;for(;r.parent&&"editor_viewport"!==r.parent.label&&"root"!==r.parent.label;)e*=r.parent.scale.x,n*=r.parent.scale.y,i.push(r.parent),r=r.parent;return{x:e,y:n,parents:i}}class w0{constructor(t){n(this,"node"),n(this,"componentData"),n(this,"eventEmitter"),n(this,"defaults",null),n(this,"transformDefaults"),n(this,"transitionFXs",[]),this.node=t,this.eventEmitter=cN,this.transformDefaults=this.node.components.transform.defaults}action(t){this.transformDefaults||(this.transformDefaults=this.node.components.transform.defaults,this.transformDefaults);let e={},n=this.node;const i=this.getDynamicProps(t,n);e=i.dynamicProps||{};const r=i.targets||[this.node];if("custom"===t.transitionType){this.transitionFXs.forEach(t=>{t.kill()}),this.transitionFXs=[];const n=[];for(let i=0;i<r.length;i++){const s=r[i],a=e.targetProps[i],o=e.end();if(!s)continue;if(!o[a])continue;let l=s,h=a;s===this.node&&("scaleX"===a?(l=this.node.scale,h="x"):"scaleY"===a&&(l=this.node.scale,h="y"));const c=o[a](),u={targetProps:[h],start:()=>{},end:()=>({[h]:()=>c})},d={getStart:()=>u.start(),getEnd:()=>u.end()};d[h]=()=>c,QW.delayedCall(t.delay,()=>{"visible"in l&&void 0!==l.visible&&(l.visible=!0)});const p={...{...d,duration:t.duration,delay:t.delay,ease:t.easeCurve&&""!=t.easeCurve?t.easeCurve:t.ease,repeat:t.repeat?t.repeat:0,repeatDelay:t.repeatDelay?t.repeatDelay:0,yoyo:!!t.yoyo&&t.yoyo,onComplete:()=>{if(!f._completed){f._completed=!0,t.hideOnComplete&&"visible"in l&&void 0!==l.visible&&(l.visible=!1);for(let t=this.transitionFXs.length-1;t>=0;t--)if(this.transitionFXs[t]===f||this.transitionFXs[t].name===f.name){this.transitionFXs.splice(t,1);break}if(t.nextFxs&&t.nextFxs.length){t.nextFxs.map(t=>this.componentData.effects[t].name).forEach(t=>{this.transitionFXs.some(e=>e.name===t)||Object.entries(this.componentData.effects).forEach(([e])=>{const n=this.componentData.effects[e];if(n.name===t){const t=this.action(n);this.transitionFXs.push(t),t.play()}})})}if("string"!=typeof t.completeEventNames){const e=t.completeEventNames;e&&e.forEach(t=>{this.eventEmitter.emit(t)})}}}}};delete p.onComplete;const f=QW.effects[t.transitionType](l,p);f.eventCallback("onComplete",()=>{if(!f._completed){f._completed=!0,t.hideOnComplete&&"visible"in l&&void 0!==l.visible&&(l.visible=!1);for(let t=this.transitionFXs.length-1;t>=0;t--)if(this.transitionFXs[t]===f||this.transitionFXs[t].name===f.name){this.transitionFXs.splice(t,1);break}if(t.nextFxs&&t.nextFxs.length){t.nextFxs.map(t=>this.componentData.effects[t].name).forEach(t=>{this.transitionFXs.some(e=>e.name===t)||Object.entries(this.componentData.effects).forEach(([e])=>{const n=this.componentData.effects[e];if(n.name===t){const t=this.action(n);this.transitionFXs.push(t),t.play()}})})}if("string"!=typeof t.completeEventNames){const e=t.completeEventNames;e&&e.forEach(t=>{this.eventEmitter.emit(t)})}}}),f.name=t.name,f.getStart=()=>u.start(),f.getEnd=()=>u.end(),n.push(f),this.transitionFXs.push(f)}return n.length>0?n[0]:null}for(let s=0;s<r.length;s++){const n=r[s];if(0!==Object.keys(e).length){e.start(!0);const i={getStart:(t=!0)=>e.start(t),getEnd:()=>e.end()};e.targetProps.forEach(t=>{i[t]=()=>e.end()[t]()}),QW.delayedCall(t.delay,()=>{"visible"in n&&void 0!==n.visible&&(n.visible=!0)});const r=QW.effects[t.transitionType](n,{...i,duration:t.duration,delay:t.delay,ease:t.easeCurve&&""!=t.easeCurve?t.easeCurve:t.ease,repeat:t.repeat?t.repeat:0,repeatDelay:t.repeatDelay?t.repeatDelay:0,yoyo:!!t.yoyo&&t.yoyo,onComplete:()=>{t.hideOnComplete&&"visible"in n&&void 0!==n.visible&&(n.visible=!1);const e=this.transitionFXs.indexOf(r);if(-1!==e&&this.transitionFXs.splice(e,1),t.nextFxs&&t.nextFxs.length){t.nextFxs.map(t=>this.componentData.effects[t].name).forEach(t=>{this.transitionFXs.some(e=>e.name===t)||Object.entries(this.componentData.effects).forEach(([e])=>{const n=this.componentData.effects[e];if(n.name===t){const t=this.action(n);this.transitionFXs.push(t),t.play()}})})}if("string"!=typeof t.completeEventNames){const e=t.completeEventNames;e&&e.forEach(t=>{this.eventEmitter.emit(t)})}}});return r.name=t.name,r.getStart=(t=!0)=>e.start(t),r.getEnd=()=>e.end(),r}}return null}getDynamicProps(t,e){if(!t)return{};let n=[];const i=e.components.responsive;let r={};if("fadeIn"===t.transitionType)r={targetProps:["alpha"],start:t=>{t&&(e.alpha=0)},end:()=>({alpha:()=>t.alphaFadeIn??this.transformDefaults.alpha??1})};else if("fadeOut"===t.transitionType)r={targetProps:["alpha"],start:t=>{var n;t&&(e.alpha=(null==(n=e.components.transform.defaults)?void 0:n.alpha)??1)},end:()=>({alpha:()=>t.alphaFadeOut??0})};else if("rotate"===t.transitionType)r={targetProps:["angle"],start:t=>{t&&(e.angle=this.transformDefaults.angle?this.transformDefaults.angle:0)},end:()=>({angle:()=>t.angle})};else if("scaleIn"===t.transitionType){const t=()=>{let t=0,n=0;if(i){const i=e.components.responsive.update(e.components.get("responsive").data,!0);t=i.scale.x,n=i.scale.y}else t=this.transformDefaults.scale.x,n=this.transformDefaults.scale.y;return{x:t,y:n}};r={targetProps:["scaleX","scaleY"],start:t=>{t&&e.scale.set(0)},end:()=>({scaleX:()=>t().x,scaleY:()=>t().y})},e.scale.set(0)}else if("scaleOut"===t.transitionType){const t=()=>{if(i){const t=e.components.responsive.update(e.components.get("responsive").data,!0);e.scale.set(t.scale.x,t.scale.y)}else e.scale.set(this.transformDefaults.scale.x,this.transformDefaults.scale.y)};r={targetProps:["scaleX","scaleY"],start:e=>{e&&t()},end:()=>({scaleX:()=>0,scaleY:()=>0})}}else if("scaleUp"===t.transitionType){const n=()=>{if(i){const t=e.components.responsive.update(e.components.get("responsive").data,!0);e.scale.set(t.scale.x,t.scale.y)}else e.scale.set(this.transformDefaults.scale.x,this.transformDefaults.scale.y)},s=()=>{let n=0,r=0;if(i){const t=e.components.responsive.update(e.components.get("responsive").data,!0);n=t.scale.x,r=t.scale.y}else n=this.transformDefaults.scale.x,r=this.transformDefaults.scale.y;const s=t.scaleRatio||1;return{x:n*s,y:r*s}};r={targetProps:["scaleX","scaleY"],start:t=>{t&&n()},end:()=>({scaleX:()=>s().x,scaleY:()=>s().y})}}else if("scaleDown"===t.transitionType){const n=()=>{const n=t.scaleRatio||1;if(i){const t=e.components.responsive.update(e.components.get("responsive").data,!0);e.scale.set(t.scale.x*n,t.scale.y*n)}else e.scale.set(this.transformDefaults.scale.x*n,this.transformDefaults.scale.y*n)},s=()=>{let t=0,n=0;if(i){const i=e.components.responsive.update(e.components.get("responsive").data,!0);t=i.scale.x,n=i.scale.y}else t=this.transformDefaults.scale.x,n=this.transformDefaults.scale.y;return{x:t,y:n}};r={targetProps:["scaleX","scaleY"],start:t=>{t&&n()},end:()=>({scaleX:()=>s().x,scaleY:()=>s().y})}}else if("fromTop"===t.transitionType){const t=()=>{const t=gN(),n=e.getGlobalPosition(),i=t.toLocal(n),r=e.baseHeight*S0(e).y,s=new Cy(i.x,-r*(1-e.originY)-.5*r),a=e.parent.toLocal(s,t);e.x=a.x,e.y=a.y},n=()=>{let t=0;if(i){t=e.components.responsive.update(e.components.get("responsive").data,!0).y}else t=this.transformDefaults.position.y;return t};r={targetProps:["y"],start:e=>{e&&t()},end:()=>({y:()=>n()})}}else if("fromBottom"===t.transitionType){const t=()=>{const t=gN(),n=e.getGlobalPosition(),i=t.toLocal(n),r=e.baseHeight*S0(e).y,s=t.baseHeight,a=new Cy(i.x,s+r*e.originY+.5*r),o=e.parent.toLocal(a,t);e.x=o.x,e.y=o.y},n=()=>{let t=0;if(i){t=e.components.responsive.update(e.components.get("responsive").data,!0).y}else t=this.transformDefaults.position.y;return t};r={targetProps:["y"],start:e=>{e&&t()},end:()=>({y:()=>n()})}}else if("fromLeft"===t.transitionType){const t=()=>{const t=gN(),n=e.getGlobalPosition(),i=t.toLocal(n),r=e.baseWidth*S0(e).x,s=new Cy(-r*(1-e.originX)-.5*r,i.y),a=e.parent.toLocal(s,t);e.x=a.x,e.y=a.y},n=()=>{let t=0;if(i){t=e.components.responsive.update(e.components.get("responsive").data,!0).x}else t=this.transformDefaults.position.x;return t};r={targetProps:["x"],start:e=>{e&&t()},end:()=>({x:()=>n()})}}else if("fromRight"===t.transitionType){const t=()=>{const t=gN(),n=e.getGlobalPosition(),i=t.toLocal(n),r=e.baseWidth*S0(e).x,s=t.baseWidth,a=new Cy(s+r*e.originX+.5*r,i.y),o=e.parent.toLocal(a,t);e.x=o.x,e.y=o.y},n=()=>{let t=0;if(i){t=e.components.responsive.update(e.components.get("responsive").data,!0).x}else t=this.transformDefaults.position.x;return t};r={targetProps:["x"],start:e=>{e&&t()},end:()=>({x:()=>n()})}}else if("toTop"===t.transitionType){const t=()=>{const t=gN(),n=e.getGlobalPosition(),i=t.toLocal(n),r=e.baseHeight*S0(e).y,s=new Cy(i.x,-r*(1-e.originY)-.5*r);return e.parent.toLocal(s,t)},n=()=>{let t=0;if(i){t=e.components.responsive.update(e.components.get("responsive").data,!0).y}else t=this.transformDefaults.position.y;return t};r={targetProps:["y"],start:t=>{t&&(e.y=n())},end:()=>({y:()=>t().y})}}else if("toBottom"===t.transitionType){const t=()=>{const t=gN(),n=e.getGlobalPosition(),i=t.toLocal(n),r=e.baseHeight*S0(e).y,s=t.baseHeight,a=new Cy(i.x,s+r*e.originY+.5*r);return e.parent.toLocal(a,t)},n=()=>{let t=0;if(i){t=e.components.responsive.update(e.components.get("responsive").data,!0).y}else t=this.transformDefaults.position.y;return t};r={targetProps:["y"],start:t=>{t&&(e.y=n())},end:()=>({y:()=>t().y})}}else if("toLeft"===t.transitionType){const t=()=>{const t=gN(),n=e.getGlobalPosition(),i=t.toLocal(n),r=e.baseWidth*S0(e).x,s=new Cy(-r*(1-e.originX)-.5*r,i.y);return e.parent.toLocal(s,t)},n=()=>{let t=0;if(i){t=e.components.responsive.update(e.components.get("responsive").data,!0).x}else t=this.transformDefaults.position.x;return t};r={targetProps:["x"],start:t=>{t&&(e.x=n())},end:()=>({x:()=>t().x})}}else if("toRight"===t.transitionType){const t=()=>{const t=gN(),n=e.getGlobalPosition(),i=t.toLocal(n),r=e.baseWidth*S0(e).x,s=t.baseWidth,a=new Cy(s+r*e.originX+.5*r,i.y);return e.parent.toLocal(a,t)},n=()=>{let t=0;if(i){t=e.components.responsive.update(e.components.get("responsive").data,!0).x}else t=this.transformDefaults.position.x;return t};r={targetProps:["x"],start:t=>{t&&(e.x=n())},end:()=>({x:()=>t().x})}}else if("pulse"===t.transitionType){const n=t.pulseScalar||.9,s=()=>{if(i){const t=e.components.responsive.update(e.components.get("responsive").data,!0);e.scale.set(t.scale.x,t.scale.y)}else e.scale.set(this.transformDefaults.scale.x,this.transformDefaults.scale.y)},a=()=>{let t=0,r=0;if(i){const i=e.components.responsive.update(e.components.get("responsive").data,!0);t=i.scale.x*n,r=i.scale.y*n}else t=this.transformDefaults.scale.x*n,r=this.transformDefaults.scale.y*n;return{x:t,y:r}};r={targetProps:["scaleX","scaleY"],start:t=>{t&&s()},end:()=>({scaleX:()=>a().x,scaleY:()=>a().y})}}else if("shake"===t.transitionType){const n=t.shakeAmount||.9,s=()=>{let t=0,r=0;if(i){const i=e.components.responsive.update(e.components.get("responsive").data,!0);t=i.x-n,t+=n*Math.random()*2,r=i.y-n,r+=n*Math.random()*2}else t=this.transformDefaults.position.x-n,t+=n*Math.random()*2,r=this.transformDefaults.position.y-n,r+=n*Math.random()*2;return{x:t,y:r}},a=()=>{let t=0,n=0;if(i){const i=e.components.responsive.update(e.components.get("responsive").data,!0);t=i.x,n=i.y}else t=this.transformDefaults.position.x,n=this.transformDefaults.position.y;return{x:t,y:n}};r={targetProps:["x","y"],start:t=>{t&&(e.x=a().x,e.y=a().y)},end:()=>({x:()=>s().x,y:()=>s().y})}}else if("blur"===t.transitionType)r={targetProps:["blur"],start:()=>{},end:()=>({blur:()=>t.blur})};else if("brightness"===t.transitionType)r={targetProps:["brightness"],start:()=>{},end:()=>({brightness:()=>t.brightness})};else if("tint"===t.transitionType){const n=()=>{let t=16777215;return e.components.sprite&&(t=e.components.sprite.defaults.tint),t};r={targetProps:["tint"],start:()=>{e.tint=n()},end:()=>({tint:()=>t.tint})}}else if("custom"===t.transitionType){const{props:e,targets:i}=this.createCustomDynamicProps(t);r=e,n=i}return{dynamicProps:r,targets:0===n.length?[this.node]:n}}createCustomDynamicProps(t){const e={targetProps:[],start:()=>{},end:()=>{}},n=t.custom.split("\n");let i=n.map(t=>t.split("_")[0]);i=i.map(t=>{const e=[];return t.split(".").forEach(t=>{const n=t.match(/^([^[]+)\[(\d+)\]$/);n?(e.push(n[1]),e.push(parseInt(n[2]))):e.push(t)}),e});const r=n.map(t=>t.split("_")[1]),s=[];for(let o=0;o<i.length;o++){let t=this.node;if(1!==i[o].length)for(let e=0;e<i[o].length-1;e++){const n=i[o][e];t=t[n],e===i[o].length-2&&s.push(t)}else s.push(this.node)}e.targetProps=i.map(t=>t[t.length-1]);let a={};for(let o=0;o<i.length;o++)a[i[o][i[o].length-1]]=()=>parseFloat(r[o]);return e.end=()=>a,{props:e,targets:s}}play(t){const e=this.getEffect(t,this.componentData);return e?e.play():null}getEffect(t,e=this.componentData){let n=null;return Object.entries(e.effects).forEach(([i])=>{const r=e.effects[i];if(r.autoplay&&QW.delayedCall(0,()=>{n=this.action(r),this.transitionFXs.push(n)}),t&&r.name===t&&(n=this.action(r),n.pause(),this.transitionFXs.push(n)),"string"!=typeof r.eventNames){const t=r.eventNames;t&&t.forEach(t=>{this.eventEmitter.on(t,()=>{n=this.action(r),this.transitionFXs.push(n)})})}}),n}update(t){t&&(this.componentData||this.getEffect(null,t),this.componentData=t,this.defaults||(this.defaults=this.get().data||null))}get(){return{type:"transitionFX",data:this.componentData}}}var T0="in vec2 aPosition;\nout vec2 vTextureCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",M0="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}",A0=Object.defineProperty,E0=(t,e,n)=>(((t,e,n)=>{e in t?A0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const C0=class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct AdjustmentUniforms {\n  uGamma: f32,\n  uContrast: f32,\n  uSaturation: f32,\n  uBrightness: f32,\n  uColor: vec4<f32>,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> adjustmentUniforms : AdjustmentUniforms;\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n  var sample = textureSample(uTexture, uSampler, uv);\n  let color = adjustmentUniforms.uColor;\n\n  if (sample.a > 0.0) \n  {\n    sample = vec4<f32>(sample.rgb / sample.a, sample.a);\n    var rgb: vec3<f32> = pow(sample.rgb, vec3<f32>(1. / adjustmentUniforms.uGamma));\n    rgb = mix(vec3<f32>(.5), mix(vec3<f32>(dot(vec3<f32>(.2125, .7154, .0721), rgb)), rgb, adjustmentUniforms.uSaturation), adjustmentUniforms.uContrast);\n    rgb.r *= color.r;\n    rgb.g *= color.g;\n    rgb.b *= color.b;\n    sample = vec4<f32>(rgb.rgb * adjustmentUniforms.uBrightness, sample.a);\n    sample = vec4<f32>(sample.rgb * sample.a, sample.a);\n  }\n\n  return sample * color.a;\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uGamma;\nuniform float uContrast;\nuniform float uSaturation;\nuniform float uBrightness;\nuniform vec4 uColor;\n\nvoid main()\n{\n    vec4 c = texture(uTexture, vTextureCoord);\n\n    if (c.a > 0.0) {\n        c.rgb /= c.a;\n\n        vec3 rgb = pow(c.rgb, vec3(1. / uGamma));\n        rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, uSaturation), uContrast);\n        rgb.r *= uColor.r;\n        rgb.g *= uColor.g;\n        rgb.b *= uColor.b;\n        c.rgb = rgb * uBrightness;\n\n        c.rgb *= c.a;\n    }\n\n    finalColor = c * uColor.a;\n}\n",name:"adjustment-filter"}),resources:{adjustmentUniforms:{uGamma:{value:e.gamma,type:"f32"},uContrast:{value:e.contrast,type:"f32"},uSaturation:{value:e.saturation,type:"f32"},uBrightness:{value:e.brightness,type:"f32"},uColor:{value:[e.red,e.green,e.blue,e.alpha],type:"vec4<f32>"}}}}),E0(this,"uniforms"),this.uniforms=this.resources.adjustmentUniforms.uniforms}get gamma(){return this.uniforms.uGamma}set gamma(t){this.uniforms.uGamma=t}get contrast(){return this.uniforms.uContrast}set contrast(t){this.uniforms.uContrast=t}get saturation(){return this.uniforms.uSaturation}set saturation(t){this.uniforms.uSaturation=t}get brightness(){return this.uniforms.uBrightness}set brightness(t){this.uniforms.uBrightness=t}get red(){return this.uniforms.uColor[0]}set red(t){this.uniforms.uColor[0]=t}get green(){return this.uniforms.uColor[1]}set green(t){this.uniforms.uColor[1]=t}get blue(){return this.uniforms.uColor[2]}set blue(t){this.uniforms.uColor[2]=t}get alpha(){return this.uniforms.uColor[3]}set alpha(t){this.uniforms.uColor[3]=t}};E0(C0,"DEFAULT_OPTIONS",{gamma:1,contrast:1,saturation:1,brightness:1,red:1,green:1,blue:1,alpha:1});let P0=C0;var R0=Object.defineProperty,I0=(t,e,n)=>(((t,e,n)=>{e in t?R0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const O0=class t extends OS{constructor(...e){let n=e[0]??{};("number"==typeof n||Array.isArray(n))&&(qy(0,"KawaseBlurFilter constructor params are now options object. See params: { strength, quality, clamp, pixelSize }"),n={strength:n},void 0!==e[1]&&(n.quality=e[1]),void 0!==e[2]&&(n.clamp=e[2])),n={...t.DEFAULT_OPTIONS,...n};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:(null==n?void 0:n.clamp)?"struct KawaseBlurUniforms {\n  uOffset:vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> kawaseBlurUniforms : KawaseBlurUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uOffset = kawaseBlurUniforms.uOffset;\n  var color: vec4<f32> = vec4(0.0);\n\n  // Sample top left pixel\n  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x - uOffset.x, uv.y + uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n  // Sample top right pixel\n  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x + uOffset.x, uv.y + uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n  // Sample bottom right pixel\n  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x + uOffset.x, uv.y - uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n  // Sample bottom left pixel\n  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x - uOffset.x, uv.y - uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n  // Average\n  color *= 0.25;\n    \n  return color;\n}":"struct KawaseBlurUniforms {\n  uOffset:vec2<f32>,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> kawaseBlurUniforms : KawaseBlurUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uOffset = kawaseBlurUniforms.uOffset;\n  var color: vec4<f32> = vec4<f32>(0.0);\n\n  // Sample top left pixel\n  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x - uOffset.x, uv.y + uOffset.y));\n  // Sample top right pixel\n  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x + uOffset.x, uv.y + uOffset.y));\n  // Sample bottom right pixel\n  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x + uOffset.x, uv.y - uOffset.y));\n  // Sample bottom left pixel\n  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x - uOffset.x, uv.y - uOffset.y));\n  // Average\n  color *= 0.25;\n\n  return color;\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:(null==n?void 0:n.clamp)?"\nprecision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uOffset;\n\nuniform vec4 uInputClamp;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture(uTexture, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), uInputClamp.xy, uInputClamp.zw));\n\n    // Sample top right pixel\n    color += texture(uTexture, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), uInputClamp.xy, uInputClamp.zw));\n\n    // Sample bottom right pixel\n    color += texture(uTexture, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), uInputClamp.xy, uInputClamp.zw));\n\n    // Sample bottom left pixel\n    color += texture(uTexture, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), uInputClamp.xy, uInputClamp.zw));\n\n    // Average\n    color *= 0.25;\n\n    finalColor = color;\n}\n":"\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uOffset;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture(uTexture, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample top right pixel\n    color += texture(uTexture, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample bottom right pixel\n    color += texture(uTexture, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Sample bottom left pixel\n    color += texture(uTexture, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Average\n    color *= 0.25;\n\n    finalColor = color;\n}",name:"kawase-blur-filter"}),resources:{kawaseBlurUniforms:{uOffset:{value:new Float32Array(2),type:"vec2<f32>"}}}}),I0(this,"uniforms"),I0(this,"_pixelSize",{x:0,y:0}),I0(this,"_clamp"),I0(this,"_kernels",[]),I0(this,"_blur"),I0(this,"_quality"),this.uniforms=this.resources.kawaseBlurUniforms.uniforms,this.pixelSize=n.pixelSize??{x:1,y:1},Array.isArray(n.strength)?this.kernels=n.strength:"number"==typeof n.strength&&(this._blur=n.strength,this.quality=n.quality??3),this._clamp=!!n.clamp}apply(t,e,n,i){const r=this.pixelSizeX/e.source.width,s=this.pixelSizeY/e.source.height;let a;if(1===this._quality||0===this._blur)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*r,this.uniforms.uOffset[1]=a*s,t.applyFilter(this,e,n,i);else{const o=Ab.getSameSizeTexture(e);let l,h=e,c=o;const u=this._quality-1;for(let e=0;e<u;e++)a=this._kernels[e]+.5,this.uniforms.uOffset[0]=a*r,this.uniforms.uOffset[1]=a*s,t.applyFilter(this,h,c,!0),l=h,h=c,c=l;a=this._kernels[u]+.5,this.uniforms.uOffset[0]=a*r,this.uniforms.uOffset[1]=a*s,t.applyFilter(this,h,n,i),Ab.returnTexture(o)}}get strength(){return this._blur}set strength(t){this._blur=t,this._generateKernels()}get quality(){return this._quality}set quality(t){this._quality=Math.max(1,Math.round(t)),this._generateKernels()}get kernels(){return this._kernels}set kernels(t){Array.isArray(t)&&t.length>0?(this._kernels=t,this._quality=t.length,this._blur=Math.max(...t)):(this._kernels=[0],this._quality=1)}get pixelSize(){return this._pixelSize}set pixelSize(t){if("number"!=typeof t)return Array.isArray(t)?(this.pixelSizeX=t[0],void(this.pixelSizeY=t[1])):void(this._pixelSize=t);this.pixelSizeX=this.pixelSizeY=t}get pixelSizeX(){return this.pixelSize.x}set pixelSizeX(t){this.pixelSize.x=t}get pixelSizeY(){return this.pixelSize.y}set pixelSizeY(t){this.pixelSize.y=t}get clamp(){return this._clamp}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce((t,e)=>t+e+.5,0))}_generateKernels(){const t=this._blur,e=this._quality,n=[t];if(t>0){let i=t;const r=t/e;for(let t=1;t<e;t++)i-=r,n.push(i)}this._kernels=n,this._updatePadding()}};I0(O0,"DEFAULT_OPTIONS",{strength:4,quality:3,clamp:!1,pixelSize:{x:1,y:1}});let D0=O0;var B0=Object.defineProperty,F0=(t,e,n)=>(((t,e,n)=>{e in t?B0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const L0=class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct ExtractBrightnessUniforms {\n  uThreshold: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> extractBrightnessUniforms : ExtractBrightnessUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  // A simple & fast algorithm for getting brightness.\n  // It's inaccurate, but good enough for this feature.\n  let max: f32 = max(max(color.r, color.g), color.b);\n  let min: f32 = min(min(color.r, color.g), color.b);\n  let brightness: f32 = (max + min) * 0.5;\n\n  return select(vec4<f32>(0.), color, brightness > extractBrightnessUniforms.uThreshold);\n}\n",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uThreshold;\n\nvoid main() {\n    vec4 color = texture(uTexture, vTextureCoord);\n\n    // A simple & fast algorithm for getting brightness.\n    // It's inaccuracy , but good enought for this feature.\n    float _max = max(max(color.r, color.g), color.b);\n    float _min = min(min(color.r, color.g), color.b);\n    float brightness = (_max + _min) * 0.5;\n\n    if(brightness > uThreshold) {\n        finalColor = color;\n    } else {\n        finalColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n}\n",name:"extract-brightness-filter"}),resources:{extractBrightnessUniforms:{uThreshold:{value:e.threshold,type:"f32"}}}}),F0(this,"uniforms"),this.uniforms=this.resources.extractBrightnessUniforms.uniforms}get threshold(){return this.uniforms.uThreshold}set threshold(t){this.uniforms.uThreshold=t}};F0(L0,"DEFAULT_OPTIONS",{threshold:.5});let U0=L0;var k0=Object.defineProperty,N0=(t,e,n)=>(((t,e,n)=>{e in t?k0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const z0=class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct AdvancedBloomUniforms {\n  uBloomScale: f32,\n  uBrightness: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> advancedBloomUniforms : AdvancedBloomUniforms;\n@group(1) @binding(1) var uMapTexture: texture_2d<f32>;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  var color = textureSample(uTexture, uSampler, uv);\n  color = vec4<f32>(color.rgb * advancedBloomUniforms.uBrightness, color.a);\n\n  var bloomColor = vec4<f32>(textureSample(uMapTexture, uSampler, uv).rgb, 0.0);\n  bloomColor = vec4<f32>(bloomColor.rgb * advancedBloomUniforms.uBloomScale, bloomColor.a);\n  \n  return color + bloomColor;\n}\n",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMapTexture;\nuniform float uBloomScale;\nuniform float uBrightness;\n\nvoid main() {\n    vec4 color = texture(uTexture, vTextureCoord);\n    color.rgb *= uBrightness;\n    vec4 bloomColor = vec4(texture(uMapTexture, vTextureCoord).rgb, 0.0);\n    bloomColor.rgb *= uBloomScale;\n    finalColor = color + bloomColor;\n}\n",name:"advanced-bloom-filter"}),resources:{advancedBloomUniforms:{uBloomScale:{value:e.bloomScale,type:"f32"},uBrightness:{value:e.brightness,type:"f32"}},uMapTexture:ox.WHITE}}),N0(this,"uniforms"),N0(this,"bloomScale",1),N0(this,"brightness",1),N0(this,"_extractFilter"),N0(this,"_blurFilter"),this.uniforms=this.resources.advancedBloomUniforms.uniforms,this._extractFilter=new U0({threshold:e.threshold}),this._blurFilter=new D0({strength:e.kernels??e.blur,quality:e.kernels?void 0:e.quality}),Object.assign(this,e)}apply(t,e,n,i){const r=Ab.getSameSizeTexture(e);this._extractFilter.apply(t,e,r,!0);const s=Ab.getSameSizeTexture(e);this._blurFilter.apply(t,r,s,!0),this.uniforms.uBloomScale=this.bloomScale,this.uniforms.uBrightness=this.brightness,this.resources.uMapTexture=s.source,t.applyFilter(this,e,n,i),Ab.returnTexture(s),Ab.returnTexture(r)}get threshold(){return this._extractFilter.threshold}set threshold(t){this._extractFilter.threshold=t}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get blur(){return this._blurFilter.strength}set blur(t){this._blurFilter.strength=t}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){"number"==typeof t&&(t={x:t,y:t}),Array.isArray(t)&&(t={x:t[0],y:t[1]}),this._blurFilter.pixelSize=t}get pixelSizeX(){return this._blurFilter.pixelSizeX}set pixelSizeX(t){this._blurFilter.pixelSizeX=t}get pixelSizeY(){return this._blurFilter.pixelSizeY}set pixelSizeY(t){this._blurFilter.pixelSizeY=t}};N0(z0,"DEFAULT_OPTIONS",{threshold:.5,bloomScale:1,brightness:1,blur:8,quality:4,pixelSize:{x:1,y:1}});let G0=z0;var H0=Object.defineProperty,V0=(t,e,n)=>(((t,e,n)=>{e in t?H0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);V0(class t extends OS{constructor(...e){let n=e[0]??{};"number"==typeof n&&(qy(0,"AsciiFilter constructor params are now options object. See params: { size, color, replaceColor }"),n={size:n});const i=(null==n?void 0:n.color)&&!1!==n.replaceColor;n={...t.DEFAULT_OPTIONS,...n};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct AsciiUniforms {\n    uSize: f32,\n    uColor: vec3<f32>,\n    uReplaceColor: f32,\n};\n\nstruct GlobalFilterUniforms {\n    uInputSize:vec4<f32>,\n    uInputPixel:vec4<f32>,\n    uInputClamp:vec4<f32>,\n    uOutputFrame:vec4<f32>,\n    uGlobalFrame:vec4<f32>,\n    uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> asciiUniforms : AsciiUniforms;\n\n@fragment\nfn mainFragment(\n    @location(0) uv: vec2<f32>,\n    @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n    let pixelSize: f32 = asciiUniforms.uSize;\n    let coord: vec2<f32> = mapCoord(uv);\n\n    // get the rounded color..\n    var pixCoord: vec2<f32> = pixelate(coord, vec2<f32>(pixelSize));\n    pixCoord = unmapCoord(pixCoord);\n\n    var color = textureSample(uTexture, uSampler, pixCoord);\n\n    // determine the character to use\n    let gray: f32 = 0.3 * color.r + 0.59 * color.g + 0.11 * color.b;\n    \n    var n: f32 = 65536.0; // .\n    if (gray > 0.2) {\n        n = 65600.0;    // :\n    }\n    if (gray > 0.3) {\n        n = 332772.0;   // *\n    }\n    if (gray > 0.4) {\n        n = 15255086.0; // o\n    }\n    if (gray > 0.5) {\n        n = 23385164.0; // &\n    }\n    if (gray > 0.6) {\n        n = 15252014.0; // 8\n    }\n    if (gray > 0.7) {\n        n = 13199452.0; // @\n    }\n    if (gray > 0.8) {\n        n = 11512810.0; // #\n    }\n\n    // get the mod..\n    let modd: vec2<f32> = getMod(coord, vec2<f32>(pixelSize));\n    return select(color, vec4<f32>(asciiUniforms.uColor, 1.), asciiUniforms.uReplaceColor > 0.5) * character(n, vec2<f32>(-1.0) + modd * 2.0);\n}\n\nfn pixelate(coord: vec2<f32>, size: vec2<f32>) -> vec2<f32>\n{\n    return floor( coord / size ) * size;\n}\n\nfn getMod(coord: vec2<f32>, size: vec2<f32>) -> vec2<f32>\n{\n    return moduloVec2( coord , size) / size;\n}\n\nfn character(n: f32, p: vec2<f32>) -> f32\n{\n    var q: vec2<f32> = floor(p*vec2<f32>(4.0, 4.0) + 2.5);\n\n    if (clamp(q.x, 0.0, 4.0) == q.x)\n    {\n        if (clamp(q.y, 0.0, 4.0) == q.y)\n        {\n        if (i32(modulo(n/exp2(q.x + 5.0*q.y), 2.0)) == 1)\n        {\n            return 1.0;\n        }\n        }\n    }\n\n    return 0.0;\n}\n\nfn modulo(x: f32, y: f32) -> f32\n{\n  return x - y * floor(x/y);\n}\n\nfn moduloVec2(x: vec2<f32>, y: vec2<f32>) -> vec2<f32>\n{\n  return x - y * floor(x/y);\n}\n\nfn mapCoord(coord: vec2<f32> ) -> vec2<f32>\n{\n    var mappedCoord: vec2<f32> = coord;\n    mappedCoord *= gfu.uInputSize.xy;\n    mappedCoord += gfu.uOutputFrame.xy;\n    return mappedCoord;\n}\n\nfn unmapCoord(coord: vec2<f32> ) -> vec2<f32>\n{\n    var mappedCoord: vec2<f32> = coord;\n    mappedCoord -= gfu.uOutputFrame.xy;\n    mappedCoord /= gfu.uInputSize.xy;\n    return mappedCoord;\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uSize;\nuniform vec3 uColor;\nuniform float uReplaceColor;\n\nuniform vec4 uInputSize;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= uInputSize.xy;\n    coord += uInputSize.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= uInputSize.zw;\n    coord /= uInputSize.xy;\n\n    return coord;\n}\n\nvec2 pixelate(vec2 coord, vec2 size)\n{\n    return floor(coord / size) * size;\n}\n\nvec2 getMod(vec2 coord, vec2 size)\n{\n    return mod(coord, size) / size;\n}\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, 4.0) + 2.5);\n\n    if (clamp(p.x, 0.0, 4.0) == p.x)\n    {\n        if (clamp(p.y, 0.0, 4.0) == p.y)\n        {\n            if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n        }\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 coord = mapCoord(vTextureCoord);\n\n    // get the grid position\n    vec2 pixCoord = pixelate(coord, vec2(uSize));\n    pixCoord = unmapCoord(pixCoord);\n\n    // sample the color at grid position\n    vec4 color = texture(uTexture, pixCoord);\n\n    // brightness of the color as it's perceived by the human eye\n    float gray = 0.3 * color.r + 0.59 * color.g + 0.11 * color.b;\n\n    // determine the character to use\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    // get the mod..\n    vec2 modd = getMod(coord, vec2(uSize));\n\n    finalColor = (uReplaceColor > 0.5 ? vec4(uColor, 1.) : color) * character( n, vec2(-1.0) + modd * 2.0);\n}\n",name:"ascii-filter"}),resources:{asciiUniforms:{uSize:{value:n.size,type:"f32"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uReplaceColor:{value:Number(i),type:"f32"}}}}),V0(this,"uniforms"),V0(this,"_color"),this.uniforms=this.resources.asciiUniforms.uniforms,this._color=new zx,this.color=n.color??16777215}get size(){return this.uniforms.uSize}set size(t){this.uniforms.uSize=t}get color(){return this._color.value}set color(t){this._color.setValue(t);const[e,n,i]=this._color.toArray();this.uniforms.uColor[0]=e,this.uniforms.uColor[1]=n,this.uniforms.uColor[2]=i}get replaceColor(){return this.uniforms.uReplaceColor>.5}set replaceColor(t){this.uniforms.uReplaceColor=t?1:0}},"DEFAULT_OPTIONS",{size:8,color:16777215,replaceColor:!1});var X0=Object.defineProperty,W0=(t,e,n)=>(((t,e,n)=>{e in t?X0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);W0(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct BevelUniforms {\n  uLightColor: vec3<f32>,\n  uLightAlpha: f32,\n  uShadowColor: vec3<f32>,\n  uShadowAlpha: f32,\n  uTransform: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> bevelUniforms : BevelUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let transform = vec2<f32>(1.0 / gfu.uInputSize.xy) * vec2<f32>(bevelUniforms.uTransform.x, bevelUniforms.uTransform.y);\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let lightSample: f32 = textureSample(uTexture, uSampler, uv - transform).a;\n  let shadowSample: f32 = textureSample(uTexture, uSampler, uv + transform).a;\n\n  let light = vec4<f32>(bevelUniforms.uLightColor, bevelUniforms.uLightAlpha);\n  let shadow = vec4<f32>(bevelUniforms.uShadowColor, bevelUniforms.uShadowAlpha);\n\n  color = vec4<f32>(mix(color.rgb, light.rgb, clamp((color.a - lightSample) * light.a, 0.0, 1.0)), color.a);\n  color = vec4<f32>(mix(color.rgb, shadow.rgb, clamp((color.a - shadowSample) * shadow.a, 0.0, 1.0)), color.a);\n  \n  return vec4<f32>(color.rgb * color.a, color.a);\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uTransform;\nuniform vec3 uLightColor;\nuniform float uLightAlpha;\nuniform vec3 uShadowColor;\nuniform float uShadowAlpha;\n\nuniform vec4 uInputSize;\n\nvoid main(void) {\n    vec2 transform = vec2(1.0 / uInputSize) * vec2(uTransform.x, uTransform.y);\n    vec4 color = texture(uTexture, vTextureCoord);\n    float light = texture(uTexture, vTextureCoord - transform).a;\n    float shadow = texture(uTexture, vTextureCoord + transform).a;\n\n    color.rgb = mix(color.rgb, uLightColor, clamp((color.a - light) * uLightAlpha, 0.0, 1.0));\n    color.rgb = mix(color.rgb, uShadowColor, clamp((color.a - shadow) * uShadowAlpha, 0.0, 1.0));\n    finalColor = vec4(color.rgb * color.a, color.a);\n}\n",name:"bevel-filter"}),resources:{bevelUniforms:{uLightColor:{value:new Float32Array(3),type:"vec3<f32>"},uLightAlpha:{value:e.lightAlpha,type:"f32"},uShadowColor:{value:new Float32Array(3),type:"vec3<f32>"},uShadowAlpha:{value:e.shadowAlpha,type:"f32"},uTransform:{value:new Float32Array(2),type:"vec2<f32>"}}},padding:1}),W0(this,"uniforms"),W0(this,"_thickness"),W0(this,"_rotation"),W0(this,"_lightColor"),W0(this,"_shadowColor"),this.uniforms=this.resources.bevelUniforms.uniforms,this._lightColor=new zx,this._shadowColor=new zx,this.lightColor=e.lightColor??16777215,this.shadowColor=e.shadowColor??0,Object.assign(this,e)}get rotation(){return this._rotation/Ey}set rotation(t){this._rotation=t*Ey,this._updateTransform()}get thickness(){return this._thickness}set thickness(t){this._thickness=t,this._updateTransform()}get lightColor(){return this._lightColor.value}set lightColor(t){this._lightColor.setValue(t);const[e,n,i]=this._lightColor.toArray();this.uniforms.uLightColor[0]=e,this.uniforms.uLightColor[1]=n,this.uniforms.uLightColor[2]=i}get lightAlpha(){return this.uniforms.uLightAlpha}set lightAlpha(t){this.uniforms.uLightAlpha=t}get shadowColor(){return this._shadowColor.value}set shadowColor(t){this._shadowColor.setValue(t);const[e,n,i]=this._shadowColor.toArray();this.uniforms.uShadowColor[0]=e,this.uniforms.uShadowColor[1]=n,this.uniforms.uShadowColor[2]=i}get shadowAlpha(){return this.uniforms.uShadowAlpha}set shadowAlpha(t){this.uniforms.uShadowAlpha=t}_updateTransform(){this.uniforms.uTransform[0]=this.thickness*Math.cos(this._rotation),this.uniforms.uTransform[1]=this.thickness*Math.sin(this._rotation)}},"DEFAULT_OPTIONS",{rotation:45,thickness:2,lightColor:16777215,lightAlpha:.7,shadowColor:0,shadowAlpha:.7});var j0=Object.defineProperty,Y0=(t,e,n)=>(((t,e,n)=>{e in t?j0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);Y0(class t extends jI{constructor(...e){let n=e[0]??{};if("number"==typeof n||Array.isArray(n)||"x"in n&&"y"in n){qy(0,"BloomFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }");let t=n;Array.isArray(t)&&(t={x:t[0],y:t[1]}),n={strength:t},void 0!==e[1]&&(n.quality=e[1]),void 0!==e[2]&&(n.resolution=e[2]),void 0!==e[3]&&(n.kernelSize=e[3])}n={...t.DEFAULT_OPTIONS,...n},super(),Y0(this,"_blurXFilter"),Y0(this,"_blurYFilter"),Y0(this,"_strength"),this._strength={x:2,y:2},n.strength&&("number"==typeof n.strength?(this._strength.x=n.strength,this._strength.y=n.strength):(this._strength.x=n.strength.x,this._strength.y=n.strength.y)),this._blurXFilter=new eO({...n,horizontal:!0,strength:this.strengthX}),this._blurYFilter=new eO({...n,horizontal:!1,strength:this.strengthY}),this._blurYFilter.blendMode="screen",Object.assign(this,n)}apply(t,e,n,i){const r=Ab.getSameSizeTexture(e);t.applyFilter(this,e,n,i),this._blurXFilter.apply(t,e,r,!0),this._blurYFilter.apply(t,r,n,!1),Ab.returnTexture(r)}get strength(){return this._strength}set strength(t){this._strength="number"==typeof t?{x:t,y:t}:t,this._updateStrength()}get strengthX(){return this.strength.x}set strengthX(t){this.strength.x=t,this._updateStrength()}get strengthY(){return this.strength.y}set strengthY(t){this.strength.y=t,this._updateStrength()}_updateStrength(){this._blurXFilter.blur=this.strengthX,this._blurYFilter.blur=this.strengthY}get blur(){return qy(0,"BloomFilter.blur is deprecated, please use BloomFilter.strength instead"),this.strengthX}set blur(t){qy(0,"BloomFilter.blur is deprecated, please use BloomFilter.strength instead"),this.strength=t}get blurX(){return qy(0,"BloomFilter.blurX is deprecated, please use BloomFilter.strengthX instead"),this.strengthX}set blurX(t){qy(0,"BloomFilter.blurX is deprecated, please use BloomFilter.strengthX instead"),this.strengthX=t}get blurY(){return qy(0,"BloomFilter.blurY is deprecated, please use BloomFilter.strengthY instead"),this.strengthY}set blurY(t){qy(0,"BloomFilter.blurY is deprecated, please use BloomFilter.strengthY instead"),this.strengthY=t}},"DEFAULT_OPTIONS",{strength:{x:2,y:2},quality:4,resolution:1,kernelSize:5});var q0=Object.defineProperty,K0=(t,e,n)=>(((t,e,n)=>{e in t?q0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);K0(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct BulgePinchUniforms {\n  uDimensions: vec2<f32>,\n  uCenter: vec2<f32>,\n  uRadius: f32,\n  uStrength: f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> bulgePinchUniforms : BulgePinchUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let dimensions: vec2<f32> = bulgePinchUniforms.uDimensions;\n  let center: vec2<f32> = bulgePinchUniforms.uCenter;\n  let radius: f32 = bulgePinchUniforms.uRadius;\n  let strength: f32 = bulgePinchUniforms.uStrength;\n  var coord: vec2<f32> = (uv * gfu.uInputSize.xy) - center * dimensions.xy;\n\n  let distance: f32 = length(coord);\n\n  if (distance < radius) {\n      let percent: f32 = distance / radius;\n      if (strength > 0.0) {\n          coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\n      } else {\n          coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\n      }\n  }\n    coord += (center * dimensions.xy);\n    coord /= gfu.uInputSize.xy;\n\n    let clampedCoord: vec2<f32> = clamp(coord, gfu.uInputClamp.xy, gfu.uInputClamp.zw);\n    var color: vec4<f32> = textureSample(uTexture, uSampler, clampedCoord);\n    if (coord.x != clampedCoord.x && coord.y != clampedCoord.y) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    return color;\n}\n\nfn compareVec2(x: vec2<f32>, y: vec2<f32>) -> bool\n{\n  if (x.x == y.x && x.y == y.y)\n  {\n    return true;\n  }\n\n  return false;\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uDimensions;\nuniform vec2 uCenter;\nuniform float uRadius;\nuniform float uStrength;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nvoid main()\n{\n    vec2 coord = vTextureCoord * uInputSize.xy;\n    coord -= uCenter * uDimensions.xy;\n    float distance = length(coord);\n\n    if (distance < uRadius) {\n        float percent = distance / uRadius;\n        if (uStrength > 0.0) {\n            coord *= mix(1.0, smoothstep(0.0, uRadius / distance, percent), uStrength * 0.75);\n        } else {\n            coord *= mix(1.0, pow(percent, 1.0 + uStrength * 0.75) * uRadius / distance, 1.0 - percent);\n        }\n    }\n\n    coord += uCenter * uDimensions.xy;\n    coord /= uInputSize.xy;\n    vec2 clampedCoord = clamp(coord, uInputClamp.xy, uInputClamp.zw);\n    vec4 color = texture(uTexture, clampedCoord);\n\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    finalColor = color;\n}\n",name:"bulge-pinch-filter"}),resources:{bulgePinchUniforms:{uDimensions:{value:[0,0],type:"vec2<f32>"},uCenter:{value:e.center,type:"vec2<f32>"},uRadius:{value:e.radius,type:"f32"},uStrength:{value:e.strength,type:"f32"}}}}),K0(this,"uniforms"),this.uniforms=this.resources.bulgePinchUniforms.uniforms,Object.assign(this,e)}apply(t,e,n,i){this.uniforms.uDimensions[0]=e.frame.width,this.uniforms.uDimensions[1]=e.frame.height,t.applyFilter(this,e,n,i)}get center(){return this.uniforms.uCenter}set center(t){"number"==typeof t&&(t={x:t,y:t}),Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uCenter=t}get centerX(){return this.uniforms.uCenter.x}set centerX(t){this.uniforms.uCenter.x=t}get centerY(){return this.uniforms.uCenter.y}set centerY(t){this.uniforms.uCenter.y=t}get radius(){return this.uniforms.uRadius}set radius(t){this.uniforms.uRadius=t}get strength(){return this.uniforms.uStrength}set strength(t){this.uniforms.uStrength=t}},"DEFAULT_OPTIONS",{center:{x:.5,y:.5},radius:100,strength:1});var J0,Z0="struct BaseUniforms {\n  uOptions: vec4<f32>,\n  uCounts: vec2<f32>,\n};\n\nstruct StopsUniforms {\n  uColors: array<vec3<f32>, MAX_STOPS>,\n  uStops: array<vec4<f32>, MAX_STOPS>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> baseUniforms : BaseUniforms;\n@group(1) @binding(1) var<uniform> stopsUniforms : StopsUniforms;\n\nstruct VSOutput {\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>,\n  @location(1) coord : vec2<f32>\n};\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn filterCoord( vTextureCoord:vec2<f32> ) -> vec2<f32>\n{\n    return vTextureCoord * gfu.uInputSize.xy / gfu.uOutputFrame.zw;\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  let vTextureCoord: vec2<f32> = filterTextureCoord(aPosition);\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   vTextureCoord,\n   filterCoord(vTextureCoord),\n  );\n}\n\nstruct ColorStop {\n  offset: f32,\n  color: vec3<f32>,\n  alpha: f32,\n};\n\nfn rotate2d(angle: f32) -> mat2x2<f32>{\n  return mat2x2(cos(angle), -sin(angle),\n  sin(angle), cos(angle));\n}\n\nfn projectLinearPosition(pos: vec2<f32>, angle: f32) -> f32 {\n  var center: vec2<f32> = vec2<f32>(0.5);\n  var result: vec2<f32> = pos - center;\n  result = rotate2d(angle) * result;\n  result = result + center;\n  return clamp(result.x, 0.0, 1.0);\n}\n\nfn projectRadialPosition(pos: vec2<f32>) -> f32 {\n  var r: f32 = distance(pos, vec2<f32>(0.5));\n  return clamp(2.0 * r, 0.0, 1.0);\n}\n\nfn projectAnglePosition(pos: vec2<f32>, angle: f32) -> f32 {\n  var center: vec2<f32> = pos - vec2<f32>(0.5, 0.5);\n  var polarAngle: f32 = atan2(-center.y, center.x);\n  return ((polarAngle + angle) % PI_2) / PI_2;\n}\n\nfn projectPosition(pos: vec2<f32>, gradientType: i32, angle: f32) -> f32 {\n  if (gradientType == TYPE_LINEAR) {\n      return projectLinearPosition(pos, angle);\n  } else if (gradientType == TYPE_RADIAL) {\n      return projectRadialPosition(pos);\n  } else if (gradientType == TYPE_CONIC) {\n      return projectAnglePosition(pos, angle);\n  }\n\n  return pos.y;\n}\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>,\n  @location(1) coord : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uType: i32 = i32(baseUniforms.uOptions[0]);\n  let uAngle: f32 = baseUniforms.uOptions[1];\n  let uAlpha: f32 = baseUniforms.uOptions[2];\n  let uReplace: f32 = baseUniforms.uOptions[3];\n\n  let uNumStops: i32 = i32(baseUniforms.uCounts[0]);\n  let uMaxColors: f32 = baseUniforms.uCounts[1];\n\n  // current/original color\n  var currentColor: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  // skip calculations if gradient alpha is 0\n  if (uAlpha == 0.0) { return currentColor; }\n\n  // project position\n  var y: f32 = projectPosition(coord, uType, radians(uAngle));\n\n  // check gradient bounds\n  var offsetMin: f32 = stopsUniforms.uStops[0][0];\n  var offsetMax: f32 = 0.0;\n\n  let numStops: i32 = uNumStops;\n\n  for (var i: i32 = 0; i < MAX_STOPS; i = i + 1) {\n      if (i == numStops - 1) { // last index\n          offsetMax = stopsUniforms.uStops[i][0];\n      }\n  }\n\n  if (y  < offsetMin || y > offsetMax) { return currentColor; }\n\n  // limit colors\n  if (uMaxColors > 0.0) {\n      var stepSize: f32 = 1.0 / uMaxColors;\n      var stepNumber: f32 = floor(y / stepSize);\n      y = stepSize * (stepNumber + 0.5); // offset by 0.5 to use color from middle of segment\n  }\n\n  // find color stops\n  var stopFrom: ColorStop;\n  var stopTo: ColorStop;\n\n  for (var i: i32 = 0; i < MAX_STOPS; i = i + 1) {\n      if (y >= stopsUniforms.uStops[i][0]) {\n          stopFrom = ColorStop(stopsUniforms.uStops[i][0], stopsUniforms.uColors[i], stopsUniforms.uStops[i][1]);\n          stopTo = ColorStop(stopsUniforms.uStops[i + 1][0], stopsUniforms.uColors[i + 1], stopsUniforms.uStops[i + 1][1]);\n      }\n\n      if (i == numStops - 1) { // last index\n          break;\n      }\n  }\n\n  // mix colors from stops\n  var colorFrom: vec4<f32> = vec4<f32>(stopFrom.color * stopFrom.alpha, stopFrom.alpha);\n  var colorTo: vec4<f32> = vec4<f32>(stopTo.color * stopTo.alpha, stopTo.alpha);\n\n  var segmentHeight: f32 = stopTo.offset - stopFrom.offset;\n  var relativePos: f32 = y - stopFrom.offset; // position from 0 to [segmentHeight]\n  var relativePercent: f32 = relativePos / segmentHeight; // position in percent between [from.offset] and [to.offset].\n\n  var gradientAlpha: f32 = uAlpha * currentColor.a;\n  var gradientColor: vec4<f32> = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;\n\n  if (uReplace < 0.5) {\n      // mix resulting color with current color\n      return gradientColor + currentColor * (1.0 - gradientColor.a);\n  } else {\n      // replace with gradient color\n      return gradientColor;\n  }\n}\n\nconst PI: f32 = 3.14159265358979323846264;\nconst PI_2: f32 = PI * 2.0;\n\nconst TYPE_LINEAR: i32 = 0;\nconst TYPE_RADIAL: i32 = 1;\nconst TYPE_CONIC: i32 = 2;\nconst MAX_STOPS: i32 = 32;";(J0=J0||{}).stringify=function(){var t={"visit_linear-gradient":function(e){return t.visit_gradient(e)},"visit_repeating-linear-gradient":function(e){return t.visit_gradient(e)},"visit_radial-gradient":function(e){return t.visit_gradient(e)},"visit_repeating-radial-gradient":function(e){return t.visit_gradient(e)},visit_gradient:function(e){var n=t.visit(e.orientation);return n&&(n+=", "),e.type+"("+n+t.visit(e.colorStops)+")"},visit_shape:function(e){var n=e.value,i=t.visit(e.at),r=t.visit(e.style);return r&&(n+=" "+r),i&&(n+=" at "+i),n},"visit_default-radial":function(e){var n="",i=t.visit(e.at);return i&&(n+=i),n},"visit_extent-keyword":function(e){var n=e.value,i=t.visit(e.at);return i&&(n+=" at "+i),n},"visit_position-keyword":function(t){return t.value},visit_position:function(e){return t.visit(e.value.x)+" "+t.visit(e.value.y)},"visit_%":function(t){return t.value+"%"},visit_em:function(t){return t.value+"em"},visit_px:function(t){return t.value+"px"},visit_literal:function(e){return t.visit_color(e.value,e)},visit_hex:function(e){return t.visit_color("#"+e.value,e)},visit_rgb:function(e){return t.visit_color("rgb("+e.value.join(", ")+")",e)},visit_rgba:function(e){return t.visit_color("rgba("+e.value.join(", ")+")",e)},visit_color:function(e,n){var i=e,r=t.visit(n.length);return r&&(i+=" "+r),i},visit_angular:function(t){return t.value+"deg"},visit_directional:function(t){return"to "+t.value},visit_array:function(e){var n="",i=e.length;return e.forEach(function(e,r){n+=t.visit(e),r<i-1&&(n+=", ")}),n},visit:function(e){if(!e)return"";if(e instanceof Array)return t.visit_array(e,"");if(e.type){var n=t["visit_"+e.type];if(n)return n(e);throw Error("Missing visitor visit_"+e.type)}throw Error("Invalid node.")}};return function(e){return t.visit(e)}}(),(J0=J0||{}).parse=function(){var t=/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,e=/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,n=/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,i=/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,r=/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,s=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,a=/^(left|center|right|top|bottom)/i,o=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,u=/^\(/,d=/^\)/,p=/^,/,f=/^\#([0-9a-fA-F]+)/,m=/^([a-zA-Z]+)/,g=/^rgb/i,v=/^rgba/i,y=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,x="";function b(t){var e=new Error(x+": "+t);throw e.source=x,e}function _(){var t=I(S);return x.length>0&&b("Invalid input not EOF"),t}function S(){return w("linear-gradient",t,M)||w("repeating-linear-gradient",e,M)||w("radial-gradient",n,A)||w("repeating-radial-gradient",i,A)}function w(t,e,n){return T(e,function(e){var i=n();return i&&(U(p)||b("Missing comma before color stops")),{type:t,orientation:i,colorStops:I(O)}})}function T(t,e){var n=U(t);if(n){U(u)||b("Missing (");var i=e(n);return U(d)||b("Missing )"),i}}function M(){return L("directional",r,1)||L("angular",c,1)}function A(){var t,e,n=E();return n&&((t=[]).push(n),e=x,U(p)&&((n=E())?t.push(n):x=e)),t}function E(){var t=function(){var t=L("shape",/^(circle)/i,0);t&&(t.style=F()||C());return t}()||function(){var t=L("shape",/^(ellipse)/i,0);t&&(t.style=B()||C());return t}();if(t)t.at=P();else{var e=C();if(e){t=e;var n=P();n&&(t.at=n)}else{var i=R();i&&(t={type:"default-radial",at:i})}}return t}function C(){return L("extent-keyword",s,1)}function P(){if(L("position",/^at/,0)){var t=R();return t||b("Missing positioning value"),t}}function R(){var t={x:B(),y:B()};if(t.x||t.y)return{type:"position",value:t}}function I(t){var e=t(),n=[];if(e)for(n.push(e);U(p);)(e=t())?n.push(e):b("One extra comma");return n}function O(){var t=L("hex",f,1)||T(v,function(){return{type:"rgba",value:I(D)}})||T(g,function(){return{type:"rgb",value:I(D)}})||L("literal",m,0);return t||b("Expected color definition"),t.length=B(),t}function D(){return U(y)[1]}function B(){return L("%",l,1)||L("position-keyword",a,1)||F()}function F(){return L("px",o,1)||L("em",h,1)}function L(t,e,n){var i=U(e);if(i)return{type:t,value:i[n]}}function U(t){var e,n;return(n=/^[\n\r\t\s]+/.exec(x))&&k(n[0].length),(e=t.exec(x))&&k(e[0].length),e}function k(t){x=x.substr(t)}return function(t){return x=t.toString(),_()}}();var Q0=J0.parse;function $0(t){const e=Q0(function(t){let e=t.replace(/\s{2,}/gu," ");return e=e.replace(/;/g,""),e=e.replace(/ ,/g,","),e=e.replace(/\( /g,"("),e=e.replace(/ \)/g,")"),e.trim()}(t));if(0===e.length)throw new Error("Invalid CSS gradient.");if(1!==e.length)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");const n=e[0];return{type:function(t){const e={"linear-gradient":0,"radial-gradient":1};if(!(t in e))throw new Error(`Unsupported gradient type "${t}"`);return e[t]}(n.type),stops:function(t){const e=function(t){const e=[],n=-1;for(let s=0;s<t.length;s++){const i=t[s];let r=n;"literal"===i.type&&i.length&&"type"in i.length&&"%"===i.length.type&&"value"in i.length&&(r=parseFloat(i.length.value)/100),e.push(r)}const i=t=>{for(let i=t;i<e.length;i++)if(e[i]!==n)return{indexDelta:i-t,offset:e[i]};return{indexDelta:e.length-1-t,offset:1}};let r=0;for(let s=0;s<e.length;s++){const t=e[s];if(t!==n)r=t;else if(0===s)e[s]=0;else if(s+1===e.length)e[s]=1;else{const t=i(s),n=(t.offset-r)/(1+t.indexDelta);for(let i=0;i<=t.indexDelta;i++)e[s+i]=r+(i+1)*n;s+=t.indexDelta,r=e[s]}}return e.map(e1)}(t),n=[],i=new zx;for(let r=0;r<t.length;r++){const s=t1(t[r]),a=i.setValue(s).toArray();n.push({offset:e[r],color:a.slice(0,3),alpha:a[3]})}return n}(n.colorStops),angle:function(t){if(void 0===t)return 0;if("type"in t&&"value"in t)switch(t.type){case"angular":return parseFloat(t.value);case"directional":return function(t){const e={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(t in e))throw new Error(`Unsupported directional value "${t}"`);return e[t]}(t.value)}return 0}(n.orientation)}}function t1(t){switch(t.type){case"hex":return`#${t.value}`;case"literal":return t.value;default:return`${t.type}(${t.value.join(",")})`}}function e1(t){return t.toString().length>6?parseFloat(t.toString().substring(0,6)):t}J0.stringify;var n1=Object.defineProperty,i1=(t,e,n)=>(((t,e,n)=>{e in t?n1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const r1=class t extends OS{constructor(e){if(!(e=e&&"css"in e?{...$0(e.css||""),alpha:e.alpha??t.defaults.alpha,maxColors:e.maxColors??t.defaults.maxColors}:{...t.defaults,...e}).stops||e.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");super({gpuProgram:xS.from({vertex:{source:Z0,entryPoint:"mainVertex"},fragment:{source:Z0,entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:"in vec2 aPosition;\nout vec2 vTextureCoord;\nout vec2 vFilterCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n    vFilterCoord = vTextureCoord * uInputSize.xy / uOutputFrame.zw;\n}\n",fragment:"precision highp float;\nin vec2 vTextureCoord;\nin vec2 vFilterCoord;\nout vec4 finalColor;\n\nconst int TYPE_LINEAR = 0;\nconst int TYPE_RADIAL = 1;\nconst int TYPE_CONIC = 2;\nconst int MAX_STOPS = 32;\n\nuniform sampler2D uTexture;\nuniform vec4 uOptions;\nuniform vec2 uCounts;\nuniform vec3 uColors[MAX_STOPS];\nuniform vec4 uStops[MAX_STOPS];\n\nconst float PI = 3.1415926538;\nconst float PI_2 = PI*2.;\n\nstruct ColorStop {\n    float offset;\n    vec3 color;\n    float alpha;\n};\n\nmat2 rotate2d(float angle){\n    return mat2(cos(angle), -sin(angle),\n    sin(angle), cos(angle));\n}\n\nfloat projectLinearPosition(vec2 pos, float angle){\n    vec2 center = vec2(0.5);\n    vec2 result = pos - center;\n    result = rotate2d(angle) * result;\n    result = result + center;\n    return clamp(result.x, 0., 1.);\n}\n\nfloat projectRadialPosition(vec2 pos) {\n    float r = distance(pos, vec2(0.5));\n    return clamp(2.*r, 0., 1.);\n}\n\nfloat projectAnglePosition(vec2 pos, float angle) {\n    vec2 center = pos - vec2(0.5);\n    float polarAngle=atan(-center.y, center.x);\n    return mod(polarAngle + angle, PI_2) / PI_2;\n}\n\nfloat projectPosition(vec2 pos, int type, float angle) {\n    if (type == TYPE_LINEAR) {\n        return projectLinearPosition(pos, angle);\n    } else if (type == TYPE_RADIAL) {\n        return projectRadialPosition(pos);\n    } else if (type == TYPE_CONIC) {\n        return projectAnglePosition(pos, angle);\n    }\n\n    return pos.y;\n}\n\nvoid main(void) {\n    int uType = int(uOptions[0]);\n    float uAngle = uOptions[1];\n    float uAlpha = uOptions[2];\n    float uReplace = uOptions[3];\n\n    int uNumStops = int(uCounts[0]);\n    float uMaxColors = uCounts[1];\n\n    // current/original color\n    vec4 currentColor = texture(uTexture, vTextureCoord);\n\n    // skip calculations if gradient alpha is 0\n    if (0.0 == uAlpha) {\n        finalColor = currentColor;\n        return;\n    }\n\n    // project position\n    float y = projectPosition(vFilterCoord, int(uType), radians(uAngle));\n\n    // check gradient bounds\n    float offsetMin = uStops[0][0];\n    float offsetMax = 0.0;\n\n    int numStops = int(uNumStops);\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (i == numStops-1){ // last index\n            offsetMax = uStops[i][0];\n        }\n    }\n\n    if (y  < offsetMin || y > offsetMax) {\n        finalColor = currentColor;\n        return;\n    }\n\n    // limit colors\n    if (uMaxColors > 0.) {\n        float stepSize = 1./uMaxColors;\n        float stepNumber = float(floor(y/stepSize));\n        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment\n    }\n\n    // find color stops\n    ColorStop from;\n    ColorStop to;\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (y >= uStops[i][0]) {\n            from = ColorStop(uStops[i][0], uColors[i], uStops[i][1]);\n            to = ColorStop(uStops[i+1][0], uColors[i+1], uStops[i+1][1]);\n        }\n\n        if (i == numStops-1){ // last index\n            break;\n        }\n    }\n\n    // mix colors from stops\n    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);\n    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);\n\n    float segmentHeight = to.offset - from.offset;\n    float relativePos = y - from.offset;// position from 0 to [segmentHeight]\n    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].\n\n    float gradientAlpha = uAlpha * currentColor.a;\n    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;\n\n    if (uReplace < 0.5) {\n        // mix resulting color with current color\n        finalColor = gradientColor + currentColor*(1.-gradientColor.a);\n    } else {\n        // replace with gradient color\n        finalColor = gradientColor;\n    }\n}\n",name:"color-gradient-filter"}),resources:{baseUniforms:{uOptions:{value:[e.type,e.angle??90,e.alpha,e.replace?1:0],type:"vec4<f32>"},uCounts:{value:[e.stops.length,e.maxColors],type:"vec2<f32>"}},stopsUniforms:{uColors:{value:new Float32Array(96),type:"vec3<f32>",size:32},uStops:{value:new Float32Array(128),type:"vec4<f32>",size:32}}}}),i1(this,"baseUniforms"),i1(this,"stopsUniforms"),i1(this,"_stops",[]),this.baseUniforms=this.resources.baseUniforms.uniforms,this.stopsUniforms=this.resources.stopsUniforms.uniforms,Object.assign(this,e)}get stops(){return this._stops}set stops(t){const e=function(t){return[...t].sort((t,e)=>t.offset-e.offset)}(t),n=new zx;let i,r,s;for(let a=0;a<e.length;a++){n.setValue(e[a].color);const t=3*a;[i,r,s]=n.toArray(),this.stopsUniforms.uColors[t]=i,this.stopsUniforms.uColors[t+1]=r,this.stopsUniforms.uColors[t+2]=s,this.stopsUniforms.uStops[4*a]=e[a].offset,this.stopsUniforms.uStops[4*a+1]=e[a].alpha}this.baseUniforms.uCounts[0]=e.length,this._stops=e}get type(){return this.baseUniforms.uOptions[0]}set type(t){this.baseUniforms.uOptions[0]=t}get angle(){return this.baseUniforms.uOptions[1]+90}set angle(t){this.baseUniforms.uOptions[1]=t-90}get alpha(){return this.baseUniforms.uOptions[2]}set alpha(t){this.baseUniforms.uOptions[2]=t}get maxColors(){return this.baseUniforms.uCounts[1]}set maxColors(t){this.baseUniforms.uCounts[1]=t}get replace(){return this.baseUniforms.uOptions[3]>.5}set replace(t){this.baseUniforms.uOptions[3]=t?1:0}};i1(r1,"LINEAR",0),i1(r1,"RADIAL",1),i1(r1,"CONIC",2),i1(r1,"defaults",{type:r1.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0,replace:!1});var s1=Object.defineProperty,a1=(t,e,n)=>(((t,e,n)=>{e in t?s1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);a1(class t extends OS{constructor(...e){let n=e[0]??{};if((n instanceof ox||n instanceof ix)&&(qy(0,"ColorMapFilter constructor params are now options object. See params: { colorMap, nearest, mix }"),n={colorMap:n},void 0!==e[1]&&(n.nearest=e[1]),void 0!==e[2]&&(n.mix=e[2])),n={...t.DEFAULT_OPTIONS,...n},!n.colorMap)throw Error("No color map texture source was provided to ColorMapFilter");super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct ColorMapUniforms {\n  uMix: f32,\n  uSize: f32,\n  uSliceSize: f32,\n  uSlicePixelSize: f32,\n  uSliceInnerSize: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> colorMapUniforms : ColorMapUniforms;\n@group(1) @binding(1) var uMapTexture: texture_2d<f32>;\n@group(1) @binding(2) var uMapSampler: sampler;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  var color:vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  var adjusted: vec4<f32>;\n\n  var altColor: vec4<f32> = vec4<f32>(color.rgb / color.a, color.a);\n  let innerWidth: f32 = colorMapUniforms.uSize - 1.0;\n  let zSlice0: f32 = min(floor(color.b * innerWidth), innerWidth);\n  let zSlice1: f32 = min(zSlice0 + 1.0, innerWidth);\n  let xOffset: f32 = colorMapUniforms.uSlicePixelSize * 0.5 + color.r * colorMapUniforms.uSliceInnerSize;\n  let s0: f32 = xOffset + (zSlice0 * colorMapUniforms.uSliceSize);\n  let s1: f32 = xOffset + (zSlice1 * colorMapUniforms.uSliceSize);\n  let yOffset: f32 = colorMapUniforms.uSliceSize * 0.5 + color.g * (1.0 - colorMapUniforms.uSliceSize);\n  let slice0Color: vec4<f32> = textureSample(uMapTexture, uMapSampler, vec2(s0,yOffset));\n  let slice1Color: vec4<f32> = textureSample(uMapTexture, uMapSampler, vec2(s1,yOffset));\n  let zOffset: f32 = fract(color.b * innerWidth);\n  adjusted = mix(slice0Color, slice1Color, zOffset);\n  altColor = vec4<f32>(color.rgb * color.a, color.a);\n\n  let realColor: vec4<f32> = select(color, altColor, color.a > 0.0);\n\n  return vec4<f32>(mix(realColor, adjusted, colorMapUniforms.uMix).rgb, realColor.a);\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMapTexture;\nuniform float uMix;\nuniform float uSize;\nuniform float uSliceSize;\nuniform float uSlicePixelSize;\nuniform float uSliceInnerSize;\n\nvoid main() {\n    vec4 color = texture(uTexture, vTextureCoord.xy);\n    vec4 adjusted;\n\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n        float innerWidth = uSize - 1.0;\n        float zSlice0 = min(floor(color.b * innerWidth), innerWidth);\n        float zSlice1 = min(zSlice0 + 1.0, innerWidth);\n        float xOffset = uSlicePixelSize * 0.5 + color.r * uSliceInnerSize;\n        float s0 = xOffset + (zSlice0 * uSliceSize);\n        float s1 = xOffset + (zSlice1 * uSliceSize);\n        float yOffset = uSliceSize * 0.5 + color.g * (1.0 - uSliceSize);\n        vec4 slice0Color = texture(uMapTexture, vec2(s0,yOffset));\n        vec4 slice1Color = texture(uMapTexture, vec2(s1,yOffset));\n        float zOffset = fract(color.b * innerWidth);\n        adjusted = mix(slice0Color, slice1Color, zOffset);\n\n        color.rgb *= color.a;\n    }\n\n    finalColor = vec4(mix(color, adjusted, uMix).rgb, color.a);\n\n}",name:"color-map-filter"}),resources:{colorMapUniforms:{uMix:{value:n.mix,type:"f32"},uSize:{value:0,type:"f32"},uSliceSize:{value:0,type:"f32"},uSlicePixelSize:{value:0,type:"f32"},uSliceInnerSize:{value:0,type:"f32"}},uMapTexture:n.colorMap.source,uMapSampler:n.colorMap.source.style}}),a1(this,"uniforms"),a1(this,"_size",0),a1(this,"_sliceSize",0),a1(this,"_slicePixelSize",0),a1(this,"_sliceInnerSize",0),a1(this,"_nearest",!1),a1(this,"_scaleMode","linear"),a1(this,"_colorMap"),this.uniforms=this.resources.colorMapUniforms.uniforms,Object.assign(this,n)}get mix(){return this.uniforms.uMix}set mix(t){this.uniforms.uMix=t}get colorSize(){return this._size}get colorMap(){return this._colorMap}set colorMap(t){if(!t||t===this.colorMap)return;const e=t instanceof ox?t.source:t;e.style.scaleMode=this._scaleMode,e.autoGenerateMipmaps=!1,this._size=e.height,this._sliceSize=1/this._size,this._slicePixelSize=this._sliceSize/this._size,this._sliceInnerSize=this._slicePixelSize*(this._size-1),this.uniforms.uSize=this._size,this.uniforms.uSliceSize=this._sliceSize,this.uniforms.uSlicePixelSize=this._slicePixelSize,this.uniforms.uSliceInnerSize=this._sliceInnerSize,this.resources.uMapTexture=e,this._colorMap=t}get nearest(){return this._nearest}set nearest(t){this._nearest=t,this._scaleMode=t?"nearest":"linear";const e=this._colorMap;e&&e.source&&(e.source.scaleMode=this._scaleMode,e.source.autoGenerateMipmaps=!1,e.source.style.update(),e.source.update())}updateColorMap(){const t=this._colorMap;(null==t?void 0:t.source)&&(t.source.update(),this.colorMap=t)}destroy(){var t;null==(t=this._colorMap)||t.destroy(),super.destroy()}},"DEFAULT_OPTIONS",{colorMap:ox.WHITE,nearest:!1,mix:1});var o1=Object.defineProperty,l1=(t,e,n)=>(((t,e,n)=>{e in t?o1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const h1=class t extends OS{constructor(...e){let n=e[0]??{};("number"==typeof n||Array.isArray(n)||n instanceof Float32Array)&&(qy(0,"ColorOverlayFilter constructor params are now options object. See params: { color, alpha }"),n={color:n},void 0!==e[1]&&(n.alpha=e[1])),n={...t.DEFAULT_OPTIONS,...n};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct ColorOverlayUniforms {\n    uColor: vec3<f32>,\n    uAlpha: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> colorOverlayUniforms : ColorOverlayUniforms;\n\n@fragment\nfn mainFragment(\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n    let c = textureSample(uTexture, uSampler, uv);\n    return vec4<f32>(mix(c.rgb, colorOverlayUniforms.uColor.rgb, c.a * colorOverlayUniforms.uAlpha), c.a);\n}\n",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec3 uColor;\nuniform float uAlpha;\n\nvoid main(void) {\n    vec4 c = texture(uTexture, vTextureCoord);\n    finalColor = vec4(mix(c.rgb, uColor.rgb, c.a * uAlpha), c.a);\n}\n",name:"color-overlay-filter"}),resources:{colorOverlayUniforms:{uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:n.alpha,type:"f32"}}}}),l1(this,"uniforms"),l1(this,"_color"),this.uniforms=this.resources.colorOverlayUniforms.uniforms,this._color=new zx,this.color=n.color??0}get color(){return this._color.value}set color(t){this._color.setValue(t);const[e,n,i]=this._color.toArray();this.uniforms.uColor[0]=e,this.uniforms.uColor[1]=n,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}};l1(h1,"DEFAULT_OPTIONS",{color:0,alpha:1});let c1=h1;var u1=Object.defineProperty,d1=(t,e,n)=>(((t,e,n)=>{e in t?u1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);d1(class t extends OS{constructor(...e){let n=e[0]??{};("number"==typeof n||Array.isArray(n)||n instanceof Float32Array)&&(qy(0,"ColorReplaceFilter constructor params are now options object. See params: { originalColor, targetColor, tolerance }"),n={originalColor:n},void 0!==e[1]&&(n.targetColor=e[1]),void 0!==e[2]&&(n.tolerance=e[2])),n={...t.DEFAULT_OPTIONS,...n};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct ColorReplaceUniforms {\n  uOriginalColor: vec3<f32>,\n  uTargetColor: vec3<f32>,\n  uTolerance: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> colorReplaceUniforms : ColorReplaceUniforms;\n\n@fragment\nfn mainFragment(\n   @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let sample: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  let colorDiff: vec3<f32> = colorReplaceUniforms.uOriginalColor - (sample.rgb / max(sample.a, 0.0000000001));\n  let colorDistance: f32 = length(colorDiff);\n  let doReplace: f32 = step(colorDistance, colorReplaceUniforms.uTolerance);\n\n  return vec4<f32>(mix(sample.rgb, (colorReplaceUniforms.uTargetColor + colorDiff) * sample.a, doReplace), sample.a);\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec3 uOriginalColor;\nuniform vec3 uTargetColor;\nuniform float uTolerance;\n\nvoid main(void) {\n    vec4 c = texture(uTexture, vTextureCoord);\n    vec3 colorDiff = uOriginalColor - (c.rgb / max(c.a, 0.0000000001));\n    float colorDistance = length(colorDiff);\n    float doReplace = step(colorDistance, uTolerance);\n    finalColor = vec4(mix(c.rgb, (uTargetColor + colorDiff) * c.a, doReplace), c.a);\n}\n",name:"color-replace-filter"}),resources:{colorReplaceUniforms:{uOriginalColor:{value:new Float32Array(3),type:"vec3<f32>"},uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"},uTolerance:{value:n.tolerance,type:"f32"}}}}),d1(this,"uniforms"),d1(this,"_originalColor"),d1(this,"_targetColor"),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this._originalColor=new zx,this._targetColor=new zx,this.originalColor=n.originalColor??16711680,this.targetColor=n.targetColor??0,Object.assign(this,n)}get originalColor(){return this._originalColor.value}set originalColor(t){this._originalColor.setValue(t);const[e,n,i]=this._originalColor.toArray();this.uniforms.uOriginalColor[0]=e,this.uniforms.uOriginalColor[1]=n,this.uniforms.uOriginalColor[2]=i}get targetColor(){return this._targetColor.value}set targetColor(t){this._targetColor.setValue(t);const[e,n,i]=this._targetColor.toArray();this.uniforms.uTargetColor[0]=e,this.uniforms.uTargetColor[1]=n,this.uniforms.uTargetColor[2]=i}get tolerance(){return this.uniforms.uTolerance}set tolerance(t){this.uniforms.uTolerance=t}set newColor(t){qy(0,"ColorReplaceFilter.newColor is deprecated, please use ColorReplaceFilter.targetColor instead"),this.targetColor=t}get newColor(){return qy(0,"ColorReplaceFilter.newColor is deprecated, please use ColorReplaceFilter.targetColor instead"),this.targetColor}set epsilon(t){qy(0,"ColorReplaceFilter.epsilon is deprecated, please use ColorReplaceFilter.tolerance instead"),this.tolerance=t}get epsilon(){return qy(0,"ColorReplaceFilter.epsilon is deprecated, please use ColorReplaceFilter.tolerance instead"),this.tolerance}},"DEFAULT_OPTIONS",{originalColor:16711680,targetColor:0,tolerance:.4});var p1=Object.defineProperty,f1=(t,e,n)=>(((t,e,n)=>{e in t?p1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);f1(class t extends OS{constructor(...e){let n=e[0]??{};Array.isArray(n)&&(qy(0,"ConvolutionFilter constructor params are now options object. See params: { matrix, width, height }"),n={matrix:n},void 0!==e[1]&&(n.width=e[1]),void 0!==e[2]&&(n.height=e[2])),n={...t.DEFAULT_OPTIONS,...n};const i=n.width??200,r=n.height??200;super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct ConvolutionUniforms {\n    uMatrix: mat3x3<f32>,\n    uTexelSize: vec2<f32>,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> convolutionUniforms : ConvolutionUniforms;\n\n@fragment\nfn mainFragment(\n    @location(0) uv: vec2<f32>,\n    @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n    let texelSize = convolutionUniforms.uTexelSize;\n    let matrix = convolutionUniforms.uMatrix;\n\n    let c11: vec4<f32> = textureSample(uTexture, uSampler, uv - texelSize); // top left\n    let c12: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x, uv.y - texelSize.y)); // top center\n    let c13: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x + texelSize.x, uv.y - texelSize.y)); // top right\n\n    let c21: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x - texelSize.x, uv.y)); // mid left\n    let c22: vec4<f32> = textureSample(uTexture, uSampler, uv); // mid center\n    let c23: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x + texelSize.x, uv.y)); // mid right\n\n    let c31: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x - texelSize.x, uv.y + texelSize.y)); // bottom left\n    let c32: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x, uv.y + texelSize.y)); // bottom center\n    let c33: vec4<f32> = textureSample(uTexture, uSampler, uv + texelSize); // bottom right\n\n    var finalColor: vec4<f32> = vec4<f32>(\n        c11 * matrix[0][0] + c12 * matrix[0][1] + c13 * matrix[0][2] +\n        c21 * matrix[1][0] + c22 * matrix[1][1] + c23 * matrix[1][2] +\n        c31 * matrix[2][0] + c32 * matrix[2][1] + c33 * matrix[2][2]\n    );\n\n    finalColor.a = c22.a;\n\n    return finalColor;\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uTexelSize;\nuniform mat3 uMatrix;\n\nvoid main(void)\n{\n    vec4 c11 = texture(uTexture, vTextureCoord - uTexelSize); // top left\n    vec4 c12 = texture(uTexture, vec2(vTextureCoord.x, vTextureCoord.y - uTexelSize.y)); // top center\n    vec4 c13 = texture(uTexture, vec2(vTextureCoord.x + uTexelSize.x, vTextureCoord.y - uTexelSize.y)); // top right\n\n    vec4 c21 = texture(uTexture, vec2(vTextureCoord.x - uTexelSize.x, vTextureCoord.y)); // mid left\n    vec4 c22 = texture(uTexture, vTextureCoord); // mid center\n    vec4 c23 = texture(uTexture, vec2(vTextureCoord.x + uTexelSize.x, vTextureCoord.y)); // mid right\n\n    vec4 c31 = texture(uTexture, vec2(vTextureCoord.x - uTexelSize.x, vTextureCoord.y + uTexelSize.y)); // bottom left\n    vec4 c32 = texture(uTexture, vec2(vTextureCoord.x, vTextureCoord.y + uTexelSize.y)); // bottom center\n    vec4 c33 = texture(uTexture, vTextureCoord + uTexelSize); // bottom right\n\n    finalColor =\n        c11 * uMatrix[0][0] + c12 * uMatrix[0][1] + c13 * uMatrix[0][2] +\n        c21 * uMatrix[1][0] + c22 * uMatrix[1][1] + c23 * uMatrix[1][2] +\n        c31 * uMatrix[2][0] + c32 * uMatrix[2][1] + c33 * uMatrix[2][2];\n\n    finalColor.a = c22.a;\n}",name:"convolution-filter"}),resources:{convolutionUniforms:{uMatrix:{value:n.matrix,type:"mat3x3<f32>"},uTexelSize:{value:{x:1/i,y:1/r},type:"vec2<f32>"}}}}),f1(this,"uniforms"),this.uniforms=this.resources.convolutionUniforms.uniforms,this.width=i,this.height=r}get matrix(){return this.uniforms.uMatrix}set matrix(t){t.forEach((t,e)=>{this.uniforms.uMatrix[e]=t})}get width(){return 1/this.uniforms.uTexelSize.x}set width(t){this.uniforms.uTexelSize.x=1/t}get height(){return 1/this.uniforms.uTexelSize.y}set height(t){this.uniforms.uTexelSize.y=1/t}},"DEFAULT_OPTIONS",{matrix:new Float32Array(9),width:200,height:200});var m1=Object.defineProperty,g1=(t,e,n)=>(((t,e,n)=>{e in t?m1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);g1(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct CRTUniforms {\n    uLine: vec4<f32>,\n    uNoise: vec2<f32>,\n    uVignette: vec3<f32>,\n    uSeed: f32,\n    uTime: f32,\n    uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> crtUniforms : CRTUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n    \n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let coord: vec2<f32> = uv * gfu.uInputSize.xy / crtUniforms.uDimensions;\n\n  let uNoise = crtUniforms.uNoise;\n\n  if (uNoise[0] > 0.0 && uNoise[1] > 0.0)\n  {\n    color += vec4<f32>(vec3<f32>(noise(uv)), color.a);\n  }\n\n  if (crtUniforms.uVignette[0] > 0.)\n  {\n    color *= vec4<f32>(vec3<f32>(vignette(color.rgb, coord)), color.a);\n  }\n\n  if (crtUniforms.uLine[1] > 0.0)\n  {\n    color = vec4<f32>(vec3<f32>(interlaceLines(color.rgb, uv)), color.a);  \n  }\n\n  return color;\n}\n\nconst SQRT_2: f32 = 1.414213;\n\nfn modulo(x: f32, y: f32) -> f32\n{\n  return x - y * floor(x/y);\n}\n\nfn rand(co: vec2<f32>) -> f32\n{\n  return fract(sin(dot(co, vec2<f32>(12.9898, 78.233))) * 43758.5453);\n}\n\nfn vignette(co: vec3<f32>, coord: vec2<f32>) -> f32\n{\n  let uVignette = crtUniforms.uVignette;\n  let uDimensions = crtUniforms.uDimensions;\n  \n  let outter: f32 = SQRT_2 - uVignette[0] * SQRT_2;\n  var dir: vec2<f32> = vec2<f32>(0.5) - coord;\n  dir.y *= uDimensions.y / uDimensions.x;\n  let darker: f32 = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignette[2] * SQRT_2), 0.0, 1.0);\n  return darker + (1.0 - darker) * (1.0 - uVignette[1]);\n}\n\nfn noise(coord: vec2<f32>) -> f32\n{\n  let uNoise = crtUniforms.uNoise;\n  let uSeed = crtUniforms.uSeed;\n\n  var pixelCoord: vec2<f32> = coord * gfu.uInputSize.xy;\n  pixelCoord.x = floor(pixelCoord.x / uNoise[1]);\n  pixelCoord.y = floor(pixelCoord.y / uNoise[1]);\n  return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];\n}\n\nfn interlaceLines(co: vec3<f32>, coord: vec2<f32>) -> vec3<f32>\n{\n  var color = co;\n\n  let uDimensions = crtUniforms.uDimensions;\n\n  let curvature: f32 = crtUniforms.uLine[0];\n  let lineWidth: f32 = crtUniforms.uLine[1];\n  let lineContrast: f32 = crtUniforms.uLine[2];\n  let verticalLine: f32 = crtUniforms.uLine[3];\n\n  let dir: vec2<f32> = vec2<f32>(coord * gfu.uInputSize.xy / uDimensions - 0.5);\n\n  let _c: f32 = select(1., curvature, curvature > 0.);\n  let k: f32 = select(1., (length(dir * dir) * 0.25 * _c * _c + 0.935 * _c), curvature > 0.);\n  let uv: vec2<f32> = dir * k;\n  let v: f32 = select(uv.y * uDimensions.y, uv.x * uDimensions.x, verticalLine > 0.5) * min(1.0, 2.0 / lineWidth ) / _c;\n  let j: f32 = 1. + cos(v * 1.2 - crtUniforms.uTime) * 0.5 * lineContrast;\n  color *= j;\n\n  let segment: f32 = select(modulo((dir.y + .5) * uDimensions.y, 4.), modulo((dir.x + .5) * uDimensions.x, 4.), verticalLine > 0.5);\n  color *= 0.99 + ceil(segment) * 0.015;\n\n  return color;\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec4 uLine;\nuniform vec2 uNoise;\nuniform vec3 uVignette;\nuniform float uSeed;\nuniform float uTime;\nuniform vec2 uDimensions;\n\nuniform vec4 uInputSize;\n\nconst float SQRT_2 = 1.414213;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat vignette(vec3 co, vec2 coord)\n{\n    float outter = SQRT_2 - uVignette[0] * SQRT_2;\n    vec2 dir = vec2(0.5) - coord;\n    dir.y *= uDimensions.y / uDimensions.x;\n    float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignette[2] * SQRT_2), 0.0, 1.0);\n    return darker + (1.0 - darker) * (1.0 - uVignette[1]);\n}\n\nfloat noise(vec2 coord)\n{\n    vec2 pixelCoord = coord * uInputSize.xy;\n    pixelCoord.x = floor(pixelCoord.x / uNoise[1]);\n    pixelCoord.y = floor(pixelCoord.y / uNoise[1]);\n    return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];\n}\n\nvec3 interlaceLines(vec3 co, vec2 coord)\n{\n    vec3 color = co;\n\n    float curvature = uLine[0];\n    float lineWidth = uLine[1];\n    float lineContrast = uLine[2];\n    float verticalLine = uLine[3];\n\n    vec2 dir = vec2(coord * uInputSize.xy / uDimensions - 0.5);\n\n    float _c = curvature > 0. ? curvature : 1.;\n    float k = curvature > 0. ? (length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;\n    vec2 uv = dir * k;\n    float v = verticalLine > 0.5 ? uv.x * uDimensions.x : uv.y * uDimensions.y;\n    v *= min(1.0, 2.0 / lineWidth ) / _c;\n    float j = 1. + cos(v * 1.2 - uTime) * 0.5 * lineContrast;\n    color *= j;\n\n    float segment = verticalLine > 0.5 ? mod((dir.x + .5) * uDimensions.x, 4.) : mod((dir.y + .5) * uDimensions.y, 4.);\n    color *= 0.99 + ceil(segment) * 0.015;\n\n    return color;\n}\n\nvoid main(void)\n{\n    finalColor = texture(uTexture, vTextureCoord);\n    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions;\n\n    if (uNoise[0] > 0.0 && uNoise[1] > 0.0)\n    {\n        float n = noise(vTextureCoord);\n        finalColor += vec4(n, n, n, finalColor.a);\n    }\n\n    if (uVignette[0] > 0.)\n    {\n        float v = vignette(finalColor.rgb, coord);\n        finalColor *= vec4(v, v, v, finalColor.a);\n    }\n\n    if (uLine[1] > 0.0)\n    {\n        finalColor = vec4(interlaceLines(finalColor.rgb, vTextureCoord), finalColor.a);  \n    }\n}\n",name:"crt-filter"}),resources:{crtUniforms:{uLine:{value:new Float32Array(4),type:"vec4<f32>"},uNoise:{value:new Float32Array(2),type:"vec2<f32>"},uVignette:{value:new Float32Array(3),type:"vec3<f32>"},uSeed:{value:e.seed,type:"f32"},uTime:{value:e.time,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),g1(this,"uniforms"),g1(this,"seed"),g1(this,"time"),this.uniforms=this.resources.crtUniforms.uniforms,Object.assign(this,e)}apply(t,e,n,i){this.uniforms.uDimensions[0]=e.frame.width,this.uniforms.uDimensions[1]=e.frame.height,this.uniforms.uSeed=this.seed,this.uniforms.uTime=this.time,t.applyFilter(this,e,n,i)}get curvature(){return this.uniforms.uLine[0]}set curvature(t){this.uniforms.uLine[0]=t}get lineWidth(){return this.uniforms.uLine[1]}set lineWidth(t){this.uniforms.uLine[1]=t}get lineContrast(){return this.uniforms.uLine[2]}set lineContrast(t){this.uniforms.uLine[2]=t}get verticalLine(){return this.uniforms.uLine[3]>.5}set verticalLine(t){this.uniforms.uLine[3]=t?1:0}get noise(){return this.uniforms.uNoise[0]}set noise(t){this.uniforms.uNoise[0]=t}get noiseSize(){return this.uniforms.uNoise[1]}set noiseSize(t){this.uniforms.uNoise[1]=t}get vignetting(){return this.uniforms.uVignette[0]}set vignetting(t){this.uniforms.uVignette[0]=t}get vignettingAlpha(){return this.uniforms.uVignette[1]}set vignettingAlpha(t){this.uniforms.uVignette[1]=t}get vignettingBlur(){return this.uniforms.uVignette[2]}set vignettingBlur(t){this.uniforms.uVignette[2]=t}},"DEFAULT_OPTIONS",{curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0,seed:0});var v1=Object.defineProperty;var y1;y1=class t extends OS{constructor(...e){let n=e[0]??{};"number"==typeof n&&(qy(0,"DotFilter constructor params are now options object. See params: { scale, angle, grayscale }"),n={scale:n},void 0!==e[1]&&(n.angle=e[1]),void 0!==e[2]&&(n.grayscale=e[2])),n={...t.DEFAULT_OPTIONS,...n};const i={uScale:{value:n.scale,type:"f32"},uAngle:{value:n.angle,type:"f32"},uGrayScale:{value:n.grayscale?1:0,type:"f32"}};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct DotUniforms {\n  uScale:f32,\n  uAngle:f32,\n  uGrayScale:f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> dotUniforms : DotUniforms;\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n  let color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let gray: vec3<f32> = vec3<f32>(dot(color.rgb, vec3<f32>(0.299, 0.587, 0.114)));\n  // dotUniforms.uGrayScale == 1 doesn't ever pass so it is converted to a float and compared to 0.5 instead \n  let finalColor: vec3<f32> = select(color.rgb, gray, f32(dotUniforms.uGrayScale) >= 0.5);\n\n  return vec4<f32>(finalColor * 10.0 - 5.0 + pattern(uv), color.a);\n}\n\nfn pattern(uv: vec2<f32>) -> f32\n{\n  let s: f32 = sin(dotUniforms.uAngle);\n  let c: f32 = cos(dotUniforms.uAngle);\n  \n  let tex: vec2<f32> = uv * gfu.uInputSize.xy;\n  \n  let p: vec2<f32> = vec2<f32>(\n      c * tex.x - s * tex.y,\n      s * tex.x + c * tex.y\n  ) * dotUniforms.uScale;\n\n  return (sin(p.x) * sin(p.y)) * 4.0;\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uAngle;\nuniform float uScale;\nuniform bool uGrayScale;\n\nuniform vec4 uInputSize;\n\nfloat pattern()\n{\n    float s = sin(uAngle), c = cos(uAngle);\n    vec2 tex = vTextureCoord * uInputSize.xy;\n    vec2 point = vec2(\n        c * tex.x - s * tex.y,\n        s * tex.x + c * tex.y\n    ) * uScale;\n    return (sin(point.x) * sin(point.y)) * 4.0;\n    }\n\n    void main()\n    {\n    vec4 color = texture(uTexture, vTextureCoord);\n    vec3 colorRGB = vec3(color);\n\n    if (uGrayScale)\n    {\n        colorRGB = vec3(color.r + color.g + color.b) / 3.0;\n    }\n\n    finalColor = vec4(colorRGB * 10.0 - 5.0 + pattern(), color.a);\n}\n",name:"dot-filter"}),resources:{dotUniforms:i}})}get scale(){return this.resources.dotUniforms.uniforms.uScale}set scale(t){this.resources.dotUniforms.uniforms.uScale=t}get angle(){return this.resources.dotUniforms.uniforms.uAngle}set angle(t){this.resources.dotUniforms.uniforms.uAngle=t}get grayscale(){return 1===this.resources.dotUniforms.uniforms.uGrayScale}set grayscale(t){this.resources.dotUniforms.uniforms.uGrayScale=t?1:0}},((t,e,n)=>{e in t?v1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(y1,"DEFAULT_OPTIONS"+"",{scale:1,angle:5,grayscale:!0});var x1=Object.defineProperty,b1=(t,e,n)=>(((t,e,n)=>{e in t?x1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);b1(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct DropShadowUniforms {\n  uAlpha: f32,\n  uColor: vec3<f32>,\n  uOffset: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> dropShadowUniforms : DropShadowUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv - dropShadowUniforms.uOffset * gfu.uInputSize.zw);\n\n  // Premultiply alpha\n  color = vec4<f32>(vec3<f32>(dropShadowUniforms.uColor.rgb * color.a), color.a);\n  // alpha user alpha\n  color *= dropShadowUniforms.uAlpha;\n\n  return color;\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uAlpha;\nuniform vec3 uColor;\nuniform vec2 uOffset;\n\nuniform vec4 uInputSize;\n\nvoid main(void){\n    vec4 sample = texture(uTexture, vTextureCoord - uOffset * uInputSize.zw);\n\n    // Premultiply alpha\n    sample.rgb = uColor.rgb * sample.a;\n\n    // alpha user alpha\n    sample *= uAlpha;\n\n    finalColor = sample;\n}",name:"drop-shadow-filter"}),resources:{dropShadowUniforms:{uAlpha:{value:e.alpha,type:"f32"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uOffset:{value:e.offset,type:"vec2<f32>"}}},resolution:e.resolution}),b1(this,"uniforms"),b1(this,"shadowOnly",!1),b1(this,"_color"),b1(this,"_blurFilter"),b1(this,"_basePass"),this.uniforms=this.resources.dropShadowUniforms.uniforms,this._color=new zx,this.color=e.color??0,this._blurFilter=new D0({strength:e.kernels??e.blur,quality:e.kernels?void 0:e.quality}),this._basePass=new OS({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"\n                    @group(0) @binding(1) var uTexture: texture_2d<f32>; \n                    @group(0) @binding(2) var uSampler: sampler;\n                    @fragment\n                    fn mainFragment(\n                        @builtin(position) position: vec4<f32>,\n                        @location(0) uv : vec2<f32>\n                    ) -> @location(0) vec4<f32> {\n                        return textureSample(uTexture, uSampler, uv);\n                    }\n                    ",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"\n                in vec2 vTextureCoord;\n                out vec4 finalColor;\n                uniform sampler2D uTexture;\n\n                void main(void){\n                    finalColor = texture(uTexture, vTextureCoord);\n                }\n                ",name:"drop-shadow-filter"}),resources:{}}),Object.assign(this,e)}apply(t,e,n,i){const r=Ab.getSameSizeTexture(e);t.applyFilter(this,e,r,!0),this._blurFilter.apply(t,r,n,i),this.shadowOnly||t.applyFilter(this._basePass,e,n,!1),Ab.returnTexture(r)}get offset(){return this.uniforms.uOffset}set offset(t){this.uniforms.uOffset=t,this._updatePadding()}get offsetX(){return this.offset.x}set offsetX(t){this.offset.x=t,this._updatePadding()}get offsetY(){return this.offset.y}set offsetY(t){this.offset.y=t,this._updatePadding()}get color(){return this._color.value}set color(t){this._color.setValue(t);const[e,n,i]=this._color.toArray();this.uniforms.uColor[0]=e,this.uniforms.uColor[1]=n,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get blur(){return this._blurFilter.strength}set blur(t){this._blurFilter.strength=t,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t,this._updatePadding()}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){"number"==typeof t&&(t={x:t,y:t}),Array.isArray(t)&&(t={x:t[0],y:t[1]}),this._blurFilter.pixelSize=t}get pixelSizeX(){return this._blurFilter.pixelSizeX}set pixelSizeX(t){this._blurFilter.pixelSizeX=t}get pixelSizeY(){return this._blurFilter.pixelSizeY}set pixelSizeY(t){this._blurFilter.pixelSizeY=t}_updatePadding(){const t=Math.max(Math.abs(this.offsetX),Math.abs(this.offsetY));this.padding=t+2*this.blur+4*this.quality}},"DEFAULT_OPTIONS",{offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:void 0,blur:2,quality:3,pixelSize:{x:1,y:1},resolution:1});var _1=Object.defineProperty,S1=(t,e,n)=>(((t,e,n)=>{e in t?_1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);S1(class t extends OS{constructor(e){e={...t.defaults,...e};const n=xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct GlitchUniforms {\n  uSeed: f32,\n  uDimensions: vec2<f32>,\n  uAspect: f32,\n  uFillMode: f32,\n  uOffset: f32,\n  uDirection: f32,\n  uRed: vec2<f32>,\n  uGreen: vec2<f32>,\n  uBlue: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> glitchUniforms : GlitchUniforms;\n@group(1) @binding(1) var uDisplacementMap: texture_2d<f32>; \n@group(1) @binding(2) var uDisplacementSampler: sampler; \n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uSeed: f32 = glitchUniforms.uSeed;\n  let uDimensions: vec2<f32> = glitchUniforms.uDimensions;\n  let uAspect: f32 = glitchUniforms.uAspect;\n  let uOffset: f32 = glitchUniforms.uOffset;\n  let uDirection: f32 = glitchUniforms.uDirection;\n  let uRed: vec2<f32> = glitchUniforms.uRed;\n  let uGreen: vec2<f32> = glitchUniforms.uGreen;\n  let uBlue: vec2<f32> = glitchUniforms.uBlue;\n\n  let uInputSize: vec4<f32> = gfu.uInputSize;\n  let uInputClamp: vec4<f32> = gfu.uInputClamp;\n\n  var discarded: bool = false;\n  var coord: vec2<f32> = (uv * uInputSize.xy) / uDimensions;\n\n    if (coord.x > 1.0 || coord.y > 1.0) {\n      discarded = true;\n    }\n\n    let sinDir: f32 = sin(uDirection);\n    let cosDir: f32 = cos(uDirection);\n\n    let cx: f32 = coord.x - 0.5;\n    let cy: f32 = (coord.y - 0.5) * uAspect;\n    var ny: f32 = (-sinDir * cx + cosDir * cy) / uAspect + 0.5;\n\n    ny = select(select(ny, -ny, ny < 0.0), 2.0 - ny, ny > 1.0);\n\n    let dc: vec4<f32> = textureSample(uDisplacementMap, uDisplacementSampler, vec2<f32>(0.5, ny));\n\n    let displacement: f32 = (dc.r - dc.g) * (uOffset / uInputSize.x);\n\n    coord = uv + vec2<f32>(cosDir * displacement, sinDir * displacement * uAspect);\n\n    let fillMode: i32 = i32(glitchUniforms.uFillMode);\n\n    if (fillMode == CLAMP) {\n      coord = clamp(coord, uInputClamp.xy, uInputClamp.zw);\n    } else {\n      if (coord.x > uInputClamp.z) {\n        if (fillMode == TRANSPARENT) {\n          discarded = true;\n        } else if (fillMode == LOOP) {\n          coord.x = coord.x - uInputClamp.z;\n        } else if (fillMode == MIRROR) {\n          coord.x = uInputClamp.z * 2.0 - coord.x;\n        }\n      } else if (coord.x < uInputClamp.x) {\n        if (fillMode == TRANSPARENT) {\n          discarded = true;\n        } else if (fillMode == LOOP) {\n          coord.x = coord.x + uInputClamp.z;\n        } else if (fillMode == MIRROR) {\n          coord.x = coord.x * -uInputClamp.z;\n        }\n      }\n\n      if (coord.y > uInputClamp.w) {\n        if (fillMode == TRANSPARENT) {\n          discarded = true;\n        } else if (fillMode == LOOP) {\n          coord.y = coord.y - uInputClamp.w;\n        } else if (fillMode == MIRROR) {\n          coord.y = uInputClamp.w * 2.0 - coord.y;\n        }\n      } else if (coord.y < uInputClamp.y) {\n        if (fillMode == TRANSPARENT) {\n          discarded = true;\n        } else if (fillMode == LOOP) {\n          coord.y = coord.y + uInputClamp.w;\n        } else if (fillMode == MIRROR) {\n          coord.y = coord.y * -uInputClamp.w;\n        }\n      }\n    }\n\n    let seedR: f32 = 1.0 - uSeed * 0.4;\n    let seedG: f32 = 1.0 - uSeed * 0.3;\n    let seedB: f32 = 1.0 - uSeed * 0.2;\n\n    let offsetR: vec2<f32> = vec2(uRed.x * seedR / uInputSize.x, uRed.y * seedR / uInputSize.y);\n    let offsetG: vec2<f32> = vec2(uGreen.x * seedG / uInputSize.x, uGreen.y * seedG / uInputSize.y);\n    let offsetB: vec2<f32> = vec2(uBlue.x * seedB / uInputSize.x, uBlue.y * seedB / uInputSize.y);\n\n    let r = textureSample(uTexture, uSampler, coord + offsetR).r;\n    let g = textureSample(uTexture, uSampler, coord + offsetG).g;\n    let b = textureSample(uTexture, uSampler, coord + offsetB).b;\n    let a = textureSample(uTexture, uSampler, coord).a;\n\n    return select(vec4<f32>(r, g, b, a), vec4<f32>(0.0,0.0,0.0,0.0), discarded);\n}\n\nconst TRANSPARENT: i32 = 0;\nconst ORIGINAL: i32 = 1;\nconst LOOP: i32 = 2;\nconst CLAMP: i32 = 3;\nconst MIRROR: i32 = 4;",entryPoint:"mainFragment"}}),i=lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uDisplacementMap;\nuniform float uSeed;\nuniform vec2 uDimensions;\nuniform float uAspect;\nuniform float uFillMode;\nuniform float uOffset;\nuniform float uDirection;\nuniform vec2 uRed;\nuniform vec2 uGreen;\nuniform vec2 uBlue;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nconst int TRANSPARENT = 0;\nconst int ORIGINAL = 1;\nconst int LOOP = 2;\nconst int CLAMP = 3;\nconst int MIRROR = 4;\n\nvoid main(void)\n{\n    vec2 coord = (vTextureCoord * uInputSize.xy) / uDimensions;\n\n    if (coord.x > 1.0 || coord.y > 1.0) {\n        return;\n    }\n\n    float sinDir = sin(uDirection);\n    float cosDir = cos(uDirection);\n\n    float cx = coord.x - 0.5;\n    float cy = (coord.y - 0.5) * uAspect;\n    float ny = (-sinDir * cx + cosDir * cy) / uAspect + 0.5;\n\n    // displacementMap: repeat\n    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);\n\n    // displacementMap: mirror\n    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);\n\n    vec4 dc = texture(uDisplacementMap, vec2(0.5, ny));\n\n    float displacement = (dc.r - dc.g) * (uOffset / uInputSize.x);\n\n    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * uAspect);\n\n    int fillMode = int(uFillMode);\n\n    if (fillMode == CLAMP) {\n        coord = clamp(coord, uInputClamp.xy, uInputClamp.zw);\n    } else {\n        if( coord.x > uInputClamp.z ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x -= uInputClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x = uInputClamp.z * 2.0 - coord.x;\n            }\n        } else if( coord.x < uInputClamp.x ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x += uInputClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x *= -uInputClamp.z;\n            }\n        }\n\n        if( coord.y > uInputClamp.w ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y -= uInputClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y = uInputClamp.w * 2.0 - coord.y;\n            }\n        } else if( coord.y < uInputClamp.y ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y += uInputClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y *= -uInputClamp.w;\n            }\n        }\n    }\n\n    finalColor.r = texture(uTexture, coord + uRed * (1.0 - uSeed * 0.4) / uInputSize.xy).r;\n    finalColor.g = texture(uTexture, coord + uGreen * (1.0 - uSeed * 0.3) / uInputSize.xy).g;\n    finalColor.b = texture(uTexture, coord + uBlue * (1.0 - uSeed * 0.2) / uInputSize.xy).b;\n    finalColor.a = texture(uTexture, coord).a;\n}\n",name:"glitch-filter"}),r=document.createElement("canvas");r.width=4,r.height=e.sampleSize??512;const s=new ox({source:new Yb({resource:r})});super({gpuProgram:n,glProgram:i,resources:{glitchUniforms:{uSeed:{value:(null==e?void 0:e.seed)??0,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"},uAspect:{value:1,type:"f32"},uFillMode:{value:(null==e?void 0:e.fillMode)??0,type:"f32"},uOffset:{value:(null==e?void 0:e.offset)??100,type:"f32"},uDirection:{value:(null==e?void 0:e.direction)??0,type:"f32"},uRed:{value:e.red,type:"vec2<f32>"},uGreen:{value:e.green,type:"vec2<f32>"},uBlue:{value:e.blue,type:"vec2<f32>"}},uDisplacementMap:s.source,uDisplacementSampler:s.source.style}}),S1(this,"uniforms"),S1(this,"average",!1),S1(this,"minSize",8),S1(this,"sampleSize",512),S1(this,"_canvas"),S1(this,"texture"),S1(this,"_slices",0),S1(this,"_sizes",new Float32Array(1)),S1(this,"_offsets",new Float32Array(1)),this.uniforms=this.resources.glitchUniforms.uniforms,this._canvas=r,this.texture=s,Object.assign(this,e)}apply(t,e,n,i){const{width:r,height:s}=e.frame;this.uniforms.uDimensions[0]=r,this.uniforms.uDimensions[1]=s,this.uniforms.uAspect=s/r,t.applyFilter(this,e,n,i)}_randomizeSizes(){const t=this._sizes,e=this._slices-1,n=this.sampleSize,i=Math.min(this.minSize/n,.9/this._slices);if(this.average){const n=this._slices;let r=1;for(let s=0;s<e;s++){const e=r/(n-s),a=Math.max(e*(1-.6*Math.random()),i);t[s]=a,r-=a}t[e]=r}else{let n=1;const r=Math.sqrt(1/this._slices);for(let s=0;s<e;s++){const e=Math.max(r*n*Math.random(),i);t[s]=e,n-=e}t[e]=n}this.shuffle()}shuffle(){const t=this._sizes;for(let e=this._slices-1;e>0;e--){const n=Math.random()*e|0,i=t[e];t[e]=t[n],t[n]=i}}_randomizeOffsets(){for(let t=0;t<this._slices;t++)this._offsets[t]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){const t=this.sampleSize,e=this.texture,n=this._canvas.getContext("2d");let i;n.clearRect(0,0,8,t);let r=0;for(let s=0;s<this._slices;s++){i=Math.floor(256*this._offsets[s]);const e=this._sizes[s]*t,a=i>0?i:0,o=i<0?-i:0;n.fillStyle=`rgba(${a}, ${o}, 0, 1)`,n.fillRect(0,r|0,t,e+1|0),r+=e}e.source.update()}set sizes(t){const e=Math.min(this._slices,t.length);for(let n=0;n<e;n++)this._sizes[n]=t[n]}get sizes(){return this._sizes}set offsets(t){const e=Math.min(this._slices,t.length);for(let n=0;n<e;n++)this._offsets[n]=t[n]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(t){this._slices!==t&&(this._slices=t,this._sizes=new Float32Array(t),this._offsets=new Float32Array(t),this.refresh())}get offset(){return this.uniforms.uOffset}set offset(t){this.uniforms.uOffset=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}get fillMode(){return this.uniforms.uFillMode}set fillMode(t){this.uniforms.uFillMode=t}get direction(){return this.uniforms.uDirection/Ey}set direction(t){this.uniforms.uDirection=t*Ey}get red(){return this.uniforms.uRed}set red(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uRed=t}get green(){return this.uniforms.uGreen}set green(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uGreen=t}get blue(){return this.uniforms.uBlue}set blue(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uBlue=t}destroy(){var t;null==(t=this.texture)||t.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}},"defaults",{slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:{x:0,y:0},green:{x:0,y:0},blue:{x:0,y:0},minSize:8,sampleSize:512});var w1=Object.defineProperty,T1=(t,e,n)=>(((t,e,n)=>{e in t?w1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const M1=class t extends OS{constructor(e){const n=(e={...t.DEFAULT_OPTIONS,...e}).distance??10,i=e.quality??.1;super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct GlowUniforms {\n  uDistance: f32,\n  uStrength: vec2<f32>,\n  uColor: vec3<f32>,\n  uAlpha: f32,\n  uQuality: f32,\n  uKnockout: f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> glowUniforms : GlowUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let quality = glowUniforms.uQuality;\n  let distance = glowUniforms.uDistance;\n\n  let dist: f32 = glowUniforms.uDistance;\n  let angleStepSize: f32 = min(1. / quality / distance, PI * 2.0);\n  let angleStepNum: f32 = ceil(PI * 2.0 / angleStepSize);\n\n  let px: vec2<f32> = vec2<f32>(1.0 / gfu.uInputSize.xy);\n\n  var totalAlpha: f32 = 0.0;\n\n  var direction: vec2<f32>;\n  var displaced: vec2<f32>;\n  var curColor: vec4<f32>;\n\n  for (var angle = 0.0; angle < PI * 2.0; angle += angleStepSize) {\n    direction = vec2<f32>(cos(angle), sin(angle)) * px;\n    for (var curDistance = 0.0; curDistance < dist; curDistance+=1) {\n      displaced = vec2<f32>(clamp(uv + direction * (curDistance + 1.0), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n      curColor = textureSample(uTexture, uSampler, displaced);\n      totalAlpha += (dist - curDistance) * curColor.a;\n    }\n  }\n    \n  curColor = textureSample(uTexture, uSampler, uv);\n\n  let glowColorRGB = glowUniforms.uColor;\n  let glowAlpha = glowUniforms.uAlpha;\n  let glowColor = vec4<f32>(glowColorRGB, glowAlpha);\n  let knockout: bool = glowUniforms.uKnockout > 0.5;\n  let innerStrength = glowUniforms.uStrength[0];\n  let outerStrength = glowUniforms.uStrength[1];\n\n  let alphaRatio: f32 = (totalAlpha / (angleStepNum * dist * (dist + 1.0) / 2.0));\n  let innerGlowAlpha: f32 = (1.0 - alphaRatio) * innerStrength * curColor.a * glowAlpha;\n  let innerGlowStrength: f32 = min(1.0, innerGlowAlpha);\n  \n  let innerColor: vec4<f32> = mix(curColor, glowColor, innerGlowStrength);\n  let outerGlowAlpha: f32 = alphaRatio * outerStrength * (1. - curColor.a) * glowAlpha;\n  let outerGlowStrength: f32 = min(1.0 - innerColor.a, outerGlowAlpha);\n  let outerGlowColor: vec4<f32> = outerGlowStrength * glowColor.rgba;\n  \n  if (knockout) {\n    let resultAlpha: f32 = outerGlowAlpha + innerGlowAlpha;\n    return vec4<f32>(glowColor.rgb * resultAlpha, resultAlpha);\n  }\n  else {\n    return innerColor + outerGlowColor;\n  }\n}\n\nconst PI: f32 = 3.14159265358979323846264;",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uStrength;\nuniform vec3 uColor;\nuniform float uKnockout;\nuniform float uAlpha;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nconst float PI = 3.14159265358979323846264;\n\n// Hard-assignment of DIST and ANGLE_STEP_SIZE instead of using uDistance and uQuality to allow them to be use on GLSL loop conditions\nconst float DIST = __DIST__;\nconst float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.);\nconst float ANGLE_STEP_NUM = ceil(PI * 2. / ANGLE_STEP_SIZE);\nconst float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.) / 2.;\n\nvoid main(void) {\n    vec2 px = vec2(1.) / uInputSize.xy;\n\n    float totalAlpha = 0.;\n\n    vec2 direction;\n    vec2 displaced;\n    vec4 curColor;\n\n    for (float angle = 0.; angle < PI * 2.; angle += ANGLE_STEP_SIZE) {\n      direction = vec2(cos(angle), sin(angle)) * px;\n\n      for (float curDistance = 0.; curDistance < DIST; curDistance++) {\n          displaced = clamp(vTextureCoord + direction * (curDistance + 1.), uInputClamp.xy, uInputClamp.zw);\n          curColor = texture(uTexture, displaced);\n          totalAlpha += (DIST - curDistance) * curColor.a;\n      }\n    }\n    \n    curColor = texture(uTexture, vTextureCoord);\n\n    vec4 glowColor = vec4(uColor, uAlpha);\n    bool knockout = uKnockout > .5;\n    float innerStrength = uStrength[0];\n    float outerStrength = uStrength[1];\n\n    float alphaRatio = totalAlpha / MAX_TOTAL_ALPHA;\n    float innerGlowAlpha = (1. - alphaRatio) * innerStrength * curColor.a * uAlpha;\n    float innerGlowStrength = min(1., innerGlowAlpha);\n    \n    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);\n    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a) * uAlpha;\n    float outerGlowStrength = min(1. - innerColor.a, outerGlowAlpha);\n    vec4 outerGlowColor = outerGlowStrength * glowColor.rgba;\n\n    if (knockout) {\n      float resultAlpha = outerGlowAlpha + innerGlowAlpha;\n      finalColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);\n    }\n    else {\n      finalColor = innerColor + outerGlowColor;\n    }\n}\n".replace(/__ANGLE_STEP_SIZE__/gi,`${(1/i/n).toFixed(7)}`).replace(/__DIST__/gi,`${n.toFixed(0)}.0`),name:"glow-filter"}),resources:{glowUniforms:{uDistance:{value:n,type:"f32"},uStrength:{value:[e.innerStrength,e.outerStrength],type:"vec2<f32>"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:e.alpha,type:"f32"},uQuality:{value:i,type:"f32"},uKnockout:{value:(null==e?void 0:e.knockout)?1:0,type:"f32"}}},padding:n}),T1(this,"uniforms"),T1(this,"_color"),this.uniforms=this.resources.glowUniforms.uniforms,this._color=new zx,this.color=e.color??16777215}get distance(){return this.uniforms.uDistance}set distance(t){this.uniforms.uDistance=this.padding=t}get innerStrength(){return this.uniforms.uStrength[0]}set innerStrength(t){this.uniforms.uStrength[0]=t}get outerStrength(){return this.uniforms.uStrength[1]}set outerStrength(t){this.uniforms.uStrength[1]=t}get color(){return this._color.value}set color(t){this._color.setValue(t);const[e,n,i]=this._color.toArray();this.uniforms.uColor[0]=e,this.uniforms.uColor[1]=n,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get quality(){return this.uniforms.uQuality}set quality(t){this.uniforms.uQuality=t}get knockout(){return 1===this.uniforms.uKnockout}set knockout(t){this.uniforms.uKnockout=t?1:0}};T1(M1,"DEFAULT_OPTIONS",{distance:10,outerStrength:4,innerStrength:0,color:16777215,alpha:1,quality:.1,knockout:!1});let A1=M1;var E1=Object.defineProperty,C1=(t,e,n)=>(((t,e,n)=>{e in t?E1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);C1(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct GodrayUniforms {\n  uLight: vec2<f32>,\n  uParallel: f32,\n  uAspect: f32,\n  uTime: f32,\n  uRay: vec3<f32>,\n  uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> godrayUniforms : GodrayUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uDimensions: vec2<f32> = godrayUniforms.uDimensions;\n  let uParallel: bool = godrayUniforms.uParallel > 0.5;\n  let uLight: vec2<f32> = godrayUniforms.uLight;\n  let uAspect: f32 = godrayUniforms.uAspect;\n\n  let coord: vec2<f32> = uv * gfu.uInputSize.xy / uDimensions;\n\n  var d: f32;\n\n  if (uParallel) {\n    let _cos: f32 = uLight.x;\n    let _sin: f32 = uLight.y;\n    d = (_cos * coord.x) + (_sin * coord.y * uAspect);\n  } else {\n    let dx: f32 = coord.x - uLight.x / uDimensions.x;\n    let dy: f32 = (coord.y - uLight.y / uDimensions.y) * uAspect;\n    let dis: f32 = sqrt(dx * dx + dy * dy) + 0.00001;\n    d = dy / dis;\n  }\n\n  let uTime: f32 = godrayUniforms.uTime;\n  let uRay: vec3<f32> = godrayUniforms.uRay;\n  \n  let gain = uRay[0];\n  let lacunarity = uRay[1];\n  let alpha = uRay[2];\n\n  let dir: vec3<f32> = vec3<f32>(d, d, 0.0);\n  var noise: f32 = turb(dir + vec3<f32>(uTime, 0.0, 62.1 + uTime) * 0.05, vec3<f32>(480.0, 320.0, 480.0), lacunarity, gain);\n  noise = mix(noise, 0.0, 0.3);\n  //fade vertically.\n  var mist: vec4<f32> = vec4<f32>(vec3<f32>(noise), 1.0) * (1.0 - coord.y);\n  mist.a = 1.0;\n  // apply user alpha\n  mist *= alpha;\n  return textureSample(uTexture, uSampler, uv) + mist;\n}\n\n${PERLIN}".replace("${PERLIN}","// Taken from https://gist.github.com/munrocket/236ed5ba7e409b8bdf1ff6eca5dcdc39\n\nfn moduloVec3(x: vec3<f32>, y: vec3<f32>) -> vec3<f32>\n{\n  return x - y * floor(x/y);\n}\nfn mod289Vec3(x: vec3<f32>) -> vec3<f32>\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nfn mod289Vec4(x: vec4<f32>) -> vec4<f32>\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nfn permute4(x: vec4<f32>) -> vec4<f32>\n{\n    return mod289Vec4(((x * 34.0) + 1.0) * x);\n}\nfn taylorInvSqrt(r: vec4<f32>) -> vec4<f32>\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\nfn fade3(t: vec3<f32>) -> vec3<f32>\n{\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\nfn fade2(t: vec2<f32>) -> vec2<f32> { return t * t * t * (t * (t * 6. - 15.) + 10.); }\n\nfn perlinNoise2(P: vec2<f32>) -> f32 {\n  var Pi: vec4<f32> = floor(P.xyxy) + vec4<f32>(0., 0., 1., 1.);\n  let Pf = fract(P.xyxy) - vec4<f32>(0., 0., 1., 1.);\n  Pi = Pi % vec4<f32>(289.); // To avoid truncation effects in permutation\n  let ix = Pi.xzxz;\n  let iy = Pi.yyww;\n  let fx = Pf.xzxz;\n  let fy = Pf.yyww;\n  let i = permute4(permute4(ix) + iy);\n  var gx: vec4<f32> = 2. * fract(i * 0.0243902439) - 1.; // 1/41 = 0.024...\n  let gy = abs(gx) - 0.5;\n  let tx = floor(gx + 0.5);\n  gx = gx - tx;\n  var g00: vec2<f32> = vec2<f32>(gx.x, gy.x);\n  var g10: vec2<f32> = vec2<f32>(gx.y, gy.y);\n  var g01: vec2<f32> = vec2<f32>(gx.z, gy.z);\n  var g11: vec2<f32> = vec2<f32>(gx.w, gy.w);\n  let norm = 1.79284291400159 - 0.85373472095314 *\n      vec4<f32>(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));\n  g00 = g00 * norm.x;\n  g01 = g01 * norm.y;\n  g10 = g10 * norm.z;\n  g11 = g11 * norm.w;\n  let n00 = dot(g00, vec2<f32>(fx.x, fy.x));\n  let n10 = dot(g10, vec2<f32>(fx.y, fy.y));\n  let n01 = dot(g01, vec2<f32>(fx.z, fy.z));\n  let n11 = dot(g11, vec2<f32>(fx.w, fy.w));\n  let fade_xy = fade2(Pf.xy);\n  let n_x = mix(vec2<f32>(n00, n01), vec2<f32>(n10, n11), vec2<f32>(fade_xy.x));\n  let n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise, periodic variant\nfn perlinNoise3(P: vec3<f32>, rep: vec3<f32>) -> f32\n{\n    var Pi0: vec3<f32> = moduloVec3(floor(P), rep); // Integer part, modulo period\n    var Pi1: vec3<f32> = moduloVec3(Pi0 + vec3<f32>(1.0), rep); // Integer part + 1, mod period\n    Pi0 = mod289Vec3(Pi0);\n    Pi1 = mod289Vec3(Pi1);\n    let Pf0: vec3<f32> = fract(P); // Fractional part for interpolation\n    let Pf1: vec3<f32> = Pf0 - vec3<f32>(1.0); // Fractional part - 1.0\n    let ix: vec4<f32> = vec4<f32>(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    let iy: vec4<f32> = vec4<f32>(Pi0.yy, Pi1.yy);\n    let iz0: vec4<f32> = Pi0.zzzz;\n    let iz1: vec4<f32> = Pi1.zzzz;\n    let ixy: vec4<f32> = permute4(permute4(ix) + iy);\n    let ixy0: vec4<f32> = permute4(ixy + iz0);\n    let ixy1: vec4<f32> = permute4(ixy + iz1);\n    var gx0: vec4<f32> = ixy0 * (1.0 / 7.0);\n    var gy0: vec4<f32> = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    let gz0: vec4<f32> = vec4<f32>(0.5) - abs(gx0) - abs(gy0);\n    let sz0: vec4<f32> = step(gz0, vec4<f32>(0.0));\n    gx0 -= sz0 * (step(vec4<f32>(0.0), gx0) - 0.5);\n    gy0 -= sz0 * (step(vec4<f32>(0.0), gy0) - 0.5);\n    var gx1: vec4<f32> = ixy1 * (1.0 / 7.0);\n    var gy1: vec4<f32> = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    let gz1: vec4<f32> = vec4<f32>(0.5) - abs(gx1) - abs(gy1);\n    let sz1: vec4<f32> = step(gz1, vec4<f32>(0.0));\n    gx1 -= sz1 * (step(vec4<f32>(0.0), gx1) - 0.5);\n    gy1 -= sz1 * (step(vec4<f32>(0.0), gy1) - 0.5);\n    var g000: vec3<f32> = vec3<f32>(gx0.x, gy0.x, gz0.x);\n    var g100: vec3<f32> = vec3<f32>(gx0.y, gy0.y, gz0.y);\n    var g010: vec3<f32> = vec3<f32>(gx0.z, gy0.z, gz0.z);\n    var g110: vec3<f32> = vec3<f32>(gx0.w, gy0.w, gz0.w);\n    var g001: vec3<f32> = vec3<f32>(gx1.x, gy1.x, gz1.x);\n    var g101: vec3<f32> = vec3<f32>(gx1.y, gy1.y, gz1.y);\n    var g011: vec3<f32> = vec3<f32>(gx1.z, gy1.z, gz1.z);\n    var g111: vec3<f32> = vec3<f32>(gx1.w, gy1.w, gz1.w);\n    let norm0: vec4<f32> = taylorInvSqrt(vec4<f32>(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    let norm1: vec4<f32> = taylorInvSqrt(vec4<f32>(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n    let n000: f32 = dot(g000, Pf0);\n    let n100: f32 = dot(g100, vec3<f32>(Pf1.x, Pf0.yz));\n    let n010: f32 = dot(g010, vec3<f32>(Pf0.x, Pf1.y, Pf0.z));\n    let n110: f32 = dot(g110, vec3<f32>(Pf1.xy, Pf0.z));\n    let n001: f32 = dot(g001, vec3<f32>(Pf0.xy, Pf1.z));\n    let n101: f32 = dot(g101, vec3<f32>(Pf1.x, Pf0.y, Pf1.z));\n    let n011: f32 = dot(g011, vec3<f32>(Pf0.x, Pf1.yz));\n    let n111: f32 = dot(g111, Pf1);\n    let fade_xyz: vec3<f32> = fade3(Pf0);\n    let n_z: vec4<f32> = mix(vec4<f32>(n000, n100, n010, n110), vec4<f32>(n001, n101, n011, n111), fade_xyz.z);\n    let n_yz: vec2<f32> = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    let n_xyz: f32 = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n}\nfn turb(P: vec3<f32>, rep: vec3<f32>, lacunarity: f32, gain: f32) -> f32\n{\n    var sum: f32 = 0.0;\n    var sc: f32 = 1.0;\n    var totalgain: f32 = 1.0;\n    for (var i = 0.0; i < 6.0; i += 1)\n    {\n        sum += totalgain * perlinNoise3(P * sc, rep);\n        sc *= lacunarity;\n        totalgain *= gain;\n    }\n    return abs(sum);\n}"),entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uDimensions;\nuniform float uParallel;\nuniform vec2 uLight;\nuniform float uAspect;\nuniform float uTime;\nuniform vec3 uRay;\n\nuniform vec4 uInputSize;\n\n${PERLIN}\n\nvoid main(void) {\n    vec2 uDimensions = uDimensions;\n    bool uParallel = uParallel > 0.5;\n    vec2 uLight = uLight;\n    float uAspect = uAspect;\n\n    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions;\n\n    float d;\n\n    if (uParallel) {\n        float _cos = uLight.x;\n        float _sin = uLight.y;\n        d = (_cos * coord.x) + (_sin * coord.y * uAspect);\n    } else {\n        float dx = coord.x - uLight.x / uDimensions.x;\n        float dy = (coord.y - uLight.y / uDimensions.y) * uAspect;\n        float dis = sqrt(dx * dx + dy * dy) + 0.00001;\n        d = dy / dis;\n    }\n\n    float uTime = uTime;\n    vec3 uRay = uRay;\n\n    float gain = uRay[0];\n    float lacunarity = uRay[1];\n    float alpha = uRay[2];\n\n    vec3 dir = vec3(d, d, 0.0);\n    float noise = turb(dir + vec3(uTime, 0.0, 62.1 + uTime) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);\n    noise = mix(noise, 0.0, 0.3);\n    //fade vertically.\n    vec4 mist = vec4(vec3(noise), 1.0) * (1.0 - coord.y);\n    mist.a = 1.0;\n    // apply user alpha\n    mist *= alpha;\n\n    finalColor = texture(uTexture, vTextureCoord) + mist;\n}\n".replace("${PERLIN}","vec3 mod289(vec3 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 permute(vec4 x)\n{\n    return mod289(((x * 34.0) + 1.0) * x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\nvec3 fade(vec3 t)\n{\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = Pi0.zzzz;\n    vec4 iz1 = Pi1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0);\n    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n    vec4 sz0 = step(gz0, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    vec4 gx1 = ixy1 * (1.0 / 7.0);\n    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n    vec4 sz1 = step(gz1, vec4(0.0));\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\n    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\n    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\n    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\n    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\n    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\n    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\n    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n    float n000 = dot(g000, Pf0);\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n    float n111 = dot(g111, Pf1);\n    vec3 fade_xyz = fade(Pf0);\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n}\nfloat turb(vec3 P, vec3 rep, float lacunarity, float gain)\n{\n    float sum = 0.0;\n    float sc = 1.0;\n    float totalgain = 1.0;\n    for (float i = 0.0; i < 6.0; i++)\n    {\n        sum += totalgain * pnoise(P * sc, rep);\n        sc *= lacunarity;\n        totalgain *= gain;\n    }\n    return abs(sum);\n}\n"),name:"god-ray-filter"}),resources:{godrayUniforms:{uLight:{value:new Float32Array(2),type:"vec2<f32>"},uParallel:{value:0,type:"f32"},uAspect:{value:0,type:"f32"},uTime:{value:e.time,type:"f32"},uRay:{value:new Float32Array(3),type:"vec3<f32>"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),C1(this,"uniforms"),C1(this,"time",0),C1(this,"_angleLight",[0,0]),C1(this,"_angle",0),C1(this,"_center"),this.uniforms=this.resources.godrayUniforms.uniforms,Object.assign(this,e)}apply(t,e,n,i){const r=e.frame.width,s=e.frame.height;this.uniforms.uLight[0]=this.parallel?this._angleLight[0]:this._center.x,this.uniforms.uLight[1]=this.parallel?this._angleLight[1]:this._center.y,this.uniforms.uDimensions[0]=r,this.uniforms.uDimensions[1]=s,this.uniforms.uAspect=s/r,this.uniforms.uTime=this.time,t.applyFilter(this,e,n,i)}get angle(){return this._angle}set angle(t){this._angle=t;const e=t*Ey;this._angleLight[0]=Math.cos(e),this._angleLight[1]=Math.sin(e)}get parallel(){return this.uniforms.uParallel>.5}set parallel(t){this.uniforms.uParallel=t?1:0}get center(){return this._center}set center(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this._center=t}get centerX(){return this.center.x}set centerX(t){this.center.x=t}get centerY(){return this.center.y}set centerY(t){this.center.y=t}get gain(){return this.uniforms.uRay[0]}set gain(t){this.uniforms.uRay[0]=t}get lacunarity(){return this.uniforms.uRay[1]}set lacunarity(t){this.uniforms.uRay[1]=t}get alpha(){return this.uniforms.uRay[2]}set alpha(t){this.uniforms.uRay[2]=t}},"DEFAULT_OPTIONS",{angle:30,gain:.5,lacunarity:2.5,parallel:!0,time:0,center:{x:0,y:0},alpha:1});var P1=Object.defineProperty,R1=(t,e,n)=>(((t,e,n)=>{e in t?P1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);R1(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct HslUniforms {\n  uHsl:vec3<f32>,\n  uColorize:f32,\n  uAlpha:f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> hslUniforms : HslUniforms;\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n    let color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n    var resultRGB: vec3<f32> = color.rgb;\n\n    let hue: f32 = hslUniforms.uHsl[0];\n    let saturation: f32 = hslUniforms.uHsl[1];\n    let lightness: f32 = hslUniforms.uHsl[2];\n\n    // colorize\n    if (hslUniforms.uColorize > 0.5) {\n        resultRGB = vec3<f32>(dot(color.rgb, vec3<f32>(0.299, 0.587, 0.114)), 0., 0.);\n    }\n\n    // hue\n    resultRGB = hueShift(resultRGB, hue);\n\n    // saturation\n    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js\n    let average: f32 = (resultRGB.r + resultRGB.g + resultRGB.b) / 3.0;\n\n    if (saturation > 0.) {\n        resultRGB += (average - resultRGB) * (1. - 1. / (1.001 - saturation));\n    } else {\n        resultRGB -= (average - resultRGB) * saturation;\n    }\n\n    // lightness\n    resultRGB = mix(resultRGB, vec3<f32>(ceil(lightness)) * color.a, abs(lightness));\n\n    // alpha\n    return mix(color, vec4<f32>(resultRGB, color.a), hslUniforms.uAlpha);\n}\n\n// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243\nconst k: vec3<f32> = vec3(0.57735, 0.57735, 0.57735);\n\nfn hueShift(color: vec3<f32>, angle: f32) -> vec3<f32> \n{\n    let cosAngle: f32 = cos(angle);\n    return vec3<f32>(\n    color * cosAngle +\n    cross(k, color) * sin(angle) +\n    k * dot(k, color) * (1.0 - cosAngle)\n    );\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec3 uHsl;\nuniform float uAlpha;\nuniform float uColorize;\n\n// https://en.wikipedia.org/wiki/Luma_(video)\nconst vec3 weight = vec3(0.299, 0.587, 0.114);\n\nfloat getWeightedAverage(vec3 rgb) {\n    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;\n}\n\n// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243\nconst vec3 k = vec3(0.57735, 0.57735, 0.57735);\n\nvec3 hueShift(vec3 color, float angle) {\n    float cosAngle = cos(angle);\n    return vec3(\n    color * cosAngle +\n    cross(k, color) * sin(angle) +\n    k * dot(k, color) * (1.0 - cosAngle)\n    );\n}\n\nvoid main()\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n    vec3 resultRGB = color.rgb;\n\n    float hue = uHsl[0];\n    float saturation = uHsl[1];\n    float lightness = uHsl[2];\n\n    // colorize\n    if (uColorize > 0.5) {\n        resultRGB = vec3(getWeightedAverage(resultRGB), 0., 0.);\n    }\n\n    // hue\n    resultRGB = hueShift(resultRGB, hue);\n\n    // saturation\n    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js\n    float average = (resultRGB.r + resultRGB.g + resultRGB.b) / 3.0;\n\n    if (saturation > 0.) {\n        resultRGB += (average - resultRGB) * (1. - 1. / (1.001 - saturation));\n    } else {\n        resultRGB -= (average - resultRGB) * saturation;\n    }\n\n    // lightness\n    resultRGB = mix(resultRGB, vec3(ceil(lightness)) * color.a, abs(lightness));\n\n    // alpha\n    finalColor = mix(color, vec4(resultRGB, color.a), uAlpha);\n}\n",name:"hsl-adjustment-filter"}),resources:{hslUniforms:{uHsl:{value:new Float32Array(3),type:"vec3<f32>"},uColorize:{value:e.colorize?1:0,type:"f32"},uAlpha:{value:e.alpha,type:"f32"}}}}),R1(this,"uniforms"),R1(this,"_hue"),this.uniforms=this.resources.hslUniforms.uniforms,Object.assign(this,e)}get hue(){return this._hue}set hue(t){this._hue=t,this.uniforms.uHsl[0]=t*(Math.PI/180)}get saturation(){return this.uniforms.uHsl[1]}set saturation(t){this.uniforms.uHsl[1]=t}get lightness(){return this.uniforms.uHsl[2]}set lightness(t){this.uniforms.uHsl[2]=t}get colorize(){return 1===this.uniforms.uColorize}set colorize(t){this.uniforms.uColorize=t?1:0}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},"DEFAULT_OPTIONS",{hue:0,saturation:0,lightness:0,colorize:!1,alpha:1});var I1=Object.defineProperty,O1=(t,e,n)=>(((t,e,n)=>{e in t?I1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);O1(class t extends OS{constructor(...e){let n=e[0]??{};if(Array.isArray(n)||"x"in n&&"y"in n||n instanceof by){qy(0,"MotionBlurFilter constructor params are now options object. See params: { velocity, kernelSize, offset }");n={velocity:{x:"x"in n?n.x:n[0],y:"y"in n?n.y:n[1]}},void 0!==e[1]&&(n.kernelSize=e[1]),void 0!==e[2]&&(n.offset=e[2])}n={...t.DEFAULT_OPTIONS,...n};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct MotionBlurUniforms {\n  uVelocity: vec2<f32>,\n  uKernelSize: f32,\n  uOffset: f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> motionBlurUniforms : MotionBlurUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uVelocity = motionBlurUniforms.uVelocity;\n  let uKernelSize = motionBlurUniforms.uKernelSize;\n  let uOffset = motionBlurUniforms.uOffset;\n\n  let velocity: vec2<f32> = uVelocity / gfu.uInputSize.xy;\n  let offset: f32 = -uOffset / length(uVelocity) - 0.5;\n  let k: i32 = i32(min(uKernelSize - 1, MAX_KERNEL_SIZE - 1));\n\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  for(var i: i32 = 0; i < k; i += 1) {\n    let bias: vec2<f32> = velocity * (f32(i) / f32(k) + offset);\n    color += textureSample(uTexture, uSampler, uv + bias);\n  }\n  \n  return select(color / f32(uKernelSize), textureSample(uTexture, uSampler, uv), uKernelSize == 0);\n}\n\nconst MAX_KERNEL_SIZE: f32 = 2048;",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uVelocity;\nuniform int uKernelSize;\nuniform float uOffset;\n\nuniform vec4 uInputSize;\n\nconst int MAX_KERNEL_SIZE = 2048;\n\n// Notice:\n// the perfect way:\n//    int kernelSize = min(uKernelSize, MAX_KERNELSIZE);\n// BUT in real use-case , uKernelSize < MAX_KERNELSIZE almost always.\n// So use uKernelSize directly.\n\nvoid main(void)\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n\n    if (uKernelSize == 0)\n    {\n        finalColor = color;\n        return;\n    }\n\n    vec2 velocity = uVelocity / uInputSize.xy;\n    float offset = -uOffset / length(uVelocity) - 0.5;\n    int k = uKernelSize - 1;\n\n    for(int i = 0; i < MAX_KERNEL_SIZE - 1; i++) {\n        if (i == k) {\n            break;\n        }\n        vec2 bias = velocity * (float(i) / float(k) + offset);\n        color += texture(uTexture, vTextureCoord + bias);\n    }\n    finalColor = color / float(uKernelSize);\n}\n",name:"motion-blur-filter"}),resources:{motionBlurUniforms:{uVelocity:{value:n.velocity,type:"vec2<f32>"},uKernelSize:{value:Math.trunc(n.kernelSize??5),type:"i32"},uOffset:{value:n.offset,type:"f32"}}}}),O1(this,"uniforms"),O1(this,"_kernelSize"),this.uniforms=this.resources.motionBlurUniforms.uniforms,Object.assign(this,n)}get velocity(){return this.uniforms.uVelocity}set velocity(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uVelocity=t,this._updateDirty()}get velocityX(){return this.velocity.x}set velocityX(t){this.velocity.x=t,this._updateDirty()}get velocityY(){return this.velocity.y}set velocityY(t){this.velocity.y=t,this._updateDirty()}get kernelSize(){return this._kernelSize}set kernelSize(t){this._kernelSize=t,this._updateDirty()}get offset(){return this.uniforms.uOffset}set offset(t){this.uniforms.uOffset=t}_updateDirty(){this.padding=1+(Math.max(Math.abs(this.velocityX),Math.abs(this.velocityY))|0),this.uniforms.uKernelSize=0!==this.velocityX||0!==this.velocityY?this._kernelSize:0}},"DEFAULT_OPTIONS",{velocity:{x:0,y:0},kernelSize:5,offset:0});var D1=Object.defineProperty,B1=(t,e,n)=>(((t,e,n)=>{e in t?D1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);B1(class t extends OS{constructor(...e){let n=e[0]??{};Array.isArray(n)&&(qy(0,"MultiColorReplaceFilter constructor params are now options object. See params: { replacements, tolerance, maxColors }"),n={replacements:n},e[1]&&(n.tolerance=e[1]),e[2]&&(n.maxColors=e[2])),n={...t.DEFAULT_OPTIONS,...n};const i=n.maxColors??n.replacements.length;super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct MultiColorReplaceUniforms {\n  uOriginalColors: array<vec3<f32>, MAX_COLORS>,\n  uTargetColors: array<vec3<f32>, MAX_COLORS>,\n  uTolerance:f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> multiColorReplaceUniforms : MultiColorReplaceUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uOriginalColors = multiColorReplaceUniforms.uOriginalColors;\n  let uTargetColors = multiColorReplaceUniforms.uTargetColors;\n  let uTolerance = multiColorReplaceUniforms.uTolerance;\n\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  let alpha: f32 = color.a;\n\n  if (alpha > 0.0001)\n  {\n    var modColor: vec3<f32> = vec3<f32>(color.rgb) / alpha;\n\n    for(var i: i32 = 0; i < MAX_COLORS; i += 1)\n    {\n      let origColor: vec3<f32> = uOriginalColors[i];\n      if (origColor.r < 0.0)\n      {\n        break;\n      }\n      let colorDiff: vec3<f32> = origColor - modColor;\n      \n      if (length(colorDiff) < uTolerance)\n      {\n        let targetColor: vec3<f32> = uTargetColors[i];\n        color = vec4((targetColor + colorDiff) * alpha, alpha);\n        return color;\n      }\n    }\n  }\n\n  return color;\n}\n\nconst MAX_COLORS: i32 = ${MAX_COLORS};".replace(/\$\{MAX_COLORS\}/g,i.toFixed(0)),entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nconst int MAX_COLORS = ${MAX_COLORS};\n\nuniform sampler2D uTexture;\nuniform vec3 uOriginalColors[MAX_COLORS];\nuniform vec3 uTargetColors[MAX_COLORS];\nuniform float uTolerance;\n\nvoid main(void)\n{\n    finalColor = texture(uTexture, vTextureCoord);\n\n    float alpha = finalColor.a;\n    if (alpha < 0.0001)\n    {\n      return;\n    }\n\n    vec3 color = finalColor.rgb / alpha;\n\n    for(int i = 0; i < MAX_COLORS; i++)\n    {\n      vec3 origColor = uOriginalColors[i];\n      if (origColor.r < 0.0)\n      {\n        break;\n      }\n      vec3 colorDiff = origColor - color;\n      if (length(colorDiff) < uTolerance)\n      {\n        vec3 targetColor = uTargetColors[i];\n        finalColor = vec4((targetColor + colorDiff) * alpha, alpha);\n        return;\n      }\n    }\n}\n".replace(/\$\{MAX_COLORS\}/g,i.toFixed(0)),name:"multi-color-replace-filter"}),resources:{multiColorReplaceUniforms:{uOriginalColors:{value:new Float32Array(3*i),type:"vec3<f32>",size:i},uTargetColors:{value:new Float32Array(3*i),type:"vec3<f32>",size:i},uTolerance:{value:n.tolerance,type:"f32"}}}}),B1(this,"uniforms"),B1(this,"_replacements",[]),B1(this,"_maxColors"),this._maxColors=i,this.uniforms=this.resources.multiColorReplaceUniforms.uniforms,this.replacements=n.replacements}set replacements(t){const e=this.uniforms.uOriginalColors,n=this.uniforms.uTargetColors,i=t.length,r=new zx;if(i>this._maxColors)throw new Error(`Length of replacements (${i}) exceeds the maximum colors length (${this._maxColors})`);let s,a,o;e[3*i]=-1;for(let l=0;l<i;l++){const i=t[l];r.setValue(i[0]),[s,a,o]=r.toArray(),e[3*l]=s,e[3*l+1]=a,e[3*l+2]=o,r.setValue(i[1]),[s,a,o]=r.toArray(),n[3*l]=s,n[3*l+1]=a,n[3*l+2]=o}this._replacements=t}get replacements(){return this._replacements}refresh(){this.replacements=this._replacements}get maxColors(){return this._maxColors}get tolerance(){return this.uniforms.uTolerance}set tolerance(t){this.uniforms.uTolerance=t}set epsilon(t){qy(0,"MultiColorReplaceFilter.epsilon is deprecated, please use MultiColorReplaceFilter.tolerance instead"),this.tolerance=t}get epsilon(){return qy(0,"MultiColorReplaceFilter.epsilon is deprecated, please use MultiColorReplaceFilter.tolerance instead"),this.tolerance}},"DEFAULT_OPTIONS",{replacements:[[16711680,255]],tolerance:.05,maxColors:void 0});var F1=Object.defineProperty,L1=(t,e,n)=>(((t,e,n)=>{e in t?F1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);L1(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct OldFilmUniforms {\n    uSepia: f32,\n    uNoise: vec2<f32>,\n    uScratch: vec3<f32>,\n    uVignetting: vec3<f32>,\n    uSeed: f32,\n    uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> oldFilmUniforms : OldFilmUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  if (oldFilmUniforms.uSepia > 0.)\n  {\n    color = vec4<f32>(sepia(color.rgb), color.a);\n  }\n\n  let coord: vec2<f32> = uv * gfu.uInputSize.xy / oldFilmUniforms.uDimensions;\n\n  if (oldFilmUniforms.uVignetting[0] > 0.)\n  {\n    color *= vec4<f32>(vec3<f32>(vignette(color.rgb, coord)), color.a);\n  }\n\n  let uScratch = oldFilmUniforms.uScratch; \n\n  if (uScratch[1] > oldFilmUniforms.uSeed && uScratch[0] != 0.)\n  {\n    color = vec4<f32>(scratch(color.rgb, coord), color.a);\n  }\n\n  let uNoise = oldFilmUniforms.uNoise;\n\n  if (uNoise[0] > 0.0 && uNoise[1] > 0.0)\n  {\n    color += vec4<f32>(vec3<f32>(noise(uv)), color.a);\n  }\n\n  return color;\n}\n\nconst SQRT_2: f32 = 1.414213;\nconst SEPIA_RGB: vec3<f32> = vec3<f32>(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);\n\nfn modulo(x: f32, y: f32) -> f32\n{\n  return x - y * floor(x/y);\n}\n\nfn rand(co: vec2<f32>) -> f32\n{\n  return fract(sin(dot(co, vec2<f32>(12.9898, 78.233))) * 43758.5453);\n}\n\nfn overlay(src: vec3<f32>, dst: vec3<f32>) -> vec3<f32>\n{\n    // if (dst <= 0.5) then: 2 * src * dst\n    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)\n\n    return vec3<f32>(\n      select((1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)), (2.0 * src.x * dst.x), (dst.x <= 0.5)), \n      select((1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)), (2.0 * src.y * dst.y), (dst.y <= 0.5)),\n      select((1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)), (2.0 * src.z * dst.z), (dst.z <= 0.5))\n    );\n}\n\nfn sepia(co: vec3<f32>) -> vec3<f32>\n{\n  let gray: f32 = (co.x + co.y + co.z) / 3.0;\n  let grayscale: vec3<f32> = vec3<f32>(gray);\n  let color = overlay(SEPIA_RGB, grayscale);\n  return grayscale + oldFilmUniforms.uSepia * (color - grayscale);\n}\n\nfn vignette(co: vec3<f32>, coord: vec2<f32>) -> f32\n{\n  let uVignetting = oldFilmUniforms.uVignetting;\n  let uDimensions = oldFilmUniforms.uDimensions;\n  \n  let outter: f32 = SQRT_2 - uVignetting[0] * SQRT_2;\n  var dir: vec2<f32> = vec2<f32>(vec2<f32>(0.5) - coord);\n  dir.y *= uDimensions.y / uDimensions.x;\n  let darker: f32 = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignetting[2] * SQRT_2), 0.0, 1.0);\n  return darker + (1.0 - darker) * (1.0 - uVignetting[1]);\n}\n\nfn scratch(co: vec3<f32>, coord: vec2<f32>) -> vec3<f32>\n{\n  var color = co;\n  let uScratch = oldFilmUniforms.uScratch;\n  let uSeed = oldFilmUniforms.uSeed;\n  let uDimensions = oldFilmUniforms.uDimensions;\n\n  let phase: f32 = uSeed * 256.0;\n  let s: f32 = modulo(floor(phase), 2.0);\n  let dist: f32 = 1.0 / uScratch[1];\n  let d: f32 = distance(coord, vec2<f32>(uSeed * dist, abs(s - uSeed * dist)));\n\n  if (d < uSeed * 0.6 + 0.4)\n  {\n    let period: f32 = uScratch[1] * 10.0;\n\n    let xx: f32 = coord.x * period + phase;\n    let aa: f32 = abs(modulo(xx, 0.5) * 4.0);\n    let bb: f32 = modulo(floor(xx / 0.5), 2.0);\n    let yy: f32 = (1.0 - bb) * aa + bb * (2.0 - aa);\n\n    let kk: f32 = 2.0 * period;\n    let dw: f32 = uScratch[2] / uDimensions.x * (0.75 + uSeed);\n    let dh: f32 = dw * kk;\n\n    var tine: f32 = (yy - (2.0 - dh));\n\n    if (tine > 0.0) {\n        let _sign: f32 = sign(uScratch[0]);\n\n        tine = s * tine / period + uScratch[0] + 0.1;\n        tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);\n\n        color *= tine;\n    }\n  }\n\n  return color;\n}\n\nfn noise(coord: vec2<f32>) -> f32\n{\n  let uNoise = oldFilmUniforms.uNoise;\n  let uSeed = oldFilmUniforms.uSeed;\n\n  var pixelCoord: vec2<f32> = coord * gfu.uInputSize.xy;\n  pixelCoord.x = floor(pixelCoord.x / uNoise[1]);\n  pixelCoord.y = floor(pixelCoord.y / uNoise[1]);\n  return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uSepia;\nuniform vec2 uNoise;\nuniform vec3 uScratch;\nuniform vec3 uVignetting;\nuniform float uSeed;\nuniform vec2 uDimensions;\n\nuniform vec4 uInputSize;\n\nconst float SQRT_2 = 1.414213;\nconst vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvec3 Overlay(vec3 src, vec3 dst)\n{\n    // if (dst <= 0.5) then: 2 * src * dst\n    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)\n    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),\n                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),\n                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n}\n\n\nvoid main()\n{\n    finalColor = texture(uTexture, vTextureCoord);\n    vec3 color = finalColor.rgb;\n\n    if (uSepia > 0.0)\n    {\n        float gray = (color.x + color.y + color.z) / 3.0;\n        vec3 grayscale = vec3(gray);\n\n        color = Overlay(SEPIA_RGB, grayscale);\n\n        color = grayscale + uSepia * (color - grayscale);\n    }\n\n    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions.xy;\n\n    float vignette = uVignetting[0];\n    float vignetteAlpha = uVignetting[1];\n    float vignetteBlur = uVignetting[2];\n\n    if (vignette > 0.0)\n    {\n        float outter = SQRT_2 - vignette * SQRT_2;\n        vec2 dir = vec2(vec2(0.5, 0.5) - coord);\n        dir.y *= uDimensions.y / uDimensions.x;\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignetteBlur * SQRT_2), 0.0, 1.0);\n        color.rgb *= darker + (1.0 - darker) * (1.0 - vignetteAlpha);\n    }\n\n    float scratch = uScratch[0];\n    float scratchDensity = uScratch[1];\n    float scratchWidth = uScratch[2];\n\n    if (scratchDensity > uSeed && scratch != 0.0)\n    {\n        float phase = uSeed * 256.0;\n        float s = mod(floor(phase), 2.0);\n        float dist = 1.0 / scratchDensity;\n        float d = distance(coord, vec2(uSeed * dist, abs(s - uSeed * dist)));\n        if (d < uSeed * 0.6 + 0.4)\n        {\n            highp float period = scratchDensity * 10.0;\n\n            float xx = coord.x * period + phase;\n            float aa = abs(mod(xx, 0.5) * 4.0);\n            float bb = mod(floor(xx / 0.5), 2.0);\n            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);\n\n            float kk = 2.0 * period;\n            float dw = scratchWidth / uDimensions.x * (0.75 + uSeed);\n            float dh = dw * kk;\n\n            float tine = (yy - (2.0 - dh));\n\n            if (tine > 0.0) {\n                float _sign = sign(scratch);\n\n                tine = s * tine / period + scratch + 0.1;\n                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);\n\n                color.rgb *= tine;\n            }\n        }\n    }\n\n    float noise = uNoise[0];\n    float noiseSize = uNoise[1];\n\n    if (noise > 0.0 && noiseSize > 0.0)\n    {\n        vec2 pixelCoord = vTextureCoord.xy * uInputSize.xy;\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\n        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + uSeed * 512.0, 1024.0 - uSeed * 512.0);\n        // float _noise = snoise(d) * 0.5;\n        float _noise = rand(pixelCoord * noiseSize * uSeed) - 0.5;\n        color += _noise * noise;\n    }\n\n    finalColor.rgb = color;\n}",name:"old-film-filter"}),resources:{oldFilmUniforms:{uSepia:{value:e.sepia,type:"f32"},uNoise:{value:new Float32Array(2),type:"vec2<f32>"},uScratch:{value:new Float32Array(3),type:"vec3<f32>"},uVignetting:{value:new Float32Array(3),type:"vec3<f32>"},uSeed:{value:e.seed,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),L1(this,"uniforms"),L1(this,"seed"),this.uniforms=this.resources.oldFilmUniforms.uniforms,Object.assign(this,e)}apply(t,e,n,i){this.uniforms.uDimensions[0]=e.frame.width,this.uniforms.uDimensions[1]=e.frame.height,this.uniforms.uSeed=this.seed,t.applyFilter(this,e,n,i)}get sepia(){return this.uniforms.uSepia}set sepia(t){this.uniforms.uSepia=t}get noise(){return this.uniforms.uNoise[0]}set noise(t){this.uniforms.uNoise[0]=t}get noiseSize(){return this.uniforms.uNoise[1]}set noiseSize(t){this.uniforms.uNoise[1]=t}get scratch(){return this.uniforms.uScratch[0]}set scratch(t){this.uniforms.uScratch[0]=t}get scratchDensity(){return this.uniforms.uScratch[1]}set scratchDensity(t){this.uniforms.uScratch[1]=t}get scratchWidth(){return this.uniforms.uScratch[2]}set scratchWidth(t){this.uniforms.uScratch[2]=t}get vignetting(){return this.uniforms.uVignetting[0]}set vignetting(t){this.uniforms.uVignetting[0]=t}get vignettingAlpha(){return this.uniforms.uVignetting[1]}set vignettingAlpha(t){this.uniforms.uVignetting[1]=t}get vignettingBlur(){return this.uniforms.uVignetting[2]}set vignettingBlur(t){this.uniforms.uVignetting[2]=t}},"DEFAULT_OPTIONS",{sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,seed:0});var U1=Object.defineProperty,k1=(t,e,n)=>(((t,e,n)=>{e in t?U1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const N1=class t extends OS{constructor(...e){let n=e[0]??{};"number"==typeof n&&(qy(0,"OutlineFilter constructor params are now options object. See params: { thickness, color, quality, alpha, knockout }"),n={thickness:n},void 0!==e[1]&&(n.color=e[1]),void 0!==e[2]&&(n.quality=e[2]),void 0!==e[3]&&(n.alpha=e[3]),void 0!==e[4]&&(n.knockout=e[4])),n={...t.DEFAULT_OPTIONS,...n};const i=n.quality??.1;super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct OutlineUniforms {\n  uThickness:vec2<f32>,\n  uColor:vec3<f32>,\n  uAlpha:f32,\n  uAngleStep:f32,\n  uKnockout:f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> outlineUniforms : OutlineUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let sourceColor: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let contentColor: vec4<f32> = sourceColor * (1. - outlineUniforms.uKnockout);\n  \n  let outlineAlpha: f32 = outlineUniforms.uAlpha * outlineMaxAlphaAtPos(uv) * (1. - sourceColor.a);\n  let outlineColor: vec4<f32> = vec4<f32>(vec3<f32>(outlineUniforms.uColor) * outlineAlpha, outlineAlpha);\n  \n  return contentColor + outlineColor;\n}\n\nfn outlineMaxAlphaAtPos(uv: vec2<f32>) -> f32 {\n  let thickness = outlineUniforms.uThickness;\n\n  if (thickness.x == 0. || thickness.y == 0.) {\n    return 0.;\n  }\n  \n  let angleStep = outlineUniforms.uAngleStep;\n\n  var displacedColor: vec4<f32>;\n  var displacedPos: vec2<f32>;\n\n  var maxAlpha: f32 = 0.;\n  var displaced: vec2<f32>;\n  var curColor: vec4<f32>;\n\n  for (var angle = 0.; angle <= DOUBLE_PI; angle += angleStep)\n  {\n    displaced.x = uv.x + thickness.x * cos(angle);\n    displaced.y = uv.y + thickness.y * sin(angle);\n    curColor = textureSample(uTexture, uSampler, clamp(displaced, gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n    maxAlpha = max(maxAlpha, curColor.a);\n  }\n\n  return maxAlpha;\n}\n\nconst DOUBLE_PI: f32 = 3.14159265358979323846264 * 2.;",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uThickness;\nuniform vec3 uColor;\nuniform float uAlpha;\nuniform float uKnockout;\n\nuniform vec4 uInputClamp;\n\nconst float DOUBLE_PI = 2. * 3.14159265358979323846264;\nconst float ANGLE_STEP = ${ANGLE_STEP};\n\nfloat outlineMaxAlphaAtPos(vec2 pos) {\n    if (uThickness.x == 0. || uThickness.y == 0.) {\n        return 0.;\n    }\n\n    vec4 displacedColor;\n    vec2 displacedPos;\n    float maxAlpha = 0.;\n\n    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {\n        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);\n        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);\n        displacedColor = texture(uTexture, clamp(displacedPos, uInputClamp.xy, uInputClamp.zw));\n        maxAlpha = max(maxAlpha, displacedColor.a);\n    }\n\n    return maxAlpha;\n}\n\nvoid main(void) {\n    vec4 sourceColor = texture(uTexture, vTextureCoord);\n    vec4 contentColor = sourceColor * float(uKnockout < 0.5);\n    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);\n    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);\n    finalColor = contentColor + outlineColor;\n}\n".replace(/\$\{ANGLE_STEP\}/,t.getAngleStep(i).toFixed(7)),name:"outline-filter"}),resources:{outlineUniforms:{uThickness:{value:new Float32Array(2),type:"vec2<f32>"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:n.alpha,type:"f32"},uAngleStep:{value:0,type:"f32"},uKnockout:{value:n.knockout?1:0,type:"f32"}}}}),k1(this,"uniforms"),k1(this,"_thickness"),k1(this,"_quality"),k1(this,"_color"),this.uniforms=this.resources.outlineUniforms.uniforms,this.uniforms.uAngleStep=t.getAngleStep(i),this._color=new zx,this.color=n.color??0,Object.assign(this,n)}apply(t,e,n,i){this.uniforms.uThickness[0]=this.thickness/e.source.width,this.uniforms.uThickness[1]=this.thickness/e.source.height,t.applyFilter(this,e,n,i)}static getAngleStep(e){return parseFloat((2*Math.PI/Math.max(e*t.MAX_SAMPLES,t.MIN_SAMPLES)).toFixed(7))}get thickness(){return this._thickness}set thickness(t){this._thickness=this.padding=t}get color(){return this._color.value}set color(t){this._color.setValue(t);const[e,n,i]=this._color.toArray();this.uniforms.uColor[0]=e,this.uniforms.uColor[1]=n,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get quality(){return this._quality}set quality(e){this._quality=e,this.uniforms.uAngleStep=t.getAngleStep(e)}get knockout(){return 1===this.uniforms.uKnockout}set knockout(t){this.uniforms.uKnockout=t?1:0}};k1(N1,"DEFAULT_OPTIONS",{thickness:1,color:0,alpha:1,quality:.1,knockout:!1}),k1(N1,"MIN_SAMPLES",1),k1(N1,"MAX_SAMPLES",100);let z1=N1;var G1=Object.defineProperty,H1=(t,e,n)=>(((t,e,n)=>{e in t?G1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);H1(class t extends OS{constructor(...e){let n=e[0]??{};if("number"==typeof n){if(qy(0,"RadialBlurFilter constructor params are now options object. See params: { angle, center, kernelSize, radius }"),n={angle:n},e[1]){const t="x"in e[1]?e[1].x:e[1][0],i="y"in e[1]?e[1].y:e[1][1];n.center={x:t,y:i}}e[2]&&(n.kernelSize=e[2]),e[3]&&(n.radius=e[3])}n={...t.DEFAULT_OPTIONS,...n};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct RadialBlurUniforms {\n  uRadian: f32,\n  uCenter: vec2<f32>,\n  uKernelSize: f32,\n  uRadius: f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> radialBlurUniforms : RadialBlurUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uRadian = radialBlurUniforms.uRadian;\n  let uCenter = radialBlurUniforms.uCenter;\n  let uKernelSize = radialBlurUniforms.uKernelSize;\n  let uRadius = radialBlurUniforms.uRadius;\n  \n  var returnColorOnly = false;\n\n  if (uKernelSize == 0)\n  {\n    returnColorOnly = true;\n  }\n\n  let aspect: f32 = gfu.uInputSize.y / gfu.uInputSize.x;\n  let center: vec2<f32> = uCenter.xy / gfu.uInputSize.xy;\n  let gradient: f32 = uRadius / gfu.uInputSize.x * 0.3;\n  let radius: f32 = uRadius / gfu.uInputSize.x - gradient * 0.5;\n  let k: i32 = i32(uKernelSize - 1);\n\n  var coord: vec2<f32> = uv;\n  let dir: vec2<f32> = vec2<f32>(center - coord);\n  let dist: f32 = length(vec2<f32>(dir.x, dir.y * aspect));\n\n  var radianStep: f32 = uRadian;\n  \n  if (radius >= 0.0 && dist > radius)\n  {\n    let delta: f32 = dist - radius;\n    let gap: f32 = gradient;\n    let scale: f32 = 1.0 - abs(delta / gap);\n    if (scale <= 0.0) {\n      returnColorOnly = true;\n    }\n    radianStep *= scale;\n  }\n\n  radianStep /= f32(k);\n\n  let s: f32 = sin(radianStep);\n  let c: f32 = cos(radianStep);\n  let rotationMatrix: mat2x2<f32> = mat2x2<f32>(vec2<f32>(c, -s), vec2<f32>(s, c));\n  \n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let baseColor = vec4<f32>(color);\n\n  let minK: i32 = min(i32(uKernelSize) - 1, MAX_KERNEL_SIZE - 1);\n\n  for(var i: i32 = 0; i < minK; i += 1) \n  {\n    coord -= center;\n    coord.y *= aspect;\n    coord = rotationMatrix * coord;\n    coord.y /= aspect;\n    coord += center;\n    let sample: vec4<f32> = textureSample(uTexture, uSampler, coord);\n    // switch to pre-multiplied alpha to correctly blur transparent images\n    // sample.rgb *= sample.a;\n    color += sample;\n  }\n\n  return select(color / f32(uKernelSize), baseColor, returnColorOnly);\n}\n\nconst MAX_KERNEL_SIZE: i32 = 2048;",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uRadian;\nuniform vec2 uCenter;\nuniform float uRadius;\nuniform int uKernelSize;\n\nuniform vec4 uInputSize;\n\nconst int MAX_KERNEL_SIZE = 2048;\n\nvoid main(void)\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n\n    if (uKernelSize == 0)\n    {\n        finalColor = color;\n        return;\n    }\n\n    float aspect = uInputSize.y / uInputSize.x;\n    vec2 center = uCenter.xy / uInputSize.xy;\n    float gradient = uRadius / uInputSize.x * 0.3;\n    float radius = uRadius / uInputSize.x - gradient * 0.5;\n    int k = uKernelSize - 1;\n\n    vec2 coord = vTextureCoord;\n    vec2 dir = vec2(center - coord);\n    float dist = length(vec2(dir.x, dir.y * aspect));\n\n    float radianStep = uRadian;\n    if (radius >= 0.0 && dist > radius) {\n        float delta = dist - radius;\n        float gap = gradient;\n        float scale = 1.0 - abs(delta / gap);\n        if (scale <= 0.0) {\n            finalColor = color;\n            return;\n        }\n        radianStep *= scale;\n    }\n    radianStep /= float(k);\n\n    float s = sin(radianStep);\n    float c = cos(radianStep);\n    mat2 rotationMatrix = mat2(vec2(c, -s), vec2(s, c));\n\n    for(int i = 0; i < MAX_KERNEL_SIZE - 1; i++) {\n        if (i == k) {\n            break;\n        }\n\n        coord -= center;\n        coord.y *= aspect;\n        coord = rotationMatrix * coord;\n        coord.y /= aspect;\n        coord += center;\n\n        vec4 sample = texture(uTexture, coord);\n\n        // switch to pre-multiplied alpha to correctly blur transparent images\n        // sample.rgb *= sample.a;\n\n        color += sample;\n    }\n\n    finalColor = color / float(uKernelSize);\n}\n",name:"radial-blur-filter"}),resources:{radialBlurUniforms:{uRadian:{value:0,type:"f32"},uCenter:{value:n.center,type:"vec2<f32>"},uKernelSize:{value:n.kernelSize,type:"i32"},uRadius:{value:n.radius,type:"f32"}}}}),H1(this,"uniforms"),H1(this,"_angle"),H1(this,"_kernelSize"),this.uniforms=this.resources.radialBlurUniforms.uniforms,Object.assign(this,n)}_updateKernelSize(){this.uniforms.uKernelSize=0!==this._angle?this.kernelSize:0}get angle(){return this._angle}set angle(t){this._angle=t,this.uniforms.uRadian=t*Math.PI/180,this._updateKernelSize()}get center(){return this.uniforms.uCenter}set center(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uCenter=t}get centerX(){return this.center.x}set centerX(t){this.center.x=t}get centerY(){return this.center.y}set centerY(t){this.center.y=t}get kernelSize(){return this._kernelSize}set kernelSize(t){this._kernelSize=t,this._updateKernelSize()}get radius(){return this.uniforms.uRadius}set radius(t){this.uniforms.uRadius=t<0||t===1/0?-1:t}},"DEFAULT_OPTIONS",{angle:0,center:{x:0,y:0},kernelSize:5,radius:-1});var V1=Object.defineProperty,X1=(t,e,n)=>(((t,e,n)=>{e in t?V1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);X1(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct ReflectionUniforms {\n  uMirror: f32,\n  uBoundary: f32,\n  uAmplitude: vec2<f32>,\n  uWavelength: vec2<f32>,\n  uAlpha: vec2<f32>,\n  uTime: f32,\n  uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> reflectionUniforms : ReflectionUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uDimensions: vec2<f32> = reflectionUniforms.uDimensions;\n  let uBoundary: f32 = reflectionUniforms.uBoundary;\n  let uMirror: bool = reflectionUniforms.uMirror > 0.5;\n  let uAmplitude: vec2<f32> = reflectionUniforms.uAmplitude;\n  let uWavelength: vec2<f32> = reflectionUniforms.uWavelength;\n  let uAlpha: vec2<f32> = reflectionUniforms.uAlpha;\n  let uTime: f32 = reflectionUniforms.uTime;\n\n  let pixelCoord: vec2<f32> = uv * gfu.uInputSize.xy;\n  let coord: vec2<f32> = pixelCoord /uDimensions;\n  var returnColorOnly: bool = false;\n\n  if (coord.y < uBoundary) {\n    returnColorOnly = true;\n  }\n\n  let k: f32 = (coord.y - uBoundary) / (1. - uBoundary + 0.0001);\n  let areaY: f32 = uBoundary * uDimensions.y / gfu.uInputSize.y;\n  let v: f32 = areaY + areaY - uv.y;\n  let y: f32 = select(uv.y, v, uMirror);\n\n  let amplitude: f32 = ((uAmplitude.y - uAmplitude.x) * k + uAmplitude.x ) / gfu.uInputSize.x;\n  let waveLength: f32 = ((uWavelength.y - uWavelength.x) * k + uWavelength.x) / gfu.uInputSize.y;\n  let alpha: f32 = select((uAlpha.y - uAlpha.x) * k + uAlpha.x, 1., returnColorOnly);\n\n  var x: f32 = uv.x + cos(v * 6.28 / waveLength - uTime) * amplitude;\n  x = clamp(x, gfu.uInputClamp.x, gfu.uInputClamp.z);\n  \n  return textureSample(uTexture, uSampler, select(vec2<f32>(x, y), uv, returnColorOnly)) * alpha;\n}\n\nfn rand(co: vec2<f32>) -> f32 \n{\n  return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uMirror;\nuniform float uBoundary;\nuniform vec2 uAmplitude;\nuniform vec2 uWavelength;\nuniform vec2 uAlpha;\nuniform float uTime;\nuniform vec2 uDimensions;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    vec2 pixelCoord = vTextureCoord.xy * uInputSize.xy;\n    vec2 coord = pixelCoord / uDimensions;\n\n    if (coord.y < uBoundary) {\n        finalColor = texture(uTexture, vTextureCoord);\n        return;\n    }\n\n    float k = (coord.y - uBoundary) / (1. - uBoundary + 0.0001);\n    float areaY = uBoundary * uDimensions.y / uInputSize.y;\n    float v = areaY + areaY - vTextureCoord.y;\n    float y = uMirror > 0.5 ? v : vTextureCoord.y;\n\n    float _amplitude = ((uAmplitude.y - uAmplitude.x) * k + uAmplitude.x ) / uInputSize.x;\n    float _waveLength = ((uWavelength.y - uWavelength.x) * k + uWavelength.x) / uInputSize.y;\n    float _alpha = (uAlpha.y - uAlpha.x) * k + uAlpha.x;\n\n    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - uTime) * _amplitude;\n    x = clamp(x, uInputClamp.x, uInputClamp.z);\n\n    vec4 color = texture(uTexture, vec2(x, y));\n\n    finalColor = color * _alpha;\n}\n",name:"reflection-filter"}),resources:{reflectionUniforms:{uMirror:{value:e.mirror?1:0,type:"f32"},uBoundary:{value:e.boundary,type:"f32"},uAmplitude:{value:e.amplitude,type:"vec2<f32>"},uWavelength:{value:e.waveLength,type:"vec2<f32>"},uAlpha:{value:e.alpha,type:"vec2<f32>"},uTime:{value:e.time,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),X1(this,"uniforms"),X1(this,"time",0),this.uniforms=this.resources.reflectionUniforms.uniforms,Object.assign(this,e)}apply(t,e,n,i){this.uniforms.uDimensions[0]=e.frame.width,this.uniforms.uDimensions[1]=e.frame.height,this.uniforms.uTime=this.time,t.applyFilter(this,e,n,i)}get mirror(){return this.uniforms.uMirror>.5}set mirror(t){this.uniforms.uMirror=t?1:0}get boundary(){return this.uniforms.uBoundary}set boundary(t){this.uniforms.uBoundary=t}get amplitude(){return Array.from(this.uniforms.uAmplitude)}set amplitude(t){this.uniforms.uAmplitude[0]=t[0],this.uniforms.uAmplitude[1]=t[1]}get amplitudeStart(){return this.uniforms.uAmplitude[0]}set amplitudeStart(t){this.uniforms.uAmplitude[0]=t}get amplitudeEnd(){return this.uniforms.uAmplitude[1]}set amplitudeEnd(t){this.uniforms.uAmplitude[1]=t}get waveLength(){return Array.from(this.uniforms.uWavelength)}set waveLength(t){this.uniforms.uWavelength[0]=t[0],this.uniforms.uWavelength[1]=t[1]}get wavelengthStart(){return this.uniforms.uWavelength[0]}set wavelengthStart(t){this.uniforms.uWavelength[0]=t}get wavelengthEnd(){return this.uniforms.uWavelength[1]}set wavelengthEnd(t){this.uniforms.uWavelength[1]=t}get alpha(){return Array.from(this.uniforms.uAlpha)}set alpha(t){this.uniforms.uAlpha[0]=t[0],this.uniforms.uAlpha[1]=t[1]}get alphaStart(){return this.uniforms.uAlpha[0]}set alphaStart(t){this.uniforms.uAlpha[0]=t}get alphaEnd(){return this.uniforms.uAlpha[1]}set alphaEnd(t){this.uniforms.uAlpha[1]=t}},"DEFAULT_OPTIONS",{mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0});var W1=Object.defineProperty,j1=(t,e,n)=>(((t,e,n)=>{e in t?W1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);j1(class t extends OS{constructor(...e){let n=e[0]??{};(Array.isArray(n)||"x"in n&&"y"in n)&&(qy(0,"RGBSplitFilter constructor params are now options object. See params: { red, green, blue }"),n={red:n},void 0!==e[1]&&(n.green=e[1]),void 0!==e[2]&&(n.blue=e[2])),n={...t.DEFAULT_OPTIONS,...n};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct RgbSplitUniforms {\n    uRed: vec2<f32>,\n    uGreen: vec2<f32>,\n    uBlue: vec3<f32>,\n};\n\nstruct GlobalFilterUniforms {\n    uInputSize:vec4<f32>,\n    uInputPixel:vec4<f32>,\n    uInputClamp:vec4<f32>,\n    uOutputFrame:vec4<f32>,\n    uGlobalFrame:vec4<f32>,\n    uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> rgbSplitUniforms : RgbSplitUniforms;\n\n@fragment\nfn mainFragment(\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n    let r = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uRed.x / gfu.uInputSize.x, rgbSplitUniforms.uRed.y / gfu.uInputSize.y)).r;\n    let g = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uGreen.x / gfu.uInputSize.x, rgbSplitUniforms.uGreen.y / gfu.uInputSize.y)).g;\n    let b = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uBlue.x / gfu.uInputSize.x, rgbSplitUniforms.uBlue.y / gfu.uInputSize.y)).b;\n    let a = textureSample(uTexture, uSampler, uv).a;\n    return vec4<f32>(r, g, b, a);\n}\n",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec4 uInputSize;\nuniform vec2 uRed;\nuniform vec2 uGreen;\nuniform vec2 uBlue;\n\nvoid main(void)\n{\n   float r = texture(uTexture, vTextureCoord + uRed/uInputSize.xy).r;\n   float g = texture(uTexture, vTextureCoord + uGreen/uInputSize.xy).g;\n   float b = texture(uTexture, vTextureCoord + uBlue/uInputSize.xy).b;\n   float a = texture(uTexture, vTextureCoord).a;\n   finalColor = vec4(r, g, b, a);\n}\n",name:"rgb-split-filter"}),resources:{rgbSplitUniforms:{uRed:{value:n.red,type:"vec2<f32>"},uGreen:{value:n.green,type:"vec2<f32>"},uBlue:{value:n.blue,type:"vec2<f32>"}}}}),j1(this,"uniforms"),this.uniforms=this.resources.rgbSplitUniforms.uniforms,Object.assign(this,n)}get red(){return this.uniforms.uRed}set red(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uRed=t}get redX(){return this.red.x}set redX(t){this.red.x=t}get redY(){return this.red.y}set redY(t){this.red.y=t}get green(){return this.uniforms.uGreen}set green(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uGreen=t}get greenX(){return this.green.x}set greenX(t){this.green.x=t}get greenY(){return this.green.y}set greenY(t){this.green.y=t}get blue(){return this.uniforms.uBlue}set blue(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uBlue=t}get blueX(){return this.blue.x}set blueX(t){this.blue.x=t}get blueY(){return this.blue.y}set blueY(t){this.blue.y=t}},"DEFAULT_OPTIONS",{red:{x:-10,y:0},green:{x:0,y:10},blue:{x:0,y:0}});var Y1=Object.defineProperty,q1=(t,e,n)=>(((t,e,n)=>{e in t?Y1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);q1(class t extends OS{constructor(...e){let n=e[0]??{};(Array.isArray(n)||"x"in n&&"y"in n)&&(qy(0,"ShockwaveFilter constructor params are now options object. See params: { center, speed, amplitude, wavelength, brightness, radius, time }"),n={center:n,...e[1]},void 0!==e[2]&&(n.time=e[2])),n={...t.DEFAULT_OPTIONS,...n};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"\nstruct ShockWaveUniforms {\n    uTime: f32,\n    uOffset: vec2<f32>,\n    uSpeed: f32,\n    uWave: vec4<f32>,\n};\n\nstruct GlobalFilterUniforms {\n    uInputSize:vec4<f32>,\n    uInputPixel:vec4<f32>,\n    uInputClamp:vec4<f32>,\n    uOutputFrame:vec4<f32>,\n    uGlobalFrame:vec4<f32>,\n    uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> shockwaveUniforms : ShockWaveUniforms;\n\n@fragment\nfn mainFragment(\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n\n    let uTime = shockwaveUniforms.uTime;\n    let uOffset = shockwaveUniforms.uOffset;\n    let uSpeed = shockwaveUniforms.uSpeed;\n    let uAmplitude = shockwaveUniforms.uWave[0];\n    let uWavelength = shockwaveUniforms.uWave[1];\n    let uBrightness = shockwaveUniforms.uWave[2];\n    let uRadius = shockwaveUniforms.uWave[3];\n    let halfWavelength: f32 = uWavelength * 0.5 / gfu.uInputSize.x;\n    let maxRadius: f32 = uRadius / gfu.uInputSize.x;\n    let currentRadius: f32 = uTime * uSpeed / gfu.uInputSize.x;\n    var fade: f32 = 1.0;\n    var returnColorOnly: bool = false;\n    \n    if (maxRadius > 0.0) {\n        if (currentRadius > maxRadius) {\n            returnColorOnly = true;\n        }\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\n    }\n    var dir: vec2<f32> = vec2<f32>(uv - uOffset / gfu.uInputSize.xy);\n    dir.y *= gfu.uInputSize.y / gfu.uInputSize.x;\n\n    let dist:f32 = length(dir);\n\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\n        returnColorOnly = true;\n    }\n\n    let diffUV: vec2<f32> = normalize(dir);\n    let diff: f32 = (dist - currentRadius) / halfWavelength;\n    let p: f32 = 1.0 - pow(abs(diff), 2.0);\n    let powDiff: f32 = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );\n    let offset: vec2<f32> = diffUV * powDiff / gfu.uInputSize.xy;\n    // Do clamp :\n    let coord: vec2<f32> = uv + offset;\n    let clampedCoord: vec2<f32> = clamp(coord, gfu.uInputClamp.xy, gfu.uInputClamp.zw);\n\n    var clampedColor: vec4<f32> = textureSample(uTexture, uSampler, clampedCoord);\n    \n    if (boolVec2(coord, clampedCoord)) \n    {\n        clampedColor *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n    // No clamp :\n    var finalColor = clampedColor;\n\n    return select(finalColor, textureSample(uTexture, uSampler, uv), returnColorOnly);\n}\n\nfn boolVec2(x: vec2<f32>, y: vec2<f32>) -> bool\n{\n    if (x.x == y.x && x.y == y.y)\n    {\n        return true;\n    }\n    \n    return false;\n}\n\nconst PI: f32 = 3.14159265358979323846264;\n",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"\nprecision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uCenter;\nuniform float uTime;\nuniform float uSpeed;\nuniform vec4 uWave;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nconst float PI = 3.14159;\n\nvoid main()\n{\n    float uAmplitude = uWave[0];\n    float uWavelength = uWave[1];\n    float uBrightness = uWave[2];\n    float uRadius = uWave[3];\n\n    float halfWavelength = uWavelength * 0.5 / uInputSize.x;\n    float maxRadius = uRadius / uInputSize.x;\n    float currentRadius = uTime * uSpeed / uInputSize.x;\n\n    float fade = 1.0;\n\n    if (maxRadius > 0.0) {\n        if (currentRadius > maxRadius) {\n            finalColor = texture(uTexture, vTextureCoord);\n            return;\n        }\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\n    }\n\n    vec2 dir = vec2(vTextureCoord - uCenter / uInputSize.xy);\n    dir.y *= uInputSize.y / uInputSize.x;\n    float dist = length(dir);\n\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\n        finalColor = texture(uTexture, vTextureCoord);\n        return;\n    }\n\n    vec2 diffUV = normalize(dir);\n\n    float diff = (dist - currentRadius) / halfWavelength;\n\n    float p = 1.0 - pow(abs(diff), 2.0);\n\n    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );\n    float powDiff = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );\n\n    vec2 offset = diffUV * powDiff / uInputSize.xy;\n\n    // Do clamp :\n    vec2 coord = vTextureCoord + offset;\n    vec2 clampedCoord = clamp(coord, uInputClamp.xy, uInputClamp.zw);\n    vec4 color = texture(uTexture, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    // No clamp :\n    // finalColor = texture(uTexture, vTextureCoord + offset);\n\n    color.rgb *= 1.0 + (uBrightness - 1.0) * p * fade;\n\n    finalColor = color;\n}\n",name:"shockwave-filter"}),resources:{shockwaveUniforms:{uTime:{value:n.time,type:"f32"},uCenter:{value:n.center,type:"vec2<f32>"},uSpeed:{value:n.speed,type:"f32"},uWave:{value:new Float32Array(4),type:"vec4<f32>"}}}}),q1(this,"uniforms"),q1(this,"time"),this.time=0,this.uniforms=this.resources.shockwaveUniforms.uniforms,Object.assign(this,n)}apply(t,e,n,i){this.uniforms.uTime=this.time,t.applyFilter(this,e,n,i)}get center(){return this.uniforms.uCenter}set center(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uCenter=t}get centerX(){return this.uniforms.uCenter.x}set centerX(t){this.uniforms.uCenter.x=t}get centerY(){return this.uniforms.uCenter.y}set centerY(t){this.uniforms.uCenter.y=t}get speed(){return this.uniforms.uSpeed}set speed(t){this.uniforms.uSpeed=t}get amplitude(){return this.uniforms.uWave[0]}set amplitude(t){this.uniforms.uWave[0]=t}get wavelength(){return this.uniforms.uWave[1]}set wavelength(t){this.uniforms.uWave[1]=t}get brightness(){return this.uniforms.uWave[2]}set brightness(t){this.uniforms.uWave[2]=t}get radius(){return this.uniforms.uWave[3]}set radius(t){this.uniforms.uWave[3]=t}},"DEFAULT_OPTIONS",{center:{x:0,y:0},speed:500,amplitude:30,wavelength:160,brightness:1,radius:-1});var K1=Object.defineProperty,J1=(t,e,n)=>(((t,e,n)=>{e in t?K1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);J1(class t extends OS{constructor(...e){let n=e[0]??{};if(n instanceof ox&&(qy(0,"SimpleLightmapFilter constructor params are now options object. See params: { lightMap, color, alpha }"),n={lightMap:n},void 0!==e[1]&&(n.color=e[1]),void 0!==e[2]&&(n.alpha=e[2])),n={...t.DEFAULT_OPTIONS,...n},!n.lightMap)throw Error("No light map texture source was provided to SimpleLightmapFilter");super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct SimpleLightmapUniforms {\n  uColor: vec3<f32>,\n  uAlpha: f32,\n  uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> simpleLightmapUniforms : SimpleLightmapUniforms;\n@group(1) @binding(1) var uMapTexture: texture_2d<f32>;\n@group(1) @binding(2) var uMapSampler: sampler;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>,\n) -> @location(0) vec4<f32> {\n  let uColor = simpleLightmapUniforms.uColor;\n  let uAlpha = simpleLightmapUniforms.uAlpha;\n  let uDimensions = simpleLightmapUniforms.uDimensions;\n\n  let diffuseColor: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let lightCoord: vec2<f32> = (uv * gfu.uInputSize.xy) / simpleLightmapUniforms.uDimensions;\n  let light: vec4<f32> = textureSample(uMapTexture, uMapSampler, lightCoord);\n  let ambient: vec3<f32> = uColor * uAlpha;\n  let intensity: vec3<f32> = ambient + light.rgb;\n  let finalColor: vec3<f32> = diffuseColor.rgb * intensity;\n  return vec4<f32>(finalColor, diffuseColor.a);\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMapTexture;\nuniform vec3 uColor;\nuniform float uAlpha;\nuniform vec2 uDimensions;\n\nuniform vec4 uInputSize;\n\nvoid main() {\n    vec4 diffuseColor = texture(uTexture, vTextureCoord);\n    vec2 lightCoord = (vTextureCoord * uInputSize.xy) / uDimensions;\n    vec4 light = texture(uMapTexture, lightCoord);\n    vec3 ambient = uColor.rgb * uAlpha;\n    vec3 intensity = ambient + light.rgb;\n    vec3 color = diffuseColor.rgb * intensity;\n    finalColor = vec4(color, diffuseColor.a);\n}\n",name:"simple-lightmap-filter"}),resources:{simpleLightmapUniforms:{uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:n.alpha,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}},uMapTexture:n.lightMap.source,uMapSampler:n.lightMap.source.style}}),J1(this,"uniforms"),J1(this,"_color"),J1(this,"_lightMap"),this.uniforms=this.resources.simpleLightmapUniforms.uniforms,this._color=new zx,this.color=n.color??0,Object.assign(this,n)}apply(t,e,n,i){this.uniforms.uDimensions[0]=e.frame.width,this.uniforms.uDimensions[1]=e.frame.height,t.applyFilter(this,e,n,i)}get lightMap(){return this._lightMap}set lightMap(t){this._lightMap=t,this.resources.uMapTexture=t.source,this.resources.uMapSampler=t.source.style}get color(){return this._color.value}set color(t){this._color.setValue(t);const[e,n,i]=this._color.toArray();this.uniforms.uColor[0]=e,this.uniforms.uColor[1]=n,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},"DEFAULT_OPTIONS",{lightMap:ox.WHITE,color:0,alpha:1});var Z1=Object.defineProperty,Q1=(t,e,n)=>(((t,e,n)=>{e in t?Z1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);Q1(class t extends OS{constructor(e){const{width:n,height:i}=GF.defaultOptions;e={...t.DEFAULT_OPTIONS,start:{x:0,y:i/2},end:{x:n,y:i/2},...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct TiltShiftUniforms {\n  uBlur: vec2<f32>,\n  uStart: vec2<f32>,\n  uEnd: vec2<f32>,\n  uDelta: vec2<f32>,\n  uDimensions: vec2<f32>,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> tiltShiftUniforms : TiltShiftUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uBlur = tiltShiftUniforms.uBlur[0];\n  let uBlurGradient = tiltShiftUniforms.uBlur[1];\n  let uStart = tiltShiftUniforms.uStart;\n  let uEnd = tiltShiftUniforms.uEnd;\n  let uDelta = tiltShiftUniforms.uDelta;\n  let uDimensions = tiltShiftUniforms.uDimensions;\n\n  var color: vec4<f32> = vec4<f32>(0.0);\n  var total: f32 = 0.0;\n\n  let offset: f32 = random(position, vec3<f32>(12.9898, 78.233, 151.7182), 0.0);\n  let normal: vec2<f32> = normalize(vec2<f32>(uStart.y - uEnd.y, uEnd.x - uStart.x));\n  let radius: f32 = smoothstep(0.0, 1.0, abs(dot(uv * uDimensions - uStart, normal)) / uBlurGradient) * uBlur;\n\n  for (var t: f32 = -30.0; t <= 30.0; t += 1.0)\n  {\n    var percent: f32 = (t + offset - 0.5) / 30.0;\n    var weight: f32 = 1.0 - abs(percent);\n    var sample: vec4<f32> = textureSample(uTexture, uSampler, uv + uDelta / uDimensions * percent * radius);\n    sample = vec4<f32>(sample.xyz * sample.a, sample.a); // multiply sample.rgb with sample.a\n    color += sample * weight;\n    total += weight;\n  }\n\n  color /= total;\n  color = vec4<f32>(color.xyz / (color.a + 0.00001), color.a); // divide color.rgb by color.a + 0.00001\n\n  return color;\n}\n\n\nfn random(position: vec4<f32>, scale: vec3<f32>, seed: f32) -> f32\n{\n  return fract(sin(dot(position.xyz + seed, scale)) * 43758.5453 + seed);\n}",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uBlur;\nuniform vec2 uStart;\nuniform vec2 uEnd;\nuniform vec2 uDelta;\nuniform vec2 uDimensions;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float blur = uBlur[0];\n    float gradientBlur = uBlur[1];\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(uStart.y - uEnd.y, uEnd.x - uStart.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * uDimensions - uStart, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture(uTexture, vTextureCoord + uDelta / uDimensions * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    color /= total;\n    color.rgb /= color.a + 0.00001;\n\n    finalColor = color;\n}\n",name:"tilt-shift-axis-filter"}),resources:{tiltShiftUniforms:{uBlur:{value:new Float32Array([e.blur,e.gradientBlur]),type:"vec2<f32>"},uStart:{value:e.start,type:"vec2<f32>"},uEnd:{value:e.end,type:"vec2<f32>"},uDelta:{value:new Float32Array([0,0]),type:"vec2<f32>"},uDimensions:{value:new Float32Array([n,i]),type:"vec2<f32>"}}}}),Q1(this,"uniforms"),Q1(this,"_tiltAxis"),this.uniforms=this.resources.tiltShiftUniforms.uniforms,this._tiltAxis=e.axis}updateDimensions(t){const{uDimensions:e}=this.uniforms;e[0]=t.frame.width,e[1]=t.frame.height}updateDelta(){if(this.uniforms.uDelta[0]=0,this.uniforms.uDelta[1]=0,void 0===this._tiltAxis)return;const t=this.uniforms.uEnd,e=this.uniforms.uStart,n=t.x-e.x,i=t.y-e.y,r=Math.sqrt(n*n+i*i),s="vertical"===this._tiltAxis;this.uniforms.uDelta[0]=s?-i/r:n/r,this.uniforms.uDelta[1]=s?n/r:i/r}},"DEFAULT_OPTIONS",{blur:100,gradientBlur:600});var $1=Object.defineProperty,t2=(t,e,n)=>(((t,e,n)=>{e in t?$1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);t2(class t extends OS{constructor(e){e={...t.DEFAULT_OPTIONS,...e};super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct TwistUniforms {\n  uTwist:vec2<f32>,\n  uOffset:vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> twistUniforms : TwistUniforms;\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n  return textureSample(uTexture, uSampler, unmapCoord(twist(mapCoord(uv))));\n}\n\nfn mapCoord(coord: vec2<f32> ) -> vec2<f32>\n{\n  var mappedCoord: vec2<f32> = coord;\n  mappedCoord *= gfu.uInputSize.xy;\n  mappedCoord += gfu.uOutputFrame.xy;\n  return mappedCoord;\n}\n\nfn unmapCoord(coord: vec2<f32> ) -> vec2<f32>\n{\n  var mappedCoord: vec2<f32> = coord;\n  mappedCoord -= gfu.uOutputFrame.xy;\n  mappedCoord /= gfu.uInputSize.xy;\n  return mappedCoord;\n}\n\nfn twist(coord: vec2<f32>) -> vec2<f32>\n{\n  var twistedCoord: vec2<f32> = coord;\n  let uRadius = twistUniforms.uTwist[0];\n  let uAngle = twistUniforms.uTwist[1];\n  let uOffset = twistUniforms.uOffset;\n\n  twistedCoord -= uOffset;\n  \n  let dist = length(twistedCoord);\n\n  if (dist < uRadius)\n  {\n    let ratioDist: f32 = (uRadius - dist) / uRadius;\n    let angleMod: f32 = ratioDist * ratioDist * uAngle;\n    let s: f32 = sin(angleMod);\n    let c: f32 = cos(angleMod);\n    twistedCoord = vec2<f32>(twistedCoord.x * c - twistedCoord.y * s, twistedCoord.x * s + twistedCoord.y * c);\n  }\n\n  twistedCoord += uOffset;\n  return twistedCoord;\n}\n",entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uTwist;\nuniform vec2 uOffset;\nuniform vec4 uInputSize;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= uInputSize.xy;\n    coord += uInputSize.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= uInputSize.zw;\n    coord /= uInputSize.xy;\n\n    return coord;\n}\n\nvec2 twist(vec2 coord)\n{\n    coord -= uOffset;\n\n    float dist = length(coord);\n    float uRadius = uTwist[0];\n    float uAngle = uTwist[1];\n\n    if (dist < uRadius)\n    {\n        float ratioDist = (uRadius - dist) / uRadius;\n        float angleMod = ratioDist * ratioDist * uAngle;\n        float s = sin(angleMod);\n        float c = cos(angleMod);\n        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n    }\n\n    coord += uOffset;\n\n    return coord;\n}\n\nvoid main(void)\n{\n    vec2 coord = mapCoord(vTextureCoord);\n    coord = twist(coord);\n    coord = unmapCoord(coord);\n    finalColor = texture(uTexture, coord);\n}\n",name:"twist-filter"}),resources:{twistUniforms:{uTwist:{value:[e.radius??0,e.angle??0],type:"vec2<f32>"},uOffset:{value:e.offset,type:"vec2<f32>"}}},...e}),t2(this,"uniforms"),this.uniforms=this.resources.twistUniforms.uniforms}get radius(){return this.uniforms.uTwist[0]}set radius(t){this.uniforms.uTwist[0]=t}get angle(){return this.uniforms.uTwist[1]}set angle(t){this.uniforms.uTwist[1]=t}get offset(){return this.uniforms.uOffset}set offset(t){this.uniforms.uOffset=t}get offsetX(){return this.offset.x}set offsetX(t){this.offset.x=t}get offsetY(){return this.offset.y}set offsetY(t){this.offset.y=t}},"DEFAULT_OPTIONS",{padding:20,radius:200,angle:4,offset:{x:0,y:0}});var e2=Object.defineProperty,n2=(t,e,n)=>(((t,e,n)=>{e in t?e2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);n2(class t extends OS{constructor(e){const n=(e={...t.DEFAULT_OPTIONS,...e}).maxKernelSize??32;super({gpuProgram:xS.from({vertex:{source:M0,entryPoint:"mainVertex"},fragment:{source:"struct ZoomBlurUniforms {\n    uStrength:f32,\n    uCenter:vec2<f32>,\n    uRadii:vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> zoomBlurUniforms : ZoomBlurUniforms;\n\n@fragment\nfn mainFragment(\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uStrength = zoomBlurUniforms.uStrength;\n  let uCenter = zoomBlurUniforms.uCenter;\n  let uRadii = zoomBlurUniforms.uRadii;\n\n  let minGradient: f32 = uRadii[0] * 0.3;\n  let innerRadius: f32 = (uRadii[0] + minGradient * 0.5) / gfu.uInputSize.x;\n\n  let gradient: f32 = uRadii[1] * 0.3;\n  let radius: f32 = (uRadii[1] - gradient * 0.5) / gfu.uInputSize.x;\n\n  let MAX_KERNEL_SIZE: f32 = ${MAX_KERNEL_SIZE};\n\n  var countLimit: f32 = MAX_KERNEL_SIZE;\n\n  var dir: vec2<f32> = vec2<f32>(uCenter / gfu.uInputSize.xy - uv);\n  let dist: f32 = length(vec2<f32>(dir.x, dir.y * gfu.uInputSize.y / gfu.uInputSize.x));\n\n  var strength: f32 = uStrength;\n\n  var delta: f32 = 0.0;\n  var gap: f32;\n\n  if (dist < innerRadius) {\n      delta = innerRadius - dist;\n      gap = minGradient;\n  } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity\n      delta = dist - radius;\n      gap = gradient;\n  }\n\n  var returnColorOnly: bool = false;\n\n  if (delta > 0.0) {\n    let normalCount: f32 = gap / gfu.uInputSize.x;\n    delta = (normalCount - delta) / normalCount;\n    countLimit *= delta;\n    strength *= delta;\n    \n    if (countLimit < 1.0)\n    {\n      returnColorOnly = true;;\n    }\n  }\n\n  // randomize the lookup values to hide the fixed number of samples\n  let offset: f32 = rand(uv, 0.0);\n\n  var total: f32 = 0.0;\n  var color: vec4<f32> = vec4<f32>(0.);\n\n  dir *= strength;\n\n  for (var t = 0.0; t < MAX_KERNEL_SIZE; t += 1.0) {\n    let percent: f32 = (t + offset) / MAX_KERNEL_SIZE;\n    let weight: f32 = 4.0 * (percent - percent * percent);\n    let p: vec2<f32> = uv + dir * percent;\n    let sample: vec4<f32> = textureSample(uTexture, uSampler, p);\n    \n    if (t < countLimit)\n    {\n      color += sample * weight;\n      total += weight;\n    }\n  }\n\n  color /= total;\n\n  return select(color, textureSample(uTexture, uSampler, uv), returnColorOnly);\n}\n\nfn modulo(x: f32, y: f32) -> f32\n{\n  return x - y * floor(x/y);\n}\n\n// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nfn rand(co: vec2<f32>, seed: f32) -> f32\n{\n  let a: f32 = 12.9898;\n  let b: f32 = 78.233;\n  let c: f32 = 43758.5453;\n  let dt: f32 = dot(co + seed, vec2<f32>(a, b));\n  let sn: f32 = modulo(dt, 3.14159);\n  return fract(sin(sn) * c + seed);\n}".replace("${MAX_KERNEL_SIZE}",n.toFixed(1)),entryPoint:"mainFragment"}}),glProgram:lS.from({vertex:T0,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uStrength;\nuniform vec2 uCenter;\nuniform vec2 uRadii;\n\nuniform vec4 uInputSize;\n\nconst float MAX_KERNEL_SIZE = ${MAX_KERNEL_SIZE};\n\n// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand(vec2 co, float seed) {\n    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);\n    return fract(sin(sn) * c + seed);\n}\n\nvoid main() {\n    float minGradient = uRadii[0] * 0.3;\n    float innerRadius = (uRadii[0] + minGradient * 0.5) / uInputSize.x;\n\n    float gradient = uRadii[1] * 0.3;\n    float radius = (uRadii[1] - gradient * 0.5) / uInputSize.x;\n\n    float countLimit = MAX_KERNEL_SIZE;\n\n    vec2 dir = vec2(uCenter.xy / uInputSize.xy - vTextureCoord);\n    float dist = length(vec2(dir.x, dir.y * uInputSize.y / uInputSize.x));\n\n    float strength = uStrength;\n\n    float delta = 0.0;\n    float gap;\n    if (dist < innerRadius) {\n        delta = innerRadius - dist;\n        gap = minGradient;\n    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity\n        delta = dist - radius;\n        gap = gradient;\n    }\n\n    if (delta > 0.0) {\n        float normalCount = gap / uInputSize.x;\n        delta = (normalCount - delta) / normalCount;\n        countLimit *= delta;\n        strength *= delta;\n        if (countLimit < 1.0)\n        {\n            gl_FragColor = texture(uTexture, vTextureCoord);\n            return;\n        }\n    }\n\n    // randomize the lookup values to hide the fixed number of samples\n    float offset = rand(vTextureCoord, 0.0);\n\n    float total = 0.0;\n    vec4 color = vec4(0.0);\n\n    dir *= strength;\n\n    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {\n        float percent = (t + offset) / MAX_KERNEL_SIZE;\n        float weight = 4.0 * (percent - percent * percent);\n        vec2 p = vTextureCoord + dir * percent;\n        vec4 sample = texture(uTexture, p);\n\n        // switch to pre-multiplied alpha to correctly blur transparent images\n        // sample.rgb *= sample.a;\n\n        color += sample * weight;\n        total += weight;\n\n        if (t > countLimit){\n            break;\n        }\n    }\n\n    color /= total;\n    // switch back from pre-multiplied alpha\n    // color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n".replace("${MAX_KERNEL_SIZE}",n.toFixed(1)),name:"zoom-blur-filter"}),resources:{zoomBlurUniforms:{uStrength:{value:e.strength,type:"f32"},uCenter:{value:e.center,type:"vec2<f32>"},uRadii:{value:new Float32Array(2),type:"vec2<f32>"}}}}),n2(this,"uniforms"),this.uniforms=this.resources.zoomBlurUniforms.uniforms,Object.assign(this,e)}get strength(){return this.uniforms.uStrength}set strength(t){this.uniforms.uStrength=t}get center(){return this.uniforms.uCenter}set center(t){Array.isArray(t)&&(t={x:t[0],y:t[1]}),this.uniforms.uCenter=t}get centerX(){return this.uniforms.uCenter.x}set centerX(t){this.uniforms.uCenter.x=t}get centerY(){return this.uniforms.uCenter.y}set centerY(t){this.uniforms.uCenter.y=t}get innerRadius(){return this.uniforms.uRadii[0]}set innerRadius(t){this.uniforms.uRadii[0]=t}get radius(){return this.uniforms.uRadii[1]}set radius(t){this.uniforms.uRadii[1]=t<0||t===1/0?-1:t}},"DEFAULT_OPTIONS",{strength:.1,center:{x:0,y:0},innerRadius:0,radius:-1,maxKernelSize:32});class i2{constructor(t){n(this,"node"),n(this,"defaults",null),n(this,"filters",{}),this.node=t}update(t){t&&(this.node.filters&&Array.isArray(this.node.filters)&&(this.node.filters=this.node.filters.filter(e=>!e.isStudioFilter||!(!e.type||!t.filters[e.type]))),Object.values(t.filters).forEach(t=>{let e;Array.isArray(this.node.filters)||(this.node.filters=[]),Array.isArray(this.node.filters)&&(e=this.node.filters.find(e=>e.type===t.type&&e.isStudioFilter)),e||("adjustment"===t.type?e=new P0(t):"advancedBloom"===t.type?e=new G0(t):"kawaseBlur"===t.type?e=new D0(t):"outline"===t.type?e=new z1(t):"glow"===t.type?e=new A1(t):"colorOverlay"===t.type&&(e=new c1),e&&(e.type=t.type,e.isStudioFilter=!0,this.node.filters=[...this.node.filters,e])),e&&Object.assign(e,t)}),this.defaults||(this.defaults=this.get()))}get(){return{type:"filters2D",filters:this.filters}}}const r2=Gk.getInstance();class s2{constructor(t){n(this,"node",null),n(this,"transform"),n(this,"responsive"),n(this,"physics"),n(this,"scripts"),n(this,"transitionFX"),n(this,"filters"),n(this,"defaults",null),n(this,"core",{}),this.node=t,this.transform=new x0(this.node),this.node.body&&(this.physics=new _0(this.node))}add(t,e){switch(t){case"responsive2D":this.responsive=new b0(this.node),r2.emit("transformer_handles_are_dirty");break;case"physics":this.physics=new _0(this.node);break;case"scripts":return this.scripts||(this.scripts=new Wj(this.node)),this.scripts;case"transitionFX":this.transitionFX=new w0(this.node);break;case"filters2D":this.filters=new i2(this.node);break;default:this.core[t]=e}}remove(t){var e;switch(t){case"responsive2D":this.responsive=void 0,r2.emit("transformer_handles_are_dirty");break;case"physics":this.physics=void 0;break;case"transitionFX":this.transitionFX=void 0;break;case"scripts":null==(e=this.scripts)||e.scripts.forEach(t=>{var e;null==(e=this.scripts)||e.remove(t)}),this.scripts=void 0;break;case"filters2D":this.filters=void 0}}removeAll(){this.remove("scripts")}updateComponents(t){this.defaults=t,this.transform.update(t.node2D),this.responsive&&this.responsive.update(t.responsive2D),this.physics&&this.physics.update(t.physics),this.transitionFX&&this.transitionFX.update(t.transitionFX),this.filters&&this.filters.update(t.filters2D)}update(t){this.scripts&&this.scripts.update(t)}resize(t,e){var n,i,r,s,a,o,l;if("container"===(null==(n=this.node)?void 0:n.type)){const t=this.node.getContainerComponent();t&&t.landscape&&this.node.updateContainerComponent(t)}(null==(i=this.node)?void 0:i.preResize)&&this.node.preResize(t,e),this.responsive&&(this.responsive.update(this.get("responsive").data),this.transform.updateBaseValues()),"layout2D"===this.node.type&&this.node.updateLayoutComponent(this.node.getLayoutComponent()),"container"===(null==(s=null==(r=this.node)?void 0:r.parent)?void 0:s.type)&&"cell2D"===(null==(a=this.node)?void 0:a.type)&&(null==(l=null==(o=this.node)?void 0:o.onResizeCallback)||l.call(o,t,e)),this.scripts&&this.scripts.resize(t,e),this.transform.applyDynamicPosition(),this.transform.updateDynamicPosition(t,e),this.transform.updateDynamicOffset(t,e)}get(t){switch(t){case"transform":return this.transform.get();case"responsive":return this.responsive?this.responsive.get():null;case"physics":return this.physics?this.physics.get():null;case"scripts":return this.scripts;case"transitionFX":return this.transitionFX?this.transitionFX.get():null;case"filters2D":return this.filters?this.filters.get():null;default:return this.core[t]}}getAll(){return{transform:this.transform,responsive:this.responsive,physics:this.physics,transitionFX:this.transitionFX,filters:this.filters,core:this.core}}setCoreComponent(t,e){this.core[t]=e}}let a2=class extends MO{constructor(){super(),n(this,"id",""),n(this,"type","graphics"),n(this,"components"),n(this,"selected",!1),n(this,"locked",!1),n(this,"focusedShapeId",null),this.components=new s2(this)}updateGraphicsComponent(t){this.focusedShapeId=t.focusedShapeId,this.clear();for(const e in t.shapes)if(Object.prototype.hasOwnProperty.call(t.shapes,e)){const n=t.shapes[e],{type:i}=n,{position:r,fill:s,stroke:a}=n,{x:o,y:l}=r;if("rectangle"===i){const{width:t,height:e,roundRadius:i}=n;0===i?this.rect(o,l,t,e):this.roundRect(o,l,t,e,i)}else if("circle"===i){const{radius:t}=n;this.circle(o,l,t)}else if("ellipse"===i){const{width:t,height:e}=n;this.ellipse(o,l,t,e)}else if("star"===i){const{points:t,radius:e,innerRadius:i,rotation:r}=n;this.star(o,l,t,e,i,r)}else if("line"===i){const{moveTo:t,lines:e}=n;this.moveTo(t.x,t.y);for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&this.lineTo(e[n].x,e[n].y)}else if("polygon"===i){const{points:t,closePath:e}=n,i=[];for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.push({x:t[n].x+o,y:t[n].y+l});this.poly(i,e)}if(s.enabled){const e=this.convertToFillStyle(s.color,this.height,t.gradientBoxDataObject);e.fill?(e.alpha=s.alpha,this.fill(e)):this.fill({color:e.color,alpha:s.alpha})}a.enabled&&this.stroke({width:a.width,color:a.color,alpha:a.alpha})}}updateComponents(t){const e=t.graphics;e&&this.updateGraphicsComponent(e),super.updateComponents(t)}},o2=class extends OO{constructor({x:t=0,y:e=0,texture:i=""}){super({texture:u0.getTexture(i,t=>{this._setTextureFrame(t)})||ox.EMPTY,x:t,y:e,tilePosition:{x:0,y:0},tileScale:{x:1,y:1}}),n(this,"type","tilingSprite"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"textureData",{type:"texture",path:"",uploadId:"",stuffs:null,stuffsDataId:"",localPath:""}),n(this,"textureDataLandscape",{type:"texture",path:"",uploadId:"",stuffs:null,stuffsDataId:"",localPath:""}),n(this,"lanscapeEnabled",!1),this.initComponentSystem()}updateTilingSpriteComponent(t){this.updateTextureData(t),this.width=t.width,this.height=t.height,this.tilePosition=t.tilePosition,this.tileScale=t.tileScale,this.baseWidth=this.width,this.baseHeight=this.height,t.tint&&(this.tint=new zx(t.tint))}getTilingSpriteComponent(){return{type:"tilingSprite",texture:this.textureData,landscapeTexture:this.textureDataLandscape,landscape:this.lanscapeEnabled,tint:this.tint.toString(16),width:this.width,height:this.height,tilePosition:{x:this.tilePosition.x,y:this.tilePosition.y,linked:!0},tileScale:{x:this.tileScale.x,y:this.tileScale.y,linked:!0}}}updateComponents(t){const e=t.tilingSprite;e&&this.updateTilingSpriteComponent(e),super.updateComponents(t)}preResize(){this.updateTilingSpriteComponent(this.getTilingSpriteComponent())}};class l2{constructor(t){this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var h2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function c2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u2,d2={exports:{}};u2=d2,function(){var t,e;t={linear:function(t,e,n,i){return n*t/i+e},easeInQuad:function(t,e,n,i){return n*(t/=i)*t+e},easeOutQuad:function(t,e,n,i){return-n*(t/=i)*(t-2)+e},easeInOutQuad:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,n,i){return n*(t/=i)*t*t+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},easeInOutCubic:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,n,i){return n*(t/=i)*t*t*t+e},easeOutQuart:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,n,i){return n*(t/=i)*t*t*t*t+e},easeOutQuint:function(t,e,n,i){return n*((t=t/i-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+e},easeOutSine:function(t,e,n,i){return n*Math.sin(t/i*(Math.PI/2))+e},easeInOutSine:function(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e},easeInExpo:function(t,e,n,i){return 0===t?e:n*Math.pow(2,10*(t/i-1))+e},easeOutExpo:function(t,e,n,i){return t===i?e+n:n*(1-Math.pow(2,-10*t/i))+e},easeInOutExpo:function(t,e,n,i){return(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+e},easeOutCirc:function(t,e,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+e},easeInOutCirc:function(t,e,n,i){return(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,n,i){var r,s,a;return a=1.70158,0===t||(t/=i),(s=0)||(s=.3*i),(r=n)<Math.abs(n)?(r=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/s)+e},easeOutElastic:function(t,e,n,i){var r,s,a;return a=1.70158,0===t||(t/=i),(s=0)||(s=.3*i),(r=n)<Math.abs(n)?(r=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*i-a)*(2*Math.PI)/s)+n+e},easeInOutElastic:function(t,e,n,i){var r,s,a;return a=1.70158,0===t||(t/=i/2),(s=0)||(s=i*(.3*1.5)),(r=n)<Math.abs(n)?(r=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/s)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/s)*.5+n+e},easeInBack:function(t,e,n,i,r){return void 0===r&&(r=1.70158),n*(t/=i)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,n,i,r){return void 0===r&&(r=1.70158),n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,n,i,r){return void 0===r&&(r=1.70158),(t/=i/2)<1?n/2*(t*t*((1+(r*=1.525))*t-r))+e:n/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:function(e,n,i,r){return i-t.easeOutBounce(r-e,0,i,r)+n},easeOutBounce:function(t,e,n,i){return(t/=i)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(e,n,i,r){return e<r/2?.5*t.easeInBounce(2*e,0,i,r)+n:.5*t.easeOutBounce(2*e-r,0,i,r)+.5*i+n}},e=t,u2.exports=e}.call(h2);const p2=c2(d2.exports);function f2(t,e){return t?"function"==typeof t?t:"string"==typeof t?p2[t]:void 0:p2[e]}const m2={removeOnInterrupt:!1,ease:"linear",time:1e3};class g2 extends l2{constructor(t,e={}){super(t),this.startWidth=null,this.startHeight=null,this.deltaWidth=null,this.deltaHeight=null,this.width=null,this.height=null,this.time=0,this.options=Object.assign({},m2,e),this.options.ease=f2(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),null!==this.width&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),null!==this.height&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),null!==this.width&&this.parent.fitWidth(this.width,this.keepCenter,null===this.height),null!==this.height&&this.parent.fitHeight(this.height,this.keepCenter,null===this.width),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new Cy(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const t=this.parent.width,n=this.parent.height;this.complete(),(t!==this.parent.width||n!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const t=this.options.ease(this.time,0,1,this.options.time);if(null!==this.width){const e=this.startWidth,n=this.deltaWidth;this.parent.fitWidth(e+n*t,this.keepCenter,null===this.height)}if(null!==this.height){const e=this.startHeight,n=this.deltaHeight;this.parent.fitHeight(e+n*t,this.keepCenter,null===this.width)}if(null===this.width?this.parent.scale.x=this.parent.scale.y:null===this.height&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const e=this.startX,n=this.startY,i=this.deltaX,r=this.deltaY,s=new Cy(this.parent.x,this.parent.y);this.parent.moveCenter(e+i*t,n+r*t),this.parent.emit("moved",{viewport:this.parent,original:s,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const v2={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class y2 extends l2{constructor(t,e={}){super(t),this.options=Object.assign({},v2,e),this.ease=f2(this.options.ease,"easeInOutSine"),this.options.sides?"all"===this.options.sides?this.top=this.bottom=this.left=this.right=!0:"horizontal"===this.options.sides?(this.right=this.left=!0,this.top=this.bottom=!1):"vertical"===this.options.sides?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=-1!==this.options.sides.indexOf("top"),this.bottom=-1!==this.options.sides.indexOf("bottom"),this.left=-1!==this.options.sides.indexOf("left"),this.right=-1!==this.options.sides.indexOf("right")):this.left=this.top=this.right=this.bottom=!1;const n=this.options.underflow.toLowerCase();"center"===n?(this.underflowX=0,this.underflowY=0):(this.underflowX=-1!==n.indexOf("left")?-1:-1!==n.indexOf("right")?1:0,this.underflowY=-1!==n.indexOf("top")?-1:-1!==n.indexOf("bottom")?1:0),this.reset()}isActive(){return null!==this.toX||null!==this.toY}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,n=typeof t.y>"u"?0:t.y,i=typeof t.width>"u"?this.parent.worldWidth:t.width,r=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>i,top:this.parent.top<n,bottom:this.parent.bottom>r,topLeft:new Cy(e*this.parent.scale.x,n*this.parent.scale.y),bottomRight:new Cy(i*this.parent.scale.x-this.parent.screenWidth,r*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new Cy(0,0),bottomRight:new Cy(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let n,i=this.parent.plugins.get("decelerate",!0);i&&(i.x||i.y)&&(i.x&&i.percentChangeX===(null==(t=i.options)?void 0:t.friction)||i.y&&i.percentChangeY===(null==(e=i.options)?void 0:e.friction))&&(n=this.oob(),(n.left&&this.left||n.right&&this.right)&&(i.percentChangeX=this.options.friction),(n.top&&this.top||n.bottom&&this.bottom)&&(i.percentChangeY=this.options.friction));const r=this.parent.plugins.get("drag",!0)||{},s=this.parent.plugins.get("pinch",!0)||{};if(i=i||{},!(null!=r&&r.active||null!=s&&s.active||this.toX&&this.toY||i.x&&i.y)){n=n||this.oob();const t=n.topLeft,e=n.bottomRight;if(!this.toX&&!i.x){let i=null;n.left&&this.left?i=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-t.x:n.right&&this.right&&(i=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-e.x),null!==i&&this.parent.x!==i&&(this.toX={time:0,start:this.parent.x,delta:i-this.parent.x,end:i},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!i.y){let i=null;n.top&&this.top?i=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-t.y:n.bottom&&this.bottom&&(i=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-e.y),null!==i&&this.parent.y!==i&&(this.toY={time:0,start:this.parent.y,delta:i-this.parent.y,end:i},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const x2={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class b2 extends l2{constructor(t,e={}){super(t),this.options=Object.assign({},x2,e),this.options.direction&&(this.options.left="x"===this.options.direction||"all"===this.options.direction||null,this.options.right="x"===this.options.direction||"all"===this.options.direction||null,this.options.top="y"===this.options.direction||"all"===this.options.direction||null,this.options.bottom="y"===this.options.direction||"all"===this.options.direction||null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();"none"===t?this.noUnderflow=!0:"center"===t?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=-1!==t.indexOf("left")?-1:-1!==t.indexOf("right")?1:0,this.underflowY=-1!==t.indexOf("top")?-1:-1!==t.indexOf("bottom")?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new Cy(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(null!==this.options.left||null!==this.options.right){let n=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:0!==this.parent.x&&(this.parent.x=0,n=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,n=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,n=!0)}else null!==this.options.left&&this.parent.left<(!0===this.options.left?0:this.options.left)&&(this.parent.x=-(!0===this.options.left?0:this.options.left)*this.parent.scale.x,e.x=0,n=!0),null!==this.options.right&&this.parent.right>(!0===this.options.right?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(!0===this.options.right?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,n=!0);n&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(null!==this.options.top||null!==this.options.bottom){let n=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:0!==this.parent.y&&(this.parent.y=0,n=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,n=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,n=!0)}else null!==this.options.top&&this.parent.top<(!0===this.options.top?0:this.options.top)&&(this.parent.y=-(!0===this.options.top?0:this.options.top)*this.parent.scale.y,e.y=0,n=!0),null!==this.options.bottom&&this.parent.bottom>(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,n=!0);n&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const _2={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class S2 extends l2{constructor(t,e={}){super(t),this.options=Object.assign({},_2,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused)if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(null!==this.options.minWidth&&t<this.options.minWidth){const n=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/n,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxWidth&&t>this.options.maxWidth){const n=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/n,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.minHeight&&e<this.options.minHeight){const n=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/n,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxHeight&&e>this.options.maxHeight){const t=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/t,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if("number"==typeof this.options.minScale)t.x=this.options.minScale,t.y=this.options.minScale;else if(null!==this.options.minScale){const e=this.options.minScale;t.x=typeof e.x>"u"?null:e.x,t.y=typeof e.y>"u"?null:e.y}if("number"==typeof this.options.maxScale)e.x=this.options.maxScale,e.y=this.options.maxScale;else if(null!==this.options.maxScale){const t=this.options.maxScale;e.x=typeof t.x>"u"?null:t.x,e.y=typeof t.y>"u"?null:t.y}let n=this.parent.scale.x,i=this.parent.scale.y;null!==t.x&&n<t.x&&(n=t.x),null!==e.x&&n>e.x&&(n=e.x),null!==t.y&&i<t.y&&(i=t.y),null!==e.y&&i>e.y&&(i=e.y),(n!==this.parent.scale.x||i!==this.parent.scale.y)&&(this.parent.scale.set(n,i),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}reset(){this.clamp()}}const w2={friction:.98,bounce:.8,minSpeed:.01},T2=16;class M2 extends l2{constructor(t,e={}){super(t),this.options=Object.assign({},w2,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",t=>this.handleMoved(t))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!(!this.x&&!this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(1===t||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];"clamp-x"===t.type&&t.original?e.x===t.original.x&&(e.x=this.parent.x):"clamp-y"===t.type&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(0===this.parent.input.count()&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const n=t-e.time;this.x=(this.parent.x-e.x)/n,this.y=(this.parent.y-e.y)/n,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){typeof(t=t||{}).x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,n=this.timeSinceRelease,i=this.timeSinceRelease+t;if(this.x){const e=this.percentChangeX,r=Math.log(e);this.parent.x+=this.x*T2/r*(Math.pow(e,i/T2)-Math.pow(e,n/T2)),this.x*=Math.pow(this.percentChangeX,t/T2)}if(this.y){const e=this.percentChangeY,r=Math.log(e);this.parent.y+=this.y*T2/r*(Math.pow(e,i/T2)-Math.pow(e,n/T2)),this.y*=Math.pow(this.percentChangeY,t/T2)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const A2={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class E2 extends l2{constructor(t,e={}){super(t),this.windowEventHandlers=[],this.options=Object.assign({},A2,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||"all"===this.options.direction||"x"===this.options.direction,this.yDirection=!this.options.direction||"all"===this.options.direction||"y"===this.options.direction,this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){this.addWindowEventHandler("keyup",e=>{t.includes(e.code)&&(this.keyIsPressed=!1)}),this.addWindowEventHandler("keydown",e=>{t.includes(e.code)&&(this.keyIsPressed=!0)})}addWindowEventHandler(t,e){typeof window>"u"||(window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e}))}destroy(){typeof window>"u"||this.windowEventHandlers.forEach(({event:t,handler:e})=>{window.removeEventListener(t,e)})}mouseButtons(t){this.mouse=t&&"all"!==t?[-1!==t.indexOf("left"),-1!==t.indexOf("middle"),-1!==t.indexOf("right")]:[!0,!0,!0]}parseUnderflow(){const t=this.options.underflow.toLowerCase();"center"===t?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e="mouse"===t.pointerType,n=this.parent.input.count();return!(!(1===n||n>1&&!this.parent.plugins.get("pinch",!0))||e&&!this.mouse[t.button])}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&"touch"===t.data.pointerType}down(t){return!(this.paused||!this.options.pressDrag)&&(this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,!0):(this.last=null,!1))}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,n=t.global.y,i=this.parent.input.count();if(1===i||i>1&&!this.parent.plugins.get("pinch",!0)){const i=e-this.last.x,r=n-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(i)||this.yDirection&&this.parent.input.checkThreshold(r)){const i={x:e,y:n};return this.xDirection&&(this.parent.x+=(i.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(i.y-this.last.y)*this.options.factor),this.last=i,this.moved||this.parent.emit("drag-start",{event:t,screen:new Cy(this.last.x,this.last.y),world:this.parent.toWorld(new Cy(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(1===e.length){const t=e[0];return t.last&&(this.last={x:t.last.x,y:t.last.y},this.current=t.id),this.moved=!1,!0}if(this.last&&this.moved){const e=new Cy(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:e,world:this.parent.toWorld(e),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const e=t.deltaMode?this.options.lineHeight:1,n=[t.deltaX,t.deltaY],[i,r]=this.options.wheelSwapAxes?n.reverse():n;return this.xDirection&&(this.parent.x+=i*e*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=r*e*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if("y"!==this.options.clampWheel)if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if("x"!==this.options.clampWheel)if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const C2={speed:0,acceleration:null,radius:null};class P2 extends l2{constructor(t,e,n={}){super(t),this.target=e,this.options=Object.assign({},C2,n),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let n=this.target.x,i=this.target.y;if(this.options.radius){if(!(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius))return;{const t=Math.atan2(this.target.y-e.y,this.target.x-e.x);n=this.target.x-Math.cos(t)*this.options.radius,i=this.target.y-Math.sin(t)*this.options.radius}}const r=n-e.x,s=i-e.y;if(r||s)if(this.options.speed)if(this.options.acceleration){const t=Math.atan2(i-e.y,n-e.x),a=Math.sqrt(Math.pow(r,2)+Math.pow(s,2));if(a){const o=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);this.velocity=a>o?{x:Math.min(this.velocity.x+(this.options.acceleration,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration,this.options.speed))}:{x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const l=Math.cos(t)*this.velocity.x,h=Math.sin(t)*this.velocity.y,c=Math.abs(l)>Math.abs(r)?n:e.x+l,u=Math.abs(h)>Math.abs(s)?i:e.y+h;this.parent.moveCenter(c,u),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const t=Math.atan2(i-e.y,n-e.x),a=Math.cos(t)*this.options.speed,o=Math.sin(t)*this.options.speed,l=Math.abs(a)>Math.abs(r)?n:e.x+a,h=Math.abs(o)>Math.abs(s)?i:e.y+o;this.parent.moveCenter(l,h),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(n,i),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const R2={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class I2 extends l2{constructor(t,e={}){super(t),this.options=Object.assign({},R2,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared="number"==typeof this.options.radius?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;null!==t?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=null===this.options.right?null:this.parent.screenWidth-this.options.right,this.bottom=null===this.options.bottom?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||"mouse"!==t.pointerType&&1!==t.pointerId||!this.options.allowButtons&&0!==t.buttons)return!1;const e=t.global.x,n=t.global.y;if(this.radiusSquared){const t=this.parent.toScreen(this.parent.center);if(Math.pow(t.x-e,2)+Math.pow(t.y-n,2)>=this.radiusSquared){const i=Math.atan2(t.y-n,t.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(i))*this.options.speed*this.reverse*.06,this.vertical=Math.round(Math.sin(i))*this.options.speed*this.reverse*.06):(this.horizontal=Math.cos(i)*this.options.speed*this.reverse*.06,this.vertical=Math.sin(i)*this.options.speed*this.reverse*.06)}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else null!==this.left&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*.06:null!==this.right&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*.06:(this.decelerateHorizontal(),this.horizontal=0),null!==this.top&&n<this.top?this.vertical=Number(this.reverse)*this.options.speed*.06:null!==this.bottom&&n>this.bottom?this.vertical=-1*this.reverse*this.options.speed*.06:(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const O2={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class D2 extends l2{constructor(t,e={}){super(t),this.active=!1,this.pinching=!1,this.moved=!1,this.options=Object.assign({},O2,e)}down(){return this.parent.input.count()>=2&&(this.active=!0,!0)}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.global.x,n=t.global.y,i=this.parent.input.touches;if(i.length>=2){const r=i[0],s=i[1],a=r.last&&s.last?Math.sqrt(Math.pow(s.last.x-r.last.x,2)+Math.pow(s.last.y-r.last.y,2)):null;if(r.id===t.pointerId?r.last={x:e,y:n,data:t}:s.id===t.pointerId&&(s.last={x:e,y:n,data:t}),a){let t;const e=new Cy(r.last.x+(s.last.x-r.last.x)/2,r.last.y+(s.last.y-r.last.y)/2);this.options.center||(t=this.parent.toLocal(e));let n=Math.sqrt(Math.pow(s.last.x-r.last.x,2)+Math.pow(s.last.y-r.last.y,2));n=0===n?n=1e-10:n;const i=(1-a/n)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=i),this.isAxisY()&&(this.parent.scale.y+=i),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:e});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const n=this.parent.toGlobal(t);this.parent.x+=(e.x-n.x)*this.options.factor,this.parent.y+=(e.y-n.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(e.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(e.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=e,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return!!(this.pinching&&this.parent.input.touches.length<=1)&&(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0)}}const B2={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class F2 extends l2{constructor(t,e,n,i={}){super(t),this.options=Object.assign({},B2,i),this.ease=f2(i.ease,"easeInOutSine"),this.x=e,this.y=n,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(0===this.parent.input.count()){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!(this.paused||this.options.interrupt&&0!==this.parent.input.count()))if(this.snapping){const e=this.snapping;let n,i,r;e.time+=t;const s=this.startX,a=this.startY,o=this.deltaX,l=this.deltaY;if(e.time>this.options.time)n=!0,i=s+o,r=a+l;else{const t=this.ease(e.time,0,1,this.options.time);i=s+o*t,r=a+l*t}this.options.topLeft?this.parent.moveCorner(i,r):this.parent.moveCenter(i,r),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),n&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const t=this.options.topLeft?this.parent.corner:this.parent.center;(t.x!==this.x||t.y!==this.y)&&this.snapStart()}}}const L2={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class U2 extends l2{constructor(t,e={}){super(t),this.options=Object.assign({},L2,e),this.ease=f2(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,0===this.options.time?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,n=this.parent.screenWidth/this.xScale,i=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:n-t,deltaY:i-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&0!==this.parent.input.count())return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),this.snapping){if(this.snapping){const n=this.snapping;if(n.time+=t,n.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const t=this.snapping,e=this.ease(t.time,t.startX,t.deltaX,this.options.time),n=this.ease(t.time,t.startY,t.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/e,this.parent.scale.y=this.parent.screenHeight/n}const i=this.parent.plugins.get("clamp-zoom",!0);i&&i.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}else(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping()}resume(){this.snapping=null,super.resume()}}const k2={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class N2 extends l2{constructor(t,e={}){super(t),this.options=Object.assign({},k2,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){typeof window>"u"||(window.addEventListener("keydown",e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",e=>{t.includes(e.code)&&(this.keyIsPressed=!1)}))}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let n;this.options.center||(n=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const i=this.parent.plugins.get("clamp-zoom",!0);if(i&&i.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const e=this.parent.toGlobal(n);this.parent.x+=t.x-e.x,this.parent.y+=t.y-e.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),n=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,i=Math.pow(2,(1+this.options.percent)*n);let r;this.options.center||(r=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=i),this.isAxisY()&&(this.parent.scale.y*=i),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const t=this.parent.toGlobal(r);this.parent.x+=e.x-t.x,this.parent.y+=e.y-t.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),n=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,i=Math.pow(2,(1+this.options.percent)*n);if(this.options.smooth){const t={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+t.x)*i-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+t.y)*i-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let t;this.options.center||(t=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=i),this.isAxisY()&&(this.parent.scale.y*=i),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const n=this.parent.plugins.get("clamp-zoom",!0);if(n&&n.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const n=this.parent.toGlobal(t);this.parent.x+=e.x-n.x,this.parent.y+=e.y-n.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class z2{constructor(t){this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.eventMode="static",this.viewport.forceHitArea||(this.viewport.hitArea=new Hy(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!this.viewport.pause&&this.viewport.visible){if("mouse"===t.pointerType?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),1===this.count()){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),n=this.viewport.plugins.get("bounce",!0);e&&e.isActive()||n&&n.isActive()?this.clickedAvailable=!1:this.clickedAvailable=!0}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.visible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const e=t.global.x-this.last.x,n=t.global.y-this.last.y;(this.checkThreshold(e)||this.checkThreshold(n))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.visible)return;"mouse"===t.pointerType&&(this.isMouseDown=!1),"mouse"!==t.pointerType&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&0===this.count()&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new Cy;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.visible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t)return void this.touches.splice(e,1)}count(){return(this.isMouseDown?1:0)+this.touches.length}}const G2=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class H2{constructor(t){this.viewport=t,this.list=[],this.plugins={}}add(t,e,n=G2.length){const i=this.plugins[t];i&&i.destroy(),this.plugins[t]=e;const r=G2.indexOf(t);-1!==r&&G2.splice(r,1),G2.splice(n,0,t),this.sort()}get(t,e){var n;return e&&null!=(n=this.plugins[t])&&n.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&(null==(e=this.plugins[t])||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;null==(e=this.plugins[t])||e.pause()}resume(t){var e;null==(e=this.plugins[t])||e.resume()}sort(){this.list=[];for(const t of G2)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const n of this.list)n.down(t)&&(e=!0);return e}move(t){let e=!1;for(const n of this.viewport.plugins.list)n.move(t)&&(e=!0);return e}up(t){let e=!1;for(const n of this.list)n.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const n of this.list)n.wheel(t)&&(e=!0);return e}}const V2={screenWidth:typeof window>"u"?0:window.innerWidth,screenHeight:typeof window>"u"?0:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:Qb.shared,allowPreserveDragOutside:!1};class X2 extends Db{constructor(t){super(),this._disableOnContextMenu=t=>t.preventDefault(),this.options={...V2,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new z2(this),this.plugins=new H2(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new Hy(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=(typeof window>"u"?0:window.innerWidth),e=(typeof window>"u"?0:window.innerHeight),n,i){this.screenWidth=t,this.screenHeight=e,typeof n<"u"&&(this._worldWidth=n),typeof i<"u"&&(this._worldHeight=i),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new Hy(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return 2===arguments.length?this.toLocal(new Cy(t,e)):this.toLocal(t)}toScreen(t,e){return 2===arguments.length?this.toGlobal(new Cy(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new Cy(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,n;"number"==typeof t[0]?(e=t[0],n=t[1]):(e=t[0].x,n=t[0].y);const i=(this.worldScreenWidth/2-e)*this.scale.x,r=(this.worldScreenHeight/2-n)*this.scale.y;return(this.x!==i||this.y!==r)&&(this.position.set(i,r),this.plugins.reset(),this.dirty=!0),this}get corner(){return new Cy(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,n;return 1===t.length?(e=-t[0].x*this.scale.x,n=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,n=-t[1]*this.scale.y),(e!==this.x||n!==this.y)&&(this.position.set(e,n),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const n=this.screenWidth/t,i=this.screenHeight/e;return Math.min(n,i)}findCover(t,e){const n=this.screenWidth/t,i=this.screenHeight/e;return Math.max(n,i)}fitWidth(t=this.worldWidth,e,n=!0,i){let r;e&&(r=this.center),this.scale.x=this.screenWidth/t,n&&(this.scale.y=this.scale.x);const s=this.plugins.get("clamp-zoom",!0);return!i&&s&&s.clamp(),e&&r&&this.moveCenter(r),this}fitHeight(t=this.worldHeight,e,n=!0,i){let r;e&&(r=this.center),this.scale.y=this.screenHeight/t,n&&(this.scale.x=this.scale.y);const s=this.plugins.get("clamp-zoom",!0);return!i&&s&&s.clamp(),e&&r&&this.moveCenter(r),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,n=this.worldHeight){let i;t&&(i=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/n,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),t&&i&&this.moveCenter(i),this}setZoom(t,e){let n;e&&(n=this.center),this.scale.set(t);const i=this.plugins.get("clamp-zoom",!0);return i&&i.clamp(),e&&n&&this.moveCenter(n),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new U2(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new Cy(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new Hy(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new E2(this,t)),this}clamp(t){return this.plugins.add("clamp",new b2(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new M2(this,t)),this}bounce(t){return this.plugins.add("bounce",new y2(this,t)),this}pinch(t){return this.plugins.add("pinch",new D2(this,t)),this}snap(t,e,n){return this.plugins.add("snap",new F2(this,t,e,n)),this}follow(t,e){return this.plugins.add("follow",new P2(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new N2(this,t)),this}animate(t){return this.plugins.add("animate",new g2(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new S2(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new I2(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,n,i,r){r&&(n>this.worldScreenWidth||i>this.worldScreenHeight)&&(this.fit(!0,n,i),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let s=!1;t<this.left?(this.left=t,s=!0):t+n>this.right&&(this.right=t+n,s=!0),e<this.top?(this.top=e,s=!0):e+i>this.bottom&&(this.bottom=e+i,s=!0),s&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}const W2={both:"all",horizontal:"x",vertical:"y"};class j2 extends X2{constructor(t){super({events:vN().renderer.events,worldWidth:t.viewport.worldSize.x,worldHeight:t.viewport.worldSize.y}),n(this,"id",""),n(this,"type","viewport"),n(this,"debugRect"),n(this,"selected",!1),n(this,"locked",!1),n(this,"config"),n(this,"components"),n(this,"minScale",1),this.config=t,this.debugRect=new MO,this.initComponentSystem(),this.config.viewport.enableDrag&&this.drag({clampWheel:!0}).decelerate({friction:this.config.viewport.smoothing}),this.config.viewport.enableZoom&&this.pinch({}).wheel({percent:.05,smooth:1}),this.onResizeCallback=(t,e)=>{this.resize(t,e)},"none"!=this.config.viewport.direction&&this.setClampDirection()}setClampDirection(){this.clamp({direction:W2[this.config.viewport.direction],options:{top:0,left:0,right:this.worldWidth,bottom:this.worldHeight}})}setZoomNormalized(t){const e=Math.max(0,Math.min(1,t));this.minScale||(this.minScale=this.findCover(this.worldWidth,this.worldHeight));const n=this.minScale*this.config.viewport.maxZoomMultiplier,i=this.minScale+(n-this.minScale)*e,r={...this.center};this.zoom(i,!0),this.moveCenter(r.x,r.y)}setOffset(t){this.removeAllListeners("moved"),this.on("moved",e=>{"follow"===e.type&&(this.x+=t.x,this.y+=t.y)})}update(t){super.update(t)}setFollowAnimated(t){let e=null;if("string"==typeof t){if(e=d0.getObjectById(t),!e)return}else e=t;this.plugins.remove("follow");const n=this.center.x,i=this.center.y,r={x:0};QW.to(r,{x:1,onUpdate:()=>{const t=(1-r.x)*n+r.x*e.x,s=(1-r.x)*i+r.x*e.y;this.moveCenter(t,s)},onComplete:()=>{this.setFollow(t)}})}setFollow(t){let e=null;if("string"==typeof t){if(e=d0.getObjectById(t),!e)return}else e=t;this.follow(e,{speed:0,radius:0,acceleration:0})}updateDebug(){this.debugRect.clear(),this.debugRect.rect(0,0,this.config.viewport.worldSize.x,this.config.viewport.worldSize.y),this.debugRect.stroke({color:959977,alpha:1,width:5})}updateViewportComponent(t){this.debugRect.visible=t.debug,""!=this.config.viewport.target&&this.follow(d0.getObjectById(this.config.viewport.target),{speed:this.config.viewport.targetSmoothFollowStrength,radius:0,acceleration:0})}updateComponents(t){const e=t.viewport;e&&this.updateViewportComponent(e),super.updateComponents(t)}shakeCamera(t,e){t*=100;const n={x:this.center.x,y:this.center.y},i=QW.timeline({onComplete:()=>{QW.to({},{duration:.1,onUpdate:()=>{this.moveCenter(n.x,n.y)}})}}),r=Math.floor(t/10);for(let s=0;s<r;s++){const t={x:0,y:0};i.to(t,{x:(Math.random()-.5)*e,y:(Math.random()-.5)*e,duration:.05,onUpdate:()=>{this.moveCenter(n.x+t.x,n.y+t.y)},ease:"power2.out"})}}resize(t,e){const n={...this.center};this.screenHeight=e,this.screenWidth=t;const i=this.scale.x/this.minScale;this.minScale=this.findCover(this.worldHeight,this.worldHeight),this.clampZoom({minScale:this.minScale,maxScale:this.minScale*this.config.viewport.maxZoomMultiplier}),this.zoom(this.minScale*i,!0),this.moveCenter(n.x,n.y)}get settings(){return this.config.viewport}}class Y2 extends Db{constructor(t={x:0,y:0}){super({x:t.x,y:t.y}),n(this,"id",""),n(this,"type","layout2D"),n(this,"components"),n(this,"selected",!1),n(this,"portrait"),n(this,"landscape"),n(this,"locked",!1),n(this,"hasDebug",!0),n(this,"onResizeCallback",(t,e)=>{this.baseWidth=t,this.baseHeight=e}),this.components=new s2(this),this.portrait={data:{}},this.landscape={enabled:!1,data:{}},this.sortableChildren=!0}updateComponents(t){const e=t.layout2D;e&&this.updateLayoutComponent(e),super.updateComponents(t),this.parent&&this.onResizeCallback(this.parent.baseWidth,this.parent.baseHeight),this.resizeChildren()}updateLayoutComponent(t){this.portrait=t.portrait,this.landscape=t.landscape,this.parent&&this.onResizeCallback(this.parent.baseWidth,this.parent.baseHeight),this.resizeChildren()}removeCellByName(t){const e=this.getChildByLabel(t,!0);e&&(this.removeChild(e),e.destroy()),this.resizeChildren()}getLayoutComponent(){return{type:"layout2D",portrait:{data:this.portrait.data},landscape:{enabled:this.landscape.enabled,data:this.landscape.data},hasDebug:this.hasDebug}}resizeChildren(){this.parent&&this.children.forEach(t=>{var e;"cell2D"===t.type?t.onResizeCallback(this.baseWidth,this.baseHeight):(null==(e=null==t?void 0:t.components)?void 0:e.responsive)&&t.components.responsive.update(t.components.get("responsive").data)})}}class q2 extends Db{constructor(t=0,e=0){super({x:t,y:e}),n(this,"id",""),n(this,"type","cell2D"),n(this,"debugRect",new MO),n(this,"selected",!1),n(this,"locked",!1),n(this,"hasPortraitMask",!1),n(this,"hasLandscapeMask",!1),n(this,"maskGraph",new MO),n(this,"portrait",{order:0,zIndex:0,fraction:1,containType:"row",fitUnit:"min",gap:0,width:0,height:0}),n(this,"landscape",{enabled:!1,order:0,zIndex:0,fraction:1,containType:"row",fitUnit:"min",gap:0,width:0,height:0}),n(this,"isLandscapeEnabled",!1),n(this,"onResizeCallback",(t,e)=>{const n=this.getLayout(),i=this.getOrientation();if(n){const r=this.getTotalFraction(i),s=this.layoutDataFindChildren(n,this.parent.id),a=this.parent.children.filter(t=>"cell2D"===t.type);s&&(a.sort((t,e)=>s.children.findIndex(e=>e.id===t.id)-s.children.findIndex(t=>t.id===e.id)),this.parent.children.sort((t,e)=>t.zIndex===e.zIndex?s.children.findIndex(e=>e.id===t.id)-s.children.findIndex(t=>t.id===e.id):t.zIndex-e.zIndex)),a.sort((t,e)=>t[i].order-e[i].order);const o=a.indexOf(this),l=a[o-1];if("layout2D"===this.parent.type)this.baseWidth=t,this.baseHeight=e,this.x=0,this.y=0;else if(this.parent instanceof q2)if("row"===this.parent[i].containType){const n=this[i].fraction/r;this.baseWidth=t,this.baseHeight=e*n,this.x=0,this.y=l?l.y+l.baseHeight:0}else{const n=this[i].fraction/r;this.baseWidth=t*n,this.baseHeight=e,this.x=l?l.x+l.baseWidth:0,this.y=0}}else this.baseWidth=t,this.baseHeight=e;this.updateDebug(),this.resizeChildren(),this.updateMask({portrait:this.portrait,landscape:this.landscape}),this.children.forEach(t=>{var e;(null==(e=null==t?void 0:t.components)?void 0:e.responsive)&&t.components.responsive.update(t.components.get("responsive").data)})}),this.baseWidth=0,this.baseHeight=0,this.sortableChildren=!0,this.components=new s2(this),this.maskGraph&&(this.addChild(this.maskGraph),this.maskGraph.visible=!1)}getLayout(){let{parent:t}=this;for(;t;){if("layout2D"===t.type)return t;if("container"===t.type)return null;t=t.parent}}updateDebug(){}updateCellComponent(t){this.portrait=t.portrait,this.landscape=t.landscape;const e=this.getOrientation();this.getLayout()||(this.baseWidth=t[e].width||0,this.baseHeight=t[e].height||0),this.updateMask(t),d0.resizeAll()}getOrientation(){const t=this.getLayout();return t?"landscape"===mN()&&t.landscape.enabled?"landscape":"portrait":"landscape"===mN()&&this.landscape.enabled?"landscape":"portrait"}updateMask(t){if(!t)return;const e=this.getOrientation();this.hasPortraitMask=t.portrait.mask,this.hasLandscapeMask=t.landscape.mask,t[e].mask?(this.maskGraph.clear(),this.maskGraph.visible=!0,this.maskGraph.rect(0,0,this.baseWidth,this.baseHeight),this.maskGraph.fill({color:16711680,alpha:1}),this.mask=this.maskGraph):(this.maskGraph.visible=!1,this.mask=null)}resizeChildren(){if(this.parent){if(this.getLayout())this.children.forEach(t=>{t instanceof q2&&t.onResizeCallback(this.baseWidth,this.baseHeight)});else{const t=this[this.getOrientation()];this.baseWidth=t.width||0,this.baseHeight=t.height||0;const e=this.children.filter(t=>t.components&&!t.components.responsive),n=t.gap*(e.length-1);e.forEach((i,r)=>{if("row"===t.containType){const s=(this.baseWidth-n)/e.length,a=t.fitUnit,o=Math.max(i.baseWidth,i.baseHeight),l=Math[a](s,this.baseHeight);if(i.scale.set(Math.max(.01,Math.min(l/o))),"min"===a){const e=(s+t.gap)*r;i.x=e+.5*s-i.width*(.5-i.originX)}else{const e=(o*i.scale.x+t.gap)*r;i.x=e+o*i.scale.x*.5-o*i.scale.x*(.5-i.originX)}i.y=.5*this.baseHeight-i.height*(.5-i.originY)}else{const s=(this.baseHeight-n)/e.length,a=t.fitUnit,o=Math.max(i.baseWidth,i.baseHeight),l=Math[a](s,this.baseWidth);if(i.scale.set(Math.max(.01,Math.min(l/o))),"min"===a){const e=(s+t.gap)*r;i.y=e+.5*s-i.height*(.5-i.originY)}else{const e=(o*i.scale.y+t.gap)*r;i.y=e+o*i.scale.y*.5-o*i.scale.y*(.5-i.originY)}i.x=.5*this.baseWidth-i.width*(.5-i.originX)}})}}}updateComponents(t){const e=t.cell2D;if(e&&this.updateCellComponent(e),super.updateComponents(t),e){const t=this.getOrientation();this.zIndex=e[t].zIndex}const n=this.getLayout();n?n.resizeChildren():this.onResizeCallback(this.baseWidth,this.baseHeight),this.resizeChildren()}getTotalFraction(t="portrait"){return this.parent.children.filter(t=>"cell2D"===t.type).reduce((e,n)=>e+n[t].fraction,0)}layoutDataFindChildren(t,e){let n;const i=(t,e)=>{t.children.forEach(t=>{t.id===e?n=t:t.children&&i(t,e)})};return i(t.nodeData,e),n}}class K2 extends zU{constructor({texture:t=""}){super({texture:u0.getTexture(t,t=>{this._setTextureFrame(t)}),leftWidth:0,rightWidth:0,topHeight:0,bottomHeight:0}),n(this,"type","nineSliceSprite"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"textureData",{type:"texture",path:"",uploadId:"",stuffs:null,stuffsDataId:"",localPath:""}),n(this,"textureDataLandscape",{type:"texture",path:"",uploadId:"",stuffs:null,stuffsDataId:"",localPath:""}),n(this,"lanscapeEnabled",!1),this.initComponentSystem()}updateNineSliceSpriteComponent(t){this.updateTextureData(t),this.width=t.width,this.height=t.height,this.leftWidth=t.leftWidth,this.rightWidth=t.rightWidth,this.topHeight=t.topHeight,this.bottomHeight=t.bottomHeight,this.baseWidth=this.width,this.baseHeight=this.height,t.tint&&(this.tint=new zx(t.tint))}getNineSliceSpriteComponent(){return{type:"nineSliceSprite",texture:this.textureData,landscapeTexture:this.textureDataLandscape,landscape:this.lanscapeEnabled,tint:this.tint.toString(16),width:this.width,height:this.height,leftWidth:this.leftWidth,rightWidth:this.rightWidth,topHeight:this.topHeight,bottomHeight:this.bottomHeight}}updateComponents(t){const e=this.components.get("transform"),n=t.nineSliceSprite;n&&this.updateNineSliceSpriteComponent(n),this.setOrigin(e.origin.x,e.origin.y),super.updateComponents(t)}}class J2 extends Db{constructor({x:t=0,y:e=0}){super({x:t,y:e}),n(this,"type","tutorial"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"debugRect",new MO),n(this,"hand",null),n(this,"pathGraphics",null),n(this,"tutorials",{}),n(this,"targets",[]),n(this,"_targets",[]),n(this,"currentTarget",null),n(this,"currentState",null),n(this,"enabled",!0),n(this,"handOrigScale",new Cy(1,1)),n(this,"handOrigAngle",0),n(this,"handOrigAlpha",1),n(this,"dragTargets",[]),n(this,"_dragTargets",[]),n(this,"currentDragTarget",null),n(this,"movementTween",null),n(this,"dragTween",null),n(this,"dragObjectsClone",null),n(this,"camera"),n(this,"pixiScene"),n(this,"pathTween",null),n(this,"delayedCalls",[]),n(this,"pixiApp",vN()),n(this,"updateTickers",[]),n(this,"skipFirstResizeFlag",!1),n(this,"chooseTutorial",{onEnter:t=>{if(!this.hand)return void this.clearTweensAndDelayedCalls();const e=()=>Math.random()-.5,{chooseOrder:n,behaviors:i,repeat:r,delay:s,repeatDelay:a,ease:o,alpha:l,scale:h,rotation:c,movement:u,drag:d}=t.chooseType;l.duration||(l.duration=.4),l.startDelay||(l.startDelay=0),l.endDelay||(l.endDelay=0),h.duration||(h.duration=.4),h.startDelay||(h.startDelay=0),h.endDelay||(h.endDelay=0),c.duration||(c.duration=.4),c.startDelay||(c.startDelay=0),c.endDelay||(c.endDelay=0),u.duration||(u.duration=.4),u.startDelay||(u.startDelay=0),u.endDelay||(u.endDelay=0);(()=>{"sequential"===n?(this._targets=[...this.targets],this._dragTargets=[...this.dragTargets]):"reverse"===n?(this._targets=[...this.targets].reverse(),this._dragTargets=[...this.dragTargets].reverse()):"random"===n&&(this._targets=[...this.targets].sort(()=>e()),this._dragTargets=[...this.dragTargets].sort(()=>e())),this._targets&&this._targets.length||this.clearTweensAndDelayedCalls()})();let p=0,f=0,m=-1;const g=()=>(p++,f++,p>=this._targets.length&&(p=0,"random"===n&&(this._targets=this.targets.sort(()=>e()))),0===p&&m++,this._dragTargets&&f>=this._dragTargets.length&&(f=0,"random"===n&&(this._dragTargets=this.dragTargets.sort(()=>e()))),{target:this._targets[p],dragTarget:this._dragTargets?this._dragTargets[f]:null});this.currentTarget=this._targets[p],this.currentDragTarget=this._dragTargets?this._dragTargets[p]:null;let v=null;const y=(t,e)=>new Promise(n=>{if(!this.hand)return void this.clearTweensAndDelayedCalls();let r=0;if(this.delayedCalls.forEach(t=>{t&&(t.kill(),t=null)}),i.includes("movement"))this.movementBehavior(t,u.duration,u.startDelay,"-"===u.easeStart?o:u.easeStart),r=Math.max(r,u.duration+u.startDelay);else{const e=this.getTargetsGlobalPosition(t);this.x=e.x,this.y=e.y,r=Math.max(r,0)}i.includes("alpha")&&(this.alphaBehaviorIn(0,l.duration,l.startDelay,"-"===l.easeStart?o:l.easeStart),r=Math.max(r,l.duration+l.startDelay)),i.includes("scale")&&(this.scaleBehaviorIn(h.scaleRatio,h.duration,h.startDelay,"-"===h.easeStart?o:h.easeStart),r=Math.max(r,h.duration+h.startDelay)),i.includes("rotation")&&this.rotateBehaviorIn(c.angleAmount,c.duration,c.startDelay,"-"===c.easeStart?o:c.easeStart),this.currentTarget.emit&&this.currentTarget.emit("tutorial:start");const s=QW.delayedCall(r,()=>{if(i.includes("drag")){if(0===this.dragTargets.length)return void this.clearTweensAndDelayedCalls();x(t,e).then(()=>b()).catch(()=>{})}else b();n()});this.delayedCalls.push(s)}),x=(t,e)=>new Promise(n=>{if(i.includes("drag")){this.dragTween=QW.to(this,{x:()=>this.getTargetsGlobalPosition(e).x,y:()=>this.getTargetsGlobalPosition(e).y,delay:0,duration:d.duration,ease:"sine.inOut"}),d.dragTheObjectsClone&&(t instanceof Db?"sprite"===t.renderPipeId&&this.createClone(t):this.createClone(t));const i=QW.delayedCall(d.duration,()=>{n()});this.delayedCalls.push(i)}}),b=()=>{let t=0;i.includes("alpha")&&(this.alphaBehaviorOut(0,l.duration,l.endDelay,"-"===l.easeEnd?o:l.easeEnd),t=Math.max(t,l.duration+l.endDelay)),i.includes("scale")&&(this.scaleBehaviorOut(h.scaleRatio,h.duration,h.endDelay,"-"===h.easeEnd?o:h.easeEnd),t=Math.max(t,h.duration+h.endDelay)),i.includes("rotation")&&(this.rotateBehaviorOut(c.angleAmount,c.duration,c.endDelay,"-"===c.easeEnd?o:c.easeEnd),t=Math.max(t,c.duration+c.endDelay)),this.dragObjectsClone&&this.dragObjectsClone instanceof Db&&QW.to(this.dragObjectsClone,{pixi:{alpha:0},duration:.4,ease:"sine.inOut",onComplete:()=>{this.dragObjectsClone.destroy(),this.dragObjectsClone=null}});const e=QW.delayedCall(t,()=>{const t=g();if(this.currentTarget.emit&&this.currentTarget.emit("tutorial:complete"),-1!==r&&m>=r)return this.clearTweensAndDelayedCalls(),this.emit("tutorial:complete"),void this.removeUpdateTicker(v);if(this.currentTarget.emit&&this.currentTarget.emit("tutorial:repeat"),t){const{target:e,dragTarget:n}=t;this.currentTarget=e,this.currentDragTarget=n;let i=0;0===this._targets.indexOf(e)&&(this.emit("tutorial:repeat"),i=a);const r=QW.delayedCall(i,()=>{y(e,n)});this.delayedCalls.push(r)}});this.delayedCalls.push(e)};this.hand.visible=!1;const _=QW.delayedCall(s,()=>{this.hand.visible=!0,y(this.currentTarget,this.currentDragTarget),this.emit("tutorial:start"),v=this.addUpdateTicker(t=>{this.currentTarget.emit&&this.currentTarget.emit("tutorial:update",t)})});this.delayedCalls.push(_)},onResize:()=>{if(!this.currentTarget)return;const t=this.getTargetsGlobalPosition(this.currentTarget);this.x=t.x,this.y=t.y,this.movementTween&&this.movementTween.invalidate(),this.currentDragTarget&&this.dragTween&&this.dragTween.invalidate(),this.dragObjectsClone&&this.dragObjectsClone instanceof Db&&(this.dragObjectsClone.visible=!1)},onUpdate:()=>{},onExit:()=>{}}),n(this,"infinityTutorial",{onEnter:t=>{const{behaviors:e,infinityMovementWidth:n,infinityMovementHeight:i,delay:r,duration:s,ease:a,scale:o,rotation:l,behaviorsDuration:h}=t.infinityType,c={value:0},u=.5*this.baseWidth,d=.5*this.baseHeight,p=n,f=i,m=this.addUpdateTicker(),g=QW.to(c,{value:1,duration:s,delay:r,repeat:-1,onStart:()=>{this.emit("tutorial:start")},onRepeat:()=>{this.emit("tutorial:repeat")},ease:"none",onUpdate:()=>{const{value:t}=c,e=t*Math.PI*2,n=p*Math.cos(e),i=f*Math.sin(2*e)/2;this.hand.x=u+n,this.hand.y=d+i},onComplete:()=>{this.emit("tutorial:complete"),m&&this.removeUpdateTicker(m)}});if(this.delayedCalls.push(g),e.includes("scale")&&QW.to(this.hand,{pixi:{scale:this.handOrigScale.x*o.scaleRatio},duration:h/o.speed,ease:"-"===o.ease?a:o.ease,repeat:-1,yoyo:!0}),e.includes("rotation")){const t=h/l.speed,e=(t,n)=>{QW.to(this.hand,{pixi:{angle:t},duration:n,ease:"-"===l.ease?a:l.ease,onComplete:()=>{-1===Math.sign(t)?e(Math.abs(t),n):e(-Math.abs(t),n)}})};e(l.angleAmount,t)}},onResize:()=>{},onUpdate:()=>{},onExit:()=>{}}),n(this,"pathTutorial",{onEnter:t=>{if(!this.hand)return void this.clearTweensAndDelayedCalls();const{behaviors:e,duration:n,repeat:i,yoyo:r,delay:s,repeatDelay:a,pathDuration:o,curviness:l,pathGraphics:h,ease:c,alpha:u,scale:d,rotation:p}=t.pathType;if(h){this.pathGraphics=d0.getNodeById(h);const t=this.pathGraphics.context.instructions[0].data.path.instructions[0].data[0],f=QW.utils.mapRange(0,1,0,n,u.timeline[0]),m=QW.utils.mapRange(0,1,0,n,(u.timeline[1]-u.timeline[0])/u.speed),g=QW.utils.mapRange(0,1,0,n,1-u.timeline[1]),v=QW.utils.mapRange(0,1,0,n,d.timeline[0]),y=QW.utils.mapRange(0,1,0,n,(d.timeline[1]-d.timeline[0])/d.speed),x=QW.utils.mapRange(0,1,0,n,1-d.timeline[1]),b=QW.utils.mapRange(0,1,0,n,p.timeline[0]),_=QW.utils.mapRange(0,1,0,n,(p.timeline[1]-p.timeline[0])/p.speed),S=QW.utils.mapRange(0,1,0,n,1-p.timeline[1]),w=this.addUpdateTicker();if(t&&"object"==typeof t){let h=0;const T=()=>{var e;const n=null==(e=this.pathGraphics)?void 0:e.getGlobalPosition(),i=this.parent.toLocal(n);return this.getMappedPath(t,i)},M=()=>new Promise(t=>{if(!this.hand)return void this.clearTweensAndDelayedCalls();this.pixiApp.ticker.add(w),this.updateTickers.push(w);const i=T();this.x=i[0].x,this.y=i[0].y,this.delayedCalls.forEach(t=>{t&&(t.kill(),t=null)}),e.includes("alpha")&&("start"!==u.disableAt?this.alphaBehaviorIn(0,m,f,"-"===u.easeStart?c:u.easeStart):this.hand.alpha=1),e.includes("scale")&&("start"!==d.disableAt?this.scaleBehaviorIn(d.scaleRatio,y,v,"-"===d.easeStart?c:d.easeStart):this.hand.scale.set(this.handOrigScale.x,this.handOrigScale.y)),e.includes("rotation")&&("start"!==p.disableAt?this.rotateBehaviorIn(p.angleAmount,_,b,"-"===p.easeStart?c:p.easeStart):this.hand.angle=this.handOrigAngle);const r=QW.delayedCall(n,()=>{E(),t()});this.delayedCalls.push(r)}),A=()=>new Promise(t=>{if(e.includes("alpha")&&"end"!==u.disableAt&&this.alphaBehaviorOut(0,m,g,"-"===u.easeEnd?c:u.easeEnd),e.includes("scale"))if("end"!==d.disableAt)this.scaleBehaviorOut(d.scaleRatio,y,x,"-"===d.easeEnd?c:d.easeEnd);else{const t=QW.delayedCall(n,()=>{this.hand.scale.set(this.handOrigScale.x,this.handOrigScale.y)});this.delayedCalls.push(t)}if(e.includes("rotation"))if("end"!==p.disableAt)this.rotateBehaviorOut(p.angleAmount,_,S,"-"===p.easeEnd?c:p.easeEnd);else{const t=QW.delayedCall(n,()=>{this.hand.angle=this.handOrigAngle});this.delayedCalls.push(t)}const r=QW.delayedCall(n,()=>{if(w&&this.removeUpdateTicker(w),-1!==i&&h>=i)return this.clearTweensAndDelayedCalls(),t(),void this.emit("tutorial:complete");const e=QW.delayedCall(a,()=>{this.emit("tutorial:repeat"),M(),t()});this.delayedCalls.push(e)});this.delayedCalls.push(r)}),E=()=>{const e=QW.to(this,{motionPath:{path:()=>{const e=this.getTargetsGlobalPosition(this.pathGraphics);return this.getMappedPath(t,e)},autoRotate:!1,curviness:l,offsetX:0,offsetY:0,fromCurrent:!1},duration:o,ease:c,repeat:r?1:0,yoyo:r,onComplete:()=>{h++,A()}});this.pathTween=e};this.hand.visible=!1;const C=QW.delayedCall(s,()=>{this.hand.visible=!0,this.emit("tutorial:start"),M()});this.delayedCalls.push(C)}}},onResize:()=>{var t;if(!this.pathGraphics)return;const e=this.pathGraphics.context.instructions[0].data.path.instructions[0].data[0],n=null==(t=this.pathGraphics)?void 0:t.getGlobalPosition(),i=this.parent.toLocal(n),r=this.getMappedPath(e,i);this.x=r[0].x,this.y=r[0].y,this.pathTween&&this.pathTween.invalidate()},onUpdate:()=>{},onExit:()=>{}}),n(this,"stopTutorial",{onEnter:()=>{this.clearTweensAndDelayedCalls()},onResize:()=>{},onUpdate:()=>{},onExit:()=>{}}),n(this,"onResizeCallback",(t,e)=>{this.skipFirstResizeFlag?(this.currentState&&this.currentState.onResize&&this.currentState.onResize(t,e),this.hand&&(this.hand.x=.5*this.baseWidth,this.hand.y=.5*this.baseHeight)):this.skipFirstResizeFlag=!0}),this.initComponentSystem()}updateDebug(){}play(t){if(!this.targets.length)return void this.clearTweensAndDelayedCalls();window.app&&window.app.globals&&(window.app.globals.threeCamera&&this.setCamera(window.app.globals.threeCamera),window.app.globals.pixiScene&&this.setPixiScene(window.app.globals.pixiScene));const e=Object.values(this.tutorials).filter(e=>{const{name:n}=e;return n===t});if(!e.length)return void this.clearTweensAndDelayedCalls();QW.killTweensOf(this),QW.killTweensOf(this.hand),this.visible=!0,this.alpha=1;const n=e[0],{tutorialType:i,chooseType:r,infinityType:s,pathType:a,showEvents:o,hideEvents:l}=n;let h=null;"choose"===i?h=this.chooseTutorial:"infinity"===i?h=this.infinityTutorial:"path"===i&&(h=this.pathTutorial),this.setTutorial(h,{tutorialType:i,chooseType:r,infinityType:s,pathType:a,showEvents:o,hideEvents:l})}stop(){this.setTutorial(this.stopTutorial)}getParentsScale(t){const e=new Cy(t.scale.x,t.scale.y);for(;t&&t.label!==this.parent.label;)(t=t.parent)&&t.scale&&(e.x*=t.scale.x,e.y*=t.scale.y);return e}getMappedPath(t,e){return t.map(t=>{const n=this.getParentsScale(this.parent),i=this.pathGraphics.scale.x*this.getParentsScale(this.pathGraphics.parent).x/n.x;return{x:e.x+t.x*i,y:e.y+t.y*i}})}alphaBehaviorIn(t,e=.4,n=0,i="sine.inOut"){this.hand.alpha=t,QW.to(this.hand,{pixi:{alpha:1},duration:e,delay:n,ease:i})}alphaBehaviorOut(t,e=.4,n=0,i="sine.inOut"){QW.to(this.hand,{pixi:{alpha:t},duration:e,delay:n,ease:i})}rotateBehaviorIn(t=12,e=.4,n=0,i="sine.inOut"){this.hand.angle=this.handOrigAngle,QW.to(this.hand,{pixi:{angle:`+=${t}`},duration:e,delay:n,ease:i})}rotateBehaviorOut(t,e=.4,n=0,i="sine.inOut"){QW.to(this.hand,{pixi:{angle:`-=${t}`},duration:e,delay:n,ease:i})}scaleBehaviorIn(t=1.2,e=.4,n=0,i="sine.inOut"){var r;null==(r=this.hand)||r.scale.set(this.handOrigScale.x*t,this.handOrigScale.y*t),QW.to(this.hand,{pixi:{scale:this.handOrigScale.x},duration:e,delay:n,ease:i})}scaleBehaviorOut(t=1.2,e=.4,n=0,i="sine.inOut"){QW.to(this.hand,{pixi:{scale:this.handOrigScale.x*t},duration:e,delay:n,ease:i})}movementBehavior(t,e=.4,n=0,i="sine.inOut"){this.movementTween&&this.movementTween.kill(),this.movementTween=QW.to(this,{x:()=>this.getTargetsGlobalPosition(t).x,y:()=>this.getTargetsGlobalPosition(t).y,duration:e,delay:n,ease:i})}addUpdateTicker(t=null){const e=e=>{this.emit("tutorial:update",e),t&&t(e)};return this.pixiApp.ticker.add(e),this.updateTickers.push(e),e}removeUpdateTicker(t){const e=this.updateTickers.indexOf(t);-1!==e&&this.updateTickers.splice(e,1),this.pixiApp.ticker.remove(t)}createClone(t){let e=null;if(t instanceof Db){const n=t;e=new Fb({texture:n.texture,scale:n.scale,angle:n.angle,anchor:n.anchor,alpha:.5}),this.addChildAt(e,0),e.x=this.hand.x,e.y=this.hand.y;const i=this.getParentsScale(this.parent),r=this.getLocalScale(e,t);e.scale.set(r.x/i.x/this.scale.x,r.y/i.y/this.scale.y)}else e=t.clone(),t.parent.add(e),e.position.copy(t.position),e.scale.copy(t.scale),e.quaternion.copy(t.quaternion);this.dragObjectsClone=e}getLocalScale(t,e){const n=t.worldTransform,i=e.worldTransform,r=n.a,s=n.d;return{x:i.a/r,y:i.d/s}}clearTweensAndDelayedCalls(){this.delayedCalls.forEach(t=>{t&&(t.kill(),t=null)}),this.updateTickers.forEach(t=>{this.pixiApp.ticker.remove(t)}),this.updateTickers=[],QW.killTweensOf(this),QW.killTweensOf(this.hand),QW.to(this,{pixi:{alpha:0},duration:.4,ease:"sine.inOut",onComplete:()=>{this.visible=!1,this.setToOriginalValues()}})}setToOriginalValues(){this.hand&&(this.hand.scale.set(this.handOrigScale.x,this.handOrigScale.y),this.hand.angle=this.handOrigAngle,this.hand.alpha=this.handOrigAlpha)}getTargetsGlobalPosition(t){let e=new Cy(0,0);if(t instanceof Db){const n=t.getGlobalPosition();e=this.parent.toLocal(n)}else{const n=this.getObject3DPosition(t.position);e=this.parent.toLocal(n)}return e}setCamera(t){this.camera=t}setPixiScene(t){this.pixiScene=t}getObject3DPosition(t){const e=t.clone();this.camera.updateMatrixWorld(),e.project(this.camera);const n=(.5*e.x+.5)*this.pixiScene.baseWidth,i=(-.5*e.y+.5)*this.pixiScene.baseHeight;return new Cy(n,i)}updateTutorialComponent(t){this.baseWidth=t.width,this.baseHeight=t.height,t.tutorials&&Object.values(t.tutorials).forEach(t=>{const{name:e,showEvents:n,hideEvents:i}=t;n.forEach(t=>{this.eventEmitter.on(t,()=>{this.play(e)})}),i.forEach(t=>{this.eventEmitter.on(t,()=>{this.stop()})})}),this.updateDebug()}getTutorialComponent(){return{type:"tutorial",tutorials:this.tutorials,width:this.baseWidth,height:this.baseHeight,debug:this.debugRect.visible,hand:this.hand?this.hand.id:""}}updateComponents(t){const e=t.tutorial,n=this.components.get("transform");e&&(this.updateTutorialComponent(e),this.tutorials=e.tutorials),e&&e.hand&&(this.hand=d0.getNodeById(e.hand),this.hand&&(this.handOrigScale.set(this.hand.scale.x,this.hand.scale.y),this.handOrigAngle=this.hand.angle,this.handOrigAlpha=this.hand.alpha)),this.setOrigin(n.origin.x,n.origin.y),super.updateComponents(t)}get state(){return this.currentState}setTutorial(t,e){if(!t)return;if(t===this.currentState)return;const n=this.currentState;n&&n.onExit&&n.onExit.call(this),this.currentState=t;const i=this.currentState;i.onEnter&&i.onEnter.call(this,e)}update(t){if(!this.enabled||!this.currentState)return;const e=this.currentState;e.onUpdate&&e.onUpdate.call(this,t)}}function Z2(t,e,n){return t+(e-t)*n}class Q2 extends Db{constructor(t){super(),n(this,"id",""),n(this,"type","camera"),n(this,"selected",!1),n(this,"locked",!1),n(this,"view"),n(this,"target"),n(this,"lerp"),n(this,"world"),n(this,"debug",null),n(this,"worldBounds",new Hy(0,0,0,0)),n(this,"screenSize",new Hy(0,0,0,0)),n(this,"zoom",1),n(this,"clampToWorldBounds",!1),n(this,"ignoreList",[]),n(this,"fitScale",new Cy(1,1)),n(this,"offset",new Cy(.5,.5)),n(this,"isFit",!1),n(this,"debugWidth",6),this.label=t,this.view=new Hy(0,0,0,0),this.target=null,this.lerp={x:1,y:1},this.screenSize=new Hy(0,0,0,0),this.setWorldBounds(0,0,0,0),this.initComponentSystem(),vN().ticker.add(()=>{this.update()}),this.onResizeCallback=(t,e)=>{this.resize(t,e),this.target&&this.isFit&&(this.view.width=t*this.fitScale.x,this.view.height=e*this.fitScale.y,this.fitOn(this.target)),this.setWorldBounds(this.worldBounds.x,this.worldBounds.y,Math.max(this.worldBounds.width,t),Math.max(this.worldBounds.height,e))}}updateCameraComponent(t){this.baseWidth=t.width,this.baseHeight=t.height,this.view.width=t.width,this.view.height=t.height,this.clampToWorldBounds=t.clamp,this.world=d0.getNodeById(t.world),this.world,this.worldBounds=new Hy(t.worldPosition.x,t.worldPosition.y,t.worldWidth,t.worldHeight),this.lerp=t.lerp,this.isFit=t.isFit,this.fitScale=new Cy(t.fitScale.x,t.fitScale.y),this.offset=new Cy(t.offset.x,t.offset.y);const e=d0.getNodeById(t.target);e&&this.follow(e,this.lerp.x,this.lerp.y),t.debug?this.showDebug():this.hideDebug()}updateComponents(t){const e=t.camera;e&&this.updateCameraComponent(e),super.updateComponents(t)}setWorldBounds(t,e,n,i){this.worldBounds=new Hy(t,e,n*this.zoom,i*this.zoom)}follow(t,e=1,n=1){this.ignoreList.includes(t)&&(this.ignoreList=this.ignoreList.filter(e=>e!==t)),this.target=t,this.lerp={x:e,y:n}}unfollow(){this.target=null}focusOn(t){this.view.x=t.x*this.zoom-this.view.width/2,this.view.y=t.y*this.zoom-this.view.height/2}focusOnXY(t,e){this.view.x=t*this.zoom-this.view.width/2,this.view.y=e*this.zoom-this.view.height/2}fitOn(t){const e=this.view.width/t.width,n=this.view.height/t.height;this.zoom=Math.min(e,n),this.focusOn(t)}update(){this.target&&this.followTarget();let t={x:0,y:0};this.clampToWorldBounds&&!this.isFit&&this.clampCameraToWorldBounds(),t=this.offsetCamera(),this.world&&(this.world.position.set(-this.view.x+t.x,-this.view.y+t.y),this.world.scale.set(this.zoom)),this.updateIgnoreList(t),this.updateDebug()}updateIgnoreList(t){this.ignoreList.forEach(e=>{e.cameraOffset||(e.cameraOffset={x:e.x,y:e.y}),e.isDirty&&(e.isDirty=!1,e.cameraOffset={x:e.x,y:e.y});const n=-(-this.view.x+t.x),i=-(-this.view.y+t.y);e.position.set(n+e.cameraOffset.x,i+e.cameraOffset.y)})}clampCameraToWorldBounds(){this.worldBounds&&(this.leftCenter.x<=this.worldBounds.x&&(this.view.x=this.worldBounds.x),this.rightCenter.x>=this.worldBounds.x+this.worldBounds.width*this.zoom&&(this.view.x=this.worldBounds.x+this.worldBounds.width*this.zoom-this.view.width),this.topCenter.y<=this.worldBounds.y&&(this.view.y=this.worldBounds.y),this.bottomCenter.y>=this.worldBounds.y+this.worldBounds.height*this.zoom&&(this.view.y=this.worldBounds.y+this.worldBounds.height*this.zoom-this.view.height))}offsetCamera(){const t=this.screenSize.width-this.view.width,e=this.screenSize.height-this.view.height,n={x:t*this.offset.x,y:e*this.offset.y};return!this.clampToWorldBounds||this.isFit||(this.leftCenter.x<=n.x+this.worldBounds.x&&(n.x=this.leftCenter.x-this.worldBounds.x),this.topCenter.y<=n.y+this.worldBounds.y&&(n.y=this.topCenter.y-this.worldBounds.y),this.rightCenter.x+(t-n.x)>=this.worldBounds.x+this.worldBounds.width*this.zoom&&this.worldBounds.width*this.zoom>=this.screenSize.width&&(n.x=this.screenSize.width-this.view.width-(this.worldBounds.width*this.zoom-this.rightCenter.x)-this.worldBounds.y),this.bottomCenter.y+(e-n.y)>=this.worldBounds.y+this.worldBounds.height*this.zoom&&this.worldBounds.height*this.zoom>=this.screenSize.height&&(n.y=this.screenSize.height-this.view.height-(this.worldBounds.height*this.zoom-this.bottomCenter.y)-this.worldBounds.y)),n}followTarget(){this.target&&(this.view.x=Z2(this.view.x,this.target.x*this.zoom-.5*this.view.width,this.lerp.x),this.view.y=Z2(this.view.y,this.target.y*this.zoom-.5*this.view.height,this.lerp.y))}setViewSize(t,e){this.view.width=t,this.view.height=e}setScreenSize(t,e){this.screenSize=new Hy(0,0,t,e)}resize(t,e){this.setScreenSize(t,e)}reset(){this.target=null,this.view.x=0,this.view.y=0}set x(t){this.view.x=t}get x(){return this.view.x}set y(t){this.view.y=t}get y(){return this.view.y}get center(){return{x:this.view.x+.5*this.view.width,y:this.view.y+.5*this.view.height}}get leftCenter(){return{x:this.view.x,y:this.view.y+.5*this.view.height}}get rightCenter(){return{x:this.view.x+this.view.width,y:this.view.y+.5*this.view.height}}get topCenter(){return{x:this.view.x+.5*this.view.width,y:this.view.y}}get bottomCenter(){return{x:this.view.x+.5*this.view.width,y:this.view.y+this.view.height}}showDebug(t=0){this.debug||(this.debug=new MO,this.parent.addChild(this.debug),this.debug.zIndex=t)}hideDebug(){this.debug&&(this.debug.clear(),this.parent.removeChild(this.debug),this.debug=null)}updateDebug(){this.debug&&(this.debug.clear(),this.drawCameraFrame(),this.isFit||this.drawWorldFrame())}drawCameraFrame(){if(!this.debug)return;const t=this.world?this.world.x:0,e=this.world?this.world.y:0;this.debug.rect(t+this.view.x,e+this.view.y,this.view.width,this.view.height),this.debug.fill({color:16777215,alpha:.1});const n=.2*Math.min(this.view.width,this.view.height);this.debug.moveTo(t+this.view.x,e+this.view.y+n),this.debug.lineTo(t+this.view.x,e+this.view.y),this.debug.lineTo(t+this.view.x+n,e+this.view.y),this.debug.moveTo(t+this.view.x+this.view.width,e+this.view.y+n),this.debug.lineTo(t+this.view.x+this.view.width,e+this.view.y),this.debug.lineTo(t+this.view.x+this.view.width-n,e+this.view.y),this.debug.moveTo(t+this.view.x+n,e+this.view.y+this.view.height),this.debug.lineTo(t+this.view.x,e+this.view.y+this.view.height),this.debug.lineTo(t+this.view.x,e+this.view.y+this.view.height-n),this.debug.moveTo(t+this.view.x+this.view.width-n,e+this.view.y+this.view.height),this.debug.lineTo(t+this.view.x+this.view.width,e+this.view.y+this.view.height),this.debug.lineTo(t+this.view.x+this.view.width,e+this.view.y+this.view.height-n);const i=.5*n,r=.3;this.debug.moveTo(t+this.view.x+this.view.width*r,e+this.view.y+this.view.height*r+i),this.debug.lineTo(t+this.view.x+this.view.width*r,e+this.view.y+this.view.height*r),this.debug.lineTo(t+this.view.x+this.view.width*r+i,e+this.view.y+this.view.height*r),this.debug.moveTo(t+this.view.x+.7*this.view.width,e+this.view.y+this.view.height*r+i),this.debug.lineTo(t+this.view.x+.7*this.view.width,e+this.view.y+this.view.height*r),this.debug.lineTo(t+this.view.x+.7*this.view.width-i,e+this.view.y+this.view.height*r),this.debug.moveTo(t+this.view.x+this.view.width*r,e+this.view.y+.7*this.view.height-i),this.debug.lineTo(t+this.view.x+this.view.width*r,e+this.view.y+.7*this.view.height),this.debug.lineTo(t+this.view.x+this.view.width*r+i,e+this.view.y+.7*this.view.height),this.debug.moveTo(t+this.view.x+.7*this.view.width,e+this.view.y+.7*this.view.height-i),this.debug.lineTo(t+this.view.x+.7*this.view.width,e+this.view.y+.7*this.view.height),this.debug.lineTo(t+this.view.x+.7*this.view.width-i,e+this.view.y+.7*this.view.height),this.debug.stroke({color:0,width:this.debugWidth}),this.debug.moveTo(t+this.center.x,e+this.center.y-2*this.debugWidth),this.debug.lineTo(t+this.center.x,e+this.center.y+2*this.debugWidth),this.debug.moveTo(t+this.center.x-2*this.debugWidth,e+this.center.y),this.debug.lineTo(t+this.center.x+2*this.debugWidth,e+this.center.y),this.debug.stroke({color:16711680,width:this.debugWidth})}drawWorldFrame(){if(!this.debug)return;const t=this.world?this.world.x:0,e=this.world?this.world.y:0;this.debug.rect(t+this.worldBounds.x+.5*this.debugWidth,e+this.worldBounds.y+.5*this.debugWidth,this.worldBounds.width*this.zoom-1*this.debugWidth,this.worldBounds.height*this.zoom-1*this.debugWidth),this.debug.stroke({color:255,width:this.debugWidth})}}class $2 extends Db{constructor(){super(),n(this,"id",""),n(this,"type","feedback"),n(this,"debugRect",new MO),n(this,"mainWrapper",new Db),n(this,"selected",!1),n(this,"locked",!1),n(this,"feedbacks",{}),n(this,"animationTargets",[]),n(this,"delayedCalls",[]),n(this,"fontFamily","Arial"),n(this,"introTargets",[]),n(this,"outroTargets",[]),n(this,"promises",[]),this.initComponentSystem()}prepareText(t){const{texts:e,behaviors:n,skewBehavior:i,scaleBehavior:r,rotationBehavior:s,positionBehavior:a,blurBehavior:o}=t;this.animationTargets=[],this.children.forEach(t=>{t!==this.debugRect&&(this.removeChild(t),t.destroy())});const l=e.split(","),h=l[Math.floor(Math.random()*l.length)],c=this.prepareByContext(t,h);c.label="main_wrapper",this.mainWrapper=c,this.addChild(c);const u=c.getLocalBounds();c.pivot.set(u.x+.5*u.width,u.y+.5*u.height),c.scale.set(Math.min(this.baseWidth/u.width,this.baseHeight/u.height)),c.x=.5*this.baseWidth,c.y=.5*this.baseHeight,this.animationTargets.forEach(e=>{n.includes("alpha")&&(e.alpha=t.alphaBehavior.intro.fromAlpha),n.includes("scale")&&e.scale.set(r.intro.fromScaleX,r.intro.fromScaleY),n.includes("rotation")&&(e.rotation=s.intro.fromAngle*(Math.PI/180)),n.includes("skew")&&e.skew.set(i.intro.fromSkewX,i.intro.fromSkewY),n.includes("position")&&(e.x+=a.intro.fromX,e.y+=a.intro.fromY),n.includes("tint")&&(e.tint=a.intro.tint)}),n.includes("blur")&&QW.to(this.mainWrapper,{pixi:{blur:o.intro.fromBlur},duration:0})}prepareByContext(t,e){const{textsContext:n,letterSpacing:i,wordSpacing:r,letterOrigin:s,wordOrigin:a,colors:o,colorOrder:l}=t,h=new Db;let c=null;"letter"===n?c="":"word"===n?c=" ":"line"===n?c="\n":"all"===n&&(c=null);let u=null;u=null!=c?e.split(c):[e];const d=[],p=[];let f=0;return u.forEach((t,e)=>{const c=t.split("");let u=null;c.length>1&&(u=new Db,h.addChild(u));for(let n=0;n<c.length;n++){const t=c[n];if(""===t.trim()){f=r;continue}const a=new XO({text:t,style:{fontFamily:this.fontFamily,fontSize:64,align:"center"}});if(o.length)if("random"===l){const t=o[Math.floor(Math.random()*o.length)];a.tint=t}else if("sequential"===l){const t=e%o.length;a.tint=o[t]}else if("reverse"===l){const t=o.length-1-e%o.length;a.tint=o[t]}if(a.anchor.set(s.x,s.y),u?u.addChild(a):(h.addChild(a),this.animationTargets.push(a)),0===p.length)a.x=0;else{const t=p[p.length-1];a.x=t.x+(t.width||r)*(1-t.anchor.x)+(a.width||r)*a.anchor.x+i+f,f=0}a.iX=a.x,a.iY=a.y,p.push(a)}if(c.length>1&&u){const t=u.getLocalBounds();if(u.pivot.set(t.x+t.width*a.x,t.y+t.height*a.y),u.width=t.width,u.height=t.height,0===d.length)u.x=0,u.y=0;else{const t=d[d.length-1];"line"===n?(u.x=0,u.y=t.y+t.height*(1-a.y)+u.height*a.y):u.x=t.x+t.width*(1-a.x)+u.width*a.x+r+i}u.iX=u.x,u.iY=u.y,d.push(u),this.animationTargets.push(u)}}),h}play(t){return this.promises=[],new Promise(e=>{const n=Object.values(this.feedbacks).filter(e=>{const{name:n}=e;return n===t});n.length||(this.stop(),e());const i=n[0],{alphaBehavior:r,scaleBehavior:s,rotationBehavior:a,tintBehavior:o,positionBehavior:l,behaviorOptions:h}=i;QW.killTweensOf(this.mainWrapper),this.mainWrapper&&(this.mainWrapper.alpha=1,this.mainWrapper.visible=!0),this.prepareText(i),this.emit("feedback:start"),this.introTargets=[...this.animationTargets],this.outroTargets=[...this.animationTargets];const c=h.intro.order;"random"===c?this.introTargets.sort(()=>Math.random()-.5):"reverse"===c&&this.introTargets.reverse();const u=h.outro.order;"random"===u?this.outroTargets.sort(()=>Math.random()-.5):"reverse"===u&&this.outroTargets.reverse(),this.introTargets.forEach((t,e)=>{this.playBrightnessBehavior(t,e,i),this.playStartBehavior(t,e,i,"alpha",{alpha:1},{alpha:r.intro.fromAlpha},{alpha:r.intro.toAlpha}),this.playStartBehavior(t,e,i,"scale",{scaleX:1,scaleY:1},{scaleX:s.intro.fromScaleX,scaleY:s.intro.fromScaleY},{scaleX:s.intro.toScaleX,scaleY:s.intro.toScaleY}),this.playStartBehavior(t,e,i,"rotation",{rotation:0},{rotation:a.intro.fromAngle},{rotation:a.intro.toAngle}),this.playStartBehavior(t,e,i,"position",{x:0,y:0},{x:l.intro.fromX,y:l.intro.fromY},{x:l.intro.toX,y:l.intro.toY}),this.playBlurStartBehavior(t,e,i),o&&this.playStartBehavior(t,e,i,"tint",{tint:16777215},{tint:o.intro.fromTint},{tint:o.intro.toTint})}),Promise.all(this.promises).then(()=>{e(),this.promises=[],this.emit("feedback:complete")})})}playBrightnessBehavior(t,e,n){const{behaviors:i,brightnessBehavior:r,behaviorOptions:s}=n;i.includes("brightness")&&QW.to(this.mainWrapper,{pixi:{brightness:r.brightness},duration:r.duration,delay:r.delay,repeat:r.repeat,yoyo:r.yoyo,ease:"-"!==r.ease?r.ease:s.intro.ease})}playBlurStartBehavior(t,e,n){const{behaviors:i,behaviorOptions:r}=n;if(!i.includes("blur"))return Promise.resolve();const s=new Promise(i=>{const{delay:s,ease:a,duration:o}=n.blurBehavior.intro;QW.to(this.mainWrapper,{pixi:{blur:0},delay:s,duration:o,ease:"-"!==a?a:r.intro.ease,onComplete:()=>{const s=QW.delayedCall(r.betweenDelay,()=>{0!==r.intro.perDelay?e===this.introTargets.length-1&&this.playBlurEndBehavior(t,e,n):this.playBlurEndBehavior(t,e,n);const{delay:s,duration:a}=n.blurBehavior.outro;QW.delayedCall(a+s,()=>{i()})});this.delayedCalls.push(s)}})});return this.promises.push(s),s}playBlurEndBehavior(t,e,n){const{behaviors:i,behaviorOptions:r,blurBehavior:s}=n;if(!i.includes("blur"))return Promise.resolve();return new Promise(t=>{const{delay:e,ease:i,duration:a}=n.blurBehavior.outro;QW.to(this.mainWrapper,{pixi:{blur:s.outro.blur},delay:e,duration:a,ease:"-"!==i?i:r.outro.ease,onComplete:t})})}playStartBehavior(t,e,n,i,r,s,a){const{behaviors:o,behaviorOptions:l}=n;if(!o.includes(i))return Promise.resolve();const h=l.intro.order,c=l.outro.order,u=[...this.introTargets],d=[...this.outroTargets];"random"===h?u.sort(()=>Math.random()-.5):"reverse"===h&&u.reverse(),"random"===c?d.sort(()=>Math.random()-.5):"reverse"===c&&d.reverse();const p=new Promise(r=>{const{duration:o,repeat:p,delay:f,ease:m}=n[`${i}Behavior`].intro,{duration:g,delay:v}=n[`${i}Behavior`].outro;"position"===i&&(s.x=t.iX+s.x,s.y=t.iY+s.y,a.x+=t.iX+a.x,a.y+=t.iY+a.y);let y=0;const x=f=>{QW.to(t,{pixi:{...f},duration:o,ease:"-"!==m?m:l.intro.ease,onComplete:()=>{if(y===p){const s=QW.delayedCall(l.betweenDelay,()=>{const s=n[`${i}Behavior`].outro,a=d.indexOf(t),o="reverse"===l.outro.order?2:1;let p=v+l.intro.perDelay*a*o;"once"===l.outro.order&&(p=v);let f={};"alpha"===i?f={alpha:s.alpha}:"scale"===i?f={scaleX:s.scaleX,scaleY:s.scaleY}:"rotation"===i?f={rotation:s.angle}:"position"===i?f={x:t.iX+s.x,y:t.iY+s.y}:"tint"===i&&(f={tint:s.tint}),s.enabled?"once"===c?(e===u.length-1&&u.forEach((t,e)=>{this.playEndBehavior(t,e,n,i,{[i]:f})}),QW.delayedCall(g+p,()=>{r()})):"random"===h?(e===u.length-1&&u.forEach((t,e)=>{this.playEndBehavior(t,e,n,i,{[i]:f})}),QW.delayedCall(g+p,()=>{r()})):(this.playEndBehavior(t,e,n,i,{[i]:f}),QW.delayedCall(g+p,()=>{r()})):r()});this.delayedCalls.push(s)}else x(y%2==1?a:s);y+=1}})},b=u.indexOf(t);QW.delayedCall(f+l.intro.perDelay*b,()=>{x(a)})});return this.promises.push(p),p}playEndBehavior(t,e,n,i,r){const{behaviors:s,behaviorOptions:a,positionBehavior:o}=n;if(!s.includes(i))return Promise.resolve();return new Promise(e=>{const{duration:s,delay:l,ease:h}=n[`${i}Behavior`].outro;let c=r;if("position"===i){const{x:e,y:n}=o.outro;c={position:{x:t.iX+e,y:t.iY+n}}}const u=this.outroTargets.indexOf(t),d="reverse"===a.outro.order?2:1;let p=l+a.outro.perDelay*u*d;"once"===a.outro.order&&(p=l),QW.to(t,{pixi:{...c[i]},delay:p,duration:s,ease:"-"!==h?h:a.outro.ease,onComplete:e})})}stop(){this.delayedCalls.forEach(t=>{t.kill()}),this.animationTargets.forEach(t=>{QW.killTweensOf(t)}),QW.to(this.mainWrapper,{pixi:{alpha:0},duration:.5,onComplete:()=>{this.children.length&&this.mainWrapper&&(this.mainWrapper.filters=[]),this.visible=!1}}),this.emit("feedback:stop")}forceStop(){this.delayedCalls.forEach(t=>{t.kill()}),this.animationTargets.forEach(t=>{QW.killTweensOf(t)}),this.children.length&&this.mainWrapper&&(this.mainWrapper.filters=[]),this.mainWrapper&&(this.mainWrapper.alpha=0,this.mainWrapper.visible=!1),this.emit("feedback:stop")}updateFeedbackComponent(t){if(this.baseWidth=t.width,this.baseHeight=t.height,this.updateDebug(),this.fontFamily=t.fontFamily,this.feedbacks=t.feedbacks,this.feedbacks)for(const n in this.feedbacks){const t=this.feedbacks[n],{name:e,showEvents:i,hideEvents:r}=t;i.forEach(t=>{this.eventEmitter.on(t,()=>{this.play(e)})}),r.forEach(t=>{this.eventEmitter.on(t,()=>{this.stop()})})}const e=this.components.get("transform");this.setOrigin(e.origin.x,e.origin.y)}updateDebug(){}updateComponents(t){const e=this.components.get("transform"),n=t.feedback;n&&this.updateFeedbackComponent(n),this.setOrigin(e.origin.x,e.origin.y),super.updateComponents(t)}}class t3 extends nD{constructor(t,e,i){super({}),n(this,"type","text"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"fontFamily","Arial"),n(this,"align","left"),n(this,"fontSize",26),n(this,"fill","#ffffff"),n(this,"lineHeight",0),n(this,"leading",0),n(this,"letterSpacing",0),n(this,"padding",0),n(this,"strokeColor","#000000"),n(this,"strokeThickness",0),n(this,"shadow",{enabled:!1,alpha:1,color:"#000000",blur:0,angle:0,distance:5}),n(this,"wordWrap",!1),n(this,"wordWrapWidth",100),n(this,"breakWords",!0),n(this,"gradientBoxDataObject",null),this.initComponentSystem(),this.text=i,this.x=t,this.y=e}setText(t){"string"==typeof t?this.text=t:(this.text=t.text,this.setTextStyles(t));const e=this.getLocalBounds();this.baseWidth=e.width,this.baseHeight=e.height,this.components.responsive&&this.components.responsive.update(this.components.get("responsive").data)}updatePixiObject(){let{fontFamily:t}=this;"__global__"===t&&(t=xN());const e={fontFamily:t||"Arial",fontSize:this.fontSize,fill:"#ffffff  ",align:this.align,lineHeight:this.lineHeight,leading:this.leading,letterSpacing:this.letterSpacing,padding:this.padding,stroke:{width:this.strokeThickness,color:new zx(+this.strokeColor.replace("#","0x"))},dropShadow:{alpha:this.shadow.alpha,color:new zx(+this.shadow.color.replace("#","0x")),blur:this.shadow.blur,angle:this.shadow.angle,distance:this.shadow.distance},wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,breakWords:this.breakWords};e.fill=this.convertToFillStyle(this.fill,this.fontSize,this.gradientBoxDataObject),this.shadow.enabled||delete e.dropShadow,this.style=new uE(e);const n=this.getLocalBounds();this.baseWidth=n.width,this.baseHeight=n.height,this.components.responsive&&this.components.responsive.update()}updateTextComponent(t){if(this.fontFamily=t.fontFamily,this.resolution=t.resolution,this.text=t.text,this.align=t.align,this.fontSize=t.fontSize,this.fill=t.fill,this.lineHeight=t.lineHeight,this.leading=t.leading,this.letterSpacing=t.letterSpacing,this.padding=t.padding,this.strokeColor=t.strokeColor,this.strokeThickness=t.strokeThickness,this.shadow=t.shadow,this.wordWrap=t.wordWrap,this.wordWrapWidth=t.wordWrapWidth,this.breakWords=t.breakWords,this.gradientBoxDataObject=t.gradientBoxDataObject,t.datajsID&&window.app.data[t.datajsID]){const e=window.app.data[t.datajsID];this.text=e.text,t.datajsColor&&(this.fill=e.color),t.datajsStroke&&(this.strokeColor=e.stroke.color,this.strokeThickness=e.stroke.thickness),t.datajsShadow&&(this.shadow={...this.shadow,...e.shadow}),t.datajsMultiline&&(this.lineHeight=e.multiline.lineHeight)}this.updatePixiObject()}getTextComponent(){return{type:"text",fontFamily:this.fontFamily,resolution:this.resolution,text:this.text,align:this.align,fontSize:this.fontSize,fill:this.fill,lineHeight:this.lineHeight,leading:this.leading,letterSpacing:this.letterSpacing,padding:this.padding,strokeColor:this.strokeColor,strokeThickness:this.strokeThickness,shadow:this.shadow,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,breakWords:this.breakWords,gradientBoxDataObject:this.gradientBoxDataObject}}updateComponents(t){const e=t.text;e&&this.updateTextComponent(e),super.updateComponents(t)}setTextStyles(t){let e={text:"text",color:"#ffffff",multiline:{enabled:!1,lineHeight:1.2},stroke:{color:"#000000",thickness:0},shadow:{color:"#000000",distance:0,blur:0,angle:0,alpha:0}};t&&(e={...e,...t});const n=this.style;n.fill=e.color,e.stroke&&(n.stroke={color:e.stroke.color,width:e.stroke.thickness,join:"round"}),e.shadow&&e.shadow.distance?(e.shadow.angle=e.shadow.angle*(180/Math.PI),n.dropShadow={...e.shadow}):n.dropShadow=!1,e.multiline&&e.multiline.enabled&&(n.lineHeight=e.multiline.lineHeight*n.fontSize),this.style=n}}class e3 extends f0{constructor(t=0,e=0){super(t,e),n(this,"id",""),n(this,"type","cta"),n(this,"selected",!1),n(this,"locked",!1),n(this,"innerContainer"),n(this,"bgImage"),n(this,"text"),n(this,"ctaComponent"),n(this,"pulseStarted",!1),n(this,"pulseTween",null),n(this,"eventsInited",!1),this.innerContainer=new Db,this.addChild(this.innerContainer),this.bgImage=new p0({x:0,y:0,texture:""}),this.innerContainer.addChild(this.bgImage),this.text=new y0(0,0,""),this.innerContainer.addChild(this.text)}updateText(t){let{text:e,textColor:n,textStrokeThickness:i,textStrokeColor:r}=t;const{fontFamily:s}=t;let{textScaleX:a,textScaleY:o,textOffsetX:l,textOffsetY:h}=t;{const{datajsID:s}=t,c=window.app.data[s+"_text"];s&&c&&(e=c.text,n=c.color,i=c.stroke.thickness,r=c.stroke.color),a=app.data[s+"_textScaleX"]??a,o=app.data[s+"_textScaleY"]??o,l=app.data[s+"_textOffsetX"]??l,h=app.data[s+"_textOffsetY"]??h,this.visible=app.data[s+"_enable"]??!0}this.text.updateTextComponent({...this.text.getTextComponent(),fontSize:60,text:e,fill:n,strokeThickness:i,strokeColor:r,fontFamily:s});const c=Math.min(this.baseWidth*a/100/this.text.baseWidth,this.baseHeight*o/100/this.text.baseHeight);this.text.setOrigin(.5,.5),this.text.scale.set(c),this.text.x=this.baseWidth/2+l*this.baseWidth/100,this.text.y=this.baseHeight/2+h*this.baseHeight/100}updatePulse(t,e){{const n=app.data[t+"_enablePulse"]??e;this.pulseTween&&(this.pulseTween.kill(),this.pulseTween=null),n&&(this.pulseStarted=!0,this.innerContainer.scale.set(1),this.pulseTween=QW.to(this.innerContainer.scale,{x:.95,y:.95,duration:.5,repeat:-1,yoyo:!0,ease:"sine.inOut"}))}}updateCta(t,e,n){this.baseWidth=this.bgImage.baseWidth,this.baseHeight=this.bgImage.baseHeight,this.innerContainer.baseWidth=this.baseWidth,this.innerContainer.baseHeight=this.baseHeight,this.innerContainer.pivot.set(this.baseWidth/2,this.baseHeight/2),this.innerContainer.setOrigin(.5,.5),this.innerContainer.x=this.baseWidth/2,this.innerContainer.y=this.baseHeight/2;try{this.pivot.set(this.baseWidth*e,this.baseHeight*n),this.setOrigin(e,n),this.updateDebug(),this.updateText(t)}catch(S6){}}updateComponents(t){super.updateComponents({...t});const e=t.cta||this.ctaComponent,n=t.sprite;n&&this.bgImage.updateSpriteComponent(n),e&&(this.ctaComponent=e,this.updateCtaComponent(e),this.updatePulse(e.datajsID,e.enablePulse))}updateCtaComponent(t){const e=this.components.get("transform"),n=e.origin.x,i=e.origin.y,r=t||this.ctaComponent;r&&(this.ctaComponent=r,this.updateCta(r,n,i),this.initEvents())}preResize(){this.bgImage.preResize(),this.updateCtaComponent()}initEvents(){if(this.eventsInited)return;this.eventsInited=!0;const t=this.ctaComponent.datajsID;["text","textScaleX","textScaleY","textOffsetX","textOffsetY"].forEach(e=>{const n=t+"_"+e;window.addEventListener("pf_"+n,async t=>{app.data[n]=t.detail.value,this.updateCtaComponent()})}),window.addEventListener("pf_"+t+"_enablePulse",async e=>{app.data[t+"_enablePulse"]=e.detail.value,this.updatePulse(t,this.ctaComponent.enablePulse)}),window.addEventListener("pf_"+t+"_enable",async e=>{app.data[t+"_enable"]=e.detail.value,this.visible=e.detail.value}),this.eventEmitter.on(this.id+"_image",()=>{this.updateCtaComponent()})}}class n3 extends f0{constructor(t=0,e=0,i={}){super(t,e),n(this,"id",""),n(this,"type","particleEmitter"),n(this,"selected",!1),n(this,"locked",!1),n(this,"config",{}),n(this,"emitter"),n(this,"autoplay",!1),this.config=i}updateComponents(t){const e=t.particleEmitter;e&&(this.updateContainerComponent({type:"container",width:e.width,height:e.height,landscape:!1,landscapeWidth:0,landscapeHeight:0,debug:e.debug}),this.updateParticleEmitterComponent(e)),super.updateComponents({...t})}async updateEmitter(t){const e=()=>{this.emitter&&this.emitter.destroy();const e=t.behaviors.find(t=>"textureData"===t.type);if(t.behaviors=t.behaviors.filter(t=>t.config.enabled),e){const n=["textureSingle","textureRandom","textureOrdered","animatedSingle","animatedRandom"];t.behaviors=t.behaviors.filter(t=>!n.includes(t.type)),t.behaviors.push({type:"random"===e.config.type?"textureRandom":"textureOrdered",config:{textures:e.config.textures}})}t.pos={x:.5*this.baseWidth,y:.5*this.baseHeight},this.emitter=new window.particles.Emitter(this,t),this.emitter.emit=this.autoplay,this.emitter.spawnPos.x=.5*this.baseWidth,this.emitter.spawnPos.y=.5*this.baseHeight},n=t.behaviors.find(t=>"textureData"===t.type);if(n)Promise.all(n.config.textures.map((t,e)=>new Promise(i=>{const r=u0.getTexture(t,t=>{n.config.textures[e]=t,i(t)});r&&(n.config.textures[e]=r,i(r))}))).then(()=>{e()});else{const n=t.behaviors.find(t=>"textureSingle"===t.type),i=n.config.texture,r=u0.getTexture(i,t=>{n.config.texture=t,e()});r&&(n.config.texture=r,e())}}updateParticleEmitterComponent(t){if(this.autoplay=(null==t?void 0:t.particleData.autoplay)||!1,window.particles){const e=this.mapParticleDataToComponent(null==t?void 0:t.particleData);this.updateEmitter(JSON.parse(JSON.stringify(e)))}}customUpdate(t){this.emitter&&this.emitter.update(t)}mapParticleDataToComponent(t){const e=[];Object.keys(t.behaviors).forEach(n=>{const i=t.behaviors[n];e.push({type:n,config:i})});const n={...t,behaviors:e},i=n.behaviors.find(t=>"spawnShape"===t.type),r=i.config.type.charAt(0).toUpperCase()+i.config.type.slice(1);return i.config={...i.config,data:i.config[`data${r}`]},n}set isActive(t){this.autoplay=t,this.emitter&&(this.emitter.emit=t)}get isActive(){return this.autoplay}setEmitterPosition(t,e){this.emitter&&(this.emitter.spawnPos.x=t,this.emitter.spawnPos.y=e)}emitParticleAt(t,e,n=1){if(this.emitter){const i=this.emitter.spawnPos.x,r=this.emitter.spawnPos.y;this.emitter.spawnPos.x=t,this.emitter.spawnPos.y=e;for(let t=0;t<n;t++)this.emitter.emitNow();this.emitter.spawnPos.x=i,this.emitter.spawnPos.y=r}}}class i3 extends KL{constructor(){super(),n(this,"id",""),n(this,"type","layer"),n(this,"label",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"layerComponents",{type:"layer",label:""}),n(this,"components"),this.components={resize:()=>{},update:()=>{}}}updateComponents(t){const e=t.layer;e&&(this.layerComponents=e,this.label=e.label??this.label)}getComponent(t){return this.components.getComponent(t)}}class r3 extends Fb{constructor(){super({texture:ox.EMPTY}),n(this,"type","sprite"),n(this,"id",""),n(this,"selected",!1),n(this,"locked",!1),n(this,"eventEmitter",Gk.getInstance()),n(this,"videoComponent",{type:"video",src:"",loop:!0,autoplay:!0,muted:!0,unmuteOnTouch:!1,useUniqueTexture:!1,uploadId:"",uploadName:"",srcType:"video"}),n(this,"videoElement",null),n(this,"videoSrc",""),this.initComponentSystem()}updateVideoParams(){if(!this.videoElement)return;const t=this.videoComponent;this.videoElement.autoplay=t.autoplay,this.videoElement.loop=t.loop,this.videoElement.muted=t.muted,this.videoElement.autoplay?this.play():this.stop()}async changeVideoTexture(t){if(!t.src)return;let e=t.src;if(t.useUniqueTexture&&(e+=`_${this.id}`),this.videoSrc===e&&this.videoElement)return void this.updateVideoParams();this.videoSrc=e;let n=t.src;"uploadable"===t.srcType&&(n=`___uploaded_${t.uploadId}`,e=n);const i=await u0.getVideo(n,e,!1,{loop:t.loop,autoplay:t.autoplay,muted:t.muted});i&&(this._setTextureFrame(i),this.videoElement=i.source.resource,this.updateVideoParams(),this.baseWidth=i.width,this.baseHeight=i.height)}updateVideoComponent(t){this.videoComponent=t,t.src&&this.changeVideoTexture(t)}updateComponents(t){const e=t.video;e&&this.updateVideoComponent(e),super.updateComponents(t)}play(){var t;null==(t=this.videoElement)||t.play()}pause(){var t;null==(t=this.videoElement)||t.pause()}stop(){this.videoElement&&(this.videoElement.pause(),this.videoElement.currentTime=0)}set muted(t){this.videoElement&&(this.videoElement.muted=t)}get muted(){var t;return(null==(t=this.videoElement)?void 0:t.muted)||!1}set src(t){this.videoSrc=t,this.videoComponent.src=t,this.changeVideoTexture(this.videoComponent)}get src(){return this.videoSrc}set autoplay(t){this.videoElement&&(this.videoElement.autoplay=t)}get autoplay(){var t;return(null==(t=this.videoElement)?void 0:t.autoplay)||!1}set loop(t){this.videoElement&&(this.videoElement.loop=t)}get loop(){var t;return(null==(t=this.videoElement)?void 0:t.loop)||!1}set currentTime(t){this.videoElement&&(this.videoElement.currentTime=t)}get currentTime(){var t;return(null==(t=this.videoElement)?void 0:t.currentTime)||0}}let s3=class extends Fb{constructor(t){super(t),n(this,"velocity",new Cy(0,0)),n(this,"maxLifetime",2),n(this,"lifetime",2),n(this,"unitScale",1),n(this,"normalizedLifetime",1),n(this,"cachedStartPos",new Cy(0,0)),n(this,"cachedRotation",0),n(this,"emittedPos",new Cy(0,0))}setLifetime(t){this.lifetime=t,this.maxLifetime=t,this.normalizedLifetime=1}};class a3{}class o3 extends a3{execute(t,e){t.x+=t.velocity.x*e*t.unitScale,t.y+=t.velocity.y*e*t.unitScale,-1!==t.lifetime&&(t.lifetime-=e,t.normalizedLifetime=t.lifetime/t.maxLifetime)}}class l3 extends f0{constructor(t,e){super(),n(this,"settings",{lifetime:-1,autoDestroyAfterLifetime:!0}),n(this,"emitterUpdateStack",[]),n(this,"particleSpawnStack",[]),n(this,"particleUpdateStack",[]),n(this,"particles",[]),n(this,"elapsedTime",0),n(this,"isKilled",!1),n(this,"unitScale",10),n(this,"emitPos",new Cy(0,0)),this.settings={...this.settings,...t},this.initialize()}initialize(){QW.registerEase("bellCurve",QW.parseEase("M0,0 C0.28,0 0.282,1 0.5,1 0.679,1 0.779,0 1,0"))}setEmitterUpdateStack(t){this.emitterUpdateStack=[...t]}setParticleSpawnStack(t){this.particleSpawnStack=[...t]}setParticleUpdateStack(t){this.particleUpdateStack=[...t,new o3]}spawnParticles(t){for(let e=0;e<t;e++)this.spawnSingleParticle()}updateEmitter(t,e=!0){this.settings.autoDestroyAfterLifetime&&!this.destroyed&&this.isKilled&&0===this.particles.length&&this.destroy(),-1!=this.settings.lifetime&&this.elapsedTime>=this.settings.lifetime&&(this.isKilled=!0),this.elapsedTime+=t;const n={spawnCount:0};this._internal_handleEmitterUpdate(n,t),e&&this._internal_SpawnParticles(n),this._internal_handleUpdateParticle(t)}_internal_handleEmitterUpdate(t,e){this.emitterUpdateStack.forEach(n=>{this.isKilled||n.execute(t,e)})}_internal_handleUpdateParticle(t){for(let e=this.particles.length-1;e>=0;e--){const n=this.particles[e];this.particleUpdateStack.forEach(e=>{e.execute(n,t)}),-1!==n.lifetime&&n.lifetime<0&&(this.removeChild(n),this.particles.splice(e,1))}}_internal_SpawnParticles(t){if(!this.isKilled)for(let e=0;e<t.spawnCount;e++)this.spawnSingleParticle()}spawnSingleParticle(){const t=new s3({texture:ox.WHITE,x:this.emitPos.x,y:this.emitPos.y});t.anchor.set(.5,.5),t.scaleX=10,t.scaleY=10,t.unitScale=this.unitScale,t.emittedPos=this.emitPos,this.particleSpawnStack.forEach(e=>{e.execute(t)}),this.particles.push(t),this.addChild(t)}}class h3{constructor(t){n(this,"stops",[]),this.stops=t.map(({pos:t,color:e})=>({pos:t,color:h3.hexToRGB(e)})).sort((t,e)=>t.pos-e.pos)}sample(t){const e=this.sampleRGB(t);return h3.rgbToHex(e)}sampleRGB(t){if(t<=this.stops[0].pos)return this.stops[0].color;if(t>=this.stops[this.stops.length-1].pos)return this.stops[this.stops.length-1].color;for(let e=0;e<this.stops.length-1;e++){const n=this.stops[e],i=this.stops[e+1];if(t>=n.pos&&t<=i.pos){const e=(t-n.pos)/(i.pos-n.pos);return h3.lerpRGB(n.color,i.color,e)}}return this.stops[0].color}static lerpRGB(t,e,n){return[Math.round(t[0]+(e[0]-t[0])*n),Math.round(t[1]+(e[1]-t[1])*n),Math.round(t[2]+(e[2]-t[2])*n)]}static hexToRGB(t){3===(t=t.replace(/^#/,"")).length&&(t=t.split("").map(t=>t+t).join(""));const e=parseInt(t,16);return[e>>16&255,e>>8&255,255&e]}static rgbToHex([t,e,n]){return"#"+[t,e,n].map(t=>{const e=t.toString(16);return 1===e.length?"0"+e:e}).join("")}static generateHueGradientStops(t){return Array.from({length:t},(e,n)=>{const i=n/(t-1);return{pos:i,color:c3(Math.round(360*i),100,50)}})}static randomFillGradient(){return new h3(h3.generateHueGradientStops(20))}}function c3(t,e,n){e/=100,n/=100;const i=(1-Math.abs(2*n-1))*e,r=i*(1-Math.abs(t/60%2-1)),s=n-i/2;let[a,o,l]=[0,0,0];[a,o,l]=t<60?[i,r,0]:t<120?[r,i,0]:t<180?[0,i,r]:t<240?[0,r,i]:t<300?[r,0,i]:[i,0,r];const h=t=>{const e=Math.round(255*(t+s)).toString(16);return 1===e.length?"0"+e:e};return`#${h(a)}${h(o)}${h(l)}`}function u3(t,e,n){return t+(e-t)*n}function d3(t,e){return Array.isArray(t)?(n=t[0],i=t[1],Math.random()*(i-n)+n):t??e;var n,i}function p3(t){t=t.replace(/^#/,"");const e=parseInt(t,16);return[e>>16&255,e>>8&255,255&e]}function f3(t,e,n){const i=function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n,t[2]+(e[2]-t[2])*n]}(p3(t),p3(e),n);return function([t,e,n]){return`#${[t,e,n].map(t=>Math.round(t).toString(16).padStart(2,"0")).join("")}`}(i)}class m3 extends a3{constructor(t){super(),n(this,"settings",{scale:[0,1],ease:"sine.inOut"}),this.settings={...this.settings,...t,ease:QW.parseEase(t.ease??this.settings.ease)}}execute(t,e){var n,i,r,s;const a=this.settings.ease(t.normalizedLifetime),o=Math.min((null==(i=null==(n=t.texture)?void 0:n.source)?void 0:i.width)??1,(null==(s=null==(r=t.texture)?void 0:r.source)?void 0:s.height)??1);Array.isArray(this.settings.scale)?(t.scaleX=u3(this.settings.scale[0],this.settings.scale[1],1-a)*t.unitScale/o,t.scaleY=u3(this.settings.scale[0],this.settings.scale[1],1-a)*t.unitScale/o):(t.scaleX=this.settings.scale*t.unitScale/o,t.scaleY=this.settings.scale*t.unitScale/o)}}class g3 extends a3{constructor(t){super(),n(this,"settings",{drag:.99}),this.settings={...this.settings,...t}}execute(t,e){t.velocity.x*=this.settings.drag,t.velocity.y*=this.settings.drag}}class v3 extends a3{constructor(t){super(),n(this,"settings",{multiplier:1}),this.settings={...this.settings,...t}}execute(t,e){t.velocity.y+=9.81*e*t.unitScale*(this.settings.multiplier??1)}}class y3 extends a3{constructor(t){super(),n(this,"settings",{strength:10,frequency:10,noiseZAxisMoveSpeed:.1}),this.settings={...this.settings,...t}}hash(t,e,n){const i=43758.5453*Math.sin(12.9898*t+78.233*e+37.719*n);return i-Math.floor(i)}noise(t,e,n){const i=Math.floor(t),r=Math.floor(e),s=Math.floor(n),a=e-r,o=n-s,l=t=>t*t*t*(t*(6*t-15)+10),h=(t,e,n)=>t+(e-t)*n,c=l(t-i),u=l(a),d=l(o),p=(t,e,n)=>this.hash(i+t,r+e,s+n);return 2*h(h(h(p(0,0,0),p(1,0,0),c),h(p(0,1,0),p(1,1,0),c),u),h(h(p(0,0,1),p(1,0,1),c),h(p(0,1,1),p(1,1,1),c),u),d)-1}execute(t,e){const n=performance.now()*this.settings.noiseZAxisMoveSpeed,i=t.x*this.settings.frequency,r=t.y*this.settings.frequency,s=n*this.settings.frequency,a=this.noise(i,r,s),o=this.noise(i+1e3,r+1e3,s);t.velocity.x+=a*this.settings.strength*e,t.velocity.y+=o*this.settings.strength*e}}class x3 extends a3{constructor(t){super(),n(this,"settings",{from:"#ffffff",to:"#ffffff",lifetimeAlpha:!0,setColor:!0}),this.settings={...this.settings,...t}}execute(t,e){const n=f3(this.settings.from??"#ffffff",this.settings.to??"#ffffff",1-t.normalizedLifetime);this.settings.setColor&&(t.tint=parseInt(n.slice(1),16)),this.settings.lifetimeAlpha&&(t.alpha=t.normalizedLifetime)}}class b3 extends a3{constructor(t){super(),n(this,"settings",{startVelocity:[0,1],endVelocity:[0,1],setStartVelocity:!0,ease:"sine.inOut"}),this.settings={...this.settings,...t,ease:QW.parseEase(t.ease??this.settings.ease)}}execute(t,e){const n=this.settings.ease(t.normalizedLifetime);if(!this.settings.setStartVelocity)return t.velocity.x*=n,void(t.velocity.y*=n);t.velocity.x=u3(this.settings.startVelocity[0],this.settings.endVelocity[0],1-n),t.velocity.y=u3(this.settings.startVelocity[1],this.settings.endVelocity[1],1-n)}}class _3 extends a3{constructor(t){super(),n(this,"settings",{startPosition:[0,1],endPosition:[0,1],setStartPosition:!0,ease:"sine.inOut"}),this.settings={...this.settings,...t,ease:QW.parseEase(t.ease??this.settings.ease)}}execute(t,e){const n=this.settings.ease(t.normalizedLifetime);if(!this.settings.setStartPosition&&t.cachedStartPos)return t.position.x=u3(t.cachedStartPos.x,this.settings.endPosition[0],1-n),void(t.position.y=u3(t.cachedStartPos.y,this.settings.endPosition[1],1-n));t.position.x=u3(this.settings.startPosition[0],this.settings.endPosition[0],1-n),t.position.y=u3(this.settings.startPosition[1],this.settings.endPosition[1],1-n)}}class S3 extends a3{constructor(t){super(),n(this,"settings",{startRotation:0,endRotation:360,setStartRotation:!0,ease:"sine.inOut"}),this.settings={...this.settings,...t,ease:QW.parseEase(t.ease??this.settings.ease)}}execute(t,e){const n=this.settings.ease(t.normalizedLifetime);this.settings.setStartRotation||!t.cachedRotation?t.angle=u3(this.settings.startRotation,this.settings.endRotation,1-n):t.angle=u3(t.cachedRotation,this.settings.endRotation,1-n)}}class w3 extends a3{constructor(t){super(),n(this,"settings",{position:[0,0],strength:1}),this.settings={...this.settings,...t}}execute(t,e){t.position.x=u3(t.position.x,this.settings.position[0],e*this.settings.strength*(1-t.normalizedLifetime)),t.position.y=u3(t.position.y,this.settings.position[1],e*this.settings.strength*(1-t.normalizedLifetime))}}class T3{}class M3 extends T3{constructor(t={}){super(),n(this,"defaultSettings",{blendMode:"normal"}),this.settings=t,this.settings={...this.defaultSettings,...t}}execute(t){t.blendMode=this.settings.blendMode??"normal"}}class A3 extends T3{constructor(t={}){super(),n(this,"defaultSettings",{color:new h3([{pos:0,color:"#ffffff"}]),alpha:1}),this.settings=t,this.settings={...this.defaultSettings,...t}}execute(t){var e;t.alpha=this.settings.alpha??1,t.tint=parseInt((null==(e=this.settings.color)?void 0:e.sample(Math.random()).slice(1))??"#ffffff",16)}}class E3 extends T3{constructor(t={}){super(),n(this,"defaultSettings",{x:1,y:1}),this.settings=t,this.settings={...this.defaultSettings,...t}}execute(t){t.x=d3(this.settings.x,0)+t.emittedPos.x,t.y=d3(this.settings.y,0)+t.emittedPos.y,t.cachedStartPos=new Cy(t.x,t.y)}}class C3 extends T3{constructor(t={}){super(),n(this,"defaultSettings",{x:0}),this.settings=t,this.settings={...this.defaultSettings,...t}}execute(t){t.angle=d3(this.settings.x,0),t.cachedRotation=t.angle}}class P3 extends T3{constructor(t={}){super(),n(this,"defaultSettings",{texture:ox.WHITE}),this.settings=t,this.settings={...this.defaultSettings,...t}}execute(t){var e,n,i,r,s,a;null==(n=null==(e=t.originalTextureDescriptor)?void 0:e.set)||n.call(t,this.settings.texture),t.scaleX/=(null==(r=null==(i=this.settings.texture)?void 0:i.source)?void 0:r.width)??1,t.scaleY/=(null==(a=null==(s=this.settings.texture)?void 0:s.source)?void 0:a.height)??1}}class R3 extends T3{constructor(t={}){super(),n(this,"defaultSettings",{velocityX:1,velocityY:1,radial:!1}),this.settings=t,this.settings={...this.defaultSettings,...t}}execute(t){if(t.velocity.x=d3(this.settings.velocityX,0),t.velocity.y=d3(this.settings.velocityY,0),this.settings.radial){const e=Math.random()*Math.PI*2;t.velocity.x*=Math.cos(e),t.velocity.y*=Math.sin(e)}}}class I3 extends T3{constructor(t){super(),this.settings=t}execute(t){t.setLifetime(d3(this.settings.lifetime,1))}}class O3{}class D3 extends O3{constructor(t){super(),n(this,"totalDelta",1e5),n(this,"settings",{period:1,amount:50}),this.settings={...this.settings,...t}}execute(t,e){return this.totalDelta+=e,this.totalDelta>this.settings.period&&(t.spawnCount+=this.settings.amount,this.totalDelta=0),1}}class B3 extends O3{constructor(t){super(),n(this,"totalDelta",0),n(this,"settings",{spawnRate:10}),this.settings={...this.settings,...t}}execute(t,e){return this.totalDelta+=e,this.totalDelta>.01&&(t.spawnCount+=1*this.settings.spawnRate,this.totalDelta=0),1}}class F3 extends f0{constructor({x:t=0,y:e=0}){super(t,e),n(this,"shuraContainer"),n(this,"emitterUpdateList",[]),n(this,"particleSpawnList",[]),n(this,"particleUpdateList",[]),n(this,"currentComponent"),n(this,"textureCache",new Map),n(this,"customEmitterUpdateList",[]),n(this,"customParticleSpawnList",[]),n(this,"customParticleUpdateList",[]),n(this,"updateEmitter",!0),n(this,"emitParticles",!0),n(this,"shuraContainerWorldPos"),this.shuraContainer=new l3({lifetime:-1,autoDestroyAfterLifetime:!1}),this.shuraContainer.x=50,this.shuraContainer.y=50,this.shuraContainerWorldPos=this.shuraContainer.getGlobalPosition(),this.shuraContainer.setParticleUpdateStack([]),this.addChild(this.shuraContainer)}safeKey(t){return t.replace(/\s+/g,"_").toLowerCase()}toPrimitiveArray(t,e=[]){return Array.isArray(t)?t:t&&"object"==typeof t?Object.keys(t).map(e=>({k:Number(e),v:t[e]})).sort((t,e)=>t.k-e.k).map(t=>t.v):e}toNumberOrRange(t,e){if("number"==typeof t)return t;const n=this.toPrimitiveArray(t);return n.length>=2?[n[0],n[1]]:1===n.length?n[0]:e}updateShuraComponent(t){this.currentComponent=t,this.emitterUpdateList=t.emitterUpdateStack??[],this.updateEmitterUpdateList(),this.particleSpawnList=t.particleSpawnStack??[],this.updateParticleSpawnList(),this.particleUpdateList=t.particleUpdateStack??[],this.updateParticleUpdateList()}updateParticleUpdateList(){const t=[];this.particleUpdateList.forEach(e=>{var n,i,r,s,a,o,l,h,c;const u=this.safeKey(e),d=this.currentComponent;switch(e){case"Color Over Lifetime":{const e=(null==(n=null==d?void 0:d.particleUpdateSettings)?void 0:n[u])??{};t.push(new x3({from:e.from??"#ffffff",to:e.to??"#ffffff",lifetimeAlpha:e.lifetimeAlpha??!0,setColor:e.setColor??!0}))}break;case"Drag":{const e=(null==(i=null==d?void 0:d.particleUpdateSettings)?void 0:i[u])??{};t.push(new g3({drag:e.drag??.99}))}break;case"Gravity":{const e=(null==(r=null==d?void 0:d.particleUpdateSettings)?void 0:r[u])??{};t.push(new v3({multiplier:e.multiplier??1}))}break;case"Scale Over Lifetime":{const e=(null==(s=null==d?void 0:d.particleUpdateSettings)?void 0:s[u])??{},n=this.toNumberOrRange(e.scale,[1,0]);t.push(new m3({scale:n,ease:e.ease??"sine.inOut"}))}break;case"Turbulence":{const e=(null==(a=null==d?void 0:d.particleUpdateSettings)?void 0:a[u])??{};t.push(new y3({strength:e.strength??10,frequency:e.frequency??10,noiseZAxisMoveSpeed:e.noiseZAxisMoveSpeed??.1}))}break;case"Velocity Over Lifetime":{const e=(null==(o=null==d?void 0:d.particleUpdateSettings)?void 0:o[u])??{},n=this.toNumberOrRange(e.startVelocity,[0,0]),i=this.toNumberOrRange(e.endVelocity,[0,0]);t.push(new b3({startVelocity:n,endVelocity:i,ease:e.ease??"sine.inOut",setStartVelocity:e.setStartVelocity}))}break;case"Position Over Lifetime":{const e=(null==(l=null==d?void 0:d.particleUpdateSettings)?void 0:l[u])??{},n=this.toNumberOrRange(e.startPosition,[0,0]),i=this.toNumberOrRange(e.endPosition,[0,0]);t.push(new _3({startPosition:n,endPosition:i,ease:e.ease??"sine.inOut",setStartPosition:e.setStartPosition}))}break;case"Rotation Over Lifetime":{const e=(null==(h=null==d?void 0:d.particleUpdateSettings)?void 0:h[u])??{};t.push(new S3({startRotation:e.startRotation,endRotation:e.endRotation,ease:e.ease??"sine.inOut",setStartRotation:e.setStartRotation}))}break;case"Conform to Position":{const e=(null==(c=null==d?void 0:d.particleUpdateSettings)?void 0:c[u])??{};t.push(new w3({position:e.position,strength:e.strength}))}}}),this.shuraContainer.setParticleUpdateStack([...t,...this.customParticleUpdateList])}updateParticleSpawnList(){const t=[];this.particleSpawnList.forEach(e=>{var n,i,r,s,a,o,l;const h=this.safeKey(e),c=this.currentComponent;switch(e){case"Set Color":{const e=(null==(n=null==c?void 0:c.particleSpawnSettings)?void 0:n[h])??{},i=this.toPrimitiveArray(e.colorStops,["#ffffff"]),r=i.map((t,e)=>({pos:1===i.length?0:e/(i.length-1),color:t})),s=new h3(r);t.push(new A3({color:s,alpha:e.alpha??1}))}break;case"Spawn Lifetime":{const e=(null==(i=null==c?void 0:c.particleSpawnSettings)?void 0:i[h])??{},n=this.toNumberOrRange(e.lifetime,[.2,2]);t.push(new I3({lifetime:n}))}break;case"Set Velocity":{const e=(null==(r=null==c?void 0:c.particleSpawnSettings)?void 0:r[h])??{};t.push(new R3({velocityX:this.toNumberOrRange(e.velocityX,[-20,20]),velocityY:this.toNumberOrRange(e.velocityY,[-80,-20]),radial:!!e.radial}))}break;case"Set Position":{const e=(null==(s=null==c?void 0:c.particleSpawnSettings)?void 0:s[h])??{};t.push(new E3({x:this.toNumberOrRange(e.x,[0,0]),y:this.toNumberOrRange(e.y,[0,0])}))}break;case"Set Texture":{const e=(null==(a=null==c?void 0:c.particleSpawnSettings)?void 0:a[h])??{};let n=ox.WHITE;e.texture&&(n=u0.getTexture(e.texture)),t.push(new P3({texture:n}))}break;case"Set Rotation":{const e=(null==(o=null==c?void 0:c.particleSpawnSettings)?void 0:o[h])??{};t.push(new C3({x:this.toNumberOrRange(e.x,[0,0])}))}break;case"Set Blend Mode":{const e=(null==(l=null==c?void 0:c.particleSpawnSettings)?void 0:l[h])??{};t.push(new M3({blendMode:e.blendMode}))}}}),this.shuraContainer.setParticleSpawnStack([...t,...this.customParticleSpawnList])}updateEmitterUpdateList(){const t=[];this.emitterUpdateList.forEach(e=>{var n,i;const r=this.safeKey(e),s=this.currentComponent;switch(e){case"Spawn Rate":{const e=(null==(n=null==s?void 0:s.emitterUpdateSettings)?void 0:n[r])??{};t.push(new B3({spawnRate:e.spawnRate??10}))}break;case"Spawn Burst":{const e=(null==(i=null==s?void 0:s.emitterUpdateSettings)?void 0:i[r])??{};t.push(new D3({period:e.period??1,amount:e.amount??50}))}}}),this.shuraContainer.setEmitterUpdateStack([...t,...this.customEmitterUpdateList])}updateComponents(t){const e=t.shuraParticle;e&&this.updateShuraComponent(e),super.updateComponents(t)}customUpdate(t){this.updateEmitter&&this.shuraContainer.updateEmitter(t,this.emitParticles)}setEmitPosition(t,e){this.shuraContainer.emitPos.x=t-50,this.shuraContainer.emitPos.y=e-50}}class L3{static add(t){const{type:e,components:n}=t;if("layer"===t.type){const t=new i3;return t.updateComponents(n),t}let i;return i="sprite"===e?this.addSprite(n):"container"===e?new f0:"animatedSprite"===e?this.addAnimatedSprite(n):"spine"===e?this.addSpine(n):"text"===e?this.addText(n):"htmlText"===e?this.addHtmlText(n):"graphics"===e?this.addGraphics(n):"tilingSprite"===e?this.addTilingSprite(n):"viewport"===e?this.addViewport(n):"layout2D"===e?this.addLayout2D(n):"cell2D"===e?this.addCell2D(n):"nineSliceSprite"===e?this.addNineSliceSprite(n):"tutorial"===e?this.addTutorial(n):"camera"===e?this.addCamera(t.name):"feedback"===e?this.addFeedback(n):"cta"===e?new e3:"particleEmitter"===e?this.addParticleEmitter(n):"video"===e?this.addVideo():e===aN.SHURA_PARTICLE?this.addShuraSystem(n):this.addSprite(n),n.responsive2D&&i.components.add("responsive2D"),n.transitionFX&&i.components.add("transitionFX"),n.filters2D&&i.components.add("filters2D"),(null==n?void 0:n.physics)&&(i.components.physics=new _0(i)),i.componentsData=n,i.nodeData=t,i.isStudioObject=!0,i}static addSprite(t){var e,n,i,r,s;const a=(null==(e=null==t?void 0:t.sprite)?void 0:e.texture)||g0;return new p0({x:(null==(i=null==(n=null==t?void 0:t.node2D)?void 0:n.position)?void 0:i.x)||0,y:(null==(s=null==(r=null==t?void 0:t.node2D)?void 0:r.position)?void 0:s.y)||0,texture:(null==a?void 0:a.path)||g0.path})}static addShuraSystem(t){var e,n,i,r;return new F3({x:(null==(n=null==(e=null==t?void 0:t.node2D)?void 0:e.position)?void 0:n.x)||0,y:(null==(r=null==(i=null==t?void 0:t.node2D)?void 0:i.position)?void 0:r.y)||0})}static addAnimatedSprite(t){var e;return new m0((null==(e=null==t?void 0:t.animatedSprite)?void 0:e.animationTexture)||"")}static addSpine(t){var e,n,i,r,s;const a=(null==(e=null==t?void 0:t.spine)?void 0:e.spineTexture)||"";return new v0((null==(i=null==(n=null==t?void 0:t.node2D)?void 0:n.position)?void 0:i.x)||0,(null==(s=null==(r=null==t?void 0:t.node2D)?void 0:r.position)?void 0:s.y)||0,a)}static addText(t){var e,n,i,r,s;const a=new y0((null==(n=null==(e=null==t?void 0:t.node2D)?void 0:e.position)?void 0:n.x)||0,(null==(r=null==(i=null==t?void 0:t.node2D)?void 0:i.position)?void 0:r.y)||0,(null==(s=null==t?void 0:t.text)?void 0:s.text)||"");return t.text&&a.updateTextComponent(t.text),a}static addHtmlText(t){var e,n,i,r,s;const a=new t3((null==(n=null==(e=null==t?void 0:t.node2D)?void 0:e.position)?void 0:n.x)||0,(null==(r=null==(i=null==t?void 0:t.node2D)?void 0:i.position)?void 0:r.y)||0,(null==(s=null==t?void 0:t.text)?void 0:s.text)||"");return t.text&&a.updateTextComponent(t.text),a}static addGraphics(t){const e=new a2;return t.graphics&&e.updateGraphicsComponent(t.graphics),e}static addTilingSprite(t){var e,n,i,r,s;const a=(null==(e=null==t?void 0:t.sprite)?void 0:e.texture)||g0;return new o2({x:(null==(i=null==(n=null==t?void 0:t.node2D)?void 0:n.position)?void 0:i.x)||0,y:(null==(s=null==(r=null==t?void 0:t.node2D)?void 0:r.position)?void 0:s.y)||0,texture:(null==a?void 0:a.path)||g0.path})}static addViewport(t){return new j2(t)}static addLayout2D(t){var e,n,i,r;return new Y2({x:(null==(n=null==(e=null==t?void 0:t.node2D)?void 0:e.position)?void 0:n.x)||0,y:(null==(r=null==(i=null==t?void 0:t.node2D)?void 0:i.position)?void 0:r.y)||0,...t})}static addCell2D(t){return new q2}static addNineSliceSprite(t){var e;const n=null==(e=null==t?void 0:t.sprite)?void 0:e.texture;return new K2({texture:null==n?void 0:n.path})}static addTutorial(t){var e,n,i,r;return new J2({x:(null==(n=null==(e=null==t?void 0:t.node2D)?void 0:e.position)?void 0:n.x)||0,y:(null==(r=null==(i=null==t?void 0:t.node2D)?void 0:i.position)?void 0:r.y)||0})}static addCamera(t){return new Q2(t)}static addFeedback(t){return new $2}static addParticleEmitter(t){var e,n,i,r;return new n3((null==(n=null==(e=null==t?void 0:t.node2D)?void 0:e.position)?void 0:n.x)||0,(null==(r=null==(i=null==t?void 0:t.node2D)?void 0:i.position)?void 0:r.y)||0,t.particleEmitter)}static addVideo(){return new r3}}class U3 extends Db{constructor(){super(),n(this,"name","Scene2d"),n(this,"isScene",!0),n(this,"physics2d")}get gameObjects(){return d0.getSceneObjects(this)}onSceneInited(){}setupScene(){}update(t){this.physics2d&&this.physics2d.update(),this.gameObjects.forEach(e=>{e.components.update(t)})}render(){}resize(t,e){this.baseWidth=t,this.baseHeight=e,this.gameObjects.forEach(n=>{n.components.resize(t,e)})}destroy(t){this.gameObjects.forEach(t=>{d0.removeObject(t)}),super.destroy(t)}}for(var k3,N3=[],z3=0;z3<256;++z3)N3.push((z3+256).toString(16).slice(1));var G3=new Uint8Array(16);function H3(){if(!k3&&!(k3="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k3(G3)}const V3={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function X3(t,e,n){if(V3.randomUUID&&!e&&!t)return V3.randomUUID();var i=(t=t||{}).random||(t.rng||H3)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,function(t,e=0){return(N3[t[e+0]]+N3[t[e+1]]+N3[t[e+2]]+N3[t[e+3]]+"-"+N3[t[e+4]]+N3[t[e+5]]+"-"+N3[t[e+6]]+N3[t[e+7]]+"-"+N3[t[e+8]]+N3[t[e+9]]+"-"+N3[t[e+10]]+N3[t[e+11]]+N3[t[e+12]]+N3[t[e+13]]+N3[t[e+14]]+N3[t[e+15]]).toLowerCase()}(i)}function W3(t){var e,n;null==(n=null==(e=this.originalTextureDescriptor)?void 0:e.set)||n.call(this,t),this.baseWidth=this.texture.orig.width,this.baseHeight=this.texture.orig.height,this.components.responsive&&this.components.responsive.update()}function j3(t){const e=u0.getTexture(t,t=>{W3.call(this,t)});e&&W3.call(this,e)}function Y3(t,e){if(!t)return void W3.call(this,u0.getTexture("___missing_image"));let n=t;n=`${t}_${window.app.data[e]||0}`;const i=u0.getTextureFromStuffs(n,t=>{W3.call(this,t)});i&&W3.call(this,i)}function q3(t){if(this.userDefinedTexture)return;const e=gN(),n=(e.baseWidth>e.baseHeight&&t.landscape?t.landscapeTexture:t.texture)||t.texture;if(n){const{path:t,type:e,uploadId:i,stuffs:r}=n;if("texture"===e)j3.call(this,t);else if("uploadable"===e){const e=`___uploaded_${i}`,n=u0.getTexture(e);n&&"WHITE"!==n.label?W3.call(this,n):j3.call(this,t),this.datajsEventsInited||(this.datajsEventsInited=!0,window.addEventListener("pf_"+i,async t=>{await u0.load([{type:"image",key:e,src:t.detail.value}]);const n=u0.getTexture(e);n&&"WHITE"!==n.label&&(W3.call(this,n),this.eventEmitter.emit(i))}))}else"stuffs"===e&&Y3.call(this,r,n.stuffsDataId)}if(this.textureData={...t.texture},t.landscapeTexture&&(this.textureDataLandscape={...t.landscapeTexture}),this.lanscapeEnabled=t.landscape,t.tint){let e=t.tint;"0"!==e&&0!==e&&0!==e||(e="#000000"),e.length<7&&(e=function(t){t.startsWith("#")||(t=`#${t}`);let e=t.slice(1);if(3===e.length)e=e.split("").map(t=>t+t).join("");else{if(6===e.length)return`#${e}`;e=e.padStart(6,"0")}return`#${e}`}(e)),this.tint=new zx(e)}}function K3(t){const e=u0.getTexture(t);e&&(this.userDefinedTexture=!0,this.texture=e,this.baseWidth=this.texture.orig.width,this.baseHeight=this.texture.orig.height)}function J3(t){this.userDefinedTexture=!0,this._setTextureFrame(t)}Db.prototype.setScale=function(t,e){let n=e;void 0===e&&(n=t),this.scale.set(t,n)},Db.prototype.setOrigin=function(t,e){this.originX=t,this.originY=e},Object.defineProperty(Db.prototype,"originX",{get(){let t=null;return t=this.anchor?this.anchor.x:this.pivot.x/this.baseWidth,t},set(t){"cell2D"!==this.type&&"layout2D"!==this.type?this.anchor?this.anchor.x=t:(this.pivot.x=this.baseWidth*t,(this.spineObj||"graphics"===this.type)&&(this.pivot.x=0)):this.pivot.x=t*this.baseWidth}}),Object.defineProperty(Db.prototype,"originY",{get(){let t=null;return t=this.anchor?this.anchor.y:this.pivot.y/this.baseHeight,t},set(t){"cell2D"!==this.type&&"layout2D"!==this.type?this.anchor?this.anchor.y=t:(this.pivot.y=this.baseHeight*t,(this.spineObj||"graphics"===this.type)&&(this.pivot.y=0)):this.pivot.x=t*this.baseHeight}}),Db.prototype.setSkew=function(t,e){let n=e;void 0===e&&(n=t),this.skew.set(t,n)},Object.defineProperty(Db.prototype,"scaleX",{get(){return this.scale.x},set(t){this.scale.x=t}}),Object.defineProperty(Db.prototype,"scaleY",{get(){return this.scale.y},set(t){this.scale.y=t}}),Object.defineProperty(Db.prototype,"skewX",{get(){return this.skew.x},set(t){this.skew.x=t}}),Object.defineProperty(Db.prototype,"skewY",{get(){return this.skew.y},set(t){this.skew.y=t}}),Object.defineProperty(Db.prototype,"top",{get(){return this.y-this.height*this.originY},set(t){this.y=t+this.height*this.originY}}),Object.defineProperty(Db.prototype,"bottom",{get(){return this.y+this.height*(1-this.originY)},set(t){this.y=t-this.height*(1-this.originY)}}),Object.defineProperty(Db.prototype,"left",{get(){return this.x-this.width*this.originX},set(t){this.x=t+this.width*this.originX}}),Object.defineProperty(Db.prototype,"right",{get(){return this.x+this.width*(1-this.originX)},set(t){this.x=t-this.width*(1-this.originX)}});function Z3(t){const e=(t-90)*(Math.PI/180),n=Math.cos(e),i=Math.sin(e);return{start:{x:.5-n/2,y:.5-i/2},end:{x:.5+n/2,y:.5+i/2}}}function Q3(t,e,n){let i;if(Array.isArray(t)&&t.length>1){let e=new cT({type:"linear",start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"});n&&(e="radial-gradient"===n.gradientType?new cT({type:"radial",center:{x:.5,y:.5},innerRadius:0,outerCenter:{x:.5,y:.5},outerRadius:.5,textureSpace:"local"}):new cT({type:"linear",...Z3(n.degrees.split("deg")[0]),textureSpace:"local"}));const r=t.map(t=>zx.shared.setValue(t).toNumber());r.forEach((t,i)=>{let s=(i+1)/r.length;n&&(s=n.colors[i].left/100),e.addColorStop(s,t)}),i={fill:e}}else{i={color:(Array.isArray(t)?t[0]:t)||"#ffffff"}}return i}[Fb.prototype,OO.prototype,zU.prototype].forEach(t=>{t.updateTextureData=q3,t.setTexture=K3,t.setTextureFrame=J3,t._setTextureFrame=W3;const e=Object.getOwnPropertyDescriptor(t,"texture");t.originalTextureDescriptor=e,Object.defineProperty(t,"texture",{get:function(){return this._texture},set:function(t){var n;null==(n=null==e?void 0:e.set)||n.call(this,t)}})}),HO.prototype.convertToFillStyle=Q3,nD.prototype.convertToFillStyle=Q3,MO.prototype.convertToFillStyle=Q3,Db.prototype.baseWidth=100,Db.prototype.baseHeight=100,Db.prototype.needsTextureUpdate=!0,Db.prototype.isHorizontalTexture=void 0,Db.prototype.eventEmitter=new Gk;const $3=Db.prototype.destroy;Db.prototype.destroy=function(){d0.removeObject(this),$3.call(this)},Db.prototype.forceResize=function(){var t,e,n;const i=(null==(t=this.parent)?void 0:t.baseWidth)||app.globals.pixiWidth,r=(null==(e=this.parent)?void 0:e.baseHeight)||app.globals.pixiHeight;null==(n=this.components)||n.resize(i,r)},Db.prototype.initComponentSystem=function(){this.components=new s2(this)},Db.prototype._changeMask=function(t,e=!1){const n=this.mask;if(this.mask=null,n&&0===d0.maskOfXObject(n)&&(n.renderable=!0),t){0===d0.maskOfXObject(t)&&(t.renderable=!0);try{this.effects=this.effects||[],this.setMask({inverse:e,mask:t})}catch(S6){}d0.setMaskObjects([t])}},Db.prototype.updateComponents=function(t){this.components.updateComponents(t);const e=t.node2D;if(e){if(e.mask){const t=d0.getNodeById(e.mask);t&&this._changeMask(t,e.invertAlpha)}else this._changeMask(null);if(e.layer){const t=d0.getNodeById(e.layer);t&&t.attach(this)}else this.parentRenderLayer&&this.parentRenderLayer.detach(this)}},Db.prototype.traverse=function(t){this.children.forEach(e=>{e instanceof Db&&(t(e),e.traverse(t))})},Db.prototype.getComponent=function(t){return this.components.get(t)},Db.prototype.isClicked=!1,Db.prototype.onResizeCallback=function(t,e){},Db.prototype.onResize=function(t,e){this.onResizeCallback(t,e)},Db.prototype.preResize=function(){},Db.prototype.data={},Db.prototype.isStudioObject=!1,Db.prototype.clone=function(){const t=this.parentScene,e=(n,i)=>{if(n.isStudioObject){const r=n,s=Y8.addGameObject({components:r.componentsData,children:[],type:r.type,id:X3()},i||this.parentScene,t);return r.children&&r.children.forEach(t=>{e(t,s)}),s}let r=new Db;if(n instanceof Fb){r=new Fb(n.texture)}else if(n instanceof PO){r=new PO(n.textures)}else if(n instanceof OO){const t=n;r=new OO({texture:t.texture,width:t.width,height:t.height})}else if(n instanceof zU){const t=n;r=new zU({texture:t.texture,leftWidth:t.leftWidth,rightWidth:t.rightWidth,topHeight:t.topHeight,bottomHeight:t.bottomHeight})}else if(n instanceof MO)r=new MO;else if(n instanceof HO){const t=n;r=new HO({text:t.text,style:t.style})}else n instanceof Db&&(r=new Db);return r?(r.setOrigin(n.originX,n.originY),r.position.set(n.position.x,n.position.y),r.scale.set(n.scale.x,n.scale.y),r.rotation=n.rotation,r.skew.set(n.skew.x,n.skew.y),r.tint=n.tint,null==i||i.addChild(r),r):new f0};return e(this,this.parent)},Db.prototype.bringToTop=function(t){const e=this.children;var n=e.indexOf(t);return-1!==n&&n<e.length&&(e.splice(n,1),e.push(t)),t},Db.prototype.sendToBack=function(t){const e=this.children;var n=e.indexOf(t);return-1!==n&&n>0&&(e.splice(n,1),e.unshift(t)),t},Db.prototype.getChildByLabelRecursive=function(t){if(this.label===t)return this;const e=this.getChildByLabel(t);if(e)return e;for(const n of this.children)if(n instanceof Db){const e=n.getChildByLabelRecursive(t);if(e)return e}return null},Db.prototype.playTransitionFX=function(t){var e;(null==(e=this.components)?void 0:e.transitionFX)&&this.components.transitionFX.play(t)},Db.prototype.updateResponsive2D=function(t=0,e="portrait",n={},i=!1){var r;(null==(r=this.components)?void 0:r.responsive)&&this.components.responsive.setResizePropertiesByIndex(t,e,n,i)},Db.prototype.getObjectByName=Db.prototype.getChildByLabelRecursive,window.PIXI=Nk;{const t=ox.from;ox.from=function(e,n){return u0.hasTexture(e)?u0.getTexture(e):t.call(ox,e,n)},Fb.from=function(t,e){return u0.hasTexture(t)?new Fb(u0.getTexture(t)):new Fb(ox.from(t,e))}}
/*!
 * PixiPlugin 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var t4,e4,n4,i4,r4,s4,a4,o4,l4,h4=function(){return"undefined"!=typeof window},c4=function(){return t4||h4()&&(t4=window.gsap)&&t4.registerPlugin&&t4},u4=function(t){return"function"==typeof t},d4=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],p4=.212671,f4=.71516,m4=.072169,g4=function(t){return u4(i4[t])?i4[t]:i4.filters[t]},v4=function(t,e){var n,i,r=[],s=0,a=0;for(n=0;n<4;n++){for(i=0;i<5;i++)a=4===i?t[s+4]:0,r[s+i]=t[s]*e[i]+t[s+1]*e[i+5]+t[s+2]*e[i+10]+t[s+3]*e[i+15]+a;s+=5}return r},y4=function(t,e){var n=1-e,i=n*p4,r=n*f4,s=n*m4;return v4([i+e,r,s,0,0,i,r+e,s,0,0,i,r,s+e,0,0,0,0,0,1,0],t)},x4=function(t,e,n){var i=e4(e),r=i[0]/255,s=i[1]/255,a=i[2]/255,o=1-n;return v4([o+n*r*p4,n*r*f4,n*r*m4,0,0,n*s*p4,o+n*s*f4,n*s*m4,0,0,n*a*p4,n*a*f4,o+n*a*m4,0,0,0,0,0,1,0],t)},b4=function(t,e){e*=Math.PI/180;var n=Math.cos(e),i=Math.sin(e);return v4([p4+n*(1-p4)+i*-p4,f4+n*-f4+i*-f4,m4+n*-m4+i*(1-m4),0,0,p4+n*-p4+.143*i,f4+.28484*n+.14*i,m4+n*-m4+-.283*i,0,0,p4+n*-p4+-.787329*i,f4+n*-f4+i*f4,m4+n*(1-m4)+i*m4,0,0,0,0,0,1,0,0,0,0,0,1],t)},_4=function(t,e){return v4([e,0,0,0,.5*(1-e),0,e,0,0,.5*(1-e),0,0,e,0,.5*(1-e),0,0,0,1,0],t)},S4=function(t,e){for(var n,i=g4(e),r=t.filters||[],s=r.length;--s>-1;)if(r[s]instanceof i)return r[s];return n=new i,"BlurFilter"===e&&(n.blur=0),r.push(n),t.filters=r,n},w4=function(t,e,n,i){e.add(n,t,n[t],i[t]),e._props.push(t)},T4=function(t,e){var n=new(g4("ColorMatrixFilter"));return n.matrix=e,n.brightness(t,!0),n.matrix},M4={contrast:1,saturation:1,colorizeAmount:0,colorize:"rgb(255,255,255)",hue:0,brightness:1},A4=function(t,e,n){var i,r,s,a=S4(t,"ColorMatrixFilter"),o=t._gsColorMatrixFilter=t._gsColorMatrixFilter||function(t){var e,n={};for(e in t)n[e]=t[e];return n}(M4),l=e.combineCMF&&!("colorMatrixFilter"in e&&!e.colorMatrixFilter);s=a.matrix,e.resolution&&(a.resolution=e.resolution),e.matrix&&e.matrix.length===s.length?(r=e.matrix,1!==o.contrast&&w4("contrast",n,o,M4),o.hue&&w4("hue",n,o,M4),1!==o.brightness&&w4("brightness",n,o,M4),o.colorizeAmount&&(w4("colorize",n,o,M4),w4("colorizeAmount",n,o,M4)),1!==o.saturation&&w4("saturation",n,o,M4)):(r=d4.slice(),null!=e.contrast?(r=_4(r,+e.contrast),w4("contrast",n,o,e)):1!==o.contrast&&(l?r=_4(r,o.contrast):w4("contrast",n,o,M4)),null!=e.hue?(r=b4(r,+e.hue),w4("hue",n,o,e)):o.hue&&(l?r=b4(r,o.hue):w4("hue",n,o,M4)),null!=e.brightness?(r=T4(+e.brightness,r),w4("brightness",n,o,e)):1!==o.brightness&&(l?r=T4(o.brightness,r):w4("brightness",n,o,M4)),null!=e.colorize?(e.colorizeAmount="colorizeAmount"in e?+e.colorizeAmount:1,r=x4(r,e.colorize,e.colorizeAmount),w4("colorize",n,o,e),w4("colorizeAmount",n,o,e)):o.colorizeAmount&&(l?r=x4(r,o.colorize,o.colorizeAmount):(w4("colorize",n,o,M4),w4("colorizeAmount",n,o,M4))),null!=e.saturation?(r=y4(r,+e.saturation),w4("saturation",n,o,e)):1!==o.saturation&&(l?r=y4(r,o.saturation):w4("saturation",n,o,M4))),i=r.length;for(;--i>-1;)r[i]!==s[i]&&n.add(s,i,s[i],r[i],"colorMatrixFilter");n._props.push("colorMatrixFilter")},E4=function(t,e){var n=e.t,i=e.p,r=e.color;(0,e.set)(n,i,r[0]<<16|r[1]<<8|r[2])},C4=function(t,e){var n=e.g;n&&(n.dirty++,n.clearDirty++)},P4=function(t,e){e.t.visible=!!e.t.alpha},R4=function(t,e,n,i){var r=t[e],s=e4(u4(r)?t[e.indexOf("set")||!u4(t["get"+e.substr(3)])?e:"get"+e.substr(3)]():r),a=e4(n);i._pt=new r4(i._pt,t,e,0,0,E4,{t:t,p:e,color:s,set:s4(t,e)}),i.add(s,0,s[0],a[0]),i.add(s,1,s[1],a[1]),i.add(s,2,s[2],a[2])},I4={tint:1,lineColor:1,fillColor:1},O4="position,scale,skew,pivot,anchor,tilePosition,tileScale".split(","),D4={x:"position",y:"position",tileX:"tilePosition",tileY:"tilePosition"},B4={colorMatrixFilter:1,saturation:1,contrast:1,hue:1,colorize:1,colorizeAmount:1,brightness:1,combineCMF:1},F4=Math.PI/180,L4=function(t){return"string"==typeof t},U4=function(t){return L4(t)&&"="===t.charAt(1)?t.substr(0,2)+parseFloat(t.substr(2))*F4:t*F4},k4=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e5*(e.s+e.c*t))/1e5,e)},N4=function(t,e,n,i,r,s){var a,o,l=360*(s?F4:1),h=L4(r),c=h&&"="===r.charAt(1)?+(r.charAt(0)+"1"):0,u=parseFloat(c?r.substr(2):r)*(s?F4:1),d=c?u*c:u-i,p=i+d;return h&&("short"===(a=r.split("_")[1])&&(d%=l)!==d%(l/2)&&(d+=d<0?l:-l),"cw"===a&&d<0?d=(d+1e10*l)%l-~~(d/l)*l:"ccw"===a&&d>0&&(d=(d-1e10*l)%l-~~(d/l)*l)),t._pt=o=new r4(t._pt,e,n,i,d,k4),o.e=p,o},z4=function(){n4||(t4=c4(),i4=n4=i4||h4()&&window.PIXI,a4=i4&&i4.VERSION&&"4"===i4.VERSION.charAt(0),e4=function(t){return t4.utils.splitColor("0x"===(t+"").substr(0,2)?"#"+t.substr(2):t)})};for(o4=0;o4<O4.length;o4++)l4=O4[o4],D4[l4+"X"]=l4,D4[l4+"Y"]=l4;var G4={version:"3.12.5",name:"pixi",register:function(t,e,n){t4=t,r4=n,s4=e.getSetter,z4()},headless:!0,registerPIXI:function(t){i4=t},init:function(t,e,n,i,r){if(i4||z4(),!i4)return!1;var s,a,o,l,h,c,u,d,p;for(c in e){if(s=D4[c],o=e[c],s)a=~c.charAt(c.length-1).toLowerCase().indexOf("x")?"x":"y",this.add(t[s],a,t[s][a],"skew"===s?U4(o):o,0,0,0,0,0,1);else if("scale"===c||"anchor"===c||"pivot"===c||"tileScale"===c)this.add(t[c],"x",t[c].x,o),this.add(t[c],"y",t[c].y,o);else if("rotation"===c||"angle"===c)N4(this,t,c,t[c],o,"rotation"===c);else if(B4[c])l||(A4(t,e.colorMatrixFilter||e,this),l=!0);else if("blur"===c||"blurX"===c||"blurY"===c||"blurPadding"===c){if(h=S4(t,"BlurFilter"),this.add(h,c,h[c],o),0!==e.blurPadding)for(u=e.blurPadding||2*Math.max(h[c],o),d=t.filters.length;--d>-1;)t.filters[d].padding=Math.max(t.filters[d].padding,u)}else if(I4[c])if(("lineColor"===c||"fillColor"===c)&&t instanceof i4.Graphics)for(p=(t.geometry||t).graphicsData,this._pt=new r4(this._pt,t,c,0,0,C4,{g:t.geometry||t}),d=p.length;--d>-1;)R4(a4?p[d]:p[d][c.substr(0,4)+"Style"],a4?c:"color",o,this);else R4(t,c,o,this);else"autoAlpha"===c?(this._pt=new r4(this._pt,t,"visible",0,0,P4),this.add(t,"alpha",t.alpha,o),this._props.push("alpha","visible")):"resolution"!==c&&this.add(t,c,"get",o);this._props.push(c)}}};c4()&&t4.registerPlugin(G4);
/*!
 * paths 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
var H4=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,V4=/(?:(-)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,X4=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/gi,W4=/(^[#\.][a-z]|[a-y][a-z])/i,j4=Math.PI/180,Y4=180/Math.PI,q4=Math.sin,K4=Math.cos,J4=Math.abs,Z4=Math.sqrt,Q4=Math.atan2,$4=1e8,t5=function(t){return"string"==typeof t},e5=function(t){return"number"==typeof t},n5={},i5={},r5=1e5,s5=function(t){return Math.round((t+$4)%1*r5)/r5||(t<0?0:1)},a5=function(t){return Math.round(t*r5)/r5||0},o5=function(t){return Math.round(1e10*t)/1e10||0},l5=function(t,e,n,i){var r=t[e],s=1===i?6:b5(r,n,i);if((s||!i)&&s+n+2<r.length)return t.splice(e,0,r.slice(0,n+s+2)),r.splice(0,n+s),1},h5=function(t,e,n){var i=t.length,r=~~(n*i);if(t[r]>e){for(;--r&&t[r]>e;);r<0&&(r=0)}else for(;t[++r]<e&&r<i;);return r<i?r:i-1},c5=function(t,e){return e.totalLength=t.totalLength,t.samples?(e.samples=t.samples.slice(0),e.lookup=t.lookup.slice(0),e.minLength=t.minLength,e.resolution=t.resolution):t.totalPoints&&(e.totalPoints=t.totalPoints),e},u5=function(t,e){var n=t.length,i=t[n-1]||[],r=i.length;n&&e[0]===i[r-2]&&e[1]===i[r-1]&&(e=i.concat(e.slice(2)),n--),t[n]=e};function d5(t){var e,n=(t=t5(t)&&W4.test(t)&&document.querySelector(t)||t).getAttribute?t:0;return n&&(t=t.getAttribute("d"))?(n._gsPath||(n._gsPath={}),(e=n._gsPath[t])&&!e._dirty?e:n._gsPath[t]=M5(t)):t?t5(t)?M5(t):e5(t[0])?[t]:t:void 0}function p5(t){var e,n=0;for(t.reverse();n<t.length;n+=2)e=t[n],t[n]=t[n+1],t[n+1]=e;t.reversed=!t.reversed}var f5={rect:"rx,ry,x,y,width,height",circle:"r,cx,cy",ellipse:"rx,ry,cx,cy",line:"x1,x2,y1,y2"};function m5(t,e){var n,i,r,s,a,o,l,h,c,u,d,p,f,m,g,v,y,x,b,_,S,w,T=t.tagName.toLowerCase(),M=.552284749831;return"path"!==T&&t.getBBox?(o=function(t,e){var n,i=document.createElementNS("http://www.w3.org/2000/svg","path"),r=[].slice.call(t.attributes),s=r.length;for(e=","+e+",";--s>-1;)n=r[s].nodeName.toLowerCase(),e.indexOf(","+n+",")<0&&i.setAttributeNS(null,n,r[s].nodeValue);return i}(t,"x,y,width,height,cx,cy,rx,ry,r,x1,x2,y1,y2,points"),w=function(t,e){for(var n=e?e.split(","):[],i={},r=n.length;--r>-1;)i[n[r]]=+t.getAttribute(n[r])||0;return i}(t,f5[T]),"rect"===T?(s=w.rx,a=w.ry||s,i=w.x,r=w.y,u=w.width-2*s,d=w.height-2*a,n=s||a?"M"+(v=(m=(f=i+s)+u)+s)+","+(x=r+a)+" V"+(b=x+d)+" C"+[v,_=b+a*M,g=m+s*M,S=b+a,m,S,m-(m-f)/3,S,f+(m-f)/3,S,f,S,p=i+s*(1-M),S,i,_,i,b,i,b-(b-x)/3,i,x+(b-x)/3,i,x,i,y=r+a*(1-M),p,r,f,r,f+(m-f)/3,r,m-(m-f)/3,r,m,r,g,r,v,y,v,x].join(",")+"z":"M"+(i+u)+","+r+" v"+d+" h"+-u+" v"+-d+" h"+u+"z"):"circle"===T||"ellipse"===T?("circle"===T?h=(s=a=w.r)*M:(s=w.rx,h=(a=w.ry)*M),n="M"+((i=w.cx)+s)+","+(r=w.cy)+" C"+[i+s,r+h,i+(l=s*M),r+a,i,r+a,i-l,r+a,i-s,r+h,i-s,r,i-s,r-h,i-l,r-a,i,r-a,i+l,r-a,i+s,r-h,i+s,r].join(",")+"z"):"line"===T?n="M"+w.x1+","+w.y1+" L"+w.x2+","+w.y2:"polyline"!==T&&"polygon"!==T||(n="M"+(i=(c=(t.getAttribute("points")+"").match(V4)||[]).shift())+","+(r=c.shift())+" L"+c.join(","),"polygon"===T&&(n+=","+i+","+r+"z")),o.setAttribute("d",C5(o._gsRawPath=M5(n))),e&&t.parentNode&&(t.parentNode.insertBefore(o,t),t.parentNode.removeChild(t)),o):t}function g5(t,e,n){var i,r=t[e],s=t[e+2],a=t[e+4];return r+=(s-r)*n,r+=((s+=(a-s)*n)-r)*n,i=s+(a+(t[e+6]-a)*n-s)*n-r,r=t[e+1],r+=((s=t[e+3])-r)*n,r+=((s+=((a=t[e+5])-s)*n)-r)*n,a5(Q4(s+(a+(t[e+7]-a)*n-s)*n-r,i)*Y4)}function v5(t,e,n){n=function(t){return void 0===t}(n)?1:o5(n)||0,e=o5(e)||0;var i=Math.max(0,~~(J4(n-e)-1e-8)),r=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=c5(t[n],t[n].slice(0));return c5(t,e)}(t);if(e>n&&(e=1-e,n=1-n,function(t){var e=t.length;for(t.reverse();e--;)t[e].reversed||p5(t[e])}(r),r.totalLength=0),e<0||n<0){var s=Math.abs(~~Math.min(e,n))+1;e+=s,n+=s}r.totalLength||x5(r);var a,o,l,h,c,u,d,p,f=n>1,m=_5(r,e,n5,!0),g=_5(r,n,i5),v=g.segment,y=m.segment,x=g.segIndex,b=m.segIndex,_=g.i,S=m.i,w=b===x,T=_===S&&w;if(f||i){for(a=x<b||w&&_<S||T&&g.t<m.t,l5(r,b,S,m.t)&&(b++,a||(x++,T?(g.t=(g.t-m.t)/(1-m.t),_=0):w&&(_-=S))),Math.abs(1-(n-e))<1e-5?x=b-1:!g.t&&x?x--:l5(r,x,_,g.t)&&a&&b++,1===m.t&&(b=(b+1)%r.length),c=[],d=1+(u=r.length)*i,p=b,d+=(u-b+x)%u,h=0;h<d;h++)u5(c,r[p++%u]);r=c}else if(l=1===g.t?6:b5(v,_,g.t),e!==n)for(o=b5(y,S,T?m.t/g.t:m.t),w&&(l+=o),v.splice(_+l+2),(o||S)&&y.splice(0,S+o),h=r.length;h--;)(h<b||h>x)&&r.splice(h,1);else v.angle=g5(v,_+l,0),m=v[_+=l],g=v[_+1],v.length=v.totalLength=0,v.totalPoints=r.totalPoints=8,v.push(m,g,m,g,m,g,m,g);return r.totalLength=0,r}function y5(t,e,n){e=e||0,t.samples||(t.samples=[],t.lookup=[]);var i,r,s,a,o,l,h,c,u,d,p,f,m,g,v,y,x,b=~~t.resolution||12,_=1/b,S=t.length,w=t[e],T=t[e+1],M=e?e/6*b:0,A=t.samples,E=t.lookup,C=(e?t.minLength:$4)||$4,P=A[M+n*b-1],R=e?A[M-1]:0;for(A.length=E.length=0,r=e+2;r<S;r+=6){if(s=t[r+4]-w,a=t[r+2]-w,o=t[r]-w,c=t[r+5]-T,u=t[r+3]-T,d=t[r+1]-T,l=h=p=f=0,J4(s)<.01&&J4(c)<.01&&J4(o)+J4(d)<.01)t.length>8&&(t.splice(r,6),r-=6,S-=6);else for(i=1;i<=b;i++)l=h-(h=((g=_*i)*g*s+3*(m=1-g)*(g*a+m*o))*g),p=f-(f=(g*g*c+3*m*(g*u+m*d))*g),(y=Z4(p*p+l*l))<C&&(C=y),R+=y,A[M++]=R;w+=s,T+=c}if(P)for(P-=R;M<A.length;M++)A[M]+=P;if(A.length&&C){if(t.totalLength=x=A[A.length-1]||0,t.minLength=C,x/C<9999)for(y=v=0,i=0;i<x;i+=C)E[y++]=A[v]<i?++v:v}else t.totalLength=A[0]=0;return e?R-A[e/2-1]:R}function x5(t,e){var n,i,r;for(r=n=i=0;r<t.length;r++)t[r].resolution=~~e||12,i+=t[r].length,n+=y5(t[r]);return t.totalPoints=i,t.totalLength=n,t}function b5(t,e,n){if(n<=0||n>=1)return 0;var i=t[e],r=t[e+1],s=t[e+2],a=t[e+3],o=t[e+4],l=t[e+5],h=i+(s-i)*n,c=s+(o-s)*n,u=r+(a-r)*n,d=a+(l-a)*n,p=h+(c-h)*n,f=u+(d-u)*n,m=o+(t[e+6]-o)*n,g=l+(t[e+7]-l)*n;return c+=(m-c)*n,d+=(g-d)*n,t.splice(e+2,4,a5(h),a5(u),a5(p),a5(f),a5(p+(c-p)*n),a5(f+(d-f)*n),a5(c),a5(d),a5(m),a5(g)),t.samples&&t.samples.splice(e/6*t.resolution|0,0,0,0,0,0,0,0),6}function _5(t,e,n,i){n=n||{},t.totalLength||x5(t),(e<0||e>1)&&(e=s5(e));var r,s,a,o,l,h,c,u=0,d=t[0];if(e)if(1===e)c=1,h=(d=t[u=t.length-1]).length-8;else{if(t.length>1){for(a=t.totalLength*e,l=h=0;(l+=t[h++].totalLength)<a;)u=h;e=(a-(o=l-(d=t[u]).totalLength))/(l-o)||0}r=d.samples,s=d.resolution,a=d.totalLength*e,o=(h=d.lookup.length?d.lookup[~~(a/d.minLength)]||0:h5(r,a,e))?r[h-1]:0,(l=r[h])<a&&(o=l,l=r[++h]),c=1/s*((a-o)/(l-o)+h%s),h=6*~~(h/s),i&&1===c&&(h+6<d.length?(h+=6,c=0):u+1<t.length&&(h=c=0,d=t[++u]))}else c=h=u=0,d=t[0];return n.t=c,n.i=h,n.path=t,n.segment=d,n.segIndex=u,n}function S5(t,e,n,i){var r,s,a,o,l,h,c,u,d,p=t[0],f=i||{};if((e<0||e>1)&&(e=s5(e)),p.lookup||x5(t),t.length>1){for(a=t.totalLength*e,l=h=0;(l+=t[h++].totalLength)<a;)p=t[h];e=(a-(o=l-p.totalLength))/(l-o)||0}return r=p.samples,s=p.resolution,a=p.totalLength*e,o=(h=p.lookup.length?p.lookup[e<1?~~(a/p.minLength):p.lookup.length-1]||0:h5(r,a,e))?r[h-1]:0,(l=r[h])<a&&(o=l,l=r[++h]),d=1-(c=1/s*((a-o)/(l-o)+h%s)||0),u=p[h=6*~~(h/s)],f.x=a5((c*c*(p[h+6]-u)+3*d*(c*(p[h+4]-u)+d*(p[h+2]-u)))*c+u),f.y=a5((c*c*(p[h+7]-(u=p[h+1]))+3*d*(c*(p[h+5]-u)+d*(p[h+3]-u)))*c+u),n&&(f.angle=p.totalLength?g5(p,h,c>=1?1-1e-9:c||1e-9):p.angle||0),f}function w5(t,e,n,i,r,s,a){for(var o,l,h,c,u,d=t.length;--d>-1;)for(l=(o=t[d]).length,h=0;h<l;h+=2)c=o[h],u=o[h+1],o[h]=c*e+u*i+s,o[h+1]=c*n+u*r+a;return t._dirty=1,t}function T5(t,e,n,i,r,s,a,o,l){if(t!==o||e!==l){n=J4(n),i=J4(i);var h=r%360*j4,c=K4(h),u=q4(h),d=Math.PI,p=2*d,f=(t-o)/2,m=(e-l)/2,g=c*f+u*m,v=-u*f+c*m,y=g*g,x=v*v,b=y/(n*n)+x/(i*i);b>1&&(n=Z4(b)*n,i=Z4(b)*i);var _=n*n,S=i*i,w=(_*S-_*x-S*y)/(_*x+S*y);w<0&&(w=0);var T=(s===a?-1:1)*Z4(w),M=T*(n*v/i),A=T*(-i*g/n),E=(t+o)/2+(c*M-u*A),C=(e+l)/2+(u*M+c*A),P=(g-M)/n,R=(v-A)/i,I=(-g-M)/n,O=(-v-A)/i,D=P*P+R*R,B=(R<0?-1:1)*Math.acos(P/Z4(D)),F=(P*O-R*I<0?-1:1)*Math.acos((P*I+R*O)/Z4(D*(I*I+O*O)));isNaN(F)&&(F=d),!a&&F>0?F-=p:a&&F<0&&(F+=p),B%=p,F%=p;var L,U=Math.ceil(J4(F)/(p/4)),k=[],N=F/U,z=4/3*q4(N/2)/(1+K4(N/2)),G=c*n,H=u*n,V=u*-i,X=c*i;for(L=0;L<U;L++)g=K4(r=B+L*N),v=q4(r),P=K4(r+=N),R=q4(r),k.push(g-z*v,v+z*g,P+z*R,R-z*P,P,R);for(L=0;L<k.length;L+=2)g=k[L],v=k[L+1],k[L]=g*G+v*V+E,k[L+1]=g*H+v*X+C;return k[L-2]=o,k[L-1]=l,k}}function M5(t){var e,n,i,r,s,a,o,l,h,c,u,d,p,f,m,g=(t+"").replace(X4,function(t){var e=+t;return e<1e-4&&e>-1e-4?0:e}).match(H4)||[],v=[],y=0,x=0,b=2/3,_=g.length,S=0,w=function(t,e,n,i){c=(n-t)/3,u=(i-e)/3,o.push(t+c,e+u,n-c,i-u,n,i)};if(!t||!isNaN(g[0])||isNaN(g[1]))return v;for(e=0;e<_;e++)if(p=s,isNaN(g[e])?a=(s=g[e].toUpperCase())!==g[e]:e--,i=+g[e+1],r=+g[e+2],a&&(i+=y,r+=x),e||(l=i,h=r),"M"===s)o&&(o.length<8?v.length-=1:S+=o.length),y=l=i,x=h=r,o=[i,r],v.push(o),e+=2,s="L";else if("C"===s)o||(o=[0,0]),a||(y=x=0),o.push(i,r,y+1*g[e+3],x+1*g[e+4],y+=1*g[e+5],x+=1*g[e+6]),e+=6;else if("S"===s)c=y,u=x,"C"!==p&&"S"!==p||(c+=y-o[o.length-4],u+=x-o[o.length-3]),a||(y=x=0),o.push(c,u,i,r,y+=1*g[e+3],x+=1*g[e+4]),e+=4;else if("Q"===s)c=y+(i-y)*b,u=x+(r-x)*b,a||(y=x=0),y+=1*g[e+3],x+=1*g[e+4],o.push(c,u,y+(i-y)*b,x+(r-x)*b,y,x),e+=4;else if("T"===s)c=y-o[o.length-4],u=x-o[o.length-3],o.push(y+c,x+u,i+(y+1.5*c-i)*b,r+(x+1.5*u-r)*b,y=i,x=r),e+=2;else if("H"===s)w(y,x,y=i,x),e+=1;else if("V"===s)w(y,x,y,x=i+(a?x-y:0)),e+=1;else if("L"===s||"Z"===s)"Z"===s&&(i=l,r=h,o.closed=!0),("L"===s||J4(y-i)>.5||J4(x-r)>.5)&&(w(y,x,i,r),"L"===s&&(e+=2)),y=i,x=r;else if("A"===s){if(f=g[e+4],m=g[e+5],c=g[e+6],u=g[e+7],n=7,f.length>1&&(f.length<3?(u=c,c=m,n--):(u=m,c=f.substr(2),n-=2),m=f.charAt(1),f=f.charAt(0)),d=T5(y,x,+g[e+1],+g[e+2],+g[e+3],+f,+m,(a?y:0)+1*c,(a?x:0)+1*u),e+=n,d)for(n=0;n<d.length;n++)o.push(d[n]);y=o[o.length-2],x=o[o.length-1]}return(e=o.length)<6?(v.pop(),e=0):o[0]===o[e-2]&&o[1]===o[e-1]&&(o.closed=!0),v.totalPoints=S+e,v}function A5(t,e){void 0===e&&(e=1);for(var n=t[0],i=0,r=[n,i],s=2;s<t.length;s+=2)r.push(n,i,t[s],i=(t[s]-n)*e/2,n=t[s],-i);return r}function E5(t,e){J4(t[0]-t[2])<1e-4&&J4(t[1]-t[3])<1e-4&&(t=t.slice(2));var n,i,r,s,a,o,l,h,c,u,d,p,f,m,g=t.length-2,v=+t[0],y=+t[1],x=+t[2],b=+t[3],_=[v,y,v,y],S=x-v,w=b-y,T=Math.abs(t[g]-v)<.001&&Math.abs(t[g+1]-y)<.001;for(T&&(t.push(x,b),x=v,b=y,v=t[g-2],y=t[g-1],t.unshift(v,y),g+=4),e=e||0===e?+e:1,r=2;r<g;r+=2)n=v,i=y,v=x,y=b,x=+t[r+2],b=+t[r+3],v===x&&y===b||(s=S,a=w,S=x-v,w=b-y,h=((o=Z4(s*s+a*a))+(l=Z4(S*S+w*w)))*e*.25/Z4(Math.pow(S/l+s/o,2)+Math.pow(w/l+a/o,2)),d=v-((c=v-(v-n)*(o?h/o:0))+(((u=v+(x-v)*(l?h/l:0))-c)*(3*o/(o+l)+.5)/4||0)),m=y-((p=y-(y-i)*(o?h/o:0))+(((f=y+(b-y)*(l?h/l:0))-p)*(3*o/(o+l)+.5)/4||0)),v===n&&y===i||_.push(a5(c+d),a5(p+m),a5(v),a5(y),a5(u+d),a5(f+m)));return v!==x||y!==b||_.length<4?_.push(a5(x),a5(b),a5(x),a5(b)):_.length-=2,2===_.length?_.push(v,y,v,y,v,y):T&&(_.splice(0,6),_.length=_.length-6),_}function C5(t){e5(t[0])&&(t=[t]);var e,n,i,r,s="",a=t.length;for(n=0;n<a;n++){for(r=t[n],s+="M"+a5(r[0])+","+a5(r[1])+" C",e=r.length,i=2;i<e;i++)s+=a5(r[i++])+","+a5(r[i++])+" "+a5(r[i++])+","+a5(r[i++])+" "+a5(r[i++])+","+a5(r[i])+" ";r.closed&&(s+="z")}return s}
/*!
 * CustomEase 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var P5,R5,I5=function(){return P5||"undefined"!=typeof window&&(P5=window.gsap)&&P5.registerPlugin&&P5},O5=function(){(P5=I5())&&(P5.registerEase("_CE",U5.create),R5=1)},D5=function(t){return~~(1e3*t+(t<0?-.5:.5))/1e3},B5=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/gi,F5=/[cLlsSaAhHvVtTqQ]/g,L5=function t(e,n,i,r,s,a,o,l,h,c,u){var d,p=(e+i)/2,f=(n+r)/2,m=(i+s)/2,g=(r+a)/2,v=(s+o)/2,y=(a+l)/2,x=(p+m)/2,b=(f+g)/2,_=(m+v)/2,S=(g+y)/2,w=(x+_)/2,T=(b+S)/2,M=o-e,A=l-n,E=Math.abs((i-o)*A-(r-l)*M),C=Math.abs((s-o)*A-(a-l)*M);return c||(c=[{x:e,y:n},{x:o,y:l}],u=1),c.splice(u||c.length-1,0,{x:w,y:T}),(E+C)*(E+C)>h*(M*M+A*A)&&(d=c.length,t(e,n,p,f,x,b,w,T,h,c,u),t(w,T,_,S,v,y,o,l,h,c,u+1+(c.length-d))),c},U5=function(){function t(t,e,n){R5||O5(),this.id=t,this.setData(e,n)}var e=t.prototype;return e.setData=function(t,e){e=e||{};var n,i,r,s,a,o,l,h,c,u=(t=t||"0,0,1,1").match(B5),d=1,p=[],f=[],m=e.precision||1,g=m<=1;if(this.data=t,(F5.test(t)||~t.indexOf("M")&&t.indexOf("C")<0)&&(u=M5(t)[0]),4===(n=u.length))u.unshift(0,0),u.push(1,1),n=8;else if((n-2)%6)throw"Invalid CustomEase";for(0===+u[0]&&1===+u[n-2]||function(t,e,n){n||0===n||(n=Math.max(+t[t.length-1],+t[1]));var i,r=-1*+t[0],s=-n,a=t.length,o=1/(+t[a-2]+r),l=-e||(Math.abs(+t[a-1]-+t[1])<.01*(+t[a-2]-+t[0])?function(t){var e,n=t.length,i=1e20;for(e=1;e<n;e+=6)+t[e]<i&&(i=+t[e]);return i}(t)+s:+t[a-1]+s);for(l=l?1/l:-o,i=0;i<a;i+=2)t[i]=(+t[i]+r)*o,t[i+1]=(+t[i+1]+s)*l}(u,e.height,e.originY),this.segment=u,s=2;s<n;s+=6)i={x:+u[s-2],y:+u[s-1]},r={x:+u[s+4],y:+u[s+5]},p.push(i,r),L5(i.x,i.y,+u[s],+u[s+1],+u[s+2],+u[s+3],r.x,r.y,1/(2e5*m),p,p.length-1);for(n=p.length,s=0;s<n;s++)l=p[s],h=p[s-1]||l,(l.x>h.x||h.y!==l.y&&h.x===l.x||l===h)&&l.x<=1?(h.cx=l.x-h.x,h.cy=l.y-h.y,h.n=l,h.nx=l.x,g&&s>1&&Math.abs(h.cy/h.cx-p[s-2].cy/p[s-2].cx)>2&&(g=0),h.cx<d&&(h.cx?d=h.cx:(h.cx=.001,s===n-1&&(h.x-=.001,d=Math.min(d,.001),g=0)))):(p.splice(s--,1),n--);if(a=1/(n=1/d+1|0),o=0,l=p[0],g){for(s=0;s<n;s++)c=s*a,l.nx<c&&(l=p[++o]),i=l.y+(c-l.x)/l.cx*l.cy,f[s]={x:c,cx:a,y:i,cy:0,nx:9},s&&(f[s-1].cy=i-f[s-1].y);f[n-1].cy=p[p.length-1].y-i}else{for(s=0;s<n;s++)l.nx<s*a&&(l=p[++o]),f[s]=l;o<p.length-1&&(f[s-1]=p[p.length-2])}return this.ease=function(t){var e=f[t*n|0]||f[n-1];return e.nx<t&&(e=e.n),e.y+(t-e.x)/e.cx*e.cy},this.ease.custom=this,this.id&&P5&&P5.registerEase(this.id,this.ease),this},e.getSVGData=function(e){return t.getSVGData(this,e)},t.create=function(e,n,i){return new t(e,n,i).ease},t.register=function(t){P5=t,O5()},t.get=function(t){return P5.parseEase(t)},t.getSVGData=function(e,n){var i,r,s,a,o,l,h,c,u,d,p=(n=n||{}).width||100,f=n.height||100,m=n.x||0,g=(n.y||0)+f,v=P5.utils.toArray(n.path)[0];if(n.invert&&(f=-f,g=0),"string"==typeof e&&(e=P5.parseEase(e)),e.custom&&(e=e.custom),e instanceof t)i=C5(w5([e.segment],p,0,0,-f,m,g));else{for(i=[m,g],a=1/(h=Math.max(5,200*(n.precision||1))),c=5/(h+=2),u=D5(m+a*p),r=((d=D5(g+e(a)*-f))-g)/(u-m),s=2;s<h;s++)o=D5(m+s*a*p),l=D5(g+e(s*a)*-f),(Math.abs((l-d)/(o-u)-r)>c||s===h-1)&&(i.push(u,d),r=(l-d)/(o-u)),u=o,d=l;i="M"+i.join(",")}return v&&v.setAttribute("d",i),i},t}();I5()&&P5.registerPlugin(U5),U5.version="3.12.5";
/*!
 * matrix 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
var k5,N5,z5,G5,H5,V5,X5,W5,j5,Y5="transform",q5=Y5+"Origin",K5=function(t){var e=t.ownerDocument||t;!(Y5 in t.style)&&"msTransform"in t.style&&(q5=(Y5="msTransform")+"Origin");for(;e.parentNode&&(e=e.parentNode););if(N5=window,X5=new i8,e){k5=e,z5=e.documentElement,G5=e.body,(W5=k5.createElementNS("http://www.w3.org/2000/svg","g")).style.transform="none";var n=e.createElement("div"),i=e.createElement("div"),r=e&&(e.body||e.firstElementChild);r&&r.appendChild&&(r.appendChild(n),n.appendChild(i),n.setAttribute("style","position:static;transform:translate3d(0,0,1px)"),j5=i.offsetParent!==n,r.removeChild(n))}return e},J5=[],Z5=[],Q5=function(t){return t.ownerSVGElement||("svg"===(t.tagName+"").toLowerCase()?t:null)},$5=function t(e){return"fixed"===N5.getComputedStyle(e).position||((e=e.parentNode)&&1===e.nodeType?t(e):void 0)},t8=function t(e,n){if(e.parentNode&&(k5||K5(e))){var i=Q5(e),r=i?i.getAttribute("xmlns")||"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",s=i?n?"rect":"g":"div",a=2!==n?0:100,o=3===n?100:0,l="position:absolute;display:block;pointer-events:none;margin:0;padding:0;",h=k5.createElementNS?k5.createElementNS(r.replace(/^https/,"http"),s):k5.createElement(s);return n&&(i?(V5||(V5=t(e)),h.setAttribute("width",.01),h.setAttribute("height",.01),h.setAttribute("transform","translate("+a+","+o+")"),V5.appendChild(h)):(H5||((H5=t(e)).style.cssText=l),h.style.cssText=l+"width:0.1px;height:0.1px;top:"+o+"px;left:"+a+"px",H5.appendChild(h))),h}throw"Need document and parent."},e8=function(t,e){var n,i,r,s,a,o,l=Q5(t),h=t===l,c=l?J5:Z5,u=t.parentNode;if(t===N5)return t;if(c.length||c.push(t8(t,1),t8(t,2),t8(t,3)),n=l?V5:H5,l)h?(r=function(t){var e,n=t.getCTM();return n||(e=t.style[Y5],t.style[Y5]="none",t.appendChild(W5),n=W5.getCTM(),t.removeChild(W5),e?t.style[Y5]=e:t.style.removeProperty(Y5.replace(/([A-Z])/g,"-$1").toLowerCase())),n||X5.clone()}(t),s=-r.e/r.a,a=-r.f/r.d,i=X5):t.getBBox?(r=t.getBBox(),i=(i=t.transform?t.transform.baseVal:{}).numberOfItems?i.numberOfItems>1?function(t){for(var e=new i8,n=0;n<t.numberOfItems;n++)e.multiply(t.getItem(n).matrix);return e}(i):i.getItem(0).matrix:X5,s=i.a*r.x+i.c*r.y,a=i.b*r.x+i.d*r.y):(i=new i8,s=a=0),e&&"g"===t.tagName.toLowerCase()&&(s=a=0),(h?l:u).appendChild(n),n.setAttribute("transform","matrix("+i.a+","+i.b+","+i.c+","+i.d+","+(i.e+s)+","+(i.f+a)+")");else{if(s=a=0,j5)for(i=t.offsetParent,r=t;r&&(r=r.parentNode)&&r!==i&&r.parentNode;)(N5.getComputedStyle(r)[Y5]+"").length>4&&(s=r.offsetLeft,a=r.offsetTop,r=0);if("absolute"!==(o=N5.getComputedStyle(t)).position&&"fixed"!==o.position)for(i=t.offsetParent;u&&u!==i;)s+=u.scrollLeft||0,a+=u.scrollTop||0,u=u.parentNode;(r=n.style).top=t.offsetTop-a+"px",r.left=t.offsetLeft-s+"px",r[Y5]=o[Y5],r[q5]=o[q5],r.position="fixed"===o.position?"fixed":"absolute",t.parentNode.appendChild(n)}return n},n8=function(t,e,n,i,r,s,a){return t.a=e,t.b=n,t.c=i,t.d=r,t.e=s,t.f=a,t},i8=function(){function t(t,e,n,i,r,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===s&&(s=0),n8(this,t,e,n,i,r,s)}var e=t.prototype;return e.inverse=function(){var t=this.a,e=this.b,n=this.c,i=this.d,r=this.e,s=this.f,a=t*i-e*n||1e-10;return n8(this,i/a,-e/a,-n/a,t/a,(n*s-i*r)/a,-(t*s-e*r)/a)},e.multiply=function(t){var e=this.a,n=this.b,i=this.c,r=this.d,s=this.e,a=this.f,o=t.a,l=t.c,h=t.b,c=t.d,u=t.e,d=t.f;return n8(this,o*e+h*i,o*n+h*r,l*e+c*i,l*n+c*r,s+u*e+d*i,a+u*n+d*r)},e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.e,this.f)},e.equals=function(t){var e=this.a,n=this.b,i=this.c,r=this.d,s=this.e,a=this.f;return e===t.a&&n===t.b&&i===t.c&&r===t.d&&s===t.e&&a===t.f},e.apply=function(t,e){void 0===e&&(e={});var n=t.x,i=t.y,r=this.a,s=this.b,a=this.c,o=this.d,l=this.e,h=this.f;return e.x=n*r+i*a+l||0,e.y=n*s+i*o+h||0,e},t}();function r8(t,e,n,i){if(!t||!t.parentNode||(k5||K5(t)).documentElement===t)return new i8;var r=function(t){for(var e,n;t&&t!==G5;)(n=t._gsap)&&n.uncache&&n.get(t,"x"),n&&!n.scaleX&&!n.scaleY&&n.renderTransform&&(n.scaleX=n.scaleY=1e-4,n.renderTransform(1,n),e?e.push(n):e=[n]),t=t.parentNode;return e}(t),s=Q5(t)?J5:Z5,a=e8(t,n),o=s[0].getBoundingClientRect(),l=s[1].getBoundingClientRect(),h=s[2].getBoundingClientRect(),c=a.parentNode,u=!i&&$5(t),d=new i8((l.left-o.left)/100,(l.top-o.top)/100,(h.left-o.left)/100,(h.top-o.top)/100,o.left+(u?0:N5.pageXOffset||k5.scrollLeft||z5.scrollLeft||G5.scrollLeft||0),o.top+(u?0:N5.pageYOffset||k5.scrollTop||z5.scrollTop||G5.scrollTop||0));if(c.removeChild(a),r)for(o=r.length;o--;)(l=r[o]).scaleX=l.scaleY=0,l.renderTransform(1,l);return e?d.inverse():d}
/*!
 * MotionPathPlugin 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var s8,a8,o8,l8,h8,c8,u8="x,translateX,left,marginLeft,xPercent".split(","),d8="y,translateY,top,marginTop,yPercent".split(","),p8=Math.PI/180,f8=function(t,e,n,i){for(var r=e.length,s=2===i?0:i,a=0;a<r;a++)t[s]=parseFloat(e[a][n]),2===i&&(t[s+1]=0),s+=2;return t},m8=function(t,e,n){return parseFloat(t._gsap.get(t,e,n||"px"))||0},g8=function(t){var e,n=t[0],i=t[1];for(e=2;e<t.length;e+=2)n=t[e]+=n,i=t[e+1]+=i},v8=function(t,e,n,i,r,s,a,o,l){"cubic"===a.type?e=[e]:(!1!==a.fromCurrent&&e.unshift(m8(n,i,o),r?m8(n,r,l):0),a.relative&&g8(e),e=[(r?E5:A5)(e,a.curviness)]);return e=s(S8(e,n,a)),w8(t,n,i,e,"x",o),r&&w8(t,n,r,e,"y",l),x5(e,a.resolution||(0===a.curviness?20:12))},y8=function(t){return t},x8=/[-+\.]*\d+\.?(?:e-|e\+)?\d*/g,b8=function(t,e,n){var i,r=r8(t),s=0,a=0;return"svg"===(t.tagName+"").toLowerCase()?(i=t.viewBox.baseVal).width||(i={width:+t.getAttribute("width"),height:+t.getAttribute("height")}):i=e&&t.getBBox&&t.getBBox(),e&&"auto"!==e&&(s=e.push?e[0]*(i?i.width:t.offsetWidth||0):e.x,a=e.push?e[1]*(i?i.height:t.offsetHeight||0):e.y),n.apply(s||a?r.apply({x:s,y:a}):{x:r.e,y:r.f})},_8=function(t,e,n,i){var r,s=r8(t.parentNode,!0,!0),a=s.clone().multiply(r8(e)),o=b8(t,n,s),l=b8(e,i,s),h=l.x,c=l.y;return a.e=a.f=0,"auto"===i&&e.getTotalLength&&"path"===e.tagName.toLowerCase()&&(r=e.getAttribute("d").match(x8)||[],h+=(r=a.apply({x:+r[0],y:+r[1]})).x,c+=r.y),r&&(h-=(r=a.apply(e.getBBox())).x,c-=r.y),a.e=h-o.x,a.f=c-o.y,a},S8=function(t,e,n){var i,r,s,a=n.align,o=n.matrix,l=n.offsetX,h=n.offsetY,c=n.alignOrigin,u=t[0][0],d=t[0][1],p=m8(e,"x"),f=m8(e,"y");return t&&t.length?(a&&("self"===a||(i=l8(a)[0]||e)===e?w5(t,1,0,0,1,p-u,f-d):(c&&!1!==c[2]?s8.set(e,{transformOrigin:100*c[0]+"% "+100*c[1]+"%"}):c=[m8(e,"xPercent")/-100,m8(e,"yPercent")/-100],s=(r=_8(e,i,c,"auto")).apply({x:u,y:d}),w5(t,r.a,r.b,r.c,r.d,p+r.e-(s.x-r.e),f+r.f-(s.y-r.f)))),o?w5(t,o.a,o.b,o.c,o.d,o.e,o.f):(l||h)&&w5(t,1,0,0,1,l||0,h||0),t):d5("M0,0L0,0")},w8=function(t,e,n,i,r,s){var a=e._gsap,o=a.harness,l=o&&o.aliases&&o.aliases[n],h=l&&l.indexOf(",")<0?l:n,c=t._pt=new a8(t._pt,e,h,0,0,y8,0,a.set(e,h,t));c.u=o8(a.get(e,h,s))||0,c.path=i,c.pp=r,t._props.push(h)},T8={version:"3.12.5",name:"motionPath",register:function(t,e,n){o8=(s8=t).utils.getUnit,l8=s8.utils.toArray,h8=s8.core.getStyleSaver,c8=s8.core.reverting||function(){},a8=n},init:function(t,e,n){if(!s8)return!1;"object"==typeof e&&!e.style&&e.path||(e={path:e});var i,r,s,a,o=[],l=e,h=l.path,c=l.autoRotate,u=l.unitX,d=l.unitY,p=l.x,f=l.y,m=h[0],g=(s=e.start,a="end"in e?e.end:1,function(t){return s||1!==a?v5(t,s,a):t});if(this.rawPaths=o,this.target=t,this.tween=n,this.styles=h8&&h8(t,"transform"),(this.rotate=c||0===c)&&(this.rOffset=parseFloat(c)||0,this.radians=!!e.useRadians,this.rProp=e.rotation||"rotation",this.rSet=t._gsap.set(t,this.rProp,this),this.ru=o8(t._gsap.get(t,this.rProp))||0),Array.isArray(h)&&!("closed"in h)&&"number"!=typeof m){for(r in m)!p&&~u8.indexOf(r)?p=r:!f&&~d8.indexOf(r)&&(f=r);for(r in p&&f?o.push(v8(this,f8(f8([],h,p,0),h,f,1),t,p,f,g,e,u||o8(h[0][p]),d||o8(h[0][f]))):p=f=0,m)r!==p&&r!==f&&o.push(v8(this,f8([],h,r,2),t,r,0,g,e,o8(h[0][r])))}else x5(i=g(S8(d5(e.path),t,e)),e.resolution),o.push(i),w8(this,t,e.x||"x",i,"x",e.unitX||"px"),w8(this,t,e.y||"y",i,"y",e.unitY||"px")},render:function(t,e){var n=e.rawPaths,i=n.length,r=e._pt;if(e.tween._time||!c8()){for(t>1?t=1:t<0&&(t=0);i--;)S5(n[i],t,!i&&e.rotate,n[i]);for(;r;)r.set(r.t,r.p,r.path[r.pp]+r.u,r.d,t),r=r._next;e.rotate&&e.rSet(e.target,e.rProp,n[0].angle*(e.radians?p8:1)+e.rOffset+e.ru,e,t)}else e.styles.revert()},getLength:function(t){return x5(d5(t)).totalLength},sliceRawPath:v5,getRawPath:d5,pointsToSegment:E5,stringToRawPath:M5,rawPathToString:C5,transformRawPath:w5,getGlobalMatrix:r8,getPositionOnPath:S5,cacheRawPathMeasurements:x5,convertToPath:function(t,e){return l8(t).map(function(t){return m5(t,!1!==e)})},convertCoordinates:function(t,e,n){var i=r8(e,!0,!0).multiply(r8(t));return n?i.apply(n):i},getAlignMatrix:_8,getRelativePosition:function(t,e,n,i){var r=_8(t,e,n,i);return{x:r.e,y:r.f}},arrayToRawPath:function(t,e){var n=f8(f8([],t,(e=e||{}).x||"x",0),t,e.y||"y",1);return e.relative&&g8(n),["cubic"===e.type?n:E5(n,e.curviness)]}};(s8||"undefined"!=typeof window&&(s8=window.gsap)&&s8.registerPlugin&&s8)&&s8.registerPlugin(T8);const M8={duration:.6,delay:0,repeat:0,ease:"sine.inOut",onComplete:()=>{}};class A8{static register(){QW.registerEffect({name:"fadeIn",effect:(t,e)=>QW.to(t,{alpha:e.alpha,duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0}),QW.registerEffect({name:"fadeOut",effect:(t,e)=>QW.to(t,{alpha:0,duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0}),QW.registerEffect({name:"rotate",effect:(t,e)=>QW.to(t,{angle:e.angle,duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0});["scaleIn","scaleOut","scaleUp","scaleDown"].forEach(t=>{QW.registerEffect({name:t,effect:(t,e)=>QW.to(t[0].scale,{x:e.scaleX,y:e.scaleY,duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0})});["fromTop","fromBottom","toTop","toBottom"].forEach(t=>{QW.registerEffect({name:t,effect:(t,e)=>QW.to(t[0],{y:e.y,duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0})});["fromLeft","fromRight","toLeft","toRight"].forEach(t=>{QW.registerEffect({name:t,effect:(t,e)=>QW.to(t[0],{x:e.x,duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0})}),QW.registerEffect({name:"pulse",effect:(t,e)=>QW.to(t[0].scale,{x:e.scaleX,y:e.scaleY,duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:!0,onUpdate:e.onUpdate,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0}),QW.registerEffect({name:"blur",effect:(t,e)=>QW.to(t,{pixi:{blur:e.blur},duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0}),QW.registerEffect({name:"brightness",effect:(t,e)=>QW.to(t,{pixi:{brightness:e.brightness},duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0}),QW.registerEffect({name:"tint",effect:(t,e)=>QW.to(t,{pixi:{tint:e.tint},duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0}),QW.registerEffect({name:"shake",effect:(t,e)=>QW.to(t[0],{x:e.x,y:e.y,duration:e.duration,delay:e.delay,ease:e.ease,yoyo:!0,repeat:e.repeat,repeatDelay:e.repeatDelay,onComplete:e.onComplete}),defaults:M8,extendTimeline:!0}),QW.registerEffect({name:"custom",effect:(t,e)=>{const n={duration:e.duration,delay:e.delay,ease:e.ease,repeat:e.repeat,repeatDelay:e.repeatDelay,yoyo:e.yoyo,onComplete:e.onComplete};return Object.keys(e).forEach(t=>{["duration","delay","ease","repeat","repeatDelay","yoyo","onComplete","getStart","getEnd"].includes(t)||(n[t]="function"==typeof e[t]?e[t]():e[t])}),QW.to(t,n)},defaults:M8,extendTimeline:!0})}}class E8{constructor(t,e){n(this,"config"),n(this,"application"),this.config=t,this.application=e}setApplication(t){this.application=t}resize(t,e){let n=this.application,i=this.application.canvas;const r=this.config;let s,a,o=r.resolution||1,l=1/o;if(r.maxDimension&&t*o>r.maxDimension&&e*o>r.maxDimension){var h=r.maxDimension;l=Math.min(t/h,e/h)+.0015,o=1,s=Math.ceil(t/l),a=Math.ceil(e/l)}else s=t*o,a=e*o;return app.pixiScale=l,e6.pixiScale=l,i.style["-ms-transform"]="scale("+l+")",i.style["-webkit-transform"]="scale3d("+l+", 1)",i.style["-moz-transform"]="scale("+l+")",i.style["-o-transform"]="scale("+l+")",i.style.transform="scale("+l+")",i.style.transformOrigin="top left",n.renderer.resize(s,a),e6.pixiWidth=s,e6.pixiHeight=a,{width:s,height:a}}}var C8={};setTimeout(()=>{window.particles=window.particles||{},function(t,e){class n{constructor(t){this.segments=[],this.countingLengths=[],this.totalLength=0,this.init(t)}init(t){if(t&&t.length)if(Array.isArray(t[0]))for(let e=0;e<t.length;++e){const n=t[e];let i=n[0];for(let t=1;t<n.length;++t){const e=n[t];this.segments.push({p1:i,p2:e,l:0}),i=e}}else{let e=t[0];for(let n=1;n<t.length;++n){const i=t[n];this.segments.push({p1:e,p2:i,l:0}),e=i}}else this.segments.push({p1:{x:0,y:0},p2:{x:0,y:0},l:0});for(let e=0;e<this.segments.length;++e){const{p1:t,p2:n}=this.segments[e],i=Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y));this.segments[e].l=i,this.totalLength+=i,this.countingLengths.push(this.totalLength)}}getRandPos(t){const e=Math.random()*this.totalLength;let n,i;if(1===this.segments.length)n=this.segments[0],i=e;else for(let a=0;a<this.countingLengths.length;++a)if(e<this.countingLengths[a]){n=this.segments[a],i=0===a?e:e-this.countingLengths[a-1];break}i/=n.l||1;const{p1:r,p2:s}=n;t.x=r.x+i*(s.x-r.x),t.y=r.y+i*(s.y-r.y)}}n.type="polygonalChain",n.editorConfig=null;class i{constructor(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h}getRandPos(t){t.x=Math.random()*this.w+this.x,t.y=Math.random()*this.h+this.y}}i.type="rect",i.editorConfig=null;class r{constructor(t,e,n){this.value=t,this.time=e,this.next=null,this.isStepped=!1,this.ease=n?"function"==typeof n?n:p(n):null}static createList(t){if("list"in t){const e=t.list;let n;const{value:i,time:s}=e[0],a=n=new r("string"==typeof i?d(i):i,s,t.ease);if(e.length>2||2===e.length&&e[1].value!==i)for(let t=1;t<e.length;++t){const{value:i,time:s}=e[t];n.next=new r("string"==typeof i?d(i):i,s),n=n.next}return a.isStepped=!!t.isStepped,a}const e=new r("string"==typeof t.start?d(t.start):t.start,0);return t.end!==t.start&&(e.next=new r("string"==typeof t.end?d(t.end):t.end,1)),e}}let s=e.Texture.from;const a=Math.PI/180;function o(t,e){if(!t)return;const n=Math.sin(t),i=Math.cos(t),r=e.x*i-e.y*n,s=e.x*n+e.y*i;e.x=r,e.y=s}function l(t,e,n){return t<<16|e<<8|n}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function c(t){const e=1/h(t);t.x*=e,t.y*=e}function u(t,e){t.x*=e,t.y*=e}function d(t,e){let n;return e||(e={}),"#"===t.charAt(0)?t=t.substr(1):0===t.indexOf("0x")&&(t=t.substr(2)),8===t.length&&(n=t.substr(0,2),t=t.substr(2)),e.r=parseInt(t.substr(0,2),16),e.g=parseInt(t.substr(2,2),16),e.b=parseInt(t.substr(4,2),16),n&&(e.a=parseInt(n,16)),e}function p(t){const e=t.length,n=1/e;return function(i){const r=e*i|0,s=(i-r*n)*e,a=t[r]||t[e-1];return a.s+s*(2*(1-s)*(a.cp-a.s)+s*(a.e-a.s))}}function f(t){return t||"normal"}var m,g,v={__proto__:null,DEG_TO_RADS:a,GetTextureFromString:s,combineRGBComponents:l,createSteppedGradient:function(t,e=10){("number"!=typeof e||e<=0)&&(e=10);const n=new r(d(t[0].value),t[0].time);n.isStepped=!0;let i=n,s=t[0],a=1,o=t[a];for(let l=1;l<e;++l){let n=l/e;for(;n>o.time;)s=o,o=t[++a];n=(n-s.time)/(o.time-s.time);const h=d(s.value),c=d(o.value),u={r:(c.r-h.r)*n+h.r,g:(c.g-h.g)*n+h.g,b:(c.b-h.b)*n+h.b};i.next=new r(u,l/e),i=i.next}return n},generateEase:p,getBlendMode:f,hexToRGB:d,length:h,normalize:c,rotatePoint:o,scaleBy:u,verbose:!1};class y{constructor(t){this.x=t.x||0,this.y=t.y||0,this.radius=t.radius,this.innerRadius=t.innerRadius||0,this.rotation=!!t.affectRotation}getRandPos(t){this.innerRadius!==this.radius?t.x=Math.random()*(this.radius-this.innerRadius)+this.innerRadius:t.x=this.radius,t.y=0;const e=Math.random()*Math.PI*2;this.rotation&&(t.rotation+=e),o(e,t.position),t.position.x+=this.x,t.position.y+=this.y}}y.type="torus",y.editorConfig=null,(g=m||(m={}))[g.Spawn=0]="Spawn",g[g.Normal=2]="Normal",g[g.Late=5]="Late";class x{constructor(t){this.order=m.Late,this.minStart=t.minStart,this.maxStart=t.maxStart,this.accel=t.accel,this.rotate=!!t.rotate,this.maxSpeed=t.maxSpeed??0}initParticles(t){let n=t;for(;n;){const t=Math.random()*(this.maxStart-this.minStart)+this.minStart;n.config.velocity?n.config.velocity.set(t,0):n.config.velocity=new e.Point(t,0),o(n.rotation,n.config.velocity),n=n.next}}updateParticle(t,e){const n=t.config.velocity,i=n.x,r=n.y;if(n.x+=this.accel.x*e,n.y+=this.accel.y*e,this.maxSpeed){const t=h(n);t>this.maxSpeed&&u(n,this.maxSpeed/t)}t.x+=(i+n.x)/2*e,t.y+=(r+n.y)/2*e,this.rotate&&(t.rotation=Math.atan2(n.y,n.x))}}function b(t){return this.ease&&(t=this.ease(t)),(this.first.next.value-this.first.value)*t+this.first.value}function _(t){this.ease&&(t=this.ease(t));const e=this.first.value,n=this.first.next.value;return l((n.r-e.r)*t+e.r,(n.g-e.g)*t+e.g,(n.b-e.b)*t+e.b)}function S(t){this.ease&&(t=this.ease(t));let e=this.first,n=e.next;for(;t>n.time;)e=n,n=n.next;return t=(t-e.time)/(n.time-e.time),(n.value-e.value)*t+e.value}function w(t){this.ease&&(t=this.ease(t));let e=this.first,n=e.next;for(;t>n.time;)e=n,n=n.next;t=(t-e.time)/(n.time-e.time);const i=e.value,r=n.value;return l((r.r-i.r)*t+i.r,(r.g-i.g)*t+i.g,(r.b-i.b)*t+i.b)}function T(t){this.ease&&(t=this.ease(t));let e=this.first;for(;e.next&&t>e.next.time;)e=e.next;return e.value}function M(t){this.ease&&(t=this.ease(t));let e=this.first;for(;e.next&&t>e.next.time;)e=e.next;const n=e.value;return l(n.r,n.g,n.b)}x.type="moveAcceleration",x.editorConfig=null;class A{constructor(t=!1){this.first=null,this.isColor=!!t,this.interpolate=null,this.ease=null}reset(t){this.first=t;t.next&&t.next.time>=1?this.interpolate=this.isColor?_:b:t.isStepped?this.interpolate=this.isColor?M:T:this.interpolate=this.isColor?w:S,this.ease=this.first.ease}}class E{constructor(t){this.order=m.Normal,this.list=new A(!1),this.list.reset(r.createList(t.alpha))}initParticles(t){let e=t;for(;e;)e.alpha=this.list.first.value,e=e.next}updateParticle(t){t.alpha=this.list.interpolate(t.agePercent)}}E.type="alpha",E.editorConfig=null;class C{constructor(t){this.order=m.Normal,this.value=t.alpha}initParticles(t){let e=t;for(;e;)e.alpha=this.value,e=e.next}}function P(t){const n=[];for(let i=0;i<t.length;++i){let r=t[i];if("string"==typeof r)n.push(s(r));else if(r instanceof e.Texture)n.push(r);else{let t=r.count||1;for(r="string"==typeof r.texture?s(r.texture):r.texture;t>0;--t)n.push(r)}}return n}C.type="alphaStatic",C.editorConfig=null;class R{constructor(t){this.order=m.Normal,this.anims=[];for(let e=0;e<t.anims.length;++e){const n=t.anims[e],i=P(n.textures),r=n.framerate<0?-1:n.framerate>0?n.framerate:60,s={textures:i,duration:r>0?i.length/r:0,framerate:r,loop:r>0&&!!n.loop};this.anims.push(s)}}initParticles(t){let e=t;for(;e;){const t=Math.floor(Math.random()*this.anims.length),n=e.config.anim=this.anims[t];e.texture=n.textures[0],e.config.animElapsed=0,-1===n.framerate?(e.config.animDuration=e.maxLife,e.config.animFramerate=n.textures.length/e.maxLife):(e.config.animDuration=n.duration,e.config.animFramerate=n.framerate),e=e.next}}updateParticle(t,n){const i=t.config,r=i.anim;i.animElapsed+=n,i.animElapsed>=i.animDuration&&(i.anim.loop?i.animElapsed=i.animElapsed%i.animDuration:i.animElapsed=i.animDuration-1e-6);const s=i.animElapsed*i.animFramerate+1e-7|0;t.texture=r.textures[s]||r.textures[r.textures.length-1]||e.Texture.EMPTY}}R.type="animatedRandom",R.editorConfig=null;class I{constructor(t){this.order=m.Normal;const e=t.anim,n=P(e.textures),i=e.framerate<0?-1:e.framerate>0?e.framerate:60;this.anim={textures:n,duration:i>0?n.length/i:0,framerate:i,loop:i>0&&!!e.loop}}initParticles(t){let e=t;const n=this.anim;for(;e;)e.texture=n.textures[0],e.config.animElapsed=0,-1===n.framerate?(e.config.animDuration=e.maxLife,e.config.animFramerate=n.textures.length/e.maxLife):(e.config.animDuration=n.duration,e.config.animFramerate=n.framerate),e=e.next}updateParticle(t,n){const i=this.anim,r=t.config;r.animElapsed+=n,r.animElapsed>=r.animDuration&&(i.loop?r.animElapsed=r.animElapsed%r.animDuration:r.animElapsed=r.animDuration-1e-6);const s=r.animElapsed*r.animFramerate+1e-7|0;t.texture=i.textures[s]||i.textures[i.textures.length-1]||e.Texture.EMPTY}}I.type="animatedSingle",I.editorConfig=null;class O{constructor(t){this.order=m.Normal,this.value=t.blendMode}initParticles(t){let e=t;for(;e;)e.blendMode=f(this.value),e=e.next}}O.type="blendMode",O.editorConfig=null;class D{constructor(t){this.order=m.Spawn,this.spacing=t.spacing*a,this.start=t.start*a,this.distance=t.distance}initParticles(t){let e=0,n=t;for(;n;){let t;t=this.spacing?this.start+this.spacing*e:Math.random()*Math.PI*2,n.rotation=t,this.distance&&(n.position.x=this.distance,o(t,n.position)),n=n.next,++e}}}D.type="spawnBurst",D.editorConfig=null;class B{constructor(t){this.order=m.Normal,this.list=new A(!0),this.list.reset(r.createList(t.color))}initParticles(t){let e=t;const n=this.list.first.value,i=l(n.r,n.g,n.b);for(;e;)e.tint=i,e=e.next}updateParticle(t){t.tint=this.list.interpolate(t.agePercent)}}B.type="color",B.editorConfig=null;class F{constructor(t){this.order=m.Normal;let e=t.color;"#"===e.charAt(0)?e=e.substr(1):0===e.indexOf("0x")&&(e=e.substr(2)),this.value=parseInt(e,16)}initParticles(t){let e=t;for(;e;)e.tint=this.value,e=e.next}}F.type="colorStatic",F.editorConfig=null;class L{constructor(t){this.order=m.Normal,this.index=0,this.textures=t.textures.map(t=>"string"==typeof t?s(t):t)}initParticles(t){let e=t;for(;e;)e.texture=this.textures[this.index],++this.index>=this.textures.length&&(this.index=0),e=e.next}}L.type="textureOrdered",L.editorConfig=null;const U=new e.Point,k=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","abs","acos","acosh","asin","asinh","atan","atanh","atan2","cbrt","ceil","cos","cosh","exp","expm1","floor","fround","hypot","log","log1p","log10","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh"],N=new RegExp(["[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]"].concat(k).join("|"),"g");class z{constructor(t){if(this.order=m.Late,t.path)if("function"==typeof t.path)this.path=t.path;else try{this.path=function(t){const e=t.match(N);for(let n=e.length-1;n>=0;--n)k.indexOf(e[n])>=0&&(e[n]=`Math.${e[n]}`);return t=e.join(""),new Function("x",`return ${t};`)}(t.path)}catch(S6){this.path=null}else this.path=t=>t;this.list=new A(!1),this.list.reset(r.createList(t.speed)),this.minMult=t.minMult??1}initParticles(t){let n=t;for(;n;){n.config.initRotation=n.rotation,n.config.initPosition?n.config.initPosition.copyFrom(n.position):n.config.initPosition=new e.Point(n.x,n.y),n.config.movement=0;const t=Math.random()*(1-this.minMult)+this.minMult;n.config.speedMult=t,n=n.next}}updateParticle(t,e){const n=this.list.interpolate(t.agePercent)*t.config.speedMult;t.config.movement+=n*e,U.x=t.config.movement,U.y=this.path(U.x),o(t.config.initRotation,U),t.position.x=t.config.initPosition.x+U.x,t.position.y=t.config.initPosition.y+U.y}}z.type="movePath",z.editorConfig=null;class G{constructor(){this.order=m.Spawn}initParticles(t){}}G.type="spawnPoint",G.editorConfig=null;class H{constructor(t){this.order=m.Normal,this.textures=t.textures.map(t=>"string"==typeof t?s(t):t)}initParticles(t){let e=t;for(;e;){const t=Math.floor(Math.random()*this.textures.length);e.texture=this.textures[t],e=e.next}}}H.type="textureRandom",H.editorConfig=null;class V{constructor(t){this.order=m.Normal,this.minStart=t.minStart*a,this.maxStart=t.maxStart*a,this.minSpeed=t.minSpeed*a,this.maxSpeed=t.maxSpeed*a,this.accel=t.accel*a}initParticles(t){let e=t;for(;e;)this.minStart===this.maxStart?e.rotation+=this.maxStart:e.rotation+=Math.random()*(this.maxStart-this.minStart)+this.minStart,e.config.rotSpeed=Math.random()*(this.maxSpeed-this.minSpeed)+this.minSpeed,e=e.next}updateParticle(t,e){if(this.accel){const n=t.config.rotSpeed;t.config.rotSpeed+=this.accel*e,t.rotation+=(t.config.rotSpeed+n)/2*e}else t.rotation+=t.config.rotSpeed*e}}V.type="rotation",V.editorConfig=null;class X{constructor(t){this.order=m.Normal,this.min=t.min*a,this.max=t.max*a}initParticles(t){let e=t;for(;e;)this.min===this.max?e.rotation+=this.max:e.rotation+=Math.random()*(this.max-this.min)+this.min,e=e.next}}X.type="rotationStatic",X.editorConfig=null;class W{constructor(t){this.order=m.Late+1,this.rotation=(t.rotation||0)*a}initParticles(t){let e=t;for(;e;)e.rotation=this.rotation,e=e.next}}W.type="noRotation",W.editorConfig=null;class j{constructor(t){this.order=m.Normal,this.list=new A(!1),this.list.reset(r.createList(t.scale)),this.minMult=t.minMult??1}initParticles(t){let e=t;for(;e;){const t=Math.random()*(1-this.minMult)+this.minMult;e.config.scaleMult=t,e.scale.x=e.scale.y=this.list.first.value*t,e=e.next}}updateParticle(t){t.scale.x=t.scale.y=this.list.interpolate(t.agePercent)*t.config.scaleMult}}j.type="scale",j.editorConfig=null;class Y{constructor(t){this.order=m.Normal,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.max-this.min)+this.min;e.scale.x=e.scale.y=t,e=e.next}}}Y.type="scaleStatic",Y.editorConfig=null;class q{static registerShape(t,e){q.shapes[e||t.type]=t}constructor(t){this.order=m.Spawn;const e=q.shapes[t.type];if(!e)throw new Error(`No shape found with type '${t.type}'`);this.shape=new e(t.data)}initParticles(t){let e=t;for(;e;)this.shape.getRandPos(e),e=e.next}}q.type="spawnShape",q.editorConfig=null,q.shapes={},q.registerShape(n),q.registerShape(i),q.registerShape(y),q.registerShape(y,"circle");class K{constructor(t){this.order=m.Normal,this.texture="string"==typeof t.texture?s(t.texture):t.texture}initParticles(t){let e=t;for(;e;)e.texture=this.texture,e=e.next}}K.type="textureSingle",K.editorConfig=null;class J{constructor(t){this.order=m.Late,this.list=new A(!1),this.list.reset(r.createList(t.speed)),this.minMult=t.minMult??1}initParticles(t){let n=t;for(;n;){const t=Math.random()*(1-this.minMult)+this.minMult;n.config.speedMult=t,n.config.velocity?n.config.velocity.set(this.list.first.value*t,0):n.config.velocity=new e.Point(this.list.first.value*t,0),o(n.rotation,n.config.velocity),n=n.next}}updateParticle(t,e){const n=this.list.interpolate(t.agePercent)*t.config.speedMult,i=t.config.velocity;c(i),u(i,n),t.x+=i.x*e,t.y+=i.y*e}}J.type="moveSpeed",J.editorConfig=null;class Z{constructor(t){this.order=m.Late,this.min=t.min,this.max=t.max}initParticles(t){let n=t;for(;n;){const t=Math.random()*(this.max-this.min)+this.min;n.config.velocity?n.config.velocity.set(t,0):n.config.velocity=new e.Point(t,0),o(n.rotation,n.config.velocity),n=n.next}}updateParticle(t,e){const n=t.config.velocity;t.x+=n.x*e,t.y+=n.y*e}}Z.type="moveSpeedStatic",Z.editorConfig=null;class Q extends e.Sprite{constructor(t){super(),this.prevChild=this.nextChild=null,this.emitter=t,this.config={},this.anchor.x=this.anchor.y=.5,this.maxLife=0,this.age=0,this.agePercent=0,this.oneOverLife=0,this.next=null,this.prev=null,this.init=this.init,this.kill=this.kill}init(t){this.maxLife=t,this.age=this.agePercent=0,this.rotation=0,this.position.x=this.position.y=0,this.scale.x=this.scale.y=1,this.tint=16777215,this.alpha=1,this.oneOverLife=1/this.maxLife,this.visible=!0}kill(){this.emitter.recycle(this)}destroy(){this.parent&&this.parent.removeChild(this),this.emitter=this.next=this.prev=null,super.destroy()}}const $=e.Ticker.shared,tt=Symbol("Position particle per emitter position");class et{static registerBehavior(t){et.knownBehaviors[t.type]=t}constructor(t,n){this.initBehaviors=[],this.updateBehaviors=[],this.recycleBehaviors=[],this.minLifetime=0,this.maxLifetime=0,this.customEase=null,this._frequency=1,this.spawnChance=1,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=new e.Point,this.particlesPerWave=1,this.rotation=0,this.ownerPos=new e.Point,this._prevEmitterPos=new e.Point,this._prevPosIsValid=!1,this._posChanged=!1,this._parent=null,this.addAtBack=!1,this.particleCount=0,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticlesFirst=null,this._activeParticlesLast=null,this._poolFirst=null,this._origConfig=null,this._autoUpdate=!1,this._destroyWhenComplete=!1,this._completeCallback=null,this.parent=t,n&&this.init(n),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos}get frequency(){return this._frequency}set frequency(t){this._frequency="number"==typeof t&&t>0?t:1}get parent(){return this._parent}set parent(t){this.cleanup(),this._parent=t}init(t){if(!t)return;this.cleanup(),this._origConfig=t,this.minLifetime=t.lifetime.min,this.maxLifetime=t.lifetime.max,t.ease?this.customEase="function"==typeof t.ease?t.ease:p(t.ease):this.customEase=null,this.particlesPerWave=1,t.particlesPerWave&&t.particlesPerWave>1&&(this.particlesPerWave=t.particlesPerWave),this.frequency=t.frequency,this.spawnChance="number"==typeof t.spawnChance&&t.spawnChance>0?t.spawnChance:1,this.emitterLifetime=t.emitterLifetime||-1,this.maxParticles=t.maxParticles>0?t.maxParticles:1e3,this.addAtBack=!!t.addAtBack,this.rotation=0,this.ownerPos.set(0),t.pos?this.spawnPos.copyFrom(t.pos):this.spawnPos.set(0),this._prevEmitterPos.copyFrom(this.spawnPos),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=void 0===t.emit||!!t.emit,this.autoUpdate=!!t.autoUpdate;const e=t.behaviors.map(t=>{const e=et.knownBehaviors[t.type];return e?new e(t.config):null}).filter(t=>!!t);e.push(tt),e.sort((t,e)=>t===tt?e.order===m.Spawn?1:-1:e===tt?t.order===m.Spawn?-1:1:t.order-e.order),this.initBehaviors=e.slice(),this.updateBehaviors=e.filter(t=>t!==tt&&t.updateParticle),this.recycleBehaviors=e.filter(t=>t!==tt&&t.recycleParticle)}getBehavior(t){return et.knownBehaviors[t]&&this.initBehaviors.find(e=>e instanceof et.knownBehaviors[t])||null}fillPool(t){for(;t>0;--t){const t=new Q(this);t.next=this._poolFirst,this._poolFirst=t}}recycle(t,e=!1){for(let n=0;n<this.recycleBehaviors.length;++n)this.recycleBehaviors[n].recycleParticle(t,!e);t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t===this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t===this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),t.prev=null,t.next=this._poolFirst,this._poolFirst=t,t.parent&&t.parent.removeChild(t),--this.particleCount}rotate(t){if(this.rotation===t)return;const e=t-this.rotation;this.rotation=t,o(e,this.spawnPos),this._posChanged=!0}updateSpawnPos(t,e){this._posChanged=!0,this.spawnPos.x=t,this.spawnPos.y=e}updateOwnerPos(t,e){this._posChanged=!0,this.ownerPos.x=t,this.ownerPos.y=e}resetPositionTracking(){this._prevPosIsValid=!1}get emit(){return this._emit}set emit(t){this._emit=!!t,this._emitterLife=this.emitterLifetime}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this._autoUpdate&&!t?$.remove(this.update,this):!this._autoUpdate&&t&&$.add(this.update,this),this._autoUpdate=!!t}playOnceAndDestroy(t){this.autoUpdate=!0,this.emit=!0,this._destroyWhenComplete=!0,this._completeCallback=t}playOnce(t){this.emit=!0,this._completeCallback=t}update(t){if("number"!=typeof t&&(t=t.deltaTime),this._autoUpdate&&(t=.001*$.elapsedMS),!this._parent)return;for(let s,a=this._activeParticlesFirst;a;a=s)if(s=a.next,a.age+=t,a.age>a.maxLife||a.age<0)this.recycle(a);else{let e=a.age*a.oneOverLife;this.customEase&&(e=4===this.customEase.length?this.customEase(e,0,1,1):this.customEase(e)),a.agePercent=e;for(let n=0;n<this.updateBehaviors.length;++n)if(this.updateBehaviors[n].updateParticle(a,t)){this.recycle(a);break}}let e,n;this._prevPosIsValid&&(e=this._prevEmitterPos.x,n=this._prevEmitterPos.y);const i=this.ownerPos.x+this.spawnPos.x,r=this.ownerPos.y+this.spawnPos.y;if(this._emit)for(this._spawnTimer-=t<0?0:t;this._spawnTimer<=0;){if(this._emitterLife>=0&&(this._emitterLife-=this._frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this.particleCount>=this.maxParticles){this._spawnTimer+=this._frequency;continue}let s,a;if(this._prevPosIsValid&&this._posChanged){const o=1+this._spawnTimer/t;s=(i-e)*o+e,a=(r-n)*o+n}else s=i,a=r;let l=null,h=null;for(let t=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),e=0;e<t;++e){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let t,e;(t=this.minLifetime===this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer>=t)||(this._poolFirst?(e=this._poolFirst,this._poolFirst=this._poolFirst.next,e.next=null):e=new Q(this),e.init(t),this.addAtBack?this._parent.addChildAt(e,0):this._parent.addChild(e),l?(h.next=e,e.prev=h,h=e):h=l=e,++this.particleCount)}if(l){this._activeParticlesLast?(this._activeParticlesLast.next=l,l.prev=this._activeParticlesLast,this._activeParticlesLast=h):(this._activeParticlesFirst=l,this._activeParticlesLast=h);for(let t=0;t<this.initBehaviors.length;++t){const e=this.initBehaviors[t];if(e===tt)for(let t,n=l;n;n=t){t=n.next,0!==this.rotation&&(o(this.rotation,n.position),n.rotation+=this.rotation),n.position.x+=s,n.position.y+=a,n.age+=-this._spawnTimer;let e=n.age*n.oneOverLife;this.customEase&&(e=4===this.customEase.length?this.customEase(e,0,1,1):this.customEase(e)),n.agePercent=e}else e.initParticles(l)}for(let t,e=l;e;e=t){t=e.next;for(let t=0;t<this.updateBehaviors.length;++t)if(this.updateBehaviors[t].updateParticle(e,-this._spawnTimer)){this.recycle(e);break}}}this._spawnTimer+=this._frequency}if(this._posChanged&&(this._prevEmitterPos.x=i,this._prevEmitterPos.y=r,this._prevPosIsValid=!0,this._posChanged=!1),!this._emit&&!this._activeParticlesFirst){if(this._completeCallback){const t=this._completeCallback;this._completeCallback=null,t()}this._destroyWhenComplete&&this.destroy()}}emitNow(){const t=this.ownerPos.x+this.spawnPos.x,e=this.ownerPos.y+this.spawnPos.y;let n=null,i=null;for(let r=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),s=0;s<r;++s){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let t,e;this._poolFirst?(t=this._poolFirst,this._poolFirst=this._poolFirst.next,t.next=null):t=new Q(this),e=this.minLifetime===this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,t.init(e),this.addAtBack?this._parent.addChildAt(t,0):this._parent.addChild(t),n?(i.next=t,t.prev=i,i=t):i=n=t,++this.particleCount}if(n){this._activeParticlesLast?(this._activeParticlesLast.next=n,n.prev=this._activeParticlesLast,this._activeParticlesLast=i):(this._activeParticlesFirst=n,this._activeParticlesLast=i);for(let i=0;i<this.initBehaviors.length;++i){const r=this.initBehaviors[i];if(r===tt)for(let i,s=n;s;s=i)i=s.next,0!==this.rotation&&(o(this.rotation,s.position),s.rotation+=this.rotation),s.position.x+=t,s.position.y+=e;else r.initParticles(n)}}}cleanup(){let t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t,!0);this._activeParticlesFirst=this._activeParticlesLast=null,this.particleCount=0}get destroyed(){return!(this._parent&&this.initBehaviors.length)}destroy(){let t;this.autoUpdate=!1,this.cleanup();for(let e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=this._parent=this.spawnPos=this.ownerPos=this.customEase=this._completeCallback=null,this.initBehaviors.length=this.updateBehaviors.length=this.recycleBehaviors.length=0}}et.knownBehaviors={},et.registerBehavior(x),et.registerBehavior(E),et.registerBehavior(C),et.registerBehavior(R),et.registerBehavior(I),et.registerBehavior(O),et.registerBehavior(D),et.registerBehavior(B),et.registerBehavior(F),et.registerBehavior(L),et.registerBehavior(z),et.registerBehavior(G),et.registerBehavior(H),et.registerBehavior(V),et.registerBehavior(X),et.registerBehavior(W),et.registerBehavior(j),et.registerBehavior(Y),et.registerBehavior(q),et.registerBehavior(K),et.registerBehavior(J),et.registerBehavior(Z),t.Emitter=et,t.Particle=Q,t.ParticleUtils=v,t.PropertyList=A,t.PropertyNode=r,t.upgradeConfig=function(t,e){var n,i,r,s,a,o,l,h,c,u,d;if("behaviors"in t)return t;const p={lifetime:t.lifetime,ease:t.ease,particlesPerWave:t.particlesPerWave,frequency:t.frequency,spawnChance:t.spawnChance,emitterLifetime:t.emitterLifetime,maxParticles:t.maxParticles,addAtBack:t.addAtBack,pos:t.pos,emit:t.emit,autoUpdate:t.autoUpdate,behaviors:[]};if(t.alpha)if("start"in t.alpha)if(t.alpha.start===t.alpha.end)1!==t.alpha.start&&p.behaviors.push({type:"alphaStatic",config:{alpha:t.alpha.start}});else{const e={list:[{time:0,value:t.alpha.start},{time:1,value:t.alpha.end}]};p.behaviors.push({type:"alpha",config:{alpha:e}})}else 1===t.alpha.list.length?1!==t.alpha.list[0].value&&p.behaviors.push({type:"alphaStatic",config:{alpha:t.alpha.list[0].value}}):p.behaviors.push({type:"alpha",config:{alpha:t.alpha}});if(t.acceleration&&(t.acceleration.x||t.acceleration.y)){let e,n;"start"in t.speed?(e=t.speed.start*(t.speed.minimumSpeedMultiplier??1),n=t.speed.start):(e=t.speed.list[0].value*(t.minimumSpeedMultiplier??1),n=t.speed.list[0].value),p.behaviors.push({type:"moveAcceleration",config:{accel:t.acceleration,minStart:e,maxStart:n,rotate:!t.noRotation,maxSpeed:t.maxSpeed}})}else if(null==(n=t.extraData)?void 0:n.path){let e,n;"start"in t.speed?(n=t.speed.minimumSpeedMultiplier??1,e=t.speed.start===t.speed.end?{list:[{time:0,value:t.speed.start}]}:{list:[{time:0,value:t.speed.start},{time:1,value:t.speed.end}]}):(e=t.speed,n=t.minimumSpeedMultiplier??1),p.behaviors.push({type:"movePath",config:{path:t.extraData.path,speed:e,minMult:n}})}else if(t.speed)if("start"in t.speed)if(t.speed.start===t.speed.end)p.behaviors.push({type:"moveSpeedStatic",config:{min:t.speed.start*(t.speed.minimumSpeedMultiplier??1),max:t.speed.start}});else{const e={list:[{time:0,value:t.speed.start},{time:1,value:t.speed.end}]};p.behaviors.push({type:"moveSpeed",config:{speed:e,minMult:t.speed.minimumSpeedMultiplier}})}else 1===t.speed.list.length?p.behaviors.push({type:"moveSpeedStatic",config:{min:t.speed.list[0].value*(t.minimumSpeedMultiplier??1),max:t.speed.list[0].value}}):p.behaviors.push({type:"moveSpeed",config:{speed:t.speed,minMult:t.minimumSpeedMultiplier??1}});if(t.scale)if("start"in t.scale){const e=t.scale.minimumScaleMultiplier??1;if(t.scale.start===t.scale.end)p.behaviors.push({type:"scaleStatic",config:{min:t.scale.start*e,max:t.scale.start}});else{const n={list:[{time:0,value:t.scale.start},{time:1,value:t.scale.end}]};p.behaviors.push({type:"scale",config:{scale:n,minMult:e}})}}else if(1===t.scale.list.length){const e=t.minimumScaleMultiplier??1,n=t.scale.list[0].value;p.behaviors.push({type:"scaleStatic",config:{min:n*e,max:n}})}else p.behaviors.push({type:"scale",config:{scale:t.scale,minMult:t.minimumScaleMultiplier??1}});if(t.color)if("start"in t.color)if(t.color.start===t.color.end)"ffffff"!==t.color.start&&p.behaviors.push({type:"colorStatic",config:{color:t.color.start}});else{const e={list:[{time:0,value:t.color.start},{time:1,value:t.color.end}]};p.behaviors.push({type:"color",config:{color:e}})}else 1===t.color.list.length?"ffffff"!==t.color.list[0].value&&p.behaviors.push({type:"colorStatic",config:{color:t.color.list[0].value}}):p.behaviors.push({type:"color",config:{color:t.color}});if(t.rotationAcceleration||(null==(i=t.rotationSpeed)?void 0:i.min)||(null==(r=t.rotationSpeed)?void 0:r.max)?p.behaviors.push({type:"rotation",config:{accel:t.rotationAcceleration||0,minSpeed:(null==(s=t.rotationSpeed)?void 0:s.min)||0,maxSpeed:(null==(a=t.rotationSpeed)?void 0:a.max)||0,minStart:(null==(o=t.startRotation)?void 0:o.min)||0,maxStart:(null==(l=t.startRotation)?void 0:l.max)||0}}):((null==(h=t.startRotation)?void 0:h.min)||(null==(c=t.startRotation)?void 0:c.max))&&p.behaviors.push({type:"rotationStatic",config:{min:(null==(u=t.startRotation)?void 0:u.min)||0,max:(null==(d=t.startRotation)?void 0:d.max)||0}}),t.noRotation&&p.behaviors.push({type:"noRotation",config:{}}),t.blendMode&&"normal"!==t.blendMode&&p.behaviors.push({type:"blendMode",config:{blendMode:t.blendMode}}),Array.isArray(e)&&"string"!=typeof e[0]&&"framerate"in e[0]){for(let t=0;t<e.length;++t)"matchLife"===e[t].framerate&&(e[t].framerate=-1);p.behaviors.push({type:"animatedRandom",config:{anims:e}})}else"string"!=typeof e&&"framerate"in e?("matchLife"===e.framerate&&(e.framerate=-1),p.behaviors.push({type:"animatedSingle",config:{anim:e}})):t.orderedArt&&Array.isArray(e)?p.behaviors.push({type:"textureOrdered",config:{textures:e}}):Array.isArray(e)?p.behaviors.push({type:"textureRandom",config:{textures:e}}):p.behaviors.push({type:"textureSingle",config:{texture:e}});if("burst"===t.spawnType)p.behaviors.push({type:"spawnBurst",config:{start:t.angleStart||0,spacing:t.particleSpacing,distance:0}});else if("point"===t.spawnType)p.behaviors.push({type:"spawnPoint",config:{}});else{let e;"ring"===t.spawnType?e={type:"torus",data:{x:t.spawnCircle.x,y:t.spawnCircle.y,radius:t.spawnCircle.r,innerRadius:t.spawnCircle.minR,affectRotation:!0}}:"circle"===t.spawnType?e={type:"torus",data:{x:t.spawnCircle.x,y:t.spawnCircle.y,radius:t.spawnCircle.r,innerRadius:0,affectRotation:!1}}:"rect"===t.spawnType?e={type:"rect",data:t.spawnRect}:"polygonalChain"===t.spawnType&&(e={type:"polygonalChain",data:t.spawnPolygon}),e&&p.behaviors.push({type:"spawnShape",config:e})}return p}}(window.particles,PIXI)},0),(null==C8?{}:C8).default,(null==C8?{}:C8).Emitter,(null==C8?{}:C8).Particle,(null==C8?{}:C8).ParticleUtils,(null==C8?{}:C8).PropertyList,(null==C8?{}:C8).PropertyNode,(null==C8?{}:C8).upgradeConfig;const{Container:P8,Graphics:R8,Text:I8,Sprite:O8,Texture:D8,TilingSprite:B8}=Nk;class F8 extends P8{constructor(t){super(),this.scene=t,t.parent.addChild(this),this.zIndex=1e3;let e={enable:e6.data.bannerEnable,width:e6.data.bannerWidthRatio,height:e6.data.bannerHeightRatio,alpha:e6.data.bannerAlpha,textAlpha:e6.data.bannerTextAlpha,offsetY:e6.data.bannerOffsetYRatio,borderRadius:e6.data.bannerBorderRadius,bgType:e6.data.bannerBgType,bgColor:e6.data.bannerBgColor,bgGradientColorTop:e6.data.bannerBgGradientColorTop,bgGradientColorBottom:e6.data.bannerBgGradientColorBottom,bgImage:e6.data.bannerBgImage,text:e6.data.bannerText.text,textColor:e6.data.bannerText.color,textFont:e6.data.bannerTextFont};this.config=e,this.bannerBgImageTexture=function(t){return u0.getTexture(t)}("bannerBgImage"),this.initBg(e);let n=new I8({text:e.text,style:{fontFamily:e.textFont,fontSize:50,fill:e.textColor,align:"center"}});n.baseWidth=n.width,n.baseHeight=n.height,n.anchor.set(.5),this.addChild(n),this.text=n,this.bg.alpha=e.alpha,n.alpha=e.textAlpha,this.onResizeCallback=(t,i)=>{let r=this.bg,s=t*e.width*.01,a=i*e.height*.01,o=a*e.borderRadius*.01;r.redraw(s,a,o);let l=Math.min(.9*s/n.baseWidth,.8*a/n.baseHeight);n.scale.set(l),n.y=a/2,this.x=t/2,this.y=i*e.offsetY*.01},this.onResizeCallback(t.baseWidth,t.baseHeight),this.initEvents(),this.visible=e.enable}initEvents(){let t=this.scene,e=[{name:"bannerEnable",callback:t=>{this.config.enable=t,this.visible=t}},{name:"bannerWidthRatio",callback:e=>{this.config.width=e,this.onResizeCallback(t.baseWidth,t.baseHeight)}},{name:"bannerHeightRatio",callback:e=>{this.config.height=e,this.onResizeCallback(t.baseWidth,t.baseHeight)}},{name:"bannerOffsetYRatio",callback:e=>{this.config.offsetY=e,this.onResizeCallback(t.baseWidth,t.baseHeight)}},{name:"bannerBorderRadius",callback:e=>{this.config.borderRadius=e,this.onResizeCallback(t.baseWidth,t.baseHeight)}},{name:"bannerAlpha",callback:t=>{this.config.alpha=t,this.bg.alpha=t}},{name:"bannerBgType",callback:e=>{this.config.bgType=e,this.curBgType!=e&&this.initBg(this.config),this.onResizeCallback(t.baseWidth,t.baseHeight)}},{name:"bannerBgColor",callback:e=>{this.config.bgColor=e,this.onResizeCallback(t.baseWidth,t.baseHeight)}},{name:"bannerBgGradientColorTop",callback:e=>{this.config.bgGradientColorTop=e,this.onResizeCallback(t.baseWidth,t.baseHeight)}},{name:"bannerBgImage",callback:async e=>{this.config.bgImage=e,wC.add({alias:"bannerBgImage",src:e}),wC.load("bannerBgImage").then(e=>{this.bannerBgImageTexture=e,this.initBg(this.config),this.onResizeCallback(t.baseWidth,t.baseHeight)})}},{name:"bannerText",callback:e=>{let n=this.text;this.config.text=e.text,this.config.textColor=e.color,n.style.fill=e.color;let i=n.scale.x;n.scale.set(1),n.baseWidth=n.width,n.baseHeight=n.height,n.text=e.text,n.scale.set(i),this.onResizeCallback(t.baseWidth,t.baseHeight)}},{name:"bannerTextAlpha",callback:t=>{this.config.textAlpha=t,this.text.alpha=t}}];e.forEach(t=>{let e="pf_"+t.name;window.addEventListener(e,e=>{let n=e.detail.value;t.callback(n)})})}initBg(t){let e;if(this.bg&&this.bg.destroy(),this.curBgType=t.bgType,0==t.bgType)e=new R8,e.redraw=(n,i,r)=>{e.clear();let s=Number(t.bgColor.replace("#","0x"));e.roundRect(0,0,n,i,r),e.fill({color:s}),e.pivot.set(n/2,0)};else if(1==t.bgType){const n=document.createElement("canvas");n.width=256,n.height=64;const i=n.getContext("2d");e=new O8(D8.from(n)),e.redraw=(r,s,a)=>{s=s||20,n.width=r,n.height=s,i.clearRect(0,0,n.width,n.height);const o=i.createLinearGradient(0,0,0,s);o.addColorStop(0,t.bgGradientColorTop),o.addColorStop(1,t.bgGradientColorBottom),i.fillStyle=o,i.fillRect(0,0,r,s),i.globalCompositeOperation="destination-in",function(t,e,n,i,r,s=5,a=!1,o=!0){s="number"==typeof s?{tl:s,tr:s,br:s,bl:s}:{tl:0,tr:0,br:0,bl:0,...s};t.beginPath(),t.moveTo(e+s.tl,n),t.lineTo(e+i-s.tr,n),t.quadraticCurveTo(e+i,n,e+i,n+s.tr),t.lineTo(e+i,n+r-s.br),t.quadraticCurveTo(e+i,n+r,e+i-s.br,n+r),t.lineTo(e+s.bl,n+r),t.quadraticCurveTo(e,n+r,e,n+r-s.bl),t.lineTo(e,n+s.tl),t.quadraticCurveTo(e,n,e+s.tl,n),t.closePath(),a&&t.fill();o&&t.stroke()}(i,0,0,r,s,a,!0,!1),e.texture.source.update()},e.anchor.set(.5,0)}else if(2==t.bgType){const t=this.bannerBgImageTexture?this.bannerBgImageTexture:D8.WHITE;e=new B8(t),e.anchor.set(.5,0);let n=new R8;this.addChild(n),n.isMask=!0,e.mask=n,e.redraw=(t,i,r)=>{n.clear(),n.roundRect(0,0,t,i,r),n.fill({color:16711680}),n.pivot.set(t/2,0),e.width=t,e.height=i}}return this.addChild(e),this.bg=e,e}show(){this.visible=!0,this.alpha=0,QW.killTweensOf(this),QW.to(this,{alpha:1,duration:.5})}hide(t=!1){if(t)return QW.killTweensOf(this),void(this.visible=!1);QW.killTweensOf(this),QW.to(this,{alpha:0,duration:.5,onComplete:()=>{this.visible=!1}})}}const L8=S||w;let U8;window.gsap=QW;class k8{constructor(t){n(this,"application"),n(this,"scriptSystem"),n(this,"sceneHelper"),n(this,"responsive"),this.sceneHelper=Y8,this.application=t,this.scriptSystem=new Yj(Y8,d0),Yj.script2d=this.scriptSystem;this.responsive=new E8({maxDimension:1e3,resolution:2},t)}onAllReady(){var t,e;e6.data.enableFpsCounter&&(U8=new Rj,U8.showPanel(0),U8.domElement.children[0].style.left="15px",U8.domElement.children[0].style.top="30px",document.body.appendChild(U8.dom)),A8.register(),t=this.application,dN=t,e=this.application.stage,uN=e,Y8.init(this.application)}onBeforeUpdate(){e6.data.bannerEnable&&(e6.topBanner?e6.topBanner.show():e6.topBanner=new F8(e6.pixiScene))}update(t){U8&&U8.begin(),N8.ticker.update(),Y8.sceneList.forEach(e=>{e.update(t)}),d0.update(t),z8&&(z8.resetState(),z8.render(e6.threeScene,e6.threeCamera),N8.renderer.resetState(),N8.renderer.render({container:N8.stage})),U8&&U8.end()}canvasResize(t,e){return this.responsive.resize(t,e)}resize(t,e){var n;let i=t,r=e;const s=e6.projectConfig.generalSettings.lockScreen,a=N8.stage;"landscape"===s?(t<e&&(i=e,r=t),t>e?(a.rotation=0,a.x=0):(a.rotation=Math.PI/2,a.x=t)):"portrait"===s&&(t>e&&(i=e,r=t),t>e?(a.rotation=-Math.PI/2,a.x=0,a.y=e):(a.rotation=0,a.x=0,a.y=0)),Y8.sceneList.forEach(t=>{t.resize(i,r),t.hitArea=new Hy(0,0,i,r)}),a.hitArea=new Hy(0,0,i,r),null==(n=e6.game)||n.resize2D(i,r)}}const N8=new $w;let z8,G8=!1,H8="waiting",V8=null;async function X8(t=[],e){var n;if(G8)return;G8=!0;let i=app.data.backgroundColor,r=1;r=0,i=0;const s={preference:"webgl",clearBeforeRender:!0,backgroundAlpha:0,backgroundColor:0,resolution:1,antialias:!0,hello:!0,autoDensity:!1,width:window.innerWidth,height:window.innerHeight};if(e)s.context=e.getContext(),s.clearBeforeRender=!1,z8=e;else{const t=document.createElement("canvas");document.body.appendChild(t),t.addEventListener("touchstart",t=>{t.preventDefault()}),s.canvas=t}return(null==(n=null==window?void 0:window.editorMeta)?void 0:n.isEditing)&&(s.preserveDrawingBuffer=!0,window.pfTakeSnapshotPixi=()=>"3D"===e6.projectType?N8.canvas.toDataURL("image/png"):N8.canvas.toDataURL("image/jpeg",.7)),await N8.init(s),N8.stage.label="root",V8=new k8(N8),H8="loading",G4.registerPIXI(PIXI),QW.registerPlugin(G4,U5),QW.registerPlugin(T8),QW.defaults({ease:"sine.inOut"}),Object.entries(L8.bitmapFontSettings.bitmapFonts).forEach(([t,e])=>{const{color:n,fontFamily:i,label:r,stroke:s,dropShadow:a}=e;SE.install({name:r,style:{fontFamily:i||"Arial",fontSize:64,fill:n,stroke:{width:s.width,color:new zx(s.color.replace("#","0x"))},dropShadow:{alpha:a.alpha,color:new zx(a.color.replace("#","0x")),blur:a.blur,angle:a.angle,distance:a.distance}},padding:10})}),await async function(t=[]){l0.addStuffsAssets(),l0.addOptionalAssets();const e=await u0.load(l0.getAssetsToLoad().concat(t));l0.setLoadedAssets(e),H8="ready",N8.canvas.style.zIndex="1"}(t),V8}function W8(t,e){const n=null==V8?void 0:V8.canvasResize(t,e);if(!n)return;const i=n.width,r=n.height;var s,a;if(N8.stage.baseWidth=i,N8.stage.baseHeight=r,hN=i>r?"landscape":"portrait",s=i,a=r,fN.width=s,fN.height=a,"waiting"===H8)return;N8.renderer.resize(i,r),null==V8||V8.resize(i,r);(function(t){const e=[],n=t=>{t.children.forEach(t=>{e.push(t),t.children&&n(t)})};return t.children.forEach(t=>{e.push(t),t.children&&n(t)}),e})(N8.stage).forEach(t=>{t.onResizeCallback&&t.onResizeCallback(t.parent.baseWidth,t.parent.baseHeight)})}class j8{static init(t){this.application=t}static initSceneByIndex(t,e=!1,n=!1){const i=l0.getSceneDataByIndex(t);return this.initScene(i,e,n)}static initSceneByName(t,e=!1,n=!1){const i=l0.getSceneDataByName(t);return this.initScene(i,e,n)}static initScene(t,e=!1,n=!1){var i,r;e&&this.removeActiveScenes();const s=new U3;s.name=t.name,s.label=t.name,s.id=t.id,d0.objectByScene.set(s,[]);((null==(i=t.settings)?void 0:i.isEndcard)||"endcard"===(null==(r=t.settings)?void 0:r.sceneType))&&e6.end(!!e6[t.settings.winParameter]),t.root.children.forEach(t=>{this.addGameObject(t,s,s,!1)});d0.objectByScene.get(s).forEach(t=>{t.componentsData&&t.updateComponents(t.componentsData)}),this.currentScene=s,this.sceneList.set(s.id,s),this.application.stage.addChild(s),s.onSceneInited(),t.settings.enablePhysics2D;const a=gN();return s.resize(a.baseWidth,a.baseHeight),(this.sceneList.size>1||n)&&(Yj.script2d.awakeAll(s),Yj.script2d.initAll(s)),W8(e6.screenWidth,e6.screenHeight),s}static getSceneByName(t){return[...this.sceneList.values()].find(e=>e.name===t)}static removeScene(t){t.destroy({children:!0}),this.sceneList.delete(t.id)}static removeSceneByName(t){const e=this.getSceneByName(t);e&&this.removeScene(e)}static removeActiveScenes(){this.sceneList.forEach(t=>{this.removeScene(t)})}static addGameObject(t,e,n,i=!0){const r=t.children,s=L3.add(t);if(s){if(s.id=t.id,e.addChild(s),i&&s.updateComponents(t.components),t.components.scripts){s.components.add("scripts");const e=t.components.scripts.scripts,n=Object.values(e);n.sort((t,e)=>t.order-e.order);for(const t of n)Yj.script2d.createEntityFromData(s,t)}return d0.addObject(s,n),r&&r.forEach(t=>{this.addGameObject(t,s,n,i)}),s}}}n(j8,"list",{}),n(j8,"currentScene"),n(j8,"sceneList",new Map),n(j8,"application");const Y8=j8;const q8=function(){return Y8.application},K8=function(t){yN(t)},J8=function(t,e=!1){return Y8.initSceneByIndex(t,e,!0)},Z8=function(){return Y8.currentScene},Q8=function(){return V8},$8=S||w,t6=$8.studioVersion;K8($8.globalFont);const e6={projectConfig:$8,projectType:$8.projectType,data:T,spritesheets:{},get eventEmitter(){return Oj.get()},game:new class{constructor(){}init(){}update(t){}resize2D(t,e){}resize3D(t,e){}},get pixiApp(){return q8()},get pixiMain(){return Q8()},get pixiScene(){return Z8()},controls:{},get threeScene(){return ZK()},get threeCamera(){return KK()},get threeMain(){return qK()},showPhyiscsDebug:!1,threeWidth:0,threeHeight:0,pixiWidth:0,pixiHeight:0,pixiScale:1,screenWidth:0,screenHeight:0,useSameCanvas:$8.generalSettings.useSameCanvas,topBanner:null,firstClick:!1,studioVersion:t6,getVersionNumber:()=>{if(!t6)return 0;const t=t6.split(".").map(Number);return 1e6*t[0]+1e3*t[1]+t[2]},end(t){Dj(t)}};function n6(t){const e=[];return 2==e6.data.bannerBgType&&e6.data.bannerBgImage&&e.push({type:"image",src:e6.data.bannerBgImage,key:"bannerBgImage"}),e6.data.videoSrc&&e.push({type:"video",key:"video",src:e6.data.videoSrc}),e}function i6(t){const e=[];return e6.data.bgSrc&&e.push({type:"texture",key:"bg3d",src:e6.data.bgSrc}),e}function r6(t){return{}}class s6{static async loadFonts(t,e){const n=[];for(const i in t){if(!t.hasOwnProperty(i))continue;const r=[];for(const t in e)e[t]===i&&r.push(t);n.push(s6.loadFont(i,t[i],r))}await Promise.all(n)}static async loadFontItem(t,e){const n=new FontFace(t,`url(${e})`);return n.load().then(()=>{document.fonts.add(n)})}static async loadFont(t,e,n){const i=[{key:t,src:e=e.replace(/\\/g,"/")}].concat(n.map(t=>({key:t,src:e}))),r=[];for(const s of i)r.push(s6.loadFontItem(s.key,s.src))}}class a6{constructor(t){n(this,"countTime"),n(this,"startTime"),n(this,"totalTimePassed"),n(this,"elapsedTime"),n(this,"prevTime"),n(this,"totalTime"),n(this,"analyticsTime"),n(this,"isStarted"),this.countTime=!1,this.startTime=null,this.totalTimePassed=0,this.elapsedTime=0,this.prevTime=0,this.totalTime=t,this.analyticsTime=0,this.isStarted=!1}start(){this.isStarted||(this.isStarted=!0,this.countTime=!0,this.startTime=(new Date).getTime(),this.elapsedTime=0,this.prevTime=0)}stop(){this.isStarted&&(this.totalTime=this.left(),this.totalTimePassed=this.passed(),this.countTime=!1,this.isStarted=!1)}reset(t){this.countTime=!0,this.startTime=(new Date).getTime(),this.totalTime=void 0!==t?t:this.totalTime,this.totalTimePassed=0,this.elapsedTime=0,this.prevTime=0,this.analyticsTime=0}resume(){!this.countTime&&this.startTime&&this.start()}left(){if(!this.countTime||!this.startTime)return this.totalTime;const t=((new Date).getTime()-this.startTime)/1e3;return this.totalTime-t}passed(){if(!this.countTime||!this.startTime)return this.totalTimePassed;return((new Date).getTime()-this.startTime)/1e3+this.totalTimePassed}checkTimeUp(){return!(!this.countTime||!this.startTime)&&this.elapsedTime>=this.totalTime}update(t){return!(!this.countTime||!this.startTime)&&(this.elapsedTime=((new Date).getTime()-this.startTime)/1e3,!!(t&&this.elapsedTime-this.prevTime>=1)&&(this.prevTime=Math.floor(this.elapsedTime),t.secondPassed(),this.analyticsTime++,!0))}getAnalyticsTime(){return this.analyticsTime}}class o6{constructor(t){if(n(this,"soundEnabled",!0),n(this,"config"),n(this,"time"),n(this,"sysTime"),n(this,"networkHelper"),n(this,"isNetworkReady",!1),n(this,"gamePaused",!1),n(this,"timeStarted",!1),n(this,"state",0),n(this,"firstInteracted",!1),this.config=t,this.time=new a6(t.totalTime||0),this.sysTime=new a6(0),window.pfNetworkHelper){const e={gameStart:()=>{this.networkReady()},pauseGame:()=>{this.pauseGame()},resumeGame:()=>{this.resumeGame()},soundChange:t=>{this.soundChange(t)},resize:(t,e)=>{this.resize(t,e)},showEndCard:()=>{}},n={nucleo:t.nucleo,tapjoy:t.tapjoy},i=window.pfNetworkHelper.default||window.pfNetworkHelper;this.networkHelper=new i(window.app.type,null,e,n)}else setTimeout(()=>{this.networkReady()},250),window.addEventListener("resize",()=>{const t=window.innerWidth,e=window.innerHeight;this.resize(t,e)}),window.addEventListener("blur",this.pauseGame.bind(this)),window.addEventListener("focus",this.resumeGame.bind(this))}hidePreloader(){let t;t=window.app.data.enableCustomPreloader?document.getElementById("custom-preloader-pf"):document.getElementById("preloader-pf")||document.getElementById("preloader-gear"),t&&(t.classList.add("hide"),setTimeout(()=>{null==t||t.remove()},500))}networkReady(){this.isNetworkReady=!0,this.config.networkReady&&this.config.networkReady()}gameInited(){this.networkHelper&&(this.networkHelper.gameInited(),this.networkHelper.startResponsive())}gameStarted(){this.networkHelper&&this.networkHelper.gameStarted()}pauseGame(){this.time.stop(),this.sysTime.stop(),this.gamePaused=!0,this.config.gamePaused&&this.config.gamePaused()}resumeGame(){this.time.resume(),this.sysTime.resume(),this.gamePaused=!1,this.config.gameContinue&&this.config.gameContinue()}soundChange(t){this.soundEnabled=t,this.config.soundChanged&&this.config.soundChanged(this.soundEnabled)}resize(t,e){this.config.gameResized&&this.config.gameResized(t,e)}startTimer(){this.timeStarted||(this.time.start(),this.timeStarted=!0)}resizeNow(){this.networkHelper?this.networkHelper.resize():this.resize(window.innerWidth,window.innerHeight)}update(){this.time.update(),3===this.state&&this.time.checkTimeUp()&&(this.state=4,this.config.timeUp&&this.config.timeUp())}restartGame(t=0){this.time.reset(t),this.sysTime.reset(0),this.state=3,this.networkHelper&&this.networkHelper.gameRestarted()}interacted(){this.networkHelper&&this.networkHelper.interacted(),this.firstInteracted||(this.firstInteracted=!0,this.time.start())}gameFinished(t,e,n=!1){const i=this.sysTime.getAnalyticsTime();this.networkHelper&&this.networkHelper.gameFinished(t,e,i,n)}openMarket(){this.networkHelper?this.networkHelper.openMarket():window.open(window.lp_url)}openMarketFinal(){this.networkHelper?this.networkHelper.openMarketFinal():window.open(window.lp_url)}gotoLink(){this.openMarket()}}const l6=s||a;let h6=o||l;h6=h6.default||h6;const c6=h6.filter(t=>"font"===t.type);for(let w6 in l6.assets.font){if(!l6.assets.font.hasOwnProperty(w6))continue;const t=c6.find(t=>t.key===w6);t&&(l6.assets.font[w6]=t.src)}class u6{static async init(t){const e=[],n={...l6.assets.font,...(app.data,{})};app.data.__globalFont&&(n.__globalFont=app.data.__globalFont,yN("__globalFont")),e.push(s6.loadFonts(n,l6.objectMap.font)),e.push(this.initMain(t)),await Promise.all(e)}static async initMain(t){return new Promise(async e=>{const n={...t,networkReady:()=>{e()}},i=new o6(n);this.main=i})}static resizeNow(){this.main.resizeNow()}static gameInited(){this.main.gameInited()}static gameStarted(){this.main.gameStarted()}}function d6(t,e){window.app||(window.app={}),window.app.data||(window.app.data={}),window.app.main||(window.app.main={});let n=null,i=!0,r=!1,s=0;let a=!1;const o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||/iPad|iPhone|iPod/.test(navigator.userAgent);function l(){!a&&e&&(a=!0,e())}function h(){i=!1;let e=n?n.duration:app.data.entranceVideoDuration||3;n&&(n.style.display="none",n.remove(),n=null);const r=document.createElement("img");r.src=t,document.body.appendChild(r),r.style.position="absolute",r.style.top=0,r.style.left=0,r.style.width="100%",r.style.height="100%",r.style.objectFit="cover",r.style.zIndex=1999,r.style.backgroundColor="#000";setTimeout(()=>{r.style.pointerEvents="none",l(),r.style.opacity=0,setTimeout(()=>{r.remove()},500)},1e3*e+250),app.pfResizeVideo=(t,e)=>{r.style.objectFit=t<e?"cover":"contain"},app.documentWidth&&app.pfResizeVideo(app.documentWidth,app.documentHeight)}function c(){if(n=document.createElement("video"),n.style.position="fixed",n.style.top=0,n.style.left=0,n.style.width="100%",n.style.height="100%",n.style.objectFit="cover",n.style.zIndex=1999,n.style.backgroundColor="#000",n.muted=!0,n.volume=0,n.setAttribute("muted","muted"),n.setAttribute("playsinline","playsinline"),n.setAttribute("webkit-playsinline","webkit-playsinline"),o?(0===s?(n.setAttribute("preload","metadata"),n.setAttribute("autoplay","autoplay"),n.autoplay=!0):1===s?(n.setAttribute("preload","auto"),n.setAttribute("autoplay","autoplay"),n.autoplay=!0):(n.setAttribute("preload","none"),n.removeAttribute("autoplay"),n.autoplay=!1),n.playsInline=!0,n.controls=!1):(n.setAttribute("preload","auto"),n.setAttribute("autoplay","autoplay"),n.autoplay=!0),document.body.appendChild(n),o)n.src=t;else{const e=document.createElement("source");e.src=t,e.type="video/mp4",n.appendChild(e)}return n}function u(){n&&(n.addEventListener("ended",()=>{n.style.pointerEvents="none",l(),n.style.opacity=0,setTimeout(()=>{n&&n.remove()},500)}),n.addEventListener("error",t=>{const e=n.error;e&&(e.code,e.message),f()}),n.addEventListener("stalled",()=>{}),o&&(n.addEventListener("loadstart",()=>{}),n.addEventListener("canplaythrough",()=>{})))}function d(){if(!n||!i)return;r=!0,n.removeAttribute("muted"),n.muted=!1;const t=void 0!==app.data.videoVolume?app.data.videoVolume:1;n.volume=t}function p(){if(!n)return;(o?["touchend","click"]:["touchend","mouseup","click"]).forEach(t=>{n.addEventListener(t,t=>{!function(){if(!n||!i||r)return;if("applovin"===window.type)return void d();!1!==app.data.soundEnabled&&!1!==app.main.soundEnabled&&setTimeout(()=>{d()},100)}(),t.stopPropagation()},{once:!0})})}function f(){s++,s<3?(n&&(n.remove(),n=null),setTimeout(()=>{c(),u(),m()},o?1e3:500)):h()}async function m(){if(n)try{let t;if(await function(t,e=1e4){return new Promise((n,i)=>{let r;const s=()=>{r&&clearTimeout(r)},a=()=>{s(),n()},l=o?1:2;t.readyState>=l?a():(o?(t.addEventListener("loadedmetadata",a,{once:!0}),t.addEventListener("loadeddata",a,{once:!0})):(t.addEventListener("loadeddata",a,{once:!0}),t.addEventListener("canplay",a,{once:!0})),r=setTimeout(()=>{s(),i(new Error("Video loading timeout"))},o?2*e:e))})}(n,o?8e3:5e3),o&&(n.muted=!0,n.volume=0,n.playsInline=!0),s<2||(n.load(),await new Promise(t=>{n.addEventListener("loadedmetadata",t,{once:!0}),setTimeout(t,2e3)})),t=n.play(),void 0!==t){await t,p();setTimeout(()=>{n&&(n.paused||n.currentTime<.02)&&f()},o?3e3:1500)}else f()}catch(t){t.name,f()}else f()}e6.eventEmitter&&e6.eventEmitter.on("soundChanged",t=>{i&&n&&(t&&r?d():t||(n.setAttribute("muted","muted"),n.muted=!0))}),async function(){if(function(){const t=document.createElement("video"),e=t.canPlayType&&t.canPlayType("video/mp4").replace(/no/,"");return o?!!(e||t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/no/,"")||t.canPlayType('video/mp4; codecs="avc1.4D401E"').replace(/no/,"")):!!e}())if(t&&"string"==typeof t)try{c(),u(),app.pfResizeVideo=(t,e)=>{i&&n&&(n.style.objectFit=t<e?"cover":"contain")},app.documentWidth?app.pfResizeVideo(app.documentWidth,app.documentHeight):app.pfResizeVideo(window.innerWidth,window.innerHeight),m()}catch(e){h()}else h();else h()}()}n(u6,"main");const p6=class t{static init(e){t.renderer2d=e}static restartGame(){this.renderer2d&&this.goToScene(this.renderer2d.sceneHelper.currentScene.name)}static goToScene(e){const n=Box2DPhysics.getInstance();n&&n.restart(),QW.globalTimeline.getChildren(!0,!0,!0).forEach(t=>{t.kill()}),QW.globalTimeline.clear(!0),e6.eventEmitter.removeAllListeners(),this.renderer2d.sceneHelper.initSceneByName(e),window.app.resizeNow(),t.start()}static start(){this.renderer2d.scriptSystem.awakeAll(),this.renderer2d.scriptSystem.initAll(),this.renderer2d.onBeforeUpdate()}};n(p6,"renderer2d");let f6=p6;class m6{constructor(t){n(this,"readyCallback"),n(this,"selectCallback"),n(this,"application",new $w),n(this,"updateIntro"),n(this,"cont"),n(this,"btn"),n(this,"closest"),this.readyCallback=t,this.initRenderer()}async initRenderer(){const t=this.application,e={preference:"webgl",clearBeforeRender:!0,backgroundAlpha:1,backgroundColor:0,resolution:1,antialias:!0,autoDensity:!1,width:window.innerWidth,height:window.innerHeight},n=document.createElement("canvas");document.body.appendChild(n),n.addEventListener("touchstart",t=>{t.preventDefault()}),e.canvas=n,await t.init(e);const i=new E8({maxDimension:1e3,resolution:2},t);app.pfResizeVersionIntro=(t,e)=>{const n=i.resize(t,e),r=n.width,s=n.height;if(this.cont){this.cont.x=.5*r,this.cont.y=.5*s;const t=Math.min(1.1*r/600,.5*s/400);this.cont.scale.set(t)}this.btn&&(this.btn.x=.5*r,this.btn.y=.85*s,this.btn.scale.set(Math.min(.45*r/this.btn.baseWidth,.12*s/this.btn.baseHeight)))};const r=[];app.data.___versionIntro.forEach((t,e)=>{t.no=e,r.push({type:"image",key:"___intro_img_"+e,src:t.image||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjGOQAAACgAAH4BzM6AAAAAElFTkSuQmCC"})}),await u0.load(r),this.readyCallback()}init(t){this.selectCallback=t;const e=new Db;this.cont=e,this.application.stage.addChild(e),e.x=500,e.y=500;let n=[];const i=app.data.___versionIntro;let r=0;for(;i.length<4;)i.push(i[r]),r++;app.data.___versionIntro.forEach((t,i)=>{const r=new Db;e.addChild(r);const s=new Fb(u0.get("___intro_img_"+t.no));s.anchor.set(.5,.5),r.addChild(s);const a=Math.min(200/s.width,400/s.height);s.scale.set(a,a),n.push(r),r.dt=t});let s=n.length,a=Math.PI/2,o=2*Math.PI/s,l=!0,h=()=>{n=n.sort((t,e)=>t.y-e.y);n.forEach(t=>{let n=a+t.rotStep;t.x=186*Math.cos(n),t.y=-60*Math.sin(n),t.curRot=n;let i=60+t.y;t.targetScale=.4+i/120*.9,t.y<48&&(t.targetScale*=.85),Math.abs(t.scale-t.targetScale)<.05&&(t.scale=t.targetScale),e.addChild(t)});let t=999;n.forEach(e=>{let n=Math.sqrt(e.x*e.x+e.y*e.y);n<t&&e.y>0&&(t=n,this.closest=e)})};for(let g=0;g<s;g++){let t=2*Math.PI*g/s+0;n[g].rotStep=t}h(),setTimeout(()=>{h()},1),n.forEach(t=>{t.scale=t.targetScale});let c=!1,u=0,d=0;const p=this.application.stage;p.interactive=!0;const f=new Fb(ox.EMPTY);f.width=5e3,f.height=5e3,p.addChild(f),p.on("pointerdown",t=>{c||(c=!0,u=t.x,d=t.y)}),p.on("pointermove",t=>{if(!c||!l)return;let e=t.x-u;t.y,a+=.002*e,a=a>2*Math.PI?a-2*Math.PI:a,a=a<0?a+2*Math.PI:a,u=t.x,d=t.y,h()}),n[2],p.on("pointerup",t=>{if(!c)return;c=!1;let e=999;n.forEach(t=>{let n=Math.sqrt(t.x*t.x+t.y*t.y);n<e&&t.y>0&&(e=n)});let i={curRot:a},r=Math.round((a-Math.PI/2)/o);l=!1,gsap.to(i,{curRot:r*o+Math.PI/2,duration:.25,ease:"Sine.easeInOut",onComplete:()=>{l=!0},onUpdate:()=>{a=i.curRot,h()}})});const m=()=>{n.forEach(t=>{t.scaleX+=.1*(t.targetScale-t.scaleX),t.scaleY=t.scaleX}),requestAnimationFrame(()=>{m()})};m(),this.addButton(),app.main.resizeNow()}fillParams(t){var e;const n=null==(e=app.data.___versionIntro.find(e=>e.id===t))?void 0:e.no,i=app.data.___versionIntroData[n],r=t=>{for(const e in t)if("object"==typeof t[e]&&null!==t[e])r(t[e]);else{const n=t[e];if("string"==typeof n&&n.startsWith("___dataItem")){const i=n.split(".")[1],r=app.data.___versionIntroAssets[i];t[e]=r}}};if(r(i),i)for(let s in i)void 0!==i[s]&&null!==i[s]&&(app.data[s]=i[s])}addButton(){const t=new Db;this.btn=t;const e=new Fb(ox.WHITE);e.anchor.set(.5,.5),e.width=200,e.height=100,e.tint=65280,t.addChild(e),t.baseWidth=e.width,t.baseHeight=e.height,this.application.stage.addChild(t),t.interactive=!0,t.on("pointerdown",()=>{var t;const e=this.closest.dt.id;this.fillParams(e),null==(t=this.selectCallback)||t.call(this,e)})}}window.THREE=_p;const g6=Gk.getInstance();cN=g6;class v6{constructor(t,e,i,r){n(this,"config"),n(this,"numOfLoaded",0),n(this,"totalToLoad",1),n(this,"sceneManager"),n(this,"renderer2D"),n(this,"renderer3D"),n(this,"customAssets"),n(this,"enabled2D",!1),n(this,"enabled3D",!1),n(this,"gameStarted",!1),n(this,"config3D"),n(this,"readyCallback"),n(this,"updateActive",!0),n(this,"versionIntro"),n(this,"game"),this.config=t,this.customAssets=e,this.readyCallback=i,this.config3D=r||{enableFixedUpdate3d:!1,timeStep:1/60},this.game=e6.game;let s={type:window.type||null,data:e6.data,globals:e6,resizeNow:u6.resizeNow,isPixiTemplate:!0,main:u6.main,templateVersion:"2",mobvistaStarted:!1,gameStart:()=>{"mobvista"===s.type&&(s.mobvistaStarted=!0,this.loadCallback("mobvista"))},gameClose:()=>{s.main.soundEnabled=!1,ij.muteAll()}};if(window.app=s,u6.init(t).then(()=>{setTimeout(()=>{this.loadCallback("manager")},1)}),"mobvista"===s.type&&this.totalToLoad++,e6.data.___versionIntro){this.totalToLoad++;const t=new m6(()=>{this.loadCallback("versionIntro")});this.versionIntro=t}else this.startLibraries()}startLibraries(){let t="3D"===e6.projectType&&e6.useSameCanvas;const e=t=>{this.init2D(t)};t||e(),this.init3D().then(n=>{t&&e(n)})}loadCallback(t){var e;this.numOfLoaded++,"mobvista"===app.type&&this.numOfLoaded===this.totalToLoad-1&&window.mobvistaGameReady&&window.mobvistaGameReady(),this.numOfLoaded==this.totalToLoad&&(this.gameStarted?this.versionIntro&&this.readyCallback():(this.gameStarted=!0,this.versionIntro?(null==(e=this.versionIntro)||e.init(()=>{this.startLibraries()}),app.main.hidePreloader(),app.main.gameInited(),app.main.gameStarted()):this.readyCallback()))}preInit(){var t,e;u6.gameInited(),u6.resizeNow(),this.initSound(),null==(t=this.renderer2D)||t.onAllReady(),null==(e=this.renderer3D)||e.onAllReady()}init(){var t,e,n;null==(t=this.sceneManager)||t.init(this.renderer2D,this.renderer3D),null==(e=this.sceneManager)||e.start(),this.game.init(),this.initUpdate(),u6.resizeNow(),setTimeout(()=>{u6.gameStarted(),this.initFirstClickHandler()},1),u6.main.hidePreloader(),(null==(n=null==window?void 0:window.editorMeta)?void 0:n.isEditing)&&(window.pfTakeSnapshot=()=>new Promise(t=>{const e=window.pfTakeSnapshotPixi();if("2D"===e6.projectType)return t(e),e;const n=window.pfTakeSnapshotThree(),i=document.createElement("canvas"),r=i.getContext("2d");if(!r)return t(e),e;const s=new Image;s.src=e;const a=new Image;a.src=n;let o=0;const l=function(){o++,2===o&&(i.width=a.width,i.height=a.height,r.drawImage(a,0,0),r.drawImage(s,0,0),t(i.toDataURL("image/jpeg",.7)))};s.onload=()=>{l()},a.onload=()=>{l()}}))}initFirstClickHandler(){const t=()=>{e6.firstClick||(e6.firstClick=!0,e6.eventEmitter.emit("___firstClick"),document.body.removeEventListener("touchstart",t),document.body.removeEventListener("mousedown",t))};document.body.addEventListener("touchstart",t),document.body.addEventListener("mousedown",t)}initSound(){function t(){app.data.isEditor||(ij.init(),ij.playBgMusic())}if(app.data.playSoundAfterFirstTouch){let e=()=>{t(),window.removeEventListener("touchstart",e),window.removeEventListener("mousedown",e)};window.addEventListener("touchstart",e),window.addEventListener("mousedown",e)}else t()}init2D(t){this.totalToLoad++,this.enabled2D=!0,this.sceneManager=f6,X8(this.customAssets.assets2D,t).then(t=>{this.renderer2D=t,this.loadCallback("pixi")})}init3D(){return new Promise(t=>{this.totalToLoad++,this.enabled3D=!0,this.sceneManager=YK,HK(this.customAssets.assets3D,e=>{t(e)}).then(t=>{this.renderer3D=t,this.loadCallback("three")})})}initRapier(){this.totalToLoad++,RAPIER3D.init().then(()=>{this.loadCallback("rapierPhysics")})}resize(t,e){e6.screenWidth=t,e6.screenHeight=e,this.enabled2D&&W8(t,e),this.enabled3D&&VK(t,e),app.documentWidth=t,app.documentHeight=e,app.pfResizeVideo&&app.pfResizeVideo(t,e),app.pfResizeVersionIntro&&app.pfResizeVersionIntro(t,e)}update2D(t){var e;this.renderer2D.update(t/1e3),null==(e=app.main)||e.update()}update3D(){Ij.stats&&Ij.stats.begin(),this.renderer3D.timer.update();let t=this.renderer3D.timer.getDelta();if(!isNaN(t)&&t!==1/0&&t)return t>.05&&(t=.05),this.game.update(t),this.config3D.enableFixedUpdate3d?this.renderer3D.fixedUpdate(t):this.renderer3D.update(t),this.renderer3D.render(),Ij.stats&&Ij.stats.end(),t}initUpdate(){if(this.enabled2D&&N8.ticker.stop(),this.enabled3D){const t=()=>{if(requestAnimationFrame(t),!this.updateActive)return;const e=this.update3D();this.enabled2D&&this.update2D(1e3*e)};t()}else this.enabled2D&&QW.ticker.add((t,e)=>{this.updateActive&&this.update2D(e)})}}let y6=e6.data;if(y6.isEditor&&window.jsStuffs&&(y6=window.jsStuffs.processResults(y6)),window.dashboardParams)for(let w6 in window.dashboardParams)void 0!==window.dashboardParams[w6]&&null!==window.dashboardParams[w6]&&(y6[w6]=window.dashboardParams[w6]);for(let w6 in y6.stuffsLoadList){const t=y6.stuffsLoadList[w6];for(let e in t)t[e]=y6.__stuffsUniqueList[t[e]]}class x6{static init(t){this.readyCallback=t;const e={enableCustomPreloader:!1,gamePaused:()=>{ij.muteAll()},gameContinue:()=>{var t;(null==(t=null==app?void 0:app.main)?void 0:t.soundEnabled)&&ij.unmuteAll()},gameResized:(t,e)=>{n.resize(t,e)},soundChanged:t=>{t?ij.unmuteAll():ij.muteAll(),e6.eventEmitter.emit("soundChanged",t)}};let n;const i=()=>{document.body?(n=new v6(e,{assets2D:n6(),assets3D:i6(),audios:[],fonts:{}},()=>{const t=()=>{n.preInit(),this.readyCallback(),n.init()};e6.data.entranceVideo?d6(e6.data.entranceVideo,()=>{t()}):t()}),app.main=u6.main):setTimeout(()=>{i()},1)};y6.isEditor?(window.pfSetData=t=>{y6.editorData=t,i()},window.pfGetData=()=>y6.editorData):i()}}n(x6,"readyCallback"),x6.init(()=>{J8(0),JK(0)}),vy.add(V_),vy.mixin(Db,X_),vy.add(tT),vy.add(eT),vy.add(zI),vy.mixin(Db,GI),vy.add(EP),vy.add(YL),vy.add(_A),vy.add(vU),vy.add(PU),vy.add(RU),vy.add(Lk),vy.add(Fk),vy.add(hk),vy.add(Ak),vy.add(fk),vy.add(tk),vy.add(HU),vy.add(gO),vy.add(dO);const b6=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),_6=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));

})();</script></body>
</html>